
<html>
<head>
<link type="text/css" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700">
<style type="text/css">
.gm-style .gm-style-cc span,.gm-style .gm-style-cc a,.gm-style .gm-style-mtc div{font-size:10px}
</style>
<style type="text/css">
@media print {  .gm-style .gmnoprint, .gmnoprint {    display:none  }}@media screen {  .gm-style .gmnoscreen, .gmnoscreen {    display:none  }}
</style>
<style type="text/css">
.gm-style{font-family:Roboto,Arial,sans-serif;font-size:11px;font-weight:400;text-decoration:none}.gm-style img{max-width:none}
</style>
<script src="https://apis.google.com/_/scs/apps-static/_/js/k=oz.gapi.en.slS5rHkFXTQ.O/m=auth,client,drive_realtime,drive_share/rt=j/sv=1/d=1/ed=1/am=AQ/rs=AGLTcCOfN6r_xbOer9jqf4_7s7fNaJZM7w/t=zcms/cb=gapi.loaded_0" async="">
</script>
<script type="text/javascript" src="https://apis.google.com/js/api.js" gapi_processed="true">
</script>
<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jqueryui/1.11.3/jquery-ui.min.js">
</script>
<script type="text/javascript" id="www-widgetapi-script" src="https://s.ytimg.com/yts/jsbin/www-widgetapi-vfloT07bb/www-widgetapi.js" async="">
</script>
<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js">
</script>
<title>
Ingress Intel Map
</title>
<style>
/* general rules ******************************************************/
/* for printing directly from the browser, hide all UI components
 * NOTE: @media needs to be first?
 */
@media print {
  .leaflet-control-container { display: none !important; }
  #chatcontrols, #chat, #chatinput { display: none !important; }
  #sidebartoggle, #sidebar { display: none !important; }
  #updatestatus { display: none !important; }
  #portal_highlight_select { display: none !important; }
}
html, body, #map {
  height: 100%;
  width: 100%;
  overflow: hidden; /* workaround for #373 */
  background: #0e3d4e;
}
body {
  font-size: 14px;
  font-family: "Roboto", "Helvetica Neue", Helvetica, sans-serif;
  margin: 0;
}
#scrollwrapper {
  overflow-x: hidden;
  overflow-y: auto;
  position: fixed;
  right: -38px;
  top: 0;
  width: 340px;
  bottom: 45px;
  z-index: 1001;
  pointer-events: none;
}
#sidebar {
  background-color: rgba(8, 48, 78, 0.9);
  border-left: 1px solid #20A8B1;
  color: #888;
  position: relative;
  left: 0;
  top: 0;
  max-height: 100%;
  overflow-y:scroll;
  overflow-x:hidden;
  z-index: 3000;
  pointer-events: auto;
}
#sidebartoggle {
  display: block;
  padding: 20px 5px;
  margin-top: -31px; /* -(toggle height / 2) */
  line-height: 10px;
  position: absolute;
  top: 108px;
  z-index: 3001;
  background-color: rgba(8, 48, 78, 0.9);
  color: #FFCE00;
  border: 1px solid #20A8B1;
  border-right: none;
  border-radius: 5px 0 0 5px;
  text-decoration: none;
  right: -50px; /* overwritten later by the script with SIDEBAR_WIDTH */
}
.enl {
  color: #03fe03 !important;
}
.res {
  color: #00c5ff !important;
}
.none {
  color: #fff;
}
.nickname {
  cursor: pointer !important;
}
a {
  color: #ffce00;
  cursor: pointer;
  text-decoration: none;
}
a:hover {
  text-decoration: underline;
}
/* map display, required because GMaps uses a high z-index which is
 * normally above Leaflet’s vector pane */
.leaflet-map-pane {
  z-index: 1000;
}
/* leaflet layer chooser, when opened, is above other panels */
/* doesn't actually work :( - left commented out for reference
.leaflet-control-layers-expanded {
  z-index: 9999 !important;
}
*/
.leaflet-control-layers-overlays label.disabled {
  text-decoration: line-through;
  cursor: help;
}
/* base layer selection - first column */
.leaflet-control-layers-base {
  float: left;
  overflow-y: auto;
  max-height: 600px;
}
/* overlays layer selection - 2nd column */
.leaflet-control-layers-overlays {
  float: left;
  margin-left: 8px;
  border-left: 1px solid #DDDDDD;
  padding-left: 8px;
  overflow-y: auto;
  max-height: 600px;
}
/* hide the usual separator */
.leaflet-control-layers-separator {
  display: none;
}
.help {
  cursor: help;
}
.toggle {
  display: block;
  height: 0;
  width: 0;
}
/* field mu count */
.fieldmu {
  color: #FFCE00;
  font-size: 13px;
  font-family: Roboto, "Helvetica Neue", Helvetica, sans-serif; /*override leaflet-container */
  text-align: center;
  text-shadow: 0 0 0.2em black, 0 0 0.2em black, 0 0 0.2em black;
  pointer-events: none;
}
/* chat ***************************************************************/
#chatcontrols {
  color: #FFCE00;
  background: rgba(8, 48, 78, 0.9);
  position: absolute;
  left: 0;
  z-index: 3000;
  height: 26px;
  padding-left:1px;
}
#chatcontrols.expand {
  top: 0;
  bottom: auto;
}
#chatcontrols a {
  margin-left: -1px;
  display: inline-block;
  width: 94px;
  text-align: center;
  height: 24px;
  line-height: 24px;
  border: 1px solid #20A8B1;
  vertical-align: top;
}
#chatcontrols a:first-child {
  letter-spacing:-1px;
  text-decoration: none !important;
}
#chatcontrols a.active {
  border-color: #FFCE00;
  border-bottom-width:0px;
  font-weight:bold;
  background: rgb(8, 48, 78);
}
#chatcontrols a.active + a {
  border-left-color: #FFCE00
}
#chatcontrols .toggle {
  border-left: 10px solid transparent;
  border-right: 10px solid transparent;
  margin: 6px auto auto;
}
#chatcontrols .expand {
  border-bottom: 10px solid #FFCE00;
}
#chatcontrols .shrink {
  border-top: 10px solid #FFCE00;
}
#chatcontrols .loading {
  background-color: rgba(255,0,0,0.3);
  -webkit-animation: chatloading 1.2s infinite linear;
  -moz-animation: chatloading 1.2s infinite linear;
  animation: chatloading 1.2s infinite linear;
}
@-webkit-keyframes chatloading {
    0% { background-color: rgba(255,0,0,0.4) }
   50% { background-color: rgba(255,0,0,0.1) }
  100% { background-color: rgba(255,0,0,0.4) }
}
@-moz-keyframes chatloading {
    0% { background-color: rgba(255,0,0,0.4) }
   50% { background-color: rgba(255,0,0,0.1) }
  100% { background-color: rgba(255,0,0,0.4) }
}
@keyframes chatloading {
    0% { background-color: rgba(255,0,0,0.4) }
   50% { background-color: rgba(255,0,0,0.1) }
  100% { background-color: rgba(255,0,0,0.4) }
}
#chat {
  position: absolute;
  width: 708px;
  bottom: 23px;
  left: 0;
  z-index: 3000;
  background: rgba(8, 48, 78, 0.9);
  line-height: 15px;
  color: #eee;
  border: 1px solid #20A8B1;
  border-bottom: 0;
  -webkit-box-sizing: border-box;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}
em {
  color: red;
  font-style: normal;
}
#chat.expand {
  height:auto;
  top: 25px;
}
#chat >
 div {
  overflow-x:hidden;
  overflow-y:scroll;
  height: 100%;
  -webkit-box-sizing: border-box;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
  padding: 2px;
  position:relative;
}
#chat table, #chatinput table {
  width: 100%;
  table-layout: fixed;
  border-spacing: 0;
  border-collapse: collapse;
}
#chatinput table {
  height: 100%;
}
#chat td, #chatinput td {
  font-size: 13px;
  vertical-align: top;
  padding-bottom: 3px;
}
/* time */
#chat td:first-child, #chatinput td:first-child {
  width: 44px;
  overflow: hidden;
  padding-left: 2px;
  color: #bbb;
  white-space: nowrap;
}
#chat time {
  cursor: help;
}
/* nick */
#chat td:nth-child(2), #chatinput td:nth-child(2) {
  width: 91px;
  overflow: hidden;
  padding-left: 2px;
  white-space: nowrap;
}
#chat td .system_narrowcast {
  color: #f66 !important;
}
mark {
  background: transparent;
}
.invisep {
  display: inline-block;
  width: 1px;
  height: 1px;
  overflow:hidden;
  color: transparent;
}
/* divider */
summary {
  color: #bbb;
  display: inline-block;
  height: 16px;
  overflow: hidden;
  padding: 0 2px;
  white-space: nowrap;
  width: 100%;
}
#chatinput {
  position: absolute;
  bottom: 0;
  left: 0;
  padding: 0 2px;
  background: rgba(8, 48, 78, 0.9);
  width: 708px;
  height: 23px;
  border: 1px solid #20A8B1;
  z-index: 3001;
  -webkit-box-sizing: border-box;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}
#chatinput td {
  padding-bottom: 1px;
  vertical-align: middle;
}
#chatinput input {
  background: transparent;
  color: #EEEEEE;
  width: 100%;
  height: 100%;
  padding:3px 4px 1px 4px;
}
/* sidebar ************************************************************/
#sidebar >
 * {
  border-bottom: 1px solid #20A8B1;
  -webkit-box-sizing: border-box;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}
#sidebartoggle .toggle {
  border-bottom: 10px solid transparent;
  border-top: 10px solid transparent;
}
#sidebartoggle .open {
  border-right: 10px solid #FFCE00;
}
#sidebartoggle .close {
  border-left: 10px solid #FFCE00;
}
/* player stats */
#playerstat {
  height: 30px;
}
h2 {
  color: #ffce00;
  font-size: 21px;
  padding: 0 4px;
  margin: 0;
  cursor:help;
  -webkit-box-sizing: border-box;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
  width: 100%;
}
h2 #name {
  font-weight: 300;
  display: inline-block;
  overflow: hidden;
  text-overflow: ellipsis;
  vertical-align: top;
  white-space: nowrap;
  width: 205px;
  position: relative;
}
h2 #stats {
  float: right;
  height: 100%;
  overflow: hidden;
}
#signout {
  font-size: 12px;
  font-weight: normal;
  line-height: 29px;
  padding: 0 4px;
  position: absolute;
  top: 0;
  right: 0;
  background-color: rgba(8, 48, 78, 0.5);
  display: none; /* starts hidden */
}
#name:hover #signout {
  display: block;
}
h2 sup, h2 sub {
  display: block;
  font-size: 11px;
  margin-bottom: -2px;
}
/* gamestats */
#gamestat {
  height: 22px;
}
#gamestat span {
  display: block;
  float: left;
  font-weight: bold;
  cursor:help;
  height: 21px;
  line-height: 22px;
}
#gamestat .res {
  background: #005684;
  text-align: right;
}
#gamestat .enl {
  background: #017f01;
}
/* search input, and others */
input:not([type]), .input,
input[type="text"], input[type="password"],
input[type="number"], input[type="email"],
input[type="search"], input[type="url"] {
  background-color: rgba(0, 0, 0, 0.3);
  color: #ffce00;
  height: 24px;
  padding:0px 4px 0px 4px;
  font-size: 12px;
  border:0;
  font-family:inherit;
  -webkit-box-sizing: border-box;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}
#searchwrapper {
  position: relative;
}
#search {
  width: 100%;
  padding-right: 24px;
}
#buttongeolocation {
  position: absolute;
  top: 2px;
  right: 2px;
  cursor: pointer;
}
#searchwrapper h3 {
  font-size: 1em;
  height: auto;
  cursor: pointer;
}
.searchquery {
  max-height: 25em;
  overflow-y: auto;
}
#searchwrapper .ui-accordion-header::before {
  font-size: 18px;
  margin-right: 2px;
  font-weight: normal;
  line-height: 1em;
  content: "⊞";
}
#searchwrapper .ui-accordion-header-active::before {
  content: "⊟";
}
#searchwrapper .ui-accordion-content {
  margin: 0;
  overflow: hidden;
}
#searchwrapper ul {
  padding-left: 14px;
}
#searchwrapper li {
  cursor: pointer;
}
#searchwrapper li a {
  margin-left: -14px;
  padding-left: 14px;
  background-position: 1px center;
  background-repeat: no-repeat;
  background-size: 12px 12px;
}
#searchwrapper li:focus a, #searchwrapper li:hover a {
  text-decoration: underline;
}
#searchwrapper li em {
  color: #ccc;
  font-size: 0.9em;
}
::-webkit-input-placeholder {
  font-style: italic;
}
:-moz-placeholder {
  font-style: italic;
}
::-moz-placeholder {
  font-style: italic;
}
.leaflet-control-layers input {
  height: auto;
  padding: 0;
}
/* portal title and image */
h3 {
  font-size: 16px;
  padding: 0 4px;
  margin:0;
  height: 23px;
  width: 100%;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  -webkit-box-sizing: border-box;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}
.imgpreview {
  height: 190px;
  background: no-repeat center center;
  background-size: contain;
  cursor: help;
  overflow: hidden;
  position: relative;
}
.imgpreview img.hide {
  display: none;
}
.imgpreview .portalDetails {
  display: none;
}
#level {
  font-size: 40px;
  text-shadow: -1px -1px #000, 1px -1px #000, -1px 1px #000, 1px 1px #000, 0 0 5px #fff;
  display: block;
  margin-right: 15px;
  text-align:right;
  float: right;
}
/* portal mods */
.mods {
  margin: 3px auto 1px auto;
  width: 296px;
  height: 67px;
  text-align: center;
}
.mods span {
  background-color: rgba(0, 0, 0, 0.3);
  /* can’t use inline-block because Webkit's implementation is buggy and
   * introduces additional margins in random cases. No clear necessary,
   * as that’s solved by setting height on .mods. */
  display: block;
  float:left;
  height: 63px;
  margin: 0 2px;
  overflow: hidden;
  padding: 2px;
  text-align: center;
  width: 63px;
  cursor:help;
  border: 1px solid #666;
}
.mods span:not([title]) {
  cursor: auto;
}
.res .mods span, .res .meter {
  border: 1px solid #0076b6;
}
.enl .mods span, .enl .meter {
  border: 1px solid #017f01;
}
/* random details, resonator details */
#randdetails, #resodetails {
  width: 100%;
  -webkit-box-sizing: border-box;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
  padding: 0 4px;
  table-layout: fixed;
  border-spacing: 0m;
  border-collapse: collapse;
}
#randdetails td, #resodetails td {
  overflow: hidden;
  text-overflow: ellipsis;
  vertical-align: top;
  white-space: nowrap;
  width: 50%;
}
#randdetails th, #resodetails th {
  font-weight: normal;
  text-align: right;
  width: 62px;
  padding:0px;
  padding-right:4px;
  padding-left:4px;
}
#randdetails th + th, #resodetails th + th {
  text-align: left;
  padding-right: 4px;
  padding-left: 4px;
}
#randdetails td:first-child, #resodetails td:first-child {
  text-align: right;
  padding-left: 2px;
}
#randdetails td:last-child, #resodetails td:last-child {
  text-align: left;
  padding-right: 2px;
}
#randdetails {
  margin-top: 4px;
  margin-bottom: 5px;
}
#randdetails tt {
  font-family: inherit;
  cursor: help;
}
#artifact_target, #artifact_fragments {
  margin-top: 4px;
  margin-bottom: 4px;
  margin-left: 8px;
  margin-right: 8px;
}
/* resonators */
#resodetails {
  margin-bottom: 0px;
}
.meter {
  background: #000;
  cursor: help;
  display: inline-block;
  height: 18px;
  padding: 1px;
  width: 100%;
  -webkit-box-sizing: border-box;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
  position: relative;
  left: 0;
  top: 0;
}
.meter.north {
  overflow: hidden;
}
.meter.north:before {
  content: "";
  background-color: red;
  border: 1px solid #000000;
  border-radius: 100%;
  display: block;
  height: 6px;
  width: 6px;
  left: 50%;
  top: -3px;
  margin-left: -4px;
  position: absolute;
}
.meter span {
  display: block;
  height: 14px;
}
.meter-level {
  position: absolute;
  left: 0;
  right: 0;
  top: -2px;
  text-shadow: 0.0em 0.0em 0.3em #808080;
  text-align: center;
  word-spacing: 4px; /* to leave some space for the north indicator */
}
/* links below resos */
.linkdetails {
  margin-bottom: 0px;
  text-align: center;
}
.linkdetails aside {
  display: inline-block;
  white-space: nowrap;
  margin-left: 5px;
  margin-right: 5px;
}
#toolbox {
  text-align: left;    /* centre didn't look as nice here as it did above in .linkdetails */
}
#toolbox >
 a {
  margin-left: 5px;
  margin-right: 5px;
  white-space: nowrap;
  display: inline-block;
}
/* a common portal display takes this much space (prevents moving
 * content when first selecting a portal) */
#portaldetails {
  min-height: 63px;
  position: relative; /* so the below '#portaldetails .close' is relative to this */
}
#portaldetails .close {
  position: absolute;
  top: -2px;
  right: 2px;
  cursor: pointer;
  color: #FFCE00;
  font-size: 16px;
}
/* update status */
#updatestatus {
  background-color: rgba(8, 48, 78, 0.9);
  border-bottom: 0;
  border-top: 1px solid #20A8B1;
  border-left: 1px solid #20A8B1;
  bottom: 0;
  color: #ffce00;
  font-size:13px;
  padding: 4px;
  position: fixed;
  right: 0;
  z-index: 3002;
  -webkit-box-sizing: border-box;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}
#updatestatus .map {
  margin-left: 8px;
}
#loadlevel {
  background: #FFF;
  color: #000000;
  display: inline-block;
  min-width: 1.8em;
  border: 1px solid #20A8B1;
  border-width: 0 1px;
  margin: -4px 0;
  padding: 4px 0.2em;
}
/* Dialogs
 */
.ui-tooltip, .ui-dialog {
  position: absolute;
  z-index: 9999;
  background-color: rgba(8, 48, 78, 0.9);
  border: 1px solid #20A8B1;
  color: #eee;
  font-size: 13px;
  line-height: 15px;
  padding: 2px 4px;
}
.ui-tooltip {
  max-width: 300px;
}
.ui-widget-overlay {
  height: 100%;
  left: 0;
  position: fixed;
  top: 0;
  width: 100%;
  z-index: 10000;
  background:  #444;
  opacity: 0.6;
}
.ui-modal {
  z-index: 10001 !important;
}
.ui-tooltip {
  z-index: 10002 !important;
}
.ui-tooltip, .ui-dialog a {
  color: #FFCE00;
}
.ui-dialog {
  padding: 0;
  border-radius: 2px;
}
.ui-dialog-modal .ui-dialog-titlebar-close {
  display: none;
}
.ui-dialog-titlebar {
  font-size: 13px;
  line-height: 15px;
  text-align: center;
  padding: 4px;
  background-color: rgba(8, 60, 78, 0.9);
  min-width: 250px;
}
.ui-dialog-title {
  padding: 2px;
  font-weight: bold;
}
.ui-dialog-title-active {
  color: #ffce00;
}
.ui-dialog-title-inactive {
  color: #ffffff;
}
.ui-dialog-titlebar-button {
  position: absolute;
  display: table-cell;
  vertical-align: middle;
  text-align: center;
  width: 17px;
  height: 17px;
  top: 3px;
  cursor: pointer;
  border: 1px solid rgb(32, 168, 177);
  background-color: rgba(0, 0, 0, 0);
  padding: 0;
}
.ui-dialog-titlebar-button:active {
  background-color: rgb(32, 168, 177);
}
.ui-dialog-titlebar-button-close {
  right: 4px;
}
.ui-dialog-titlebar-button-collapse {
  right: 25px;
}
.ui-dialog-titlebar-button-collapse-expanded {
  /* For future changes */
}
.ui-dialog-titlebar-button-collapse-collapsed {
  background-color: rgb(32, 168, 177);
}
.ui-dialog-titlebar-button-collapse::after,
.ui-dialog-titlebar-button-close::after,
.ui-dialog-titlebar-button-close::before {
  content: "";
  position: absolute;
  top: 3px;
  left: 50%;
  width: 11px;
  margin-left: -6px;
  height: 0;
  border-top: 2px solid rgb(32, 168, 177);
}
.ui-dialog-titlebar-button-close::after {
  transform: translateY(3.5px) rotate(45deg);
}
.ui-dialog-titlebar-button-close::before {
  transform: translateY(3.5px) rotate(-45deg);
}
.ui-dialog-titlebar-button.ui-state-active::after,
.ui-dialog-titlebar-button.ui-state-active::before,
.ui-dialog-titlebar-button.ui-dialog-titlebar-button-collapse-collapsed::after,
.ui-dialog-titlebar-button.ui-dialog-titlebar-button-collapse-collapsed::before,
.ui-dialog-titlebar-button:active::after,
.ui-dialog-titlebar-button:active::before {
  border-top-color: rgba(8, 60, 78, 0.9);
}
.ui-dialog-content {
  padding: 12px;
  overflow-y: auto;
  overflow-x: hidden;
  max-height: 600px !important;
  max-width: 700px !important;
  position: relative;
}
.ui-dialog-content-hidden {
  display: none !important;
}
.ui-dialog-buttonpane {
  padding: 6px;
  border-top: 1px solid #20A8B1;
}
.ui-dialog-buttonset {
  text-align: right;
}
.ui-dialog-buttonset button,
.ui-dialog-content button {
  padding: 2px;
  min-width: 40px;
  color: #FFCE00;
  border: 1px solid #FFCE00;
  background-color: rgba(8, 48, 78, 0.9);
}
.ui-dialog-buttonset button:hover {
  text-decoration: underline;
}
.ui-dialog-aboutIITC {
  width: auto !important;
  min-width: 400px !important;
  max-width: 600px !important;
}
td {
  padding: 0;
  vertical-align: top;
}
td + td {
  padding-left: 4px;
}
#qrcode >
 canvas {
  border: 8px solid white;
}
/* redeem results *****************************************************/
.redeemReward {
  font-family: Inconsolata, Consolas, Menlo, "Courier New", monospace;
  list-style-type: none;
  padding: 0;
  font-size: 14px;
}
.redeemReward .itemlevel {
  font-weight: bold;
  text-shadow: 0 0 1px #000; /* L8 is hard to read on blue background */
}
/*
.redeem-result-table {
  font-size: 14px;
  table-layout: fixed;
}
.redeem-result tr >
 td:first-child {
  width: 50px;
  text-align: right;
}
.redeem-result-html {
  font-family: Inconsolata, Consolas, Menlo, "Courier New", monospace;
}
*/
.pl_nudge_date {
  background-color: #724510;
  border-left: 1px solid #ffd652;
  border-bottom: 1px solid #ffd652;
  border-top: 1px solid #ffd652;
  color: #ffd652;
  display: inline-block;
  float: left;
  height: 18px;
  text-align: center;
}
.pl_nudge_pointy_spacer {
  background: no-repeat url(//commondatastorage.googleapis.com/ingress.com/img/nudge_pointy.png);
  display: inline-block;
  float: left;
  height: 20px;
  left: 47px;
  width: 5px;
}
.pl_nudge_player {
  cursor: pointer;
}
.pl_nudge_me {
  color: #ffd652;
}
.RESISTANCE {
  color: #00c2ff;
}
.ALIENS, .ENLIGHTENED {
  color: #28f428;
}
#portal_highlight_select {
  position: absolute;
  top:5px;
  left:10px;
  z-index: 2500;
  font-size:11px;
  background-color:#0E3C46;
  color:#ffce00;
}
.portal_details th, .portal_details td {
  vertical-align: top;
  text-align: left;
}
.portal_details th {
  white-space: nowrap;
  padding-right: 1em;
}
.portal_details tr.padding-top th, .portal_details tr.padding-top td {
  padding-top: 0.7em;
}
#play_button {
  display: none;
}
/** artifact dialog *****************/
table.artifact tr >
 * {
  background: rgba(8, 48, 78, 0.9);
}
table.artifact td.info {
  min-width: 110px; /* min-width for info column, to ensure really long portal names don't crowd things out */
}
table.artifact .portal {
  min-width: 200px; /* min-width for portal names, to ensure really long lists of artifacts don't crowd names out */
}
/* leaflet popups - restyle to match the theme of IITC */
#map .leaflet-popup {
  pointer-events: none;
}
#map .leaflet-popup-content-wrapper {
  border-radius: 0px;
  -webkit-border-radius: 0px;
  border: 1px solid #20A8B1;
  background: #0e3d4e;
  pointer-events: auto;
}
#map .leaflet-popup-content {
  color: #ffce00;
  margin: 5px 8px;
}
#map .leaflet-popup-close-button {
  padding: 2px 1px 0 0;
  font-size: 12px;
  line-height: 8px;
  width: 10px;
  height: 10px;
  pointer-events: auto;
}
#map .leaflet-popup-tip {
  /* change the tip from an arrow to a simple line */
  background: #20A8B1;
  width: 1px;
  height: 20px;
  padding: 0;
  margin: 0 0 0 20px;
  -webkit-transform: none;
  -moz-transform: none;
  -ms-transform: none;
  -o-transform: none;
  transform: none;
}
/* misc */
.no-pointer-events {
  pointer-events: none;
}
.layer_off_warning {
  color: #FFCE00;
  margin: 8px;
  text-align: center;
}
/* region scores */
.cellscore .ui-accordion-header, .cellscore .ui-accordion-content {
    border: 1px solid #20a8b1;
    margin-top: -1px;
    display: block;
}
.cellscore .ui-accordion-header {
    color: #ffce00;
    outline: none
}
.cellscore .ui-accordion-header:before {
    font-size: 18px;
    margin-right: 2px;
    content: "⊞";
}
.cellscore .ui-accordion-header-active:before {
    content: "⊟";
}
g.checkpoint:hover circle {
  fill-opacity: 1;
  stroke-width: 2px;
}
.checkpoint_table {
    border-collapse: collapse;
}
.checkpoint_table td {
    text-align: right;
    padding-left: 10px;
}
.text-overflow-ellipsis {
    display: inline-block;
    overflow: hidden;
    white-space: nowrap;
    text-overflow: ellipsis;
    vertical-align: text-bottom;
    width: 100%;
}
/* tabs */
.ui-tabs-nav {
    display: block;
    border-bottom: 1px solid #20a8b1;
    border-top: 1px solid transparent;
    margin: 3px 0 0;
    padding: 0;
}
.ui-tabs-nav::after {
    content: '';
    clear: left;
    display: block;
    height: 0;
    width: 0;
}
.ui-tabs-nav li {
    list-style: none;
    display: block;
    float:left;
    margin: 0 0 -1px;
    border: 1px solid #20a8b1;
}
.ui-tabs-nav li.ui-tabs-active {
    border-bottom-color: #0F2C3F;
    background: #0F2C3F;
    border-width: 2px 2px 1px;
    font-weight: bold;
    margin: -1px 1px;
}
.ui-tabs-nav a {
    display: inline-block;
    padding: 0.2em 0.7em;
}
.ui-tabs-nav .ui-icon {
    display: inline-block;
    font-size: 0;
    height: 22px;
    overflow: hidden;
    position: relative;
    vertical-align: top;
    width: 16px;
}
.ui-tabs-nav .ui-icon-close::before {
    content: "×";
    font-size: 16px;
    height: 16px;
    position: absolute;
    text-align: center;
    top: 2px;
    vertical-align: baseline;
    width: 16px;
    cursor: pointer;
}
</style>
<style>
/* required styles */
.leaflet-map-pane,
.leaflet-tile,
.leaflet-marker-icon,
.leaflet-marker-shadow,
.leaflet-tile-pane,
.leaflet-tile-container,
.leaflet-overlay-pane,
.leaflet-shadow-pane,
.leaflet-marker-pane,
.leaflet-popup-pane,
.leaflet-overlay-pane svg,
.leaflet-zoom-box,
.leaflet-image-layer,
.leaflet-layer {
    position: absolute;
    left: 0;
    top: 0;
    }
.leaflet-container {
    overflow: hidden;
    -ms-touch-action: none;
    }
.leaflet-tile,
.leaflet-marker-icon,
.leaflet-marker-shadow {
    -webkit-user-select: none;
       -moz-user-select: none;
            user-select: none;
    -webkit-user-drag: none;
    }
.leaflet-marker-icon,
.leaflet-marker-shadow {
    display: block;
    }
/* map is broken in FF if you have max-width: 100% on tiles */
.leaflet-container img {
    max-width: none !important;
    }
/* stupid Android 2 doesn't understand "max-width: none" properly */
.leaflet-container img.leaflet-image-layer {
    max-width: 15000px !important;
    }
.leaflet-tile {
    filter: inherit;
    visibility: hidden;
    }
.leaflet-tile-loaded {
    visibility: inherit;
    }
.leaflet-zoom-box {
    width: 0;
    height: 0;
    }
/* workaround for https://bugzilla.mozilla.org/show_bug.cgi?id=888319 */
.leaflet-overlay-pane svg {
    -moz-user-select: none;
    }
.leaflet-tile-pane    { z-index: 2; }
.leaflet-objects-pane { z-index: 3; }
.leaflet-overlay-pane { z-index: 4; }
.leaflet-shadow-pane  { z-index: 5; }
.leaflet-marker-pane  { z-index: 6; }
.leaflet-popup-pane   { z-index: 7; }
.leaflet-vml-shape {
    width: 1px;
    height: 1px;
    }
.lvml {
    behavior: url(#default#VML);
    display: inline-block;
    position: absolute;
    }
/* control positioning */
.leaflet-control {
    position: relative;
    z-index: 7;
    pointer-events: auto;
    }
.leaflet-top,
.leaflet-bottom {
    position: absolute;
    z-index: 1000;
    pointer-events: none;
    }
.leaflet-top {
    top: 0;
    }
.leaflet-right {
    right: 0;
    }
.leaflet-bottom {
    bottom: 0;
    }
.leaflet-left {
    left: 0;
    }
.leaflet-control {
    float: left;
    clear: both;
    }
.leaflet-right .leaflet-control {
    float: right;
    }
.leaflet-top .leaflet-control {
    margin-top: 10px;
    }
.leaflet-bottom .leaflet-control {
    margin-bottom: 10px;
    }
.leaflet-left .leaflet-control {
    margin-left: 10px;
    }
.leaflet-right .leaflet-control {
    margin-right: 10px;
    }
/* zoom and fade animations */
.leaflet-fade-anim .leaflet-tile,
.leaflet-fade-anim .leaflet-popup {
    opacity: 0;
    -webkit-transition: opacity 0.2s linear;
       -moz-transition: opacity 0.2s linear;
         -o-transition: opacity 0.2s linear;
            transition: opacity 0.2s linear;
    }
.leaflet-fade-anim .leaflet-tile-loaded,
.leaflet-fade-anim .leaflet-map-pane .leaflet-popup {
    opacity: 1;
    }
.leaflet-zoom-anim .leaflet-zoom-animated {
    -webkit-transition: -webkit-transform 0.25s cubic-bezier(0,0,0.25,1);
       -moz-transition:    -moz-transform 0.25s cubic-bezier(0,0,0.25,1);
         -o-transition:      -o-transform 0.25s cubic-bezier(0,0,0.25,1);
            transition:         transform 0.25s cubic-bezier(0,0,0.25,1);
    }
.leaflet-zoom-anim .leaflet-tile,
.leaflet-pan-anim .leaflet-tile,
.leaflet-touching .leaflet-zoom-animated {
    -webkit-transition: none;
       -moz-transition: none;
         -o-transition: none;
            transition: none;
    }
.leaflet-zoom-anim .leaflet-zoom-hide {
    visibility: hidden;
    }
/* cursors */
.leaflet-clickable {
    cursor: pointer;
    }
.leaflet-container {
    cursor: -webkit-grab;
    cursor:    -moz-grab;
    }
.leaflet-popup-pane,
.leaflet-control {
    cursor: auto;
    }
.leaflet-dragging .leaflet-container,
.leaflet-dragging .leaflet-clickable {
    cursor: move;
    cursor: -webkit-grabbing;
    cursor:    -moz-grabbing;
    }
/* visual tweaks */
.leaflet-container {
    background: #ddd;
    outline: 0;
    }
.leaflet-container a {
    color: #0078A8;
    }
.leaflet-container a.leaflet-active {
    outline: 2px solid orange;
    }
.leaflet-zoom-box {
    border: 2px dotted #38f;
    background: rgba(255,255,255,0.5);
    }
/* general typography */
.leaflet-container {
    font: 12px/1.5 "Helvetica Neue", Arial, Helvetica, sans-serif;
    }
/* general toolbar styles */
.leaflet-bar {
    box-shadow: 0 1px 5px rgba(0,0,0,0.65);
    border-radius: 4px;
    }
.leaflet-bar a,
.leaflet-bar a:hover {
    background-color: #fff;
    border-bottom: 1px solid #ccc;
    width: 26px;
    height: 26px;
    line-height: 26px;
    display: block;
    text-align: center;
    text-decoration: none;
    color: black;
    }
.leaflet-bar a,
.leaflet-control-layers-toggle {
    background-position: 50% 50%;
    background-repeat: no-repeat;
    display: block;
    }
.leaflet-bar a:hover {
    background-color: #f4f4f4;
    }
.leaflet-bar a:first-child {
    border-top-left-radius: 4px;
    border-top-right-radius: 4px;
    }
.leaflet-bar a:last-child {
    border-bottom-left-radius: 4px;
    border-bottom-right-radius: 4px;
    border-bottom: none;
    }
.leaflet-bar a.leaflet-disabled {
    cursor: default;
    background-color: #f4f4f4;
    color: #bbb;
    }
.leaflet-touch .leaflet-bar a {
    width: 30px;
    height: 30px;
    line-height: 30px;
    }
/* zoom control */
.leaflet-control-zoom-in,
.leaflet-control-zoom-out {
    font: bold 18px 'Lucida Console', Monaco, monospace;
    text-indent: 1px;
    }
.leaflet-control-zoom-out {
    font-size: 20px;
    }
.leaflet-touch .leaflet-control-zoom-in {
    font-size: 22px;
    }
.leaflet-touch .leaflet-control-zoom-out {
    font-size: 24px;
    }
/* layers control */
.leaflet-control-layers {
    box-shadow: 0 1px 5px rgba(0,0,0,0.4);
    background: #fff;
    border-radius: 5px;
    }
.leaflet-control-layers-toggle {
    background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAaCAYAAACpSkzOAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAVbSURBVEiJrZZfSFt3FMe/v3tvbmLUZleNKSHE/LGRiNbGRovTtrA9lcFkpcOnMvawwhhjrb3soQ8djGFhXMQNRqEvY3R9kJVuPpRRWQebcdKYxkaHqcHchKJ2rVo1WhNz//z2UOLUadVuv9fvOedzfuec3x9CKcV+1qVLlwgAdHV17cuR7AfU29tb43a73wWAVCr1Q0dHx8T/Curu7i5ubGw843K5ms1mMwBgdXUV6XQ6HI1Gb3Z2dj7/z6C+vr6T1dXVp6xWa+l2+uzs7PLk5OTP7e3tv70S6Pr1647q6uoOt9vtYRjmpcnouo5UKiVPTk72nj17dmpPIEmS+IaGhnaPx3O8tLSU3ahRSotyudzrAGAymf4ghGQ36svLy5osywOxWKxPFMX8jqBbt241ejyed+x2e9nWjPL5fK2iKC2UUiMAEELWDAbDEM/z41ttZ2Zmnsmy/OPp06ejm0DXrl2rqK2tPeNyuQ7zPL9pi5qmVaytrZ3Qdf3gdiVhGOYvo9H4O8uyc1sSI+l0enR8fPzmuXPn5sjt27ff8nq9bwiCYNpSJsPa2lqzqqr1AF7eJEDnOG7MaDSGCSHKRmFhYSGXTCZ/Zd1u93dOp3NJEAS9ICqK4snlcm/puu4EQHaBAADRdf2gqqo1hJBllmUXCsLjx4+L7t69e4Ztamqaffjw4QepVOr5oUOHDKqqvqkoShAAvwfA1sVrmlataVqlqqqzvb29lnA43KwoymeEUoqenp7XdF3vW11dPX7s2DHi9XpfgfHPSiaTuHfvHjWbzQMMw7SfP39+kUSj0ZOU0qsA/EtLSwiHwygpKUFraysOHDiwL0Amk8Hg4CBWVlbQ3NwMi8UCAHFCyIesw+H43uFwuAwGg9lkMsHj8SCfzyMUCkFRFNhsNux2YDVNQzQaRSgUgsvlwtGjR2EyvZitbDbL9Pf3H2YDgcD8xMREk67rCZvN5iSEkLKyMrjdbsiyjJGREVgslh13NzU1hf7+fui6jra2NlitVhBCQCmlo6OjoYGBASWbzX5BKKW4cuWKhRDyk67rJ4LBIFNRUbEeaHZ2FpFIBDabDS0tLSgqKipkiqGhITx58gTBYBBWq3XdZ25uDpFIhLIsO8jzfPuFCxeekTt37rQCuAqgfmVlBfF4HOXl5Thy5Ah4/sXgUUoRj8chyzIaGhoAALFYDB6PB36/H4S8OAH5fB4PHjzA/Pw8/H4/SkpKACAB4CPW6/XeqKysrOI4rpjnedjtdmSzWUSjURgMBgiCAEIIrFYrHA4HxsfHsbi4iNbWVtjt9nWILMsYGhpCeXk5ampqYDQaC3AyPDxcSy5evPg2IaTL6XTO+3y+NkIIAwCKoiCRSEBVVTQ1Ne3Yo0wmg+HhYXAcB5/PB4PBUJBoMpkclGW5lFJ6mVBKIYpiMYDLHMedCgQCnCAI/oL1wsICEokEHA4H6uvr1ydQ13WMjY1hamoKPp8PgiBshE/ev38/oyjKLwA+lyTp+abbWxTFOgDfCIKAQCAQ4DiutNCjdDqNp0+fIhAIAABGRkZQWVkJl8u1Xj5N01Zjsdjw3NwcBfCxJEl/FmL/6z0SRZEAeJ8QIvp8vsWqqqqWgpbL5RCPxwEAfr9//awAwPT0dDgejxfput4D4FtJkjYF3vGFFUWxHMCXRqPxcDAYtBYXF1dtZ5fNZmcikcijbDY7DuBTSZLmt7Pb9c8gimIbIeQrm82Wqaura2EYxggAlFI1Ho8PTk9PmymlnZIkhV4WZ0+/IFEUOQCdDMO8V19fn2NZ1hCLxaimaTcAdEuSpO4WY1//OlEUnQC+BkABfCJJ0qO9+v4NmO9xnZob3WcAAAAASUVORK5CYII=);
    width: 36px;
    height: 36px;
    }
.leaflet-retina .leaflet-control-layers-toggle {
    background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADQAAAA0CAYAAADFeBvrAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAbrwAAG68BXhqRHAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAArPSURBVGiB3Zp7TFvXHce/916/eBhCDInJwDjGBhvjQHi5SclaKRL5Z1Wl/rEq/WNr11TJmkpMw900pLVrplJ1cadFarp0zdZmmpZpf3SqNrUKfSnKgwI2sQPGBmNjAsUOxCW8bGzfe8/+SEAkMfa1A5m075/2+f3O+Z7X595zLkUIwf+T6EdRSWdnp7izs1P8KOqitnqE3n///QMajeYZAPD7/R8fPXr00lbWt2WGTp48qdRoNC/s2bNHXVhYyALA/Py86Pr16wG/3//hq6++GtqKejfdUGdnJ6XT6Q4bDIZWjUaTNLnf76fcbvdlr9d7vqura1MbsKmGTp8+XadWqw/v3bu3UCQS8anKsixLX7t2bT4QCJw/fvy4c7PasCmGTpw4Ia+qqnrRZDIZSkpK2ExiZ2dnRYODg+7R0dE/v/baa4sP25aHNnT27Nkf6HS6QwaD4aF2TLfbzXu93gtHjhz5z8PkydrQqVOnKtVq9Y/q6uqUubm5GY3KRopEIiKn0xkKBAJ/bW9v92WTI2NDnZ2dYoPB8ILRaGwoKyvjsqk0naamphiXyzXgdrs/7OrqSmQSm5GhM2fOHNBoNM/U1dVJKYoSFEgIEcVisWYAkEql/RRFCRpNQgjldDpjfr//42PHjglmlyBDJ0+eVO7evfsndXV1FatMEaJEIqGOx+MHCCFyAKAoalEikVwSi8UBoTnm5+dFTqdzYnx8/C9C2JXS0CpT9Hr9gcrKypTb8HrxPJ+/srJygOf53cn+p2l6XCaTXaJpekloTp/PR3s8nkvp2LWhoXfffbderVYfbmhoKEjHlPVtjcVidSzLNhFCUj67URSVEIlENqlU6gQgKD/LsvTAwMBCIBA4/8orrziS5r3f0IkTJ+Q6ne6IyWQy7NixQ/CCZFm2NB6PP8Hz/HahMQBA0/R3EonkokgkCgqNmZmZEQ8ODrq9Xu/Z+9l1j6EPPvjgKZ1Od6impoYSmpzneVksFtvHcZxBaEwyMQzjlkqlPTRNrwiNGR4eJl6v98JLL73079XfKEIITp06VVlRUfHj+vr6nZkwJR6P6xOJxH5CiCxTA8lEUdSKWCy+KpFIPEJjIpGIyOFw3JyYmDjX3t7uo86dO3fUaDQ2lJeXCzbCcdz2WCz2BM/zpdk1PbVomg5KpdKLDMN8JzRmcnJS5HK5Bhi9Xv9RcXHx7V27dqUd6rtMMcfj8YOEkIKHa3bKeuQsy9bwPC9mGCZEUVTaTWNsbKzQbrc/RXV0dBAAMYVCcfnpp5+eKC4uTmrsfqY8KqVj161bt2SffPJJRTgcbgUgZVpbW3sIIQei0Wij0+ksmZubW9DpdEsUdWdf4Hk+PxqNHmRZtgWA9NFZWZOU4zgdy7LFd0crDgCEEHz66aelX3zxxfcjkUg9gAmapg8zV65c8fX09PwpHo/zhJC22dnZ2oGBARQUFCwVFBTUxOPxQ4QQxf/AyD0ihBSxLFtDCCFerzdy/vz5PcFg8CAhRAqgSy6XP/fmm2+O3LNtd3R0VFEU9R6AgyKRiNfr9fS+ffsgFj+S8420SiQS6Onpgcfj4VmWpQF8SQh5+Z133hldLSNaH/Dss8+GGYYJ3Lhxg9jtdnpoaAiTk5NoampCdXX1IzewXiMjI7DZbJifn4dMJqPNZjNRqVQBjuPC68utjhA1MDDwPIDfASgG7vSGw+HA2NgYAEClUmH//v0oKip6pEbm5uZw9epV3LhxAwCg1WpRX1+/ftbcAvCLhoaGjwAQyuFwGDmOOwOgNVnCcDiMvr4+zM3NQSaTwWg0orm5GTS9tUd6PM+jv78fLpcLKysrKCoqQktLCxSKDZfzZYZhjjFarfYfKpWqmabppAslNzcXWq0WMpkMwWAQU1NTCAQCyM/Px7Zt27bEzMTEBD7//HP4fD5QFIWGhgaYzWbk5uZuGMNxXPHXX39tYkwm07nh4eGZ3Nxcz/bt27+XrDBFUVAoFNBoNIhEIggGg/D5fLh9+zaUSuWmbRqRSAQXL15EX18flpeXoVKp8OSTT0KpVGIVI8nk8/n6uru7xYuLi3WrHDr07bffmvx+f295eTktkUiSwlMsFkOlUqGkpAQzMzMIBoPwer0AAKVS+VBmHA4HvvrqK4RCIeTl5aG1tRU1NTUpO2t5eXn6s88+Gx4fHzcDmKVp+jBFCMEbb7whW1xc/BWAXwJgKysrbS0tLY9TFCXaKBnP8xgaGoLb7QbHcSgtLcW+ffsyNhYKhdDT04NgMAiGYWAwGFBbW5tyjRJC2L6+vis+n68Jd3bqt+Vy+Vuvv/76yoYcysvLi5nNZmm6Bi4sLMBmsyEUCkEsFkOv1+Oxxx5LOw0TiQS++eYbeDweJBIJKJVKNDU1oaAg9SNiKBRCb28vu7y8LEISDt1jqLu7ezuAt0Oh0IsjIyNUPB5HeXk5mpubIZWmfuqZmJiA3W7HysoKCgsLU7LrPqagsbERFRUVKfPHYjH09/djcnISEokE1dXVUCqV/wLQ3tbWNvmAoe7u7ucBnMRdDrEsC6/Xu5bAZDKhqqoq5eJMxy4BTHlAhBCMjo5icHAQqx2s0+kgEq2thiUAvwFwqq2tjaUuXLhQA+CPAL6fLOHCwgJcLhcWFxeFsADAg+yqra0FAAwNDQllygN55HI5jEZjqil5HcBPmerq6r/t2LFjL8MwOclKSaVSlJWVQSKRIBQKwefzIRqNYufOnRsu3GTsmp6eFswUlmVht9ths9mQSCRQVVUFo9EImWzjF2OO4+ROp1NPdXR0JAAsaLVat0ajeXzDCNyZxx6PBzdv3kROTg727t0LtVqdKgTRaBR2ux0A0NjYiJycpP22pkAggGvXrq11ml6vT7t+p6en+10uVykhpIzq6OhoA/AegEqxWOxsamrKl8vllakShMNhDA8Pr1VqNpuRn5+fstJ0WlpaQm9v71pn1dTUpJ2S0Wh02mazTUajUTMAH4CXKUIILBaLDMAqh+iSkpIre/bsaWEYZsN5wfM8/H4/AoEAKIqCwWCAyWRKuWkkEyEEg4ODcLvdIIRArVZDo9Gk5ZDb7b4yNTW1xiEAb1mt1ns5ZLFYqnBntA5SFDVlNBqDu3btak7VoOXlZXg8HoTDYeTn56OlpUUwXEOhEPr6+rC0tASFQgG9Xo+8vLyUMeFweNDhcEg5jqsC8CWAl61Wa3IOrTP2HIDfA9iZk5PT29TUVJ6Tk7MrXeNGRkYghF0bMCWlkUQiMWe324cWFhZaAcwA+LnVav37/eU2PAq2WCyFALoAHAMQLSsrsxkMhpSPQ+nYJYApSeX3+y+PjY3VANgG4AyATqvVOp+sbNrbB4vF0nw3SQPDMKP19fUxhUJhShWTjF0AMmEKAGBxcdFns9mWEolEHYABAMesVmt/qhhB1ykWi4UBcBzAbwHICwoKLjc2NtaKxeINX18JIZicnMTY2Bh4/s6xGk3T0Gq1KC8vT7l5cBwXuX79et/s7OzjAKIAfg3gtNVqTXvBltGFl8ViKQXwBwA/BPCdVqsd1mg0Sd90V7XKLgAZMwXAPwH8zGq1Cj7Iz+qO1WKxZMyudErGFKvV2p1pnqwvjbNhVzKlYko27Xroa/1s2LWqdEzJRpv2JUkm7BLKlGy0qZ/GCGFXJkzJRlvyNVYydkkkktxMmZKNtuzzsvvZBYADEEEGTMlGW/4B4Dp2ARkyJRv9F9vsxWD/43R9AAAAAElFTkSuQmCC);
    background-size: 26px 26px;
    }
.leaflet-touch .leaflet-control-layers-toggle {
    width: 44px;
    height: 44px;
    }
.leaflet-control-layers .leaflet-control-layers-list,
.leaflet-control-layers-expanded .leaflet-control-layers-toggle {
    display: none;
    }
.leaflet-control-layers-expanded .leaflet-control-layers-list {
    display: block;
    position: relative;
    }
.leaflet-control-layers-expanded {
    padding: 6px 10px 6px 6px;
    color: #333;
    background: #fff;
    }
.leaflet-control-layers-selector {
    margin-top: 2px;
    position: relative;
    top: 1px;
    }
.leaflet-control-layers label {
    display: block;
    }
.leaflet-control-layers-separator {
    height: 0;
    border-top: 1px solid #ddd;
    margin: 5px -10px 5px -6px;
    }
/* attribution and scale controls */
.leaflet-container .leaflet-control-attribution {
    background: #fff;
    background: rgba(255, 255, 255, 0.7);
    margin: 0;
    }
.leaflet-control-attribution,
.leaflet-control-scale-line {
    padding: 0 5px;
    color: #333;
    }
.leaflet-control-attribution a {
    text-decoration: none;
    }
.leaflet-control-attribution a:hover {
    text-decoration: underline;
    }
.leaflet-container .leaflet-control-attribution,
.leaflet-container .leaflet-control-scale {
    font-size: 11px;
    }
.leaflet-left .leaflet-control-scale {
    margin-left: 5px;
    }
.leaflet-bottom .leaflet-control-scale {
    margin-bottom: 5px;
    }
.leaflet-control-scale-line {
    border: 2px solid #777;
    border-top: none;
    line-height: 1.1;
    padding: 2px 5px 1px;
    font-size: 11px;
    white-space: nowrap;
    overflow: hidden;
    -moz-box-sizing: content-box;
         box-sizing: content-box;
    background: #fff;
    background: rgba(255, 255, 255, 0.5);
    }
.leaflet-control-scale-line:not(:first-child) {
    border-top: 2px solid #777;
    border-bottom: none;
    margin-top: -2px;
    }
.leaflet-control-scale-line:not(:first-child):not(:last-child) {
    border-bottom: 2px solid #777;
    }
.leaflet-touch .leaflet-control-attribution,
.leaflet-touch .leaflet-control-layers,
.leaflet-touch .leaflet-bar {
    box-shadow: none;
    }
.leaflet-touch .leaflet-control-layers,
.leaflet-touch .leaflet-bar {
    border: 2px solid rgba(0,0,0,0.2);
    background-clip: padding-box;
    }
/* popup */
.leaflet-popup {
    position: absolute;
    text-align: center;
    }
.leaflet-popup-content-wrapper {
    padding: 1px;
    text-align: left;
    border-radius: 12px;
    }
.leaflet-popup-content {
    margin: 13px 19px;
    line-height: 1.4;
    }
.leaflet-popup-content p {
    margin: 18px 0;
    }
.leaflet-popup-tip-container {
    margin: 0 auto;
    width: 40px;
    height: 20px;
    position: relative;
    overflow: hidden;
    }
.leaflet-popup-tip {
    width: 17px;
    height: 17px;
    padding: 1px;
    margin: -10px auto 0;
    -webkit-transform: rotate(45deg);
       -moz-transform: rotate(45deg);
        -ms-transform: rotate(45deg);
         -o-transform: rotate(45deg);
            transform: rotate(45deg);
    }
.leaflet-popup-content-wrapper,
.leaflet-popup-tip {
    background: white;
    box-shadow: 0 3px 14px rgba(0,0,0,0.4);
    }
.leaflet-container a.leaflet-popup-close-button {
    position: absolute;
    top: 0;
    right: 0;
    padding: 4px 4px 0 0;
    text-align: center;
    width: 18px;
    height: 14px;
    font: 16px/14px Tahoma, Verdana, sans-serif;
    color: #c3c3c3;
    text-decoration: none;
    font-weight: bold;
    background: transparent;
    }
.leaflet-container a.leaflet-popup-close-button:hover {
    color: #999;
    }
.leaflet-popup-scrolled {
    overflow: auto;
    border-bottom: 1px solid #ddd;
    border-top: 1px solid #ddd;
    }
.leaflet-oldie .leaflet-popup-content-wrapper {
    zoom: 1;
    }
.leaflet-oldie .leaflet-popup-tip {
    width: 24px;
    margin: 0 auto;
    -ms-filter: "progid:DXImageTransform.Microsoft.Matrix(M11=0.70710678, M12=0.70710678, M21=-0.70710678, M22=0.70710678)";
    filter: progid:DXImageTransform.Microsoft.Matrix(M11=0.70710678, M12=0.70710678, M21=-0.70710678, M22=0.70710678);
    }
.leaflet-oldie .leaflet-popup-tip-container {
    margin-top: -1px;
    }
.leaflet-oldie .leaflet-control-zoom,
.leaflet-oldie .leaflet-control-layers,
.leaflet-oldie .leaflet-popup-content-wrapper,
.leaflet-oldie .leaflet-popup-tip {
    border: 1px solid #999;
    }
/* div icon */
.leaflet-div-icon {
    background: #fff;
    border: 1px solid #666;
    }
</style>
<link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Roboto:100,100italic,300,300italic,400,400italic,500,500italic,700,700italic&amp;subset=latin,cyrillic-ext,greek-ext,greek,vietnamese,latin-ext,cyrillic">
<style>
#largepreview.enl img { border:2px solid #03DC03; }
#largepreview.res img { border:2px solid #0088FF; }
#largepreview.none img { border:2px solid #FF6600; }
#chatcontrols { bottom: 82px; }
#chat { height: 60px; }
.leaflet-right { margin-right: 301px }
#updatestatus { width:302px;  }
#sidebar { width:321px;  }
#sidebartoggle { right:301px;  }
#scrollwrapper  { width:340px; right:-38px }
#sidebar >
 * { width:301px;  }
</style>
<style type="text/css">
#keys-content-outer {
  display: table;
  width: 100%;
  height: 26px;
  text-align: center;
}
#keys-content-outer >
 div{
  display: inline-block;
  vertical-align: middle;
  margin: 6px 3px 1px 3px;
}
#keys-label {
  padding: 0 4px;
  cursor: help;
}
#keys-add {
}
#keys-count {
  width: 26px;
  height: 18px !important;
  border: 1px solid;
  text-align: center;
  cursor: help;
}
#keys-subtract {
}
.keys-button {
  position:relative;
  width: 16px;
  height: 16px !important;
}
.keys-button >
 div {
  background-color: rgb(32, 168, 177);
  position: absolute;
}
.keys-button-minus {
  width: 100%;
  height: 4px;
  top: 6px;
}
.keys-button-plus-h {
  width: 100%;
  height: 4px;
  top: 6px;
}
.keys-button-plus-v {
  width: 4px;
  height: 100%;
  left: 6px;
}
#keys-help {
  font-weight: 900;
  margin: 6px 3px 1px 20px !important;
  cursor: help;
}
.portal-list-keys button {
  font-family: monospace;
  font-size: 0.9em;
  text-align: center;
  vertical-align: middle;
  min-width: 0;
  padding: 0;
  width: 1.5em;
  margin: -6px 0 -3px;
}
#portalslist.mobile .portal-list-keys button {
  width: 3em;
  height: 1.5em;
}
.portal-list-keys .plus {
  margin-left: 0.3em;
  margin-right: -1px;
}
</style>
<style>
.max-links-error { color: #F88; font-size: 20px; font-weight: bold; text-align: center; text-shadow: -1px -1px #000, 1px -1px #000, -1px 1px #000, 1px 1px #000; background-color: rgba(0,0,0,0.6); border-radius: 5px; }
</style>
<style type="text/css">
.plugin-portal-level-numbers {            font-size: 10px;            color: #FFFFBB;            font-family: monospace;            text-align: center;            text-shadow: 0 0 0.5em black, 0 0 0.5em black, 0 0 0.5em black;            pointer-events: none;            -webkit-text-size-adjust:none;          }
</style>
<style type="text/css">
#uniques-container {
  display: block;
  text-align: center;
  margin: 6px 3px 1px 3px;
  padding: 0 4px;
}
#uniques-container label {
  margin: 0 0.5em;
}
#uniques-container input {
  vertical-align: middle;
}
.portal-list-uniques input[type='checkbox'] {
  padding: 0;
  height: auto;
  margin-top: -5px;
  margin-bottom: -5px;
}
</style>
<style>
.ui-dialog-rawdata {width: auto !important;min-width: 400px !important;}#dialog-rawdata {overflow-x: auto;overflow-y: auto;}
</style>
<style type="text/css">
#portalslist.mobile {
  background: transparent;
  border: 0 none !important;
  height: 100% !important;
  width: 100% !important;
  left: 0 !important;
  top: 0 !important;
  position: absolute;
  overflow: auto;
}
#portalslist table {
  margin-top: 5px;
  border-collapse: collapse;
  empty-cells: show;
  width: 100%;
  clear: both;
}
#portalslist table td, #portalslist table th {
  background-color: #1b415e;
  border-bottom: 1px solid #0b314e;
  color: white;
  padding: 3px;
}
#portalslist table th {
  text-align: center;
}
#portalslist table .alignR {
  text-align: right;
}
#portalslist table.portals td {
  white-space: nowrap;
}
#portalslist table th.sortable {
  cursor: pointer;
}
#portalslist table .portalTitle {
  min-width: 120px !important;
  max-width: 240px !important;
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
}
#portalslist .sorted {
  color: #FFCE00;
}
#portalslist table.filter {
  table-layout: fixed;
  cursor: pointer;
  border-collapse: separate;
  border-spacing: 1px;
}
#portalslist table.filter th {
  text-align: left;
  padding-left: 0.3em;
  overflow: hidden;
  text-overflow: ellipsis;
}
#portalslist table.filter td {
  text-align: right;
  padding-right: 0.3em;
  overflow: hidden;
  text-overflow: ellipsis;
}
#portalslist .filterNeu {
  background-color: #666;
}
#portalslist table tr.res td, #portalslist .filterRes {
  background-color: #005684;
}
#portalslist table tr.enl td, #portalslist .filterEnl {
  background-color: #017f01;
}
#portalslist table tr.none td {
  background-color: #000;
}
#portalslist .disclaimer {
  margin-top: 10px;
  font-size: 10px;
}
#portalslist.mobile table.filter tr {
  display: block;
  text-align: center;
}
#portalslist.mobile table.filter th, #portalslist.mobile table.filter td {
  display: inline-block;
  width: 22%;
}
</style>
<style type="text/css">
.plugin-mission-pane {
    background: transparent;
    border: 0 none !important;
    height: 100% !important;
    width: 100% !important;
    left: 0 !important;
    top: 0 !important;
    position: absolute;
    overflow: auto;
}
.plugin-mission-pane >
 button {
    padding: 0.3em 2em;
}
.plugin-mission-summary {
    padding: 5px;
    border-top: black solid 1px;
    min-height: 50px;
    position: relative;
    clear: left;
}
.plugin-mission-summary.checked::after {
    content: "✓";
    display: block;
    pointer-events: none;
    position: absolute;
    text-align: center;
    color: rgba(255, 187, 0, 0.3);
    left: 5px;
    top: 5px;
    font-size: 50px;
    line-height: 50px;
    width: 50px;
}
.plugin-mission-summary:first-child {
    border-top-width: 0px;
}
.plugin-mission-summary.checked {
    background-color: rgba(255, 187, 0, 0.3);
}
.plugin-mission-summary >
 img {
    float: left;
    cursor: pointer;
    width: 50px;
    margin-right: 10px;
    margin-bottom: 5px;
}
.plugin-mission-summary >
 a {
    display: block;
    font-weight: bold;
    font-size: 1.3em;
    margin: 0 0 2px 60px;
}
.plugin-mission-summary >
 br {
    margin-bottom: 2px;
}
.plugin-mission-summary >
 .nickname {
    display: inline-block;
    box-sizing: border-box;
    min-width: 8em; /* to align with time */
    padding-right: 0.2em;
}
.plugin-mission-info .portal-distance-bearing {
    font-size: 14px;
    margin-right: 8px;
    color: #b2fbff;
}
.plugin-mission-info {
    display: inline-block;
}
.plugin-mission-info.length   { min-width: 6em; }
.plugin-mission-info.distance { min-width: 6em; }
.plugin-mission-info.time     { min-width: 8em; }
.plugin-mission-info.rating   { min-width: 6em; }
.plugin-mission-info.players  { min-width: 4em; }
.plugin-mission-info.type     { min-width: 4em; }
.plugin-mission-info img {
    height: 14px;
    margin-right: 8px;
    vertical-align: top;
}
.plugin-mission-info.players img {
    padding: 0 3px; /* the icon is 12x18 */
}
.plugin-mission-details .plugin-mission-summary >
 a,
.plugin-mission-details .plugin-mission-summary .description {
    white-space: pre-line;
    margin-left: 110px;
}
.plugin-mission-details .plugin-mission-summary.checked::after {
    left: 0px;
    top: 0px;
    font-size: 100px;
    line-height: 100px;
    width: 100px;
}
.plugin-mission-details .plugin-mission-summary {
    padding: 0;
    background-color: transparent;
}
.plugin-mission-details .plugin-mission-summary >
 img {
    width: 100px;
}
.plugin-mission-details ol {
    clear: left;
    list-style: none;
    margin: 10px 0 0;
    padding: 0;
}
.plugin-mission-portal-indicator {
    position: relative;
    text-align: center;
    float: left;
    line-height: 18px;
    height: 18px;
    width: 18px;
    margin-right: 5px;
}
.plugin-mission-portal-indicator div {
    border-color: currentcolor transparent transparent;
    border-style: solid;
    border-width: 2px 1px;
    box-sizing: border-box;
    height: 0;
    left: 6px;
    position: absolute;
    top: 0;
    /* Firefox supports transform* without vendor prefix, but Android does not yet */
    transform-origin: 4px 9px 0;
    -webkit-transform-origin: 4px 9px 0;
    width: 8px;
}
.plugin-mission-waypoint.unavailable {
    text-decoration: line-through;
}
.plugin-mission-waypoint .title {
    font-size: 18px;
    font-weight: bold;
}
.plugin-mission-waypoint label {
    clear: left;
    display: block;
}
.plugin-mission-waypoint input {
    box-sizing: border-box;
    margin: 3px 5px 8px 0;
    width: 18px;
}
.plugin-mission-search-result-desc {
    display: block;
    max-height: 2em;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}
</style>
<style type="text/css">
.plugin-portal-names{color:#FFFFBB;font-size:11px;line-height:12px;text-align:center;padding: 2px;overflow:hidden;text-shadow:1px 1px #000,1px -1px #000,-1px 1px #000,-1px -1px #000, 0 0 5px #000;pointer-events:none;}
</style>
<style type="text/css">
.sync-authButton-dimmed {            opacity: 0.5;          }          .sync-show-dialog-error {            color: #FF2222;          }          #sync-log {            height: 300px;            white-space: pre-wrap;            white-space: -moz-pre-wrap;            white-space: -o-pre-wrap;            word-wrap: break-word;            overflow-y: auto;          }
</style>
<style>
.drawtoolsSetbox >
 a { display:block; color:#ffce00; border:1px solid #ffce00; padding:3px 0; margin:10px auto; width:80%; text-align:center; background:rgba(8,48,78,.9); }.ui-dialog-drawtoolsSet-copy textarea { width:96%; height:250px; resize:vertical; }
</style>
<style>
/* ================================================================== */
/* Toolbars
/* ================================================================== */
.leaflet-draw-section {
    position: relative;
}
.leaflet-draw-toolbar {
    margin-top: 12px;
}
.leaflet-draw-toolbar-top {
    margin-top: 0;
}
.leaflet-draw-toolbar-notop a:first-child {
    border-top-right-radius: 0;
}
.leaflet-draw-toolbar-nobottom a:last-child {
    border-bottom-right-radius: 0;
}
.leaflet-draw-toolbar a {
    background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAANIAAAAeCAYAAABZs0CNAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAtVJREFUeNrsmlFy2jAQhkWG93CD0hM0PUHhhdfADeAECScInAA4QblBeOYFcoK6Jyg5QdwTtLvp747GhNgmWttx/m/GY42s8Uqy/l1JlnOEEEIIIYQQQgghhBBCCCGEHNNiF5C6MxgMOnIbb7fbpcG7Z3K7S2XPxdasyHvaASv0J0lLJVpGDb6Ra4OGHho+eLpyG8rVQVasbbduNwat2u0i6wC7sbHNq3S+2Nzj2U6fS/qL5E0MqvBfOBhn1UQkNPZJBaSCCi0keedYbt9T2WtLQfmO4TWMnMat3BYnHk8tPDPs6mC+90TkPDGNxG5kICC113vhsX7fKdLaFzoGJlKHtVEUyhSZqZB8j2ExuE6IyFxQVQkpQ0RmYsJ3/AERafRZ4dENoqL279eQkUls7iCiA64EFewc40rp6/jSCFXXGUQ7oIi08f3AHZ0lIgdPNW7Ceg/TuUWOogspG3qa50/n+kn0UTuewIZwXKF4FpHY+pzhnHtSZlPC2uisaPQmIdVERE1jWLBsyKjU9aJs5KflWxyVCcgmQ0STVLQKujYK9aKLOooIFBFR1BAhdYzKnrNWOkoLlwbmfmeIKPKmeLXloqYicgWnEHFDhPSpQtt+H+506oPpjz+IH43rcOuLCBsLQ0unUYmQShRREnbzvvuhIUL6WaHzWKei3R2uzpnO7S0E2Z2rpZBKFpHDQnr1wSLSxqhsnv6OM9YMc8vvjTrMdBf0vYkot5CwFfxUlog8ljlF0og1EpzHNEfRqdH/s+WJhf0h8MaGz3We59jRrC3tAh+5BUGVJaJnLyk2V+71bcrY2e3qVCGmJXbJSv8hi/4eYebhn6gYGX3zvVw9/E96aXr+Dc57X/eTLLn+vVgf/8lh/5f7t/W6h2gekY7KEnUFbe66Co4IwXZywsE5gxMNqeXCqZMNvtiCCzn0fyRCCCGEEEIIIYQQQgghhBBCCCFG/BVgAMuWWtfqVjkMAAAAAElFTkSuQmCC);
    background-repeat: no-repeat;
}
.leaflet-retina .leaflet-draw-toolbar a {
    background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAaQAAAA8CAYAAAApDs6vAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAABV1JREFUeNrs3d1R20AUhmHBUIBLcCqI6UDccA0VYFcAqQBTAbgCQwVwzQ1OBTgVxCU4FZA9ydGMoki2flZmz+p9ZjTBxNaw7M+3KwkpSQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALo54lcAAMN1fn7+Ued9r6+vvefFCdUBAF4G9on7581t39zg/chvJIJAqkrrQ6SzxzJM3T9Lt0mjfHI/+4qmBgwijEbS993rxFooVY2xdVdQrJDCbZhLfSnBNHXfk0C6I5iiquNrt6VuGxf+e+O2VUwTEVfekbblK7dNCv+9lrLK5MuVdxtBOSc13rp1ZV3nPjfOhVHGZCh9tqMAG8VHPq2Lrw3NksqYDybfsyVjK9+xTjbSmh+Rep65Mm4M1/eFlnm0b5DWsr4YK5/U6a3bLmqUMTMrBo3bz1JDO//7OMsHV2x9t48+fBzggB7Dkr2KDGRv7r2ypQmsDczvDcIoq+93/azFMssA+1xzoJb3POtnLPXZdw2SxmEkYaarKhmUZ8nfQ/RBhhErJM8Desgz6ZphVDWDfrK0rB/iCkkD5bnjbi4trR52lFkG22ygnVS0+eDLqiuj94Z9Nh9GWZ/faPhs9fv32qcJI6uBVGdAD3Xg6hBGedKo7ywE09ACqeXAlVQM5KcWDt/prP9nSZmljc4L75XXtyVl/RLyOaWSQ2x/JofaF0vrLwuZkj6/zocS2jsJoGGUDegmlryewkjIoCcnQW9dmb/QLIOy9FC/ie5D9nVmoMzTOmGkE4q5nLwvhFJ2EcRDwGXMH0ZduXKcdejz2YVMl0M6ytHHZPL4k38xhNH/wYRw6jhNmp0z2ic1cp70qmR1MN8xMM213+7aR2jy/fauY5/f1t0HAg0kwqjUhiYZ9MDsw7WBcpdd2r3Pes8+Qrbu0OfNXsAgK5z8Kqfp62gCyXgYjXsKIwIpPKmRfaLbwLz1EUZ6XgqWAslyGKm6l8H2MlPDQY2N7PPQK6a27zGnYRhN6TKGAimCMMp+3r78okkiQCO9mq6qX897nKQRRgQSYbRDnycvVzRJBKCsP96WhVLFZd+xrPbrnjMijDw5yGXfEYWRHG9e6b3pUmOrL6DJxGhSEUrXyf4/jI1lchXNBQyskCIMo75XSTT04GyM7NO3xZ5BOtVt1HIfFhFG1gMp0jBK9OaojwMcqIa4UrCwT9/tW9pil1v/vFi+oWyhrrKNMDqA3g7ZxRpGhVXSlECK2iLxf35gYah9X3T4rHl1796AwFdIAwijbBbpc5XE7Cu8Ol57XtGsrLR//Tnb3PrngZUEPn2FtOf+SLEef81mkT4ueeWS7zDJYwV83Vx1ZrR9jxus8s2tjmQC3XZs4jEyBlZIAwmjbJXk6xDMiuYYbB37CBJzD+rTOxjMGpbRypWi+Z+zy/Oq0op9IoRAKrnfUewnAx88NUQac7gDs5zgv2xZR/KZS2tPUs2VfVUzlGbGnoScrw+5nP0me9heg9XRTfLv32C90Fu6OTlAg476eLLMCF3DXCTlfxxYd2W04bh7+KHk6lnqaFCPMNeyP7qyf3Vf3lRNyiw9ZFIVD7fLg/Xu9VEabSeU3PG7I293bq06h2ThiaCeyi8PNBvveIsMZjIw/dCv15FcGjs4etHOtQZTsc43GkSL2CYZ+njyZcnK6NFwPfq4UbKp0xIhPw/pJIHPGddSByTZvmdfGzuUgXqr/tkAyy0rpU0ulGaW27bUoyvPqR7daHNxkgSRHKa7Y3IJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAjLbwEGABdIk04CWmrYAAAAAElFTkSuQmCC);
    background-size: 210px 30px;
}
.leaflet-draw a {
    display: block;
    text-align: center;
    text-decoration: none;
}
/* ================================================================== */
/* Toolbar actions menu
/* ================================================================== */
.leaflet-draw-actions {
    display: none;
    list-style: none;
    margin: 0;
    padding: 0;
    position: absolute;
    left: 26px; /* leaflet-draw-toolbar.left + leaflet-draw-toolbar.width */
    top: 0;
    white-space: nowrap;
}
.leaflet-right .leaflet-draw-actions {
    right:26px;
    left:auto;
}
.leaflet-draw-actions li {
    display: inline-block;
}
.leaflet-draw-actions li:first-child a {
    border-left: none;
}
.leaflet-draw-actions li:last-child a {
    -webkit-border-radius: 0 4px 4px 0;
            border-radius: 0 4px 4px 0;
}
.leaflet-right .leaflet-draw-actions li:last-child a {
    -webkit-border-radius: 0;
            border-radius: 0;
}
.leaflet-right .leaflet-draw-actions li:first-child a {
    -webkit-border-radius: 4px 0 0 4px;
            border-radius: 4px 0 0 4px;
}
.leaflet-draw-actions a {
    background-color: #919187;
    border-left: 1px solid #AAA;
    color: #FFF;
    font: 11px/19px "Helvetica Neue", Arial, Helvetica, sans-serif;
    line-height: 28px;
    text-decoration: none;
    padding-left: 10px;
    padding-right: 10px;
    height: 28px;
}
.leaflet-draw-actions-bottom {
    margin-top: 0;
}
.leaflet-draw-actions-top {
    margin-top: 1px;
}
.leaflet-draw-actions-top a,
.leaflet-draw-actions-bottom a {
    height: 27px;
    line-height: 27px;
}
.leaflet-draw-actions a:hover {
    background-color: #A0A098;
}
.leaflet-draw-actions-top.leaflet-draw-actions-bottom a {
    height: 26px;
    line-height: 26px;
}
/* ================================================================== */
/* Draw toolbar
/* ================================================================== */
.leaflet-draw-toolbar .leaflet-draw-draw-polyline {
    background-position: -2px -2px;
}
.leaflet-draw-toolbar .leaflet-draw-draw-polygon {
    background-position: -31px -2px;
}
.leaflet-draw-toolbar .leaflet-draw-draw-rectangle {
    background-position: -62px -2px;
}
.leaflet-draw-toolbar .leaflet-draw-draw-circle {
    background-position: -92px -2px;
}
.leaflet-draw-toolbar .leaflet-draw-draw-marker {
    background-position: -122px -2px;
}
/* ================================================================== */
/* Edit toolbar
/* ================================================================== */
.leaflet-draw-toolbar .leaflet-draw-edit-edit {
    background-position: -152px -2px;
}
.leaflet-draw-toolbar .leaflet-draw-edit-remove {
    background-position: -182px -2px;
}
/* ================================================================== */
/* Drawing styles
/* ================================================================== */
.leaflet-mouse-marker {
    background-color: #fff;
    cursor: crosshair;
}
.leaflet-draw-tooltip {
    background: rgb(54, 54, 54);
    background: rgba(0, 0, 0, 0.5);
    border: 1px solid transparent;
    -webkit-border-radius: 4px;
            border-radius: 4px;
    color: #fff;
    font: 12px/18px "Helvetica Neue", Arial, Helvetica, sans-serif;
    margin-left: 20px;
    margin-top: -21px;
    padding: 4px 8px;
    position: absolute;
    white-space: nowrap;
    z-index: 6;
}
.leaflet-draw-tooltip:before {
    border-right: 6px solid black;
    border-right-color: rgba(0, 0, 0, 0.5);
    border-top: 6px solid transparent;
    border-bottom: 6px solid transparent;
    content: "";
    position: absolute;
    top: 7px;
    left: -7px;
}
.leaflet-error-draw-tooltip {
    background-color: #F2DEDE;
    border: 1px solid #E6B6BD;
    color: #B94A48;
}
.leaflet-error-draw-tooltip:before {
    border-right-color: #E6B6BD;
}
.leaflet-draw-tooltip-single {
    margin-top: -12px
}
.leaflet-draw-tooltip-subtext {
    color: #f8d5e4;
}
.leaflet-draw-guide-dash {
    font-size: 1%;
    opacity: 0.6;
    position: absolute;
    width: 5px;
    height: 5px;
}
/* ================================================================== */
/* Edit styles
/* ================================================================== */
.leaflet-edit-marker-selected {
    background: rgba(254, 87, 161, 0.1);
    border: 4px dashed rgba(254, 87, 161, 0.6);
    -webkit-border-radius: 4px;
            border-radius: 4px;
}
.leaflet-edit-move {
    cursor: move;
}
.leaflet-edit-resize {
    cursor: pointer;
}
</style>
<style>
/***
Spectrum Colorpicker v1.2.0
https://github.com/bgrins/spectrum
Author: Brian Grinstead
License: MIT
***/
.sp-container {
    position:absolute;
    top:0;
    left:0;
    display:inline-block;
    *display: inline;
    *zoom: 1;
    /* https://github.com/bgrins/spectrum/issues/40 */
    z-index: 9999994;
    overflow: hidden;
}
.sp-container.sp-flat {
    position: relative;
}
/* http://ansciath.tumblr.com/post/7347495869/css-aspect-ratio */
.sp-top {
  position:relative;
  width: 100%;
  display:inline-block;
}
.sp-top-inner {
   position:absolute;
   top:0;
   left:0;
   bottom:0;
   right:0;
}
.sp-color {
    position: absolute;
    top:0;
    left:0;
    bottom:0;
    right:20%;
}
.sp-hue {
    position: absolute;
    top:0;
    right:0;
    bottom:0;
    left:84%;
    height: 100%;
}
.sp-clear-enabled .sp-hue {
    top:33px;
    height: 77.5%;
}
.sp-fill {
    padding-top: 80%;
}
.sp-sat, .sp-val {
    position: absolute;
    top:0;
    left:0;
    right:0;
    bottom:0;
}
.sp-alpha-enabled .sp-top {
    margin-bottom: 18px;
}
.sp-alpha-enabled .sp-alpha {
    display: block;
}
.sp-alpha-handle {
    position:absolute;
    top:-4px;
    bottom: -4px;
    width: 6px;
    left: 50%;
    cursor: pointer;
    border: 1px solid black;
    background: white;
    opacity: .8;
}
.sp-alpha {
    display: none;
    position: absolute;
    bottom: -14px;
    right: 0;
    left: 0;
    height: 8px;
}
.sp-alpha-inner {
    border: solid 1px #333;
}
.sp-clear {
    display: none;
}
.sp-clear.sp-clear-display {
    background-position: center;
}
.sp-clear-enabled .sp-clear {
    display: block;
    position:absolute;
    top:0px;
    right:0;
    bottom:0;
    left:84%;
    height: 28px;
}
/* Don't allow text selection */
.sp-container, .sp-replacer, .sp-preview, .sp-dragger, .sp-slider, .sp-alpha, .sp-clear, .sp-alpha-handle, .sp-container.sp-dragging .sp-input, .sp-container button  {
    -webkit-user-select:none;
    -moz-user-select: -moz-none;
    -o-user-select:none;
    user-select: none;
}
.sp-container.sp-input-disabled .sp-input-container {
    display: none;
}
.sp-container.sp-buttons-disabled .sp-button-container {
    display: none;
}
.sp-palette-only .sp-picker-container {
    display: none;
}
.sp-palette-disabled .sp-palette-container {
    display: none;
}
.sp-initial-disabled .sp-initial {
    display: none;
}
/* Gradients for hue, saturation and value instead of images.  Not pretty... but it works */
.sp-sat {
    background-image: -webkit-gradient(linear,  0 0, 100% 0, from(#FFF), to(rgba(204, 154, 129, 0)));
    background-image: -webkit-linear-gradient(left, #FFF, rgba(204, 154, 129, 0));
    background-image: -moz-linear-gradient(left, #fff, rgba(204, 154, 129, 0));
    background-image: -o-linear-gradient(left, #fff, rgba(204, 154, 129, 0));
    background-image: -ms-linear-gradient(left, #fff, rgba(204, 154, 129, 0));
    background-image: linear-gradient(to right, #fff, rgba(204, 154, 129, 0));
    -ms-filter: "progid:DXImageTransform.Microsoft.gradient(GradientType = 1, startColorstr=#FFFFFFFF, endColorstr=#00CC9A81)";
    filter : progid:DXImageTransform.Microsoft.gradient(GradientType = 1, startColorstr='#FFFFFFFF', endColorstr='#00CC9A81');
}
.sp-val {
    background-image: -webkit-gradient(linear, 0 100%, 0 0, from(#000000), to(rgba(204, 154, 129, 0)));
    background-image: -webkit-linear-gradient(bottom, #000000, rgba(204, 154, 129, 0));
    background-image: -moz-linear-gradient(bottom, #000, rgba(204, 154, 129, 0));
    background-image: -o-linear-gradient(bottom, #000, rgba(204, 154, 129, 0));
    background-image: -ms-linear-gradient(bottom, #000, rgba(204, 154, 129, 0));
    background-image: linear-gradient(to top, #000, rgba(204, 154, 129, 0));
    -ms-filter: "progid:DXImageTransform.Microsoft.gradient(startColorstr=#00CC9A81, endColorstr=#FF000000)";
    filter : progid:DXImageTransform.Microsoft.gradient(startColorstr='#00CC9A81', endColorstr='#FF000000');
}
.sp-hue {
    background: -moz-linear-gradient(top, #ff0000 0%, #ffff00 17%, #00ff00 33%, #00ffff 50%, #0000ff 67%, #ff00ff 83%, #ff0000 100%);
    background: -ms-linear-gradient(top, #ff0000 0%, #ffff00 17%, #00ff00 33%, #00ffff 50%, #0000ff 67%, #ff00ff 83%, #ff0000 100%);
    background: -o-linear-gradient(top, #ff0000 0%, #ffff00 17%, #00ff00 33%, #00ffff 50%, #0000ff 67%, #ff00ff 83%, #ff0000 100%);
    background: -webkit-gradient(linear, left top, left bottom, from(#ff0000), color-stop(0.17, #ffff00), color-stop(0.33, #00ff00), color-stop(0.5, #00ffff), color-stop(0.67, #0000ff), color-stop(0.83, #ff00ff), to(#ff0000));
    background: -webkit-linear-gradient(top, #ff0000 0%, #ffff00 17%, #00ff00 33%, #00ffff 50%, #0000ff 67%, #ff00ff 83%, #ff0000 100%);
}
/* IE filters do not support multiple color stops.
   Generate 6 divs, line them up, and do two color gradients for each.
   Yes, really.
 */
.sp-1 {
    height:17%;
    filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#ff0000', endColorstr='#ffff00');
}
.sp-2 {
    height:16%;
    filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#ffff00', endColorstr='#00ff00');
}
.sp-3 {
    height:17%;
    filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#00ff00', endColorstr='#00ffff');
}
.sp-4 {
    height:17%;
    filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#00ffff', endColorstr='#0000ff');
}
.sp-5 {
    height:16%;
    filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#0000ff', endColorstr='#ff00ff');
}
.sp-6 {
    height:17%;
    filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#ff00ff', endColorstr='#ff0000');
}
.sp-hidden {
    display: none !important;
}
/* Clearfix hack */
.sp-cf:before, .sp-cf:after { content: ""; display: table; }
.sp-cf:after { clear: both; }
.sp-cf { *zoom: 1; }
/* Mobile devices, make hue slider bigger so it is easier to slide */
@media (max-device-width: 480px) {
    .sp-color { right: 40%; }
    .sp-hue { left: 63%; }
    .sp-fill { padding-top: 60%; }
}
.sp-dragger {
   border-radius: 5px;
   height: 5px;
   width: 5px;
   border: 1px solid #fff;
   background: #000;
   cursor: pointer;
   position:absolute;
   top:0;
   left: 0;
}
.sp-slider {
    position: absolute;
    top:0;
    cursor:pointer;
    height: 3px;
    left: -1px;
    right: -1px;
    border: 1px solid #000;
    background: white;
    opacity: .8;
}
/*
Theme authors:
Here are the basic themeable display options (colors, fonts, global widths).
See http://bgrins.github.io/spectrum/themes/ for instructions.
*/
.sp-container {
    border-radius: 0;
    background-color: #ECECEC;
    border: solid 1px #f0c49B;
    padding: 0;
}
.sp-container, .sp-container button, .sp-container input, .sp-color, .sp-hue, .sp-clear
{
    font: normal 12px "Lucida Grande", "Lucida Sans Unicode", "Lucida Sans", Geneva, Verdana, sans-serif;
    -webkit-box-sizing: border-box;
    -moz-box-sizing: border-box;
    -ms-box-sizing: border-box;
    box-sizing: border-box;
}
.sp-top
{
    margin-bottom: 3px;
}
.sp-color, .sp-hue, .sp-clear
{
    border: solid 1px #666;
}
/* Input */
.sp-input-container {
    float:right;
    width: 100px;
    margin-bottom: 4px;
}
.sp-initial-disabled  .sp-input-container {
    width: 100%;
}
.sp-input {
   font-size: 12px !important;
   border: 1px inset;
   padding: 4px 5px;
   margin: 0;
   width: 100%;
   background:transparent;
   border-radius: 3px;
   color: #222;
}
.sp-input:focus  {
    border: 1px solid orange;
}
.sp-input.sp-validation-error
{
    border: 1px solid red;
    background: #fdd;
}
.sp-picker-container , .sp-palette-container
{
    float:left;
    position: relative;
    padding: 10px;
    padding-bottom: 300px;
    margin-bottom: -290px;
}
.sp-picker-container
{
    width: 172px;
    border-left: solid 1px #fff;
}
/* Palettes */
.sp-palette-container
{
    border-right: solid 1px #ccc;
}
.sp-palette .sp-thumb-el {
    display: block;
    position:relative;
    float:left;
    width: 24px;
    height: 15px;
    margin: 3px;
    cursor: pointer;
    border:solid 2px transparent;
}
.sp-palette .sp-thumb-el:hover, .sp-palette .sp-thumb-el.sp-thumb-active {
    border-color: orange;
}
.sp-thumb-el
{
    position:relative;
}
/* Initial */
.sp-initial
{
    float: left;
    border: solid 1px #333;
}
.sp-initial span {
    width: 30px;
    height: 25px;
    border:none;
    display:block;
    float:left;
    margin:0;
}
.sp-initial .sp-clear-display {
    background-position: center;
}
/* Buttons */
.sp-button-container {
    float: right;
}
/* Replacer (the little preview div that shows up instead of the
<input>
) */
.sp-replacer {
    margin:0;
    overflow:hidden;
    cursor:pointer;
    padding: 4px;
    display:inline-block;
    *zoom: 1;
    *display: inline;
    border: solid 1px #91765d;
    background: #eee;
    color: #333;
    vertical-align: middle;
}
.sp-replacer:hover, .sp-replacer.sp-active {
    border-color: #F0C49B;
    color: #111;
}
.sp-replacer.sp-disabled {
    cursor:default;
    border-color: silver;
    color: silver;
}
.sp-dd {
    padding: 2px 0;
    height: 16px;
    line-height: 16px;
    float:left;
    font-size:10px;
}
.sp-preview
{
    position:relative;
    width:25px;
    height: 20px;
    border: solid 1px #222;
    margin-right: 5px;
    float:left;
    z-index: 0;
}
.sp-palette
{
    *width: 220px;
    max-width: 220px;
}
.sp-palette .sp-thumb-el
{
    width:16px;
    height: 16px;
    margin:2px 1px;
    border: solid 1px #d0d0d0;
}
.sp-container
{
    padding-bottom:0;
}
/* Buttons: http://hellohappy.org/css3-buttons/ */
.sp-container button {
  background-color: #eeeeee;
  background-image: -webkit-linear-gradient(top, #eeeeee, #cccccc);
  background-image: -moz-linear-gradient(top, #eeeeee, #cccccc);
  background-image: -ms-linear-gradient(top, #eeeeee, #cccccc);
  background-image: -o-linear-gradient(top, #eeeeee, #cccccc);
  background-image: linear-gradient(to bottom, #eeeeee, #cccccc);
  border: 1px solid #ccc;
  border-bottom: 1px solid #bbb;
  border-radius: 3px;
  color: #333;
  font-size: 14px;
  line-height: 1;
  padding: 5px 4px;
  text-align: center;
  text-shadow: 0 1px 0 #eee;
  vertical-align: middle;
}
.sp-container button:hover {
    background-color: #dddddd;
    background-image: -webkit-linear-gradient(top, #dddddd, #bbbbbb);
    background-image: -moz-linear-gradient(top, #dddddd, #bbbbbb);
    background-image: -ms-linear-gradient(top, #dddddd, #bbbbbb);
    background-image: -o-linear-gradient(top, #dddddd, #bbbbbb);
    background-image: linear-gradient(to bottom, #dddddd, #bbbbbb);
    border: 1px solid #bbb;
    border-bottom: 1px solid #999;
    cursor: pointer;
    text-shadow: 0 1px 0 #ddd;
}
.sp-container button:active {
    border: 1px solid #aaa;
    border-bottom: 1px solid #888;
    -webkit-box-shadow: inset 0 0 5px 2px #aaaaaa, 0 1px 0 0 #eeeeee;
    -moz-box-shadow: inset 0 0 5px 2px #aaaaaa, 0 1px 0 0 #eeeeee;
    -ms-box-shadow: inset 0 0 5px 2px #aaaaaa, 0 1px 0 0 #eeeeee;
    -o-box-shadow: inset 0 0 5px 2px #aaaaaa, 0 1px 0 0 #eeeeee;
    box-shadow: inset 0 0 5px 2px #aaaaaa, 0 1px 0 0 #eeeeee;
}
.sp-cancel
{
    font-size: 11px;
    color: #d93f3f !important;
    margin:0;
    padding:2px;
    margin-right: 5px;
    vertical-align: middle;
    text-decoration:none;
}
.sp-cancel:hover
{
    color: #d93f3f !important;
    text-decoration: underline;
}
.sp-palette span:hover, .sp-palette span.sp-thumb-active
{
    border-color: #000;
}
.sp-preview, .sp-alpha, .sp-thumb-el
{
    position:relative;
    background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAIAAADZF8uwAAAAGUlEQVQYV2M4gwH+YwCGIasIUwhT25BVBADtzYNYrHvv4gAAAABJRU5ErkJggg==);
}
.sp-preview-inner, .sp-alpha-inner, .sp-thumb-inner
{
    display:block;
    position:absolute;
    top:0;left:0;bottom:0;right:0;
}
.sp-palette .sp-thumb-inner
{
    background-position: 50% 50%;
    background-repeat: no-repeat;
}
.sp-palette .sp-thumb-light.sp-thumb-active .sp-thumb-inner
{
    background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAIVJREFUeNpiYBhsgJFMffxAXABlN5JruT4Q3wfi/0DsT64h8UD8HmpIPCWG/KemIfOJCUB+Aoacx6EGBZyHBqI+WsDCwuQ9mhxeg2A210Ntfo8klk9sOMijaURm7yc1UP2RNCMbKE9ODK1HM6iegYLkfx8pligC9lCD7KmRof0ZhjQACDAAceovrtpVBRkAAAAASUVORK5CYII=);
}
.sp-palette .sp-thumb-dark.sp-thumb-active .sp-thumb-inner
{
    background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAadEVYdFNvZnR3YXJlAFBhaW50Lk5FVCB2My41LjEwMPRyoQAAAMdJREFUOE+tkgsNwzAMRMugEAahEAahEAZhEAqlEAZhEAohEAYh81X2dIm8fKpEspLGvudPOsUYpxE2BIJCroJmEW9qJ+MKaBFhEMNabSy9oIcIPwrB+afvAUFoK4H0tMaQ3XtlrggDhOVVMuT4E5MMG0FBbCEYzjYT7OxLEvIHQLY2zWwQ3D+9luyOQTfKDiFD3iUIfPk8VqrKjgAiSfGFPecrg6HN6m/iBcwiDAo7WiBeawa+Kwh7tZoSCGLMqwlSAzVDhoK+6vH4G0P5wdkAAAAASUVORK5CYII=);
}
.sp-clear-display {
    background-repeat:no-repeat;
    background-position: center;
    background-image: url(data:image/gif;base64,R0lGODlhFAAUAPcAAAAAAJmZmZ2dnZ6enqKioqOjo6SkpKWlpaampqenp6ioqKmpqaqqqqurq/Hx8fLy8vT09PX19ff39/j4+Pn5+fr6+vv7+wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAAP8ALAAAAAAUABQAAAihAP9FoPCvoMGDBy08+EdhQAIJCCMybCDAAYUEARBAlFiQQoMABQhKUJBxY0SPICEYHBnggEmDKAuoPMjS5cGYMxHW3IiT478JJA8M/CjTZ0GgLRekNGpwAsYABHIypcAgQMsITDtWJYBR6NSqMico9cqR6tKfY7GeBCuVwlipDNmefAtTrkSzB1RaIAoXodsABiZAEFB06gIBWC1mLVgBa0AAOw==);
}
</style>
<style type="text/css">
#portal-distance {
    text-align: center;
}
.portal-distance-bearing {
    display: inline-block;
    vertical-align: top;
    position: relative;
    height: 1em;
    width: 1em;
}
.portal-distance-bearing:before, .portal-distance-bearing:after {
    border-color: transparent currentcolor transparent transparent;
    border-style: solid;
    border-width: 0.75em 0.4em 0 0;
    content: "";
    height: 0;
    width: 0;
    position: absolute;
    top: 0.15em;
    left: 0.15em;
    transform: skewY(-30deg);
    -moz-transform: skewY(-30deg);
    -webkit-transform: skewY(-30deg);
}
.portal-distance-bearing:after {
    left: auto;
    right: 0.15em;
    transform: scaleX(-1) skewY(-30deg);
    -moz-transform: scaleX(-1) skewY(-30deg);
    -webkit-transform: scaleX(-1) skewY(-30deg);
}
</style>
<style type="text/css">
.plugin-player-tracker-popup a {
    color: inherit;
    text-decoration: underline;
    text-decoration-style: dashed;
    -moz-text-decoration-style: dashed;
    -webkit-text-decoration-style: dashed;
}
</style>
<style type="text/css">
#level {
    text-align: center;
    margin-right: -0.5em;
    position: relative;
    right: 50%;
    width: 1em;
}
.showLinkedPortalLink {
    cursor: pointer;
    position: absolute;
    height: 40px;
    width: 50px;
    border-width: 1px;
    overflow: hidden;
    text-align: center;
    background: #0e3d4e;
}
.showLinkedPortalLink.outgoing {
    border-style: dashed;
}
.showLinkedPortalLink.incoming {
    border-style: dotted;
}
.showLinkedPortalLink .minImg {
    height: 40px;
}
.showLinkedPortalLink.outOfRange span {
    display: block;
    line-height: 13px;
    font-size: 10px;
}
.showLinkedPortalOverflow {
    left: 50%;
    margin-left:-25px;
    cursor: default;
}
.showLinkedPortalLink1, .showLinkedPortalLink2, .showLinkedPortalLink3, .showLinkedPortalLink4 {
    left: 5px;
}
.showLinkedPortalLink5, .showLinkedPortalLink6, .showLinkedPortalLink7, .showLinkedPortalLink8 {
    right: 5px;
}
.showLinkedPortalLink9, .showLinkedPortalLink10, .showLinkedPortalLink11, .showLinkedPortalLink12 {
    left: 59px;
}
.showLinkedPortalLink13, .showLinkedPortalLink14, .showLinkedPortalLink15, .showLinkedPortalLink16 {
    right: 59px
}
.showLinkedPortalLink1, .showLinkedPortalLink5, .showLinkedPortalLink9, .showLinkedPortalLink13 {
    top: 23px;
}
.showLinkedPortalLink2, .showLinkedPortalLink6, .showLinkedPortalLink10, .showLinkedPortalLink14 {
    top: 72px;
}
.showLinkedPortalLink3, .showLinkedPortalLink7, .showLinkedPortalLink11, .showLinkedPortalLink15 {
    top: 122px;
}
.showLinkedPortalLink4, .showLinkedPortalLink8, .showLinkedPortalLink12, .showLinkedPortalLink16,
.showLinkedPortalOverflow {
    top: 171px;
}
</style>
<style>
#portalcounts.mobile {background: transparent; border: 0 none !important; height: 100% !important; width: 100% !important; left: 0 !important; top: 0 !important; position: absolute; overflow: auto; z-index: 9000 !important; }#portalcounts table {margin-top:5px; border-collapse: collapse; empty-cells: show; width:100%; clear: both;}#portalcounts table td, #portalcounts table th {border-bottom: 1px solid #0b314e; padding:3px; color:white; background-color:#1b415e}#portalcounts table tr.res th {  background-color: #005684; }#portalcounts table tr.enl th {  background-color: #017f01; }#portalcounts table th { text-align: center;}#portalcounts table td { text-align: center;}#portalcounts table td.L0 { background-color: #000000 !important;}#portalcounts table td.L1 { background-color: #FECE5A !important;}#portalcounts table td.L2 { background-color: #FFA630 !important;}#portalcounts table td.L3 { background-color: #FF7315 !important;}#portalcounts table td.L4 { background-color: #E40000 !important;}#portalcounts table td.L5 { background-color: #FD2992 !important;}#portalcounts table td.L6 { background-color: #EB26CD !important;}#portalcounts table td.L7 { background-color: #C124E0 !important;}#portalcounts table td.L8 { background-color: #9627F4 !important;}#portalcounts table td:nth-child(1) { text-align: left;}#portalcounts table th:nth-child(1) { text-align: left;}
</style>
<style type="text/css">
/* hide when printing */
@media print {
    #bkmrksTrigger { display: none !important; }
}
#bookmarksBox *{
    display:block;
    padding:0;
    margin:0;
    width:auto;
    height:auto;
    font-family:Verdana,Geneva,sans-serif;
    font-size:13px;
    line-height:22px;
    text-indent:0;
    text-decoration:none;
    -webkit-box-sizing:border-box;
    -moz-box-sizing:border-box;
    box-sizing:border-box;
}
#bookmarksBox{
    display:block;
    position:absolute !important;
    z-index:4001;
    top:100px;
    left:100px;
    width:231px;
    height:auto;
    overflow:hidden;
}
#bookmarksBox .addForm,
#bookmarksBox #bookmarksTypeBar,
#bookmarksBox h5{
    height:28px;
    overflow:hidden;
    color:#fff;
    font-size:14px;
}
#bookmarksBox #topBar{
    height:15px !important;
}
#bookmarksBox #topBar *{
    height: 14px !important;
}
#bookmarksBox #topBar *{
    float:left !important;
}
#bookmarksBox .handle{
    width:80%;
    text-align:center;
    color:#fff;
    line-height:6px;
    cursor:move;
}
#bookmarksBox #topBar .btn{
    display:block;
    width:10%;
    cursor:pointer;
    color:#20a8b1;
    font-weight:bold;
    text-align:center;
    line-height:13px;
    font-size:18px;
}
#bookmarksBox #topBar #bookmarksDel{
    overflow:hidden;
    text-indent:-999px;
    background:#B42E2E;
}
#bookmarksBox #topBar #bookmarksMin:hover{
    color:#ffce00;
}
#bookmarksBox #bookmarksTypeBar{
    clear:both;
}
#bookmarksBox h5{
    padding:4px 0 23px;
    width:50%;
    height:93px !important;
    text-align:center;
    color:#788;
}
#bookmarksBox h5.current{
    cursor:default;
    background:0;
    color:#fff !important;
}
#bookmarksBox h5:hover{
    color:#ffce00;
    background:rgba(0,0,0,0);
}
#bookmarksBox #topBar,
#bookmarksBox .addForm,
#bookmarksBox #bookmarksTypeBar,
#bookmarksBox .bookmarkList li.bookmarksEmpty,
#bookmarksBox .bookmarkList li.bkmrk a,
#bookmarksBox .bookmarkList li.bkmrk:hover{
    background-color:rgba(8,48,78,.85);
}
#bookmarksBox h5,
#bookmarksBox .bookmarkList li.bkmrk:hover .bookmarksLink,
#bookmarksBox .addForm *{
    background:rgba(0,0,0,.3);
}
#bookmarksBox .addForm *{
    display:block;
    float:left;
    height:28px !important;
}
#bookmarksBox .addForm a{
    cursor:pointer;
    color:#20a8b1;
    font-size:12px;
    width:35%;
    text-align:center;
    line-height:20px;
    padding:4px 0 23px;
}
#bookmarksBox .addForm a:hover{
    background:#ffce00;
    color:#000;
    text-decoration:none;
}
#bookmarksBox .addForm input{
    font-size:11px !important;
    color:#ffce00;
    height:28px;
    padding:4px 8px 1px;
    line-height:12px;
    font-size:12px;
}
#bookmarksBox #bkmrk_portals .addForm input{
    width:65%;
}
#bookmarksBox #bkmrk_maps .addForm input{
    width:42%;
}
#bookmarksBox #bkmrk_maps .addForm a{
    width:29%;
}
#bookmarksBox .addForm input:hover,
#bookmarksBox .addForm input:focus{
    outline:0;
    background:rgba(0,0,0,.6);
}
#bookmarksBox .bookmarkList >
 ul{
    clear:both;
    list-style-type:none;
    color:#fff;
    overflow:hidden;
    overflow-y:auto;
    max-height:580px;
}
#bookmarksBox .sortable-placeholder{
    background:rgba(8,48,78,.55);
    box-shadow:inset 1px 0 0 #20a8b1;
}
#bookmarksBox .ui-sortable-helper{
    border-top-width:1px;
}
#bookmarksBox .bookmarkList{
    display:none;
}
#bookmarksBox .bookmarkList.current{
    display:block;
}
#bookmarksBox h5,
#bookmarksBox .addForm *,
#bookmarksBox ul li.bkmrk,
#bookmarksBox ul li.bkmrk a{
    height:22px;
}
#bookmarksBox h5,
#bookmarksBox ul li.bkmrk a{
    overflow:hidden;
    cursor:pointer;
    float:left;
}
#bookmarksBox ul .bookmarksEmpty{
    text-indent:27px;
    color:#eee;
}
#bookmarksBox ul .bookmarksRemoveFrom{
    width:10%;
    text-align:center;
    color:#fff;
}
#bookmarksBox ul .bookmarksLink{
    width:90%;
    padding:0 10px 0 8px;
    color:#ffce00;
}
#bookmarksBox ul .bookmarksLink.selected{
    color:#03fe03;
}
#bookmarksBox ul .othersBookmarks .bookmarksLink{
    width:90%;
}
#bookmarksBox ul .bookmarksLink:hover{
    color:#03fe03;
}
#bookmarksBox ul .bookmarksRemoveFrom:hover{
    color:#fff;
    background:#e22 !important;
}
/*---- UI border -----*/
#bookmarksBox,
#bookmarksBox *{
    border-color:#20a8b1;
    border-style:solid;
    border-width:0;
}
#bookmarksBox #topBar,
#bookmarksBox ul .bookmarkFolder{
    border-top-width:1px;
}
#bookmarksBox #topBar,
#bookmarksBox #bookmarksTypeBar,
#bookmarksBox .addForm,
#bookmarksBox ul .bookmarkFolder .folderLabel,
#bookmarksBox ul li.bkmrk a {
    border-bottom-width:1px;
}
#bookmarksBox ul .bookmarkFolder{
    border-right-width:1px;
    border-left-width:1px;
}
#bookmarksBox #topBar *,
#bookmarksBox #bookmarksTypeBar *,
#bookmarksBox .addForm *,
#bookmarksBox ul li.bkmrk{
    border-left-width:1px;
}
#bookmarksBox #topBar,
#bookmarksBox #bookmarksTypeBar,
#bookmarksBox .addForm,
#bookmarksBox ul .bookmarksRemoveFrom{
    border-right-width:1px;
}
#bookmarksBox ul .bookmarkFolder.othersBookmarks li.bkmrk,
#bookmarksBox ul .bookmarkFolder .folderLabel .bookmarksRemoveFrom{
    border-left-width:0;
}
#bkmrksTrigger{
    display:block;
    position:absolute;
    overflow:hidden;
    top:0;
    left:277px;
    width:47px;
    margin-top:-36px;
    height:64px;
    height:0;
    cursor:pointer;
    z-index:2999;
    background-position:center bottom;
    background-repeat:no-repeat;
    transition:margin-top 100ms ease-in-out;
    text-indent:-100%;
    text-decoration:none;
    text-align:center;
}
#bkmrksTrigger:hover{
    margin-top:0;
}
#sidebar #portaldetails h3.title{
    width:auto;
}
.portal-list-bookmark span {
    display:inline-block;
    margin: -3px;
    width:16px;
    height:15px;
    overflow:hidden;
    background-repeat:no-repeat;
    cursor:pointer;
}
#bkmrksTrigger, .bkmrksStar span, .portal-list-bookmark span {
    background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC8AAABPCAMAAABMDWzEAAAANlBMVEX/////zgD/zgD///////8Aru7/zgAAru4TtPAAAADA7PtAwvLk9/6b3/n///8Aru510/b/zgDZKp6YAAAACnRSTlOAxo5FtDw9mPoA9GJiegAAAklJREFUeF6dle26ozAIhFO1NkK+vP+b3WbBJRwM7dn5lad9BweoaThI63Z42hfmLn4rLv84d8WvpWxe+fNcFL+VUtzy57kLv67lrbDOqu/nW8tfQ1i3MmjbfrKPc9BjCYfiy2qjjNoDZRfcaBnxnl8Mm8KN4bFzv6q6lVT/P369+DBZFmsZ+LAmWbHllz7XB/OBwDDhF1rVIvwFhHt+vw4dqbViKdC0wHySSsE3e/FxpHPpAo+vUehUSCk7PBuYTpCUw/JsAIoipzlfUTHimPGNMujQ7LA86sSqm2x4BFXbOjTPSWJFxtgpbRTFd+VITdPGQG3b8hArCbm7n9vVefqZxT8I0G2Y+Yi4XFNy+Jqpn695WlP6ksdWSJB9PmJrkMqolADyjIdyrzSrD1Pc8lND8vrNFvfnkw3u8NYAn+ev+M/7iorPH3n8Jd9+mT+b8fg8EBZb+o4n+n0gx4yPMp5MZ3LkW77XJAaZZkdmPtv7JGG9EfLLrnkS3DjiRWseej6OrnXd0ub/hQbftIPHCnfzjDz6sXjy3seKoBqXG97yqiCgmFv198uNYy7XptHlr8aHcbk8NW5veMtrg+A1Ojy3oCeLDs9zgfEHEi2vu03INu4Y/fk3OVOo6N2f8u5IqDs+NvMaYOJQaHj5rut1vGIda/zk5dmdfh7H8XypUJpP0luNne56xnEdildRRPyIfMMDSnGWhEJQvEQZittQwoONYkP946OOMnsERuZNFKMXOYiXkXsO4U0UL1QwffqPCH4Us4xgovih/gBs1LqNE0afwAAAAABJRU5ErkJggg==);
}
.bkmrksStar span{
    display:inline-block;
    float:left;
    margin:3px 1px 0 4px;
    width:16px;
    height:15px;
    overflow:hidden;
    background-repeat:no-repeat;
}
.bkmrksStar span, .bkmrksStar.favorite:focus span{
    background-position:left top;
}
.bkmrksStar:focus span, .bkmrksStar.favorite span, .portal-list-bookmark.favorite span{
    background-position:right top;
}
#bookmarksBox .bookmarkList .bookmarkFolder{
    overflow:hidden;
    margin-top:-1px;
    height:auto;
    background:rgba(8,58,78,.7);
}
#bookmarksBox .bookmarkList ul li.sortable-placeholder{
    box-shadow:inset -1px 0 0 #20a8b1,inset 1px 0 0 #20a8b1,0 -1px 0 #20a8b1;
    background:rgba(8,58,78,.9);
}
#bookmarksBox .bookmarkList .bkmrk.ui-sortable-helper{
    border-right-width:1px;
    border-left-width:1px !important;
}
#bookmarksBox .bookmarkList ul li ul li.sortable-placeholder{
    height:23px;
    box-shadow:inset 0 -1px 0 #20a8b1,inset 1px 0 0 #20a8b1;
}
#bookmarksBox .bookmarkList ul li.bookmarkFolder.ui-sortable-helper,
#bookmarksBox .bookmarkList ul li.othersBookmarks ul li.sortable-placeholder{
    box-shadow:inset 0 -1px 0 #20a8b1;
}
#bookmarksBox #topBar #bookmarksDel,
#bookmarksBox .bookmarkList .bookmarkFolder .folderLabel:hover .bookmarksRemoveFrom,
#bookmarksBox .bookmarkList .bookmarkFolder .folderLabel:hover .bookmarksAnchor{
    border-bottom-width:1px;
}
/*---------*/
#bookmarksBox .bookmarkList .bookmarkFolder .folderLabel .bookmarksAnchor span,
#bookmarksBox .bookmarkList .bookmarkFolder .folderLabel >
 span,
#bookmarksBox .bookmarkList .bookmarkFolder .folderLabel >
 span >
 span,
#bookmarksBox .bookmarkList .triangle{
    width:0;
    height:0;
}
#bookmarksBox .bookmarkList .bookmarkFolder .folderLabel{
    overflow:visible;
    height:25px;
    cursor:pointer;
    background:#069;
    text-indent:0;
}
#bookmarksBox .bookmarkList .bookmarkFolder .folderLabel >
 *{
    height:25px;
    float:left;
}
#bookmarksBox .bookmarkList .bookmarkFolder .folderLabel .bookmarksAnchor{
    line-height:25px;
    color:#fff;
    width:90%;
}
#bookmarksBox .bookmarkList .bookmarkFolder .folderLabel .bookmarksAnchor span{
    float:left;
    border-width:5px 0 5px 7px;
    border-color:transparent transparent transparent white;
    margin:7px 7px 0 6px;
}
#bookmarksBox .bookmarkList .bookmarkFolder.open .folderLabel .bookmarksAnchor span{
    margin:9px 5px 0 5px;
    border-width:7px 5px 0 5px;
    border-color:white transparent transparent transparent;
}
#bookmarksBox .bookmarkList .bookmarkFolder .folderLabel >
 span,
#bookmarksBox .bookmarkList .bookmarkFolder .folderLabel >
 span >
 span{
    display:none;
    border-width:0 12px 10px 0;
    border-color:transparent #20a8b1 transparent transparent;
    margin:-20px 0 0;
    position:relative;
    top:21px;
    left:219px;
}
#bookmarksBox .bookmarkList .bookmarkFolder .folderLabel >
 span >
 span{
    top:18px;
    left:0;
    border-width:0 10px 9px 0;
    border-color:transparent #069 transparent transparent;
}
#bookmarksBox .bookmarkList .bookmarkFolder.open .folderLabel >
 span,
#bookmarksBox .bookmarkList .bookmarkFolder.open .folderLabel >
 span >
 span{
    display:block;
    display:none;
}
#bookmarksBox .bookmarkList .bookmarkFolder.open .folderLabel:hover >
 span >
 span{
    border-color:transparent #036 transparent transparent;
}
#bookmarksBox .bookmarkList .bookmarkFolder .folderLabel:hover .bookmarksAnchor{
    background:#036;
}
#bookmarksBox .bookmarkList .bookmarkFolder ul{
    display:none;
    margin-left:10%;
}
#bookmarksBox .bookmarkList .bookmarkFolder.open ul{
    display:block;
    min-height:22px;
}
#bookmarksBox .bookmarkFolder.othersBookmarks ul{
    margin-left:0;
}
/*---- Width for deleteMode -----*/
#bookmarksBox .bookmarksRemoveFrom{
    display:none !important;
}
#bookmarksBox.deleteMode .bookmarksRemoveFrom{
    display:block !important;
}
#bookmarksBox .bookmarkList .bookmarkFolder .folderLabel .bookmarksAnchor,
#bookmarksBox ul .bookmarksLink,
#bookmarksBox ul .othersBookmarks .bookmarksLink{
    width:100% !important;
}
#bookmarksBox.deleteMode .bookmarkList .bookmarkFolder .folderLabel .bookmarksAnchor,
#bookmarksBox.deleteMode ul .bookmarksLink,
#bookmarksBox.deleteMode ul .othersBookmarks .bookmarksLink{
    width:90% !important;
}
/**********************************************
    MOBILE
**********************************************/
#bookmarksBox.mobile{
    position:absolute !important;
    width: 100% !important;
    height: 100% !important;
    top: 0 !important;
    left: 0 !important;
    margin: 0 !important;
    padding: 0 !important;
    border: 0 !important;
    background: transparent !important;
    overflow:auto !important;
}
#bookmarksBox.mobile .bookmarkList ul,
#bookmarksBox.mobile .bookmarkList ul li,
#bookmarksBox.mobile .bookmarkList.current,
#bookmarksBox.mobile .bookmarkList li.bookmarkFolder.open ul{
    width:100% !important;
    display:block !important;
}
#bookmarksBox.mobile *{
    box-shadow:none !important;
    border-width:0 !important;
}
#bookmarksBox.mobile #topBar #bookmarksMin,
#bookmarksBox.mobile #topBar .handle{
    display:none !important;
}
#bookmarksBox.mobile #bookmarksTypeBar h5{
    cursor:pointer;
    text-align:center;
    float:left;
    width:50%;
    height:auto !important;
    padding:7px 0;
}
#bookmarksBox.mobile #bookmarksTypeBar h5.current{
    cursor:default;
    color:#fff;
}
#bookmarksBox.mobile #bookmarksTypeBar,
#bookmarksBox.mobile .bookmarkList .addForm{
    border-bottom:1px solid #20a8b1 !important;
}
#bookmarksBox.mobile .bookmarkList ul li ul li.bkmrk,
#bookmarksBox.mobile .bookmarkList li.bookmarkFolder .folderLabel{
    height:36px !important;
    clear:both;
}
#bookmarksBox.mobile .bookmarkList li.bookmarkFolder .folderLabel a,
#bookmarksBox.mobile .bookmarkList ul li ul li.bkmrk a{
    background:none;
    padding:7px 0;
    height:auto;
    box-shadow:inset 0 1px 0 #20a8b1 !important;
}
#bookmarksBox.mobile .bookmarkList li.bookmarkFolder a.bookmarksRemoveFrom,
#bookmarksBox.mobile .bookmarkList li.bkmrk a.bookmarksRemoveFrom{
    box-shadow:inset 0 1px 0 #20a8b1,inset -1px 0 0 #20a8b1 !important;
    width:10%;
    background:none !important;
}
#bookmarksBox.mobile .bookmarkList li.bookmarkFolder a.bookmarksAnchor,
#bookmarksBox.mobile .bookmarkList li.bkmrk a.bookmarksLink{
    text-indent:10px;
    height:36px;
    line-height:24px;
    overflow:hidden;
}
#bookmarksBox.mobile .bookmarkList ul li.bookmarkFolder ul{
    margin-left:0 !important;
}
#bookmarksBox.mobile .bookmarkList >
 ul{
    border-bottom:1px solid #20a8b1 !important;
}
#bookmarksBox.mobile .bookmarkList .bookmarkFolder.othersBookmarks  ul{
    border-top:5px solid #20a8b1 !important;
}
#bookmarksBox.mobile .bookmarkList li.bookmarkFolder,
#bookmarksBox.mobile .bookmarkList li.bkmrk{
    box-shadow:inset 0 1px 0 #20a8b1, 1px 0 0 #20a8b1, -1px 1px 0 #20a8b1 !important;
}
#bookmarksBox.mobile .bookmarkList >
 ul{
    max-height:none;
/*  width:85% !important;*/
}
#bookmarksBox.mobile .bookmarkList li.bookmarkFolder .folderLabel{
    box-shadow:0 1px 0 #20a8b1 !important;
}
#bookmarksBox.mobile .bookmarkList ul li.bookmarkFolder ul{
    width:90% !important;
    margin-left:10% !important;
}
#bookmarksBox.mobile .bookmarkList ul li.bookmarkFolder.othersBookmarks ul{
    width:100% !important;
    margin-left:0% !important;
}
#bookmarksBox.mobile{
    margin-bottom:5px !important;
}
#bookmarksBox.mobile #bookmarksTypeBar{
    height:auto;
}
#bookmarksBox.mobile .addForm,
#bookmarksBox.mobile .addForm *{
    height:35px !important;
    padding:0;
}
#bookmarksBox.mobile .addForm a{
    line-height:37px;
}
#bookmarksBox.mobile .addForm a{
/*  width:25% !important;*/
}
#bookmarksBox.mobile .addForm input{
/*  width:50% !important;*/
    text-indent:10px;
}
#bookmarksBox.mobile #bkmrk_portals .addForm input{
/*  width:75% !important;*/
}
#bookmarksBox.mobile #bookmarksTypeBar h5,
#bookmarksBox.mobile .bookmarkList .addForm a{
    box-shadow:-1px 0 0 #20a8b1 !important;
}
#bookmarksBox.mobile .bookmarkList li.bookmarkFolder ul{
    display:none !important;
    min-height:37px !important;
}
#updatestatus .bkmrksStar{
    float:left;
    margin:-19px 0 0 -5px;
    padding:0 3px 1px 4px;
    background:#262c32;
}
#bookmarksBox.mobile .bookmarkList .bookmarkFolder .folderLabel .bookmarksAnchor span,
#bookmarksBox.mobile .bookmarkList .bookmarkFolder .folderLabel >
 span,
#bookmarksBox.mobile .bookmarkList .bookmarkFolder .folderLabel >
 span >
 span,
#bookmarksBox.mobile .bookmarkList .triangle{
    width:0 !important;
    height:0 !important;
}
#bookmarksBox.mobile .bookmarkList .bookmarkFolder .folderLabel .bookmarksAnchor span{
    float:left !important;
    border-width:5px 0 5px 7px !important;
    border-color:transparent transparent transparent white !important;
    margin:7px 3px 0 13px !important;
}
#bookmarksBox.mobile .bookmarkList .bookmarkFolder.open .folderLabel .bookmarksAnchor span{
    margin:9px 1px 0 12px !important;
    border-width:7px 5px 0 5px !important;
    border-color:white transparent transparent transparent !important;
}
#bookmarksBox.mobile .bookmarkList .bookmarkFolder .folderLabel >
 span,
#bookmarksBox.mobile .bookmarkList .bookmarkFolder .folderLabel >
 span >
 span{
    display:none !important;
    border-width:0 12px 10px 0 !important;
    border-color:transparent #20a8b1 transparent transparent !important;
    margin:-20px 0 0 100% !important;
    position:relative !important;
    top:21px !important;
    left:-10px !important;
}
#bookmarksBox.mobile .bookmarkList .bookmarkFolder .folderLabel >
 span >
 span{
    top:18px !important;
    left:0 !important;
    border-width:0 10px 9px 0 !important;
    border-color:transparent #069 transparent transparent !important;
}
#bookmarksBox.mobile .bookmarkList .bookmarkFolder.open .folderLabel >
 span,
#bookmarksBox.mobile .bookmarkList .bookmarkFolder.open .folderLabel >
 span >
 span{
    display:block !important;
}
/**********************************************
    DIALOG BOX
**********************************************/
/*---- Auto Drawer -----*/
#bkmrksAutoDrawer,
#bkmrksAutoDrawer p,
#bkmrksAutoDrawer a{
    display:block;
    padding:0;
    margin:0;
}
#bkmrksAutoDrawer .bookmarkFolder{
    margin-bottom:4px;
    border:1px solid #20a8b1;
}
#bkmrksAutoDrawer .folderLabel{
    background:#069;
    padding:4px 0;
    color:#fff;
}
#bkmrksAutoDrawer .bookmarkFolder div{
    border-top:1px solid #20a8b1;
    padding:6px 0;
    background:rgba(0,0,0,0.3);
}
#bkmrksAutoDrawer .bookmarkFolder#idOthers .folderLabel{
    display:none;
}
#bkmrksAutoDrawer .bookmarkFolder#idOthers div{
    display:block;
    border-top:none;
}
#bkmrksAutoDrawer a{
    text-indent:10px;
    padding:2px 0;
}
#bkmrksAutoDrawer .longdistance {
    color: #FFCC00;
    font-weight: bold;
    border-bottom: 1px dashed currentColor;
}
#bkmrksAutoDrawer .bookmarkFolder div {
    display:none;
}
#bkmrksAutoDrawer a.bkmrk.selected{
    color:#03dc03;
}
/*---- Options panel -----*/
#bkmrksSetbox a{
    display:block;
    color:#ffce00;
    border:1px solid #ffce00;
    padding:3px 0;
    margin:10px auto;
    width:80%;
    text-align:center;
    background:rgba(8,48,78,.9);
}
#bkmrksSetbox a.disabled,
#bkmrksSetbox a.disabled:hover{
    color:#666;
    border-color:#666;
    text-decoration:none;
}
/*---- Opt panel - copy -----*/
.ui-dialog-bkmrksSet-copy textarea{
    width:96%;
    height:120px;
    resize:vertical;
}
/*--- Other Opt css ---*/
#bookmarksBox.mobile a.bookmarksMoveIn{
    display:none !important;
}
#bookmarksBox.mobile .bookmarkList ul li ul li.bkmrk a.bookmarksMoveIn{
    background:none !important;
    text-align:center;
    color:#fff;
    box-shadow: inset 0 1px 0 #20A8B1,inset -1px 0 0 #20A8B1 !important;
    width:10%;
}
#bookmarksBox.mobile.moveMode a.bookmarksMoveIn{
    display:block !important;
}
#bookmarksBox.moveMode ul .bookmarksLink,
#bookmarksBox.moveMode ul .othersBookmarks .bookmarksLink{
    width:90% !important;
}
.bookmarksDialog h3{
    text-transform:capitalize;margin-top:10px;
}
.bookmarksDialog .bookmarkFolder{
    margin-bottom:4px;
    border:1px solid #20a8b1;
    background:#069;
    padding:4px 10px;
    color:#fff;
    cursor:pointer;
}
.bookmarksDialog .bookmarkFolder:hover{
    text-decoration:underline;
}
#bookmarksBox.mobile #topBar .btn{
    width:100%;height:45px !important;
    font-size:13px;
    color:#fff;
    font-weight:normal;
    padding-top:17px;
    text-indent:0 !important;
}
#bookmarksBox.mobile .btn{
    width:50% !important;
    background:#222;
}
#bookmarksBox.mobile .btn.left{
    border-right:1px solid #20a8b1 !important;
}
#bookmarksBox.mobile .btn#bookmarksMove{
    background:#B42E2E;
}
#bkmrksSetbox{
    text-align:center;
}
</style>
<style type="text/css">
#farm_level_select { position: absolute; top: 5px; left:180px; z-index: 2500; font-size:11px; font-family: "coda",arial,helvetica,sans-serif; background-color:#0E3C46; color:#ffce00;}
</style>
<style type="text/css">
.plugin-keys-on-map-key {            font-size: 10px;            color: #FFFFBB;            font-family: monospace;            text-align: center;            text-shadow: 0 0 0.5em black, 0 0 0.5em black, 0 0 0.5em black;            pointer-events: none;            -webkit-text-size-adjust:none;          }
</style>
<script type="text/javascript" charset="UTF-8" src="https://maps.googleapis.com/maps-api-v3/api/js/21/12/common.js">
</script>
<script type="text/javascript" charset="UTF-8" src="https://maps.googleapis.com/maps-api-v3/api/js/21/12/map.js">
</script>
<script type="text/javascript" charset="UTF-8" src="https://maps.googleapis.com/maps-api-v3/api/js/21/12/util.js">
</script>
<script type="text/javascript" charset="UTF-8" src="https://maps.googleapis.com/maps-api-v3/api/js/21/12/onion.js">
</script>
<script type="text/javascript" charset="UTF-8" src="https://maps.googleapis.com/maps-api-v3/api/js/21/12/controls.js">
</script>
<script type="text/javascript" charset="UTF-8" src="https://drive.google.com/otservice/api">
</script>
<script type="text/javascript" charset="UTF-8" src="https://maps.googleapis.com/maps-api-v3/api/js/21/12/stats.js">
</script>
</head>

<body onload="initialize()" id="dashboard" class="" style="cursor: auto;">
<div id="map" class="leaflet-container leaflet-fade-anim" tabindex="0" style="position: relative;">
<div class="leaflet-google-layer leaflet-top leaflet-left" id="_GMapContainer_73" style="z-index: auto; width: 1838px; height: 1019px; overflow: hidden; transform: translateZ(0px); background-color: rgb(221, 221, 221);">
<div class="gm-style" style="position: absolute; left: 0px; top: 0px; overflow: hidden; width: 100%; height: 100%; z-index: 0;">
<div style="position: absolute; left: 0px; top: 0px; overflow: hidden; width: 100%; height: 100%; z-index: 0;">
<div style="position: absolute; left: 0px; top: 0px; z-index: 1; width: 100%; transform-origin: 0px 0px 0px; transform: matrix(1, 0, 0, 1, -308, 668);">
<div style="transform: translateZ(0px); position: absolute; left: 0px; top: 0px; z-index: 100; width: 100%;">
<div style="position: absolute; left: 0px; top: 0px; z-index: 0;">
<div aria-hidden="true" style="position: absolute; left: 0px; top: 0px; z-index: 1; visibility: inherit;">
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 870px; top: -273px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 1126px; top: -273px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 870px; top: -529px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 870px; top: -17px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 1126px; top: -529px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 1126px; top: -17px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 1382px; top: -273px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 614px; top: -273px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 614px; top: -17px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 1382px; top: -17px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 1382px; top: -529px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 614px; top: -529px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 1126px; top: 239px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 870px; top: -785px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 1126px; top: -785px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 870px; top: 239px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 1382px; top: -785px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 614px; top: -785px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 614px; top: 239px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 1382px; top: 239px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 1638px; top: -273px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 358px; top: -273px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 358px; top: -17px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 1638px; top: -529px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 1638px; top: -17px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 358px; top: -529px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 1638px; top: 239px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 358px; top: 239px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 1638px; top: -785px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 358px; top: -785px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 1894px; top: -273px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 102px; top: -273px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 102px; top: -17px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 1894px; top: -529px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 1894px; top: -17px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 102px; top: -529px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 102px; top: -785px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 102px; top: 239px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 1894px; top: -785px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 1894px; top: 239px;">
</div>
</div>
</div>
</div>
<div style="transform: translateZ(0px); position: absolute; left: 0px; top: 0px; z-index: 101; width: 100%;">
</div>
<div style="transform: translateZ(0px); position: absolute; left: 0px; top: 0px; z-index: 102; width: 100%;">
</div>
<div style="transform: translateZ(0px); position: absolute; left: 0px; top: 0px; z-index: 103; width: 100%;">
</div>
<div style="position: absolute; left: 0px; top: 0px; z-index: 0;">
<div aria-hidden="true" style="position: absolute; left: 0px; top: 0px; z-index: 1; visibility: inherit;">
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 870px; top: -273px; transition: opacity 200ms ease-out;">
<img src="https://mts1.googleapis.com/maps/vt?pb=!1m4!1m3!1i18!2i49647!3i105231!2m3!1e0!2sm!3i333112376!3m14!2sen-US!3sUS!5e18!12m1!1e47!12m3!1e37!2m1!1ssmartmaps!12m4!1e26!2m2!1sstyles!2zcy50OjMzfHMuZTpsfHAudjpvZmY!4e0" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 1126px; top: -273px; transition: opacity 200ms ease-out;">
<img src="https://mts0.googleapis.com/maps/vt?pb=!1m4!1m3!1i18!2i49648!3i105231!2m3!1e0!2sm!3i333112376!3m14!2sen-US!3sUS!5e18!12m1!1e47!12m3!1e37!2m1!1ssmartmaps!12m4!1e26!2m2!1sstyles!2zcy50OjMzfHMuZTpsfHAudjpvZmY!4e0" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 870px; top: -529px; transition: opacity 200ms ease-out;">
<img src="https://mts1.googleapis.com/maps/vt?pb=!1m4!1m3!1i18!2i49647!3i105230!2m3!1e0!2sm!3i333088616!3m14!2sen-US!3sUS!5e18!12m1!1e47!12m3!1e37!2m1!1ssmartmaps!12m4!1e26!2m2!1sstyles!2zcy50OjMzfHMuZTpsfHAudjpvZmY!4e0" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 870px; top: -17px; transition: opacity 200ms ease-out;">
<img src="https://mts1.googleapis.com/maps/vt?pb=!1m4!1m3!1i18!2i49647!3i105232!2m3!1e0!2sm!3i333112376!3m14!2sen-US!3sUS!5e18!12m1!1e47!12m3!1e37!2m1!1ssmartmaps!12m4!1e26!2m2!1sstyles!2zcy50OjMzfHMuZTpsfHAudjpvZmY!4e0" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 1126px; top: -529px; transition: opacity 200ms ease-out;">
<img src="https://mts0.googleapis.com/maps/vt?pb=!1m4!1m3!1i18!2i49648!3i105230!2m3!1e0!2sm!3i333088616!3m14!2sen-US!3sUS!5e18!12m1!1e47!12m3!1e37!2m1!1ssmartmaps!12m4!1e26!2m2!1sstyles!2zcy50OjMzfHMuZTpsfHAudjpvZmY!4e0" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 1126px; top: -17px; transition: opacity 200ms ease-out;">
<img src="https://mts0.googleapis.com/maps/vt?pb=!1m4!1m3!1i18!2i49648!3i105232!2m3!1e0!2sm!3i333112376!3m14!2sen-US!3sUS!5e18!12m1!1e47!12m3!1e37!2m1!1ssmartmaps!12m4!1e26!2m2!1sstyles!2zcy50OjMzfHMuZTpsfHAudjpvZmY!4e0" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 1382px; top: -273px; transition: opacity 200ms ease-out;">
<img src="https://mts1.googleapis.com/maps/vt?pb=!1m4!1m3!1i18!2i49649!3i105231!2m3!1e0!2sm!3i333088616!3m14!2sen-US!3sUS!5e18!12m1!1e47!12m3!1e37!2m1!1ssmartmaps!12m4!1e26!2m2!1sstyles!2zcy50OjMzfHMuZTpsfHAudjpvZmY!4e0" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 614px; top: -273px; transition: opacity 200ms ease-out;">
<img src="https://mts0.googleapis.com/maps/vt?pb=!1m4!1m3!1i18!2i49646!3i105231!2m3!1e0!2sm!3i333112376!3m14!2sen-US!3sUS!5e18!12m1!1e47!12m3!1e37!2m1!1ssmartmaps!12m4!1e26!2m2!1sstyles!2zcy50OjMzfHMuZTpsfHAudjpvZmY!4e0" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 614px; top: -17px; transition: opacity 200ms ease-out;">
<img src="https://mts0.googleapis.com/maps/vt?pb=!1m4!1m3!1i18!2i49646!3i105232!2m3!1e0!2sm!3i333112376!3m14!2sen-US!3sUS!5e18!12m1!1e47!12m3!1e37!2m1!1ssmartmaps!12m4!1e26!2m2!1sstyles!2zcy50OjMzfHMuZTpsfHAudjpvZmY!4e0" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 1382px; top: -17px; transition: opacity 200ms ease-out;">
<img src="https://mts1.googleapis.com/maps/vt?pb=!1m4!1m3!1i18!2i49649!3i105232!2m3!1e0!2sm!3i333088616!3m14!2sen-US!3sUS!5e18!12m1!1e47!12m3!1e37!2m1!1ssmartmaps!12m4!1e26!2m2!1sstyles!2zcy50OjMzfHMuZTpsfHAudjpvZmY!4e0" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 1382px; top: -529px; transition: opacity 200ms ease-out;">
<img src="https://mts1.googleapis.com/maps/vt?pb=!1m4!1m3!1i18!2i49649!3i105230!2m3!1e0!2sm!3i333088616!3m14!2sen-US!3sUS!5e18!12m1!1e47!12m3!1e37!2m1!1ssmartmaps!12m4!1e26!2m2!1sstyles!2zcy50OjMzfHMuZTpsfHAudjpvZmY!4e0" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 614px; top: -529px; transition: opacity 200ms ease-out;">
<img src="https://mts0.googleapis.com/maps/vt?pb=!1m4!1m3!1i18!2i49646!3i105230!2m3!1e0!2sm!3i333088616!3m14!2sen-US!3sUS!5e18!12m1!1e47!12m3!1e37!2m1!1ssmartmaps!12m4!1e26!2m2!1sstyles!2zcy50OjMzfHMuZTpsfHAudjpvZmY!4e0" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 1126px; top: 239px; transition: opacity 200ms ease-out;">
<img src="https://mts0.googleapis.com/maps/vt?pb=!1m4!1m3!1i18!2i49648!3i105233!2m3!1e0!2sm!3i333112376!3m14!2sen-US!3sUS!5e18!12m1!1e47!12m3!1e37!2m1!1ssmartmaps!12m4!1e26!2m2!1sstyles!2zcy50OjMzfHMuZTpsfHAudjpvZmY!4e0" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 870px; top: -785px; transition: opacity 200ms ease-out;">
<img src="https://mts1.googleapis.com/maps/vt?pb=!1m4!1m3!1i18!2i49647!3i105229!2m3!1e0!2sm!3i333088616!3m14!2sen-US!3sUS!5e18!12m1!1e47!12m3!1e37!2m1!1ssmartmaps!12m4!1e26!2m2!1sstyles!2zcy50OjMzfHMuZTpsfHAudjpvZmY!4e0" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 1126px; top: -785px; transition: opacity 200ms ease-out;">
<img src="https://mts0.googleapis.com/maps/vt?pb=!1m4!1m3!1i18!2i49648!3i105229!2m3!1e0!2sm!3i333088616!3m14!2sen-US!3sUS!5e18!12m1!1e47!12m3!1e37!2m1!1ssmartmaps!12m4!1e26!2m2!1sstyles!2zcy50OjMzfHMuZTpsfHAudjpvZmY!4e0" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 870px; top: 239px; transition: opacity 200ms ease-out;">
<img src="https://mts1.googleapis.com/maps/vt?pb=!1m4!1m3!1i18!2i49647!3i105233!2m3!1e0!2sm!3i333112376!3m14!2sen-US!3sUS!5e18!12m1!1e47!12m3!1e37!2m1!1ssmartmaps!12m4!1e26!2m2!1sstyles!2zcy50OjMzfHMuZTpsfHAudjpvZmY!4e0" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 1382px; top: -785px; transition: opacity 200ms ease-out;">
<img src="https://mts1.googleapis.com/maps/vt?pb=!1m4!1m3!1i18!2i49649!3i105229!2m3!1e0!2sm!3i333088616!3m14!2sen-US!3sUS!5e18!12m1!1e47!12m3!1e37!2m1!1ssmartmaps!12m4!1e26!2m2!1sstyles!2zcy50OjMzfHMuZTpsfHAudjpvZmY!4e0" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 614px; top: -785px; transition: opacity 200ms ease-out;">
<img src="https://mts0.googleapis.com/maps/vt?pb=!1m4!1m3!1i18!2i49646!3i105229!2m3!1e0!2sm!3i333088616!3m14!2sen-US!3sUS!5e18!12m1!1e47!12m3!1e37!2m1!1ssmartmaps!12m4!1e26!2m2!1sstyles!2zcy50OjMzfHMuZTpsfHAudjpvZmY!4e0" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 614px; top: 239px; transition: opacity 200ms ease-out;">
<img src="https://mts0.googleapis.com/maps/vt?pb=!1m4!1m3!1i18!2i49646!3i105233!2m3!1e0!2sm!3i333112376!3m14!2sen-US!3sUS!5e18!12m1!1e47!12m3!1e37!2m1!1ssmartmaps!12m4!1e26!2m2!1sstyles!2zcy50OjMzfHMuZTpsfHAudjpvZmY!4e0" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 1382px; top: 239px; transition: opacity 200ms ease-out;">
<img src="https://mts1.googleapis.com/maps/vt?pb=!1m4!1m3!1i18!2i49649!3i105233!2m3!1e0!2sm!3i333098695!3m14!2sen-US!3sUS!5e18!12m1!1e47!12m3!1e37!2m1!1ssmartmaps!12m4!1e26!2m2!1sstyles!2zcy50OjMzfHMuZTpsfHAudjpvZmY!4e0" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 1638px; top: -273px; transition: opacity 200ms ease-out;">
<img src="https://mts0.googleapis.com/maps/vt?pb=!1m4!1m3!1i18!2i49650!3i105231!2m3!1e0!2sm!3i333088616!3m14!2sen-US!3sUS!5e18!12m1!1e47!12m3!1e37!2m1!1ssmartmaps!12m4!1e26!2m2!1sstyles!2zcy50OjMzfHMuZTpsfHAudjpvZmY!4e0" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 358px; top: -273px; transition: opacity 200ms ease-out;">
<img src="https://mts1.googleapis.com/maps/vt?pb=!1m4!1m3!1i18!2i49645!3i105231!2m3!1e0!2sm!3i333112376!3m14!2sen-US!3sUS!5e18!12m1!1e47!12m3!1e37!2m1!1ssmartmaps!12m4!1e26!2m2!1sstyles!2zcy50OjMzfHMuZTpsfHAudjpvZmY!4e0" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 358px; top: -17px; transition: opacity 200ms ease-out;">
<img src="https://mts1.googleapis.com/maps/vt?pb=!1m4!1m3!1i18!2i49645!3i105232!2m3!1e0!2sm!3i333112376!3m14!2sen-US!3sUS!5e18!12m1!1e47!12m3!1e37!2m1!1ssmartmaps!12m4!1e26!2m2!1sstyles!2zcy50OjMzfHMuZTpsfHAudjpvZmY!4e0" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 1638px; top: -529px; transition: opacity 200ms ease-out;">
<img src="https://mts0.googleapis.com/maps/vt?pb=!1m4!1m3!1i18!2i49650!3i105230!2m3!1e0!2sm!3i333088616!3m14!2sen-US!3sUS!5e18!12m1!1e47!12m3!1e37!2m1!1ssmartmaps!12m4!1e26!2m2!1sstyles!2zcy50OjMzfHMuZTpsfHAudjpvZmY!4e0" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 1638px; top: -17px; transition: opacity 200ms ease-out;">
<img src="https://mts0.googleapis.com/maps/vt?pb=!1m4!1m3!1i18!2i49650!3i105232!2m3!1e0!2sm!3i333088616!3m14!2sen-US!3sUS!5e18!12m1!1e47!12m3!1e37!2m1!1ssmartmaps!12m4!1e26!2m2!1sstyles!2zcy50OjMzfHMuZTpsfHAudjpvZmY!4e0" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 358px; top: -529px; transition: opacity 200ms ease-out;">
<img src="https://mts1.googleapis.com/maps/vt?pb=!1m4!1m3!1i18!2i49645!3i105230!2m3!1e0!2sm!3i333088616!3m14!2sen-US!3sUS!5e18!12m1!1e47!12m3!1e37!2m1!1ssmartmaps!12m4!1e26!2m2!1sstyles!2zcy50OjMzfHMuZTpsfHAudjpvZmY!4e0" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 1638px; top: 239px; transition: opacity 200ms ease-out;">
<img src="https://mts0.googleapis.com/maps/vt?pb=!1m4!1m3!1i18!2i49650!3i105233!2m3!1e0!2sm!3i333098695!3m14!2sen-US!3sUS!5e18!12m1!1e47!12m3!1e37!2m1!1ssmartmaps!12m4!1e26!2m2!1sstyles!2zcy50OjMzfHMuZTpsfHAudjpvZmY!4e0" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 358px; top: 239px; transition: opacity 200ms ease-out;">
<img src="https://mts1.googleapis.com/maps/vt?pb=!1m4!1m3!1i18!2i49645!3i105233!2m3!1e0!2sm!3i333112376!3m14!2sen-US!3sUS!5e18!12m1!1e47!12m3!1e37!2m1!1ssmartmaps!12m4!1e26!2m2!1sstyles!2zcy50OjMzfHMuZTpsfHAudjpvZmY!4e0" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 1638px; top: -785px; transition: opacity 200ms ease-out;">
<img src="https://mts0.googleapis.com/maps/vt?pb=!1m4!1m3!1i18!2i49650!3i105229!2m3!1e0!2sm!3i333088616!3m14!2sen-US!3sUS!5e18!12m1!1e47!12m3!1e37!2m1!1ssmartmaps!12m4!1e26!2m2!1sstyles!2zcy50OjMzfHMuZTpsfHAudjpvZmY!4e0" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 358px; top: -785px; transition: opacity 200ms ease-out;">
<img src="https://mts1.googleapis.com/maps/vt?pb=!1m4!1m3!1i18!2i49645!3i105229!2m3!1e0!2sm!3i333088616!3m14!2sen-US!3sUS!5e18!12m1!1e47!12m3!1e37!2m1!1ssmartmaps!12m4!1e26!2m2!1sstyles!2zcy50OjMzfHMuZTpsfHAudjpvZmY!4e0" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 1894px; top: -273px; transition: opacity 200ms ease-out;">
<img src="https://mts1.googleapis.com/maps/vt?pb=!1m4!1m3!1i18!2i49651!3i105231!2m3!1e0!2sm!3i333088616!3m14!2sen-US!3sUS!5e18!12m1!1e47!12m3!1e37!2m1!1ssmartmaps!12m4!1e26!2m2!1sstyles!2zcy50OjMzfHMuZTpsfHAudjpvZmY!4e0" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 102px; top: -273px; transition: opacity 200ms ease-out;">
<img src="https://mts0.googleapis.com/maps/vt?pb=!1m4!1m3!1i18!2i49644!3i105231!2m3!1e0!2sm!3i333112376!3m14!2sen-US!3sUS!5e18!12m1!1e47!12m3!1e37!2m1!1ssmartmaps!12m4!1e26!2m2!1sstyles!2zcy50OjMzfHMuZTpsfHAudjpvZmY!4e0" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 102px; top: -17px; transition: opacity 200ms ease-out;">
<img src="https://mts0.googleapis.com/maps/vt?pb=!1m4!1m3!1i18!2i49644!3i105232!2m3!1e0!2sm!3i333112376!3m14!2sen-US!3sUS!5e18!12m1!1e47!12m3!1e37!2m1!1ssmartmaps!12m4!1e26!2m2!1sstyles!2zcy50OjMzfHMuZTpsfHAudjpvZmY!4e0" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 1894px; top: -529px; transition: opacity 200ms ease-out;">
<img src="https://mts1.googleapis.com/maps/vt?pb=!1m4!1m3!1i18!2i49651!3i105230!2m3!1e0!2sm!3i333088616!3m14!2sen-US!3sUS!5e18!12m1!1e47!12m3!1e37!2m1!1ssmartmaps!12m4!1e26!2m2!1sstyles!2zcy50OjMzfHMuZTpsfHAudjpvZmY!4e0" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 1894px; top: -17px; transition: opacity 200ms ease-out;">
<img src="https://mts1.googleapis.com/maps/vt?pb=!1m4!1m3!1i18!2i49651!3i105232!2m3!1e0!2sm!3i333088616!3m14!2sen-US!3sUS!5e18!12m1!1e47!12m3!1e37!2m1!1ssmartmaps!12m4!1e26!2m2!1sstyles!2zcy50OjMzfHMuZTpsfHAudjpvZmY!4e0" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 102px; top: -529px; transition: opacity 200ms ease-out;">
<img src="https://mts0.googleapis.com/maps/vt?pb=!1m4!1m3!1i18!2i49644!3i105230!2m3!1e0!2sm!3i333088616!3m14!2sen-US!3sUS!5e18!12m1!1e47!12m3!1e37!2m1!1ssmartmaps!12m4!1e26!2m2!1sstyles!2zcy50OjMzfHMuZTpsfHAudjpvZmY!4e0" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 102px; top: -785px; transition: opacity 200ms ease-out;">
<img src="https://mts0.googleapis.com/maps/vt?pb=!1m4!1m3!1i18!2i49644!3i105229!2m3!1e0!2sm!3i333088616!3m14!2sen-US!3sUS!5e18!12m1!1e47!12m3!1e37!2m1!1ssmartmaps!12m4!1e26!2m2!1sstyles!2zcy50OjMzfHMuZTpsfHAudjpvZmY!4e0" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 102px; top: 239px; transition: opacity 200ms ease-out;">
<img src="https://mts0.googleapis.com/maps/vt?pb=!1m4!1m3!1i18!2i49644!3i105233!2m3!1e0!2sm!3i333112376!3m14!2sen-US!3sUS!5e18!12m1!1e47!12m3!1e37!2m1!1ssmartmaps!12m4!1e26!2m2!1sstyles!2zcy50OjMzfHMuZTpsfHAudjpvZmY!4e0" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 1894px; top: -785px; transition: opacity 200ms ease-out;">
<img src="https://mts1.googleapis.com/maps/vt?pb=!1m4!1m3!1i18!2i49651!3i105229!2m3!1e0!2sm!3i333088616!3m14!2sen-US!3sUS!5e18!12m1!1e47!12m3!1e37!2m1!1ssmartmaps!12m4!1e26!2m2!1sstyles!2zcy50OjMzfHMuZTpsfHAudjpvZmY!4e0" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;">
</div>
<div style="width: 256px; height: 256px; transform: translateZ(0px); position: absolute; left: 1894px; top: 239px; transition: opacity 200ms ease-out;">
<img src="https://mts1.googleapis.com/maps/vt?pb=!1m4!1m3!1i18!2i49651!3i105233!2m3!1e0!2sm!3i333105176!3m14!2sen-US!3sUS!5e18!12m1!1e47!12m3!1e37!2m1!1ssmartmaps!12m4!1e26!2m2!1sstyles!2zcy50OjMzfHMuZTpsfHAudjpvZmY!4e0" draggable="false" style="width: 256px; height: 256px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;">
</div>
</div>
</div>
</div>
<div style="position: absolute; left: 0px; top: 0px; z-index: 2; width: 100%; height: 100%;">
</div>
<div style="position: absolute; left: 0px; top: 0px; z-index: 3; width: 100%; transform-origin: 0px 0px 0px; transform: matrix(1, 0, 0, 1, -308, 668);">
<div style="transform: translateZ(0px); position: absolute; left: 0px; top: 0px; z-index: 104; width: 100%;">
</div>
<div style="transform: translateZ(0px); position: absolute; left: 0px; top: 0px; z-index: 105; width: 100%;">
</div>
<div style="transform: translateZ(0px); position: absolute; left: 0px; top: 0px; z-index: 106; width: 100%;">
</div>
<div style="transform: translateZ(0px); position: absolute; left: 0px; top: 0px; z-index: 107; width: 100%;">
</div>
</div>
</div>
<div style="margin-left: 5px; margin-right: 5px; z-index: 1000000; position: absolute; left: 0px; bottom: 0px;">
<a target="_blank" href="https://maps.google.com/maps?ll=33.413736,-111.818306&amp;z=18&amp;t=m&amp;hl=en-US&amp;gl=US&amp;mapclient=apiv3" title="Click to see this area on Google Maps" style="position: static; overflow: visible; float: none; display: inline;">
<div style="width: 66px; height: 26px; cursor: pointer;">
<img src="https://maps.gstatic.com/mapfiles/api-3/images/google4.png" draggable="false" style="position: absolute; left: 0px; top: 0px; width: 66px; height: 26px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;">
</div>
</a>
</div>
<div style="padding: 15px 21px; border: 1px solid rgb(171, 171, 171); font-family: Roboto, Arial, sans-serif; color: rgb(34, 34, 34); box-shadow: rgba(0, 0, 0, 0.2) 0px 4px 16px; z-index: 10000002; display: none; width: 256px; height: 148px; position: absolute; left: 769px; top: 420px; background-color: white;">
<div style="padding: 0px 0px 10px; font-size: 16px;">
Map Data
</div>
<div style="font-size: 13px;">
Map data ©2015 Google
</div>
<div style="width: 13px; height: 13px; overflow: hidden; position: absolute; opacity: 0.7; right: 12px; top: 12px; z-index: 10000; cursor: pointer;">
<img src="https://maps.gstatic.com/mapfiles/api-3/images/mapcnt6.png" draggable="false" style="position: absolute; left: -2px; top: -336px; width: 59px; height: 492px; -webkit-user-select: none; border: 0px; padding: 0px; margin: 0px;">
</div>
</div>
<div class="gmnoprint" style="z-index: 1000001; position: absolute; right: 167px; bottom: 0px; width: 121px;">
<div draggable="false" class="gm-style-cc" style="-webkit-user-select: none;">
<div style="opacity: 0.7; width: 100%; height: 100%; position: absolute;">
<div style="width: 1px;">
</div>
<div style="width: auto; height: 100%; margin-left: 1px; background-color: rgb(245, 245, 245);">
</div>
</div>
<div style="position: relative; padding-right: 6px; padding-left: 6px; font-family: Roboto, Arial, sans-serif; font-size: 10px; color: rgb(68, 68, 68); white-space: nowrap; direction: ltr; text-align: right;">
<a style="color: rgb(68, 68, 68); text-decoration: none; cursor: pointer; display: none;">
Map Data
</a>
<span style="">
Map data ©2015 Google
</span>
</div>
</div>
</div>
<div class="gmnoscreen" style="position: absolute; right: 0px; bottom: 0px;">
<div style="font-family: Roboto, Arial, sans-serif; font-size: 11px; color: rgb(68, 68, 68); direction: ltr; text-align: right; background-color: rgb(245, 245, 245);">
Map data ©2015 Google
</div>
</div>
<div class="gmnoprint gm-style-cc" draggable="false" style="z-index: 1000001; -webkit-user-select: none; position: absolute; right: 95px; bottom: 0px;">
<div style="opacity: 0.7; width: 100%; height: 100%; position: absolute;">
<div style="width: 1px;">
</div>
<div style="width: auto; height: 100%; margin-left: 1px; background-color: rgb(245, 245, 245);">
</div>
</div>
<div style="position: relative; padding-right: 6px; padding-left: 6px; font-family: Roboto, Arial, sans-serif; font-size: 10px; color: rgb(68, 68, 68); white-space: nowrap; direction: ltr; text-align: right;">
<a href="https://www.google.com/intl/en-US_US/help/terms_maps.html" target="_blank" style="text-decoration: none; cursor: pointer; color: rgb(68, 68, 68);">
Terms of Use
</a>
</div>
</div>
<div draggable="false" class="gm-style-cc" style="-webkit-user-select: none; position: absolute; right: 0px; bottom: 0px;">
<div style="opacity: 0.7; width: 100%; height: 100%; position: absolute;">
<div style="width: 1px;">
</div>
<div style="width: auto; height: 100%; margin-left: 1px; background-color: rgb(245, 245, 245);">
</div>
</div>
<div style="position: relative; padding-right: 6px; padding-left: 6px; font-family: Roboto, Arial, sans-serif; font-size: 10px; color: rgb(68, 68, 68); white-space: nowrap; direction: ltr; text-align: right;">
<a target="_new" title="Report errors in the road map or imagery to Google" href="https://www.google.com/maps/@33.4137358,-111.8183059,18z/data=!10m1!1e1!12b1?source=apiv3&amp;rapsrc=apiv3" style="font-family: Roboto, Arial, sans-serif; font-size: 10px; color: rgb(68, 68, 68); text-decoration: none; position: relative;">
Report a map error
</a>
</div>
</div>
</div>
</div>
<div class="leaflet-map-pane" style="transform: translate3d(-5173px, 5518px, 0px);">
<div class="leaflet-tile-pane">
</div>
<div class="leaflet-objects-pane">
<div class="leaflet-shadow-pane leaflet-zoom-hide">
</div>
<div class="leaflet-overlay-pane">
<svg class="leaflet-zoom-animated" width="5514" height="3057" viewBox="3335 -6537 5514 3057" style="transform: translate3d(3335px, -6537px, 0px);">
<g>
<path stroke-linejoin="round" stroke-linecap="round" stroke="#514ac3" stroke-opacity="0.5" stroke-width="4" fill="none" class="leaflet-clickable" d="M0 0">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" stroke="#514ac3" stroke-opacity="0.5" stroke-width="4" fill="none" class="leaflet-clickable" d="M0 0">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" stroke="#514ac3" stroke-opacity="0.5" stroke-width="4" fill="none" class="leaflet-clickable" d="M0 0">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" stroke="#514ac3" stroke-opacity="0.5" stroke-width="4" fill="none" class="leaflet-clickable" d="M0 0">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" stroke="#514ac3" stroke-opacity="0.5" stroke-width="4" fill="none" class="leaflet-clickable" d="M0 0">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" stroke="#514ac3" stroke-opacity="0.5" stroke-width="4" fill="none" class="leaflet-clickable" d="M0 0">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" stroke="#514ac3" stroke-opacity="0.5" stroke-width="4" fill="none" class="leaflet-clickable" d="M0 0">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" stroke="#514ac3" stroke-opacity="0.5" stroke-width="4" fill="none" class="leaflet-clickable" d="M0 0">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" stroke="#514ac3" stroke-opacity="0.5" stroke-width="4" fill="none" class="leaflet-clickable" d="M0 0">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" stroke="#514ac3" stroke-opacity="0.5" stroke-width="4" fill="none" class="leaflet-clickable" d="M0 0">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" stroke="#514ac3" stroke-opacity="0.5" stroke-width="4" fill="none" class="leaflet-clickable" d="M0 0">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" stroke="#514ac3" stroke-opacity="0.5" stroke-width="4" fill="none" class="leaflet-clickable" d="M0 0">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" stroke="#514ac3" stroke-opacity="0.5" stroke-width="4" fill="none" class="leaflet-clickable" d="M0 0">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" stroke="#514ac3" stroke-opacity="0.5" stroke-width="4" fill="none" class="leaflet-clickable" d="M0 0">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" stroke="#514ac3" stroke-opacity="0.5" stroke-width="4" fill="none" class="leaflet-clickable" d="M0 0">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" stroke="#514ac3" stroke-opacity="0.5" stroke-width="4" fill="none" class="leaflet-clickable" d="M0 0">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" stroke="#514ac3" stroke-opacity="0.5" stroke-width="4" fill="none" class="leaflet-clickable" d="M0 0">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" stroke="#514ac3" stroke-opacity="0.5" stroke-width="4" fill="none" class="leaflet-clickable" d="M0 0">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" stroke="#514ac3" stroke-opacity="0.5" stroke-width="4" fill="none" class="leaflet-clickable" d="M0 0">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" stroke="#514ac3" stroke-opacity="0.5" stroke-width="4" fill="none" class="leaflet-clickable" d="M0 0">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" stroke="#514ac3" stroke-opacity="0.5" stroke-width="4" fill="none" class="leaflet-clickable" d="M0 0">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" stroke="#514ac3" stroke-opacity="0.5" stroke-width="4" fill="none" class="leaflet-clickable" d="M0 0">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" stroke="#514ac3" stroke-opacity="0.5" stroke-width="4" fill="none" class="leaflet-clickable" d="M0 0">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" stroke="#514ac3" stroke-opacity="0.5" stroke-width="4" fill="none" class="leaflet-clickable" d="M0 0">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" stroke="#514ac3" stroke-opacity="0.5" stroke-width="4" fill="none" class="leaflet-clickable" d="M0 0">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" stroke="#514ac3" stroke-opacity="0.5" stroke-width="4" fill="none" class="leaflet-clickable" d="M0 0">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" stroke="#514ac3" stroke-opacity="0.5" stroke-width="4" fill="none" class="leaflet-clickable" d="M0 0">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" stroke="#514ac3" stroke-opacity="0.5" stroke-width="4" fill="none" class="leaflet-clickable" d="M0 0">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" stroke="#514ac3" stroke-opacity="0.5" stroke-width="4" fill="none" class="leaflet-clickable" d="M0 0">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" pointer-events="none" stroke="#404000" stroke-opacity="1" stroke-width="3" fill="none" d="M5778,-4899A5,5,0,1,1,5777.9,-4899 z">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" pointer-events="none" stroke="#404000" stroke-opacity="1" stroke-width="3" fill="none" d="M5679,-4820A5,5,0,1,1,5678.9,-4820 z">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" pointer-events="none" stroke="#404000" stroke-opacity="1" stroke-width="3" fill="none" d="M5721,-4883.25A12.25,12.25,0,1,1,5720.9,-4883.25 z">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" pointer-events="none" stroke="#404000" stroke-opacity="1" stroke-width="3" fill="none" d="M5811,-5084.25A12.25,12.25,0,1,1,5810.9,-5084.25 z">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" pointer-events="none" stroke="#404000" stroke-opacity="1" stroke-width="3" fill="none" d="M5907,-4950.25A12.25,12.25,0,1,1,5906.9,-4950.25 z">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" pointer-events="none" stroke="#404000" stroke-opacity="1" stroke-width="3" fill="none" d="M5833,-4905.25A12.25,12.25,0,1,1,5832.9,-4905.25 z">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" pointer-events="none" stroke="#404000" stroke-opacity="1" stroke-width="3" fill="none" d="M5848,-4976.25A12.25,12.25,0,1,1,5847.9,-4976.25 z">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" pointer-events="none" stroke="#404000" stroke-opacity="1" stroke-width="2" stroke-dasharray="1,5" fill="none" d="M5778 -4894L5679 -4815L5721 -4871L5811 -5072L5907 -4938L5833 -4893L5848 -4964">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" pointer-events="none" stroke="#404000" stroke-opacity="1" stroke-width="3" fill="none" d="M5811,-5086A14,14,0,1,1,5810.9,-5086 z">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" pointer-events="none" stroke="#404000" stroke-opacity="1" stroke-width="3" fill="none" d="M5901,-4796.25A12.25,12.25,0,1,1,5900.9,-4796.25 z">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" pointer-events="none" stroke="#404000" stroke-opacity="1" stroke-width="3" fill="none" d="M5843,-4819.25A12.25,12.25,0,1,1,5842.9,-4819.25 z">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" pointer-events="none" stroke="#404000" stroke-opacity="1" stroke-width="3" fill="none" d="M5679,-4827.25A12.25,12.25,0,1,1,5678.9,-4827.25 z">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" pointer-events="none" stroke="#404000" stroke-opacity="1" stroke-width="3" fill="none" d="M5896,-4563.25A12.25,12.25,0,1,1,5895.9,-4563.25 z">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" pointer-events="none" stroke="#404000" stroke-opacity="1" stroke-width="3" fill="none" d="M5784,-4420A14,14,0,1,1,5783.9,-4420 z">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" pointer-events="none" stroke="#404000" stroke-opacity="1" stroke-width="2" stroke-dasharray="1,5" fill="none" d="M5811 -5072L5901 -4784L5843 -4807L5679 -4815L5896 -4551L5784 -4406">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" pointer-events="none" stroke="#404000" stroke-opacity="1" stroke-width="3" fill="none" d="M5857,-5377.25A12.25,12.25,0,1,1,5856.9,-5377.25 z">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" pointer-events="none" stroke="#404000" stroke-opacity="1" stroke-width="3" fill="none" d="M5860,-5421.25A12.25,12.25,0,1,1,5859.9,-5421.25 z">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" pointer-events="none" stroke="#404000" stroke-opacity="1" stroke-width="3" fill="none" d="M6023,-5375.25A12.25,12.25,0,1,1,6022.9,-5375.25 z">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" pointer-events="none" stroke="#404000" stroke-opacity="1" stroke-width="3" fill="none" d="M5937,-5479.25A12.25,12.25,0,1,1,5936.9,-5479.25 z">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" pointer-events="none" stroke="#404000" stroke-opacity="1" stroke-width="3" fill="none" d="M5860,-5496.25A12.25,12.25,0,1,1,5859.9,-5496.25 z">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" pointer-events="none" stroke="#404000" stroke-opacity="1" stroke-width="2" stroke-dasharray="1,5" fill="none" d="M5857 -5365L5860 -5409L6023 -5363L5937 -5467L5860 -5484">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" pointer-events="none" stroke="#404000" stroke-opacity="1" stroke-width="3" fill="none" d="M5686,-5411.25A12.25,12.25,0,1,1,5685.9,-5411.25 z">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" pointer-events="none" stroke="#404000" stroke-opacity="1" stroke-width="3" fill="none" d="M5367,-5321A14,14,0,1,1,5366.9,-5321 z">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" pointer-events="none" stroke="#404000" stroke-opacity="1" stroke-width="3" fill="none" d="M5173,-5274.25A12.25,12.25,0,1,1,5172.9,-5274.25 z">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" pointer-events="none" stroke="#404000" stroke-opacity="1" stroke-width="3" fill="none" d="M5250,-5106.25A12.25,12.25,0,1,1,5249.9,-5106.25 z">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" pointer-events="none" stroke="#404000" stroke-opacity="1" stroke-width="2" stroke-dasharray="1,5" fill="none" d="M5686 -5399L5367 -5307L5173 -5262L5250 -5094">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" pointer-events="none" stroke="#404000" stroke-opacity="1" stroke-width="3" fill="none" d="M4665,-5240.25A12.25,12.25,0,1,1,4664.9,-5240.25 z">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" pointer-events="none" stroke="#404000" stroke-opacity="1" stroke-width="3" fill="none" d="M4577,-5285A14,14,0,1,1,4576.9,-5285 z">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" pointer-events="none" stroke="#404000" stroke-opacity="1" stroke-width="3" fill="none" d="M4078,-5297.75A15.75,15.75,0,1,1,4077.9,-5297.75 z">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" pointer-events="none" stroke="#404000" stroke-opacity="1" stroke-width="3" fill="none" d="M4164,-5274.25A12.25,12.25,0,1,1,4163.9,-5274.25 z">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" pointer-events="none" stroke="#404000" stroke-opacity="1" stroke-width="3" fill="none" d="M4090,-5355.25A12.25,12.25,0,1,1,4089.9,-5355.25 z">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" pointer-events="none" stroke="#404000" stroke-opacity="1" stroke-width="3" fill="none" d="M4164,-5523.75A15.75,15.75,0,1,1,4163.9,-5523.75 z">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" pointer-events="none" stroke="#404000" stroke-opacity="1" stroke-width="2" stroke-dasharray="1,5" fill="none" d="M4665 -5228L4577 -5271L4078 -5282L4164 -5262L4090 -5343L4164 -5508">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" pointer-events="none" stroke="#404000" stroke-opacity="1" stroke-width="3" fill="none" d="M3792,-5289.25A12.25,12.25,0,1,1,3791.9,-5289.25 z">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" pointer-events="none" stroke="#404000" stroke-opacity="1" stroke-width="3" fill="none" d="M3816,-5288.25A12.25,12.25,0,1,1,3815.9,-5288.25 z">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" pointer-events="none" stroke="#404000" stroke-opacity="1" stroke-width="3" fill="none" d="M3882,-5373.75A15.75,15.75,0,1,1,3881.9,-5373.75 z">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" pointer-events="none" stroke="#404000" stroke-opacity="1" stroke-width="2" stroke-dasharray="1,5" fill="none" d="M3792 -5277L3816 -5276L3882 -5358">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" pointer-events="none" stroke="#A6A600" stroke-opacity="1" stroke-width="3" fill="none" d="M5778,-4905A11,11,0,1,1,5777.9,-4905 z">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" pointer-events="none" stroke="#A6A600" stroke-opacity="1" stroke-width="3" fill="none" d="M5848,-4975A11,11,0,1,1,5847.9,-4975 z">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" pointer-events="none" stroke="#A6A600" stroke-opacity="1" stroke-width="3" fill="none" d="M5811,-5084A12,12,0,1,1,5810.9,-5084 z">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" pointer-events="none" stroke="#A6A600" stroke-opacity="1" stroke-width="3" fill="none" d="M5857,-5376A11,11,0,1,1,5856.9,-5376 z">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" pointer-events="none" stroke="#A6A600" stroke-opacity="1" stroke-width="3" fill="none" d="M5686,-5410A11,11,0,1,1,5685.9,-5410 z">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" pointer-events="none" stroke="#A6A600" stroke-opacity="1" stroke-width="3" fill="none" d="M3993,-6014A11,11,0,1,1,3992.9,-6014 z">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M3860,-4778A7,7,0,1,1,3859.9,-4778 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M3771,-4792A7,7,0,1,1,3770.9,-4792 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M3367,-5449A7,7,0,1,1,3366.9,-5449 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M5129,-3769A7,7,0,1,1,5128.9,-3769 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M7651,-3671A7,7,0,1,1,7650.9,-3671 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M3990,-3667A7,7,0,1,1,3989.9,-3667 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M4019,-3555A7,7,0,1,1,4018.9,-3555 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#FF6600" stroke-opacity="1" stroke-width="2" fill="#FF6600" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M3597,-6203A7,7,0,1,1,3596.9,-6203 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#FF6600" stroke-opacity="1" stroke-width="2" fill="#FF6600" fill-opacity="0.5" d="M5686,-5406A7,7,0,1,1,5685.9,-5406 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M4062,-4126A7,7,0,1,1,4061.9,-4126 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#FF6600" stroke-opacity="1" stroke-width="2" fill="#FF6600" fill-opacity="0.5" d="M5130,-5243A7,7,0,1,1,5129.9,-5243 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#FF6600" stroke-opacity="1" stroke-width="2" fill="#FF6600" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#FF6600" stroke-opacity="1" stroke-width="2" fill="#FF6600" fill-opacity="0.5" d="M5086,-5880A7,7,0,1,1,5085.9,-5880 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M4656,-3893A7,7,0,1,1,4655.9,-3893 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#FF6600" stroke-opacity="1" stroke-width="2" fill="#FF6600" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M3604,-5549A7,7,0,1,1,3603.9,-5549 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#FF6600" stroke-opacity="1" stroke-width="2" fill="#FF6600" fill-opacity="0.5" d="M5150,-6108A7,7,0,1,1,5149.9,-6108 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#FF6600" stroke-opacity="1" stroke-width="2" fill="#FF6600" fill-opacity="0.5" d="M5860,-5491A7,7,0,1,1,5859.9,-5491 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M3664,-5382A7,7,0,1,1,3663.9,-5382 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M3367,-5349A7,7,0,1,1,3366.9,-5349 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#FF6600" stroke-opacity="1" stroke-width="2" fill="#FF6600" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M3568,-5585A7,7,0,1,1,3567.9,-5585 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#FF6600" stroke-opacity="1" stroke-width="2" fill="#FF6600" fill-opacity="0.5" d="M6023,-5370A7,7,0,1,1,6022.9,-5370 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M6937,-3641A7,7,0,1,1,6936.9,-3641 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M6231,-3659A7,7,0,1,1,6230.9,-3659 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="1" stroke-dasharray="1,2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="2" fill="#03DC03" fill-opacity="0.5" d="M7133,-4589A7,7,0,1,1,7132.9,-4589 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="2" fill="#0088FF" fill-opacity="0.5" d="M5937,-5474A7,7,0,1,1,5936.9,-5474 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="2" fill="#0088FF" fill-opacity="0.5" d="M5901,-4791A7,7,0,1,1,5900.9,-4791 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="2" fill="#0088FF" fill-opacity="0.5" d="M5843,-4814A7,7,0,1,1,5842.9,-4814 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="2" fill="#03DC03" fill-opacity="0.5" d="M8650,-4626A7,7,0,1,1,8649.9,-4626 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="2" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="2" fill="#03DC03" fill-opacity="0.5" d="M3993,-6010A7,7,0,1,1,3992.9,-6010 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="2" fill="#03DC03" fill-opacity="0.5" d="M5684,-5715A7,7,0,1,1,5683.9,-5715 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="2" fill="#03DC03" fill-opacity="0.5" d="M4090,-5350A7,7,0,1,1,4089.9,-5350 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="2" fill="#03DC03" fill-opacity="0.5" d="M4164,-5269A7,7,0,1,1,4163.9,-5269 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="2" fill="#03DC03" fill-opacity="0.5" d="M5250,-5101A7,7,0,1,1,5249.9,-5101 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="2" fill="#0088FF" fill-opacity="0.5" d="M5860,-5416A7,7,0,1,1,5859.9,-5416 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="2" fill="#03DC03" fill-opacity="0.5" d="M3816,-5283A7,7,0,1,1,3815.9,-5283 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="2" fill="#03DC03" fill-opacity="0.5" d="M5141,-6209A7,7,0,1,1,5140.9,-6209 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="2" fill="#03DC03" fill-opacity="0.5" d="M5688,-5823A7,7,0,1,1,5687.9,-5823 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="2" fill="#03DC03" fill-opacity="0.5" d="M5173,-5269A7,7,0,1,1,5172.9,-5269 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="2" fill="#0088FF" fill-opacity="0.5" d="M5679,-4822A7,7,0,1,1,5678.9,-4822 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="2" fill="#03DC03" fill-opacity="0.5" d="M5857,-5372A7,7,0,1,1,5856.9,-5372 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="2" fill="#0088FF" fill-opacity="0.5" d="M5778,-4901A7,7,0,1,1,5777.9,-4901 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="2" fill="#03DC03" fill-opacity="0.5" d="M5896,-4558A7,7,0,1,1,5895.9,-4558 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="2" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="2" fill="#0088FF" fill-opacity="0.5" d="M5721,-4879A8,8,0,1,1,5720.9,-4879 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="3" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="3" fill="#0088FF" fill-opacity="0.5" d="M5346,-6443A8,8,0,1,1,5345.9,-6443 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="3" fill="#0088FF" fill-opacity="0.5" d="M6011,-5852A8,8,0,1,1,6010.9,-5852 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="3" fill="#03DC03" fill-opacity="0.5" d="M5784,-4414A8,8,0,1,1,5783.9,-4414 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="3" fill="#03DC03" fill-opacity="0.5" d="M8681,-5526A8,8,0,1,1,8680.9,-5526 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="3" fill="#0088FF" fill-opacity="0.5" d="M5904,-5864A8,8,0,1,1,5903.9,-5864 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="3" fill="#0088FF" fill-opacity="0.5" d="M5389,-6356A8,8,0,1,1,5388.9,-6356 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="3" fill="#03DC03" fill-opacity="0.5" d="M5907,-4946A8,8,0,1,1,5906.9,-4946 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="3" fill="#03DC03" fill-opacity="0.5" d="M7657,-5473A8,8,0,1,1,7656.9,-5473 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="3" fill="#0088FF" fill-opacity="0.5" d="M5430,-6297A8,8,0,1,1,5429.9,-6297 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="3" fill="#0088FF" fill-opacity="0.5" d="M6039,-6103A8,8,0,1,1,6038.9,-6103 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="3" fill="#03DC03" fill-opacity="0.5" d="M5811,-5080A8,8,0,1,1,5810.9,-5080 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="3" fill="#03DC03" fill-opacity="0.5" d="M8553,-4998A8,8,0,1,1,8552.9,-4998 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="3" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="3" fill="#03DC03" fill-opacity="0.5" d="M4577,-5279A8,8,0,1,1,4576.9,-5279 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="3" fill="#03DC03" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="3" fill="#03DC03" fill-opacity="0.5" d="M4164,-5517A9,9,0,1,1,4163.9,-5517 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="3" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="3" fill="#03DC03" fill-opacity="0.5" d="M3882,-5367A9,9,0,1,1,3881.9,-5367 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="3" fill="#03DC03" fill-opacity="0.5" d="M7662,-5381A9,9,0,1,1,7661.9,-5381 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="3" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="3" fill="#03DC03" fill-opacity="0.5" d="M4078,-5291A9,9,0,1,1,4077.9,-5291 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="3" fill="#0088FF" fill-opacity="0.5" d="M5498,-6356A9,9,0,1,1,5497.9,-6356 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="3" fill="#03DC03" fill-opacity="0.5" d="M5068,-5344A9,9,0,1,1,5067.9,-5344 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="3" fill="#03DC03" fill-opacity="0.5" d="M5833,-4902A9,9,0,1,1,5832.9,-4902 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="3" fill="#03DC03" fill-opacity="0.5" d="M5367,-5316A9,9,0,1,1,5366.9,-5316 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#03DC03" stroke-opacity="1" stroke-width="4" fill="#03DC03" fill-opacity="0.5" d="M6891,-5366A10,10,0,1,1,6890.9,-5366 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#0088FF" stroke-opacity="1" stroke-width="4" fill="#0088FF" fill-opacity="0.5" d="M0 0" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" fill-rule="evenodd" stroke="#f0f" stroke-opacity="1" stroke-width="2" fill="#03DC03" fill-opacity="0.5" d="M5848,-4971A7,7,0,1,1,5847.9,-4971 z" class="leaflet-clickable">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" pointer-events="none" stroke="red" stroke-opacity="0.5" stroke-width="3" stroke-dasharray="10,10" fill="none" d="M8849 -6537L8849 -3480L3335 -3480L3335 -6537z">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" pointer-events="none" stroke="orange" stroke-opacity="0.5" stroke-width="2" fill="none" d="M5848,-5044A80,80,0,1,1,5847.9,-5044 z">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" pointer-events="none" stroke="#03DC03" stroke-opacity="0.8" stroke-width="6" stroke-dasharray="6,12" fill="none" d="M0 0">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" pointer-events="none" stroke="#7f7f00" stroke-opacity="1" stroke-width="3" fill="none" d="M5848,-4976.25A12.25,12.25,0,1,1,5847.9,-4976.25 z">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" pointer-events="none" stroke="#7f7f00" stroke-opacity="1" stroke-width="3" fill="none" d="M5778,-4906.25A12.25,12.25,0,1,1,5777.9,-4906.25 z">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" pointer-events="none" stroke="#7f7f00" stroke-opacity="1" stroke-width="3" fill="none" d="M5833,-4908.75A15.75,15.75,0,1,1,5832.9,-4908.75 z">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" pointer-events="none" stroke="#7f7f00" stroke-opacity="1" stroke-width="3" fill="none" d="M5721,-4885A14,14,0,1,1,5720.9,-4885 z">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" pointer-events="none" stroke="#7f7f00" stroke-opacity="1" stroke-width="3" fill="none" d="M5907,-4952A14,14,0,1,1,5906.9,-4952 z">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" pointer-events="none" stroke="#7f7f00" stroke-opacity="1" stroke-width="3" fill="none" d="M5679,-4827.25A12.25,12.25,0,1,1,5678.9,-4827.25 z">
</path>
</g>
<g>
<path stroke-linejoin="round" stroke-linecap="round" pointer-events="none" stroke="#7f7f00" stroke-opacity="1" stroke-width="2" stroke-dasharray="1,5" fill="none" d="M5848 -4964L5778 -4894L5833 -4893L5721 -4871L5907 -4938L5679 -4815">
</path>
</g>
</svg>
</div>
<div class="leaflet-marker-pane leaflet-zoom-hide">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAoCAMAAACo9wirAAAAzFBMVEXbuTR9YwDd0T+ulyry2VDt53/s5Jv34a+tmUbJtGRtVwAtJADg14j304viyIZeSwDXyH5IOQD07JLPvnhqVQBuWACmkjpgTQBxWwC4p1WchikRDQCPdxeBaAQTDwADAgAOCwAAAAAAAAAAAAALCQAAAAAAAAAAAAD9+Jb97IT+3VT9+WH+0i3993D+80793Yr/yXL+5Tr+6XL+zEP/z2X+vSX+zB/+52L/qw393SX89xr9+yv/siP/vUf9+Dv+20P+rgH+xQv+vgH+twNAe/b8AAAAKHRSTlPywvLj+vn4/OLrqFb0/PSS8Hb77meB4FGX5t1A2dUkEy8HDQoaAwEAoclaPQAAAo1JREFUeF5VkeeyozAMRrPphdwkdIxpBu7SSe/llvd/p5VxlMx+PxiMzhxJuPX3mc/PzzgIQwYJwyCGoyggwMuRav6BmKrLGgQBrBvUkuQkkSWLGh5DooX1UNWlXplDyp6kq5EXCqL1qlu9srpfIPeq7FmaIBCIA9WScyjznC/3XOZEEAsABIFBoH6GUrt9v5zPQEAXFoCiAWLPkUqon+8lIbl4kRwfmggABFZSXXh9PhbopUos1fWCBoAJnT4MCMMlZLHQE/Hed/wIFA3gkiSvqjLtK45tO/N+WlZVnhA7YgKAFZK83dGJM5v4rmFSonfaeWotoEcDhJqSVl06W0A5gviTGelWqTJzvZADcWjO11XVIzPbjzzGPFfT4bxWTD8SAANgtTrIQ8eF3QPmDOXDarWej/mUL+C0SgfU91gcR3TAj42BNQDMAMDpwBfzwjCi/cMJgNFMGGBIY5g+AACnrWl+NJay0+mRDhcAiDVdKsOnzJqZRFGoZo74SaYTXDPwzPnhUTw6dCSnaT2inUdRHD7GNgIxM/QUvrW6WfZ4ZFm3VRSiA4sFEEaOlBX7oij2EP4ssqlj413wHqq13uy/X9lvYAcbb5P3cGmd7b9/nvneZzWdNB0EAApN2RZvoNjCvfKb4IBQ+LTe7H5+RXabmjwFCISw6Xb3i8D2oxEgwMdkBgHF7xeEC/SF34yIAN90/LHdHb94QCB2REBsauj17cqB660eogAB8bOE4vgUsBiBt2J6ux6P19v0OQECb8V8y4G34D+AKwgoQEBQgMBLYSrL222pjHEFBN4KOl0up/wWUIAA/k5tNBg014gCBPB3+s5g0EwYYB2Bl8KyND9CAQJvgnmq6kYeXxHzDyATueNnvZcYAAAAAElFTkSuQmCC" class="leaflet-marker-icon leaflet-zoom-hide leaflet-clickable" title="Church" tabindex="0" style="margin-left: -15px; margin-top: -40px; width: 30px; height: 40px; transform: translate3d(5784px, -4406px, 0px); z-index: -4406;">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAoCAMAAACo9wirAAAAzFBMVEXbuTR9YwDd0T+ulyry2VDt53/s5Jv34a+tmUbJtGRtVwAtJADg14j304viyIZeSwDXyH5IOQD07JLPvnhqVQBuWACmkjpgTQBxWwC4p1WchikRDQCPdxeBaAQTDwADAgAOCwAAAAAAAAAAAAALCQAAAAAAAAAAAAD9+Jb97IT+3VT9+WH+0i3993D+80793Yr/yXL+5Tr+6XL+zEP/z2X+vSX+zB/+52L/qw393SX89xr9+yv/siP/vUf9+Dv+20P+rgH+xQv+vgH+twNAe/b8AAAAKHRSTlPywvLj+vn4/OLrqFb0/PSS8Hb77meB4FGX5t1A2dUkEy8HDQoaAwEAoclaPQAAAo1JREFUeF5VkeeyozAMRrPphdwkdIxpBu7SSe/llvd/p5VxlMx+PxiMzhxJuPX3mc/PzzgIQwYJwyCGoyggwMuRav6BmKrLGgQBrBvUkuQkkSWLGh5DooX1UNWlXplDyp6kq5EXCqL1qlu9srpfIPeq7FmaIBCIA9WScyjznC/3XOZEEAsABIFBoH6GUrt9v5zPQEAXFoCiAWLPkUqon+8lIbl4kRwfmggABFZSXXh9PhbopUos1fWCBoAJnT4MCMMlZLHQE/Hed/wIFA3gkiSvqjLtK45tO/N+WlZVnhA7YgKAFZK83dGJM5v4rmFSonfaeWotoEcDhJqSVl06W0A5gviTGelWqTJzvZADcWjO11XVIzPbjzzGPFfT4bxWTD8SAANgtTrIQ8eF3QPmDOXDarWej/mUL+C0SgfU91gcR3TAj42BNQDMAMDpwBfzwjCi/cMJgNFMGGBIY5g+AACnrWl+NJay0+mRDhcAiDVdKsOnzJqZRFGoZo74SaYTXDPwzPnhUTw6dCSnaT2inUdRHD7GNgIxM/QUvrW6WfZ4ZFm3VRSiA4sFEEaOlBX7oij2EP4ssqlj413wHqq13uy/X9lvYAcbb5P3cGmd7b9/nvneZzWdNB0EAApN2RZvoNjCvfKb4IBQ+LTe7H5+RXabmjwFCISw6Xb3i8D2oxEgwMdkBgHF7xeEC/SF34yIAN90/LHdHb94QCB2REBsauj17cqB660eogAB8bOE4vgUsBiBt2J6ux6P19v0OQECb8V8y4G34D+AKwgoQEBQgMBLYSrL222pjHEFBN4KOl0up/wWUIAA/k5tNBg014gCBPB3+s5g0EwYYB2Bl8KyND9CAQJvgnmq6kYeXxHzDyATueNnvZcYAAAAAElFTkSuQmCC" class="leaflet-marker-icon leaflet-zoom-hide leaflet-clickable" title="Mesa Temple Spire" tabindex="0" style="margin-left: -15px; margin-top: -40px; width: 30px; height: 40px; transform: translate3d(5896px, -4551px, 0px); z-index: -4551;">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAoCAMAAACo9wirAAAAzFBMVEXbuTR9YwDd0T+ulyry2VDt53/s5Jv34a+tmUbJtGRtVwAtJADg14j304viyIZeSwDXyH5IOQD07JLPvnhqVQBuWACmkjpgTQBxWwC4p1WchikRDQCPdxeBaAQTDwADAgAOCwAAAAAAAAAAAAALCQAAAAAAAAAAAAD9+Jb97IT+3VT9+WH+0i3993D+80793Yr/yXL+5Tr+6XL+zEP/z2X+vSX+zB/+52L/qw393SX89xr9+yv/siP/vUf9+Dv+20P+rgH+xQv+vgH+twNAe/b8AAAAKHRSTlPywvLj+vn4/OLrqFb0/PSS8Hb77meB4FGX5t1A2dUkEy8HDQoaAwEAoclaPQAAAo1JREFUeF5VkeeyozAMRrPphdwkdIxpBu7SSe/llvd/p5VxlMx+PxiMzhxJuPX3mc/PzzgIQwYJwyCGoyggwMuRav6BmKrLGgQBrBvUkuQkkSWLGh5DooX1UNWlXplDyp6kq5EXCqL1qlu9srpfIPeq7FmaIBCIA9WScyjznC/3XOZEEAsABIFBoH6GUrt9v5zPQEAXFoCiAWLPkUqon+8lIbl4kRwfmggABFZSXXh9PhbopUos1fWCBoAJnT4MCMMlZLHQE/Hed/wIFA3gkiSvqjLtK45tO/N+WlZVnhA7YgKAFZK83dGJM5v4rmFSonfaeWotoEcDhJqSVl06W0A5gviTGelWqTJzvZADcWjO11XVIzPbjzzGPFfT4bxWTD8SAANgtTrIQ8eF3QPmDOXDarWej/mUL+C0SgfU91gcR3TAj42BNQDMAMDpwBfzwjCi/cMJgNFMGGBIY5g+AACnrWl+NJay0+mRDhcAiDVdKsOnzJqZRFGoZo74SaYTXDPwzPnhUTw6dCSnaT2inUdRHD7GNgIxM/QUvrW6WfZ4ZFm3VRSiA4sFEEaOlBX7oij2EP4ssqlj413wHqq13uy/X9lvYAcbb5P3cGmd7b9/nvneZzWdNB0EAApN2RZvoNjCvfKb4IBQ+LTe7H5+RXabmjwFCISw6Xb3i8D2oxEgwMdkBgHF7xeEC/SF34yIAN90/LHdHb94QCB2REBsauj17cqB660eogAB8bOE4vgUsBiBt2J6ux6P19v0OQECb8V8y4G34D+AKwgoQEBQgMBLYSrL222pjHEFBN4KOl0up/wWUIAA/k5tNBg014gCBPB3+s5g0EwYYB2Bl8KyND9CAQJvgnmq6kYeXxHzDyATueNnvZcYAAAAAElFTkSuQmCC" class="leaflet-marker-icon leaflet-zoom-hide leaflet-clickable" title="Lion Head Fountain" tabindex="0" style="margin-left: -15px; margin-top: -40px; width: 30px; height: 40px; transform: translate3d(5901px, -4784px, 0px); z-index: -4784;">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAoCAMAAACo9wirAAAAzFBMVEXbuTR9YwDd0T+ulyry2VDt53/s5Jv34a+tmUbJtGRtVwAtJADg14j304viyIZeSwDXyH5IOQD07JLPvnhqVQBuWACmkjpgTQBxWwC4p1WchikRDQCPdxeBaAQTDwADAgAOCwAAAAAAAAAAAAALCQAAAAAAAAAAAAD9+Jb97IT+3VT9+WH+0i3993D+80793Yr/yXL+5Tr+6XL+zEP/z2X+vSX+zB/+52L/qw393SX89xr9+yv/siP/vUf9+Dv+20P+rgH+xQv+vgH+twNAe/b8AAAAKHRSTlPywvLj+vn4/OLrqFb0/PSS8Hb77meB4FGX5t1A2dUkEy8HDQoaAwEAoclaPQAAAo1JREFUeF5VkeeyozAMRrPphdwkdIxpBu7SSe/llvd/p5VxlMx+PxiMzhxJuPX3mc/PzzgIQwYJwyCGoyggwMuRav6BmKrLGgQBrBvUkuQkkSWLGh5DooX1UNWlXplDyp6kq5EXCqL1qlu9srpfIPeq7FmaIBCIA9WScyjznC/3XOZEEAsABIFBoH6GUrt9v5zPQEAXFoCiAWLPkUqon+8lIbl4kRwfmggABFZSXXh9PhbopUos1fWCBoAJnT4MCMMlZLHQE/Hed/wIFA3gkiSvqjLtK45tO/N+WlZVnhA7YgKAFZK83dGJM5v4rmFSonfaeWotoEcDhJqSVl06W0A5gviTGelWqTJzvZADcWjO11XVIzPbjzzGPFfT4bxWTD8SAANgtTrIQ8eF3QPmDOXDarWej/mUL+C0SgfU91gcR3TAj42BNQDMAMDpwBfzwjCi/cMJgNFMGGBIY5g+AACnrWl+NJay0+mRDhcAiDVdKsOnzJqZRFGoZo74SaYTXDPwzPnhUTw6dCSnaT2inUdRHD7GNgIxM/QUvrW6WfZ4ZFm3VRSiA4sFEEaOlBX7oij2EP4ssqlj413wHqq13uy/X9lvYAcbb5P3cGmd7b9/nvneZzWdNB0EAApN2RZvoNjCvfKb4IBQ+LTe7H5+RXabmjwFCISw6Xb3i8D2oxEgwMdkBgHF7xeEC/SF34yIAN90/LHdHb94QCB2REBsauj17cqB660eogAB8bOE4vgUsBiBt2J6ux6P19v0OQECb8V8y4G34D+AKwgoQEBQgMBLYSrL222pjHEFBN4KOl0up/wWUIAA/k5tNBg014gCBPB3+s5g0EwYYB2Bl8KyND9CAQJvgnmq6kYeXxHzDyATueNnvZcYAAAAAElFTkSuQmCC" class="leaflet-marker-icon leaflet-zoom-hide leaflet-clickable" title="House of the Lord Temple" tabindex="0" style="margin-left: -15px; margin-top: -40px; width: 30px; height: 40px; transform: translate3d(5843px, -4807px, 0px); z-index: -4807;">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAoCAMAAACo9wirAAAAzFBMVEXbuTR9YwDd0T+ulyry2VDt53/s5Jv34a+tmUbJtGRtVwAtJADg14j304viyIZeSwDXyH5IOQD07JLPvnhqVQBuWACmkjpgTQBxWwC4p1WchikRDQCPdxeBaAQTDwADAgAOCwAAAAAAAAAAAAALCQAAAAAAAAAAAAD9+Jb97IT+3VT9+WH+0i3993D+80793Yr/yXL+5Tr+6XL+zEP/z2X+vSX+zB/+52L/qw393SX89xr9+yv/siP/vUf9+Dv+20P+rgH+xQv+vgH+twNAe/b8AAAAKHRSTlPywvLj+vn4/OLrqFb0/PSS8Hb77meB4FGX5t1A2dUkEy8HDQoaAwEAoclaPQAAAo1JREFUeF5VkeeyozAMRrPphdwkdIxpBu7SSe/llvd/p5VxlMx+PxiMzhxJuPX3mc/PzzgIQwYJwyCGoyggwMuRav6BmKrLGgQBrBvUkuQkkSWLGh5DooX1UNWlXplDyp6kq5EXCqL1qlu9srpfIPeq7FmaIBCIA9WScyjznC/3XOZEEAsABIFBoH6GUrt9v5zPQEAXFoCiAWLPkUqon+8lIbl4kRwfmggABFZSXXh9PhbopUos1fWCBoAJnT4MCMMlZLHQE/Hed/wIFA3gkiSvqjLtK45tO/N+WlZVnhA7YgKAFZK83dGJM5v4rmFSonfaeWotoEcDhJqSVl06W0A5gviTGelWqTJzvZADcWjO11XVIzPbjzzGPFfT4bxWTD8SAANgtTrIQ8eF3QPmDOXDarWej/mUL+C0SgfU91gcR3TAj42BNQDMAMDpwBfzwjCi/cMJgNFMGGBIY5g+AACnrWl+NJay0+mRDhcAiDVdKsOnzJqZRFGoZo74SaYTXDPwzPnhUTw6dCSnaT2inUdRHD7GNgIxM/QUvrW6WfZ4ZFm3VRSiA4sFEEaOlBX7oij2EP4ssqlj413wHqq13uy/X9lvYAcbb5P3cGmd7b9/nvneZzWdNB0EAApN2RZvoNjCvfKb4IBQ+LTe7H5+RXabmjwFCISw6Xb3i8D2oxEgwMdkBgHF7xeEC/SF34yIAN90/LHdHb94QCB2REBsauj17cqB660eogAB8bOE4vgUsBiBt2J6ux6P19v0OQECb8V8y4G34D+AKwgoQEBQgMBLYSrL222pjHEFBN4KOl0up/wWUIAA/k5tNBg014gCBPB3+s5g0EwYYB2Bl8KyND9CAQJvgnmq6kYeXxHzDyATueNnvZcYAAAAAElFTkSuQmCC" class="leaflet-marker-icon leaflet-zoom-hide leaflet-clickable" title="Mesa Arizona Temple" tabindex="0" style="margin-left: -15px; margin-top: -40px; width: 30px; height: 40px; transform: translate3d(5679px, -4815px, 0px); z-index: -4815;">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAoCAMAAACo9wirAAAAzFBMVEXbuTR9YwDd0T+ulyry2VDt53/s5Jv34a+tmUbJtGRtVwAtJADg14j304viyIZeSwDXyH5IOQD07JLPvnhqVQBuWACmkjpgTQBxWwC4p1WchikRDQCPdxeBaAQTDwADAgAOCwAAAAAAAAAAAAALCQAAAAAAAAAAAAD9+Jb97IT+3VT9+WH+0i3993D+80793Yr/yXL+5Tr+6XL+zEP/z2X+vSX+zB/+52L/qw393SX89xr9+yv/siP/vUf9+Dv+20P+rgH+xQv+vgH+twNAe/b8AAAAKHRSTlPywvLj+vn4/OLrqFb0/PSS8Hb77meB4FGX5t1A2dUkEy8HDQoaAwEAoclaPQAAAo1JREFUeF5VkeeyozAMRrPphdwkdIxpBu7SSe/llvd/p5VxlMx+PxiMzhxJuPX3mc/PzzgIQwYJwyCGoyggwMuRav6BmKrLGgQBrBvUkuQkkSWLGh5DooX1UNWlXplDyp6kq5EXCqL1qlu9srpfIPeq7FmaIBCIA9WScyjznC/3XOZEEAsABIFBoH6GUrt9v5zPQEAXFoCiAWLPkUqon+8lIbl4kRwfmggABFZSXXh9PhbopUos1fWCBoAJnT4MCMMlZLHQE/Hed/wIFA3gkiSvqjLtK45tO/N+WlZVnhA7YgKAFZK83dGJM5v4rmFSonfaeWotoEcDhJqSVl06W0A5gviTGelWqTJzvZADcWjO11XVIzPbjzzGPFfT4bxWTD8SAANgtTrIQ8eF3QPmDOXDarWej/mUL+C0SgfU91gcR3TAj42BNQDMAMDpwBfzwjCi/cMJgNFMGGBIY5g+AACnrWl+NJay0+mRDhcAiDVdKsOnzJqZRFGoZo74SaYTXDPwzPnhUTw6dCSnaT2inUdRHD7GNgIxM/QUvrW6WfZ4ZFm3VRSiA4sFEEaOlBX7oij2EP4ssqlj413wHqq13uy/X9lvYAcbb5P3cGmd7b9/nvneZzWdNB0EAApN2RZvoNjCvfKb4IBQ+LTe7H5+RXabmjwFCISw6Xb3i8D2oxEgwMdkBgHF7xeEC/SF34yIAN90/LHdHb94QCB2REBsauj17cqB660eogAB8bOE4vgUsBiBt2J6ux6P19v0OQECb8V8y4G34D+AKwgoQEBQgMBLYSrL222pjHEFBN4KOl0up/wWUIAA/k5tNBg014gCBPB3+s5g0EwYYB2Bl8KyND9CAQJvgnmq6kYeXxHzDyATueNnvZcYAAAAAElFTkSuQmCC" class="leaflet-marker-icon leaflet-zoom-hide leaflet-clickable" title="Mesa Arizona Temple" tabindex="0" style="margin-left: -15px; margin-top: -40px; width: 30px; height: 40px; transform: translate3d(5721px, -4871px, 0px); z-index: -4871;">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAoCAMAAACo9wirAAAAzFBMVEXbuTR9YwDd0T+ulyry2VDt53/s5Jv34a+tmUbJtGRtVwAtJADg14j304viyIZeSwDXyH5IOQD07JLPvnhqVQBuWACmkjpgTQBxWwC4p1WchikRDQCPdxeBaAQTDwADAgAOCwAAAAAAAAAAAAALCQAAAAAAAAAAAAD9+Jb97IT+3VT9+WH+0i3993D+80793Yr/yXL+5Tr+6XL+zEP/z2X+vSX+zB/+52L/qw393SX89xr9+yv/siP/vUf9+Dv+20P+rgH+xQv+vgH+twNAe/b8AAAAKHRSTlPywvLj+vn4/OLrqFb0/PSS8Hb77meB4FGX5t1A2dUkEy8HDQoaAwEAoclaPQAAAo1JREFUeF5VkeeyozAMRrPphdwkdIxpBu7SSe/llvd/p5VxlMx+PxiMzhxJuPX3mc/PzzgIQwYJwyCGoyggwMuRav6BmKrLGgQBrBvUkuQkkSWLGh5DooX1UNWlXplDyp6kq5EXCqL1qlu9srpfIPeq7FmaIBCIA9WScyjznC/3XOZEEAsABIFBoH6GUrt9v5zPQEAXFoCiAWLPkUqon+8lIbl4kRwfmggABFZSXXh9PhbopUos1fWCBoAJnT4MCMMlZLHQE/Hed/wIFA3gkiSvqjLtK45tO/N+WlZVnhA7YgKAFZK83dGJM5v4rmFSonfaeWotoEcDhJqSVl06W0A5gviTGelWqTJzvZADcWjO11XVIzPbjzzGPFfT4bxWTD8SAANgtTrIQ8eF3QPmDOXDarWej/mUL+C0SgfU91gcR3TAj42BNQDMAMDpwBfzwjCi/cMJgNFMGGBIY5g+AACnrWl+NJay0+mRDhcAiDVdKsOnzJqZRFGoZo74SaYTXDPwzPnhUTw6dCSnaT2inUdRHD7GNgIxM/QUvrW6WfZ4ZFm3VRSiA4sFEEaOlBX7oij2EP4ssqlj413wHqq13uy/X9lvYAcbb5P3cGmd7b9/nvneZzWdNB0EAApN2RZvoNjCvfKb4IBQ+LTe7H5+RXabmjwFCISw6Xb3i8D2oxEgwMdkBgHF7xeEC/SF34yIAN90/LHdHb94QCB2REBsauj17cqB660eogAB8bOE4vgUsBiBt2J6ux6P19v0OQECb8V8y4G34D+AKwgoQEBQgMBLYSrL222pjHEFBN4KOl0up/wWUIAA/k5tNBg014gCBPB3+s5g0EwYYB2Bl8KyND9CAQJvgnmq6kYeXxHzDyATueNnvZcYAAAAAElFTkSuQmCC" class="leaflet-marker-icon leaflet-zoom-hide leaflet-clickable" title="Petrified Wood Monument II" tabindex="0" style="margin-left: -15px; margin-top: -40px; width: 30px; height: 40px; transform: translate3d(5778px, -4894px, 0px); z-index: -4894;">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAoCAMAAACo9wirAAAAzFBMVEXbuTR9YwDd0T+ulyry2VDt53/s5Jv34a+tmUbJtGRtVwAtJADg14j304viyIZeSwDXyH5IOQD07JLPvnhqVQBuWACmkjpgTQBxWwC4p1WchikRDQCPdxeBaAQTDwADAgAOCwAAAAAAAAAAAAALCQAAAAAAAAAAAAD9+Jb97IT+3VT9+WH+0i3993D+80793Yr/yXL+5Tr+6XL+zEP/z2X+vSX+zB/+52L/qw393SX89xr9+yv/siP/vUf9+Dv+20P+rgH+xQv+vgH+twNAe/b8AAAAKHRSTlPywvLj+vn4/OLrqFb0/PSS8Hb77meB4FGX5t1A2dUkEy8HDQoaAwEAoclaPQAAAo1JREFUeF5VkeeyozAMRrPphdwkdIxpBu7SSe/llvd/p5VxlMx+PxiMzhxJuPX3mc/PzzgIQwYJwyCGoyggwMuRav6BmKrLGgQBrBvUkuQkkSWLGh5DooX1UNWlXplDyp6kq5EXCqL1qlu9srpfIPeq7FmaIBCIA9WScyjznC/3XOZEEAsABIFBoH6GUrt9v5zPQEAXFoCiAWLPkUqon+8lIbl4kRwfmggABFZSXXh9PhbopUos1fWCBoAJnT4MCMMlZLHQE/Hed/wIFA3gkiSvqjLtK45tO/N+WlZVnhA7YgKAFZK83dGJM5v4rmFSonfaeWotoEcDhJqSVl06W0A5gviTGelWqTJzvZADcWjO11XVIzPbjzzGPFfT4bxWTD8SAANgtTrIQ8eF3QPmDOXDarWej/mUL+C0SgfU91gcR3TAj42BNQDMAMDpwBfzwjCi/cMJgNFMGGBIY5g+AACnrWl+NJay0+mRDhcAiDVdKsOnzJqZRFGoZo74SaYTXDPwzPnhUTw6dCSnaT2inUdRHD7GNgIxM/QUvrW6WfZ4ZFm3VRSiA4sFEEaOlBX7oij2EP4ssqlj413wHqq13uy/X9lvYAcbb5P3cGmd7b9/nvneZzWdNB0EAApN2RZvoNjCvfKb4IBQ+LTe7H5+RXabmjwFCISw6Xb3i8D2oxEgwMdkBgHF7xeEC/SF34yIAN90/LHdHb94QCB2REBsauj17cqB660eogAB8bOE4vgUsBiBt2J6ux6P19v0OQECb8V8y4G34D+AKwgoQEBQgMBLYSrL222pjHEFBN4KOl0up/wWUIAA/k5tNBg014gCBPB3+s5g0EwYYB2Bl8KyND9CAQJvgnmq6kYeXxHzDyATueNnvZcYAAAAAElFTkSuQmCC" class="leaflet-marker-icon leaflet-zoom-hide leaflet-clickable" title="Large Fountain" tabindex="0" style="margin-left: -15px; margin-top: -40px; width: 30px; height: 40px; transform: translate3d(5833px, -4893px, 0px); z-index: -4893;">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAoCAMAAACo9wirAAAAzFBMVEXbuTR9YwDd0T+ulyry2VDt53/s5Jv34a+tmUbJtGRtVwAtJADg14j304viyIZeSwDXyH5IOQD07JLPvnhqVQBuWACmkjpgTQBxWwC4p1WchikRDQCPdxeBaAQTDwADAgAOCwAAAAAAAAAAAAALCQAAAAAAAAAAAAD9+Jb97IT+3VT9+WH+0i3993D+80793Yr/yXL+5Tr+6XL+zEP/z2X+vSX+zB/+52L/qw393SX89xr9+yv/siP/vUf9+Dv+20P+rgH+xQv+vgH+twNAe/b8AAAAKHRSTlPywvLj+vn4/OLrqFb0/PSS8Hb77meB4FGX5t1A2dUkEy8HDQoaAwEAoclaPQAAAo1JREFUeF5VkeeyozAMRrPphdwkdIxpBu7SSe/llvd/p5VxlMx+PxiMzhxJuPX3mc/PzzgIQwYJwyCGoyggwMuRav6BmKrLGgQBrBvUkuQkkSWLGh5DooX1UNWlXplDyp6kq5EXCqL1qlu9srpfIPeq7FmaIBCIA9WScyjznC/3XOZEEAsABIFBoH6GUrt9v5zPQEAXFoCiAWLPkUqon+8lIbl4kRwfmggABFZSXXh9PhbopUos1fWCBoAJnT4MCMMlZLHQE/Hed/wIFA3gkiSvqjLtK45tO/N+WlZVnhA7YgKAFZK83dGJM5v4rmFSonfaeWotoEcDhJqSVl06W0A5gviTGelWqTJzvZADcWjO11XVIzPbjzzGPFfT4bxWTD8SAANgtTrIQ8eF3QPmDOXDarWej/mUL+C0SgfU91gcR3TAj42BNQDMAMDpwBfzwjCi/cMJgNFMGGBIY5g+AACnrWl+NJay0+mRDhcAiDVdKsOnzJqZRFGoZo74SaYTXDPwzPnhUTw6dCSnaT2inUdRHD7GNgIxM/QUvrW6WfZ4ZFm3VRSiA4sFEEaOlBX7oij2EP4ssqlj413wHqq13uy/X9lvYAcbb5P3cGmd7b9/nvneZzWdNB0EAApN2RZvoNjCvfKb4IBQ+LTe7H5+RXabmjwFCISw6Xb3i8D2oxEgwMdkBgHF7xeEC/SF34yIAN90/LHdHb94QCB2REBsauj17cqB660eogAB8bOE4vgUsBiBt2J6ux6P19v0OQECb8V8y4G34D+AKwgoQEBQgMBLYSrL222pjHEFBN4KOl0up/wWUIAA/k5tNBg014gCBPB3+s5g0EwYYB2Bl8KyND9CAQJvgnmq6kYeXxHzDyATueNnvZcYAAAAAElFTkSuQmCC" class="leaflet-marker-icon leaflet-zoom-hide leaflet-clickable" title="Rock Art" tabindex="0" style="margin-left: -15px; margin-top: -40px; width: 30px; height: 40px; transform: translate3d(5907px, -4938px, 0px); z-index: -4938;">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAoCAMAAACo9wirAAAAzFBMVEXbuTR9YwDd0T+ulyry2VDt53/s5Jv34a+tmUbJtGRtVwAtJADg14j304viyIZeSwDXyH5IOQD07JLPvnhqVQBuWACmkjpgTQBxWwC4p1WchikRDQCPdxeBaAQTDwADAgAOCwAAAAAAAAAAAAALCQAAAAAAAAAAAAD9+Jb97IT+3VT9+WH+0i3993D+80793Yr/yXL+5Tr+6XL+zEP/z2X+vSX+zB/+52L/qw393SX89xr9+yv/siP/vUf9+Dv+20P+rgH+xQv+vgH+twNAe/b8AAAAKHRSTlPywvLj+vn4/OLrqFb0/PSS8Hb77meB4FGX5t1A2dUkEy8HDQoaAwEAoclaPQAAAo1JREFUeF5VkeeyozAMRrPphdwkdIxpBu7SSe/llvd/p5VxlMx+PxiMzhxJuPX3mc/PzzgIQwYJwyCGoyggwMuRav6BmKrLGgQBrBvUkuQkkSWLGh5DooX1UNWlXplDyp6kq5EXCqL1qlu9srpfIPeq7FmaIBCIA9WScyjznC/3XOZEEAsABIFBoH6GUrt9v5zPQEAXFoCiAWLPkUqon+8lIbl4kRwfmggABFZSXXh9PhbopUos1fWCBoAJnT4MCMMlZLHQE/Hed/wIFA3gkiSvqjLtK45tO/N+WlZVnhA7YgKAFZK83dGJM5v4rmFSonfaeWotoEcDhJqSVl06W0A5gviTGelWqTJzvZADcWjO11XVIzPbjzzGPFfT4bxWTD8SAANgtTrIQ8eF3QPmDOXDarWej/mUL+C0SgfU91gcR3TAj42BNQDMAMDpwBfzwjCi/cMJgNFMGGBIY5g+AACnrWl+NJay0+mRDhcAiDVdKsOnzJqZRFGoZo74SaYTXDPwzPnhUTw6dCSnaT2inUdRHD7GNgIxM/QUvrW6WfZ4ZFm3VRSiA4sFEEaOlBX7oij2EP4ssqlj413wHqq13uy/X9lvYAcbb5P3cGmd7b9/nvneZzWdNB0EAApN2RZvoNjCvfKb4IBQ+LTe7H5+RXabmjwFCISw6Xb3i8D2oxEgwMdkBgHF7xeEC/SF34yIAN90/LHdHb94QCB2REBsauj17cqB660eogAB8bOE4vgUsBiBt2J6ux6P19v0OQECb8V8y4G34D+AKwgoQEBQgMBLYSrL222pjHEFBN4KOl0up/wWUIAA/k5tNBg014gCBPB3+s5g0EwYYB2Bl8KyND9CAQJvgnmq6kYeXxHzDyATueNnvZcYAAAAAElFTkSuQmCC" class="leaflet-marker-icon leaflet-zoom-hide leaflet-clickable" title="LDS Temple" tabindex="0" style="margin-left: -15px; margin-top: -40px; width: 30px; height: 40px; transform: translate3d(5848px, -4964px, 0px); z-index: -4964;">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAoCAMAAACo9wirAAAAzFBMVEXbuTR9YwDd0T+ulyry2VDt53/s5Jv34a+tmUbJtGRtVwAtJADg14j304viyIZeSwDXyH5IOQD07JLPvnhqVQBuWACmkjpgTQBxWwC4p1WchikRDQCPdxeBaAQTDwADAgAOCwAAAAAAAAAAAAALCQAAAAAAAAAAAAD9+Jb97IT+3VT9+WH+0i3993D+80793Yr/yXL+5Tr+6XL+zEP/z2X+vSX+zB/+52L/qw393SX89xr9+yv/siP/vUf9+Dv+20P+rgH+xQv+vgH+twNAe/b8AAAAKHRSTlPywvLj+vn4/OLrqFb0/PSS8Hb77meB4FGX5t1A2dUkEy8HDQoaAwEAoclaPQAAAo1JREFUeF5VkeeyozAMRrPphdwkdIxpBu7SSe/llvd/p5VxlMx+PxiMzhxJuPX3mc/PzzgIQwYJwyCGoyggwMuRav6BmKrLGgQBrBvUkuQkkSWLGh5DooX1UNWlXplDyp6kq5EXCqL1qlu9srpfIPeq7FmaIBCIA9WScyjznC/3XOZEEAsABIFBoH6GUrt9v5zPQEAXFoCiAWLPkUqon+8lIbl4kRwfmggABFZSXXh9PhbopUos1fWCBoAJnT4MCMMlZLHQE/Hed/wIFA3gkiSvqjLtK45tO/N+WlZVnhA7YgKAFZK83dGJM5v4rmFSonfaeWotoEcDhJqSVl06W0A5gviTGelWqTJzvZADcWjO11XVIzPbjzzGPFfT4bxWTD8SAANgtTrIQ8eF3QPmDOXDarWej/mUL+C0SgfU91gcR3TAj42BNQDMAMDpwBfzwjCi/cMJgNFMGGBIY5g+AACnrWl+NJay0+mRDhcAiDVdKsOnzJqZRFGoZo74SaYTXDPwzPnhUTw6dCSnaT2inUdRHD7GNgIxM/QUvrW6WfZ4ZFm3VRSiA4sFEEaOlBX7oij2EP4ssqlj413wHqq13uy/X9lvYAcbb5P3cGmd7b9/nvneZzWdNB0EAApN2RZvoNjCvfKb4IBQ+LTe7H5+RXabmjwFCISw6Xb3i8D2oxEgwMdkBgHF7xeEC/SF34yIAN90/LHdHb94QCB2REBsauj17cqB660eogAB8bOE4vgUsBiBt2J6ux6P19v0OQECb8V8y4G34D+AKwgoQEBQgMBLYSrL222pjHEFBN4KOl0up/wWUIAA/k5tNBg014gCBPB3+s5g0EwYYB2Bl8KyND9CAQJvgnmq6kYeXxHzDyATueNnvZcYAAAAAElFTkSuQmCC" class="leaflet-marker-icon leaflet-zoom-hide leaflet-clickable" title="Mesa Temple Visitors Center" tabindex="0" style="margin-left: -15px; margin-top: -40px; width: 30px; height: 40px; transform: translate3d(5811px, -5072px, 0px); z-index: -5072;">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAoCAMAAACo9wirAAAAzFBMVEXbuTR9YwDd0T+ulyry2VDt53/s5Jv34a+tmUbJtGRtVwAtJADg14j304viyIZeSwDXyH5IOQD07JLPvnhqVQBuWACmkjpgTQBxWwC4p1WchikRDQCPdxeBaAQTDwADAgAOCwAAAAAAAAAAAAALCQAAAAAAAAAAAAD9+Jb97IT+3VT9+WH+0i3993D+80793Yr/yXL+5Tr+6XL+zEP/z2X+vSX+zB/+52L/qw393SX89xr9+yv/siP/vUf9+Dv+20P+rgH+xQv+vgH+twNAe/b8AAAAKHRSTlPywvLj+vn4/OLrqFb0/PSS8Hb77meB4FGX5t1A2dUkEy8HDQoaAwEAoclaPQAAAo1JREFUeF5VkeeyozAMRrPphdwkdIxpBu7SSe/llvd/p5VxlMx+PxiMzhxJuPX3mc/PzzgIQwYJwyCGoyggwMuRav6BmKrLGgQBrBvUkuQkkSWLGh5DooX1UNWlXplDyp6kq5EXCqL1qlu9srpfIPeq7FmaIBCIA9WScyjznC/3XOZEEAsABIFBoH6GUrt9v5zPQEAXFoCiAWLPkUqon+8lIbl4kRwfmggABFZSXXh9PhbopUos1fWCBoAJnT4MCMMlZLHQE/Hed/wIFA3gkiSvqjLtK45tO/N+WlZVnhA7YgKAFZK83dGJM5v4rmFSonfaeWotoEcDhJqSVl06W0A5gviTGelWqTJzvZADcWjO11XVIzPbjzzGPFfT4bxWTD8SAANgtTrIQ8eF3QPmDOXDarWej/mUL+C0SgfU91gcR3TAj42BNQDMAMDpwBfzwjCi/cMJgNFMGGBIY5g+AACnrWl+NJay0+mRDhcAiDVdKsOnzJqZRFGoZo74SaYTXDPwzPnhUTw6dCSnaT2inUdRHD7GNgIxM/QUvrW6WfZ4ZFm3VRSiA4sFEEaOlBX7oij2EP4ssqlj413wHqq13uy/X9lvYAcbb5P3cGmd7b9/nvneZzWdNB0EAApN2RZvoNjCvfKb4IBQ+LTe7H5+RXabmjwFCISw6Xb3i8D2oxEgwMdkBgHF7xeEC/SF34yIAN90/LHdHb94QCB2REBsauj17cqB660eogAB8bOE4vgUsBiBt2J6ux6P19v0OQECb8V8y4G34D+AKwgoQEBQgMBLYSrL222pjHEFBN4KOl0up/wWUIAA/k5tNBg014gCBPB3+s5g0EwYYB2Bl8KyND9CAQJvgnmq6kYeXxHzDyATueNnvZcYAAAAAElFTkSuQmCC" class="leaflet-marker-icon leaflet-zoom-hide leaflet-clickable" title="Pioneer Park Southeast Entrance" tabindex="0" style="margin-left: -15px; margin-top: -40px; width: 30px; height: 40px; transform: translate3d(6023px, -5363px, 0px); z-index: -5363;">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAoCAMAAACo9wirAAAAzFBMVEXbuTR9YwDd0T+ulyry2VDt53/s5Jv34a+tmUbJtGRtVwAtJADg14j304viyIZeSwDXyH5IOQD07JLPvnhqVQBuWACmkjpgTQBxWwC4p1WchikRDQCPdxeBaAQTDwADAgAOCwAAAAAAAAAAAAALCQAAAAAAAAAAAAD9+Jb97IT+3VT9+WH+0i3993D+80793Yr/yXL+5Tr+6XL+zEP/z2X+vSX+zB/+52L/qw393SX89xr9+yv/siP/vUf9+Dv+20P+rgH+xQv+vgH+twNAe/b8AAAAKHRSTlPywvLj+vn4/OLrqFb0/PSS8Hb77meB4FGX5t1A2dUkEy8HDQoaAwEAoclaPQAAAo1JREFUeF5VkeeyozAMRrPphdwkdIxpBu7SSe/llvd/p5VxlMx+PxiMzhxJuPX3mc/PzzgIQwYJwyCGoyggwMuRav6BmKrLGgQBrBvUkuQkkSWLGh5DooX1UNWlXplDyp6kq5EXCqL1qlu9srpfIPeq7FmaIBCIA9WScyjznC/3XOZEEAsABIFBoH6GUrt9v5zPQEAXFoCiAWLPkUqon+8lIbl4kRwfmggABFZSXXh9PhbopUos1fWCBoAJnT4MCMMlZLHQE/Hed/wIFA3gkiSvqjLtK45tO/N+WlZVnhA7YgKAFZK83dGJM5v4rmFSonfaeWotoEcDhJqSVl06W0A5gviTGelWqTJzvZADcWjO11XVIzPbjzzGPFfT4bxWTD8SAANgtTrIQ8eF3QPmDOXDarWej/mUL+C0SgfU91gcR3TAj42BNQDMAMDpwBfzwjCi/cMJgNFMGGBIY5g+AACnrWl+NJay0+mRDhcAiDVdKsOnzJqZRFGoZo74SaYTXDPwzPnhUTw6dCSnaT2inUdRHD7GNgIxM/QUvrW6WfZ4ZFm3VRSiA4sFEEaOlBX7oij2EP4ssqlj413wHqq13uy/X9lvYAcbb5P3cGmd7b9/nvneZzWdNB0EAApN2RZvoNjCvfKb4IBQ+LTe7H5+RXabmjwFCISw6Xb3i8D2oxEgwMdkBgHF7xeEC/SF34yIAN90/LHdHb94QCB2REBsauj17cqB660eogAB8bOE4vgUsBiBt2J6ux6P19v0OQECb8V8y4G34D+AKwgoQEBQgMBLYSrL222pjHEFBN4KOl0up/wWUIAA/k5tNBg014gCBPB3+s5g0EwYYB2Bl8KyND9CAQJvgnmq6kYeXxHzDyATueNnvZcYAAAAAElFTkSuQmCC" class="leaflet-marker-icon leaflet-zoom-hide leaflet-clickable" title="Mesa Pioneer Monument" tabindex="0" style="margin-left: -15px; margin-top: -40px; width: 30px; height: 40px; transform: translate3d(5857px, -5365px, 0px); z-index: -5365;">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAoCAMAAACo9wirAAAAzFBMVEXbuTR9YwDd0T+ulyry2VDt53/s5Jv34a+tmUbJtGRtVwAtJADg14j304viyIZeSwDXyH5IOQD07JLPvnhqVQBuWACmkjpgTQBxWwC4p1WchikRDQCPdxeBaAQTDwADAgAOCwAAAAAAAAAAAAALCQAAAAAAAAAAAAD9+Jb97IT+3VT9+WH+0i3993D+80793Yr/yXL+5Tr+6XL+zEP/z2X+vSX+zB/+52L/qw393SX89xr9+yv/siP/vUf9+Dv+20P+rgH+xQv+vgH+twNAe/b8AAAAKHRSTlPywvLj+vn4/OLrqFb0/PSS8Hb77meB4FGX5t1A2dUkEy8HDQoaAwEAoclaPQAAAo1JREFUeF5VkeeyozAMRrPphdwkdIxpBu7SSe/llvd/p5VxlMx+PxiMzhxJuPX3mc/PzzgIQwYJwyCGoyggwMuRav6BmKrLGgQBrBvUkuQkkSWLGh5DooX1UNWlXplDyp6kq5EXCqL1qlu9srpfIPeq7FmaIBCIA9WScyjznC/3XOZEEAsABIFBoH6GUrt9v5zPQEAXFoCiAWLPkUqon+8lIbl4kRwfmggABFZSXXh9PhbopUos1fWCBoAJnT4MCMMlZLHQE/Hed/wIFA3gkiSvqjLtK45tO/N+WlZVnhA7YgKAFZK83dGJM5v4rmFSonfaeWotoEcDhJqSVl06W0A5gviTGelWqTJzvZADcWjO11XVIzPbjzzGPFfT4bxWTD8SAANgtTrIQ8eF3QPmDOXDarWej/mUL+C0SgfU91gcR3TAj42BNQDMAMDpwBfzwjCi/cMJgNFMGGBIY5g+AACnrWl+NJay0+mRDhcAiDVdKsOnzJqZRFGoZo74SaYTXDPwzPnhUTw6dCSnaT2inUdRHD7GNgIxM/QUvrW6WfZ4ZFm3VRSiA4sFEEaOlBX7oij2EP4ssqlj413wHqq13uy/X9lvYAcbb5P3cGmd7b9/nvneZzWdNB0EAApN2RZvoNjCvfKb4IBQ+LTe7H5+RXabmjwFCISw6Xb3i8D2oxEgwMdkBgHF7xeEC/SF34yIAN90/LHdHb94QCB2REBsauj17cqB660eogAB8bOE4vgUsBiBt2J6ux6P19v0OQECb8V8y4G34D+AKwgoQEBQgMBLYSrL222pjHEFBN4KOl0up/wWUIAA/k5tNBg014gCBPB3+s5g0EwYYB2Bl8KyND9CAQJvgnmq6kYeXxHzDyATueNnvZcYAAAAAElFTkSuQmCC" class="leaflet-marker-icon leaflet-zoom-hide leaflet-clickable" title="In Memory of Richard L. Love" tabindex="0" style="margin-left: -15px; margin-top: -40px; width: 30px; height: 40px; transform: translate3d(5860px, -5409px, 0px); z-index: -5409;">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAoCAMAAACo9wirAAAAzFBMVEXbuTR9YwDd0T+ulyry2VDt53/s5Jv34a+tmUbJtGRtVwAtJADg14j304viyIZeSwDXyH5IOQD07JLPvnhqVQBuWACmkjpgTQBxWwC4p1WchikRDQCPdxeBaAQTDwADAgAOCwAAAAAAAAAAAAALCQAAAAAAAAAAAAD9+Jb97IT+3VT9+WH+0i3993D+80793Yr/yXL+5Tr+6XL+zEP/z2X+vSX+zB/+52L/qw393SX89xr9+yv/siP/vUf9+Dv+20P+rgH+xQv+vgH+twNAe/b8AAAAKHRSTlPywvLj+vn4/OLrqFb0/PSS8Hb77meB4FGX5t1A2dUkEy8HDQoaAwEAoclaPQAAAo1JREFUeF5VkeeyozAMRrPphdwkdIxpBu7SSe/llvd/p5VxlMx+PxiMzhxJuPX3mc/PzzgIQwYJwyCGoyggwMuRav6BmKrLGgQBrBvUkuQkkSWLGh5DooX1UNWlXplDyp6kq5EXCqL1qlu9srpfIPeq7FmaIBCIA9WScyjznC/3XOZEEAsABIFBoH6GUrt9v5zPQEAXFoCiAWLPkUqon+8lIbl4kRwfmggABFZSXXh9PhbopUos1fWCBoAJnT4MCMMlZLHQE/Hed/wIFA3gkiSvqjLtK45tO/N+WlZVnhA7YgKAFZK83dGJM5v4rmFSonfaeWotoEcDhJqSVl06W0A5gviTGelWqTJzvZADcWjO11XVIzPbjzzGPFfT4bxWTD8SAANgtTrIQ8eF3QPmDOXDarWej/mUL+C0SgfU91gcR3TAj42BNQDMAMDpwBfzwjCi/cMJgNFMGGBIY5g+AACnrWl+NJay0+mRDhcAiDVdKsOnzJqZRFGoZo74SaYTXDPwzPnhUTw6dCSnaT2inUdRHD7GNgIxM/QUvrW6WfZ4ZFm3VRSiA4sFEEaOlBX7oij2EP4ssqlj413wHqq13uy/X9lvYAcbb5P3cGmd7b9/nvneZzWdNB0EAApN2RZvoNjCvfKb4IBQ+LTe7H5+RXabmjwFCISw6Xb3i8D2oxEgwMdkBgHF7xeEC/SF34yIAN90/LHdHb94QCB2REBsauj17cqB660eogAB8bOE4vgUsBiBt2J6ux6P19v0OQECb8V8y4G34D+AKwgoQEBQgMBLYSrL222pjHEFBN4KOl0up/wWUIAA/k5tNBg014gCBPB3+s5g0EwYYB2Bl8KyND9CAQJvgnmq6kYeXxHzDyATueNnvZcYAAAAAElFTkSuQmCC" class="leaflet-marker-icon leaflet-zoom-hide leaflet-clickable" title="Rufus Dog Plaque" tabindex="0" style="margin-left: -15px; margin-top: -40px; width: 30px; height: 40px; transform: translate3d(5937px, -5467px, 0px); z-index: -5467;">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAoCAMAAACo9wirAAAAzFBMVEXbuTR9YwDd0T+ulyry2VDt53/s5Jv34a+tmUbJtGRtVwAtJADg14j304viyIZeSwDXyH5IOQD07JLPvnhqVQBuWACmkjpgTQBxWwC4p1WchikRDQCPdxeBaAQTDwADAgAOCwAAAAAAAAAAAAALCQAAAAAAAAAAAAD9+Jb97IT+3VT9+WH+0i3993D+80793Yr/yXL+5Tr+6XL+zEP/z2X+vSX+zB/+52L/qw393SX89xr9+yv/siP/vUf9+Dv+20P+rgH+xQv+vgH+twNAe/b8AAAAKHRSTlPywvLj+vn4/OLrqFb0/PSS8Hb77meB4FGX5t1A2dUkEy8HDQoaAwEAoclaPQAAAo1JREFUeF5VkeeyozAMRrPphdwkdIxpBu7SSe/llvd/p5VxlMx+PxiMzhxJuPX3mc/PzzgIQwYJwyCGoyggwMuRav6BmKrLGgQBrBvUkuQkkSWLGh5DooX1UNWlXplDyp6kq5EXCqL1qlu9srpfIPeq7FmaIBCIA9WScyjznC/3XOZEEAsABIFBoH6GUrt9v5zPQEAXFoCiAWLPkUqon+8lIbl4kRwfmggABFZSXXh9PhbopUos1fWCBoAJnT4MCMMlZLHQE/Hed/wIFA3gkiSvqjLtK45tO/N+WlZVnhA7YgKAFZK83dGJM5v4rmFSonfaeWotoEcDhJqSVl06W0A5gviTGelWqTJzvZADcWjO11XVIzPbjzzGPFfT4bxWTD8SAANgtTrIQ8eF3QPmDOXDarWej/mUL+C0SgfU91gcR3TAj42BNQDMAMDpwBfzwjCi/cMJgNFMGGBIY5g+AACnrWl+NJay0+mRDhcAiDVdKsOnzJqZRFGoZo74SaYTXDPwzPnhUTw6dCSnaT2inUdRHD7GNgIxM/QUvrW6WfZ4ZFm3VRSiA4sFEEaOlBX7oij2EP4ssqlj413wHqq13uy/X9lvYAcbb5P3cGmd7b9/nvneZzWdNB0EAApN2RZvoNjCvfKb4IBQ+LTe7H5+RXabmjwFCISw6Xb3i8D2oxEgwMdkBgHF7xeEC/SF34yIAN90/LHdHb94QCB2REBsauj17cqB660eogAB8bOE4vgUsBiBt2J6ux6P19v0OQECb8V8y4G34D+AKwgoQEBQgMBLYSrL222pjHEFBN4KOl0up/wWUIAA/k5tNBg014gCBPB3+s5g0EwYYB2Bl8KyND9CAQJvgnmq6kYeXxHzDyATueNnvZcYAAAAAElFTkSuQmCC" class="leaflet-marker-icon leaflet-zoom-hide leaflet-clickable" title="Mesa" tabindex="0" style="margin-left: -15px; margin-top: -40px; width: 30px; height: 40px; transform: translate3d(5860px, -5484px, 0px); z-index: -5484;">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAoCAMAAACo9wirAAAAzFBMVEXbuTR9YwDd0T+ulyry2VDt53/s5Jv34a+tmUbJtGRtVwAtJADg14j304viyIZeSwDXyH5IOQD07JLPvnhqVQBuWACmkjpgTQBxWwC4p1WchikRDQCPdxeBaAQTDwADAgAOCwAAAAAAAAAAAAALCQAAAAAAAAAAAAD9+Jb97IT+3VT9+WH+0i3993D+80793Yr/yXL+5Tr+6XL+zEP/z2X+vSX+zB/+52L/qw393SX89xr9+yv/siP/vUf9+Dv+20P+rgH+xQv+vgH+twNAe/b8AAAAKHRSTlPywvLj+vn4/OLrqFb0/PSS8Hb77meB4FGX5t1A2dUkEy8HDQoaAwEAoclaPQAAAo1JREFUeF5VkeeyozAMRrPphdwkdIxpBu7SSe/llvd/p5VxlMx+PxiMzhxJuPX3mc/PzzgIQwYJwyCGoyggwMuRav6BmKrLGgQBrBvUkuQkkSWLGh5DooX1UNWlXplDyp6kq5EXCqL1qlu9srpfIPeq7FmaIBCIA9WScyjznC/3XOZEEAsABIFBoH6GUrt9v5zPQEAXFoCiAWLPkUqon+8lIbl4kRwfmggABFZSXXh9PhbopUos1fWCBoAJnT4MCMMlZLHQE/Hed/wIFA3gkiSvqjLtK45tO/N+WlZVnhA7YgKAFZK83dGJM5v4rmFSonfaeWotoEcDhJqSVl06W0A5gviTGelWqTJzvZADcWjO11XVIzPbjzzGPFfT4bxWTD8SAANgtTrIQ8eF3QPmDOXDarWej/mUL+C0SgfU91gcR3TAj42BNQDMAMDpwBfzwjCi/cMJgNFMGGBIY5g+AACnrWl+NJay0+mRDhcAiDVdKsOnzJqZRFGoZo74SaYTXDPwzPnhUTw6dCSnaT2inUdRHD7GNgIxM/QUvrW6WfZ4ZFm3VRSiA4sFEEaOlBX7oij2EP4ssqlj413wHqq13uy/X9lvYAcbb5P3cGmd7b9/nvneZzWdNB0EAApN2RZvoNjCvfKb4IBQ+LTe7H5+RXabmjwFCISw6Xb3i8D2oxEgwMdkBgHF7xeEC/SF34yIAN90/LHdHb94QCB2REBsauj17cqB660eogAB8bOE4vgUsBiBt2J6ux6P19v0OQECb8V8y4G34D+AKwgoQEBQgMBLYSrL222pjHEFBN4KOl0up/wWUIAA/k5tNBg014gCBPB3+s5g0EwYYB2Bl8KyND9CAQJvgnmq6kYeXxHzDyATueNnvZcYAAAAAElFTkSuQmCC" class="leaflet-marker-icon leaflet-zoom-hide leaflet-clickable" title="Designated dog exercise sign" tabindex="0" style="margin-left: -15px; margin-top: -40px; width: 30px; height: 40px; transform: translate3d(5686px, -5399px, 0px); z-index: -5399;">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAoCAMAAACo9wirAAAAzFBMVEXbuTR9YwDd0T+ulyry2VDt53/s5Jv34a+tmUbJtGRtVwAtJADg14j304viyIZeSwDXyH5IOQD07JLPvnhqVQBuWACmkjpgTQBxWwC4p1WchikRDQCPdxeBaAQTDwADAgAOCwAAAAAAAAAAAAALCQAAAAAAAAAAAAD9+Jb97IT+3VT9+WH+0i3993D+80793Yr/yXL+5Tr+6XL+zEP/z2X+vSX+zB/+52L/qw393SX89xr9+yv/siP/vUf9+Dv+20P+rgH+xQv+vgH+twNAe/b8AAAAKHRSTlPywvLj+vn4/OLrqFb0/PSS8Hb77meB4FGX5t1A2dUkEy8HDQoaAwEAoclaPQAAAo1JREFUeF5VkeeyozAMRrPphdwkdIxpBu7SSe/llvd/p5VxlMx+PxiMzhxJuPX3mc/PzzgIQwYJwyCGoyggwMuRav6BmKrLGgQBrBvUkuQkkSWLGh5DooX1UNWlXplDyp6kq5EXCqL1qlu9srpfIPeq7FmaIBCIA9WScyjznC/3XOZEEAsABIFBoH6GUrt9v5zPQEAXFoCiAWLPkUqon+8lIbl4kRwfmggABFZSXXh9PhbopUos1fWCBoAJnT4MCMMlZLHQE/Hed/wIFA3gkiSvqjLtK45tO/N+WlZVnhA7YgKAFZK83dGJM5v4rmFSonfaeWotoEcDhJqSVl06W0A5gviTGelWqTJzvZADcWjO11XVIzPbjzzGPFfT4bxWTD8SAANgtTrIQ8eF3QPmDOXDarWej/mUL+C0SgfU91gcR3TAj42BNQDMAMDpwBfzwjCi/cMJgNFMGGBIY5g+AACnrWl+NJay0+mRDhcAiDVdKsOnzJqZRFGoZo74SaYTXDPwzPnhUTw6dCSnaT2inUdRHD7GNgIxM/QUvrW6WfZ4ZFm3VRSiA4sFEEaOlBX7oij2EP4ssqlj413wHqq13uy/X9lvYAcbb5P3cGmd7b9/nvneZzWdNB0EAApN2RZvoNjCvfKb4IBQ+LTe7H5+RXabmjwFCISw6Xb3i8D2oxEgwMdkBgHF7xeEC/SF34yIAN90/LHdHb94QCB2REBsauj17cqB660eogAB8bOE4vgUsBiBt2J6ux6P19v0OQECb8V8y4G34D+AKwgoQEBQgMBLYSrL222pjHEFBN4KOl0up/wWUIAA/k5tNBg014gCBPB3+s5g0EwYYB2Bl8KyND9CAQJvgnmq6kYeXxHzDyATueNnvZcYAAAAAElFTkSuQmCC" class="leaflet-marker-icon leaflet-zoom-hide leaflet-clickable" title="Light Rail Art" tabindex="0" style="margin-left: -15px; margin-top: -40px; width: 30px; height: 40px; transform: translate3d(5367px, -5307px, 0px); z-index: -5307;">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAoCAMAAACo9wirAAAAzFBMVEXbuTR9YwDd0T+ulyry2VDt53/s5Jv34a+tmUbJtGRtVwAtJADg14j304viyIZeSwDXyH5IOQD07JLPvnhqVQBuWACmkjpgTQBxWwC4p1WchikRDQCPdxeBaAQTDwADAgAOCwAAAAAAAAAAAAALCQAAAAAAAAAAAAD9+Jb97IT+3VT9+WH+0i3993D+80793Yr/yXL+5Tr+6XL+zEP/z2X+vSX+zB/+52L/qw393SX89xr9+yv/siP/vUf9+Dv+20P+rgH+xQv+vgH+twNAe/b8AAAAKHRSTlPywvLj+vn4/OLrqFb0/PSS8Hb77meB4FGX5t1A2dUkEy8HDQoaAwEAoclaPQAAAo1JREFUeF5VkeeyozAMRrPphdwkdIxpBu7SSe/llvd/p5VxlMx+PxiMzhxJuPX3mc/PzzgIQwYJwyCGoyggwMuRav6BmKrLGgQBrBvUkuQkkSWLGh5DooX1UNWlXplDyp6kq5EXCqL1qlu9srpfIPeq7FmaIBCIA9WScyjznC/3XOZEEAsABIFBoH6GUrt9v5zPQEAXFoCiAWLPkUqon+8lIbl4kRwfmggABFZSXXh9PhbopUos1fWCBoAJnT4MCMMlZLHQE/Hed/wIFA3gkiSvqjLtK45tO/N+WlZVnhA7YgKAFZK83dGJM5v4rmFSonfaeWotoEcDhJqSVl06W0A5gviTGelWqTJzvZADcWjO11XVIzPbjzzGPFfT4bxWTD8SAANgtTrIQ8eF3QPmDOXDarWej/mUL+C0SgfU91gcR3TAj42BNQDMAMDpwBfzwjCi/cMJgNFMGGBIY5g+AACnrWl+NJay0+mRDhcAiDVdKsOnzJqZRFGoZo74SaYTXDPwzPnhUTw6dCSnaT2inUdRHD7GNgIxM/QUvrW6WfZ4ZFm3VRSiA4sFEEaOlBX7oij2EP4ssqlj413wHqq13uy/X9lvYAcbb5P3cGmd7b9/nvneZzWdNB0EAApN2RZvoNjCvfKb4IBQ+LTe7H5+RXabmjwFCISw6Xb3i8D2oxEgwMdkBgHF7xeEC/SF34yIAN90/LHdHb94QCB2REBsauj17cqB660eogAB8bOE4vgUsBiBt2J6ux6P19v0OQECb8V8y4G34D+AKwgoQEBQgMBLYSrL222pjHEFBN4KOl0up/wWUIAA/k5tNBg014gCBPB3+s5g0EwYYB2Bl8KyND9CAQJvgnmq6kYeXxHzDyATueNnvZcYAAAAAElFTkSuQmCC" class="leaflet-marker-icon leaflet-zoom-hide leaflet-clickable" title="Family Fundamental Unit of Society" tabindex="0" style="margin-left: -15px; margin-top: -40px; width: 30px; height: 40px; transform: translate3d(5173px, -5262px, 0px); z-index: -5262;">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAoCAMAAACo9wirAAAAzFBMVEXbuTR9YwDd0T+ulyry2VDt53/s5Jv34a+tmUbJtGRtVwAtJADg14j304viyIZeSwDXyH5IOQD07JLPvnhqVQBuWACmkjpgTQBxWwC4p1WchikRDQCPdxeBaAQTDwADAgAOCwAAAAAAAAAAAAALCQAAAAAAAAAAAAD9+Jb97IT+3VT9+WH+0i3993D+80793Yr/yXL+5Tr+6XL+zEP/z2X+vSX+zB/+52L/qw393SX89xr9+yv/siP/vUf9+Dv+20P+rgH+xQv+vgH+twNAe/b8AAAAKHRSTlPywvLj+vn4/OLrqFb0/PSS8Hb77meB4FGX5t1A2dUkEy8HDQoaAwEAoclaPQAAAo1JREFUeF5VkeeyozAMRrPphdwkdIxpBu7SSe/llvd/p5VxlMx+PxiMzhxJuPX3mc/PzzgIQwYJwyCGoyggwMuRav6BmKrLGgQBrBvUkuQkkSWLGh5DooX1UNWlXplDyp6kq5EXCqL1qlu9srpfIPeq7FmaIBCIA9WScyjznC/3XOZEEAsABIFBoH6GUrt9v5zPQEAXFoCiAWLPkUqon+8lIbl4kRwfmggABFZSXXh9PhbopUos1fWCBoAJnT4MCMMlZLHQE/Hed/wIFA3gkiSvqjLtK45tO/N+WlZVnhA7YgKAFZK83dGJM5v4rmFSonfaeWotoEcDhJqSVl06W0A5gviTGelWqTJzvZADcWjO11XVIzPbjzzGPFfT4bxWTD8SAANgtTrIQ8eF3QPmDOXDarWej/mUL+C0SgfU91gcR3TAj42BNQDMAMDpwBfzwjCi/cMJgNFMGGBIY5g+AACnrWl+NJay0+mRDhcAiDVdKsOnzJqZRFGoZo74SaYTXDPwzPnhUTw6dCSnaT2inUdRHD7GNgIxM/QUvrW6WfZ4ZFm3VRSiA4sFEEaOlBX7oij2EP4ssqlj413wHqq13uy/X9lvYAcbb5P3cGmd7b9/nvneZzWdNB0EAApN2RZvoNjCvfKb4IBQ+LTe7H5+RXabmjwFCISw6Xb3i8D2oxEgwMdkBgHF7xeEC/SF34yIAN90/LHdHb94QCB2REBsauj17cqB660eogAB8bOE4vgUsBiBt2J6ux6P19v0OQECb8V8y4G34D+AKwgoQEBQgMBLYSrL222pjHEFBN4KOl0up/wWUIAA/k5tNBg014gCBPB3+s5g0EwYYB2Bl8KyND9CAQJvgnmq6kYeXxHzDyATueNnvZcYAAAAAElFTkSuQmCC" class="leaflet-marker-icon leaflet-zoom-hide leaflet-clickable" title="Kids Need to Read" tabindex="0" style="margin-left: -15px; margin-top: -40px; width: 30px; height: 40px; transform: translate3d(5250px, -5094px, 0px); z-index: -5094;">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAoCAMAAACo9wirAAAAzFBMVEXbuTR9YwDd0T+ulyry2VDt53/s5Jv34a+tmUbJtGRtVwAtJADg14j304viyIZeSwDXyH5IOQD07JLPvnhqVQBuWACmkjpgTQBxWwC4p1WchikRDQCPdxeBaAQTDwADAgAOCwAAAAAAAAAAAAALCQAAAAAAAAAAAAD9+Jb97IT+3VT9+WH+0i3993D+80793Yr/yXL+5Tr+6XL+zEP/z2X+vSX+zB/+52L/qw393SX89xr9+yv/siP/vUf9+Dv+20P+rgH+xQv+vgH+twNAe/b8AAAAKHRSTlPywvLj+vn4/OLrqFb0/PSS8Hb77meB4FGX5t1A2dUkEy8HDQoaAwEAoclaPQAAAo1JREFUeF5VkeeyozAMRrPphdwkdIxpBu7SSe/llvd/p5VxlMx+PxiMzhxJuPX3mc/PzzgIQwYJwyCGoyggwMuRav6BmKrLGgQBrBvUkuQkkSWLGh5DooX1UNWlXplDyp6kq5EXCqL1qlu9srpfIPeq7FmaIBCIA9WScyjznC/3XOZEEAsABIFBoH6GUrt9v5zPQEAXFoCiAWLPkUqon+8lIbl4kRwfmggABFZSXXh9PhbopUos1fWCBoAJnT4MCMMlZLHQE/Hed/wIFA3gkiSvqjLtK45tO/N+WlZVnhA7YgKAFZK83dGJM5v4rmFSonfaeWotoEcDhJqSVl06W0A5gviTGelWqTJzvZADcWjO11XVIzPbjzzGPFfT4bxWTD8SAANgtTrIQ8eF3QPmDOXDarWej/mUL+C0SgfU91gcR3TAj42BNQDMAMDpwBfzwjCi/cMJgNFMGGBIY5g+AACnrWl+NJay0+mRDhcAiDVdKsOnzJqZRFGoZo74SaYTXDPwzPnhUTw6dCSnaT2inUdRHD7GNgIxM/QUvrW6WfZ4ZFm3VRSiA4sFEEaOlBX7oij2EP4ssqlj413wHqq13uy/X9lvYAcbb5P3cGmd7b9/nvneZzWdNB0EAApN2RZvoNjCvfKb4IBQ+LTe7H5+RXabmjwFCISw6Xb3i8D2oxEgwMdkBgHF7xeEC/SF34yIAN90/LHdHb94QCB2REBsauj17cqB660eogAB8bOE4vgUsBiBt2J6ux6P19v0OQECb8V8y4G34D+AKwgoQEBQgMBLYSrL222pjHEFBN4KOl0up/wWUIAA/k5tNBg014gCBPB3+s5g0EwYYB2Bl8KyND9CAQJvgnmq6kYeXxHzDyATueNnvZcYAAAAAElFTkSuQmCC" class="leaflet-marker-icon leaflet-zoom-hide leaflet-clickable" title="Breaking Ground" tabindex="0" style="margin-left: -15px; margin-top: -40px; width: 30px; height: 40px; transform: translate3d(4577px, -5271px, 0px); z-index: -5271;">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAoCAMAAACo9wirAAAAzFBMVEXbuTR9YwDd0T+ulyry2VDt53/s5Jv34a+tmUbJtGRtVwAtJADg14j304viyIZeSwDXyH5IOQD07JLPvnhqVQBuWACmkjpgTQBxWwC4p1WchikRDQCPdxeBaAQTDwADAgAOCwAAAAAAAAAAAAALCQAAAAAAAAAAAAD9+Jb97IT+3VT9+WH+0i3993D+80793Yr/yXL+5Tr+6XL+zEP/z2X+vSX+zB/+52L/qw393SX89xr9+yv/siP/vUf9+Dv+20P+rgH+xQv+vgH+twNAe/b8AAAAKHRSTlPywvLj+vn4/OLrqFb0/PSS8Hb77meB4FGX5t1A2dUkEy8HDQoaAwEAoclaPQAAAo1JREFUeF5VkeeyozAMRrPphdwkdIxpBu7SSe/llvd/p5VxlMx+PxiMzhxJuPX3mc/PzzgIQwYJwyCGoyggwMuRav6BmKrLGgQBrBvUkuQkkSWLGh5DooX1UNWlXplDyp6kq5EXCqL1qlu9srpfIPeq7FmaIBCIA9WScyjznC/3XOZEEAsABIFBoH6GUrt9v5zPQEAXFoCiAWLPkUqon+8lIbl4kRwfmggABFZSXXh9PhbopUos1fWCBoAJnT4MCMMlZLHQE/Hed/wIFA3gkiSvqjLtK45tO/N+WlZVnhA7YgKAFZK83dGJM5v4rmFSonfaeWotoEcDhJqSVl06W0A5gviTGelWqTJzvZADcWjO11XVIzPbjzzGPFfT4bxWTD8SAANgtTrIQ8eF3QPmDOXDarWej/mUL+C0SgfU91gcR3TAj42BNQDMAMDpwBfzwjCi/cMJgNFMGGBIY5g+AACnrWl+NJay0+mRDhcAiDVdKsOnzJqZRFGoZo74SaYTXDPwzPnhUTw6dCSnaT2inUdRHD7GNgIxM/QUvrW6WfZ4ZFm3VRSiA4sFEEaOlBX7oij2EP4ssqlj413wHqq13uy/X9lvYAcbb5P3cGmd7b9/nvneZzWdNB0EAApN2RZvoNjCvfKb4IBQ+LTe7H5+RXabmjwFCISw6Xb3i8D2oxEgwMdkBgHF7xeEC/SF34yIAN90/LHdHb94QCB2REBsauj17cqB660eogAB8bOE4vgUsBiBt2J6ux6P19v0OQECb8V8y4G34D+AKwgoQEBQgMBLYSrL222pjHEFBN4KOl0up/wWUIAA/k5tNBg014gCBPB3+s5g0EwYYB2Bl8KyND9CAQJvgnmq6kYeXxHzDyATueNnvZcYAAAAAElFTkSuQmCC" class="leaflet-marker-icon leaflet-zoom-hide leaflet-clickable" title="Three Guys Sitting" tabindex="0" style="margin-left: -15px; margin-top: -40px; width: 30px; height: 40px; transform: translate3d(4164px, -5262px, 0px); z-index: -5262;">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAoCAMAAACo9wirAAAAzFBMVEXbuTR9YwDd0T+ulyry2VDt53/s5Jv34a+tmUbJtGRtVwAtJADg14j304viyIZeSwDXyH5IOQD07JLPvnhqVQBuWACmkjpgTQBxWwC4p1WchikRDQCPdxeBaAQTDwADAgAOCwAAAAAAAAAAAAALCQAAAAAAAAAAAAD9+Jb97IT+3VT9+WH+0i3993D+80793Yr/yXL+5Tr+6XL+zEP/z2X+vSX+zB/+52L/qw393SX89xr9+yv/siP/vUf9+Dv+20P+rgH+xQv+vgH+twNAe/b8AAAAKHRSTlPywvLj+vn4/OLrqFb0/PSS8Hb77meB4FGX5t1A2dUkEy8HDQoaAwEAoclaPQAAAo1JREFUeF5VkeeyozAMRrPphdwkdIxpBu7SSe/llvd/p5VxlMx+PxiMzhxJuPX3mc/PzzgIQwYJwyCGoyggwMuRav6BmKrLGgQBrBvUkuQkkSWLGh5DooX1UNWlXplDyp6kq5EXCqL1qlu9srpfIPeq7FmaIBCIA9WScyjznC/3XOZEEAsABIFBoH6GUrt9v5zPQEAXFoCiAWLPkUqon+8lIbl4kRwfmggABFZSXXh9PhbopUos1fWCBoAJnT4MCMMlZLHQE/Hed/wIFA3gkiSvqjLtK45tO/N+WlZVnhA7YgKAFZK83dGJM5v4rmFSonfaeWotoEcDhJqSVl06W0A5gviTGelWqTJzvZADcWjO11XVIzPbjzzGPFfT4bxWTD8SAANgtTrIQ8eF3QPmDOXDarWej/mUL+C0SgfU91gcR3TAj42BNQDMAMDpwBfzwjCi/cMJgNFMGGBIY5g+AACnrWl+NJay0+mRDhcAiDVdKsOnzJqZRFGoZo74SaYTXDPwzPnhUTw6dCSnaT2inUdRHD7GNgIxM/QUvrW6WfZ4ZFm3VRSiA4sFEEaOlBX7oij2EP4ssqlj413wHqq13uy/X9lvYAcbb5P3cGmd7b9/nvneZzWdNB0EAApN2RZvoNjCvfKb4IBQ+LTe7H5+RXabmjwFCISw6Xb3i8D2oxEgwMdkBgHF7xeEC/SF34yIAN90/LHdHb94QCB2REBsauj17cqB660eogAB8bOE4vgUsBiBt2J6ux6P19v0OQECb8V8y4G34D+AKwgoQEBQgMBLYSrL222pjHEFBN4KOl0up/wWUIAA/k5tNBg014gCBPB3+s5g0EwYYB2Bl8KyND9CAQJvgnmq6kYeXxHzDyATueNnvZcYAAAAAElFTkSuQmCC" class="leaflet-marker-icon leaflet-zoom-hide leaflet-clickable" title="The Teacher" tabindex="0" style="margin-left: -15px; margin-top: -40px; width: 30px; height: 40px; transform: translate3d(4078px, -5282px, 0px); z-index: -5282;">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAoCAMAAACo9wirAAAAzFBMVEXbuTR9YwDd0T+ulyry2VDt53/s5Jv34a+tmUbJtGRtVwAtJADg14j304viyIZeSwDXyH5IOQD07JLPvnhqVQBuWACmkjpgTQBxWwC4p1WchikRDQCPdxeBaAQTDwADAgAOCwAAAAAAAAAAAAALCQAAAAAAAAAAAAD9+Jb97IT+3VT9+WH+0i3993D+80793Yr/yXL+5Tr+6XL+zEP/z2X+vSX+zB/+52L/qw393SX89xr9+yv/siP/vUf9+Dv+20P+rgH+xQv+vgH+twNAe/b8AAAAKHRSTlPywvLj+vn4/OLrqFb0/PSS8Hb77meB4FGX5t1A2dUkEy8HDQoaAwEAoclaPQAAAo1JREFUeF5VkeeyozAMRrPphdwkdIxpBu7SSe/llvd/p5VxlMx+PxiMzhxJuPX3mc/PzzgIQwYJwyCGoyggwMuRav6BmKrLGgQBrBvUkuQkkSWLGh5DooX1UNWlXplDyp6kq5EXCqL1qlu9srpfIPeq7FmaIBCIA9WScyjznC/3XOZEEAsABIFBoH6GUrt9v5zPQEAXFoCiAWLPkUqon+8lIbl4kRwfmggABFZSXXh9PhbopUos1fWCBoAJnT4MCMMlZLHQE/Hed/wIFA3gkiSvqjLtK45tO/N+WlZVnhA7YgKAFZK83dGJM5v4rmFSonfaeWotoEcDhJqSVl06W0A5gviTGelWqTJzvZADcWjO11XVIzPbjzzGPFfT4bxWTD8SAANgtTrIQ8eF3QPmDOXDarWej/mUL+C0SgfU91gcR3TAj42BNQDMAMDpwBfzwjCi/cMJgNFMGGBIY5g+AACnrWl+NJay0+mRDhcAiDVdKsOnzJqZRFGoZo74SaYTXDPwzPnhUTw6dCSnaT2inUdRHD7GNgIxM/QUvrW6WfZ4ZFm3VRSiA4sFEEaOlBX7oij2EP4ssqlj413wHqq13uy/X9lvYAcbb5P3cGmd7b9/nvneZzWdNB0EAApN2RZvoNjCvfKb4IBQ+LTe7H5+RXabmjwFCISw6Xb3i8D2oxEgwMdkBgHF7xeEC/SF34yIAN90/LHdHb94QCB2REBsauj17cqB660eogAB8bOE4vgUsBiBt2J6ux6P19v0OQECb8V8y4G34D+AKwgoQEBQgMBLYSrL222pjHEFBN4KOl0up/wWUIAA/k5tNBg014gCBPB3+s5g0EwYYB2Bl8KyND9CAQJvgnmq6kYeXxHzDyATueNnvZcYAAAAAElFTkSuQmCC" class="leaflet-marker-icon leaflet-zoom-hide leaflet-clickable" title="Fragments Of Support" tabindex="0" style="margin-left: -15px; margin-top: -40px; width: 30px; height: 40px; transform: translate3d(4090px, -5343px, 0px); z-index: -5343;">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAoCAMAAACo9wirAAAAzFBMVEXbuTR9YwDd0T+ulyry2VDt53/s5Jv34a+tmUbJtGRtVwAtJADg14j304viyIZeSwDXyH5IOQD07JLPvnhqVQBuWACmkjpgTQBxWwC4p1WchikRDQCPdxeBaAQTDwADAgAOCwAAAAAAAAAAAAALCQAAAAAAAAAAAAD9+Jb97IT+3VT9+WH+0i3993D+80793Yr/yXL+5Tr+6XL+zEP/z2X+vSX+zB/+52L/qw393SX89xr9+yv/siP/vUf9+Dv+20P+rgH+xQv+vgH+twNAe/b8AAAAKHRSTlPywvLj+vn4/OLrqFb0/PSS8Hb77meB4FGX5t1A2dUkEy8HDQoaAwEAoclaPQAAAo1JREFUeF5VkeeyozAMRrPphdwkdIxpBu7SSe/llvd/p5VxlMx+PxiMzhxJuPX3mc/PzzgIQwYJwyCGoyggwMuRav6BmKrLGgQBrBvUkuQkkSWLGh5DooX1UNWlXplDyp6kq5EXCqL1qlu9srpfIPeq7FmaIBCIA9WScyjznC/3XOZEEAsABIFBoH6GUrt9v5zPQEAXFoCiAWLPkUqon+8lIbl4kRwfmggABFZSXXh9PhbopUos1fWCBoAJnT4MCMMlZLHQE/Hed/wIFA3gkiSvqjLtK45tO/N+WlZVnhA7YgKAFZK83dGJM5v4rmFSonfaeWotoEcDhJqSVl06W0A5gviTGelWqTJzvZADcWjO11XVIzPbjzzGPFfT4bxWTD8SAANgtTrIQ8eF3QPmDOXDarWej/mUL+C0SgfU91gcR3TAj42BNQDMAMDpwBfzwjCi/cMJgNFMGGBIY5g+AACnrWl+NJay0+mRDhcAiDVdKsOnzJqZRFGoZo74SaYTXDPwzPnhUTw6dCSnaT2inUdRHD7GNgIxM/QUvrW6WfZ4ZFm3VRSiA4sFEEaOlBX7oij2EP4ssqlj413wHqq13uy/X9lvYAcbb5P3cGmd7b9/nvneZzWdNB0EAApN2RZvoNjCvfKb4IBQ+LTe7H5+RXabmjwFCISw6Xb3i8D2oxEgwMdkBgHF7xeEC/SF34yIAN90/LHdHb94QCB2REBsauj17cqB660eogAB8bOE4vgUsBiBt2J6ux6P19v0OQECb8V8y4G34D+AKwgoQEBQgMBLYSrL222pjHEFBN4KOl0up/wWUIAA/k5tNBg014gCBPB3+s5g0EwYYB2Bl8KyND9CAQJvgnmq6kYeXxHzDyATueNnvZcYAAAAAElFTkSuQmCC" class="leaflet-marker-icon leaflet-zoom-hide leaflet-clickable" title="Garden Chapel" tabindex="0" style="margin-left: -15px; margin-top: -40px; width: 30px; height: 40px; transform: translate3d(4164px, -5508px, 0px); z-index: -5508;">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAoCAMAAACo9wirAAAAzFBMVEXbuTR9YwDd0T+ulyry2VDt53/s5Jv34a+tmUbJtGRtVwAtJADg14j304viyIZeSwDXyH5IOQD07JLPvnhqVQBuWACmkjpgTQBxWwC4p1WchikRDQCPdxeBaAQTDwADAgAOCwAAAAAAAAAAAAALCQAAAAAAAAAAAAD9+Jb97IT+3VT9+WH+0i3993D+80793Yr/yXL+5Tr+6XL+zEP/z2X+vSX+zB/+52L/qw393SX89xr9+yv/siP/vUf9+Dv+20P+rgH+xQv+vgH+twNAe/b8AAAAKHRSTlPywvLj+vn4/OLrqFb0/PSS8Hb77meB4FGX5t1A2dUkEy8HDQoaAwEAoclaPQAAAo1JREFUeF5VkeeyozAMRrPphdwkdIxpBu7SSe/llvd/p5VxlMx+PxiMzhxJuPX3mc/PzzgIQwYJwyCGoyggwMuRav6BmKrLGgQBrBvUkuQkkSWLGh5DooX1UNWlXplDyp6kq5EXCqL1qlu9srpfIPeq7FmaIBCIA9WScyjznC/3XOZEEAsABIFBoH6GUrt9v5zPQEAXFoCiAWLPkUqon+8lIbl4kRwfmggABFZSXXh9PhbopUos1fWCBoAJnT4MCMMlZLHQE/Hed/wIFA3gkiSvqjLtK45tO/N+WlZVnhA7YgKAFZK83dGJM5v4rmFSonfaeWotoEcDhJqSVl06W0A5gviTGelWqTJzvZADcWjO11XVIzPbjzzGPFfT4bxWTD8SAANgtTrIQ8eF3QPmDOXDarWej/mUL+C0SgfU91gcR3TAj42BNQDMAMDpwBfzwjCi/cMJgNFMGGBIY5g+AACnrWl+NJay0+mRDhcAiDVdKsOnzJqZRFGoZo74SaYTXDPwzPnhUTw6dCSnaT2inUdRHD7GNgIxM/QUvrW6WfZ4ZFm3VRSiA4sFEEaOlBX7oij2EP4ssqlj413wHqq13uy/X9lvYAcbb5P3cGmd7b9/nvneZzWdNB0EAApN2RZvoNjCvfKb4IBQ+LTe7H5+RXabmjwFCISw6Xb3i8D2oxEgwMdkBgHF7xeEC/SF34yIAN90/LHdHb94QCB2REBsauj17cqB660eogAB8bOE4vgUsBiBt2J6ux6P19v0OQECb8V8y4G34D+AKwgoQEBQgMBLYSrL222pjHEFBN4KOl0up/wWUIAA/k5tNBg014gCBPB3+s5g0EwYYB2Bl8KyND9CAQJvgnmq6kYeXxHzDyATueNnvZcYAAAAAElFTkSuQmCC" class="leaflet-marker-icon leaflet-zoom-hide leaflet-clickable" title="Mesa Arts Center - Rainshelter Bus Stop" tabindex="0" style="margin-left: -15px; margin-top: -40px; width: 30px; height: 40px; transform: translate3d(3816px, -5276px, 0px); z-index: -5276;">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAoCAMAAACo9wirAAAAzFBMVEXbuTR9YwDd0T+ulyry2VDt53/s5Jv34a+tmUbJtGRtVwAtJADg14j304viyIZeSwDXyH5IOQD07JLPvnhqVQBuWACmkjpgTQBxWwC4p1WchikRDQCPdxeBaAQTDwADAgAOCwAAAAAAAAAAAAALCQAAAAAAAAAAAAD9+Jb97IT+3VT9+WH+0i3993D+80793Yr/yXL+5Tr+6XL+zEP/z2X+vSX+zB/+52L/qw393SX89xr9+yv/siP/vUf9+Dv+20P+rgH+xQv+vgH+twNAe/b8AAAAKHRSTlPywvLj+vn4/OLrqFb0/PSS8Hb77meB4FGX5t1A2dUkEy8HDQoaAwEAoclaPQAAAo1JREFUeF5VkeeyozAMRrPphdwkdIxpBu7SSe/llvd/p5VxlMx+PxiMzhxJuPX3mc/PzzgIQwYJwyCGoyggwMuRav6BmKrLGgQBrBvUkuQkkSWLGh5DooX1UNWlXplDyp6kq5EXCqL1qlu9srpfIPeq7FmaIBCIA9WScyjznC/3XOZEEAsABIFBoH6GUrt9v5zPQEAXFoCiAWLPkUqon+8lIbl4kRwfmggABFZSXXh9PhbopUos1fWCBoAJnT4MCMMlZLHQE/Hed/wIFA3gkiSvqjLtK45tO/N+WlZVnhA7YgKAFZK83dGJM5v4rmFSonfaeWotoEcDhJqSVl06W0A5gviTGelWqTJzvZADcWjO11XVIzPbjzzGPFfT4bxWTD8SAANgtTrIQ8eF3QPmDOXDarWej/mUL+C0SgfU91gcR3TAj42BNQDMAMDpwBfzwjCi/cMJgNFMGGBIY5g+AACnrWl+NJay0+mRDhcAiDVdKsOnzJqZRFGoZo74SaYTXDPwzPnhUTw6dCSnaT2inUdRHD7GNgIxM/QUvrW6WfZ4ZFm3VRSiA4sFEEaOlBX7oij2EP4ssqlj413wHqq13uy/X9lvYAcbb5P3cGmd7b9/nvneZzWdNB0EAApN2RZvoNjCvfKb4IBQ+LTe7H5+RXabmjwFCISw6Xb3i8D2oxEgwMdkBgHF7xeEC/SF34yIAN90/LHdHb94QCB2REBsauj17cqB660eogAB8bOE4vgUsBiBt2J6ux6P19v0OQECb8V8y4G34D+AKwgoQEBQgMBLYSrL222pjHEFBN4KOl0up/wWUIAA/k5tNBg014gCBPB3+s5g0EwYYB2Bl8KyND9CAQJvgnmq6kYeXxHzDyATueNnvZcYAAAAAElFTkSuQmCC" class="leaflet-marker-icon leaflet-zoom-hide leaflet-clickable" title="Girl with Helicopter Sculpture" tabindex="0" style="margin-left: -15px; margin-top: -40px; width: 30px; height: 40px; transform: translate3d(3882px, -5358px, 0px); z-index: -5358;">
<div class="leaflet-marker-icon plugin-portal-names leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -40px; margin-top: 0px; width: 80px; height: 23px; transform: translate3d(3993px, -6003px, 0px); z-index: -6003;">
City of Mesa Main Library
</div>
<div class="leaflet-marker-icon plugin-portal-names leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -40px; margin-top: 0px; width: 80px; height: 23px; transform: translate3d(4577px, -5271px, 0px); z-index: -5271;">
Breaking Ground
</div>
<div class="leaflet-marker-icon plugin-portal-names leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -40px; margin-top: 0px; width: 80px; height: 23px; transform: translate3d(4164px, -5508px, 0px); z-index: -5508;">
Garden Chapel
</div>
<div class="leaflet-marker-icon plugin-portal-names leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -40px; margin-top: 0px; width: 80px; height: 23px; transform: translate3d(3816px, -5276px, 0px); z-index: -5276;">
Mesa Arts Center - Rainshelter Bus Stop
</div>
<div class="leaflet-marker-icon plugin-portal-names leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -40px; margin-top: 0px; width: 80px; height: 23px; transform: translate3d(4164px, -5262px, 0px); z-index: -5262;">
Three Guys Sitting
</div>
<div class="leaflet-marker-icon plugin-portal-names leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -40px; margin-top: 0px; width: 80px; height: 23px; transform: translate3d(3882px, -5358px, 0px); z-index: -5358;">
Girl with Helicopter Sculpture
</div>
<div class="leaflet-marker-icon plugin-portal-names leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -40px; margin-top: 0px; width: 80px; height: 23px; transform: translate3d(4078px, -5282px, 0px); z-index: -5282;">
The Teacher
</div>
<div class="leaflet-marker-icon plugin-portal-names leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -40px; margin-top: 0px; width: 80px; height: 23px; transform: translate3d(4090px, -5343px, 0px); z-index: -5343;">
Fragments Of Support
</div>
<div class="leaflet-marker-icon plugin-portal-names leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -40px; margin-top: 0px; width: 80px; height: 23px; transform: translate3d(5784px, -4406px, 0px); z-index: -4406;">
Church
</div>
<div class="leaflet-marker-icon plugin-portal-names leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -40px; margin-top: 0px; width: 80px; height: 23px; transform: translate3d(5896px, -4551px, 0px); z-index: -4551;">
Mesa Temple Spire
</div>
<div class="leaflet-marker-icon plugin-portal-names leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -40px; margin-top: 0px; width: 80px; height: 23px; transform: translate3d(5901px, -4784px, 0px); z-index: -4784;">
Lion Head Fountain
</div>
<div class="leaflet-marker-icon plugin-portal-names leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -40px; margin-top: 0px; width: 80px; height: 23px; transform: translate3d(5679px, -4815px, 0px); z-index: -4815;">
Mesa Arizona Temple
</div>
<div class="leaflet-marker-icon plugin-portal-names leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -40px; margin-top: 0px; width: 80px; height: 23px; transform: translate3d(5721px, -4871px, 0px); z-index: -4871;">
Mesa Arizona Temple
</div>
<div class="leaflet-marker-icon plugin-portal-names leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -40px; margin-top: 0px; width: 80px; height: 23px; transform: translate3d(5833px, -4893px, 0px); z-index: -4893;">
Large Fountain
</div>
<div class="leaflet-marker-icon plugin-portal-names leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -40px; margin-top: 0px; width: 80px; height: 23px; transform: translate3d(5907px, -4938px, 0px); z-index: -4938;">
Rock Art
</div>
<div class="leaflet-marker-icon plugin-portal-names leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -40px; margin-top: 0px; width: 80px; height: 23px; transform: translate3d(5848px, -4964px, 0px); z-index: -4964;">
LDS Temple
</div>
<div class="leaflet-marker-icon plugin-portal-names leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -40px; margin-top: 0px; width: 80px; height: 23px; transform: translate3d(5811px, -5072px, 0px); z-index: -5072;">
Mesa Temple Visitors Center
</div>
<div class="leaflet-marker-icon plugin-portal-names leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -40px; margin-top: 0px; width: 80px; height: 23px; transform: translate3d(6023px, -5363px, 0px); z-index: -5363;">
Pioneer Park Southeast Entrance
</div>
<div class="leaflet-marker-icon plugin-portal-names leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -40px; margin-top: 0px; width: 80px; height: 23px; transform: translate3d(5857px, -5365px, 0px); z-index: -5365;">
Mesa Pioneer Monument
</div>
<div class="leaflet-marker-icon plugin-portal-names leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -40px; margin-top: 0px; width: 80px; height: 23px; transform: translate3d(5860px, -5409px, 0px); z-index: -5409;">
In Memory of Richard L. Love
</div>
<div class="leaflet-marker-icon plugin-portal-names leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -40px; margin-top: 0px; width: 80px; height: 23px; transform: translate3d(5937px, -5467px, 0px); z-index: -5467;">
Rufus Dog Plaque
</div>
<div class="leaflet-marker-icon plugin-portal-names leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -40px; margin-top: 0px; width: 80px; height: 23px; transform: translate3d(5686px, -5399px, 0px); z-index: -5399;">
Designated dog exercise sign
</div>
<div class="leaflet-marker-icon plugin-portal-names leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -40px; margin-top: 0px; width: 80px; height: 23px; transform: translate3d(5367px, -5307px, 0px); z-index: -5307;">
Light Rail Art
</div>
<div class="leaflet-marker-icon plugin-portal-names leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -40px; margin-top: 0px; width: 80px; height: 23px; transform: translate3d(5173px, -5262px, 0px); z-index: -5262;">
Family Fundamental Unit of Society
</div>
<div class="leaflet-marker-icon plugin-portal-names leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -40px; margin-top: 0px; width: 80px; height: 23px; transform: translate3d(5250px, -5094px, 0px); z-index: -5094;">
Kids Need to Read
</div>
<div class="leaflet-marker-icon plugin-portal-names leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -40px; margin-top: 0px; width: 80px; height: 23px; transform: translate3d(5389px, -6348px, 0px); z-index: -6348;">
Mentors Make A Difference
</div>
<div class="leaflet-marker-icon plugin-portal-names leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -40px; margin-top: 0px; width: 80px; height: 23px; transform: translate3d(5346px, -6435px, 0px); z-index: -6435;">
YMCA Art Structure
</div>
<div class="leaflet-marker-icon plugin-portal-names leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -40px; margin-top: 0px; width: 80px; height: 23px; transform: translate3d(5498px, -6347px, 0px); z-index: -6347;">
YMCA Sky Ball
</div>
<div class="leaflet-marker-icon plugin-portal-names leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -40px; margin-top: 0px; width: 80px; height: 23px; transform: translate3d(5430px, -6289px, 0px); z-index: -6289;">
Mesa Church Steeple
</div>
<div class="leaflet-marker-icon plugin-portal-names leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -40px; margin-top: 0px; width: 80px; height: 23px; transform: translate3d(6039px, -6095px, 0px); z-index: -6095;">
Pioneer Park
</div>
<div class="leaflet-marker-icon plugin-portal-names leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -40px; margin-top: 0px; width: 80px; height: 23px; transform: translate3d(5086px, -5873px, 0px); z-index: -5873;">
City of Mesa Fire Station 201
</div>
<div class="leaflet-marker-icon plugin-portal-names leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -40px; margin-top: 0px; width: 80px; height: 23px; transform: translate3d(5150px, -6101px, 0px); z-index: -6101;">
Firemen Honor Wall
</div>
<div class="leaflet-marker-icon plugin-portal-names leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -40px; margin-top: 0px; width: 80px; height: 23px; transform: translate3d(5068px, -5335px, 0px); z-index: -5335;">
Paper Boy and Dog
</div>
<div class="leaflet-marker-icon plugin-portal-names leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -40px; margin-top: 0px; width: 80px; height: 23px; transform: translate3d(5904px, -5856px, 0px); z-index: -5856;">
Train
</div>
<div class="leaflet-marker-icon plugin-portal-names leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -40px; margin-top: 0px; width: 80px; height: 23px; transform: translate3d(5688px, -5816px, 0px); z-index: -5816;">
Pioneer Park
</div>
<div class="leaflet-marker-icon plugin-portal-names leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -40px; margin-top: 0px; width: 80px; height: 23px; transform: translate3d(6011px, -5844px, 0px); z-index: -5844;">
Mesa Park Horseshoes
</div>
<div class="leaflet-marker-icon plugin-portal-names leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -40px; margin-top: 0px; width: 80px; height: 23px; transform: translate3d(5684px, -5708px, 0px); z-index: -5708;">
City of Mesa Park
</div>
<div class="leaflet-marker-icon plugin-portal-names leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -40px; margin-top: 0px; width: 80px; height: 23px; transform: translate3d(5130px, -5236px, 0px); z-index: -5236;">
Yellow Angles
</div>
<div class="leaflet-marker-icon plugin-portal-names leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -40px; margin-top: 0px; width: 80px; height: 23px; transform: translate3d(5141px, -6202px, 0px); z-index: -6202;">
Fireman Brass Sculptures
</div>
<div class="leaflet-marker-icon plugin-portal-names leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -40px; margin-top: 0px; width: 80px; height: 23px; transform: translate3d(6891px, -5356px, 0px); z-index: -5356;">
St. Marks Episcopal Church
</div>
<div class="leaflet-marker-icon plugin-portal-names leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -40px; margin-top: 0px; width: 80px; height: 23px; transform: translate3d(1818px, 23124px, 0px); z-index: 23124;">
Fountain
</div>
<div class="leaflet-marker-icon plugin-portal-names leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -40px; margin-top: 0px; width: 80px; height: 23px; transform: translate3d(4861px, -9866px, 0px); z-index: -9866;">
Grand Fountain
</div>
<div class="leaflet-marker-icon plugin-portal-names leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -40px; margin-top: 0px; width: 80px; height: 23px; transform: translate3d(-6812px, 23394px, 0px); z-index: 23394;">
Balloon Dog
</div>
<div class="leaflet-marker-icon plugin-portal-names leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -40px; margin-top: 0px; width: 80px; height: 23px; transform: translate3d(1740px, 19778px, 0px); z-index: 19778;">
Anty Ant Antenna
</div>
<div class="leaflet-marker-icon plugin-portal-names leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -40px; margin-top: 0px; width: 80px; height: 23px; transform: translate3d(1679px, 19632px, 0px); z-index: 19632;">
Chandler Wall Art
</div>
<div class="leaflet-marker-icon plugin-portal-names leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -40px; margin-top: 0px; width: 80px; height: 23px; transform: translate3d(-1978px, 437px, 0px); z-index: 437;">
Fiesta Mall Flower Sculpture
</div>
<div class="leaflet-marker-icon plugin-portal-names leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -40px; margin-top: 0px; width: 80px; height: 23px; transform: translate3d(2265px, 2533px, 0px); z-index: 2533;">
Game Stop
</div>
<div class="leaflet-marker-icon plugin-portal-names leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -40px; margin-top: 0px; width: 80px; height: 23px; transform: translate3d(1914px, 2368px, 0px); z-index: 2368;">
Exotic Wall Chicken
</div>
<div class="leaflet-marker-icon plugin-portal-names leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -40px; margin-top: 0px; width: 80px; height: 23px; transform: translate3d(641px, 2864px, 0px); z-index: 2864;">
Beaver Choice Scandinavian Restaurant
</div>
<div class="leaflet-marker-icon plugin-portal-names leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -40px; margin-top: 0px; width: 80px; height: 23px; transform: translate3d(38px, 1430px, 0px); z-index: 1430;">
Verona Park Fountain #2
</div>
<div class="leaflet-marker-icon plugin-portal-names leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -40px; margin-top: 0px; width: 80px; height: 23px; transform: translate3d(145px, 1480px, 0px); z-index: 1480;">
Verona Fountain
</div>
<div class="leaflet-marker-icon plugin-portal-names leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -40px; margin-top: 0px; width: 80px; height: 23px; transform: translate3d(540px, 1674px, 0px); z-index: 1674;">
Tierra Del Sol Fountain
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(5784px, -4406px, 0px); z-index: -4406;">
5
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(5896px, -4551px, 0px); z-index: -4551;">
3
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(5901px, -4784px, 0px); z-index: -4784;">
1
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(5843px, -4807px, 0px); z-index: -4807;">
1
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(5679px, -4815px, 0px); z-index: -4815;">
2
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(5721px, -4871px, 0px); z-index: -4871;">
4
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(5778px, -4894px, 0px); z-index: -4894;">
3
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(5833px, -4893px, 0px); z-index: -4893;">
6
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(5907px, -4938px, 0px); z-index: -4938;">
5
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(5848px, -4964px, 0px); z-index: -4964;">
2
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(5811px, -5072px, 0px); z-index: -5072;">
5
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(6023px, -5363px, 0px); z-index: -5363;">
0
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(5857px, -5365px, 0px); z-index: -5365;">
2
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(5860px, -5409px, 0px); z-index: -5409;">
1
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(5937px, -5467px, 0px); z-index: -5467;">
1
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(5860px, -5484px, 0px); z-index: -5484;">
0
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(5686px, -5399px, 0px); z-index: -5399;">
0
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(5250px, -5094px, 0px); z-index: -5094;">
1
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(5389px, -6348px, 0px); z-index: -6348;">
5
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(5346px, -6435px, 0px); z-index: -6435;">
5
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(5498px, -6347px, 0px); z-index: -6347;">
6
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(5430px, -6289px, 0px); z-index: -6289;">
5
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(6039px, -6095px, 0px); z-index: -6095;">
5
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(5086px, -5873px, 0px); z-index: -5873;">
0
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(5150px, -6101px, 0px); z-index: -6101;">
0
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(5904px, -5856px, 0px); z-index: -5856;">
5
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(5688px, -5816px, 0px); z-index: -5816;">
1
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(6011px, -5844px, 0px); z-index: -5844;">
5
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(5684px, -5708px, 0px); z-index: -5708;">
1
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(5130px, -5236px, 0px); z-index: -5236;">
0
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(5141px, -6202px, 0px); z-index: -6202;">
1
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(6891px, -5356px, 0px); z-index: -5356;">
7
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(5367px, -5307px, 0px); z-index: -5307;">
6
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(5068px, -5335px, 0px); z-index: -5335;">
6
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(5173px, -5262px, 0px); z-index: -5262;">
2
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(4577px, -5271px, 0px); z-index: -5271;">
5
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(1818px, 23124px, 0px); z-index: 23124;">
7
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(4861px, -9866px, 0px); z-index: -9866;">
5
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(-6812px, 23394px, 0px); z-index: 23394;">
0
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(1740px, 19778px, 0px); z-index: 19778;">
0
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(1679px, 19632px, 0px); z-index: 19632;">
1
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(-1978px, 437px, 0px); z-index: 437;">
5
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(2265px, 2533px, 0px); z-index: 2533;">
6
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(1914px, 2368px, 0px); z-index: 2368;">
6
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(641px, 2864px, 0px); z-index: 2864;">
6
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(38px, 1430px, 0px); z-index: 1430;">
0
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(145px, 1480px, 0px); z-index: 1480;">
0
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(540px, 1674px, 0px); z-index: 1674;">
4
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(3993px, -6003px, 0px); z-index: -6003;">
1
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(4164px, -5262px, 0px); z-index: -5262;">
1
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(4078px, -5282px, 0px); z-index: -5282;">
6
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(4090px, -5343px, 0px); z-index: -5343;">
1
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(4164px, -5508px, 0px); z-index: -5508;">
6
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(3816px, -5276px, 0px); z-index: -5276;">
1
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(3882px, -5358px, 0px); z-index: -5358;">
6
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(8553px, -4990px, 0px); z-index: -4990;">
5
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(7662px, -5372px, 0px); z-index: -5372;">
6
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(7133px, -4582px, 0px); z-index: -4582;">
1
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(8681px, -5518px, 0px); z-index: -5518;">
5
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(7657px, -5465px, 0px); z-index: -5465;">
5
</div>
<div class="leaflet-marker-icon plugin-portal-level-numbers leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -6px; margin-top: -6px; width: 12px; height: 12px; transform: translate3d(8650px, -4619px, 0px); z-index: -4619;">
1
</div>
<div class="leaflet-marker-icon plugin-portal-names leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -40px; margin-top: 0px; width: 80px; height: 23px; transform: translate3d(8553px, -4990px, 0px); z-index: -4990;">
LeBaron Fountain
</div>
<div class="leaflet-marker-icon plugin-portal-names leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -40px; margin-top: 0px; width: 80px; height: 23px; transform: translate3d(7662px, -5372px, 0px); z-index: -5372;">
Bill Johnson's Big Apple, Mesa AZ
</div>
<div class="leaflet-marker-icon plugin-portal-names leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -40px; margin-top: 0px; width: 80px; height: 23px; transform: translate3d(7133px, -4582px, 0px); z-index: -4582;">
Tri Stake Center Church
</div>
<div class="leaflet-marker-icon plugin-portal-names leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -40px; margin-top: 0px; width: 80px; height: 23px; transform: translate3d(8681px, -5518px, 0px); z-index: -5518;">
Together Sign
</div>
<div class="leaflet-marker-icon plugin-portal-names leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -40px; margin-top: 0px; width: 80px; height: 23px; transform: translate3d(7657px, -5465px, 0px); z-index: -5465;">
Antique Wagon
</div>
<div class="leaflet-marker-icon plugin-portal-names leaflet-zoom-hide leaflet-clickable" tabindex="0" style="margin-left: -40px; margin-top: 0px; width: 80px; height: 23px; transform: translate3d(8650px, -4619px, 0px); z-index: -4619;">
Sherwood Post Office
</div>
</div>
<div class="leaflet-popup-pane leaflet-zoom-hide">
</div>
</div>
</div>
<div class="leaflet-control-container">
<div class="leaflet-top leaflet-left" style="padding-top: 20px;">
<div class="leaflet-control-zoom leaflet-bar leaflet-control" style="margin-left: 13px;">
<a class="leaflet-control-zoom-in" href="#" title="Zoom in">
+
</a>
<a class="leaflet-control-zoom-out" href="#" title="Zoom out">
-
</a>
</div>
<div class="leaflet-draw leaflet-control" style="margin-left: 13px;">
<div class="leaflet-draw-section" style="display: block;">
<div class="leaflet-draw-toolbar leaflet-bar leaflet-draw-toolbar-top">
<a class="leaflet-draw-draw-polyline" href="#" title="Draw a polyline [l]" accesskey="l">
</a>
<a class="leaflet-draw-draw-polygon" href="#" title="Draw a polygon [p]" accesskey="p">
</a>
<a class="leaflet-draw-draw-circle" href="#" title="Draw a circle [o]" accesskey="o">
</a>
<a class="leaflet-draw-draw-marker" href="#" title="Draw a marker [m]" accesskey="m">
</a>
</div>
<ul class="leaflet-draw-actions">
<li class="">
<a class="" href="#" title="Cancel drawing [a]" accesskey="a">
Cancel
</a>
</li>
</ul>
</div>
<div class="leaflet-draw-section" style="display: block;">
<div class="leaflet-draw-toolbar leaflet-bar">
<a class="leaflet-draw-edit-edit" href="#" title="Edit layers [e]" accesskey="e">
</a>
<a class="leaflet-draw-edit-remove" href="#" title="Delete layers [d]" accesskey="d">
</a>
</div>
<ul class="leaflet-draw-actions">
<li class="">
<a class="" href="#" title="Save changes. [s]" accesskey="s">
Save
</a>
</li>
<li class="">
<a class="" href="#" title="Cancel editing, discards all changes. [a]" accesskey="a">
Cancel
</a>
</li>
</ul>
</div>
</div>
</div>
<div class="leaflet-top leaflet-right" style="margin-right: 301px;">
<div class="leaflet-control-layers leaflet-control" aria-haspopup="true" style="margin-left: 13px;">
<a class="leaflet-control-layers-toggle" href="#" title="Layers">
</a>
<form class="leaflet-control-layers-list">
<div class="leaflet-control-layers-base">
<label>
<input type="radio" class="leaflet-control-layers-selector" name="leaflet-base-layers">
<span>
 MapQuest OSM
</span>
</label>
<label>
<input type="radio" class="leaflet-control-layers-selector" name="leaflet-base-layers">
<span>
 CartoDB Dark Matter
</span>
</label>
<label>
<input type="radio" class="leaflet-control-layers-selector" name="leaflet-base-layers">
<span>
 CartoDB Positron
</span>
</label>
<label>
<input type="radio" class="leaflet-control-layers-selector" name="leaflet-base-layers">
<span>
 Google Default Ingress Map
</span>
</label>
<label>
<input type="radio" class="leaflet-control-layers-selector" name="leaflet-base-layers">
<span>
 Google Roads
</span>
</label>
<label>
<input type="radio" class="leaflet-control-layers-selector" name="leaflet-base-layers">
<span>
 Google Satellite
</span>
</label>
<label>
<input type="radio" class="leaflet-control-layers-selector" name="leaflet-base-layers" checked="checked">
<span>
 Google Hybrid
</span>
</label>
<label>
<input type="radio" class="leaflet-control-layers-selector" name="leaflet-base-layers">
<span>
 Google Terrain
</span>
</label>
<label>
<input type="radio" class="leaflet-control-layers-selector" name="leaflet-base-layers">
<span>
 Thunderforest OpenCycleMap
</span>
</label>
<label>
<input type="radio" class="leaflet-control-layers-selector" name="leaflet-base-layers">
<span>
 Thunderforest Transport
</span>
</label>
<label>
<input type="radio" class="leaflet-control-layers-selector" name="leaflet-base-layers">
<span>
 Thunderforest Landscape
</span>
</label>
<label>
<input type="radio" class="leaflet-control-layers-selector" name="leaflet-base-layers">
<span>
 OpenStreetMap
</span>
</label>
<label>
<input type="radio" class="leaflet-control-layers-selector" name="leaflet-base-layers">
<span>
 Blank Map (White)
</span>
</label>
<label>
<input type="radio" class="leaflet-control-layers-selector" name="leaflet-base-layers">
<span>
 Blank Map (Black)
</span>
</label>
</div>
<div class="leaflet-control-layers-separator">
</div>
<div class="leaflet-control-layers-overlays">
<label title="" class="">
<input type="checkbox" class="leaflet-control-layers-selector" checked="">
<span>
 Unclaimed Portals
</span>
</label>
<label title="" class="">
<input type="checkbox" class="leaflet-control-layers-selector" checked="">
<span>
 Level 1 Portals
</span>
</label>
<label title="" class="">
<input type="checkbox" class="leaflet-control-layers-selector" checked="">
<span>
 Level 2 Portals
</span>
</label>
<label title="">
<input type="checkbox" class="leaflet-control-layers-selector" checked="">
<span>
 Level 3 Portals
</span>
</label>
<label title="">
<input type="checkbox" class="leaflet-control-layers-selector" checked="">
<span>
 Level 4 Portals
</span>
</label>
<label title="">
<input type="checkbox" class="leaflet-control-layers-selector" checked="">
<span>
 Level 5 Portals
</span>
</label>
<label title="">
<input type="checkbox" class="leaflet-control-layers-selector" checked="">
<span>
 Level 6 Portals
</span>
</label>
<label title="">
<input type="checkbox" class="leaflet-control-layers-selector" checked="">
<span>
 Level 7 Portals
</span>
</label>
<label title="">
<input type="checkbox" class="leaflet-control-layers-selector" checked="">
<span>
 Level 8 Portals
</span>
</label>
<label>
<input type="checkbox" class="leaflet-control-layers-selector" checked="">
<span>
 Fields
</span>
</label>
<label>
<input type="checkbox" class="leaflet-control-layers-selector" checked="">
<span>
 Links
</span>
</label>
<label>
<input type="checkbox" class="leaflet-control-layers-selector" checked="">
<span>
 Resistance
</span>
</label>
<label>
<input type="checkbox" class="leaflet-control-layers-selector" checked="">
<span>
 Enlightened
</span>
</label>
<label>
<input type="checkbox" class="leaflet-control-layers-selector">
<span>
 DEBUG Data Tiles
</span>
</label>
<label>
<input type="checkbox" class="leaflet-control-layers-selector" checked="">
<span>
 Artifacts
</span>
</label>
<label>
<input type="checkbox" class="leaflet-control-layers-selector" checked="">
<span>
 Ornaments
</span>
</label>
<label>
<input type="checkbox" class="leaflet-control-layers-selector">
<span>
 Tidy Links (was Max Links)
</span>
</label>
<label>
<input type="checkbox" class="leaflet-control-layers-selector" checked="">
<span>
 Done Links
</span>
</label>
<label>
<input type="checkbox" class="leaflet-control-layers-selector" checked="">
<span>
 Portal Levels
</span>
</label>
<label>
<input type="checkbox" class="leaflet-control-layers-selector">
<span>
 Cross Links
</span>
</label>
<label>
<input type="checkbox" class="leaflet-control-layers-selector" checked="">
<span>
 Mission start portals
</span>
</label>
<label>
<input type="checkbox" class="leaflet-control-layers-selector" checked="">
<span>
 Mission portals
</span>
</label>
<label>
<input type="checkbox" class="leaflet-control-layers-selector" checked="">
<span>
 Portal Names
</span>
</label>
<label>
<input type="checkbox" class="leaflet-control-layers-selector" checked="">
<span>
 Drawn Items
</span>
</label>
<label title="">
<input type="checkbox" class="leaflet-control-layers-selector">
<span>
 Player Tracker Resistance
</span>
</label>
<label title="">
<input type="checkbox" class="leaflet-control-layers-selector">
<span>
 Player Tracker Enlightened
</span>
</label>
<label>
<input type="checkbox" class="leaflet-control-layers-selector" checked="">
<span>
 Bookmarked Portals
</span>
</label>
<label>
<input type="checkbox" class="leaflet-control-layers-selector" checked="">
<span>
 Farms
</span>
</label>
<label>
<input type="checkbox" class="leaflet-control-layers-selector">
<span>
 Keys
</span>
</label>
</div>
</form>
</div>
</div>
<div class="leaflet-bottom leaflet-left">
<div class="leaflet-control" style="width: 708px; height: 108px; pointer-events: none; margin: 0px 0px 0px 13px;">
</div>
</div>
<div class="leaflet-bottom leaflet-right" style="margin-bottom: 0em; margin-right: 301px;">
<div class="leaflet-control-attribution leaflet-control" style="margin-left: 13px;">
</div>
</div>
</div>
</div>
<div id="chatcontrols" style="" class="">
<a accesskey="0" title="" aria-describedby="ui-id-195">
<span class="toggle expand">
</span>
</a>
<a accesskey="1" title="[1]" class="">
all
</a>
<a accesskey="2" title="[2]" class="">
faction
</a>
<a accesskey="3" title="[3]" class="active">
alerts
</a>
</div>
<div id="chat" style="" class="">

<div id="chatfaction" style="display: none;">
</div>

<div id="chatall" style="display: none;">
<table>
<tbody>
<tr>
<td>
<time title="2015-12-29 19:03:09
<small class=&quot;milliseconds&quot;>
.366
</small>
" data-timestamp="1451440989366">
19:03
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#0088FF">
seamor
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
 deployed a Resonator on
<a onclick="window.selectPortalByLatLng(33.430625, -111.852458);return false" title="850-898 North Westwood, Mesa, AZ 85201, USA" href="/intel?ll=33.430625,-111.852458&amp;z=17&amp;pll=33.430625,-111.852458" class="help">
The Church of Jesus Christ of Latter Day Saints
</a>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 19:05:19
<small class=&quot;milliseconds&quot;>
.512
</small>
" data-timestamp="1451441119512">
19:05
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
cwolvsdt
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
 deployed a Resonator on
<a onclick="window.selectPortalByLatLng(33.3922, -111.856133);return false" title="1201 South Alma School Road, Mesa, AZ 85210, USA" href="/intel?ll=33.3922,-111.856133&amp;z=17&amp;pll=33.3922,-111.856133" class="help">
1201 Fountain
</a>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 19:11:12
<small class=&quot;milliseconds&quot;>
.012
</small>
" data-timestamp="1451441472012">
19:11
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
AngrySaguaro
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
 destroyed a Resonator on
<a onclick="window.selectPortalByLatLng(33.41763, -111.897561);return false" title="2052 East Don Carlos Avenue, Tempe, AZ 85281, USA" href="/intel?ll=33.41763,-111.897561&amp;z=17&amp;pll=33.41763,-111.897561" class="help">
Calvary Fellowship Steeple
</a>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 19:11:28
<small class=&quot;milliseconds&quot;>
.873
</small>
" data-timestamp="1451441488873">
19:11
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
skraellette
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
 destroyed a Resonator on
<a onclick="window.selectPortalByLatLng(33.336118, -111.790497);return false" title="756 South Gilbert Road, Gilbert, AZ 85296, USA" href="/intel?ll=33.336118,-111.790497&amp;z=17&amp;pll=33.336118,-111.790497" class="help">
Panda Kiss Mural
</a>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 19:11:29
<small class=&quot;milliseconds&quot;>
.859
</small>
" data-timestamp="1451441489859">
19:11
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
skrang
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
 destroyed a Resonator on
<a onclick="window.selectPortalByLatLng(33.336118, -111.790497);return false" title="756 South Gilbert Road, Gilbert, AZ 85296, USA" href="/intel?ll=33.336118,-111.790497&amp;z=17&amp;pll=33.336118,-111.790497" class="help">
Panda Kiss Mural
</a>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 19:11:37
<small class=&quot;milliseconds&quot;>
.188
</small>
" data-timestamp="1451441497188">
19:11
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
skraellette
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
 destroyed a Resonator on
<a onclick="window.selectPortalByLatLng(33.336118, -111.790497);return false" title="756 South Gilbert Road, Gilbert, AZ 85296, USA" href="/intel?ll=33.336118,-111.790497&amp;z=17&amp;pll=33.336118,-111.790497" class="help">
Panda Kiss Mural
</a>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 19:11:40
<small class=&quot;milliseconds&quot;>
.565
</small>
" data-timestamp="1451441500565">
19:11
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
skrang
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
 destroyed a Resonator on
<a onclick="window.selectPortalByLatLng(33.336118, -111.790497);return false" title="756 South Gilbert Road, Gilbert, AZ 85296, USA" href="/intel?ll=33.336118,-111.790497&amp;z=17&amp;pll=33.336118,-111.790497" class="help">
Panda Kiss Mural
</a>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 19:11:42
<small class=&quot;milliseconds&quot;>
.027
</small>
" data-timestamp="1451441502027">
19:11
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
skraellette
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
 destroyed a Resonator on
<a onclick="window.selectPortalByLatLng(33.336118, -111.790497);return false" title="756 South Gilbert Road, Gilbert, AZ 85296, USA" href="/intel?ll=33.336118,-111.790497&amp;z=17&amp;pll=33.336118,-111.790497" class="help">
Panda Kiss Mural
</a>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 19:11:49
<small class=&quot;milliseconds&quot;>
.473
</small>
" data-timestamp="1451441509473">
19:11
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
AngrySaguaro
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
 captured
<a onclick="window.selectPortalByLatLng(33.41763, -111.897561);return false" title="2052 East Don Carlos Avenue, Tempe, AZ 85281, USA" href="/intel?ll=33.41763,-111.897561&amp;z=17&amp;pll=33.41763,-111.897561" class="help">
Calvary Fellowship Steeple
</a>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 19:11:49
<small class=&quot;milliseconds&quot;>
.473
</small>
" data-timestamp="1451441509473">
19:11
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
AngrySaguaro
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
 deployed a Resonator on
<a onclick="window.selectPortalByLatLng(33.41763, -111.897561);return false" title="2052 East Don Carlos Avenue, Tempe, AZ 85281, USA" href="/intel?ll=33.41763,-111.897561&amp;z=17&amp;pll=33.41763,-111.897561" class="help">
Calvary Fellowship Steeple
</a>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 19:13:28
<small class=&quot;milliseconds&quot;>
.199
</small>
" data-timestamp="1451441608199">
19:13
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
AngrySaguaro
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
 linked
<a onclick="window.selectPortalByLatLng(33.41763, -111.897561);return false" title="2052 East Don Carlos Avenue, Tempe, AZ 85281, USA" href="/intel?ll=33.41763,-111.897561&amp;z=17&amp;pll=33.41763,-111.897561" class="help">
Calvary Fellowship Steeple
</a>
 to
<a onclick="window.selectPortalByLatLng(33.417711, -111.902297);return false" title="1950 East Don Carlos, Tempe, AZ 85281, USA" href="/intel?ll=33.417711,-111.902297&amp;z=17&amp;pll=33.417711,-111.902297" class="help">
Alegre Games
</a>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 19:13:33
<small class=&quot;milliseconds&quot;>
.722
</small>
" data-timestamp="1451441613722">
19:13
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
cwolvsdt
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
 destroyed a Resonator on
<a onclick="window.selectPortalByLatLng(33.394552, -111.853995);return false" title="1043 West Frito Avenue, Mesa, AZ 85210, USA" href="/intel?ll=33.394552,-111.853995&amp;z=17&amp;pll=33.394552,-111.853995" class="help">
Blast Fountain
</a>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 19:13:33
<small class=&quot;milliseconds&quot;>
.722
</small>
" data-timestamp="1451441613722">
19:13
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
cwolvsdt
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
 destroyed a Resonator on
<a onclick="window.selectPortalByLatLng(33.394552, -111.853995);return false" title="1043 West Frito Avenue, Mesa, AZ 85210, USA" href="/intel?ll=33.394552,-111.853995&amp;z=17&amp;pll=33.394552,-111.853995" class="help">
Blast Fountain
</a>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 19:13:33
<small class=&quot;milliseconds&quot;>
.722
</small>
" data-timestamp="1451441613722">
19:13
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
cwolvsdt
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
 destroyed a Resonator on
<a onclick="window.selectPortalByLatLng(33.394552, -111.853995);return false" title="1043 West Frito Avenue, Mesa, AZ 85210, USA" href="/intel?ll=33.394552,-111.853995&amp;z=17&amp;pll=33.394552,-111.853995" class="help">
Blast Fountain
</a>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 19:13:33
<small class=&quot;milliseconds&quot;>
.722
</small>
" data-timestamp="1451441613722">
19:13
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
cwolvsdt
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
 destroyed a Resonator on
<a onclick="window.selectPortalByLatLng(33.394552, -111.853995);return false" title="1043 West Frito Avenue, Mesa, AZ 85210, USA" href="/intel?ll=33.394552,-111.853995&amp;z=17&amp;pll=33.394552,-111.853995" class="help">
Blast Fountain
</a>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 19:13:33
<small class=&quot;milliseconds&quot;>
.722
</small>
" data-timestamp="1451441613722">
19:13
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
cwolvsdt
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
 destroyed a Resonator on
<a onclick="window.selectPortalByLatLng(33.394552, -111.853995);return false" title="1043 West Frito Avenue, Mesa, AZ 85210, USA" href="/intel?ll=33.394552,-111.853995&amp;z=17&amp;pll=33.394552,-111.853995" class="help">
Blast Fountain
</a>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 19:13:33
<small class=&quot;milliseconds&quot;>
.722
</small>
" data-timestamp="1451441613722">
19:13
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
cwolvsdt
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
 destroyed a Resonator on
<a onclick="window.selectPortalByLatLng(33.394552, -111.853995);return false" title="1043 West Frito Avenue, Mesa, AZ 85210, USA" href="/intel?ll=33.394552,-111.853995&amp;z=17&amp;pll=33.394552,-111.853995" class="help">
Blast Fountain
</a>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 19:13:33
<small class=&quot;milliseconds&quot;>
.722
</small>
" data-timestamp="1451441613722">
19:13
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
cwolvsdt
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
 destroyed a Resonator on
<a onclick="window.selectPortalByLatLng(33.394552, -111.853995);return false" title="1043 West Frito Avenue, Mesa, AZ 85210, USA" href="/intel?ll=33.394552,-111.853995&amp;z=17&amp;pll=33.394552,-111.853995" class="help">
Blast Fountain
</a>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 19:13:33
<small class=&quot;milliseconds&quot;>
.722
</small>
" data-timestamp="1451441613722">
19:13
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
cwolvsdt
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
 destroyed a Resonator on
<a onclick="window.selectPortalByLatLng(33.394552, -111.853995);return false" title="1043 West Frito Avenue, Mesa, AZ 85210, USA" href="/intel?ll=33.394552,-111.853995&amp;z=17&amp;pll=33.394552,-111.853995" class="help">
Blast Fountain
</a>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 19:13:34
<small class=&quot;milliseconds&quot;>
.123
</small>
" data-timestamp="1451441614123">
19:13
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
cwolvsdt
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
 destroyed a Control Field @
<a onclick="window.selectPortalByLatLng(33.394552, -111.853995);return false" title="1043 West Frito Avenue, Mesa, AZ 85210, USA" href="/intel?ll=33.394552,-111.853995&amp;z=17&amp;pll=33.394552,-111.853995" class="help">
Blast Fountain
</a>
 -19 MUs
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 19:13:34
<small class=&quot;milliseconds&quot;>
.123
</small>
" data-timestamp="1451441614123">
19:13
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
cwolvsdt
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
 destroyed the Link
<a onclick="window.selectPortalByLatLng(33.391929, -111.857013);return false" title="1249-1263 South Alma School Road, Mesa, AZ 85210, USA" href="/intel?ll=33.391929,-111.857013&amp;z=17&amp;pll=33.391929,-111.857013" class="help">
Stone Braziers
</a>
 to
<a onclick="window.selectPortalByLatLng(33.394552, -111.853995);return false" title="1043 West Frito Avenue, Mesa, AZ 85210, USA" href="/intel?ll=33.394552,-111.853995&amp;z=17&amp;pll=33.394552,-111.853995" class="help">
Blast Fountain
</a>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 19:13:34
<small class=&quot;milliseconds&quot;>
.123
</small>
" data-timestamp="1451441614123">
19:13
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
cwolvsdt
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
 destroyed the Link
<a onclick="window.selectPortalByLatLng(33.3922, -111.856133);return false" title="1201 South Alma School Road, Mesa, AZ 85210, USA" href="/intel?ll=33.3922,-111.856133&amp;z=17&amp;pll=33.3922,-111.856133" class="help">
1201 Fountain
</a>
 to
<a onclick="window.selectPortalByLatLng(33.394552, -111.853995);return false" title="1043 West Frito Avenue, Mesa, AZ 85210, USA" href="/intel?ll=33.394552,-111.853995&amp;z=17&amp;pll=33.394552,-111.853995" class="help">
Blast Fountain
</a>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 19:15:06
<small class=&quot;milliseconds&quot;>
.991
</small>
" data-timestamp="1451441706991">
19:15
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#0088FF">
seamor
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
 linked
<a onclick="window.selectPortalByLatLng(33.430961, -111.855512);return false" title="825 North Alma School Road, Mesa, AZ 85201, USA" href="/intel?ll=33.430961,-111.855512&amp;z=17&amp;pll=33.430961,-111.855512" class="help">
Freedom Park Flag Mural
</a>
 to
<a onclick="window.selectPortalByLatLng(33.435892, -111.84317);return false" title="560 West Brown Road, Mesa, AZ 85201, USA" href="/intel?ll=33.435892,-111.84317&amp;z=17&amp;pll=33.435892,-111.84317" class="help">
Brown Plaza Fountain
</a>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 19:15:06
<small class=&quot;milliseconds&quot;>
.991
</small>
" data-timestamp="1451441706991">
19:15
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#0088FF">
seamor
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
 created a Control Field @
<a onclick="window.selectPortalByLatLng(33.430961, -111.855512);return false" title="825 North Alma School Road, Mesa, AZ 85201, USA" href="/intel?ll=33.430961,-111.855512&amp;z=17&amp;pll=33.430961,-111.855512" class="help">
Freedom Park Flag Mural
</a>
 +488 MUs
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 19:16:11
<small class=&quot;milliseconds&quot;>
.463
</small>
" data-timestamp="1451441771463">
19:16
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#0088FF">
Gand511
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
 created a Control Field @
<a onclick="window.selectPortalByLatLng(33.395272, -111.788102);return false" title="1029-1053 South Gilbert Road, Mesa, AZ 85204, USA" href="/intel?ll=33.395272,-111.788102&amp;z=17&amp;pll=33.395272,-111.788102" class="help">
Adobe Business Park
</a>
 +321 MUs
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 19:16:11
<small class=&quot;milliseconds&quot;>
.463
</small>
" data-timestamp="1451441771463">
19:16
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#0088FF">
Gand511
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
 linked
<a onclick="window.selectPortalByLatLng(33.395272, -111.788102);return false" title="1029-1053 South Gilbert Road, Mesa, AZ 85204, USA" href="/intel?ll=33.395272,-111.788102&amp;z=17&amp;pll=33.395272,-111.788102" class="help">
Adobe Business Park
</a>
 to
<a onclick="window.selectPortalByLatLng(33.398371, -111.787748);return false" title="925 South Gilbert Road, Mesa, AZ 85204, USA" href="/intel?ll=33.398371,-111.787748&amp;z=17&amp;pll=33.398371,-111.787748" class="help">
Calvary Chapel
</a>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 19:16:24
<small class=&quot;milliseconds&quot;>
.915
</small>
" data-timestamp="1451441784915">
19:16
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#0088FF">
Gand511
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
 created a Control Field @
<a onclick="window.selectPortalByLatLng(33.395272, -111.788102);return false" title="1029-1053 South Gilbert Road, Mesa, AZ 85204, USA" href="/intel?ll=33.395272,-111.788102&amp;z=17&amp;pll=33.395272,-111.788102" class="help">
Adobe Business Park
</a>
 +93 MUs
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 19:16:24
<small class=&quot;milliseconds&quot;>
.915
</small>
" data-timestamp="1451441784915">
19:16
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#0088FF">
Gand511
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
 linked
<a onclick="window.selectPortalByLatLng(33.395272, -111.788102);return false" title="1029-1053 South Gilbert Road, Mesa, AZ 85204, USA" href="/intel?ll=33.395272,-111.788102&amp;z=17&amp;pll=33.395272,-111.788102" class="help">
Adobe Business Park
</a>
 to
<a onclick="window.selectPortalByLatLng(33.400968, -111.794225);return false" title="1720 East 8th Avenue, Mesa, AZ 85204, USA" href="/intel?ll=33.400968,-111.794225&amp;z=17&amp;pll=33.400968,-111.794225" class="help">
Mesa Bible Church
</a>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 19:17:09
<small class=&quot;milliseconds&quot;>
.938
</small>
" data-timestamp="1451441829938">
19:17
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
CwolvsBis
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
 destroyed a Resonator on
<a onclick="window.selectPortalByLatLng(33.394552, -111.853995);return false" title="1043 West Frito Avenue, Mesa, AZ 85210, USA" href="/intel?ll=33.394552,-111.853995&amp;z=17&amp;pll=33.394552,-111.853995" class="help">
Blast Fountain
</a>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 19:18:05
<small class=&quot;milliseconds&quot;>
.200
</small>
" data-timestamp="1451441885200">
19:18
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#0088FF">
Gand511
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
 destroyed a Resonator on
<a onclick="window.selectPortalByLatLng(33.397547, -111.788139);return false" title="1011 South Gilbert Road, Mesa, AZ 85204, USA" href="/intel?ll=33.397547,-111.788139&amp;z=17&amp;pll=33.397547,-111.788139" class="help">
Santa Fe Square Adobe Arch
</a>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 19:20:52
<small class=&quot;milliseconds&quot;>
.731
</small>
" data-timestamp="1451442052731">
19:20
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
AngrySaguaro
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
 linked
<a onclick="window.selectPortalByLatLng(33.414788, -111.901168);return false" title="1961 Apache Boulevard, Tempe, AZ 85281, USA" href="/intel?ll=33.414788,-111.901168&amp;z=17&amp;pll=33.414788,-111.901168" class="help">
Tree Mosaic
</a>
 to
<a onclick="window.selectPortalByLatLng(33.41763, -111.897561);return false" title="2052 East Don Carlos Avenue, Tempe, AZ 85281, USA" href="/intel?ll=33.41763,-111.897561&amp;z=17&amp;pll=33.41763,-111.897561" class="help">
Calvary Fellowship Steeple
</a>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 19:21:03
<small class=&quot;milliseconds&quot;>
.984
</small>
" data-timestamp="1451442063984">
19:21
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#0088FF">
Gand511
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
 destroyed a Resonator on
<a onclick="window.selectPortalByLatLng(33.397547, -111.788139);return false" title="1011 South Gilbert Road, Mesa, AZ 85204, USA" href="/intel?ll=33.397547,-111.788139&amp;z=17&amp;pll=33.397547,-111.788139" class="help">
Santa Fe Square Adobe Arch
</a>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 19:21:59
<small class=&quot;milliseconds&quot;>
.464
</small>
" data-timestamp="1451442119464">
19:21
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#0088FF">
Gand511
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
 captured
<a onclick="window.selectPortalByLatLng(33.397547, -111.788139);return false" title="1011 South Gilbert Road, Mesa, AZ 85204, USA" href="/intel?ll=33.397547,-111.788139&amp;z=17&amp;pll=33.397547,-111.788139" class="help">
Santa Fe Square Adobe Arch
</a>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 19:21:59
<small class=&quot;milliseconds&quot;>
.464
</small>
" data-timestamp="1451442119464">
19:21
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#0088FF">
Gand511
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
 deployed a Resonator on
<a onclick="window.selectPortalByLatLng(33.397547, -111.788139);return false" title="1011 South Gilbert Road, Mesa, AZ 85204, USA" href="/intel?ll=33.397547,-111.788139&amp;z=17&amp;pll=33.397547,-111.788139" class="help">
Santa Fe Square Adobe Arch
</a>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 19:24:09
<small class=&quot;milliseconds&quot;>
.296
</small>
" data-timestamp="1451442249296">
19:24
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#0088FF">
Gand511
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
 linked
<a onclick="window.selectPortalByLatLng(33.398371, -111.787748);return false" title="925 South Gilbert Road, Mesa, AZ 85204, USA" href="/intel?ll=33.398371,-111.787748&amp;z=17&amp;pll=33.398371,-111.787748" class="help">
Calvary Chapel
</a>
 to
<a onclick="window.selectPortalByLatLng(33.397547, -111.788139);return false" title="1011 South Gilbert Road, Mesa, AZ 85204, USA" href="/intel?ll=33.397547,-111.788139&amp;z=17&amp;pll=33.397547,-111.788139" class="help">
Santa Fe Square Adobe Arch
</a>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 19:26:24
<small class=&quot;milliseconds&quot;>
.818
</small>
" data-timestamp="1451442384818">
19:26
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
CwolvsBis
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
 linked
<a onclick="window.selectPortalByLatLng(33.392903, -111.856477);return false" title="1119-1199 West Southern Avenue, Mesa, AZ 85210, USA" href="/intel?ll=33.392903,-111.856477&amp;z=17&amp;pll=33.392903,-111.856477" class="help">
City of Mesa Art
</a>
 to
<a onclick="window.selectPortalByLatLng(33.392652, -111.856862);return false" title="Alma School Rd &amp; Southern Ave, Fiesta Village Shopping Center, Mesa, AZ" href="/intel?ll=33.392652,-111.856862&amp;z=17&amp;pll=33.392652,-111.856862" class="help">
Bank of America fountain
</a>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 19:26:48
<small class=&quot;milliseconds&quot;>
.531
</small>
" data-timestamp="1451442408531">
19:26
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
CwolvsBis
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
 linked
<a onclick="window.selectPortalByLatLng(33.392903, -111.856477);return false" title="1119-1199 West Southern Avenue, Mesa, AZ 85210, USA" href="/intel?ll=33.392903,-111.856477&amp;z=17&amp;pll=33.392903,-111.856477" class="help">
City of Mesa Art
</a>
 to
<a onclick="window.selectPortalByLatLng(33.3922, -111.856133);return false" title="1201 South Alma School Road, Mesa, AZ 85210, USA" href="/intel?ll=33.3922,-111.856133&amp;z=17&amp;pll=33.3922,-111.856133" class="help">
1201 Fountain
</a>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 19:27:09
<small class=&quot;milliseconds&quot;>
.245
</small>
" data-timestamp="1451442429245">
19:27
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#0088FF">
Gand511
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
 deployed a Resonator on
<a onclick="window.selectPortalByLatLng(33.3931, -111.788933);return false" title="1945 E Southern Ave, Mesa, AZ 85204, USA" href="/intel?ll=33.3931,-111.788933&amp;z=17&amp;pll=33.3931,-111.788933" class="help">
Circle K 1953 E Southern Ave
</a>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 19:27:09
<small class=&quot;milliseconds&quot;>
.245
</small>
" data-timestamp="1451442429245">
19:27
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#0088FF">
Gand511
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
 captured
<a onclick="window.selectPortalByLatLng(33.3931, -111.788933);return false" title="1945 E Southern Ave, Mesa, AZ 85204, USA" href="/intel?ll=33.3931,-111.788933&amp;z=17&amp;pll=33.3931,-111.788933" class="help">
Circle K 1953 E Southern Ave
</a>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 19:27:10
<small class=&quot;milliseconds&quot;>
.759
</small>
" data-timestamp="1451442430759">
19:27
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
CwolvsBis
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
 linked
<a onclick="window.selectPortalByLatLng(33.392903, -111.856477);return false" title="1119-1199 West Southern Avenue, Mesa, AZ 85210, USA" href="/intel?ll=33.392903,-111.856477&amp;z=17&amp;pll=33.392903,-111.856477" class="help">
City of Mesa Art
</a>
 to
<a onclick="window.selectPortalByLatLng(33.391929, -111.857013);return false" title="1249-1263 South Alma School Road, Mesa, AZ 85210, USA" href="/intel?ll=33.391929,-111.857013&amp;z=17&amp;pll=33.391929,-111.857013" class="help">
Stone Braziers
</a>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 19:27:10
<small class=&quot;milliseconds&quot;>
.759
</small>
" data-timestamp="1451442430759">
19:27
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
CwolvsBis
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
 created a Control Field @
<a onclick="window.selectPortalByLatLng(33.392903, -111.856477);return false" title="1119-1199 West Southern Avenue, Mesa, AZ 85210, USA" href="/intel?ll=33.392903,-111.856477&amp;z=17&amp;pll=33.392903,-111.856477" class="help">
City of Mesa Art
</a>
 +9 MUs
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 19:27:20
<small class=&quot;milliseconds&quot;>
.631
</small>
" data-timestamp="1451442440631">
19:27
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
AngrySaguaro
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
 linked
<a onclick="window.selectPortalByLatLng(33.414865, -111.8709);return false" title="1801-1839 West Main Street, Mesa, AZ 85201, USA" href="/intel?ll=33.414865,-111.8709&amp;z=17&amp;pll=33.414865,-111.8709" class="help">
Sycamore Light Rail Station
</a>
 to
<a onclick="window.selectPortalByLatLng(33.415071, -111.871976);return false" title="1882-1934 West Main Street, Mesa, AZ 85201, USA" href="/intel?ll=33.415071,-111.871976&amp;z=17&amp;pll=33.415071,-111.871976" class="help">
Painted Power
</a>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 19:27:45
<small class=&quot;milliseconds&quot;>
.565
</small>
" data-timestamp="1451442465565">
19:27
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
CwolvsBis
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
 linked
<a onclick="window.selectPortalByLatLng(33.392903, -111.856477);return false" title="1119-1199 West Southern Avenue, Mesa, AZ 85210, USA" href="/intel?ll=33.392903,-111.856477&amp;z=17&amp;pll=33.392903,-111.856477" class="help">
City of Mesa Art
</a>
 to
<a onclick="window.selectPortalByLatLng(33.39383, -111.856652);return false" title="1147-1179 South Alma School Road, Mesa, AZ 85210, USA" href="/intel?ll=33.39383,-111.856652&amp;z=17&amp;pll=33.39383,-111.856652" class="help">
Hibachi Grill
</a>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 19:28:05
<small class=&quot;milliseconds&quot;>
.206
</small>
" data-timestamp="1451442485206">
19:28
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
AngrySaguaro
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
 deployed a Resonator on
<a onclick="window.selectPortalByLatLng(33.414696, -111.869839);return false" title="1755 West Main Street, Mesa, AZ 85202, USA" href="/intel?ll=33.414696,-111.869839&amp;z=17&amp;pll=33.414696,-111.869839" class="help">
Fiesta Power
</a>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 19:28:20
<small class=&quot;milliseconds&quot;>
.705
</small>
" data-timestamp="1451442500705">
19:28
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#0088FF">
Gand511
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
 linked
<a onclick="window.selectPortalByLatLng(33.3931, -111.788933);return false" title="1945 E Southern Ave, Mesa, AZ 85204, USA" href="/intel?ll=33.3931,-111.788933&amp;z=17&amp;pll=33.3931,-111.788933" class="help">
Circle K 1953 E Southern Ave
</a>
 to
<a onclick="window.selectPortalByLatLng(33.395272, -111.788102);return false" title="1029-1053 South Gilbert Road, Mesa, AZ 85204, USA" href="/intel?ll=33.395272,-111.788102&amp;z=17&amp;pll=33.395272,-111.788102" class="help">
Adobe Business Park
</a>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 19:29:21
<small class=&quot;milliseconds&quot;>
.909
</small>
" data-timestamp="1451442561909">
19:29
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
CwolvsBis
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
 created a Control Field @
<a onclick="window.selectPortalByLatLng(33.391929, -111.857013);return false" title="1249-1263 South Alma School Road, Mesa, AZ 85210, USA" href="/intel?ll=33.391929,-111.857013&amp;z=17&amp;pll=33.391929,-111.857013" class="help">
Stone Braziers
</a>
 +3 MUs
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 19:29:21
<small class=&quot;milliseconds&quot;>
.909
</small>
" data-timestamp="1451442561909">
19:29
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
CwolvsBis
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
 linked
<a onclick="window.selectPortalByLatLng(33.391929, -111.857013);return false" title="1249-1263 South Alma School Road, Mesa, AZ 85210, USA" href="/intel?ll=33.391929,-111.857013&amp;z=17&amp;pll=33.391929,-111.857013" class="help">
Stone Braziers
</a>
 to
<a onclick="window.selectPortalByLatLng(33.392652, -111.856862);return false" title="Alma School Rd &amp; Southern Ave, Fiesta Village Shopping Center, Mesa, AZ" href="/intel?ll=33.392652,-111.856862&amp;z=17&amp;pll=33.392652,-111.856862" class="help">
Bank of America fountain
</a>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 19:29:49
<small class=&quot;milliseconds&quot;>
.428
</small>
" data-timestamp="1451442589428">
19:29
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#0088FF">
Xezyxx
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
<span style="color: #f88; background-color: #500;">
[faction]
</span>
 Hi
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 19:30:21
<small class=&quot;milliseconds&quot;>
.815
</small>
" data-timestamp="1451442621815">
19:30
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
CwolvsBis
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
 linked
<a onclick="window.selectPortalByLatLng(33.392652, -111.856862);return false" title="Alma School Rd &amp; Southern Ave, Fiesta Village Shopping Center, Mesa, AZ" href="/intel?ll=33.392652,-111.856862&amp;z=17&amp;pll=33.392652,-111.856862" class="help">
Bank of America fountain
</a>
 to
<a onclick="window.selectPortalByLatLng(33.39383, -111.856652);return false" title="1147-1179 South Alma School Road, Mesa, AZ 85210, USA" href="/intel?ll=33.39383,-111.856652&amp;z=17&amp;pll=33.39383,-111.856652" class="help">
Hibachi Grill
</a>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 19:30:21
<small class=&quot;milliseconds&quot;>
.815
</small>
" data-timestamp="1451442621815">
19:30
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
CwolvsBis
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
 created a Control Field @
<a onclick="window.selectPortalByLatLng(33.392652, -111.856862);return false" title="Alma School Rd &amp; Southern Ave, Fiesta Village Shopping Center, Mesa, AZ" href="/intel?ll=33.392652,-111.856862&amp;z=17&amp;pll=33.392652,-111.856862" class="help">
Bank of America fountain
</a>
 +5 MUs
</td>
</tr>
</tbody>
</table>
</div>

<div id="chatalerts" style="display: block;">
<table>
<tbody>
<tr>
<td>
<time title="2015-12-28 22:28:37
<small class=&quot;milliseconds&quot;>
.026
</small>
" data-timestamp="1451366917026">
22:28
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
GaryBlkltning
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
<div class="system_narrowcast">
Your Portal
<a onclick="window.selectPortalByLatLng(33.431343, -111.875293);return false" title="2100 West 8th Street, Mesa, AZ 85201, USA" href="/intel?ll=33.431343,-111.875293&amp;z=17&amp;pll=33.431343,-111.875293" class="help">
Pillar of Almost Shade
</a>
 neutralized by GaryBlkltning
</div>
</td>
</tr>
<tr>
<td>
<time title="2015-12-28 22:28:42
<small class=&quot;milliseconds&quot;>
.658
</small>
" data-timestamp="1451366922658">
22:28
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
GaryBlkltning
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
<div class="system_narrowcast">
Your Link
<a onclick="window.selectPortalByLatLng(33.431609, -111.876448);return false" title="Cubs Way, Mesa, AZ 85201, USA" href="/intel?ll=33.431609,-111.876448&amp;z=17&amp;pll=33.431609,-111.876448" class="help">
Riverview Fountain
</a>
 to
<a onclick="window.selectPortalByLatLng(33.430963, -111.880405);return false" title="North May, Mesa, AZ 85201, USA" href="/intel?ll=33.430963,-111.880405&amp;z=17&amp;pll=33.430963,-111.880405" class="help">
Right Field Gate
</a>
 destroyed by GaryBlkltning
</div>
</td>
</tr>
<tr>
<td>
<time title="2015-12-28 22:28:42
<small class=&quot;milliseconds&quot;>
.658
</small>
" data-timestamp="1451366922658">
22:28
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
GaryBlkltning
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
<div class="system_narrowcast">
Your Link
<a onclick="window.selectPortalByLatLng(33.434539, -111.869502);return false" title="Mesa Riverview, 925 Bass Pro Drive, Mesa, AZ 85201, USA" href="/intel?ll=33.434539,-111.869502&amp;z=17&amp;pll=33.434539,-111.869502" class="help">
Water Tile Mural
</a>
 to
<a onclick="window.selectPortalByLatLng(33.431609, -111.876448);return false" title="Cubs Way, Mesa, AZ 85201, USA" href="/intel?ll=33.431609,-111.876448&amp;z=17&amp;pll=33.431609,-111.876448" class="help">
Riverview Fountain
</a>
 destroyed by GaryBlkltning
</div>
</td>
</tr>
<tr>
<td>
<time title="2015-12-28 22:28:42
<small class=&quot;milliseconds&quot;>
.658
</small>
" data-timestamp="1451366922658">
22:28
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
GaryBlkltning
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
<div class="system_narrowcast">
Your Link
<a onclick="window.selectPortalByLatLng(33.432372, -111.880848);return false" title="North May, Mesa, AZ 85201, USA" href="/intel?ll=33.432372,-111.880848&amp;z=17&amp;pll=33.432372,-111.880848" class="help">
Center Field Gate
</a>
 to
<a onclick="window.selectPortalByLatLng(33.431609, -111.876448);return false" title="Cubs Way, Mesa, AZ 85201, USA" href="/intel?ll=33.431609,-111.876448&amp;z=17&amp;pll=33.431609,-111.876448" class="help">
Riverview Fountain
</a>
 destroyed by GaryBlkltning
</div>
</td>
</tr>
<tr>
<td>
<time title="2015-12-28 22:28:42
<small class=&quot;milliseconds&quot;>
.658
</small>
" data-timestamp="1451366922658">
22:28
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
GaryBlkltning
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
<div class="system_narrowcast">
Your Portal
<a onclick="window.selectPortalByLatLng(33.431609, -111.876448);return false" title="Cubs Way, Mesa, AZ 85201, USA" href="/intel?ll=33.431609,-111.876448&amp;z=17&amp;pll=33.431609,-111.876448" class="help">
Riverview Fountain
</a>
 neutralized by GaryBlkltning
</div>
</td>
</tr>
<tr>
<td>
<time title="2015-12-28 22:28:42
<small class=&quot;milliseconds&quot;>
.658
</small>
" data-timestamp="1451366922658">
22:28
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
GaryBlkltning
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
<div class="system_narrowcast">
Your Link
<a onclick="window.selectPortalByLatLng(33.430318, -111.882615);return false" title="North Evergreen Road, Mesa, AZ 85201, USA" href="/intel?ll=33.430318,-111.882615&amp;z=17&amp;pll=33.430318,-111.882615" class="help">
Home Plate Gate
</a>
 to
<a onclick="window.selectPortalByLatLng(33.431609, -111.876448);return false" title="Cubs Way, Mesa, AZ 85201, USA" href="/intel?ll=33.431609,-111.876448&amp;z=17&amp;pll=33.431609,-111.876448" class="help">
Riverview Fountain
</a>
 destroyed by GaryBlkltning
</div>
</td>
</tr>
<tr>
<td>
<time title="2015-12-28 22:43:46
<small class=&quot;milliseconds&quot;>
.283
</small>
" data-timestamp="1451367826283">
22:43
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
GaryBlkltning
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
<div class="system_narrowcast">
Your Portal
<a onclick="window.selectPortalByLatLng(33.430534, -111.881297);return false" title="North May, Mesa, AZ 85201, USA" href="/intel?ll=33.430534,-111.881297&amp;z=17&amp;pll=33.430534,-111.881297" class="help">
Hibernation Vacation
</a>
 is under attack by GaryBlkltning
</div>
</td>
</tr>
<tr>
<td>
<time title="2015-12-28 22:43:46
<small class=&quot;milliseconds&quot;>
.283
</small>
" data-timestamp="1451367826283">
22:43
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
GaryBlkltning
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
<div class="system_narrowcast">
Your Portal
<a onclick="window.selectPortalByLatLng(33.430277, -111.88215);return false" title="2330 West Rio Salado Parkway, Mesa, AZ 85201, USA" href="/intel?ll=33.430277,-111.88215&amp;z=17&amp;pll=33.430277,-111.88215" class="help">
Cubs Logos Through Time
</a>
 is under attack by GaryBlkltning
</div>
</td>
</tr>
<tr>
<td>
<time title="2015-12-28 22:43:46
<small class=&quot;milliseconds&quot;>
.283
</small>
" data-timestamp="1451367826283">
22:43
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
GaryBlkltning
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
<div class="system_narrowcast">
Your Portal
<a onclick="window.selectPortalByLatLng(33.429761, -111.882427);return false" title="711 North Evergreen Road, Tempe, AZ 85281, USA" href="/intel?ll=33.429761,-111.882427&amp;z=17&amp;pll=33.429761,-111.882427" class="help">
Cubs Spring Training Stadium
</a>
 is under attack by GaryBlkltning
</div>
</td>
</tr>
<tr>
<td>
<time title="2015-12-28 22:43:46
<small class=&quot;milliseconds&quot;>
.283
</small>
" data-timestamp="1451367826283">
22:43
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
GaryBlkltning
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
<div class="system_narrowcast">
Your Portal
<a onclick="window.selectPortalByLatLng(33.430318, -111.882615);return false" title="North Evergreen Road, Mesa, AZ 85201, USA" href="/intel?ll=33.430318,-111.882615&amp;z=17&amp;pll=33.430318,-111.882615" class="help">
Home Plate Gate
</a>
 is under attack by GaryBlkltning
</div>
</td>
</tr>
<tr>
<td>
<time title="2015-12-28 22:43:53
<small class=&quot;milliseconds&quot;>
.100
</small>
" data-timestamp="1451367833100">
22:43
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
GaryBlkltning
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
<div class="system_narrowcast">
Your Portal
<a onclick="window.selectPortalByLatLng(33.429761, -111.882427);return false" title="711 North Evergreen Road, Tempe, AZ 85281, USA" href="/intel?ll=33.429761,-111.882427&amp;z=17&amp;pll=33.429761,-111.882427" class="help">
Cubs Spring Training Stadium
</a>
 neutralized by GaryBlkltning
</div>
</td>
</tr>
<tr>
<td>
<time title="2015-12-28 22:44:29
<small class=&quot;milliseconds&quot;>
.892
</small>
" data-timestamp="1451367869892">
22:44
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
GaryBlkltning
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
<div class="system_narrowcast">
Your Link
<a onclick="window.selectPortalByLatLng(33.430318, -111.882615);return false" title="North Evergreen Road, Mesa, AZ 85201, USA" href="/intel?ll=33.430318,-111.882615&amp;z=17&amp;pll=33.430318,-111.882615" class="help">
Home Plate Gate
</a>
 to
<a onclick="window.selectPortalByLatLng(33.429571, -111.881438);return false" title="2601-2699 West Rio Salado Parkway, Mesa, AZ 85201, USA" href="/intel?ll=33.429571,-111.881438&amp;z=17&amp;pll=33.429571,-111.881438" class="help">
First Base Gate
</a>
 destroyed by GaryBlkltning
</div>
</td>
</tr>
<tr>
<td>
<time title="2015-12-28 22:45:18
<small class=&quot;milliseconds&quot;>
.683
</small>
" data-timestamp="1451367918683">
22:45
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
GaryBlkltning
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
<div class="system_narrowcast">
Your Portal
<a onclick="window.selectPortalByLatLng(33.430534, -111.881297);return false" title="North May, Mesa, AZ 85201, USA" href="/intel?ll=33.430534,-111.881297&amp;z=17&amp;pll=33.430534,-111.881297" class="help">
Hibernation Vacation
</a>
 neutralized by GaryBlkltning
</div>
</td>
</tr>
<tr>
<td>
<time title="2015-12-28 22:46:02
<small class=&quot;milliseconds&quot;>
.983
</small>
" data-timestamp="1451367962983">
22:46
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
GaryBlkltning
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
<div class="system_narrowcast">
Your Portal
<a onclick="window.selectPortalByLatLng(33.430277, -111.88215);return false" title="2330 West Rio Salado Parkway, Mesa, AZ 85201, USA" href="/intel?ll=33.430277,-111.88215&amp;z=17&amp;pll=33.430277,-111.88215" class="help">
Cubs Logos Through Time
</a>
 is under attack by GaryBlkltning
</div>
</td>
</tr>
<tr>
<td>
<time title="2015-12-28 22:46:02
<small class=&quot;milliseconds&quot;>
.983
</small>
" data-timestamp="1451367962983">
22:46
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
GaryBlkltning
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
<div class="system_narrowcast">
Your Portal
<a onclick="window.selectPortalByLatLng(33.430318, -111.882615);return false" title="North Evergreen Road, Mesa, AZ 85201, USA" href="/intel?ll=33.430318,-111.882615&amp;z=17&amp;pll=33.430318,-111.882615" class="help">
Home Plate Gate
</a>
 is under attack by GaryBlkltning
</div>
</td>
</tr>
<tr>
<td>
<time title="2015-12-28 22:46:02
<small class=&quot;milliseconds&quot;>
.983
</small>
" data-timestamp="1451367962983">
22:46
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
GaryBlkltning
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
<div class="system_narrowcast">
Your Portal
<a onclick="window.selectPortalByLatLng(33.430963, -111.880405);return false" title="North May, Mesa, AZ 85201, USA" href="/intel?ll=33.430963,-111.880405&amp;z=17&amp;pll=33.430963,-111.880405" class="help">
Right Field Gate
</a>
 is under attack by GaryBlkltning
</div>
</td>
</tr>
<tr>
<td>
<time title="2015-12-28 22:46:12
<small class=&quot;milliseconds&quot;>
.859
</small>
" data-timestamp="1451367972859">
22:46
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
GaryBlkltning
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
<div class="system_narrowcast">
Your Portal
<a onclick="window.selectPortalByLatLng(33.430277, -111.88215);return false" title="2330 West Rio Salado Parkway, Mesa, AZ 85201, USA" href="/intel?ll=33.430277,-111.88215&amp;z=17&amp;pll=33.430277,-111.88215" class="help">
Cubs Logos Through Time
</a>
 neutralized by GaryBlkltning
</div>
</td>
</tr>
<tr>
<td>
<time title="2015-12-28 22:46:12
<small class=&quot;milliseconds&quot;>
.859
</small>
" data-timestamp="1451367972859">
22:46
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
GaryBlkltning
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
<div class="system_narrowcast">
Your Link
<a onclick="window.selectPortalByLatLng(33.430318, -111.882615);return false" title="North Evergreen Road, Mesa, AZ 85201, USA" href="/intel?ll=33.430318,-111.882615&amp;z=17&amp;pll=33.430318,-111.882615" class="help">
Home Plate Gate
</a>
 to
<a onclick="window.selectPortalByLatLng(33.430963, -111.880405);return false" title="North May, Mesa, AZ 85201, USA" href="/intel?ll=33.430963,-111.880405&amp;z=17&amp;pll=33.430963,-111.880405" class="help">
Right Field Gate
</a>
 destroyed by GaryBlkltning
</div>
</td>
</tr>
<tr>
<td>
<time title="2015-12-28 22:46:38
<small class=&quot;milliseconds&quot;>
.868
</small>
" data-timestamp="1451367998868">
22:46
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
GaryBlkltning
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
<div class="system_narrowcast">
Your Portal
<a onclick="window.selectPortalByLatLng(33.430318, -111.882615);return false" title="North Evergreen Road, Mesa, AZ 85201, USA" href="/intel?ll=33.430318,-111.882615&amp;z=17&amp;pll=33.430318,-111.882615" class="help">
Home Plate Gate
</a>
 neutralized by GaryBlkltning
</div>
</td>
</tr>
<tr>
<td>
<time title="2015-12-28 22:48:26
<small class=&quot;milliseconds&quot;>
.413
</small>
" data-timestamp="1451368106413">
22:48
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
GaryBlkltning
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
<div class="system_narrowcast">
Your Portal
<a onclick="window.selectPortalByLatLng(33.432372, -111.880848);return false" title="North May, Mesa, AZ 85201, USA" href="/intel?ll=33.432372,-111.880848&amp;z=17&amp;pll=33.432372,-111.880848" class="help">
Center Field Gate
</a>
 is under attack by GaryBlkltning
</div>
</td>
</tr>
<tr>
<td>
<time title="2015-12-28 22:48:26
<small class=&quot;milliseconds&quot;>
.413
</small>
" data-timestamp="1451368106413">
22:48
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
GaryBlkltning
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
<div class="system_narrowcast">
Your Portal
<a onclick="window.selectPortalByLatLng(33.430963, -111.880405);return false" title="North May, Mesa, AZ 85201, USA" href="/intel?ll=33.430963,-111.880405&amp;z=17&amp;pll=33.430963,-111.880405" class="help">
Right Field Gate
</a>
 is under attack by GaryBlkltning
</div>
</td>
</tr>
<tr>
<td>
<time title="2015-12-28 22:48:56
<small class=&quot;milliseconds&quot;>
.461
</small>
" data-timestamp="1451368136461">
22:48
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
GaryBlkltning
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
<div class="system_narrowcast">
Your Portal
<a onclick="window.selectPortalByLatLng(33.432372, -111.880848);return false" title="North May, Mesa, AZ 85201, USA" href="/intel?ll=33.432372,-111.880848&amp;z=17&amp;pll=33.432372,-111.880848" class="help">
Center Field Gate
</a>
 neutralized by GaryBlkltning
</div>
</td>
</tr>
<tr>
<td>
<time title="2015-12-28 22:53:47
<small class=&quot;milliseconds&quot;>
.278
</small>
" data-timestamp="1451368427278">
22:53
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
GaryBlkltning
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
<div class="system_narrowcast">
Your Portal
<a onclick="window.selectPortalByLatLng(33.43018, -111.888838);return false" title="2630 West 8th Street, Mesa, AZ 85201, USA" href="/intel?ll=33.43018,-111.888838&amp;z=17&amp;pll=33.43018,-111.888838" class="help">
Walkway to Happiness
</a>
 is under attack by GaryBlkltning
</div>
</td>
</tr>
<tr>
<td>
<time title="2015-12-28 23:04:03
<small class=&quot;milliseconds&quot;>
.470
</small>
" data-timestamp="1451369043470">
23:04
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
GaryBlkltning
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
<div class="system_narrowcast">
Your Portal
<a onclick="window.selectPortalByLatLng(33.425348, -111.89982);return false" title="2003 East 5th Street, Tempe, AZ 85281, USA" href="/intel?ll=33.425348,-111.89982&amp;z=17&amp;pll=33.425348,-111.89982" class="help">
Freaking TAG
</a>
 is under attack by GaryBlkltning
</div>
</td>
</tr>
<tr>
<td>
<time title="2015-12-28 23:09:23
<small class=&quot;milliseconds&quot;>
.149
</small>
" data-timestamp="1451369363149">
23:09
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
GaryBlkltning
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
<div class="system_narrowcast">
Your Portal
<a onclick="window.selectPortalByLatLng(33.429518, -111.893025);return false" title="2166-2174 East Rio Salado Parkway, Tempe, AZ 85281, USA" href="/intel?ll=33.429518,-111.893025&amp;z=17&amp;pll=33.429518,-111.893025" class="help">
Iron Man
</a>
 neutralized by GaryBlkltning
</div>
</td>
</tr>
<tr>
<td>
<time title="2015-12-28 23:09:56
<small class=&quot;milliseconds&quot;>
.407
</small>
" data-timestamp="1451369396407">
23:09
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
GaryBlkltning
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
<div class="system_narrowcast">
Your Portal
<a onclick="window.selectPortalByLatLng(33.43018, -111.888838);return false" title="2630 West 8th Street, Mesa, AZ 85201, USA" href="/intel?ll=33.43018,-111.888838&amp;z=17&amp;pll=33.43018,-111.888838" class="help">
Walkway to Happiness
</a>
 is under attack by GaryBlkltning
</div>
</td>
</tr>
<tr>
<td colspan="3" style="padding-top:3px">
<summary>
─ 12/29/2015 ──────────────────────────────────────────────────────────────────────────
</summary>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 07:28:55
<small class=&quot;milliseconds&quot;>
.060
</small>
" data-timestamp="1451399335060">
07:28
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
lavaleg
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
<div class="system_narrowcast">
Your Portal
<a onclick="window.selectPortalByLatLng(33.471083, -111.848209);return false" title="1920-2298 North Extension Road, Scottsdale, AZ 85256, USA" href="/intel?ll=33.471083,-111.848209&amp;z=17&amp;pll=33.471083,-111.848209" class="help">
Salt River LDS
</a>
 is under attack by lavaleg
</div>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 09:57:23
<small class=&quot;milliseconds&quot;>
.814
</small>
" data-timestamp="1451408243814">
09:57
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
WaterVirus
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
<div class="system_narrowcast">
Your Portal
<a onclick="window.selectPortalByLatLng(33.43018, -111.888838);return false" title="2630 West 8th Street, Mesa, AZ 85201, USA" href="/intel?ll=33.43018,-111.888838&amp;z=17&amp;pll=33.43018,-111.888838" class="help">
Walkway to Happiness
</a>
 is under attack by WaterVirus
</div>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 09:58:42
<small class=&quot;milliseconds&quot;>
.171
</small>
" data-timestamp="1451408322171">
09:58
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
AZShiner
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
<div class="system_narrowcast">
Your Portal
<a onclick="window.selectPortalByLatLng(33.286462, -111.887526);return false" title="1255 South Spectrum Boulevard, Chandler, AZ 85286, USA" href="/intel?ll=33.286462,-111.887526&amp;z=17&amp;pll=33.286462,-111.887526" class="help">
Balloon Dog
</a>
 is under attack by AZShiner
</div>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 14:07:07
<small class=&quot;milliseconds&quot;>
.185
</small>
" data-timestamp="1451423227185">
14:07
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
Dv8klown
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
<div class="system_narrowcast">
Your Portal
<a onclick="window.selectPortalByLatLng(33.432162, -111.870404);return false" title="829 North Dobson Road, A, Mesa, AZ 85201, USA" href="/intel?ll=33.432162,-111.870404&amp;z=17&amp;pll=33.432162,-111.870404" class="help">
Shepler's Rearing Horse
</a>
 is under attack by Dv8klown
</div>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 14:26:41
<small class=&quot;milliseconds&quot;>
.496
</small>
" data-timestamp="1451424401496">
14:26
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
Dv8klown
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
<div class="system_narrowcast">
Your Portal
<a onclick="window.selectPortalByLatLng(33.432162, -111.870404);return false" title="829 North Dobson Road, A, Mesa, AZ 85201, USA" href="/intel?ll=33.432162,-111.870404&amp;z=17&amp;pll=33.432162,-111.870404" class="help">
Shepler's Rearing Horse
</a>
 neutralized by Dv8klown
</div>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 14:40:26
<small class=&quot;milliseconds&quot;>
.974
</small>
" data-timestamp="1451425226974">
14:40
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
Dv8klown
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
<div class="system_narrowcast">
Your Portal
<a onclick="window.selectPortalByLatLng(33.43018, -111.888838);return false" title="2630 West 8th Street, Mesa, AZ 85201, USA" href="/intel?ll=33.43018,-111.888838&amp;z=17&amp;pll=33.43018,-111.888838" class="help">
Walkway to Happiness
</a>
 is under attack by Dv8klown
</div>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 15:39:26
<small class=&quot;milliseconds&quot;>
.160
</small>
" data-timestamp="1451428766160">
15:39
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
noriokonpi
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
<div class="system_narrowcast">
Your Portal
<a onclick="window.selectPortalByLatLng(33.402085, -111.839818);return false" title="707 South Country Club Drive, Mesa, AZ 85210, USA" href="/intel?ll=33.402085,-111.839818&amp;z=17&amp;pll=33.402085,-111.839818" class="help">
Ray of Light
</a>
 is under attack by noriokonpi
</div>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 15:51:32
<small class=&quot;milliseconds&quot;>
.395
</small>
" data-timestamp="1451429492395">
15:51
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
LCI115
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
<div class="system_narrowcast">
Your Portal
<a onclick="window.selectPortalByLatLng(33.430625, -111.852458);return false" title="850-898 North Westwood, Mesa, AZ 85201, USA" href="/intel?ll=33.430625,-111.852458&amp;z=17&amp;pll=33.430625,-111.852458" class="help">
The Church of Jesus Christ of Latter Day Saints
</a>
 is under attack by LCI115
</div>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 15:51:58
<small class=&quot;milliseconds&quot;>
.429
</small>
" data-timestamp="1451429518429">
15:51
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
LCI115
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
<div class="system_narrowcast">
Your Portal
<a onclick="window.selectPortalByLatLng(33.430625, -111.852458);return false" title="850-898 North Westwood, Mesa, AZ 85201, USA" href="/intel?ll=33.430625,-111.852458&amp;z=17&amp;pll=33.430625,-111.852458" class="help">
The Church of Jesus Christ of Latter Day Saints
</a>
 neutralized by LCI115
</div>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 16:53:40
<small class=&quot;milliseconds&quot;>
.247
</small>
" data-timestamp="1451433220247">
16:53
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
Trizumi
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
<div class="system_narrowcast">
Your Portal
<a onclick="window.selectPortalByLatLng(33.298841, -111.876533);return false" title="284 South Dobson Road, Chandler, AZ" href="/intel?ll=33.298841,-111.876533&amp;z=17&amp;pll=33.298841,-111.876533" class="help">
"WIN" Statue
</a>
 is under attack by Trizumi
</div>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 17:43:54
<small class=&quot;milliseconds&quot;>
.168
</small>
" data-timestamp="1451436234168">
17:43
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
dsh58
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
<div class="system_narrowcast">
Your Portal
<a onclick="window.selectPortalByLatLng(33.311168, -111.875367);return false" title="1900 West Carla Vista Drive, Chandler, AZ 85224, United States" href="/intel?ll=33.311168,-111.875367&amp;z=17&amp;pll=33.311168,-111.875367" class="help">
USPS: 1900 West Carla Vista Drive
</a>
 is under attack by dsh58
</div>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 17:44:39
<small class=&quot;milliseconds&quot;>
.265
</small>
" data-timestamp="1451436279265">
17:44
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
dsh58
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
<div class="system_narrowcast">
Your Portal
<a onclick="window.selectPortalByLatLng(33.311168, -111.875367);return false" title="1900 West Carla Vista Drive, Chandler, AZ 85224, United States" href="/intel?ll=33.311168,-111.875367&amp;z=17&amp;pll=33.311168,-111.875367" class="help">
USPS: 1900 West Carla Vista Drive
</a>
 neutralized by dsh58
</div>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 17:51:55
<small class=&quot;milliseconds&quot;>
.783
</small>
" data-timestamp="1451436715783">
17:51
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
65caddydaddy
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
<div class="system_narrowcast">
Your Portal
<a onclick="window.selectPortalByLatLng(33.392775, -111.874296);return false" title="1863-1999 West Southern Avenue, Mesa, AZ 85202, USA" href="/intel?ll=33.392775,-111.874296&amp;z=17&amp;pll=33.392775,-111.874296" class="help">
Mesa Community College Thunderbird
</a>
 is under attack by 65caddydaddy
</div>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 17:52:11
<small class=&quot;milliseconds&quot;>
.575
</small>
" data-timestamp="1451436731575">
17:52
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
65caddydaddy
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
<div class="system_narrowcast">
Your Portal
<a onclick="window.selectPortalByLatLng(33.392775, -111.874296);return false" title="1863-1999 West Southern Avenue, Mesa, AZ 85202, USA" href="/intel?ll=33.392775,-111.874296&amp;z=17&amp;pll=33.392775,-111.874296" class="help">
Mesa Community College Thunderbird
</a>
 neutralized by 65caddydaddy
</div>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 18:21:22
<small class=&quot;milliseconds&quot;>
.598
</small>
" data-timestamp="1451438482598">
18:21
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
Trizumi
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
<div class="system_narrowcast">
Your Portal
<a onclick="window.selectPortalByLatLng(33.283672, -111.875943);return false" title="1225-1499 South Dobson Road, Chandler, AZ 85286, USA" href="/intel?ll=33.283672,-111.875943&amp;z=17&amp;pll=33.283672,-111.875943" class="help">
Pecos Ranch Water Falls
</a>
 is under attack by Trizumi
</div>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 18:21:22
<small class=&quot;milliseconds&quot;>
.598
</small>
" data-timestamp="1451438482598">
18:21
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
Trizumi
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
<div class="system_narrowcast">
Your Portal
<a onclick="window.selectPortalByLatLng(33.283344, -111.875968);return false" title="1947-1999 West Willis Road, Chandler, AZ 85286, USA" href="/intel?ll=33.283344,-111.875968&amp;z=17&amp;pll=33.283344,-111.875968" class="help">
Pecos Ranch
</a>
 is under attack by Trizumi
</div>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 18:21:35
<small class=&quot;milliseconds&quot;>
.279
</small>
" data-timestamp="1451438495279">
18:21
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
Trizumi
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
<div class="system_narrowcast">
Your Portal
<a onclick="window.selectPortalByLatLng(33.283344, -111.875968);return false" title="1947-1999 West Willis Road, Chandler, AZ 85286, USA" href="/intel?ll=33.283344,-111.875968&amp;z=17&amp;pll=33.283344,-111.875968" class="help">
Pecos Ranch
</a>
 neutralized by Trizumi
</div>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 18:21:35
<small class=&quot;milliseconds&quot;>
.279
</small>
" data-timestamp="1451438495279">
18:21
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
Trizumi
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
<div class="system_narrowcast">
Your Portal
<a onclick="window.selectPortalByLatLng(33.283672, -111.875943);return false" title="1225-1499 South Dobson Road, Chandler, AZ 85286, USA" href="/intel?ll=33.283672,-111.875943&amp;z=17&amp;pll=33.283672,-111.875943" class="help">
Pecos Ranch Water Falls
</a>
 neutralized by Trizumi
</div>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 18:24:30
<small class=&quot;milliseconds&quot;>
.139
</small>
" data-timestamp="1451438670139">
18:24
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
Trizumi
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
<div class="system_narrowcast">
Your Portal
<a onclick="window.selectPortalByLatLng(33.290546, -111.877669);return false" title="2085-2121 West Pecos Road, Chandler, AZ" href="/intel?ll=33.290546,-111.877669&amp;z=17&amp;pll=33.290546,-111.877669" class="help">
Chandler Office Bow
</a>
 is under attack by Trizumi
</div>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 18:27:30
<small class=&quot;milliseconds&quot;>
.737
</small>
" data-timestamp="1451438850737">
18:27
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
Trizumi
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
<div class="system_narrowcast">
Your Portal
<a onclick="window.selectPortalByLatLng(33.288517, -111.876514);return false" title="17402 South Dobson Road, Chandler, AZ 85286, USA" href="/intel?ll=33.288517,-111.876514&amp;z=17&amp;pll=33.288517,-111.876514" class="help">
Tempe Korean Presbyterian Church
</a>
 is under attack by Trizumi
</div>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 18:27:48
<small class=&quot;milliseconds&quot;>
.717
</small>
" data-timestamp="1451438868717">
18:27
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
Trizumi
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
<div class="system_narrowcast">
Your Portal
<a onclick="window.selectPortalByLatLng(33.288517, -111.876514);return false" title="17402 South Dobson Road, Chandler, AZ 85286, USA" href="/intel?ll=33.288517,-111.876514&amp;z=17&amp;pll=33.288517,-111.876514" class="help">
Tempe Korean Presbyterian Church
</a>
 neutralized by Trizumi
</div>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 18:29:32
<small class=&quot;milliseconds&quot;>
.193
</small>
" data-timestamp="1451438972193">
18:29
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
Trizumi
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
<div class="system_narrowcast">
Your Portal
<a onclick="window.selectPortalByLatLng(33.289902, -111.876718);return false" title="1120 South Dobson Road, Chandler, AZ 85224, USA" href="/intel?ll=33.289902,-111.876718&amp;z=17&amp;pll=33.289902,-111.876718" class="help">
Medical Fountain
</a>
 neutralized by Trizumi
</div>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 18:43:46
<small class=&quot;milliseconds&quot;>
.075
</small>
" data-timestamp="1451439826075">
18:43
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
Trizumi
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
<div class="system_narrowcast">
Your Portal
<a onclick="window.selectPortalByLatLng(33.286462, -111.887526);return false" title="1255 South Spectrum Boulevard, Chandler, AZ 85286, USA" href="/intel?ll=33.286462,-111.887526&amp;z=17&amp;pll=33.286462,-111.887526" class="help">
Balloon Dog
</a>
 is under attack by Trizumi
</div>
</td>
</tr>
<tr>
<td>
<time title="2015-12-29 18:44:15
<small class=&quot;milliseconds&quot;>
.053
</small>
" data-timestamp="1451439855053">
18:44
</time>
</td>
<td>
<span class="invisep">
&lt;
</span>
<mark class="nickname" style="cursor:pointer; color:#03DC03">
Trizumi
</mark>
<span class="invisep">
&gt;
</span>
</td>
<td>
<div class="system_narrowcast">
Your Portal
<a onclick="window.selectPortalByLatLng(33.286462, -111.887526);return false" title="1255 South Spectrum Boulevard, Chandler, AZ 85286, USA" href="/intel?ll=33.286462,-111.887526&amp;z=17&amp;pll=33.286462,-111.887526" class="help">
Balloon Dog
</a>
 neutralized by Trizumi
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<form id="chatinput" style="">
<table>
<tbody>
<tr>

<td>
<time>
20:07
</time>
</td>

<td>
<mark class="res" style="color: rgb(187, 187, 187) !important;">
tell Jarvis:
</mark>
</td>

<td>
<input id="chattext" type="text" maxlength="256" accesskey="c" title="[c]" style="color: rgb(187, 187, 187) !important;">
</td>
</tr>
</tbody>
</table>
</form>
<a id="sidebartoggle" accesskey="i" title="Toggle sidebar [i]" style="right: 301px;">
<span class="toggle close">
</span>
</a>
<div id="scrollwrapper" style="display: block; z-index: 1001;">

<div id="sidebar" style="">

<div id="playerstat">
<h2 title="Level:   8
XM: 10000 / 10000
AP: 2 167 791
level up in:    232 209 AP
Invites:    193
Note: your player stats can only be updated by a full reload (F5)">
8&nbsp;
<div id="name">
<span class="res">
ti11a
</span>
<a href="/_ah/logout?continue=https://www.google.com/accounts/Logout%3Fcontinue%3Dhttps://appengine.google.com/_ah/logout%253Fcontinue%253Dhttps://www.ingress.com/intel%26service%3Dah" id="signout">
sign out
</a>
</div>
<div id="stats">
<sup>
XM: 100%
</sup>
<sub>
level: 81%
</sub>
</div>
</h2>
</div>

<div id="gamestat" title="Resistance:   665&amp;#8201;004&amp;#8201;382 MindUnits
Enlightened:    441&amp;#8201;019&amp;#8201;746 MindUnits">
<span class="res" style="width:60.12566680642975%;">
60%&nbsp;
</span>
<span class="enl" style="width:39.87433319357026%;">
&nbsp;40%
</span>
</div>

<div id="searchwrapper">

<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYxIDY0LjE0MDk0OSwgMjAxMC8xMi8wNy0xMDo1NzowMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNS4xIE1hY2ludG9zaCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDoxNjM1OTRFNUE0RTIxMUUxODNBMUZBQ0ZFQkJDNkRBQiIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDoxNjM1OTRFNkE0RTIxMUUxODNBMUZBQ0ZFQkJDNkRBQiI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjE2MzU5NEUzQTRFMjExRTE4M0ExRkFDRkVCQkM2REFCIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjE2MzU5NEU0QTRFMjExRTE4M0ExRkFDRkVCQkM2REFCIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+kxvtEgAAAWVJREFUeNqsVctRwzAUlDTccQlxB3RA0kHSQXLxNXEFgQrsHO1L6AA6cKgAd4BLEBXAU2YfszY2oMCb2Rlbelqv3s+2qiozYjPBVjAX3Az2WsFJcBB0WZb1Nt0IWSF4FexGyAzWdvAp6rpOpgjDxgucg3lBKViRzz3WPN6Db8OkjsgaUvQgSAW54IkI77CWwkcVN0PCPZFtAG+mzZPfmVRUhlAZK0mZIR6qbGPi7ChY4zl1yKZ+NTfxltNttg6loep8LJuUjad4zh3F7s1cbs8ayxDD9xEH+0uiL2ed+WdjwhWU2YjzVmJoUfCfhC2eb/8g7Fr73KHRDWopiWVC22kdnhymhrZfcYG6goQcAmGHhleV64lsjlUD+5cSz85RtbfUSscfrp+Qn87Ic2KuyGlBEyd8dYkO4IJfInkc70C2QMf0CD1I95hzCc1GtcfBe7hm/l1he5p3JYVh+AsoaV727EOAAQAWgF3ledLuQAAAAABJRU5ErkJggg==" title="Current Location" id="buttongeolocation">

<input id="search" placeholder="Search location…" type="search" accesskey="f" title="Search for a place [f]">

</div>

<div id="portaldetails" class="enl">
<a class="bkmrksStar favorite" accesskey="b" onclick="window.plugin.bookmarks.switchStarPortal();return false;" title="Save this portal in your bookmarks [b]">
<span>
</span>
</a>
<h3 class="title">
LDS Temple
</h3>
<span class="close" title="Close [w]" onclick="renderPortalDetails(null); if(isSmartphone()) show(&quot;map&quot;);" accesskey="w">
X
</span>
<div class="imgpreview" title="LDS Temple
Click to show full image." style="background-image: url('https://ssl.panoramio.com/photos/medium/23958329.jpg')" id="ui-id-706">
<span id="level" title="Level 2.25
6 resonator level(s) needed for next portal level">
2
</span>
<img class="hide" src="https://ssl.panoramio.com/photos/medium/23958329.jpg">
</div>
<div id="uniques-container">
<label>
<input type="checkbox" id="visited" onclick="window.plugin.uniques.updateVisited($(this).prop('checked'))">
 Visited
</label>
<label>
<input type="checkbox" id="captured" onclick="window.plugin.uniques.updateCaptured($(this).prop('checked'))">
 Captured
</label>
</div>
<div id="keys-content-outer">
<div id="keys-label" title="Problem? Point to the question mark!">
Key(s):
</div>
<div id="keys-add" class="keys-button" onclick="window.plugin.keys.addKey(-1);">
<div class="keys-button-minus">
</div>
</div>
<div id="keys-count" title="Problem? Point to the question mark!">
0
</div>
<div id="keys-subtract" class="keys-button" onclick="window.plugin.keys.addKey(1);">
<div class="keys-button-plus-v">
</div>
<div class="keys-button-plus-h">
</div>
</div>
<div id="keys-help" title="You MUST manually input your count of keys!
This plugin CANNOT automatically get the keys from Ingress!">
?
</div>
</div>
<div class="mods">
<span style="color:#000">
</span>
<span style="color:#000">
</span>
<span style="color:#000">
</span>
<span style="color:#000">
</span>
</div>
<table id="randdetails">
<tbody>
<tr>
<td>
<span class="nickname">
suntailedshadow
</span>
</td>
<th>
owner
</th>

<th title="Base range: 4&amp;#8201;100m
Link amp boost: ×1
Range:  4&amp;#8201;100m
Portal is missing resonators,
no new links can be made">
range
</th>
<td title="Base range:  4&amp;#8201;100m
Link amp boost: ×1
Range:  4&amp;#8201;100m
Portal is missing resonators,
no new links can be made">
<a onclick="window.rangeLinkClick()" style="text-decoration:line-through;">
4 km
</a>
</td>
</tr>
<tr>
<td title="at most 8 outgoing links
2 links out
1 links in
(3 total)">
2 out / 1 in
</td>
<th title="at most 8 outgoing links
2 links out
1 links in
(3 total)">
links
</th>

<th>
fields
</th>
<td>
2
</td>
</tr>
<tr>
<td title="Total shielding:  37
- active:   37
- excess:   0
From
- shields:  0
- links:    37">
37
</td>
<th title="Total shielding:  37
- active:   37
- excess:   0
From
- shields:  0
- links:    37">
shielding
</th>

<th title="11360 / 12000">
energy
</th>
<td title="11360 / 12000">
11 k / 12 k
</td>
</tr>
<tr>
<td title="Enemy AP:  4036
  Destroy AP:   2286
  Capture AP:   1750
">
4 036
</td>
<th title="Enemy AP:    4036
  Destroy AP:   2286
  Capture AP:   1750
">
AP Gain
</th>

<th title="Hacks available every 4 hours
Hack count: 4
Cooldown time:  5m
Burnout time:   15m">
hacks
</th>
<td title="Hacks available every 4 hours
Hack count: 4
Cooldown time:  5m
Burnout time:   15m">
4 @ 5m
</td>
</tr>
</tbody>
</table>
<table id="resodetails">
<tbody>
<tr>
<td>
<span class="nickname">
suntailedshadow
</span>
</td>
<th>
<span class="meter" title="energy:    3810 / 4000 (95%)
level:  6
owner:  suntailedshadow
">
<span style="width:95.25%; background:#EB26CD;">
</span>
<span class="meter-level" style="color: rgb(255, 255, 255); word-spacing: -1px; text-align: left; font-size: 90%; padding-left: 2px;">
 L 6
<div style="position:absolute;right:0;top:0">
95%
</div>
</span>
</span>
</th>

<th>
<span class="meter" title="energy: 3783 / 4000 (95%)
level:  6
owner:  vivalaelefantes
">
<span style="width:94.575%; background:#EB26CD;">
</span>
<span class="meter-level" style="color: rgb(255, 255, 255); word-spacing: -1px; text-align: left; font-size: 90%; padding-left: 2px;">
 L 6
<div style="position:absolute;right:0;top:0">
95%
</div>
</span>
</span>
</th>
<td>
<span class="nickname">
vivalaelefantes
</span>
</td>
</tr>
<tr>
<td>
<span class="nickname">
vivalaelefantes
</span>
</td>
<th>
<span class="meter" title="energy:   3767 / 4000 (94%)
level:  6
owner:  vivalaelefantes
">
<span style="width:94.175%; background:#EB26CD;">
</span>
<span class="meter-level" style="color: rgb(255, 255, 255); word-spacing: -1px; text-align: left; font-size: 90%; padding-left: 2px;">
 L 6
<div style="position:absolute;right:0;top:0">
94%
</div>
</span>
</span>
</th>

<th>
<span class="meter" title="">
<span style="">
</span>
</span>
</th>
<td>
</td>
</tr>
<tr>
<td>
</td>
<th>
<span class="meter" title="">
<span style="">
</span>
</span>
</th>

<th>
<span class="meter" title="">
<span style="">
</span>
</span>
</th>
<td>
</td>
</tr>
<tr>
<td>
</td>
<th>
<span class="meter" title="">
<span style="">
</span>
</span>
</th>

<th>
<span class="meter" title="">
<span style="">
</span>
</span>
</th>
<td>
</td>
</tr>
</tbody>
</table>
<div id="portal-distance" title="Double-click to set/change current location">
Distance: 3.9km
<span class="portal-distance-bearing" style="transform: rotate(164deg);">
</span>
 164° S
</div>
<div class="linkdetails">
<aside>
<a href="/intel?ll=33.413536,-111.819615&amp;z=17&amp;pll=33.413536,-111.819615" title="Create a URL link to this portal">
Portal link
</a>
</aside>
<aside>
<a onclick="window.showPortalPosLinks(33.413536,-111.819615,'LDS Temple')" title="Link to alternative maps (Google, etc)">
Map links
</a>
</aside>
<aside>
<a onclick="window.plugin.rawdata.showPortalData('04c1649d05094b07a257887e77e0c75b.12')" title="Display raw data of the portal">
Raw Data
</a>
</aside>
<aside>
<a tabindex="0" onclick="plugin.missions.openPortalMissions();">
Missions
</a>
</aside>
</div>
<div id="showLinkedPortalContainer">
<div class="showLinkedPortalLink showLinkedPortalLink1 outgoing" data-guid="dab1ec1df02e47c0a35cc667cb52f820.16" data-lat="33.414022" data-lng="-111.819811" title="
<strong>
Mesa Temple Visitors Center
</strong>
<br>
<span>
↴ outgoing link
</span>
<br>
<span>
57m
</span>
">
<img src="//lh4.ggpht.com/ohjiJLSVJbczVXNp8Kzp0dtmE0dszYj-8ECiJYyy1JYnI7kz0YMvu-wWb28UKJBn94bny-zKYFfhTuV4dIdcIQ" class="minImg" alt="Mesa Temple Visitors Center">
</div>
<div class="showLinkedPortalLink showLinkedPortalLink2 outgoing" data-guid="b37cd5a22bf9400a9f61e9987d54350f.16" data-lat="33.413419" data-lng="-111.819297" title="
<strong>
Rock Art
</strong>
<br>
<span>
↴ outgoing link
</span>
<br>
<span>
32m
</span>
">
<img src="//lh4.ggpht.com/kq6v20vUQunmaa0lubFx9OUXkSczAHJz8acbtGmswa5XsLLs6wRkhlsamq-Zelw6UOMOokAeVoEBBmQbCkI" class="minImg" alt="Rock Art">
</div>
<div class="showLinkedPortalLink showLinkedPortalLink3 incoming" data-guid="d7db95c0c92044ac8189bbd3108d2964.16" data-lat="33.413219" data-lng="-111.819695" title="
<strong>
Large Fountain
</strong>
<br>
<span>
↳ incoming link
</span>
<br>
<span>
36m
</span>
">
<img src="//lh6.ggpht.com/k2mzu01OySdl9j_a0FtJuOM-1HWbUuuBPP_nTiyFf0lk0xUQwiKBMMKmetV1pRg26F5K7X7Y-ydemkWRqL8g" class="minImg" alt="Large Fountain">
</div>
</div>
</div>

<input id="redeem" placeholder="Redeem code…" type="text">

<div id="toolbox">

<a onmouseover="setPermaLink(this)" onclick="setPermaLink(this);return androidPermalink()" title="URL link to this map view" href="/intel?ll=33.423096,-111.808548&amp;z=14">
Permalink
</a>

<a onclick="window.aboutIITC()" style="cursor: help">
About IITC
</a>

<a onclick="window.regionScoreboard()" title="View regional scoreboard">
Region scores
</a>

<a onclick="window.artifact.showArtifactList()" title="Show artifact portal list">
Artifacts
</a>
<a onclick="window.plugin.portalslist.displayPL()" title="Display a list of portals in the current view [t]" accesskey="t">
Portals list
</a>
<a tabindex="0" onclick="plugin.missions.openTopMissions();">
Missions in view
</a>
<a id="sync-show-dialog" onclick="window.plugin.sync.showDialog();" class="">
Sync
</a>

<a onclick="window.plugin.drawTools.manualOpt();return false;" accesskey="x" title="[x]">
DrawTools Opt
</a>

<a onclick="window.plugin.portalcounts.getPortals()" title="Display a summary of portals in the current view">
Portal counts
</a>
<a onclick="window.plugin.bookmarks.manualOpt();return false;">
Bookmarks Opt
</a>
<a onclick="window.plugin.bookmarks.dialogDrawer();return false;" accesskey="q" title="Draw lines/triangles between bookmarked portals [q]">
Auto draw
</a>

<a onclick="window.plugin.farmFind.checkPortals()" id="findFarmClick" title="Check portals in view for L7 farms">
L7 Farms
</a>

<a onclick="window.plugin.guessPlayerLevels.guess()" title="Show player level guesses based on resonator placement in displayed portals">
Guess player levels
</a>
</div>

</div>
</div>
<div id="updatestatus">
<div id="innerstatus">
<span class="help portallevel" title="Indicates portal levels/link lengths displayed.  Zoom in to display more.">
<b>
portals
</b>
:
<span id="loadlevel">
all
</span>
</span>

<span class="map">
<b>
map
</b>
:
<span class="help" title="Tiles: 2 cached, 0 loaded, in 0.275 seconds">
done
</span>
</span>
</div>
</div>
<div id="play_button">
</div>
<script>
(function wrapper(info) {
// a cut-down version of GM_info is passed as a parameter to the script
// (not the full GM_info - it contains the ENTIRE script source!)
window.script_info = info;
// LEAFLET PREFER CANVAS ///////////////////////////////////////////////
// Set to true if Leaflet should draw things using Canvas instead of SVG
// Disabled for now because it has several bugs: flickering, constant
// CPU usage and it continuously fires the moveend event.
//L_PREFER_CANVAS = false;
// CONFIG OPTIONS ////////////////////////////////////////////////////
window.REFRESH = 30; // refresh view every 30s (base time)
window.ZOOM_LEVEL_ADJ = 5; // add 5 seconds per zoom level
window.ON_MOVE_REFRESH = 2.5;  //refresh time to use after a movement event
window.MINIMUM_OVERRIDE_REFRESH = 10; //limit on refresh time since previous refresh, limiting repeated move refresh rate
window.REFRESH_GAME_SCORE = 15*60; // refresh game score every 15 minutes
window.MAX_IDLE_TIME = 15*60; // stop updating map after 15min idling
window.HIDDEN_SCROLLBAR_ASSUMED_WIDTH = 20;
window.SIDEBAR_WIDTH = 300;
// how many pixels to the top before requesting new data
window.CHAT_REQUEST_SCROLL_TOP = 200;
window.CHAT_SHRINKED = 60;
// Minimum area to zoom ratio that field MU's will display
window.FIELD_MU_DISPLAY_AREA_ZOOM_RATIO = 0.001;
// Point tolerance for displaying MU's
window.FIELD_MU_DISPLAY_POINT_TOLERANCE = 60
window.COLOR_SELECTED_PORTAL = '#f0f';
window.COLORS = ['#FF6600', '#0088FF', '#03DC03']; // none, res, enl
window.COLORS_LVL = ['#000', '#FECE5A', '#FFA630', '#FF7315', '#E40000', '#FD2992', '#EB26CD', '#C124E0', '#9627F4'];
window.COLORS_MOD = {VERY_RARE: '#b08cff', RARE: '#73a8ff', COMMON: '#8cffbf'};
window.MOD_TYPE = {RES_SHIELD:'Shield', MULTIHACK:'Multi-hack', FORCE_AMP:'Force Amp', HEATSINK:'Heat Sink', TURRET:'Turret', LINK_AMPLIFIER: 'Link Amp'};
// circles around a selected portal that show from where you can hack
// it and how far the portal reaches (i.e. how far links may be made
// from this portal)
window.ACCESS_INDICATOR_COLOR = 'orange';
window.RANGE_INDICATOR_COLOR = 'red'
// min zoom for intel map - should match that used by stock intel
window.MIN_ZOOM = 3;
window.DEFAULT_PORTAL_IMG = '//commondatastorage.googleapis.com/ingress.com/img/default-portal-image.png';
//window.NOMINATIM = '//open.mapquestapi.com/nominatim/v1/search.php?format=json&polygon_geojson=1&q=';
window.NOMINATIM = '//nominatim.openstreetmap.org/search?format=json&polygon_geojson=1&q=';
// INGRESS CONSTANTS /////////////////////////////////////////////////
// http://decodeingress.me/2012/11/18/ingress-portal-levels-and-link-range/
window.RESO_NRG = [0, 1000, 1500, 2000, 2500, 3000, 4000, 5000, 6000];
window.HACK_RANGE = 40; // in meters, max. distance from portal to be able to access it
window.OCTANTS = ['E', 'NE', 'N', 'NW', 'W', 'SW', 'S', 'SE'];
window.OCTANTS_ARROW = ['→', '↗', '↑', '↖', '←', '↙', '↓', '↘'];
window.DESTROY_RESONATOR = 75; //AP for destroying portal
window.DESTROY_LINK = 187; //AP for destroying link
window.DESTROY_FIELD = 750; //AP for destroying field
window.CAPTURE_PORTAL = 500; //AP for capturing a portal
window.DEPLOY_RESONATOR = 125; //AP for deploying a resonator
window.COMPLETION_BONUS = 250; //AP for deploying all resonators on portal
window.UPGRADE_ANOTHERS_RESONATOR = 65; //AP for upgrading another's resonator
window.MAX_PORTAL_LEVEL = 8;
window.MAX_RESO_PER_PLAYER = [0, 8, 4, 4, 4, 2, 2, 1, 1];
// OTHER MORE-OR-LESS CONSTANTS //////////////////////////////////////
window.TEAM_NONE = 0;
window.TEAM_RES = 1;
window.TEAM_ENL = 2;
window.TEAM_TO_CSS = ['none', 'res', 'enl'];
window.SLOT_TO_LAT = [0, Math.sqrt(2)/2, 1, Math.sqrt(2)/2, 0, -Math.sqrt(2)/2, -1, -Math.sqrt(2)/2];
window.SLOT_TO_LNG = [1, Math.sqrt(2)/2, 0, -Math.sqrt(2)/2, -1, -Math.sqrt(2)/2, 0, Math.sqrt(2)/2];
window.EARTH_RADIUS=6378137;
window.DEG2RAD = Math.PI / 180;
// STORAGE ///////////////////////////////////////////////////////////
// global variables used for storage. Most likely READ ONLY. Proper
// way would be to encapsulate them in an anonymous function and write
// getters/setters, but if you are careful enough, this works.
window.refreshTimeout = undefined;
window.urlPortal = null;
window.urlPortalLL = null;
window.selectedPortal = null;
window.portalRangeIndicator = null;
window.portalAccessIndicator = null;
window.mapRunsUserAction = false;
//var portalsLayers, linksLayer, fieldsLayer;
var portalsFactionLayers, linksFactionLayers, fieldsFactionLayers;
// contain references to all entities loaded from the server. If render limits are hit,
// not all may be added to the leaflet layers
window.portals = {};
window.links = {};
window.fields = {};
window.resonators = {};
// contain current status(on/off) of overlay layerGroups.
// But you should use isLayerGroupDisplayed(name) to check the status
window.overlayStatus = {};
// plugin framework. Plugins may load earlier than iitc, so don’t
// overwrite data
if(typeof window.plugin !== 'function') window.plugin = function() {};
// ARTIFACT ///////////////////////////////////////////////////////
// added as part of the ingress #13magnus in november 2013, artifacts
// are additional game elements overlayed on the intel map
// currently there are only jarvis-related entities
// - shards: move between portals (along links) each hour. more than one can be at a portal
// - targets: specific portals - one per team
// the artifact data includes details for the specific portals, so can be useful
// 2014-02-06: intel site updates hint at new 'amar artifacts', likely following the same system as above
window.artifact = function() {}
window.artifact.setup = function() {
  artifact.REFRESH_JITTER = 2*60;  // 2 minute random period so not all users refresh at once
  artifact.REFRESH_SUCCESS = 60*60;  // 60 minutes on success
  artifact.REFRESH_FAILURE = 2*60;  // 2 minute retry on failure
  artifact.idle = false;
  artifact.clearData();
  addResumeFunction(artifact.idleResume);
  // move the initial data request onto a very short timer. prevents thrown exceptions causing IITC boot failures
  setTimeout (artifact.requestData, 1);
  artifact._layer = new L.LayerGroup();
  addLayerGroup ('Artifacts', artifact._layer, true);
  $('#toolbox').append('
<a onclick="window.artifact.showArtifactList()" title="Show artifact portal list">
Artifacts
</a>
');
}
window.artifact.requestData = function() {
  if (isIdle()) {
    artifact.idle = true;
  } else {
    window.postAjax('getArtifactPortals', {}, artifact.handleSuccess, artifact.handleError);
  }
}
window.artifact.idleResume = function() {
  if (artifact.idle) {
    artifact.idle = false;
    artifact.requestData();
  }
}
window.artifact.handleSuccess = function(data) {
  artifact.processData (data);
  // start the next refresh at a multiple of REFRESH_SUCCESS seconds, plus a random REFRESH_JITTER amount to prevent excessive server hits at one time
  var now = Date.now();
  var nextTime = Math.ceil(now/(artifact.REFRESH_SUCCESS*1000))*(artifact.REFRESH_SUCCESS*1000) + Math.floor(Math.random()*artifact.REFRESH_JITTER*1000);
  setTimeout (artifact.requestData, nextTime - now);
}
window.artifact.handleFailure = function(data) {
  // no useful data on failure - do nothing
  setTimeout (artifact.requestData, artifact.REFRESH_FAILURE*1000);
}
window.artifact.processData = function(data) {
  if (data.error || !data.result) {
    console.warn('Failed to find result in getArtifactPortals response');
    return;
  }
  artifact.clearData();
  artifact.processResult(data.result);
  // redraw the artifact layer
  artifact.updateLayer();
}
window.artifact.clearData = function() {
  artifact.portalInfo = {};
  artifact.artifactTypes = {};
  artifact.entities = [];
}
window.artifact.processResult = function (portals) {
  // portals is an object, keyed from the portal GUID, containing the portal entity array
  for (var guid in portals) {
    var ent = portals[guid];
    var data = decodeArray.portalSummary(ent);
    // we no longer know the faction for the target portals, and we don't know which fragment numbers are at the portals
    // all we know, from the portal summary data, for each type of artifact, is that each artifact portal is
    // - a target portal or not - no idea for which faction
    // - has one (or more) fragments, or not
    if (!artifact.portalInfo[guid]) artifact.portalInfo[guid] = {};
    // store the decoded data - needed for lat/lng for layer markers
    artifact.portalInfo[guid]._data = data;
    for(var type in data.artifactBrief.target) {
      if (!artifact.artifactTypes[type]) artifact.artifactTypes[type] = {};
      if (!artifact.portalInfo[guid][type]) artifact.portalInfo[guid][type] = {};
      artifact.portalInfo[guid][type].target = TEAM_NONE;  // as we no longer know the team...
    }
    for(var type in data.artifactBrief.fragment) {
      if (!artifact.artifactTypes[type]) artifact.artifactTypes[type] = {};
      if (!artifact.portalInfo[guid][type]) artifact.portalInfo[guid][type] = {};
      artifact.portalInfo[guid][type].fragments = true; //as we no longer have a list of the fragments there
    }
    // let's pre-generate the entities needed to render the map - array of [guid, timestamp, ent_array]
    artifact.entities.push ( [guid, data.timestamp, ent] );
  }
}
window.artifact.getArtifactTypes = function() {
  return Object.keys(artifact.artifactTypes);
}
window.artifact.isArtifact = function(type) {
  return type in artifact.artifactTypes;
}
// used to render portals that would otherwise be below the visible level
window.artifact.getArtifactEntities = function() {
  return artifact.entities;
}
window.artifact.getInterestingPortals = function() {
  return Object.keys(artifact.portalInfo);
}
// quick test for portal being relevant to artifacts - of any type
window.artifact.isInterestingPortal = function(guid) {
  return guid in artifact.portalInfo;
}
// get the artifact data for a specified artifact id (e.g. 'jarvis'), if it exists - otherwise returns something 'false'y
window.artifact.getPortalData = function(guid,artifactId) {
  return artifact.portalInfo[guid] && artifact.portalInfo[guid][artifactId];
}
window.artifact.updateLayer = function() {
  artifact._layer.clearLayers();
  $.each(artifact.portalInfo, function(guid,data) {
    var latlng = L.latLng ([data._data.latE6/1E6, data._data.lngE6/1E6]);
    $.each(data, function(type,detail) {
      // we'll construct the URL form the type - stock seems to do that now
      var iconUrl;
      if (data[type].target !== undefined) {
        // target portal
        var iconUrl = '//commondatastorage.googleapis.com/ingress.com/img/map_icons/marker_images/'+type+'_shard_target.png'
        var iconSize = 100/2;
        var opacity = 1.0;
        var icon = L.icon({
          iconUrl: iconUrl,
          iconSize: [iconSize,iconSize],
          iconAnchor: [iconSize/2,iconSize/2],
          className: 'no-pointer-events'  // the clickable: false below still blocks events going through to the svg underneath
        });
        var marker = L.marker (latlng, {icon: icon, clickable: false, keyboard: false, opacity: opacity });
        artifact._layer.addLayer(marker);
      } else if (data[type].fragments) {
        // fragment(s) at portal
        var iconUrl = '//commondatastorage.googleapis.com/ingress.com/img/map_icons/marker_images/'+type+'_shard.png'
        var iconSize = 60/2;
        var opacity = 0.6;
        var icon = L.icon({
          iconUrl: iconUrl,
          iconSize: [iconSize,iconSize],
          iconAnchor: [iconSize/2,iconSize/2],
          className: 'no-pointer-events'  // the clickable: false below still blocks events going through to the svg underneath
        });
        var marker = L.marker (latlng, {icon: icon, clickable: false, keyboard: false, opacity: opacity });
        artifact._layer.addLayer(marker);
      }
    });  //end $.each(data, function(type,detail)
  }); //end $.each(artifact.portalInfo, function(guid,data)
}
window.artifact.showArtifactList = function() {
  var html = '';
  if (Object.keys(artifact.artifactTypes).length == 0) {
    html += '
<i>
No artifacts at this time
</i>
';
  }
  var first = true;
  $.each(artifact.artifactTypes, function(type,type2) {
    // no nice way to convert the Niantic internal name into the correct display name
    // (we do get the description string once a portal with that shard type is selected - could cache that somewhere?)
    var name = type.capitalize() + ' shards';
    if (!first) html += '
<hr>
';
    first = false;
    html += '
<div>
<b>
'+name+'
</b>
</div>
';
    html += '
<table class="artifact artifact-'+type+'">
';
    html += '
<tr>
<th>
Portal
</th>
<th>
Details
</th>
</tr>
';
    var tableRows = [];
    $.each(artifact.portalInfo, function(guid, data) {
      if (type in data) {
        // this portal has data for this artifact type - add it to the table
        var onclick = 'zoomToAndShowPortal(\''+guid+'\',['+data._data.latE6/1E6+','+data._data.lngE6/1E6+'])';
        var row = '
<tr>
<td class="portal">
<a onclick="'+onclick+'">
'+escapeHtmlSpecialChars(data._data.title)+'
</a>
</td>
';
        row += '
<td class="info">
';
        if (data[type].target !== undefined) {
          if (data[type].target == TEAM_NONE) {
            row += '
<span class="target">
Target Portal
</span>
 ';
          } else {
            row += '
<span class="target '+TEAM_TO_CSS[data[type].target]+'">
'+(data[type].target==TEAM_RES?'Resistance':'Enlightened')+' target
</span>
 ';
          }
        }
        if (data[type].fragments) {
          if (data[type].target !== undefined) {
            row += '
<br>
';
          }
          var fragmentName = 'shard';
//          row += '
<span class="fragments'+(data[type].target?' '+TEAM_TO_CSS[data[type].target]:'')+'">
'+fragmentName+': #'+data[type].fragments.join(', #')+'
</span>
 ';
          row += '
<span class="fragments'+(data[type].target?' '+TEAM_TO_CSS[data[type].target]:'')+'">
'+fragmentName+': yes
</span>
 ';
        }
        row += '
</td>
</tr>
';
        // sort by target portals first, then by portal GUID
        var sortVal = (data[type].target !== undefined ? 'A' : 'Z') + guid;
        tableRows.push ( [sortVal, row] );
      }
    });
    // check for no rows, and add a note to the table instead
    if (tableRows.length == 0) {
      html += '
<tr>
<td colspan="2">
<i>
No portals at this time
</i>
</td>
</tr>
';
    }
    // sort the rows
    tableRows.sort(function(a,b) {
      if (a[0] == b[0]) return 0;
      else if (a[0]
< b[0]) return -1;
      else return 1;
    });
    // and add them to the table
    html += tableRows.map(function(a){return a[1];}).join('');
    html += '
</table>
';
  });
  html += "
<hr />
"
        + "
<p>
In Summer 2015, Niantic changed the data format for artifact portals. We no longer know:
</p>
"
        + "
<ul>
<li>
Which team each target portal is for - only that it is a target
</li>
"
        + "
<li>
Which shards are at each portal, just that it has one or more shards
</li>
</ul>
"
        + "
<p>
You can select a portal and the detailed data contains the list of shard numbers, but there's still no"
        + " more information on targets.
</p>
";
  dialog({
    title: 'Artifacts',
    html: html,
    width: 400,
    position: {my: 'right center', at: 'center-60 center', of: window, collision: 'fit'}
  });
}
;
/// SETUP /////////////////////////////////////////////////////////////
// these functions set up specific areas after the boot function
// created a basic framework. All of these functions should only ever
// be run once.
window.setupLargeImagePreview = function() {
  $('#portaldetails').on('click', '.imgpreview', function() {
    var img = $(this).find('img')[0];
    var details = $(this).find('div.portalDetails')[0];
    //dialogs have 12px padding around the content
    var dlgWidth = Math.max(img.naturalWidth+24,500);
    if (details) {
      dialog({
        html: '
<div style="text-align: center">
' + img.outerHTML + '
</div>
' + details.outerHTML,
        title: $(this).parent().find('h3.title').text(),
        width: dlgWidth,
      });
    } else {
      dialog({
        html: '
<div style="text-align: center">
' + img.outerHTML + '
</div>
',
        title: $(this).parent().find('h3.title').text(),
        width: dlgWidth,
      });
    }
  });
}
// adds listeners to the layer chooser such that a long press hides
// all custom layers except the long pressed one.
window.setupLayerChooserSelectOne = function() {
  $('.leaflet-control-layers-overlays').on('click taphold', 'label', function(e) {
    if(!e) return;
    if(!(e.metaKey || e.ctrlKey || e.shiftKey || e.altKey || e.type === 'taphold')) return;
    var m = window.map;
    var add = function(layer) {
      if(!m.hasLayer(layer.layer)) m.addLayer(layer.layer);
    };
    var rem = function(layer) {
      if(m.hasLayer(layer.layer)) m.removeLayer(layer.layer);
    };
    var isChecked = $(e.target).find('input').is(':checked');
    var checkSize = $('.leaflet-control-layers-overlays input:checked').length;
    if((isChecked && checkSize === 1) || checkSize === 0) {
      // if nothing is selected or the users long-clicks the only
      // selected element, assume all boxes should be checked again
      $.each(window.layerChooser._layers, function(ind, layer) {
        if(!layer.overlay) return true;
        add(layer);
      });
    } else {
      // uncheck all
      var keep = $.trim($(e.target).text());
      $.each(window.layerChooser._layers, function(ind, layer) {
        if(layer.overlay !== true) return true;
        if(layer.name === keep) { add(layer);  return true; }
        rem(layer);
      });
    }
    e.preventDefault();
  });
}
// Setup the function to record the on/off status of overlay layerGroups
window.setupLayerChooserStatusRecorder = function() {
  // Record already added layerGroups
  $.each(window.layerChooser._layers, function(ind, chooserEntry) {
    if(!chooserEntry.overlay) return true;
    var display = window.map.hasLayer(chooserEntry.layer);
    window.updateDisplayedLayerGroup(chooserEntry.name, display);
  });
  // Record layerGroups change
  window.map.on('overlayadd overlayremove', function(e) {
    var display = (e.type === 'overlayadd');
    window.updateDisplayedLayerGroup(e.name, display);
  });
}
window.layerChooserSetDisabledStates = function() {
// layer selector - enable/disable layers that aren't visible due to zoom level
  var minlvl = getMinPortalLevel();
  var portalSelection = $('.leaflet-control-layers-overlays label');
  //it's an array - 0=unclaimed, 1=lvl 1, 2=lvl 2, ..., 8=lvl 8 - 9 relevant entries
  //mark all levels below (but not at) minlvl as disabled
  portalSelection.slice(0, minlvl).addClass('disabled').attr('title', 'Zoom in to show those.');
  //and all from minlvl to 8 as enabled
  portalSelection.slice(minlvl, 8+1).removeClass('disabled').attr('title', '');
//TODO? some generic mechanism where other layers can have their disabled state marked on/off? a few
//plugins have code to do it by hand already
}
window.setupStyles = function() {
  $('head').append('
<style>
' +
    [ '#largepreview.enl img { border:2px solid '+COLORS[TEAM_ENL]+'; } ',
      '#largepreview.res img { border:2px solid '+COLORS[TEAM_RES]+'; } ',
      '#largepreview.none img { border:2px solid '+COLORS[TEAM_NONE]+'; } ',
      '#chatcontrols { bottom: '+(CHAT_SHRINKED+22)+'px; }',
      '#chat { height: '+CHAT_SHRINKED+'px; } ',
      '.leaflet-right { margin-right: '+(SIDEBAR_WIDTH+1)+'px } ',
      '#updatestatus { width:'+(SIDEBAR_WIDTH+2)+'px;  } ',
      '#sidebar { width:'+(SIDEBAR_WIDTH + HIDDEN_SCROLLBAR_ASSUMED_WIDTH + 1 /*border*/)+'px;  } ',
      '#sidebartoggle { right:'+(SIDEBAR_WIDTH+1)+'px;  } ',
      '#scrollwrapper  { width:'+(SIDEBAR_WIDTH + 2*HIDDEN_SCROLLBAR_ASSUMED_WIDTH)+'px; right:-'+(2*HIDDEN_SCROLLBAR_ASSUMED_WIDTH-2)+'px } ',
      '#sidebar >
 * { width:'+(SIDEBAR_WIDTH+1)+'px;  }'].join("\n")
    + '
</style>
');
}
function createDefaultBaseMapLayers() {
  var baseLayers = {};
  //OpenStreetMap attribution - required by several of the layers
  osmAttribution = 'Map data © OpenStreetMap contributors';
  //MapQuest offer tiles - http://developer.mapquest.com/web/products/open/map
  //their usage policy has no limits (except required notification above 4000 tiles/sec - we're perhaps at 50 tiles/sec based on CloudMade stats)
  var mqSubdomains = [ 'otile1','otile2', 'otile3', 'otile4' ];
  var mqTileUrlPrefix = window.location.protocol !== 'https:' ? 'http://{s}.mqcdn.com' : 'https://{s}-s.mqcdn.com';
  var mqMapOpt = {attribution: osmAttribution+', Tiles Courtesy of MapQuest', maxNativeZoom: 18, maxZoom: 21, subdomains: mqSubdomains};
  baseLayers['MapQuest OSM'] = new L.TileLayer(mqTileUrlPrefix+'/tiles/1.0.0/map/{z}/{x}/{y}.jpg',mqMapOpt);
  // cartodb has some nice tiles too - both dark and light subtle maps - http://cartodb.com/basemaps/
  // (not available over https though - not on the right domain name anyway)
  var cartoAttr = '&copy;
<a href="http://www.openstreetmap.org/copyright">
OpenStreetMap
</a>
 contributors, &copy;
<a href="http://cartodb.com/attributions">
CartoDB
</a>
';
  var cartoUrl = 'http://{s}.basemaps.cartocdn.com/{theme}/{z}/{x}/{y}.png';
  baseLayers['CartoDB Dark Matter'] = L.tileLayer(cartoUrl,{attribution:cartoAttr,theme:'dark_all'});
  baseLayers['CartoDB Positron'] = L.tileLayer(cartoUrl,{attribution:cartoAttr,theme:'light_all'});
  // we'll include google maps too - in the ingress default style, and a few other standard ones
  // as the stock intel map already uses the googme maps API, we just hijack their inclusion of the javascript and API key :)
  var ingressGMapOptions = {
    backgroundColor: '#0e3d4e', //or #dddddd ? - that's the Google tile layer default
    styles: [
        { featureType:"all", elementType:"all",
          stylers: [{visibility:"on"}, {hue:"#131c1c"}, {saturation:"-50"}, {invert_lightness:true}] },
        { featureType:"water", elementType:"all",
          stylers: [{visibility:"on"}, {hue:"#005eff"}, {invert_lightness:true}] },
        { featureType:"poi", stylers:[{visibility:"off"}]},
        { featureType:"transit", elementType:"all", stylers:[{visibility:"off"}] }
      ]
  };
  baseLayers['Google Default Ingress Map'] = new L.Google('ROADMAP',{maxZoom:21, mapOptions:ingressGMapOptions});
  baseLayers['Google Roads'] = new L.Google('ROADMAP',{maxZoom:21});
  baseLayers['Google Satellite'] = new L.Google('SATELLITE',{maxZoom:21});
  baseLayers['Google Hybrid'] = new L.Google('HYBRID',{maxZoom:21});
  baseLayers['Google Terrain'] = new L.Google('TERRAIN',{maxZoom:15});
  return baseLayers;
}
window.setupMap = function() {
  $('#map').text('');
  // proper initial position is now delayed until all plugins are loaded and the base layer is set
  window.map = new L.Map('map', {
    center: [0,0],
    zoom: 1,
    zoomControl: (typeof android !== 'undefined' && android && android.showZoom) ? android.showZoom() : true,
    minZoom: MIN_ZOOM,
//    zoomAnimation: false,
    markerZoomAnimation: false,
    bounceAtZoomLimits: false
  });
  if (L.Path.CANVAS) {
    // for canvas, 2% overdraw only - to help performance
    L.Path.CLIP_PADDING = 0.02;
  } else if (L.Path.SVG) {
    if (L.Browser.mobile) {
      // mobile SVG - 10% ovredraw. might help performance?
      L.Path.CLIP_PADDING = 0.1;
    } else {
      // for svg, 100% overdraw - so we have a full screen worth in all directions
      L.Path.CLIP_PADDING = 1.0;
    }
  }
  // add empty div to leaflet control areas - to force other leaflet controls to move around IITC UI elements
  // TODO? move the actual IITC DOM into the leaflet control areas, so dummy
<div>
s aren't needed
  if(!isSmartphone()) {
    // chat window area
    $(window.map._controlCorners['bottomleft']).append(
      $('
<div>
').width(708).height(108).addClass('leaflet-control').css({'pointer-events': 'none', 'margin': '0'}));
  }
  var addLayers = {};
  var hiddenLayer = [];
  portalsFactionLayers = [];
  var portalsLayers = [];
  for(var i = 0; i
<= 8; i++) {
    portalsFactionLayers[i] = [L.layerGroup(), L.layerGroup(), L.layerGroup()];
    portalsLayers[i] = L.layerGroup(portalsFactionLayers[i]);
    map.addLayer(portalsLayers[i]);
    var t = (i === 0 ? 'Unclaimed' : 'Level ' + i) + ' Portals';
    addLayers[t] = portalsLayers[i];
    // Store it in hiddenLayer to remove later
    if(!isLayerGroupDisplayed(t, true)) hiddenLayer.push(portalsLayers[i]);
  }
  fieldsFactionLayers = [L.layerGroup(), L.layerGroup(), L.layerGroup()];
  var fieldsLayer = L.layerGroup(fieldsFactionLayers);
  map.addLayer(fieldsLayer, true);
  addLayers['Fields'] = fieldsLayer;
  // Store it in hiddenLayer to remove later
  if(!isLayerGroupDisplayed('Fields', true)) hiddenLayer.push(fieldsLayer);
  linksFactionLayers = [L.layerGroup(), L.layerGroup(), L.layerGroup()];
  var linksLayer = L.layerGroup(linksFactionLayers);
  map.addLayer(linksLayer, true);
  addLayers['Links'] = linksLayer;
  // Store it in hiddenLayer to remove later
  if(!isLayerGroupDisplayed('Links', true)) hiddenLayer.push(linksLayer);
  // faction-specific layers
  // these layers don't actually contain any data. instead, every time they're added/removed from the map,
  // the matching sub-layers within the above portals/fields/links are added/removed from their parent with
  // the below 'onoverlayadd/onoverlayremove' events
  var factionLayers = [L.layerGroup(), L.layerGroup(), L.layerGroup()];
  for (var fac in factionLayers) {
    map.addLayer (factionLayers[fac]);
  }
  var setFactionLayersState = function(fac,enabled) {
    if (enabled) {
      if (!fieldsLayer.hasLayer(fieldsFactionLayers[fac])) fieldsLayer.addLayer (fieldsFactionLayers[fac]);
      if (!linksLayer.hasLayer(linksFactionLayers[fac])) linksLayer.addLayer (linksFactionLayers[fac]);
      for (var lvl in portalsLayers) {
        if (!portalsLayers[lvl].hasLayer(portalsFactionLayers[lvl][fac])) portalsLayers[lvl].addLayer (portalsFactionLayers[lvl][fac]);
      }
    } else {
      if (fieldsLayer.hasLayer(fieldsFactionLayers[fac])) fieldsLayer.removeLayer (fieldsFactionLayers[fac]);
      if (linksLayer.hasLayer(linksFactionLayers[fac])) linksLayer.removeLayer (linksFactionLayers[fac]);
      for (var lvl in portalsLayers) {
        if (portalsLayers[lvl].hasLayer(portalsFactionLayers[lvl][fac])) portalsLayers[lvl].removeLayer (portalsFactionLayers[lvl][fac]);
      }
    }
  }
  // to avoid any favouritism, we'll put the player's own faction layer first
  if (PLAYER.team == 'RESISTANCE') {
    addLayers['Resistance'] = factionLayers[TEAM_RES];
    addLayers['Enlightened'] = factionLayers[TEAM_ENL];
  } else {
    addLayers['Enlightened'] = factionLayers[TEAM_ENL];
    addLayers['Resistance'] = factionLayers[TEAM_RES];
  }
  if (!isLayerGroupDisplayed('Resistance', true)) hiddenLayer.push (factionLayers[TEAM_RES]);
  if (!isLayerGroupDisplayed('Enlightened', true)) hiddenLayer.push (factionLayers[TEAM_ENL]);
  setFactionLayersState (TEAM_NONE, true);
  setFactionLayersState (TEAM_RES, isLayerGroupDisplayed('Resistance', true));
  setFactionLayersState (TEAM_ENL, isLayerGroupDisplayed('Enlightened', true));
  // NOTE: these events are fired by the layer chooser, so won't happen until that's created and added to the map
  window.map.on('overlayadd overlayremove', function(e) {
    var displayed = (e.type == 'overlayadd');
    switch (e.name) {
      case 'Resistance':
        setFactionLayersState (TEAM_RES, displayed);
        break;
      case 'Enlightened':
        setFactionLayersState (TEAM_ENL, displayed);
        break;
    }
  });
  var baseLayers = createDefaultBaseMapLayers();
  window.layerChooser = new L.Control.Layers(baseLayers, addLayers);
  // Remove the hidden layer after layerChooser built, to avoid messing up ordering of layers
  $.each(hiddenLayer, function(ind, layer){
    map.removeLayer(layer);
    // as users often become confused if they accidentally switch a standard layer off, display a warning in this case
    $('#portaldetails').html('
<div class="layer_off_warning">
'
                            +'
<p>
<b>
Warning
</b>
: some of the standard layers are turned off. Some portals/links/fields will not be visible.
</p>
'
                            +'
<a id="enable_standard_layers">
Enable standard layers
</a>
'
                            +'
</div>
');
    $('#enable_standard_layers').on('click', function() {
      $.each(addLayers, function(ind, layer) {
        if (!map.hasLayer(layer)) map.addLayer(layer);
      });
      $('#portaldetails').html('');
    });
  });
  map.addControl(window.layerChooser);
  map.attributionControl.setPrefix('');
  // listen for changes and store them in cookies
  map.on('moveend', window.storeMapPosition);
  map.on('moveend', function(e) {
    // two limits on map position
    // we wrap longitude (the L.LatLng 'wrap' method) - so we don't find ourselves looking beyond +-180 degrees
    // then latitude is clamped with the clampLatLng function (to the 85 deg north/south limits)
    var newPos = clampLatLng(map.getCenter().wrap());
    if (!map.getCenter().equals(newPos)) {
      map.panTo(newPos,{animate:false})
    }
  });
  // map update status handling & update map hooks
  // ensures order of calls
  map.on('movestart', function() { window.mapRunsUserAction = true; window.requests.abort(); window.startRefreshTimeout(-1); });
  map.on('moveend', function() { window.mapRunsUserAction = false; window.startRefreshTimeout(ON_MOVE_REFRESH*1000); });
  map.on('zoomend', function() { window.layerChooserSetDisabledStates(); });
  window.layerChooserSetDisabledStates();
  // on zoomend, check to see the zoom level is an int, and reset the view if not
  // (there's a bug on mobile where zoom levels sometimes end up as fractional levels. this causes the base map to be invisible)
  map.on('zoomend', function() {
    var z = map.getZoom();
    if (z != parseInt(z))
    {
      console.warn('Non-integer zoom level at zoomend: '+z+' - trying to fix...');
      map.setZoom(parseInt(z), {animate:false});
    }
  });
  // set a 'moveend' handler for the map to clear idle state. e.g. after mobile 'my location' is used.
  // possibly some cases when resizing desktop browser too
  map.on('moveend', idleReset);
  window.addResumeFunction(function() { window.startRefreshTimeout(ON_MOVE_REFRESH*1000); });
  // create the map data requester
  window.mapDataRequest = new MapDataRequest();
  window.mapDataRequest.start();
  // start the refresh process with a small timeout, so the first data request happens quickly
  // (the code originally called the request function directly, and triggered a normal delay for the next refresh.
  //  however, the moveend/zoomend gets triggered on map load, causing a duplicate refresh. this helps prevent that
  window.startRefreshTimeout(ON_MOVE_REFRESH*1000);
};
//adds a base layer to the map. done separately from the above, so that plugins that add base layers can be the default
window.setMapBaseLayer = function() {
  //create a map name ->
 layer mapping - depends on internals of L.Control.Layers
  var nameToLayer = {};
  var firstLayer = null;
  for (i in window.layerChooser._layers) {
    var obj = window.layerChooser._layers[i];
    if (!obj.overlay) {
      nameToLayer[obj.name] = obj.layer;
      if (!firstLayer) firstLayer = obj.layer;
    }
  }
  var baseLayer = nameToLayer[localStorage['iitc-base-map']] || firstLayer;
  map.addLayer(baseLayer);
  // now we have a base layer we can set the map position
  // (setting an initial position, before a base layer is added, causes issues with leaflet)
  var pos = getPosition();
  map.setView (pos.center, pos.zoom, {reset:true});
  //event to track layer changes and store the name
  map.on('baselayerchange', function(info) {
    for(i in window.layerChooser._layers) {
      var obj = window.layerChooser._layers[i];
      if (info.layer === obj.layer) {
        localStorage['iitc-base-map'] = obj.name;
        break;
      }
    }
    //also, leaflet no longer ensures the base layer zoom is suitable for the map (a bug? feature change?), so do so here
    map.setZoom(map.getZoom());
  });
}
// renders player details into the website. Since the player info is
// included as inline script in the original site, the data is static
// and cannot be updated.
window.setupPlayerStat = function() {
  // stock site updated to supply the actual player level, AP requirements and XM capacity values
  var level = PLAYER.verified_level;
  PLAYER.level = level; //for historical reasons IITC expects PLAYER.level to contain the current player level
  var n = window.PLAYER.nickname;
  PLAYER.nickMatcher = new RegExp('\\b('+n+')\\b', 'ig');
  var ap = parseInt(PLAYER.ap);
  var thisLvlAp = parseInt(PLAYER.min_ap_for_current_level);
  var nextLvlAp = parseInt(PLAYER.min_ap_for_next_level);
  if (nextLvlAp) {
    var lvlUpAp = digits(nextLvlAp-ap);
    var lvlApProg = Math.round((ap-thisLvlAp)/(nextLvlAp-thisLvlAp)*100);
  } // else zero nextLvlAp - so at maximum level(?)
  var xmMax = parseInt(PLAYER.xm_capacity);
  var xmRatio = Math.round(PLAYER.energy/xmMax*100);
  var cls = PLAYER.team === 'RESISTANCE' ? 'res' : 'enl';
  var t = 'Level:\t' + level + '\n'
        + 'XM:\t' + PLAYER.energy + ' / ' + xmMax + '\n'
        + 'AP:\t' + digits(ap) + '\n'
        + (nextLvlAp >
 0 ? 'level up in:\t' + lvlUpAp + ' AP' : 'Maximul level reached(!)')
        + '\n\Invites:\t'+PLAYER.available_invites
        + '\n\nNote: your player stats can only be updated by a full reload (F5)';
  $('#playerstat').html(''
    + '
<h2 title="'+t+'">
'+level+'&nbsp;'
    + '
<div id="name">
'
    + '
<span class="'+cls+'">
'+PLAYER.nickname+'
</span>
'
    + '
<a href="/_ah/logout?continue=https://www.google.com/accounts/Logout%3Fcontinue%3Dhttps://appengine.google.com/_ah/logout%253Fcontinue%253Dhttps://www.ingress.com/intel%26service%3Dah" id="signout">
sign out
</a>
'
    + '
</div>
'
    + '
<div id="stats">
'
    + '
<sup>
XM: '+xmRatio+'%
</sup>
'
    + '
<sub>
' + (nextLvlAp >
 0 ? 'level: '+lvlApProg+'%' : 'max level') + '
</sub>
'
    + '
</div>
'
    + '
</h2>
'
  );
}
window.setupSidebarToggle = function() {
  $('#sidebartoggle').on('click', function() {
    var toggle = $('#sidebartoggle');
    var sidebar = $('#scrollwrapper');
    if(sidebar.is(':visible')) {
      sidebar.hide().css('z-index', 1);
      $('.leaflet-right').css('margin-right','0');
      toggle.html('
<span class="toggle open">
</span>
');
      toggle.css('right', '0');
    } else {
      sidebar.css('z-index', 1001).show();
      $('.leaflet-right').css('margin-right', SIDEBAR_WIDTH+1+'px');
      toggle.html('
<span class="toggle close">
</span>
');
      toggle.css('right', SIDEBAR_WIDTH+1+'px');
    }
    $('.ui-tooltip').remove();
  });
}
window.setupTooltips = function(element) {
  element = element || $(document);
  element.tooltip({
    // disable show/hide animation
    show: { effect: 'none', duration: 0, delay: 350 },
    hide: false,
    open: function(event, ui) {
      // ensure all other tooltips are closed
      $(".ui-tooltip").not(ui.tooltip).remove();
    },
    content: function() {
      var title = $(this).attr('title');
      return window.convertTextToTableMagic(title);
    }
  });
  if(!window.tooltipClearerHasBeenSetup) {
    window.tooltipClearerHasBeenSetup = true;
    $(document).on('click', '.ui-tooltip', function() { $(this).remove(); });
  }
}
window.setupTaphold = function() {
  // @author Rich Adams
<rich@richadams.me>
// Implements a tap and hold functionality. If you click/tap and release, it will trigger a normal
// click event. But if you click/tap and hold for 1s (default), it will trigger a taphold event instead.
;(function($)
{
    // Default options
    var defaults = {
        duration: 1000, // ms
        clickHandler: null
    }
    // When start of a taphold event is triggered.
    function startHandler(event)
    {
        var $elem = jQuery(this);
        // Merge the defaults and any user defined settings.
        settings = jQuery.extend({}, defaults, event.data);
        // If object also has click handler, store it and unbind. Taphold will trigger the
        // click itself, rather than normal propagation.
        if (typeof $elem.data("events") != "undefined"
            && typeof $elem.data("events").click != "undefined")
        {
            // Find the one without a namespace defined.
            for (var c in $elem.data("events").click)
            {
                if ($elem.data("events").click[c].namespace == "")
                {
                    var handler = $elem.data("events").click[c].handler
                    $elem.data("taphold_click_handler", handler);
                    $elem.unbind("click", handler);
                    break;
                }
            }
        }
        // Otherwise, if a custom click handler was explicitly defined, then store it instead.
        else if (typeof settings.clickHandler == "function")
        {
            $elem.data("taphold_click_handler", settings.clickHandler);
        }
        // Reset the flags
        $elem.data("taphold_triggered", false); // If a hold was triggered
        $elem.data("taphold_clicked",   false); // If a click was triggered
        $elem.data("taphold_cancelled", false); // If event has been cancelled.
        // Set the timer for the hold event.
        $elem.data("taphold_timer",
            setTimeout(function()
            {
                // If event hasn't been cancelled/clicked already, then go ahead and trigger the hold.
                if (!$elem.data("taphold_cancelled")
                    && !$elem.data("taphold_clicked"))
                {
                    // Trigger the hold event, and set the flag to say it's been triggered.
                    $elem.trigger(jQuery.extend(event, jQuery.Event("taphold")));
                    $elem.data("taphold_triggered", true);
                }
            }, settings.duration));
    }
    // When user ends a tap or click, decide what we should do.
    function stopHandler(event)
    {
        var $elem = jQuery(this);
        // If taphold has been cancelled, then we're done.
        if ($elem.data("taphold_cancelled")) { return; }
        // Clear the hold timer. If it hasn't already triggered, then it's too late anyway.
        clearTimeout($elem.data("taphold_timer"));
        // If hold wasn't triggered and not already clicked, then was a click event.
        if (!$elem.data("taphold_triggered")
            && !$elem.data("taphold_clicked"))
        {
            // If click handler, trigger it.
            if (typeof $elem.data("taphold_click_handler") == "function")
            {
                $elem.data("taphold_click_handler")(jQuery.extend(event, jQuery.Event("click")));
            }
            // Set flag to say we've triggered the click event.
            $elem.data("taphold_clicked", true);
        }
    }
    // If a user prematurely leaves the boundary of the object we're working on.
    function leaveHandler(event)
    {
        // Cancel the event.
        $(this).data("taphold_cancelled", true);
    }
    // Determine if touch events are supported.
    var touchSupported = ("ontouchstart" in window) // Most browsers
                         || ("onmsgesturechange" in window); // Mircosoft
    var taphold = $.event.special.taphold =
    {
        setup: function(data)
        {
            $(this).bind((touchSupported ? "touchstart" : "mousedown"),  data, startHandler)
                   .bind((touchSupported ? "touchend"   : "mouseup"),    stopHandler)
                   .bind((touchSupported ? "touchmove"  : "mouseleave"), leaveHandler);
            if(touchSupported)
                $(this).bind("touchcancel", leaveHandler);
        },
        teardown: function(namespaces)
        {
            $(this).unbind((touchSupported ? "touchstart" : "mousedown"),  startHandler)
                   .unbind((touchSupported ? "touchend"   : "mouseup"),    stopHandler)
                   .unbind((touchSupported ? "touchmove"  : "mouseleave"), leaveHandler);
            if(touchSupported)
                $(this).unbind("touchcancel", leaveHandler);
        }
    };
})(jQuery);
}
window.setupQRLoadLib = function() {
  (function(r){r.fn.qrcode=function(h){var s;function u(a){this.mode=s;this.data=a}function o(a,c){this.typeNumber=a;this.errorCorrectLevel=c;this.modules=null;this.moduleCount=0;this.dataCache=null;this.dataList=[]}function q(a,c){if(void 0==a.length)throw Error(a.length+"/"+c);for(var d=0;d
<a.length&&0==a[d];)d++;this.num=Array(a.length-d+c);for(var b=0;b
<a.length-d;b++)this.num[b]=a[b+d]}function p(a,c){this.totalCount=a;this.dataCount=c}function t(){this.buffer=[];this.length=0}u.prototype={getLength:function(){return this.data.length},
write:function(a){for(var c=0;c
<this.data.length;c++)a.put(this.data.charCodeAt(c),8)}};o.prototype={addData:function(a){this.dataList.push(new u(a));this.dataCache=null},isDark:function(a,c){if(0>
a||this.moduleCount
<=a||0>
c||this.moduleCount
<=c)throw Error(a+","+c);return this.modules[a][c]},getModuleCount:function(){return this.moduleCount},make:function(){if(1>
this.typeNumber){for(var a=1,a=1;40>
a;a++){for(var c=p.getRSBlocks(a,this.errorCorrectLevel),d=new t,b=0,e=0;e
<c.length;e++)b+=c[e].dataCount;
for(e=0;e
<this.dataList.length;e++)c=this.dataList[e],d.put(c.mode,4),d.put(c.getLength(),j.getLengthInBits(c.mode,a)),c.write(d);if(d.getLengthInBits()
<=8*b)break}this.typeNumber=a}this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(a,c){this.moduleCount=4*this.typeNumber+17;this.modules=Array(this.moduleCount);for(var d=0;d
<this.moduleCount;d++){this.modules[d]=Array(this.moduleCount);for(var b=0;b
<this.moduleCount;b++)this.modules[d][b]=null}this.setupPositionProbePattern(0,0);this.setupPositionProbePattern(this.moduleCount-
7,0);this.setupPositionProbePattern(0,this.moduleCount-7);this.setupPositionAdjustPattern();this.setupTimingPattern();this.setupTypeInfo(a,c);7
<=this.typeNumber&&this.setupTypeNumber(a);null==this.dataCache&&(this.dataCache=o.createData(this.typeNumber,this.errorCorrectLevel,this.dataList));this.mapData(this.dataCache,c)},setupPositionProbePattern:function(a,c){for(var d=-1;7>
=d;d++)if(!(-1>
=a+d||this.moduleCount
<=a+d))for(var b=-1;7>
=b;b++)-1>
=c+b||this.moduleCount
<=c+b||(this.modules[a+d][c+b]=
0
<=d&&6>
=d&&(0==b||6==b)||0
<=b&&6>
=b&&(0==d||6==d)||2
<=d&&4>
=d&&2
<=b&&4>
=b?!0:!1)},getBestMaskPattern:function(){for(var a=0,c=0,d=0;8>
d;d++){this.makeImpl(!0,d);var b=j.getLostPoint(this);if(0==d||a>
b)a=b,c=d}return c},createMovieClip:function(a,c,d){a=a.createEmptyMovieClip(c,d);this.make();for(c=0;c
<this.modules.length;c++)for(var d=1*c,b=0;b
<this.modules[c].length;b++){var e=1*b;this.modules[c][b]&&(a.beginFill(0,100),a.moveTo(e,d),a.lineTo(e+1,d),a.lineTo(e+1,d+1),a.lineTo(e,d+1),a.endFill())}return a},
setupTimingPattern:function(){for(var a=8;a
<this.moduleCount-8;a++)null==this.modules[a][6]&&(this.modules[a][6]=0==a%2);for(a=8;a
<this.moduleCount-8;a++)null==this.modules[6][a]&&(this.modules[6][a]=0==a%2)},setupPositionAdjustPattern:function(){for(var a=j.getPatternPosition(this.typeNumber),c=0;c
<a.length;c++)for(var d=0;d
<a.length;d++){var b=a[c],e=a[d];if(null==this.modules[b][e])for(var f=-2;2>
=f;f++)for(var i=-2;2>
=i;i++)this.modules[b+f][e+i]=-2==f||2==f||-2==i||2==i||0==f&&0==i?!0:!1}},setupTypeNumber:function(a){for(var c=
j.getBCHTypeNumber(this.typeNumber),d=0;18>
d;d++){var b=!a&&1==(c>
>
d&1);this.modules[Math.floor(d/3)][d%3+this.moduleCount-8-3]=b}for(d=0;18>
d;d++)b=!a&&1==(c>
>
d&1),this.modules[d%3+this.moduleCount-8-3][Math.floor(d/3)]=b},setupTypeInfo:function(a,c){for(var d=j.getBCHTypeInfo(this.errorCorrectLevel
<
<3|c),b=0;15>
b;b++){var e=!a&&1==(d>
>
b&1);6>
b?this.modules[b][8]=e:8>
b?this.modules[b+1][8]=e:this.modules[this.moduleCount-15+b][8]=e}for(b=0;15>
b;b++)e=!a&&1==(d>
>
b&1),8>
b?this.modules[8][this.moduleCount-
b-1]=e:9>
b?this.modules[8][15-b-1+1]=e:this.modules[8][15-b-1]=e;this.modules[this.moduleCount-8][8]=!a},mapData:function(a,c){for(var d=-1,b=this.moduleCount-1,e=7,f=0,i=this.moduleCount-1;0
<i;i-=2)for(6==i&&i--;;){for(var g=0;2>
g;g++)if(null==this.modules[b][i-g]){var n=!1;f
<a.length&&(n=1==(a[f]>
>
>
e&1));j.getMask(c,b,i-g)&&(n=!n);this.modules[b][i-g]=n;e--; -1==e&&(f++,e=7)}b+=d;if(0>
b||this.moduleCount
<=b){b-=d;d=-d;break}}}};o.PAD0=236;o.PAD1=17;o.createData=function(a,c,d){for(var c=p.getRSBlocks(a,
c),b=new t,e=0;e
<d.length;e++){var f=d[e];b.put(f.mode,4);b.put(f.getLength(),j.getLengthInBits(f.mode,a));f.write(b)}for(e=a=0;e
<c.length;e++)a+=c[e].dataCount;if(b.getLengthInBits()>
8*a)throw Error("code length overflow. ("+b.getLengthInBits()+">
"+8*a+")");for(b.getLengthInBits()+4
<=8*a&&b.put(0,4);0!=b.getLengthInBits()%8;)b.putBit(!1);for(;!(b.getLengthInBits()>
=8*a);){b.put(o.PAD0,8);if(b.getLengthInBits()>
=8*a)break;b.put(o.PAD1,8)}return o.createBytes(b,c)};o.createBytes=function(a,c){for(var d=
0,b=0,e=0,f=Array(c.length),i=Array(c.length),g=0;g
<c.length;g++){var n=c[g].dataCount,h=c[g].totalCount-n,b=Math.max(b,n),e=Math.max(e,h);f[g]=Array(n);for(var k=0;k
<f[g].length;k++)f[g][k]=255&a.buffer[k+d];d+=n;k=j.getErrorCorrectPolynomial(h);n=(new q(f[g],k.getLength()-1)).mod(k);i[g]=Array(k.getLength()-1);for(k=0;k
<i[g].length;k++)h=k+n.getLength()-i[g].length,i[g][k]=0
<=h?n.get(h):0}for(k=g=0;k
<c.length;k++)g+=c[k].totalCount;d=Array(g);for(k=n=0;k
<b;k++)for(g=0;g
<c.length;g++)k
<f[g].length&&
(d[n++]=f[g][k]);for(k=0;k
<e;k++)for(g=0;g
<c.length;g++)k
<i[g].length&&(d[n++]=i[g][k]);return d};s=4;for(var j={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,
78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(a){for(var c=a
<
<10;0
<=j.getBCHDigit(c)-j.getBCHDigit(j.G15);)c^=j.G15
<
<j.getBCHDigit(c)-j.getBCHDigit(j.G15);return(a
<
<10|c)^j.G15_MASK},getBCHTypeNumber:function(a){for(var c=a
<
<12;0
<=j.getBCHDigit(c)-
j.getBCHDigit(j.G18);)c^=j.G18
<
<j.getBCHDigit(c)-j.getBCHDigit(j.G18);return a
<
<12|c},getBCHDigit:function(a){for(var c=0;0!=a;)c++,a>
>
>
=1;return c},getPatternPosition:function(a){return j.PATTERN_POSITION_TABLE[a-1]},getMask:function(a,c,d){switch(a){case 0:return 0==(c+d)%2;case 1:return 0==c%2;case 2:return 0==d%3;case 3:return 0==(c+d)%3;case 4:return 0==(Math.floor(c/2)+Math.floor(d/3))%2;case 5:return 0==c*d%2+c*d%3;case 6:return 0==(c*d%2+c*d%3)%2;case 7:return 0==(c*d%3+(c+d)%2)%2;default:throw Error("bad maskPattern:"+
a);}},getErrorCorrectPolynomial:function(a){for(var c=new q([1],0),d=0;d
<a;d++)c=c.multiply(new q([1,l.gexp(d)],0));return c},getLengthInBits:function(a,c){if(1
<=c&&10>
c)switch(a){case 1:return 10;case 2:return 9;case s:return 8;case 8:return 8;default:throw Error("mode:"+a);}else if(27>
c)switch(a){case 1:return 12;case 2:return 11;case s:return 16;case 8:return 10;default:throw Error("mode:"+a);}else if(41>
c)switch(a){case 1:return 14;case 2:return 13;case s:return 16;case 8:return 12;default:throw Error("mode:"+
a);}else throw Error("type:"+c);},getLostPoint:function(a){for(var c=a.getModuleCount(),d=0,b=0;b
<c;b++)for(var e=0;e
<c;e++){for(var f=0,i=a.isDark(b,e),g=-1;1>
=g;g++)if(!(0>
b+g||c
<=b+g))for(var h=-1;1>
=h;h++)0>
e+h||c
<=e+h||0==g&&0==h||i==a.isDark(b+g,e+h)&&f++;5
<f&&(d+=3+f-5)}for(b=0;b
<c-1;b++)for(e=0;e
<c-1;e++)if(f=0,a.isDark(b,e)&&f++,a.isDark(b+1,e)&&f++,a.isDark(b,e+1)&&f++,a.isDark(b+1,e+1)&&f++,0==f||4==f)d+=3;for(b=0;b
<c;b++)for(e=0;e
<c-6;e++)a.isDark(b,e)&&!a.isDark(b,e+1)&&a.isDark(b,e+
2)&&a.isDark(b,e+3)&&a.isDark(b,e+4)&&!a.isDark(b,e+5)&&a.isDark(b,e+6)&&(d+=40);for(e=0;e
<c;e++)for(b=0;b
<c-6;b++)a.isDark(b,e)&&!a.isDark(b+1,e)&&a.isDark(b+2,e)&&a.isDark(b+3,e)&&a.isDark(b+4,e)&&!a.isDark(b+5,e)&&a.isDark(b+6,e)&&(d+=40);for(e=f=0;e
<c;e++)for(b=0;b
<c;b++)a.isDark(b,e)&&f++;a=Math.abs(100*f/c/c-50)/5;return d+10*a}},l={glog:function(a){if(1>
a)throw Error("glog("+a+")");return l.LOG_TABLE[a]},gexp:function(a){for(;0>
a;)a+=255;for(;256
<=a;)a-=255;return l.EXP_TABLE[a]},EXP_TABLE:Array(256),
LOG_TABLE:Array(256)},m=0;8>
m;m++)l.EXP_TABLE[m]=1
<
<m;for(m=8;256>
m;m++)l.EXP_TABLE[m]=l.EXP_TABLE[m-4]^l.EXP_TABLE[m-5]^l.EXP_TABLE[m-6]^l.EXP_TABLE[m-8];for(m=0;255>
m;m++)l.LOG_TABLE[l.EXP_TABLE[m]]=m;q.prototype={get:function(a){return this.num[a]},getLength:function(){return this.num.length},multiply:function(a){for(var c=Array(this.getLength()+a.getLength()-1),d=0;d
<this.getLength();d++)for(var b=0;b
<a.getLength();b++)c[d+b]^=l.gexp(l.glog(this.get(d))+l.glog(a.get(b)));return new q(c,0)},mod:function(a){if(0>
this.getLength()-a.getLength())return this;for(var c=l.glog(this.get(0))-l.glog(a.get(0)),d=Array(this.getLength()),b=0;b
<this.getLength();b++)d[b]=this.get(b);for(b=0;b
<a.getLength();b++)d[b]^=l.gexp(l.glog(a.get(b))+c);return(new q(d,0)).mod(a)}};p.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],
[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,
116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,
43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,
3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,
55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,
45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]];p.getRSBlocks=function(a,c){var d=p.getRsBlockTable(a,c);if(void 0==d)throw Error("bad rs block @ typeNumber:"+a+"/errorCorrectLevel:"+c);for(var b=d.length/3,e=[],f=0;f
<b;f++)for(var h=d[3*f+0],g=d[3*f+1],j=d[3*f+2],l=0;l
<h;l++)e.push(new p(g,j));return e};p.getRsBlockTable=function(a,c){switch(c){case 1:return p.RS_BLOCK_TABLE[4*(a-1)+0];case 0:return p.RS_BLOCK_TABLE[4*(a-1)+1];case 3:return p.RS_BLOCK_TABLE[4*
(a-1)+2];case 2:return p.RS_BLOCK_TABLE[4*(a-1)+3]}};t.prototype={get:function(a){return 1==(this.buffer[Math.floor(a/8)]>
>
>
7-a%8&1)},put:function(a,c){for(var d=0;d
<c;d++)this.putBit(1==(a>
>
>
c-d-1&1))},getLengthInBits:function(){return this.length},putBit:function(a){var c=Math.floor(this.length/8);this.buffer.length
<=c&&this.buffer.push(0);a&&(this.buffer[c]|=128>
>
>
this.length%8);this.length++}};"string"===typeof h&&(h={text:h});h=r.extend({},{render:"canvas",width:256,height:256,typeNumber:-1,
correctLevel:2,background:"#ffffff",foreground:"#000000"},h);return this.each(function(){var a;if("canvas"==h.render){a=new o(h.typeNumber,h.correctLevel);a.addData(h.text);a.make();var c=document.createElement("canvas");c.width=h.width;c.height=h.height;for(var d=c.getContext("2d"),b=h.width/a.getModuleCount(),e=h.height/a.getModuleCount(),f=0;f
<a.getModuleCount();f++)for(var i=0;i
<a.getModuleCount();i++){d.fillStyle=a.isDark(f,i)?h.foreground:h.background;var g=Math.ceil((i+1)*b)-Math.floor(i*b),
j=Math.ceil((f+1)*b)-Math.floor(f*b);d.fillRect(Math.round(i*b),Math.round(f*e),g,j)}}else{a=new o(h.typeNumber,h.correctLevel);a.addData(h.text);a.make();c=r("
<table>
</table>
").css("width",h.width+"px").css("height",h.height+"px").css("border","0px").css("border-collapse","collapse").css("background-color",h.background);d=h.width/a.getModuleCount();b=h.height/a.getModuleCount();for(e=0;e
<a.getModuleCount();e++){f=r("
<tr>
</tr>
").css("height",b+"px").appendTo(c);for(i=0;i
<a.getModuleCount();i++)r("
<td>
</td>
").css("width",
d+"px").css("background-color",a.isDark(e,i)?h.foreground:h.background).appendTo(f)}}a=c;jQuery(a).appendTo(this)})}})(jQuery);
}
window.setupLayerChooserApi = function() {
  // hide layer chooser if booted with the iitcm android app
  if (typeof android !== 'undefined' && android && android.setLayers) {
    $('.leaflet-control-layers').hide();
  }
  //hook some additional code into the LayerControl so it's easy for the mobile app to interface with it
  //WARNING: does depend on internals of the L.Control.Layers code
  window.layerChooser.getLayers = function() {
    var baseLayers = new Array();
    var overlayLayers = new Array();
    for (i in this._layers) {
      var obj = this._layers[i];
      var layerActive = window.map.hasLayer(obj.layer);
      var info = {
        layerId: L.stamp(obj.layer),
        name: obj.name,
        active: layerActive
      }
      if (obj.overlay) {
        overlayLayers.push(info);
      } else {
        baseLayers.push(info);
      }
    }
    var overlayLayersJSON = JSON.stringify(overlayLayers);
    var baseLayersJSON = JSON.stringify(baseLayers);
    if (typeof android !== 'undefined' && android && android.setLayers) {
        android.setLayers(baseLayersJSON, overlayLayersJSON);
    }
    return {
      baseLayers: baseLayers,
      overlayLayers: overlayLayers
    }
  }
  window.layerChooser.showLayer = function(id,show) {
    if (show === undefined) show = true;
    obj = this._layers[id];
    if (!obj) return false;
    if(show) {
      if (!this._map.hasLayer(obj.layer)) {
        //the layer to show is not currently active
        this._map.addLayer(obj.layer);
        //if it's a base layer, remove any others
        if (!obj.overlay) {
          for(i in this._layers) {
            if (i != id) {
              var other = this._layers[i];
              if (!other.overlay && this._map.hasLayer(other.layer)) this._map.removeLayer(other.layer);
            }
          }
        }
      }
    } else {
      if (this._map.hasLayer(obj.layer)) {
        this._map.removeLayer(obj.layer);
      }
    }
    //below logic based on code in L.Control.Layers _onInputClick
    if(!obj.overlay) {
      this._map.setZoom(this._map.getZoom());
      this._map.fire('baselayerchange', {layer: obj.layer});
    }
    return true;
  }
}
// BOOTING ///////////////////////////////////////////////////////////
function boot() {
  if(!isSmartphone()) // TODO remove completely?
    window.debug.console.overwriteNativeIfRequired();
  console.log('loading done, booting. Built: 2015-09-17-154202');
  if(window.deviceID) console.log('Your device ID: ' + window.deviceID);
  window.runOnSmartphonesBeforeBoot();
  var iconDefImage = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAApCAYAAADAk4LOAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAocSURBVHjanNRbUFN3Hgfwv9Pdzu5sZ7cP3d1eprP7sC/bPvSls9MmB5CLcg2IIAhSWwS8rFqrpbVbu3Vdd2ov04qJgGBESAJJCOR2AiFcEpKT+wkhiIiCoCJKkQhCIEgEvvsQcaoVdffhM+fMOf///3v+5/c7h8S8lk64f0wkH7/9LZGnsUSczBBREkNESRaieM9JOg6fJzUJljckPGajhMfsF6dYjolTLMV16bZMxRbnW2KehUhSGSJKtBBlvptIM+2kJt5CRIkWIkljiCSVIWS1EHEyQ6SZtrdVBe5jomRLd126dVa6ybZYn+OAbJN9qS7dOidJYy6Iki3fS3gM5/8J+bMo0VJZm2pdaHjPiaZ9XrR+dg6tn59D26FetB06h9Z/nEPzvm4ot7lRl25drI43Vzd+4PrLM4WIkpjImkRmWJHnQktxD9o+70XLJz7o9nWD3uMFvdsLeo8Xug+7oS/23b/fg4b3XBClMNfFyUx8TeIjIWtfTSPv/iGeHHj7GyLnseniJGZGs8ODtkO9aP6oG9qdXdDs8EC3x4s+5SjujMzhIn0DTfu6odnhgXZnF5o+6kbboV5odnZBlMQEaxIsuQ+FJLy+mUS/toF88vb3f5Mlu+9od3XBcPActDu7oC70QF3kgbP0Mu5cD2LOv4DFhSXM+Rcwc3MebMUQ1EUeqAs90OwMz6N3e1GTYJkVJVooSSpDalNthFTEtJKKmNbfnonruKDaxsJwsAfq7R6oClmYjl7Arb5p3J25hz7lKFo/78XsrbswHu7DOekI5qdCmLg4A/OxfqgKWai3e2D4tAfKAjeq15sHqtebf3c6ro2QmnUMqY61HJJutMPwaQ80OzzQ7/dhqGMc94KLuO68jdbPzkFVwEJ/wIfQ3CLaDvVCVcDC8GkPrjITuBdcxBXzLbQU9zwIkmU4ULHW8GX869mEnI0z//5snHlcu6sLur1euMuHMHvrLvwDAZi/7odymxvKfBbKfBa6vd0Y892B/uMeKLexYfn3d9w/jTn/ArqEw9Dt9YL+uxfCGOPE/re+e5lUxXTmSVKt0B8It+P0aBCDhh+hKmShzHdDXchCs90D7Y4welfXg3PNdg80RR405ruhKmTRr72B6dEglNvcaD7gQ22aFeI4x1ZyJsokVuQ5odvrhSLPhduDAdiOD6D9n+H3Hxibx/RoEJPDs5geDWL6ehDTo0FMXZnF9PUgAmPzmPMvwHT0Asxf9cM/GIAizwXdXi8a8pw4E2WSEGGUyakqYKHZ4YFiSzjEXX4ZjVtdGD8/DQBYureMPuUoTEf6YDx8HqYjfeiVj+De3SUAgH8wgMb33bAfH8DtwQAUW1zQbPdAVcBCGGV0E+Fa41X1/QsNueEQtnwIDVtcaP/iPEL3ix8Ym8c16wSMh/swbBzH7PhdjDj8uDe/CNO/L0CR54KjZBC3BwNoyHVBVRDuNuFa4zUiXGu8odnugTLfDflmB/yDAbjKLkOR64Qi14mhjnGMspPQfdiNUddtLC8t46Z3Cvr9PlxlJjBi80OR60R9jhO245fgHwxAvtkBZb4bmnDIDVIZ2e5uzHdDuc0NWbYD/oFwSP1mB+Q5TqiLWCwE7sHyzUU05LkwPxWCusgD4+E+hIKLoHd7Ic9xQr7ZAdsPl+AfCECW7YAyn0XjB25URrazpJwyyGTZdqiLPJBussM/GIC9ZACybDtMR/qgL/bBW3MFMzeC0O31IjA2j+b9PkwOz6K3fgRNH3aj8z8XIM92gPn6IvwDAUg3hdeTZdtRTrU2kNPR7Xuqkzqh2d4FWZYdE/0z8ImvYkA/hsW7S3CfGoIs246pa3MYNPwI/2AAg/oxzIwGUZ/jhP34AELBRQx1jMNbdQUT/TOQZdmh2dGF6qROnI5p30fKI/R/rYhqDakKWNTnOnH7cgAAMMpOoqW4B9JMO2SZdpi/6sfy0jJCwUUAgO2HS5BtskOaaYd+vw8jdj+wDExemUV9rhPqAhanogyh8gjDm6SMal5zkqNrrctkoMxn4au9hqXQEi63/whlgRvSDBvqNtohzbBhxOEHANzsnoI0w/6A8gM3LjXdxPLSMnrlI1BtY1GbweDku7qW8gj9GlIWoScCLp1TEWuAqsADaYYN+mIfxnqmEJxcgE98FfU5TtSl29C0rxvzd0IwHOxB3UYbZFl2dFVdwZx/AePnp2E42ANppg3qQg8qYw3gc+iMk5SOkBMcNSnhqF8QcOgheY4Dii1OiHkMJKkMLN/0487IHKauzcF8rB+1G6zQ7e5C3QYrOo/2YXJoFjM3grD9cAkSHgMxj4EizwX5Zgf4HLr/BFfzqxNcDSF8Skv4lJac4GiOnEnogDKfhSQtHCJJZSDLssMnuYb5qRBueCZhPNKHEYcfd6dDOF9/HYocZ3gsj4EkjYEqn4Uwvh18jvZgKdVESqkmQkojmsOopj8JKN1teY4D8mwHxCnhJxPzGIhTGKiLWAybbmH+TgjXrBPQ7OqCmGeFhGeFOIWBKIVBfY4D8s0OCLj0mICiXxZQNBFQNCHlES0P8DnaY8L4djRudYcnJjEQJTMQr0j6OVFyeJyYx6DxfTdOr2sDn0N/sbKLUqqJkJW0+14RcOlxaZYdsk121CRYIEp8upoES7idN9kg4NLXS6mmlx4K4XO1DznB0Xx5el0bFHkuiJLCCzyNKNkCRZ4LlXGtEHDo4p8GPDaEz9W+JODSo9JMG6QZdpyNM6N63erOxpkhzbSjLsMKAVc3LKDoFwWUjvwUeTS1lGoiAg79SWVsKxS5TlSvt+BsbHixn4k1ozreAkWOExUxBgi4ur1lEXryqEdrsuJFAYcelqQzqNtgQ1VMJ6pif+5MTCfq0m0Qb2DA52gvlXBUL5SEv7uHkEe3toLP1e6uiDZAnuVA9TozqqI7w2ErojtRvd4MebYDp6INKOGoi0o4KvI4pDzSsIqW3/A52osingW1qVYIo4w4E2V6QBhlRG2qFSKeGXwufZ7P1f76MfUlfK72sYX/aacVnFrbAmmGHVWxnRBGGiGMMkIYaURVbCekGXaURelRRjVvPR3ZTioj2x6LnKR0T/IrPofuqUnuhIRnRWVkB05HdaAysgMSnhU1yZ3gc7TeEo76+RMcNVkNWe09rjjBUeeWR+lRt8EGYYwRp6hWCGOMqNtgQ3mUHgKKzlr5/62GPG0An9L+UsCl2eoEE0RJFpRTBoiSLDibYMJJSuesjjf/oibBTJ6EVMd3PlFNgplURBvSSyOaIE5hUBVngjiFQVlkM757pz7t23dk5GnIqUjDs3iOz9UyZ9Z1hL+b9SZ8/26Def3rWc+tfYVHol9Ne6KnFf4BPleTWBbZDFGSBWWRehznqBJ2v3mU7HzjMNn1xr+e6Ikt/Ig1AopuK4vQQ0DRrXyudk15RAs5FWF4qtV+K6uJE1DaUPj47PP+15DnBRRdeP/4zPP+OwCV955x/18hzAAAAABJRU5ErkJggg==';
  var iconDefRetImage = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAABSCAYAAAAWy4frAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAABHQSURBVHja3Jt7UFtXfseVbqbbyex22kmnM9vMtjvTaaadyc7+0W5may7IjimFQkTwgsExIdixF8cxsR2yJN7N5NFMM82j2ZgbwCyYh5BAgECgixAP85Cu0FtCYIOxwbyMDcbYYGOMeenbP67O0RUvEwcn9p6Z7z9X957z+5zfef7OkQSA5E9BW56U0aafKGT8L5UxphhltOlNhYz/TCHj/6CQ8WkKGb9bGWPapow2/bTxRNcPJI9Sulg/9oQy2vQrhYz/QhltGlTIeGxSk8poU65CxocpZPyT3xuAQsb/nULGf6mQ8SMrjVRGm1Cyqx1lCRaok2yoTLajfI8VqjgzlNGmtaBuKGR8njLa9I/fGYA8wviUQsZ/oJDxs2JjyhIsqElxouHdLpx5/+yGajzRhdpUN9SJtpVg88VR/BfyCONfPVSI4ij+1eIo/kpxFI/iKB4lu9qhPeQSjH/v7Co1/T5Q673DHXFDFWcGybc4ir+ukPFvbHk/Kgo3/rk8ks+XR/KQRwq1V33QicYTgQAN6Z2oO+6B7mgHuCNuaA+7AsQdcaM21Y26Yx1oSO9cBVeT4oQy2gRSjjyS15XGmn+8VaPQ0/JI3kAyVyfZqBFNvxeaSd1xz5qG30/cER/Uu100v4Z3u1C1zy6G6ZJHGP/+2/aHf5ZH8v3yCCPkEUbUpDhXAWgPudZV28c9GO+cxvULt8F/2rvhuyuBuCNuAUQoe0weyT//YBCR/M/kkfyEPMIIhYyH7mgHLUSf5oH2sAs1Kc41Vf/bTvQ1jGF5YRkkeZe9GDJeR+OJrnW/0x52oe64h5ZTd6xDaGoRRsgj+TvyCOPPv+nQ+iN5hLGTQOjTPGg80YXGE13QHe1A9UHnmqpJccFTPIy5qQWsl+bvLKJbPQruDfe6+dSmutHwrlBe/dudUMaYiGcGCkINT28K4oVnYp4oCjdqisKF5qQ7Kri8Ib0T2sOudQs3/+EiJi/OUIPnphdwUT+GxbkleJe96G8cx51r9+jv08OzsGX3r5uf9rALDemdaHhXaMLySB5F4UYUhRtbNjWBFoUbP/J9QOeFhvROaA+tDdH8/jmMWG5QA5eXvBhsm0D9b7ugfd2NxXtC82p8pwu6NzvQVz+OpXv+JjfmmULb/5xfG+aQH4Y74iYgkEcYv9wQoiDU8GxhmGGxMMyAymS7kEl6J7gjbmgOOAJUm+pGL3cVi3NL1KiJnlswfHIemtcc0LzmgP4tDzW65aNuaA44oTngRMuH3bjqmgqA728aR91bnlXlUM+kd6Iy2Y7CMAMKwwxLhWGGf9nIG1WFYQYoZDz9WHe0Y1XmrvwBzIzNUUNuj83BmTtAAdYE+bB71e9Wtg9TQ7M0n7s35tFZMozq3zhXVRqxRxljQmGYAUXhxtr1vBFUEGpAQahBaFLpndCneaDZ76DiP+3FRM9tWvDC7BJ6qkZRm+oOeI9If1wE8kG3/zcRjPZ1F7pKhjE37R8gbl66A8vJvoC86o57aD8ldhaEGl5YC8RSEGpAya521L/difq3O1GT4kTVPjv0aR4MGScAr3/0GbFMovHEWVTtd6yruuMe+n7Lh90bvqtP68RAyzV4l/2FjNpvoPGEMEFWH3RSu0pjzQTE/cIzMU+IIf6NUNamulH/ttCkqvbZ4fjjJdy7vUgzv9E3A/7TXlTts6+QY5W4N9wYNk3isvUG6t/uXOMd+yq1/nc3xrumaXmLc0twFw6iap+d2lab6hZ7ZZsY5JOCUAOdM/RpQqerTLZjiL9Oh1Nn3gCq9gvPK5PtqNoiVa4hC9uHOxPCcD1ivYHKZDs0BxzUPoWMR0GoAfk72z6nIPk72y7k72yDOtEGfZqw6CMZDrRcAwAMtk0Iz14Var/yVXugkrdG4orqqb4CABjir9NnuqMd0Kd5UJlsR/7ONuTvbOsj3nguf0cb8ne0oTbVDX2aBzUpTqiTbFAn2XCpWQAZaJugm6QR8ySmBu/g5kCgpga/mdb6fqxzGpoDDqiTbDhfI4AMGieoPTUpTujTPKhNdYPYXRBqeE5yentrWv6ONsgjedQd96DuuEf4KFEQARlsmxCevWKDLasfDyt1lY7Qss/7PDJomKDP1Ek2amdxFE9g0iWnt7dmnN7eitJYM+qOdUB3tMP/0Tog6ldsGD87HWCA1wtccd6ELasfFrYP9pxLcKyQPecSrF/3wfp1H4bbJ+Fd8gbkMTU8i8pk+8YgiTa6p1HFmXF6eytOb289JTm9vbUqT9qCsgQL6o4JG6INQXxq+t1ZLK8wZHnRiyH+OhrSOynwSumOdqC/aRxL88urvGH8tFd4L2ljELKPKUuwIE/aglxps1aSK22250lbBJcd6xD6xyZA1Ik29DeOAwCW5peFIdPrX3Jc1I9Bl+r3rvaQCz1VowFLmmtnp7Ewu0TnjIoV+a8HUpPiRN2xDqiTbMiTtiBP2uKS5ElbruZKm1G1z06X6BV7rVSXzvg6e+uE8CzRhoq9grSvu3Dv1iLgBborR9HyUTdu9N/xr4CnFuAuGIQ9+xJmxv0r31uX74L/rBfugkF4vUJF6NM8AeVW7LWip3qUgoifaw446DyXK21GrrR5TJIrbb6dK22GZr+DrqvK91ip+pv8IOV7rKh42Sdfph2Fg4JXFpaFYTvJBnfBIO7enF+9F5lZRFfpMF2ezM8IE+35mis033KiPVb0aEZpaxDbREA0+x0E5LYkV9rcnStthjrJRj1SlmCh6m8Sms9AyzWUJViEzEQFql+xYWpYWPhd7Ziiz7WHXbioH4PX19wGDRPQH/dQgwdaJ+hCUfOagxpPVJZgQU/VKK1EsU3VB53CoJRkIyA9klxpsy5X2gxVvGVTIAKMJaBQwyfnaa2bPr9An1cl22mfqDvmoc/PvHeOrqlsWf2rAIjuB6KKtxCQeklOSFNWTkgTlDEm1Ka6UZNyfxCxyn1gV5w3aftXJwmRRe0hFwVpSO+ixk703AIATF6cQcUeK8oTrGvmvR5ITYqwHVbIeOSENCEnpOmPkpyQpndyQppQGGYAd8QN7ogbZQkWqOIFkZHpUss1qOItKBNLlHndWx46pHbIh2iBYpCyBCvMJ/t8Ew/Q/ME5fx7xq9UtAiH2qOIt1M7CMANyQppwKqTxPUl2cH3IqZBG5IQ0CaGZwy6oE21QxZmhijP7QZqvCc92C9IedmHYdB3na67QgslwOX9nEdUHnaja76Ag+rc8qEi00YXgkPE6/a5DPoRRx03UHfdAtdtC1V05SlsDsadir9D/tIdcBAKnQhojJPII45OnQhqnT4U0CuP9YRc0BxyrQc4ImVUkWuEuHMS9W/6NUG1qB1S7Laja56CjVV/9OCr22igI97oLHsWwsDS/uwTusBtluy3QiGAX7y7hbPllVO2zQxVnxjn15VUgZPurTrQRiNniKP4vJBKJRJIdXK8+FdKI4iieBhnWAmn7uBvTI/6t6ezkPFynB6B+xe9Bsg5bXliG8X/PY256Ad4lL/jPejHv29d0qUZorZfvscL6dT9uX7lL850Zn4Pp8146/IpBalKEoERxFE9AOLqMzw6ufy07uB650mYa+SvfY0VprBl9DQLIwl3/jLy0sIxe7iqq9tlRGmtGaZwgVZwZZbvNNCw0PTKL+ZlFLM0v0735zNgcKhKt1DAidZINZ8tG6EwvLnOg5RpKY810ANEeciFX2ozs4HpkBesPUZCsYP0zWcF6b1awni4BKpMFI/t9MzsAeJeEaKHet91cT2fePxewLRan9i8vQBVrhmqdb2tT3ehrCFyLDRomUBprhma/gy6hsoL1yArWL58KafxpwJ49O7i+LpPRoTBMCD5UH3SiNNbfTgFg8d4SnHkDKI1tR8mv/SqlMlMNGa+vghjvmg54Z221w5xxkc76ANCrvYLSWDMNrRaEGpDJ6JDJ6GpWBR8yGV2k70dKXrFXGN8duZcCooRTQ7PgP+tFya72NVW6qx3aQ04sipqjd8krBA5WGr7LjFLfd60fd+N67+2AtZpHMYyKvVa6qaraZycQyGR0oatAsoPr/4xluEGW4ej5h2a/A8oYE5QxJqhfteG89gqWFwOjHPq3PCiJafdLBNRVOkLf7WscXxe89oh7lQf7G8dRfdBfPok+KmQ8WIZDJqPrWTdAlxGkfYdlOJwKaaQfknM/In2aB5etk/6OP7+MC7VXodnvCASKaUfFy1bMTs5jcW5pzd/ViTacq7iM+TuLASHUxt+dhULmL1MVb6H2ZAfXg2U4sAz3xrogX23T/A3LcPdYhoMqzozqg8LeXQxCZPikBzf6ZwKGYmfeAEp/3Q7lS35ZMvrQUTSEkpfaA2Rl+3D7qj9aeWv0Ltq/vACFzBRwqKqMNqEy2U77rA/i1smgmh9tGP9lGU7OMhzyd7YJzeuA4N61jphL48xw5Q8ETI6TF2fQ8sG5NeGV0SY0vNOJ8c7AuNVZ1QgqXrYKEC/ygnxllOxqp97IlTaDZThkBGlP3jcazzLcr3zUUCfaUH3QifI91g3PzDWvOYQlu2jrO9w+Ce4NFwWoPuDApTOBkcRBwwS4wy6fF3yVtQJEbIPPLm8mo/unTZ2RsAznYhkOhWEGGnvdzCUAfZoHV91TgbVdfhkd8qEAr02cv40mXz/YCEIZY6Ll5+9sIyD6TZ9YsQz3MvFKxV4rNPsd63ql+MVAKV7kYfqiF7dG766aR+5M3IMtqx/Kl9qheNEkkuh7Ud6k7LIEC4EAy3AvbBrENxSfZRkOBaEGGpdVyHjxWfiGKoszo1MxjNnJecxNLaCnahQVL1s3/b0yxkTLzd/RRvpGyzc+DM0I0saQWijfY0Vlsh2qeIv42HiVih9EPsNX5lWx118msSOT0QU90Mkuy3AO4hUSe1XI+A1h5JE8iv9r81rre2WMiZaXJ20hIHUPfM7OMtx/ktpQxVv8XvGduz8slSVY6KJV5I1//VaXBliG41mGQ/6ONhpIVsj4hwahkPG0HDJvsAxX9a2vcGQEaUOoV3z7BlW8hZ6wbrXI1aiSXe0EYjmT0T23JfdRWIZrYBkOJLSqTrKhOIrfcoh1vFGyZbeDMoK0vyReKY31e8V3VLxlIt5QRpsIxBLLcM9u6VUnluGqWYZDrrSZBpOLo3jxWd63UnEUT/PNCWkiIPlbfuksk9H9nGU4L8twwv7EFzLaKhBVvAXqRBvdb7AMt5AdXP+zh3KDjmW4EpbhkBPStKVeId6o2GsV7zeyHtpVQJbhnvW1WyhkPL1w6TuUfGCp4oQIiTySemPuq22aZx7qvcaMIO1psosksVx5hPGBIYqjeBq8Fnnjy4d+y5RluH9gGW6eZThhcZhg+VZeUcWZUZZgEXvjzlfbNH/7nVyZZRnua5bhkB1cLwS2E4RlCzku3qxoRcRbkBWsJyCffGd3f0+FNP6EZbi7LMNBHslDFScE13wnrJtS/o42GmUsCjcSiOmTQTV//Z3exM4I0n7GMhyygvUBBvkOJ++ronAj/S6T0ZH9xvvf+ZXyk0E1T2cEaW+zDEeNKtnVjtPbW+8LQc71yTzk88ZkrrT5x5LvI7EM9xHxCjFsM14RgxNvsAyX/r1d9M9kdH/JMtwNsvkixvkO8ddUnrQFJbva6Ujngxj7apvmqe/1bxckOpnJ6IS4b6zglfVAisKNKI1d5Y03v/f/j3y1TfMUy3DjZPNF4rm50mZyUEmVK22mv5OAAstwIyeDan74SPwZhmW4N4lXlDHCf0fIQaVYReFGlOxqhzLaJPbGbx6Zf/WcDKr5IctwI2KvKKNN4sNK5IQ00T/InN7eSiAuySOMT0oepcQy3EHiFRKzLQwzUJDCMOHip2iZDpbhkiSPWpJHGJ9kGa6PbInJP3VIsyLRdVF45/z//bv6B5JHMbEMt5fUdnEUTy9QkoufxVF+b2QEaXdLHtXkC7WeI1vilXFiUUDBE3Bf9xH1yi5S6+RvTCQ6KeobMsnjkFiGc670isgbNsnjkk4G1YST2icxK1Hf+A/J45RYhjORQIUovGOQPG6JZTipqE8Qb4RIHsfEMlyjCKRB8rgmluGeF4E8L3mcE8twNSzD1Uge98Qy3C9YhvvFwy7n/wcA9Id9o31Mi8EAAAAASUVORK5CYII=';
  L.Icon.Default = L.Icon.extend({options: {
    iconUrl: iconDefImage,
    iconRetinaUrl: iconDefRetImage,
    iconSize: new L.Point(25, 41),
    iconAnchor: new L.Point(12, 41),
    popupAnchor: new L.Point(1, -34),
  }});
  window.extractFromStock();
  window.setupIdle();
  window.setupTaphold();
  window.setupStyles();
  window.setupDialogs();
  window.setupDataTileParams();
  window.setupMap();
  window.setupOMS();
  window.search.setup();
  window.setupRedeem();
  window.setupLargeImagePreview();
  window.setupSidebarToggle();
  window.updateGameScore();
  window.artifact.setup();
  window.ornaments.setup();
  window.setupPlayerStat();
  window.setupTooltips();
  window.chat.setup();
  window.portalDetail.setup();
  window.setupQRLoadLib();
  window.setupLayerChooserSelectOne();
  window.setupLayerChooserStatusRecorder();
  // read here ONCE, so the URL is only evaluated one time after the
  // necessary data has been loaded.
  urlPortalLL = getURLParam('pll');
  if(urlPortalLL) {
    urlPortalLL = urlPortalLL.split(",");
    urlPortalLL = [parseFloat(urlPortalLL[0]) || 0.0, parseFloat(urlPortalLL[1]) || 0.0];
  }
  urlPortal = getURLParam('pguid');
  $('#sidebar').show();
  if(window.bootPlugins) {
    // check to see if a known 'bad' plugin is installed. If so, alert the user, and don't boot any plugins
    var badPlugins = {
      'arc': 'Contains hidden code to report private data to a 3rd party server:
<a href="https://plus.google.com/105383756361375410867/posts/4b2EjP3Du42">
details here
</a>
',
    };
    // remove entries from badPlugins which are not installed
    $.each(badPlugins, function(name,desc) {
      if (!(window.plugin && window.plugin[name])) {
        // not detected: delete from the list
        delete badPlugins[name];
      }
    });
    // if any entries remain in the list, report this to the user and don't boot ANY plugins
    // (why not any? it's tricky to know which of the plugin boot entries were safe/unsafe)
    if (Object.keys(badPlugins).length >
 0) {
      var warning = 'One or more known unsafe plugins were detected. For your safety, IITC has disabled all plugins.
<ul>
';
      $.each(badPlugins,function(name,desc) {
        warning += '
<li>
<b>
'+name+'
</b>
: '+desc+'
</li>
';
      });
      warning += '
</ul>
<p>
Please uninstall the problem plugins and reload the page. See this
<a href="http://iitc.jonatkins.com/?page=faq#uninstall">
FAQ entry
</a>
 for help.
</p>
<p>
<i>
Note: It is tricky for IITC to safely disable just problem plugins
</i>
</p>
';
      dialog({
        title: 'Plugin Warning',
        html: warning,
        width: 400
      });
    } else {
      // no known unsafe plugins detected - boot all plugins
      $.each(window.bootPlugins, function(ind, ref) {
        try {
          ref();
        } catch(err) {
          console.error("error starting plugin: index "+ind+", error: "+err);
          debugger;
        }
      });
    }
  }
  window.setMapBaseLayer();
  window.setupLayerChooserApi();
  window.runOnSmartphonesAfterBoot();
  // workaround for #129. Not sure why this is required.
  // setTimeout('window.map.invalidateSize(false);', 500);
  window.iitcLoaded = true;
  window.runHooks('iitcLoaded');
  if (typeof android !== 'undefined' && android && android.bootFinished) {
    android.bootFinished();
  }
}
/* Copyright (c) 2010 Chris O'Hara
<cohara87@gmail.com>
. MIT Licensed */
//Include the chain.js microframework (http://github.com/chriso/chain.js)
(function(a){a=a||{};var b={},c,d;c=function(a,d,e){var f=a.halt=!1;a.error=function(a){throw a},a.next=function(c){c&&(f=!1);if(!a.halt&&d&&d.length){var e=d.shift(),g=e.shift();f=!0;try{b[g].apply(a,[e,e.length,g])}catch(h){a.error(h)}}return a};for(var g in b){if(typeof a[g]==="function")continue;(function(e){a[e]=function(){var g=Array.prototype.slice.call(arguments);if(e==="onError"){if(d){b.onError.apply(a,[g,g.length]);return a}var h={};b.onError.apply(h,[g,g.length]);return c(h,null,"onError")}g.unshift(e);if(!d)return c({},[g],e);a.then=a[e],d.push(g);return f?a:a.next()}})(g)}e&&(a.then=a[e]),a.call=function(b,c){c.unshift(b),d.unshift(c),a.next(!0)};return a.next()},d=a.addMethod=function(d){var e=Array.prototype.slice.call(arguments),f=e.pop();for(var g=0,h=e.length;g
<h;g++)typeof e[g]==="string"&&(b[e[g]]=f);--h||(b["then"+d.substr(0,1).toUpperCase()+d.substr(1)]=f),c(a)},d("chain",function(a){var b=this,c=function(){if(!b.halt){if(!a.length)return b.next(!0);try{null!=a.shift().call(b,c,b.error)&&c()}catch(d){b.error(d)}}};c()}),d("run",function(a,b){var c=this,d=function(){c.halt||--b||c.next(!0)},e=function(a){c.error(a)};for(var f=0,g=b;!c.halt&&f
<g;f++)null!=a[f].call(c,d,e)&&d()}),d("defer",function(a){var b=this;setTimeout(function(){b.next(!0)},a.shift())}),d("onError",function(a,b){var c=this;this.error=function(d){c.halt=!0;for(var e=0;e
<b;e++)a[e].call(c,d)}})})(this);
var head = document.getElementsByTagName('head')[0] || document.documentElement;
addMethod('load', function (args, argc) {
    for (var queue = [], i = 0; i
< argc; i++) {
        (function (i) {
            queue.push(asyncLoadScript(args[i]));
        }(i));
    }
    this.call('run', queue);
});
function asyncLoadScript(src) {
    return function (onload, onerror) {
        var script = document.createElement('script');
        script.type = 'text/javascript';
        script.src = src;
        script.onload = onload;
        script.onerror = onerror;
        script.onreadystatechange = function () {
            var state = this.readyState;
            if (state === 'loaded' || state === 'complete') {
                script.onreadystatechange = null;
                onload();
            }
        };
        head.insertBefore(script, head.firstChild);
    }
}
try { console.log('Loading included JS now'); } catch(e) {}
/*
 Leaflet, a JavaScript library for mobile-friendly interactive maps. http://leafletjs.com
 (c) 2010-2013, Vladimir Agafonkin
 (c) 2010-2011, CloudMade
*/
(function (window, document, undefined) {
var oldL = window.L,
    L = {};
L.version = '0.7.3';
// define Leaflet for Node module pattern loaders, including Browserify
if (typeof module === 'object' && typeof module.exports === 'object') {
    module.exports = L;
// define Leaflet as an AMD module
} else if (typeof define === 'function' && define.amd) {
    define(L);
}
// define Leaflet as a global L variable, saving the original L to restore later if needed
L.noConflict = function () {
    window.L = oldL;
    return this;
};
window.L = L;
/*
 * L.Util contains various utility functions used throughout Leaflet code.
 */
L.Util = {
    extend: function (dest) { // (Object[, Object, ...]) ->
        var sources = Array.prototype.slice.call(arguments, 1),
            i, j, len, src;
        for (j = 0, len = sources.length; j
< len; j++) {
            src = sources[j] || {};
            for (i in src) {
                if (src.hasOwnProperty(i)) {
                    dest[i] = src[i];
                }
            }
        }
        return dest;
    },
    bind: function (fn, obj) { // (Function, Object) ->
 Function
        var args = arguments.length >
 2 ? Array.prototype.slice.call(arguments, 2) : null;
        return function () {
            return fn.apply(obj, args || arguments);
        };
    },
    stamp: (function () {
        var lastId = 0,
            key = '_leaflet_id';
        return function (obj) {
            obj[key] = obj[key] || ++lastId;
            return obj[key];
        };
    }()),
    invokeEach: function (obj, method, context) {
        var i, args;
        if (typeof obj === 'object') {
            args = Array.prototype.slice.call(arguments, 3);
            for (i in obj) {
                method.apply(context, [i, obj[i]].concat(args));
            }
            return true;
        }
        return false;
    },
    limitExecByInterval: function (fn, time, context) {
        var lock, execOnUnlock;
        return function wrapperFn() {
            var args = arguments;
            if (lock) {
                execOnUnlock = true;
                return;
            }
            lock = true;
            setTimeout(function () {
                lock = false;
                if (execOnUnlock) {
                    wrapperFn.apply(context, args);
                    execOnUnlock = false;
                }
            }, time);
            fn.apply(context, args);
        };
    },
    falseFn: function () {
        return false;
    },
    formatNum: function (num, digits) {
        var pow = Math.pow(10, digits || 5);
        return Math.round(num * pow) / pow;
    },
    trim: function (str) {
        return str.trim ? str.trim() : str.replace(/^\s+|\s+$/g, '');
    },
    splitWords: function (str) {
        return L.Util.trim(str).split(/\s+/);
    },
    setOptions: function (obj, options) {
        obj.options = L.extend({}, obj.options, options);
        return obj.options;
    },
    getParamString: function (obj, existingUrl, uppercase) {
        var params = [];
        for (var i in obj) {
            params.push(encodeURIComponent(uppercase ? i.toUpperCase() : i) + '=' + encodeURIComponent(obj[i]));
        }
        return ((!existingUrl || existingUrl.indexOf('?') === -1) ? '?' : '&') + params.join('&');
    },
    template: function (str, data) {
        return str.replace(/\{ *([\w_]+) *\}/g, function (str, key) {
            var value = data[key];
            if (value === undefined) {
                throw new Error('No value provided for variable ' + str);
            } else if (typeof value === 'function') {
                value = value(data);
            }
            return value;
        });
    },
    isArray: Array.isArray || function (obj) {
        return (Object.prototype.toString.call(obj) === '[object Array]');
    },
    emptyImageUrl: 'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs='
};
(function () {
    // inspired by http://paulirish.com/2011/requestanimationframe-for-smart-animating/
    function getPrefixed(name) {
        var i, fn,
            prefixes = ['webkit', 'moz', 'o', 'ms'];
        for (i = 0; i
< prefixes.length && !fn; i++) {
            fn = window[prefixes[i] + name];
        }
        return fn;
    }
    var lastTime = 0;
    function timeoutDefer(fn) {
        var time = +new Date(),
            timeToCall = Math.max(0, 16 - (time - lastTime));
        lastTime = time + timeToCall;
        return window.setTimeout(fn, timeToCall);
    }
    var requestFn = window.requestAnimationFrame ||
            getPrefixed('RequestAnimationFrame') || timeoutDefer;
    var cancelFn = window.cancelAnimationFrame ||
            getPrefixed('CancelAnimationFrame') ||
            getPrefixed('CancelRequestAnimationFrame') ||
            function (id) { window.clearTimeout(id); };
    L.Util.requestAnimFrame = function (fn, context, immediate, element) {
        fn = L.bind(fn, context);
        if (immediate && requestFn === timeoutDefer) {
            fn();
        } else {
            return requestFn.call(window, fn, element);
        }
    };
    L.Util.cancelAnimFrame = function (id) {
        if (id) {
            cancelFn.call(window, id);
        }
    };
}());
// shortcuts for most used utility functions
L.extend = L.Util.extend;
L.bind = L.Util.bind;
L.stamp = L.Util.stamp;
L.setOptions = L.Util.setOptions;
/*
 * L.Class powers the OOP facilities of the library.
 * Thanks to John Resig and Dean Edwards for inspiration!
 */
L.Class = function () {};
L.Class.extend = function (props) {
    // extended class with the new prototype
    var NewClass = function () {
        // call the constructor
        if (this.initialize) {
            this.initialize.apply(this, arguments);
        }
        // call all constructor hooks
        if (this._initHooks) {
            this.callInitHooks();
        }
    };
    // instantiate class without calling constructor
    var F = function () {};
    F.prototype = this.prototype;
    var proto = new F();
    proto.constructor = NewClass;
    NewClass.prototype = proto;
    //inherit parent's statics
    for (var i in this) {
        if (this.hasOwnProperty(i) && i !== 'prototype') {
            NewClass[i] = this[i];
        }
    }
    // mix static properties into the class
    if (props.statics) {
        L.extend(NewClass, props.statics);
        delete props.statics;
    }
    // mix includes into the prototype
    if (props.includes) {
        L.Util.extend.apply(null, [proto].concat(props.includes));
        delete props.includes;
    }
    // merge options
    if (props.options && proto.options) {
        props.options = L.extend({}, proto.options, props.options);
    }
    // mix given properties into the prototype
    L.extend(proto, props);
    proto._initHooks = [];
    var parent = this;
    // jshint camelcase: false
    NewClass.__super__ = parent.prototype;
    // add method for calling all hooks
    proto.callInitHooks = function () {
        if (this._initHooksCalled) { return; }
        if (parent.prototype.callInitHooks) {
            parent.prototype.callInitHooks.call(this);
        }
        this._initHooksCalled = true;
        for (var i = 0, len = proto._initHooks.length; i
< len; i++) {
            proto._initHooks[i].call(this);
        }
    };
    return NewClass;
};
// method for adding properties to prototype
L.Class.include = function (props) {
    L.extend(this.prototype, props);
};
// merge new default options to the Class
L.Class.mergeOptions = function (options) {
    L.extend(this.prototype.options, options);
};
// add a constructor hook
L.Class.addInitHook = function (fn) { // (Function) || (String, args...)
    var args = Array.prototype.slice.call(arguments, 1);
    var init = typeof fn === 'function' ? fn : function () {
        this[fn].apply(this, args);
    };
    this.prototype._initHooks = this.prototype._initHooks || [];
    this.prototype._initHooks.push(init);
};
/*
 * L.Mixin.Events is used to add custom events functionality to Leaflet classes.
 */
var eventsKey = '_leaflet_events';
L.Mixin = {};
L.Mixin.Events = {
    addEventListener: function (types, fn, context) { // (String, Function[, Object]) or (Object[, Object])
        // types can be a map of types/handlers
        if (L.Util.invokeEach(types, this.addEventListener, this, fn, context)) { return this; }
        var events = this[eventsKey] = this[eventsKey] || {},
            contextId = context && context !== this && L.stamp(context),
            i, len, event, type, indexKey, indexLenKey, typeIndex;
        // types can be a string of space-separated words
        types = L.Util.splitWords(types);
        for (i = 0, len = types.length; i
< len; i++) {
            event = {
                action: fn,
                context: context || this
            };
            type = types[i];
            if (contextId) {
                // store listeners of a particular context in a separate hash (if it has an id)
                // gives a major performance boost when removing thousands of map layers
                indexKey = type + '_idx';
                indexLenKey = indexKey + '_len';
                typeIndex = events[indexKey] = events[indexKey] || {};
                if (!typeIndex[contextId]) {
                    typeIndex[contextId] = [];
                    // keep track of the number of keys in the index to quickly check if it's empty
                    events[indexLenKey] = (events[indexLenKey] || 0) + 1;
                }
                typeIndex[contextId].push(event);
            } else {
                events[type] = events[type] || [];
                events[type].push(event);
            }
        }
        return this;
    },
    hasEventListeners: function (type) { // (String) ->
 Boolean
        var events = this[eventsKey];
        return !!events && ((type in events && events[type].length >
 0) ||
                            (type + '_idx' in events && events[type + '_idx_len'] >
 0));
    },
    removeEventListener: function (types, fn, context) { // ([String, Function, Object]) or (Object[, Object])
        if (!this[eventsKey]) {
            return this;
        }
        if (!types) {
            return this.clearAllEventListeners();
        }
        if (L.Util.invokeEach(types, this.removeEventListener, this, fn, context)) { return this; }
        var events = this[eventsKey],
            contextId = context && context !== this && L.stamp(context),
            i, len, type, listeners, j, indexKey, indexLenKey, typeIndex, removed;
        types = L.Util.splitWords(types);
        for (i = 0, len = types.length; i
< len; i++) {
            type = types[i];
            indexKey = type + '_idx';
            indexLenKey = indexKey + '_len';
            typeIndex = events[indexKey];
            if (!fn) {
                // clear all listeners for a type if function isn't specified
                delete events[type];
                delete events[indexKey];
                delete events[indexLenKey];
            } else {
                listeners = contextId && typeIndex ? typeIndex[contextId] : events[type];
                if (listeners) {
                    for (j = listeners.length - 1; j >
= 0; j--) {
                        if ((listeners[j].action === fn) && (!context || (listeners[j].context === context))) {
                            removed = listeners.splice(j, 1);
                            // set the old action to a no-op, because it is possible
                            // that the listener is being iterated over as part of a dispatch
                            removed[0].action = L.Util.falseFn;
                        }
                    }
                    if (context && typeIndex && (listeners.length === 0)) {
                        delete typeIndex[contextId];
                        events[indexLenKey]--;
                    }
                }
            }
        }
        return this;
    },
    clearAllEventListeners: function () {
        delete this[eventsKey];
        return this;
    },
    fireEvent: function (type, data) { // (String[, Object])
        if (!this.hasEventListeners(type)) {
            return this;
        }
        var event = L.Util.extend({}, data, { type: type, target: this });
        var events = this[eventsKey],
            listeners, i, len, typeIndex, contextId;
        if (events[type]) {
            // make sure adding/removing listeners inside other listeners won't cause infinite loop
            listeners = events[type].slice();
            for (i = 0, len = listeners.length; i
< len; i++) {
                listeners[i].action.call(listeners[i].context, event);
            }
        }
        // fire event for the context-indexed listeners as well
        typeIndex = events[type + '_idx'];
        for (contextId in typeIndex) {
            listeners = typeIndex[contextId].slice();
            if (listeners) {
                for (i = 0, len = listeners.length; i
< len; i++) {
                    listeners[i].action.call(listeners[i].context, event);
                }
            }
        }
        return this;
    },
    addOneTimeEventListener: function (types, fn, context) {
        if (L.Util.invokeEach(types, this.addOneTimeEventListener, this, fn, context)) { return this; }
        var handler = L.bind(function () {
            this
                .removeEventListener(types, fn, context)
                .removeEventListener(types, handler, context);
        }, this);
        return this
            .addEventListener(types, fn, context)
            .addEventListener(types, handler, context);
    }
};
L.Mixin.Events.on = L.Mixin.Events.addEventListener;
L.Mixin.Events.off = L.Mixin.Events.removeEventListener;
L.Mixin.Events.once = L.Mixin.Events.addOneTimeEventListener;
L.Mixin.Events.fire = L.Mixin.Events.fireEvent;
/*
 * L.Browser handles different browser and feature detections for internal Leaflet use.
 */
(function () {
    var ie = 'ActiveXObject' in window,
        ielt9 = ie && !document.addEventListener,
        // terrible browser detection to work around Safari / iOS / Android browser bugs
        ua = navigator.userAgent.toLowerCase(),
        webkit = ua.indexOf('webkit') !== -1,
        chrome = ua.indexOf('chrome') !== -1,
        phantomjs = ua.indexOf('phantom') !== -1,
        android = ua.indexOf('android') !== -1,
        android23 = ua.search('android [23]') !== -1,
        gecko = ua.indexOf('gecko') !== -1,
        mobile = typeof orientation !== undefined + '',
        msPointer = window.navigator && window.navigator.msPointerEnabled &&
                  window.navigator.msMaxTouchPoints && !window.PointerEvent,
        pointer = (window.PointerEvent && window.navigator.pointerEnabled && window.navigator.maxTouchPoints) ||
                  msPointer,
        retina = ('devicePixelRatio' in window && window.devicePixelRatio >
 1) ||
                 ('matchMedia' in window && window.matchMedia('(min-resolution:144dpi)') &&
                  window.matchMedia('(min-resolution:144dpi)').matches),
        doc = document.documentElement,
        ie3d = ie && ('transition' in doc.style),
        webkit3d = ('WebKitCSSMatrix' in window) && ('m11' in new window.WebKitCSSMatrix()) && !android23,
        gecko3d = 'MozPerspective' in doc.style,
        opera3d = 'OTransition' in doc.style,
        any3d = !window.L_DISABLE_3D && (ie3d || webkit3d || gecko3d || opera3d) && !phantomjs;
    // PhantomJS has 'ontouchstart' in document.documentElement, but doesn't actually support touch.
    // https://github.com/Leaflet/Leaflet/pull/1434#issuecomment-13843151
    var touch = !window.L_NO_TOUCH && !phantomjs && (function () {
        var startName = 'ontouchstart';
        // IE10+ (We simulate these into touch* events in L.DomEvent and L.DomEvent.Pointer) or WebKit, etc.
        if (pointer || (startName in doc)) {
            return true;
        }
        // Firefox/Gecko
        var div = document.createElement('div'),
            supported = false;
        if (!div.setAttribute) {
            return false;
        }
        div.setAttribute(startName, 'return;');
        if (typeof div[startName] === 'function') {
            supported = true;
        }
        div.removeAttribute(startName);
        div = null;
        return supported;
    }());
    L.Browser = {
        ie: ie,
        ielt9: ielt9,
        webkit: webkit,
        gecko: gecko && !webkit && !window.opera && !ie,
        android: android,
        android23: android23,
        chrome: chrome,
        ie3d: ie3d,
        webkit3d: webkit3d,
        gecko3d: gecko3d,
        opera3d: opera3d,
        any3d: any3d,
        mobile: mobile,
        mobileWebkit: mobile && webkit,
        mobileWebkit3d: mobile && webkit3d,
        mobileOpera: mobile && window.opera,
        touch: touch,
        msPointer: msPointer,
        pointer: pointer,
        retina: retina
    };
}());
/*
 * L.Point represents a point with x and y coordinates.
 */
L.Point = function (/*Number*/ x, /*Number*/ y, /*Boolean*/ round) {
    this.x = (round ? Math.round(x) : x);
    this.y = (round ? Math.round(y) : y);
};
L.Point.prototype = {
    clone: function () {
        return new L.Point(this.x, this.y);
    },
    // non-destructive, returns a new point
    add: function (point) {
        return this.clone()._add(L.point(point));
    },
    // destructive, used directly for performance in situations where it's safe to modify existing point
    _add: function (point) {
        this.x += point.x;
        this.y += point.y;
        return this;
    },
    subtract: function (point) {
        return this.clone()._subtract(L.point(point));
    },
    _subtract: function (point) {
        this.x -= point.x;
        this.y -= point.y;
        return this;
    },
    divideBy: function (num) {
        return this.clone()._divideBy(num);
    },
    _divideBy: function (num) {
        this.x /= num;
        this.y /= num;
        return this;
    },
    multiplyBy: function (num) {
        return this.clone()._multiplyBy(num);
    },
    _multiplyBy: function (num) {
        this.x *= num;
        this.y *= num;
        return this;
    },
    round: function () {
        return this.clone()._round();
    },
    _round: function () {
        this.x = Math.round(this.x);
        this.y = Math.round(this.y);
        return this;
    },
    floor: function () {
        return this.clone()._floor();
    },
    _floor: function () {
        this.x = Math.floor(this.x);
        this.y = Math.floor(this.y);
        return this;
    },
    distanceTo: function (point) {
        point = L.point(point);
        var x = point.x - this.x,
            y = point.y - this.y;
        return Math.sqrt(x * x + y * y);
    },
    equals: function (point) {
        point = L.point(point);
        return point.x === this.x &&
               point.y === this.y;
    },
    contains: function (point) {
        point = L.point(point);
        return Math.abs(point.x)
<= Math.abs(this.x) &&
               Math.abs(point.y)
<= Math.abs(this.y);
    },
    toString: function () {
        return 'Point(' +
                L.Util.formatNum(this.x) + ', ' +
                L.Util.formatNum(this.y) + ')';
    }
};
L.point = function (x, y, round) {
    if (x instanceof L.Point) {
        return x;
    }
    if (L.Util.isArray(x)) {
        return new L.Point(x[0], x[1]);
    }
    if (x === undefined || x === null) {
        return x;
    }
    return new L.Point(x, y, round);
};
/*
 * L.Bounds represents a rectangular area on the screen in pixel coordinates.
 */
L.Bounds = function (a, b) { //(Point, Point) or Point[]
    if (!a) { return; }
    var points = b ? [a, b] : a;
    for (var i = 0, len = points.length; i
< len; i++) {
        this.extend(points[i]);
    }
};
L.Bounds.prototype = {
    // extend the bounds to contain the given point
    extend: function (point) { // (Point)
        point = L.point(point);
        if (!this.min && !this.max) {
            this.min = point.clone();
            this.max = point.clone();
        } else {
            this.min.x = Math.min(point.x, this.min.x);
            this.max.x = Math.max(point.x, this.max.x);
            this.min.y = Math.min(point.y, this.min.y);
            this.max.y = Math.max(point.y, this.max.y);
        }
        return this;
    },
    getCenter: function (round) { // (Boolean) ->
 Point
        return new L.Point(
                (this.min.x + this.max.x) / 2,
                (this.min.y + this.max.y) / 2, round);
    },
    getBottomLeft: function () { // ->
 Point
        return new L.Point(this.min.x, this.max.y);
    },
    getTopRight: function () { // ->
 Point
        return new L.Point(this.max.x, this.min.y);
    },
    getSize: function () {
        return this.max.subtract(this.min);
    },
    contains: function (obj) { // (Bounds) or (Point) ->
 Boolean
        var min, max;
        if (typeof obj[0] === 'number' || obj instanceof L.Point) {
            obj = L.point(obj);
        } else {
            obj = L.bounds(obj);
        }
        if (obj instanceof L.Bounds) {
            min = obj.min;
            max = obj.max;
        } else {
            min = max = obj;
        }
        return (min.x >
= this.min.x) &&
               (max.x
<= this.max.x) &&
               (min.y >
= this.min.y) &&
               (max.y
<= this.max.y);
    },
    intersects: function (bounds) { // (Bounds) ->
 Boolean
        bounds = L.bounds(bounds);
        var min = this.min,
            max = this.max,
            min2 = bounds.min,
            max2 = bounds.max,
            xIntersects = (max2.x >
= min.x) && (min2.x
<= max.x),
            yIntersects = (max2.y >
= min.y) && (min2.y
<= max.y);
        return xIntersects && yIntersects;
    },
    isValid: function () {
        return !!(this.min && this.max);
    }
};
L.bounds = function (a, b) { // (Bounds) or (Point, Point) or (Point[])
    if (!a || a instanceof L.Bounds) {
        return a;
    }
    return new L.Bounds(a, b);
};
/*
 * L.Transformation is an utility class to perform simple point transformations through a 2d-matrix.
 */
L.Transformation = function (a, b, c, d) {
    this._a = a;
    this._b = b;
    this._c = c;
    this._d = d;
};
L.Transformation.prototype = {
    transform: function (point, scale) { // (Point, Number) ->
 Point
        return this._transform(point.clone(), scale);
    },
    // destructive transform (faster)
    _transform: function (point, scale) {
        scale = scale || 1;
        point.x = scale * (this._a * point.x + this._b);
        point.y = scale * (this._c * point.y + this._d);
        return point;
    },
    untransform: function (point, scale) {
        scale = scale || 1;
        return new L.Point(
                (point.x / scale - this._b) / this._a,
                (point.y / scale - this._d) / this._c);
    }
};
/*
 * L.DomUtil contains various utility functions for working with DOM.
 */
L.DomUtil = {
    get: function (id) {
        return (typeof id === 'string' ? document.getElementById(id) : id);
    },
    getStyle: function (el, style) {
        var value = el.style[style];
        if (!value && el.currentStyle) {
            value = el.currentStyle[style];
        }
        if ((!value || value === 'auto') && document.defaultView) {
            var css = document.defaultView.getComputedStyle(el, null);
            value = css ? css[style] : null;
        }
        return value === 'auto' ? null : value;
    },
    getViewportOffset: function (element) {
        var top = 0,
            left = 0,
            el = element,
            docBody = document.body,
            docEl = document.documentElement,
            pos;
        do {
            top  += el.offsetTop  || 0;
            left += el.offsetLeft || 0;
            //add borders
            top += parseInt(L.DomUtil.getStyle(el, 'borderTopWidth'), 10) || 0;
            left += parseInt(L.DomUtil.getStyle(el, 'borderLeftWidth'), 10) || 0;
            pos = L.DomUtil.getStyle(el, 'position');
            if (el.offsetParent === docBody && pos === 'absolute') { break; }
            if (pos === 'fixed') {
                top  += docBody.scrollTop  || docEl.scrollTop  || 0;
                left += docBody.scrollLeft || docEl.scrollLeft || 0;
                break;
            }
            if (pos === 'relative' && !el.offsetLeft) {
                var width = L.DomUtil.getStyle(el, 'width'),
                    maxWidth = L.DomUtil.getStyle(el, 'max-width'),
                    r = el.getBoundingClientRect();
                if (width !== 'none' || maxWidth !== 'none') {
                    left += r.left + el.clientLeft;
                }
                //calculate full y offset since we're breaking out of the loop
                top += r.top + (docBody.scrollTop  || docEl.scrollTop  || 0);
                break;
            }
            el = el.offsetParent;
        } while (el);
        el = element;
        do {
            if (el === docBody) { break; }
            top  -= el.scrollTop  || 0;
            left -= el.scrollLeft || 0;
            el = el.parentNode;
        } while (el);
        return new L.Point(left, top);
    },
    documentIsLtr: function () {
        if (!L.DomUtil._docIsLtrCached) {
            L.DomUtil._docIsLtrCached = true;
            L.DomUtil._docIsLtr = L.DomUtil.getStyle(document.body, 'direction') === 'ltr';
        }
        return L.DomUtil._docIsLtr;
    },
    create: function (tagName, className, container) {
        var el = document.createElement(tagName);
        el.className = className;
        if (container) {
            container.appendChild(el);
        }
        return el;
    },
    hasClass: function (el, name) {
        if (el.classList !== undefined) {
            return el.classList.contains(name);
        }
        var className = L.DomUtil._getClass(el);
        return className.length >
 0 && new RegExp('(^|\\s)' + name + '(\\s|$)').test(className);
    },
    addClass: function (el, name) {
        if (el.classList !== undefined) {
            var classes = L.Util.splitWords(name);
            for (var i = 0, len = classes.length; i
< len; i++) {
                el.classList.add(classes[i]);
            }
        } else if (!L.DomUtil.hasClass(el, name)) {
            var className = L.DomUtil._getClass(el);
            L.DomUtil._setClass(el, (className ? className + ' ' : '') + name);
        }
    },
    removeClass: function (el, name) {
        if (el.classList !== undefined) {
            el.classList.remove(name);
        } else {
            L.DomUtil._setClass(el, L.Util.trim((' ' + L.DomUtil._getClass(el) + ' ').replace(' ' + name + ' ', ' ')));
        }
    },
    _setClass: function (el, name) {
        if (el.className.baseVal === undefined) {
            el.className = name;
        } else {
            // in case of SVG element
            el.className.baseVal = name;
        }
    },
    _getClass: function (el) {
        return el.className.baseVal === undefined ? el.className : el.className.baseVal;
    },
    setOpacity: function (el, value) {
        if ('opacity' in el.style) {
            el.style.opacity = value;
        } else if ('filter' in el.style) {
            var filter = false,
                filterName = 'DXImageTransform.Microsoft.Alpha';
            // filters collection throws an error if we try to retrieve a filter that doesn't exist
            try {
                filter = el.filters.item(filterName);
            } catch (e) {
                // don't set opacity to 1 if we haven't already set an opacity,
                // it isn't needed and breaks transparent pngs.
                if (value === 1) { return; }
            }
            value = Math.round(value * 100);
            if (filter) {
                filter.Enabled = (value !== 100);
                filter.Opacity = value;
            } else {
                el.style.filter += ' progid:' + filterName + '(opacity=' + value + ')';
            }
        }
    },
    testProp: function (props) {
        var style = document.documentElement.style;
        for (var i = 0; i
< props.length; i++) {
            if (props[i] in style) {
                return props[i];
            }
        }
        return false;
    },
    getTranslateString: function (point) {
        // on WebKit browsers (Chrome/Safari/iOS Safari/Android) using translate3d instead of translate
        // makes animation smoother as it ensures HW accel is used. Firefox 13 doesn't care
        // (same speed either way), Opera 12 doesn't support translate3d
        var is3d = L.Browser.webkit3d,
            open = 'translate' + (is3d ? '3d' : '') + '(',
            close = (is3d ? ',0' : '') + ')';
        return open + point.x + 'px,' + point.y + 'px' + close;
    },
    getScaleString: function (scale, origin) {
        var preTranslateStr = L.DomUtil.getTranslateString(origin.add(origin.multiplyBy(-1 * scale))),
            scaleStr = ' scale(' + scale + ') ';
        return preTranslateStr + scaleStr;
    },
    setPosition: function (el, point, disable3D) { // (HTMLElement, Point[, Boolean])
        // jshint camelcase: false
        el._leaflet_pos = point;
        if (!disable3D && L.Browser.any3d) {
            el.style[L.DomUtil.TRANSFORM] =  L.DomUtil.getTranslateString(point);
        } else {
            el.style.left = point.x + 'px';
            el.style.top = point.y + 'px';
        }
    },
    getPosition: function (el) {
        // this method is only used for elements previously positioned using setPosition,
        // so it's safe to cache the position for performance
        // jshint camelcase: false
        return el._leaflet_pos;
    }
};
// prefix style property names
L.DomUtil.TRANSFORM = L.DomUtil.testProp(
        ['transform', 'WebkitTransform', 'OTransform', 'MozTransform', 'msTransform']);
// webkitTransition comes first because some browser versions that drop vendor prefix don't do
// the same for the transitionend event, in particular the Android 4.1 stock browser
L.DomUtil.TRANSITION = L.DomUtil.testProp(
        ['webkitTransition', 'transition', 'OTransition', 'MozTransition', 'msTransition']);
L.DomUtil.TRANSITION_END =
        L.DomUtil.TRANSITION === 'webkitTransition' || L.DomUtil.TRANSITION === 'OTransition' ?
        L.DomUtil.TRANSITION + 'End' : 'transitionend';
(function () {
    if ('onselectstart' in document) {
        L.extend(L.DomUtil, {
            disableTextSelection: function () {
                L.DomEvent.on(window, 'selectstart', L.DomEvent.preventDefault);
            },
            enableTextSelection: function () {
                L.DomEvent.off(window, 'selectstart', L.DomEvent.preventDefault);
            }
        });
    } else {
        var userSelectProperty = L.DomUtil.testProp(
            ['userSelect', 'WebkitUserSelect', 'OUserSelect', 'MozUserSelect', 'msUserSelect']);
        L.extend(L.DomUtil, {
            disableTextSelection: function () {
                if (userSelectProperty) {
                    var style = document.documentElement.style;
                    this._userSelect = style[userSelectProperty];
                    style[userSelectProperty] = 'none';
                }
            },
            enableTextSelection: function () {
                if (userSelectProperty) {
                    document.documentElement.style[userSelectProperty] = this._userSelect;
                    delete this._userSelect;
                }
            }
        });
    }
    L.extend(L.DomUtil, {
        disableImageDrag: function () {
            L.DomEvent.on(window, 'dragstart', L.DomEvent.preventDefault);
        },
        enableImageDrag: function () {
            L.DomEvent.off(window, 'dragstart', L.DomEvent.preventDefault);
        }
    });
})();
/*
 * L.LatLng represents a geographical point with latitude and longitude coordinates.
 */
L.LatLng = function (lat, lng, alt) { // (Number, Number, Number)
    lat = parseFloat(lat);
    lng = parseFloat(lng);
    if (isNaN(lat) || isNaN(lng)) {
        throw new Error('Invalid LatLng object: (' + lat + ', ' + lng + ')');
    }
    this.lat = lat;
    this.lng = lng;
    if (alt !== undefined) {
        this.alt = parseFloat(alt);
    }
};
L.extend(L.LatLng, {
    DEG_TO_RAD: Math.PI / 180,
    RAD_TO_DEG: 180 / Math.PI,
    MAX_MARGIN: 1.0E-9 // max margin of error for the "equals" check
});
L.LatLng.prototype = {
    equals: function (obj) { // (LatLng) ->
 Boolean
        if (!obj) { return false; }
        obj = L.latLng(obj);
        var margin = Math.max(
                Math.abs(this.lat - obj.lat),
                Math.abs(this.lng - obj.lng));
        return margin
<= L.LatLng.MAX_MARGIN;
    },
    toString: function (precision) { // (Number) ->
 String
        return 'LatLng(' +
                L.Util.formatNum(this.lat, precision) + ', ' +
                L.Util.formatNum(this.lng, precision) + ')';
    },
    // Haversine distance formula, see http://en.wikipedia.org/wiki/Haversine_formula
    // TODO move to projection code, LatLng shouldn't know about Earth
    distanceTo: function (other) { // (LatLng) ->
 Number
        other = L.latLng(other);
        var R = 6367000.0, // earth radius in meters
            d2r = L.LatLng.DEG_TO_RAD,
            dLat = (other.lat - this.lat) * d2r,
            dLon = (other.lng - this.lng) * d2r,
            lat1 = this.lat * d2r,
            lat2 = other.lat * d2r,
            sin1 = Math.sin(dLat / 2),
            sin2 = Math.sin(dLon / 2);
        var a = sin1 * sin1 + sin2 * sin2 * Math.cos(lat1) * Math.cos(lat2);
        return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
    },
    wrap: function (a, b) { // (Number, Number) ->
 LatLng
        var lng = this.lng;
        a = a || -180;
        b = b ||  180;
        lng = (lng + b) % (b - a) + (lng
< a || lng === b ? b : a);
        return new L.LatLng(this.lat, lng);
    }
};
L.latLng = function (a, b) { // (LatLng) or ([Number, Number]) or (Number, Number)
    if (a instanceof L.LatLng) {
        return a;
    }
    if (L.Util.isArray(a)) {
        if (typeof a[0] === 'number' || typeof a[0] === 'string') {
            return new L.LatLng(a[0], a[1], a[2]);
        } else {
            return null;
        }
    }
    if (a === undefined || a === null) {
        return a;
    }
    if (typeof a === 'object' && 'lat' in a) {
        return new L.LatLng(a.lat, 'lng' in a ? a.lng : a.lon);
    }
    if (b === undefined) {
        return null;
    }
    return new L.LatLng(a, b);
};
/*
 * L.LatLngBounds represents a rectangular area on the map in geographical coordinates.
 */
L.LatLngBounds = function (southWest, northEast) { // (LatLng, LatLng) or (LatLng[])
    if (!southWest) { return; }
    var latlngs = northEast ? [southWest, northEast] : southWest;
    for (var i = 0, len = latlngs.length; i
< len; i++) {
        this.extend(latlngs[i]);
    }
};
L.LatLngBounds.prototype = {
    // extend the bounds to contain the given point or bounds
    extend: function (obj) { // (LatLng) or (LatLngBounds)
        if (!obj) { return this; }
        var latLng = L.latLng(obj);
        if (latLng !== null) {
            obj = latLng;
        } else {
            obj = L.latLngBounds(obj);
        }
        if (obj instanceof L.LatLng) {
            if (!this._southWest && !this._northEast) {
                this._southWest = new L.LatLng(obj.lat, obj.lng);
                this._northEast = new L.LatLng(obj.lat, obj.lng);
            } else {
                this._southWest.lat = Math.min(obj.lat, this._southWest.lat);
                this._southWest.lng = Math.min(obj.lng, this._southWest.lng);
                this._northEast.lat = Math.max(obj.lat, this._northEast.lat);
                this._northEast.lng = Math.max(obj.lng, this._northEast.lng);
            }
        } else if (obj instanceof L.LatLngBounds) {
            this.extend(obj._southWest);
            this.extend(obj._northEast);
        }
        return this;
    },
    // extend the bounds by a percentage
    pad: function (bufferRatio) { // (Number) ->
 LatLngBounds
        var sw = this._southWest,
            ne = this._northEast,
            heightBuffer = Math.abs(sw.lat - ne.lat) * bufferRatio,
            widthBuffer = Math.abs(sw.lng - ne.lng) * bufferRatio;
        return new L.LatLngBounds(
                new L.LatLng(sw.lat - heightBuffer, sw.lng - widthBuffer),
                new L.LatLng(ne.lat + heightBuffer, ne.lng + widthBuffer));
    },
    getCenter: function () { // ->
 LatLng
        return new L.LatLng(
                (this._southWest.lat + this._northEast.lat) / 2,
                (this._southWest.lng + this._northEast.lng) / 2);
    },
    getSouthWest: function () {
        return this._southWest;
    },
    getNorthEast: function () {
        return this._northEast;
    },
    getNorthWest: function () {
        return new L.LatLng(this.getNorth(), this.getWest());
    },
    getSouthEast: function () {
        return new L.LatLng(this.getSouth(), this.getEast());
    },
    getWest: function () {
        return this._southWest.lng;
    },
    getSouth: function () {
        return this._southWest.lat;
    },
    getEast: function () {
        return this._northEast.lng;
    },
    getNorth: function () {
        return this._northEast.lat;
    },
    contains: function (obj) { // (LatLngBounds) or (LatLng) ->
 Boolean
        if (typeof obj[0] === 'number' || obj instanceof L.LatLng) {
            obj = L.latLng(obj);
        } else {
            obj = L.latLngBounds(obj);
        }
        var sw = this._southWest,
            ne = this._northEast,
            sw2, ne2;
        if (obj instanceof L.LatLngBounds) {
            sw2 = obj.getSouthWest();
            ne2 = obj.getNorthEast();
        } else {
            sw2 = ne2 = obj;
        }
        return (sw2.lat >
= sw.lat) && (ne2.lat
<= ne.lat) &&
               (sw2.lng >
= sw.lng) && (ne2.lng
<= ne.lng);
    },
    intersects: function (bounds) { // (LatLngBounds)
        bounds = L.latLngBounds(bounds);
        var sw = this._southWest,
            ne = this._northEast,
            sw2 = bounds.getSouthWest(),
            ne2 = bounds.getNorthEast(),
            latIntersects = (ne2.lat >
= sw.lat) && (sw2.lat
<= ne.lat),
            lngIntersects = (ne2.lng >
= sw.lng) && (sw2.lng
<= ne.lng);
        return latIntersects && lngIntersects;
    },
    toBBoxString: function () {
        return [this.getWest(), this.getSouth(), this.getEast(), this.getNorth()].join(',');
    },
    equals: function (bounds) { // (LatLngBounds)
        if (!bounds) { return false; }
        bounds = L.latLngBounds(bounds);
        return this._southWest.equals(bounds.getSouthWest()) &&
               this._northEast.equals(bounds.getNorthEast());
    },
    isValid: function () {
        return !!(this._southWest && this._northEast);
    }
};
//TODO International date line?
L.latLngBounds = function (a, b) { // (LatLngBounds) or (LatLng, LatLng)
    if (!a || a instanceof L.LatLngBounds) {
        return a;
    }
    return new L.LatLngBounds(a, b);
};
/*
 * L.Projection contains various geographical projections used by CRS classes.
 */
L.Projection = {};
/*
 * Spherical Mercator is the most popular map projection, used by EPSG:3857 CRS used by default.
 */
L.Projection.SphericalMercator = {
    MAX_LATITUDE: 85.0511287798,
    project: function (latlng) { // (LatLng) ->
 Point
        var d = L.LatLng.DEG_TO_RAD,
            max = this.MAX_LATITUDE,
            lat = Math.max(Math.min(max, latlng.lat), -max),
            x = latlng.lng * d,
            y = lat * d;
        y = Math.log(Math.tan((Math.PI / 4) + (y / 2)));
        return new L.Point(x, y);
    },
    unproject: function (point) { // (Point, Boolean) ->
 LatLng
        var d = L.LatLng.RAD_TO_DEG,
            lng = point.x * d,
            lat = (2 * Math.atan(Math.exp(point.y)) - (Math.PI / 2)) * d;
        return new L.LatLng(lat, lng);
    }
};
/*
 * Simple equirectangular (Plate Carree) projection, used by CRS like EPSG:4326 and Simple.
 */
L.Projection.LonLat = {
    project: function (latlng) {
        return new L.Point(latlng.lng, latlng.lat);
    },
    unproject: function (point) {
        return new L.LatLng(point.y, point.x);
    }
};
/*
 * L.CRS is a base object for all defined CRS (Coordinate Reference Systems) in Leaflet.
 */
L.CRS = {
    latLngToPoint: function (latlng, zoom) { // (LatLng, Number) ->
 Point
        var projectedPoint = this.projection.project(latlng),
            scale = this.scale(zoom);
        return this.transformation._transform(projectedPoint, scale);
    },
    pointToLatLng: function (point, zoom) { // (Point, Number[, Boolean]) ->
 LatLng
        var scale = this.scale(zoom),
            untransformedPoint = this.transformation.untransform(point, scale);
        return this.projection.unproject(untransformedPoint);
    },
    project: function (latlng) {
        return this.projection.project(latlng);
    },
    scale: function (zoom) {
        return 256 * Math.pow(2, zoom);
    },
    getSize: function (zoom) {
        var s = this.scale(zoom);
        return L.point(s, s);
    }
};
/*
 * A simple CRS that can be used for flat non-Earth maps like panoramas or game maps.
 */
L.CRS.Simple = L.extend({}, L.CRS, {
    projection: L.Projection.LonLat,
    transformation: new L.Transformation(1, 0, -1, 0),
    scale: function (zoom) {
        return Math.pow(2, zoom);
    }
});
/*
 * L.CRS.EPSG3857 (Spherical Mercator) is the most common CRS for web mapping
 * and is used by Leaflet by default.
 */
L.CRS.EPSG3857 = L.extend({}, L.CRS, {
    code: 'EPSG:3857',
    projection: L.Projection.SphericalMercator,
    transformation: new L.Transformation(0.5 / Math.PI, 0.5, -0.5 / Math.PI, 0.5),
    project: function (latlng) { // (LatLng) ->
 Point
        var projectedPoint = this.projection.project(latlng),
            earthRadius = 6367000.0;
        return projectedPoint.multiplyBy(earthRadius);
    }
});
L.CRS.EPSG900913 = L.extend({}, L.CRS.EPSG3857, {
    code: 'EPSG:900913'
});
/*
 * L.CRS.EPSG4326 is a CRS popular among advanced GIS specialists.
 */
L.CRS.EPSG4326 = L.extend({}, L.CRS, {
    code: 'EPSG:4326',
    projection: L.Projection.LonLat,
    transformation: new L.Transformation(1 / 360, 0.5, -1 / 360, 0.5)
});
/*
 * L.Map is the central class of the API - it is used to create a map.
 */
L.Map = L.Class.extend({
    includes: L.Mixin.Events,
    options: {
        crs: L.CRS.EPSG3857,
        /*
        center: LatLng,
        zoom: Number,
        layers: Array,
        */
        fadeAnimation: L.DomUtil.TRANSITION && !L.Browser.android23,
        trackResize: true,
        markerZoomAnimation: L.DomUtil.TRANSITION && L.Browser.any3d
    },
    initialize: function (id, options) { // (HTMLElement or String, Object)
        options = L.setOptions(this, options);
        this._initContainer(id);
        this._initLayout();
        // hack for https://github.com/Leaflet/Leaflet/issues/1980
        this._onResize = L.bind(this._onResize, this);
        this._initEvents();
        if (options.maxBounds) {
            this.setMaxBounds(options.maxBounds);
        }
        if (options.center && options.zoom !== undefined) {
            this.setView(L.latLng(options.center), options.zoom, {reset: true});
        }
        this._handlers = [];
        this._layers = {};
        this._zoomBoundLayers = {};
        this._tileLayersNum = 0;
        this.callInitHooks();
        this._addLayers(options.layers);
    },
    // public methods that modify map state
    // replaced by animation-powered implementation in Map.PanAnimation.js
    setView: function (center, zoom) {
        zoom = zoom === undefined ? this.getZoom() : zoom;
        this._resetView(L.latLng(center), this._limitZoom(zoom));
        return this;
    },
    setZoom: function (zoom, options) {
        if (!this._loaded) {
            this._zoom = this._limitZoom(zoom);
            return this;
        }
        return this.setView(this.getCenter(), zoom, {zoom: options});
    },
    zoomIn: function (delta, options) {
        return this.setZoom(this._zoom + (delta || 1), options);
    },
    zoomOut: function (delta, options) {
        return this.setZoom(this._zoom - (delta || 1), options);
    },
    setZoomAround: function (latlng, zoom, options) {
        var scale = this.getZoomScale(zoom),
            viewHalf = this.getSize().divideBy(2),
            containerPoint = latlng instanceof L.Point ? latlng : this.latLngToContainerPoint(latlng),
            centerOffset = containerPoint.subtract(viewHalf).multiplyBy(1 - 1 / scale),
            newCenter = this.containerPointToLatLng(viewHalf.add(centerOffset));
        return this.setView(newCenter, zoom, {zoom: options});
    },
    fitBounds: function (bounds, options) {
        options = options || {};
        bounds = bounds.getBounds ? bounds.getBounds() : L.latLngBounds(bounds);
        var paddingTL = L.point(options.paddingTopLeft || options.padding || [0, 0]),
            paddingBR = L.point(options.paddingBottomRight || options.padding || [0, 0]),
            zoom = this.getBoundsZoom(bounds, false, paddingTL.add(paddingBR)),
            paddingOffset = paddingBR.subtract(paddingTL).divideBy(2),
            swPoint = this.project(bounds.getSouthWest(), zoom),
            nePoint = this.project(bounds.getNorthEast(), zoom),
            center = this.unproject(swPoint.add(nePoint).divideBy(2).add(paddingOffset), zoom);
        zoom = options && options.maxZoom ? Math.min(options.maxZoom, zoom) : zoom;
        return this.setView(center, zoom, options);
    },
    fitWorld: function (options) {
        return this.fitBounds([[-90, -180], [90, 180]], options);
    },
    panTo: function (center, options) { // (LatLng)
        return this.setView(center, this._zoom, {pan: options});
    },
    panBy: function (offset) { // (Point)
        // replaced with animated panBy in Map.PanAnimation.js
        this.fire('movestart');
        this._rawPanBy(L.point(offset));
        this.fire('move');
        return this.fire('moveend');
    },
    setMaxBounds: function (bounds) {
        bounds = L.latLngBounds(bounds);
        this.options.maxBounds = bounds;
        if (!bounds) {
            return this.off('moveend', this._panInsideMaxBounds, this);
        }
        if (this._loaded) {
            this._panInsideMaxBounds();
        }
        return this.on('moveend', this._panInsideMaxBounds, this);
    },
    panInsideBounds: function (bounds, options) {
        var center = this.getCenter(),
            newCenter = this._limitCenter(center, this._zoom, bounds);
        if (center.equals(newCenter)) { return this; }
        return this.panTo(newCenter, options);
    },
    addLayer: function (layer) {
        // TODO method is too big, refactor
        var id = L.stamp(layer);
        if (this._layers[id]) { return this; }
        this._layers[id] = layer;
        // TODO getMaxZoom, getMinZoom in ILayer (instead of options)
        if (layer.options && (!isNaN(layer.options.maxZoom) || !isNaN(layer.options.minZoom))) {
            this._zoomBoundLayers[id] = layer;
            this._updateZoomLevels();
        }
        // TODO looks ugly, refactor!!!
        if (this.options.zoomAnimation && L.TileLayer && (layer instanceof L.TileLayer)) {
            this._tileLayersNum++;
            this._tileLayersToLoad++;
            layer.on('load', this._onTileLayerLoad, this);
        }
        if (this._loaded) {
            this._layerAdd(layer);
        }
        return this;
    },
    removeLayer: function (layer) {
        var id = L.stamp(layer);
        if (!this._layers[id]) { return this; }
        if (this._loaded) {
            layer.onRemove(this);
        }
        delete this._layers[id];
        if (this._loaded) {
            this.fire('layerremove', {layer: layer});
        }
        if (this._zoomBoundLayers[id]) {
            delete this._zoomBoundLayers[id];
            this._updateZoomLevels();
        }
        // TODO looks ugly, refactor
        if (this.options.zoomAnimation && L.TileLayer && (layer instanceof L.TileLayer)) {
            this._tileLayersNum--;
            this._tileLayersToLoad--;
            layer.off('load', this._onTileLayerLoad, this);
        }
        return this;
    },
    hasLayer: function (layer) {
        if (!layer) { return false; }
        return (L.stamp(layer) in this._layers);
    },
    eachLayer: function (method, context) {
        for (var i in this._layers) {
            method.call(context, this._layers[i]);
        }
        return this;
    },
    invalidateSize: function (options) {
        if (!this._loaded) { return this; }
        options = L.extend({
            animate: false,
            pan: true
        }, options === true ? {animate: true} : options);
        var oldSize = this.getSize();
        this._sizeChanged = true;
        this._initialCenter = null;
        var newSize = this.getSize(),
            oldCenter = oldSize.divideBy(2).round(),
            newCenter = newSize.divideBy(2).round(),
            offset = oldCenter.subtract(newCenter);
        if (!offset.x && !offset.y) { return this; }
        if (options.animate && options.pan) {
            this.panBy(offset);
        } else {
            if (options.pan) {
                this._rawPanBy(offset);
            }
            this.fire('move');
            if (options.debounceMoveend) {
                clearTimeout(this._sizeTimer);
                this._sizeTimer = setTimeout(L.bind(this.fire, this, 'moveend'), 200);
            } else {
                this.fire('moveend');
            }
        }
        return this.fire('resize', {
            oldSize: oldSize,
            newSize: newSize
        });
    },
    // TODO handler.addTo
    addHandler: function (name, HandlerClass) {
        if (!HandlerClass) { return this; }
        var handler = this[name] = new HandlerClass(this);
        this._handlers.push(handler);
        if (this.options[name]) {
            handler.enable();
        }
        return this;
    },
    remove: function () {
        if (this._loaded) {
            this.fire('unload');
        }
        this._initEvents('off');
        try {
            // throws error in IE6-8
            delete this._container._leaflet;
        } catch (e) {
            this._container._leaflet = undefined;
        }
        this._clearPanes();
        if (this._clearControlPos) {
            this._clearControlPos();
        }
        this._clearHandlers();
        return this;
    },
    // public methods for getting map state
    getCenter: function () { // (Boolean) ->
 LatLng
        this._checkIfLoaded();
        if (this._initialCenter && !this._moved()) {
            return this._initialCenter;
        }
        return this.layerPointToLatLng(this._getCenterLayerPoint());
    },
    getZoom: function () {
        return this._zoom;
    },
    getBounds: function () {
        var bounds = this.getPixelBounds(),
            sw = this.unproject(bounds.getBottomLeft()),
            ne = this.unproject(bounds.getTopRight());
        return new L.LatLngBounds(sw, ne);
    },
    getMinZoom: function () {
        return this.options.minZoom === undefined ?
            (this._layersMinZoom === undefined ? 0 : this._layersMinZoom) :
            this.options.minZoom;
    },
    getMaxZoom: function () {
        return this.options.maxZoom === undefined ?
            (this._layersMaxZoom === undefined ? Infinity : this._layersMaxZoom) :
            this.options.maxZoom;
    },
    getBoundsZoom: function (bounds, inside, padding) { // (LatLngBounds[, Boolean, Point]) ->
 Number
        bounds = L.latLngBounds(bounds);
        var zoom = this.getMinZoom() - (inside ? 1 : 0),
            maxZoom = this.getMaxZoom(),
            size = this.getSize(),
            nw = bounds.getNorthWest(),
            se = bounds.getSouthEast(),
            zoomNotFound = true,
            boundsSize;
        padding = L.point(padding || [0, 0]);
        do {
            zoom++;
            boundsSize = this.project(se, zoom).subtract(this.project(nw, zoom)).add(padding);
            zoomNotFound = !inside ? size.contains(boundsSize) : boundsSize.x
< size.x || boundsSize.y
< size.y;
        } while (zoomNotFound && zoom
<= maxZoom);
        if (zoomNotFound && inside) {
            return null;
        }
        return inside ? zoom : zoom - 1;
    },
    getSize: function () {
        if (!this._size || this._sizeChanged) {
            this._size = new L.Point(
                this._container.clientWidth,
                this._container.clientHeight);
            this._sizeChanged = false;
        }
        return this._size.clone();
    },
    getPixelBounds: function () {
        var topLeftPoint = this._getTopLeftPoint();
        return new L.Bounds(topLeftPoint, topLeftPoint.add(this.getSize()));
    },
    getPixelOrigin: function () {
        this._checkIfLoaded();
        return this._initialTopLeftPoint;
    },
    getPanes: function () {
        return this._panes;
    },
    getContainer: function () {
        return this._container;
    },
    // TODO replace with universal implementation after refactoring projections
    getZoomScale: function (toZoom) {
        var crs = this.options.crs;
        return crs.scale(toZoom) / crs.scale(this._zoom);
    },
    getScaleZoom: function (scale) {
        return this._zoom + (Math.log(scale) / Math.LN2);
    },
    // conversion methods
    project: function (latlng, zoom) { // (LatLng[, Number]) ->
 Point
        zoom = zoom === undefined ? this._zoom : zoom;
        return this.options.crs.latLngToPoint(L.latLng(latlng), zoom);
    },
    unproject: function (point, zoom) { // (Point[, Number]) ->
 LatLng
        zoom = zoom === undefined ? this._zoom : zoom;
        return this.options.crs.pointToLatLng(L.point(point), zoom);
    },
    layerPointToLatLng: function (point) { // (Point)
        var projectedPoint = L.point(point).add(this.getPixelOrigin());
        return this.unproject(projectedPoint);
    },
    latLngToLayerPoint: function (latlng) { // (LatLng)
        var projectedPoint = this.project(L.latLng(latlng))._round();
        return projectedPoint._subtract(this.getPixelOrigin());
    },
    containerPointToLayerPoint: function (point) { // (Point)
        return L.point(point).subtract(this._getMapPanePos());
    },
    layerPointToContainerPoint: function (point) { // (Point)
        return L.point(point).add(this._getMapPanePos());
    },
    containerPointToLatLng: function (point) {
        var layerPoint = this.containerPointToLayerPoint(L.point(point));
        return this.layerPointToLatLng(layerPoint);
    },
    latLngToContainerPoint: function (latlng) {
        return this.layerPointToContainerPoint(this.latLngToLayerPoint(L.latLng(latlng)));
    },
    mouseEventToContainerPoint: function (e) { // (MouseEvent)
        return L.DomEvent.getMousePosition(e, this._container);
    },
    mouseEventToLayerPoint: function (e) { // (MouseEvent)
        return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(e));
    },
    mouseEventToLatLng: function (e) { // (MouseEvent)
        return this.layerPointToLatLng(this.mouseEventToLayerPoint(e));
    },
    // map initialization methods
    _initContainer: function (id) {
        var container = this._container = L.DomUtil.get(id);
        if (!container) {
            throw new Error('Map container not found.');
        } else if (container._leaflet) {
            throw new Error('Map container is already initialized.');
        }
        container._leaflet = true;
    },
    _initLayout: function () {
        var container = this._container;
        L.DomUtil.addClass(container, 'leaflet-container' +
            (L.Browser.touch ? ' leaflet-touch' : '') +
            (L.Browser.retina ? ' leaflet-retina' : '') +
            (L.Browser.ielt9 ? ' leaflet-oldie' : '') +
            (this.options.fadeAnimation ? ' leaflet-fade-anim' : ''));
        var position = L.DomUtil.getStyle(container, 'position');
        if (position !== 'absolute' && position !== 'relative' && position !== 'fixed') {
            container.style.position = 'relative';
        }
        this._initPanes();
        if (this._initControlPos) {
            this._initControlPos();
        }
    },
    _initPanes: function () {
        var panes = this._panes = {};
        this._mapPane = panes.mapPane = this._createPane('leaflet-map-pane', this._container);
        this._tilePane = panes.tilePane = this._createPane('leaflet-tile-pane', this._mapPane);
        panes.objectsPane = this._createPane('leaflet-objects-pane', this._mapPane);
        panes.shadowPane = this._createPane('leaflet-shadow-pane');
        panes.overlayPane = this._createPane('leaflet-overlay-pane');
        panes.markerPane = this._createPane('leaflet-marker-pane');
        panes.popupPane = this._createPane('leaflet-popup-pane');
        var zoomHide = ' leaflet-zoom-hide';
        if (!this.options.markerZoomAnimation) {
            L.DomUtil.addClass(panes.markerPane, zoomHide);
            L.DomUtil.addClass(panes.shadowPane, zoomHide);
            L.DomUtil.addClass(panes.popupPane, zoomHide);
        }
    },
    _createPane: function (className, container) {
        return L.DomUtil.create('div', className, container || this._panes.objectsPane);
    },
    _clearPanes: function () {
        this._container.removeChild(this._mapPane);
    },
    _addLayers: function (layers) {
        layers = layers ? (L.Util.isArray(layers) ? layers : [layers]) : [];
        for (var i = 0, len = layers.length; i
< len; i++) {
            this.addLayer(layers[i]);
        }
    },
    // private methods that modify map state
    _resetView: function (center, zoom, preserveMapOffset, afterZoomAnim) {
        var zoomChanged = (this._zoom !== zoom);
        if (!afterZoomAnim) {
            this.fire('movestart');
            if (zoomChanged) {
                this.fire('zoomstart');
            }
        }
        this._zoom = zoom;
        this._initialCenter = center;
        this._initialTopLeftPoint = this._getNewTopLeftPoint(center);
        if (!preserveMapOffset) {
            L.DomUtil.setPosition(this._mapPane, new L.Point(0, 0));
        } else {
            this._initialTopLeftPoint._add(this._getMapPanePos());
        }
        this._tileLayersToLoad = this._tileLayersNum;
        var loading = !this._loaded;
        this._loaded = true;
        this.fire('viewreset', {hard: !preserveMapOffset});
        if (loading) {
            this.fire('load');
            this.eachLayer(this._layerAdd, this);
        }
        this.fire('move');
        if (zoomChanged || afterZoomAnim) {
            this.fire('zoomend');
        }
        this.fire('moveend', {hard: !preserveMapOffset});
    },
    _rawPanBy: function (offset) {
        L.DomUtil.setPosition(this._mapPane, this._getMapPanePos().subtract(offset));
    },
    _getZoomSpan: function () {
        return this.getMaxZoom() - this.getMinZoom();
    },
    _updateZoomLevels: function () {
        var i,
            minZoom = Infinity,
            maxZoom = -Infinity,
            oldZoomSpan = this._getZoomSpan();
        for (i in this._zoomBoundLayers) {
            var layer = this._zoomBoundLayers[i];
            if (!isNaN(layer.options.minZoom)) {
                minZoom = Math.min(minZoom, layer.options.minZoom);
            }
            if (!isNaN(layer.options.maxZoom)) {
                maxZoom = Math.max(maxZoom, layer.options.maxZoom);
            }
        }
        if (i === undefined) { // we have no tilelayers
            this._layersMaxZoom = this._layersMinZoom = undefined;
        } else {
            this._layersMaxZoom = maxZoom;
            this._layersMinZoom = minZoom;
        }
        if (oldZoomSpan !== this._getZoomSpan()) {
            this.fire('zoomlevelschange');
        }
    },
    _panInsideMaxBounds: function () {
        this.panInsideBounds(this.options.maxBounds);
    },
    _checkIfLoaded: function () {
        if (!this._loaded) {
            throw new Error('Set map center and zoom first.');
        }
    },
    // map events
    _initEvents: function (onOff) {
        if (!L.DomEvent) { return; }
        onOff = onOff || 'on';
        L.DomEvent[onOff](this._container, 'click', this._onMouseClick, this);
        var events = ['dblclick', 'mousedown', 'mouseup', 'mouseenter',
                      'mouseleave', 'mousemove', 'contextmenu'],
            i, len;
        for (i = 0, len = events.length; i
< len; i++) {
            L.DomEvent[onOff](this._container, events[i], this._fireMouseEvent, this);
        }
        if (this.options.trackResize) {
            L.DomEvent[onOff](window, 'resize', this._onResize, this);
        }
    },
    _onResize: function () {
        L.Util.cancelAnimFrame(this._resizeRequest);
        this._resizeRequest = L.Util.requestAnimFrame(
                function () { this.invalidateSize({debounceMoveend: true}); }, this, false, this._container);
    },
    _onMouseClick: function (e) {
        if (!this._loaded || (!e._simulated &&
                ((this.dragging && this.dragging.moved()) ||
                 (this.boxZoom  && this.boxZoom.moved()))) ||
                    L.DomEvent._skipped(e)) { return; }
        this.fire('preclick');
        this._fireMouseEvent(e);
    },
    _fireMouseEvent: function (e) {
        if (!this._loaded || L.DomEvent._skipped(e)) { return; }
        var type = e.type;
        type = (type === 'mouseenter' ? 'mouseover' : (type === 'mouseleave' ? 'mouseout' : type));
        if (!this.hasEventListeners(type)) { return; }
        if (type === 'contextmenu') {
            L.DomEvent.preventDefault(e);
        }
        var containerPoint = this.mouseEventToContainerPoint(e),
            layerPoint = this.containerPointToLayerPoint(containerPoint),
            latlng = this.layerPointToLatLng(layerPoint);
        this.fire(type, {
            latlng: latlng,
            layerPoint: layerPoint,
            containerPoint: containerPoint,
            originalEvent: e
        });
    },
    _onTileLayerLoad: function () {
        this._tileLayersToLoad--;
        if (this._tileLayersNum && !this._tileLayersToLoad) {
            this.fire('tilelayersload');
        }
    },
    _clearHandlers: function () {
        for (var i = 0, len = this._handlers.length; i
< len; i++) {
            this._handlers[i].disable();
        }
    },
    whenReady: function (callback, context) {
        if (this._loaded) {
            callback.call(context || this, this);
        } else {
            this.on('load', callback, context);
        }
        return this;
    },
    _layerAdd: function (layer) {
        layer.onAdd(this);
        this.fire('layeradd', {layer: layer});
    },
    // private methods for getting map state
    _getMapPanePos: function () {
        return L.DomUtil.getPosition(this._mapPane);
    },
    _moved: function () {
        var pos = this._getMapPanePos();
        return pos && !pos.equals([0, 0]);
    },
    _getTopLeftPoint: function () {
        return this.getPixelOrigin().subtract(this._getMapPanePos());
    },
    _getNewTopLeftPoint: function (center, zoom) {
        var viewHalf = this.getSize()._divideBy(2);
        // TODO round on display, not calculation to increase precision?
        return this.project(center, zoom)._subtract(viewHalf)._round();
    },
    _latLngToNewLayerPoint: function (latlng, newZoom, newCenter) {
        var topLeft = this._getNewTopLeftPoint(newCenter, newZoom).add(this._getMapPanePos());
        return this.project(latlng, newZoom)._subtract(topLeft);
    },
    // layer point of the current center
    _getCenterLayerPoint: function () {
        return this.containerPointToLayerPoint(this.getSize()._divideBy(2));
    },
    // offset of the specified place to the current center in pixels
    _getCenterOffset: function (latlng) {
        return this.latLngToLayerPoint(latlng).subtract(this._getCenterLayerPoint());
    },
    // adjust center for view to get inside bounds
    _limitCenter: function (center, zoom, bounds) {
        if (!bounds) { return center; }
        var centerPoint = this.project(center, zoom),
            viewHalf = this.getSize().divideBy(2),
            viewBounds = new L.Bounds(centerPoint.subtract(viewHalf), centerPoint.add(viewHalf)),
            offset = this._getBoundsOffset(viewBounds, bounds, zoom);
        return this.unproject(centerPoint.add(offset), zoom);
    },
    // adjust offset for view to get inside bounds
    _limitOffset: function (offset, bounds) {
        if (!bounds) { return offset; }
        var viewBounds = this.getPixelBounds(),
            newBounds = new L.Bounds(viewBounds.min.add(offset), viewBounds.max.add(offset));
        return offset.add(this._getBoundsOffset(newBounds, bounds));
    },
    // returns offset needed for pxBounds to get inside maxBounds at a specified zoom
    _getBoundsOffset: function (pxBounds, maxBounds, zoom) {
        var nwOffset = this.project(maxBounds.getNorthWest(), zoom).subtract(pxBounds.min),
            seOffset = this.project(maxBounds.getSouthEast(), zoom).subtract(pxBounds.max),
            dx = this._rebound(nwOffset.x, -seOffset.x),
            dy = this._rebound(nwOffset.y, -seOffset.y);
        return new L.Point(dx, dy);
    },
    _rebound: function (left, right) {
        return left + right >
 0 ?
            Math.round(left - right) / 2 :
            Math.max(0, Math.ceil(left)) - Math.max(0, Math.floor(right));
    },
    _limitZoom: function (zoom) {
        var min = this.getMinZoom(),
            max = this.getMaxZoom();
        return Math.max(min, Math.min(max, zoom));
    }
});
L.map = function (id, options) {
    return new L.Map(id, options);
};
/*
 * Mercator projection that takes into account that the Earth is not a perfect sphere.
 * Less popular than spherical mercator; used by projections like EPSG:3395.
 */
L.Projection.Mercator = {
    MAX_LATITUDE: 85.0840591556,
    R_MINOR: 6356752.314245179,
    R_MAJOR: 6378137,
    project: function (latlng) { // (LatLng) ->
 Point
        var d = L.LatLng.DEG_TO_RAD,
            max = this.MAX_LATITUDE,
            lat = Math.max(Math.min(max, latlng.lat), -max),
            r = this.R_MAJOR,
            r2 = this.R_MINOR,
            x = latlng.lng * d * r,
            y = lat * d,
            tmp = r2 / r,
            eccent = Math.sqrt(1.0 - tmp * tmp),
            con = eccent * Math.sin(y);
        con = Math.pow((1 - con) / (1 + con), eccent * 0.5);
        var ts = Math.tan(0.5 * ((Math.PI * 0.5) - y)) / con;
        y = -r * Math.log(ts);
        return new L.Point(x, y);
    },
    unproject: function (point) { // (Point, Boolean) ->
 LatLng
        var d = L.LatLng.RAD_TO_DEG,
            r = this.R_MAJOR,
            r2 = this.R_MINOR,
            lng = point.x * d / r,
            tmp = r2 / r,
            eccent = Math.sqrt(1 - (tmp * tmp)),
            ts = Math.exp(- point.y / r),
            phi = (Math.PI / 2) - 2 * Math.atan(ts),
            numIter = 15,
            tol = 1e-7,
            i = numIter,
            dphi = 0.1,
            con;
        while ((Math.abs(dphi) >
 tol) && (--i >
 0)) {
            con = eccent * Math.sin(phi);
            dphi = (Math.PI / 2) - 2 * Math.atan(ts *
                        Math.pow((1.0 - con) / (1.0 + con), 0.5 * eccent)) - phi;
            phi += dphi;
        }
        return new L.LatLng(phi * d, lng);
    }
};
L.CRS.EPSG3395 = L.extend({}, L.CRS, {
    code: 'EPSG:3395',
    projection: L.Projection.Mercator,
    transformation: (function () {
        var m = L.Projection.Mercator,
            r = m.R_MAJOR,
            scale = 0.5 / (Math.PI * r);
        return new L.Transformation(scale, 0.5, -scale, 0.5);
    }())
});
/*
 * L.TileLayer is used for standard xyz-numbered tile layers.
 */
L.TileLayer = L.Class.extend({
    includes: L.Mixin.Events,
    options: {
        minZoom: 0,
        maxZoom: 18,
        tileSize: 256,
        subdomains: 'abc',
        errorTileUrl: '',
        attribution: '',
        zoomOffset: 0,
        opacity: 1,
        /*
        maxNativeZoom: null,
        zIndex: null,
        tms: false,
        continuousWorld: false,
        noWrap: false,
        zoomReverse: false,
        detectRetina: false,
        reuseTiles: false,
        bounds: false,
        */
        unloadInvisibleTiles: L.Browser.mobile,
        updateWhenIdle: L.Browser.mobile
    },
    initialize: function (url, options) {
        options = L.setOptions(this, options);
        // detecting retina displays, adjusting tileSize and zoom levels
        if (options.detectRetina && L.Browser.retina && options.maxZoom >
 0) {
            options.tileSize = Math.floor(options.tileSize / 2);
            options.zoomOffset++;
            if (options.minZoom >
 0) {
                options.minZoom--;
            }
            this.options.maxZoom--;
        }
        if (options.bounds) {
            options.bounds = L.latLngBounds(options.bounds);
        }
        this._url = url;
        var subdomains = this.options.subdomains;
        if (typeof subdomains === 'string') {
            this.options.subdomains = subdomains.split('');
        }
    },
    onAdd: function (map) {
        this._map = map;
        this._animated = map._zoomAnimated;
        // create a container div for tiles
        this._initContainer();
        // set up events
        map.on({
            'viewreset': this._reset,
            'moveend': this._update
        }, this);
        if (this._animated) {
            map.on({
                'zoomanim': this._animateZoom,
                'zoomend': this._endZoomAnim
            }, this);
        }
        if (!this.options.updateWhenIdle) {
            this._limitedUpdate = L.Util.limitExecByInterval(this._update, 150, this);
            map.on('move', this._limitedUpdate, this);
        }
        this._reset();
        this._update();
    },
    addTo: function (map) {
        map.addLayer(this);
        return this;
    },
    onRemove: function (map) {
        this._container.parentNode.removeChild(this._container);
        map.off({
            'viewreset': this._reset,
            'moveend': this._update
        }, this);
        if (this._animated) {
            map.off({
                'zoomanim': this._animateZoom,
                'zoomend': this._endZoomAnim
            }, this);
        }
        if (!this.options.updateWhenIdle) {
            map.off('move', this._limitedUpdate, this);
        }
        this._container = null;
        this._map = null;
    },
    bringToFront: function () {
        var pane = this._map._panes.tilePane;
        if (this._container) {
            pane.appendChild(this._container);
            this._setAutoZIndex(pane, Math.max);
        }
        return this;
    },
    bringToBack: function () {
        var pane = this._map._panes.tilePane;
        if (this._container) {
            pane.insertBefore(this._container, pane.firstChild);
            this._setAutoZIndex(pane, Math.min);
        }
        return this;
    },
    getAttribution: function () {
        return this.options.attribution;
    },
    getContainer: function () {
        return this._container;
    },
    setOpacity: function (opacity) {
        this.options.opacity = opacity;
        if (this._map) {
            this._updateOpacity();
        }
        return this;
    },
    setZIndex: function (zIndex) {
        this.options.zIndex = zIndex;
        this._updateZIndex();
        return this;
    },
    setUrl: function (url, noRedraw) {
        this._url = url;
        if (!noRedraw) {
            this.redraw();
        }
        return this;
    },
    redraw: function () {
        if (this._map) {
            this._reset({hard: true});
            this._update();
        }
        return this;
    },
    _updateZIndex: function () {
        if (this._container && this.options.zIndex !== undefined) {
            this._container.style.zIndex = this.options.zIndex;
        }
    },
    _setAutoZIndex: function (pane, compare) {
        var layers = pane.children,
            edgeZIndex = -compare(Infinity, -Infinity), // -Infinity for max, Infinity for min
            zIndex, i, len;
        for (i = 0, len = layers.length; i
< len; i++) {
            if (layers[i] !== this._container) {
                zIndex = parseInt(layers[i].style.zIndex, 10);
                if (!isNaN(zIndex)) {
                    edgeZIndex = compare(edgeZIndex, zIndex);
                }
            }
        }
        this.options.zIndex = this._container.style.zIndex =
                (isFinite(edgeZIndex) ? edgeZIndex : 0) + compare(1, -1);
    },
    _updateOpacity: function () {
        var i,
            tiles = this._tiles;
        if (L.Browser.ielt9) {
            for (i in tiles) {
                L.DomUtil.setOpacity(tiles[i], this.options.opacity);
            }
        } else {
            L.DomUtil.setOpacity(this._container, this.options.opacity);
        }
    },
    _initContainer: function () {
        var tilePane = this._map._panes.tilePane;
        if (!this._container) {
            this._container = L.DomUtil.create('div', 'leaflet-layer');
            this._updateZIndex();
            if (this._animated) {
                var className = 'leaflet-tile-container';
                this._bgBuffer = L.DomUtil.create('div', className, this._container);
                this._tileContainer = L.DomUtil.create('div', className, this._container);
            } else {
                this._tileContainer = this._container;
            }
            tilePane.appendChild(this._container);
            if (this.options.opacity
< 1) {
                this._updateOpacity();
            }
        }
    },
    _reset: function (e) {
        for (var key in this._tiles) {
            this.fire('tileunload', {tile: this._tiles[key]});
        }
        this._tiles = {};
        this._tilesToLoad = 0;
        if (this.options.reuseTiles) {
            this._unusedTiles = [];
        }
        this._tileContainer.innerHTML = '';
        if (this._animated && e && e.hard) {
            this._clearBgBuffer();
        }
        this._initContainer();
    },
    _getTileSize: function () {
        var map = this._map,
            zoom = map.getZoom() + this.options.zoomOffset,
            zoomN = this.options.maxNativeZoom,
            tileSize = this.options.tileSize;
        if (zoomN && zoom >
 zoomN) {
            tileSize = Math.round(map.getZoomScale(zoom) / map.getZoomScale(zoomN) * tileSize);
        }
        return tileSize;
    },
    _update: function () {
        if (!this._map) { return; }
        var map = this._map,
            bounds = map.getPixelBounds(),
            zoom = map.getZoom(),
            tileSize = this._getTileSize();
        if (zoom >
 this.options.maxZoom || zoom
< this.options.minZoom) {
            return;
        }
        var tileBounds = L.bounds(
                bounds.min.divideBy(tileSize)._floor(),
                bounds.max.divideBy(tileSize)._floor());
        this._addTilesFromCenterOut(tileBounds);
        if (this.options.unloadInvisibleTiles || this.options.reuseTiles) {
            this._removeOtherTiles(tileBounds);
        }
    },
    _addTilesFromCenterOut: function (bounds) {
        var queue = [],
            center = bounds.getCenter();
        var j, i, point;
        for (j = bounds.min.y; j
<= bounds.max.y; j++) {
            for (i = bounds.min.x; i
<= bounds.max.x; i++) {
                point = new L.Point(i, j);
                if (this._tileShouldBeLoaded(point)) {
                    queue.push(point);
                }
            }
        }
        var tilesToLoad = queue.length;
        if (tilesToLoad === 0) { return; }
        // load tiles in order of their distance to center
        queue.sort(function (a, b) {
            return a.distanceTo(center) - b.distanceTo(center);
        });
        var fragment = document.createDocumentFragment();
        // if its the first batch of tiles to load
        if (!this._tilesToLoad) {
            this.fire('loading');
        }
        this._tilesToLoad += tilesToLoad;
        for (i = 0; i
< tilesToLoad; i++) {
            this._addTile(queue[i], fragment);
        }
        this._tileContainer.appendChild(fragment);
    },
    _tileShouldBeLoaded: function (tilePoint) {
        if ((tilePoint.x + ':' + tilePoint.y) in this._tiles) {
            return false; // already loaded
        }
        var options = this.options;
        if (!options.continuousWorld) {
            var limit = this._getWrapTileNum();
            // don't load if exceeds world bounds
            if ((options.noWrap && (tilePoint.x
< 0 || tilePoint.x >
= limit.x)) ||
                tilePoint.y
< 0 || tilePoint.y >
= limit.y) { return false; }
        }
        if (options.bounds) {
            var tileSize = options.tileSize,
                nwPoint = tilePoint.multiplyBy(tileSize),
                sePoint = nwPoint.add([tileSize, tileSize]),
                nw = this._map.unproject(nwPoint),
                se = this._map.unproject(sePoint);
            // TODO temporary hack, will be removed after refactoring projections
            // https://github.com/Leaflet/Leaflet/issues/1618
            if (!options.continuousWorld && !options.noWrap) {
                nw = nw.wrap();
                se = se.wrap();
            }
            if (!options.bounds.intersects([nw, se])) { return false; }
        }
        return true;
    },
    _removeOtherTiles: function (bounds) {
        var kArr, x, y, key;
        for (key in this._tiles) {
            kArr = key.split(':');
            x = parseInt(kArr[0], 10);
            y = parseInt(kArr[1], 10);
            // remove tile if it's out of bounds
            if (x
< bounds.min.x || x >
 bounds.max.x || y
< bounds.min.y || y >
 bounds.max.y) {
                this._removeTile(key);
            }
        }
    },
    _removeTile: function (key) {
        var tile = this._tiles[key];
        this.fire('tileunload', {tile: tile, url: tile.src});
        if (this.options.reuseTiles) {
            L.DomUtil.removeClass(tile, 'leaflet-tile-loaded');
            this._unusedTiles.push(tile);
        } else if (tile.parentNode === this._tileContainer) {
            this._tileContainer.removeChild(tile);
        }
        // for https://github.com/CloudMade/Leaflet/issues/137
        if (!L.Browser.android) {
            tile.onload = null;
            tile.src = L.Util.emptyImageUrl;
        }
        delete this._tiles[key];
    },
    _addTile: function (tilePoint, container) {
        var tilePos = this._getTilePos(tilePoint);
        // get unused tile - or create a new tile
        var tile = this._getTile();
        /*
        Chrome 20 layouts much faster with top/left (verify with timeline, frames)
        Android 4 browser has display issues with top/left and requires transform instead
        (other browsers don't currently care) - see debug/hacks/jitter.html for an example
        */
        L.DomUtil.setPosition(tile, tilePos, L.Browser.chrome);
        this._tiles[tilePoint.x + ':' + tilePoint.y] = tile;
        this._loadTile(tile, tilePoint);
        if (tile.parentNode !== this._tileContainer) {
            container.appendChild(tile);
        }
    },
    _getZoomForUrl: function () {
        var options = this.options,
            zoom = this._map.getZoom();
        if (options.zoomReverse) {
            zoom = options.maxZoom - zoom;
        }
        zoom += options.zoomOffset;
        return options.maxNativeZoom ? Math.min(zoom, options.maxNativeZoom) : zoom;
    },
    _getTilePos: function (tilePoint) {
        var origin = this._map.getPixelOrigin(),
            tileSize = this._getTileSize();
        return tilePoint.multiplyBy(tileSize).subtract(origin);
    },
    // image-specific code (override to implement e.g. Canvas or SVG tile layer)
    getTileUrl: function (tilePoint) {
        return L.Util.template(this._url, L.extend({
            s: this._getSubdomain(tilePoint),
            z: tilePoint.z,
            x: tilePoint.x,
            y: tilePoint.y
        }, this.options));
    },
    _getWrapTileNum: function () {
        var crs = this._map.options.crs,
            size = crs.getSize(this._map.getZoom());
        return size.divideBy(this._getTileSize())._floor();
    },
    _adjustTilePoint: function (tilePoint) {
        var limit = this._getWrapTileNum();
        // wrap tile coordinates
        if (!this.options.continuousWorld && !this.options.noWrap) {
            tilePoint.x = ((tilePoint.x % limit.x) + limit.x) % limit.x;
        }
        if (this.options.tms) {
            tilePoint.y = limit.y - tilePoint.y - 1;
        }
        tilePoint.z = this._getZoomForUrl();
    },
    _getSubdomain: function (tilePoint) {
        var index = Math.abs(tilePoint.x + tilePoint.y) % this.options.subdomains.length;
        return this.options.subdomains[index];
    },
    _getTile: function () {
        if (this.options.reuseTiles && this._unusedTiles.length >
 0) {
            var tile = this._unusedTiles.pop();
            this._resetTile(tile);
            return tile;
        }
        return this._createTile();
    },
    // Override if data stored on a tile needs to be cleaned up before reuse
    _resetTile: function (/*tile*/) {},
    _createTile: function () {
        var tile = L.DomUtil.create('img', 'leaflet-tile');
        tile.style.width = tile.style.height = this._getTileSize() + 'px';
        tile.galleryimg = 'no';
        tile.onselectstart = tile.onmousemove = L.Util.falseFn;
        if (L.Browser.ielt9 && this.options.opacity !== undefined) {
            L.DomUtil.setOpacity(tile, this.options.opacity);
        }
        // without this hack, tiles disappear after zoom on Chrome for Android
        // https://github.com/Leaflet/Leaflet/issues/2078
        if (L.Browser.mobileWebkit3d) {
            tile.style.WebkitBackfaceVisibility = 'hidden';
        }
        return tile;
    },
    _loadTile: function (tile, tilePoint) {
        tile._layer  = this;
        tile.onload  = this._tileOnLoad;
        tile.onerror = this._tileOnError;
        this._adjustTilePoint(tilePoint);
        tile.src     = this.getTileUrl(tilePoint);
        this.fire('tileloadstart', {
            tile: tile,
            url: tile.src
        });
    },
    _tileLoaded: function () {
        this._tilesToLoad--;
        if (this._animated) {
            L.DomUtil.addClass(this._tileContainer, 'leaflet-zoom-animated');
        }
        if (!this._tilesToLoad) {
            this.fire('load');
            if (this._animated) {
                // clear scaled tiles after all new tiles are loaded (for performance)
                clearTimeout(this._clearBgBufferTimer);
                this._clearBgBufferTimer = setTimeout(L.bind(this._clearBgBuffer, this), 500);
            }
        }
    },
    _tileOnLoad: function () {
        var layer = this._layer;
        //Only if we are loading an actual image
        if (this.src !== L.Util.emptyImageUrl) {
            L.DomUtil.addClass(this, 'leaflet-tile-loaded');
            layer.fire('tileload', {
                tile: this,
                url: this.src
            });
        }
        layer._tileLoaded();
    },
    _tileOnError: function () {
        var layer = this._layer;
        layer.fire('tileerror', {
            tile: this,
            url: this.src
        });
        var newUrl = layer.options.errorTileUrl;
        if (newUrl) {
            this.src = newUrl;
        }
        layer._tileLoaded();
    }
});
L.tileLayer = function (url, options) {
    return new L.TileLayer(url, options);
};
/*
 * L.TileLayer.WMS is used for putting WMS tile layers on the map.
 */
L.TileLayer.WMS = L.TileLayer.extend({
    defaultWmsParams: {
        service: 'WMS',
        request: 'GetMap',
        version: '1.1.1',
        layers: '',
        styles: '',
        format: 'image/jpeg',
        transparent: false
    },
    initialize: function (url, options) { // (String, Object)
        this._url = url;
        var wmsParams = L.extend({}, this.defaultWmsParams),
            tileSize = options.tileSize || this.options.tileSize;
        if (options.detectRetina && L.Browser.retina) {
            wmsParams.width = wmsParams.height = tileSize * 2;
        } else {
            wmsParams.width = wmsParams.height = tileSize;
        }
        for (var i in options) {
            // all keys that are not TileLayer options go to WMS params
            if (!this.options.hasOwnProperty(i) && i !== 'crs') {
                wmsParams[i] = options[i];
            }
        }
        this.wmsParams = wmsParams;
        L.setOptions(this, options);
    },
    onAdd: function (map) {
        this._crs = this.options.crs || map.options.crs;
        this._wmsVersion = parseFloat(this.wmsParams.version);
        var projectionKey = this._wmsVersion >
= 1.3 ? 'crs' : 'srs';
        this.wmsParams[projectionKey] = this._crs.code;
        L.TileLayer.prototype.onAdd.call(this, map);
    },
    getTileUrl: function (tilePoint) { // (Point, Number) ->
 String
        var map = this._map,
            tileSize = this.options.tileSize,
            nwPoint = tilePoint.multiplyBy(tileSize),
            sePoint = nwPoint.add([tileSize, tileSize]),
            nw = this._crs.project(map.unproject(nwPoint, tilePoint.z)),
            se = this._crs.project(map.unproject(sePoint, tilePoint.z)),
            bbox = this._wmsVersion >
= 1.3 && this._crs === L.CRS.EPSG4326 ?
                [se.y, nw.x, nw.y, se.x].join(',') :
                [nw.x, se.y, se.x, nw.y].join(','),
            url = L.Util.template(this._url, {s: this._getSubdomain(tilePoint)});
        return url + L.Util.getParamString(this.wmsParams, url, true) + '&BBOX=' + bbox;
    },
    setParams: function (params, noRedraw) {
        L.extend(this.wmsParams, params);
        if (!noRedraw) {
            this.redraw();
        }
        return this;
    }
});
L.tileLayer.wms = function (url, options) {
    return new L.TileLayer.WMS(url, options);
};
/*
 * L.TileLayer.Canvas is a class that you can use as a base for creating
 * dynamically drawn Canvas-based tile layers.
 */
L.TileLayer.Canvas = L.TileLayer.extend({
    options: {
        async: false
    },
    initialize: function (options) {
        L.setOptions(this, options);
    },
    redraw: function () {
        if (this._map) {
            this._reset({hard: true});
            this._update();
        }
        for (var i in this._tiles) {
            this._redrawTile(this._tiles[i]);
        }
        return this;
    },
    _redrawTile: function (tile) {
        this.drawTile(tile, tile._tilePoint, this._map._zoom);
    },
    _createTile: function () {
        var tile = L.DomUtil.create('canvas', 'leaflet-tile');
        tile.width = tile.height = this.options.tileSize;
        tile.onselectstart = tile.onmousemove = L.Util.falseFn;
        return tile;
    },
    _loadTile: function (tile, tilePoint) {
        tile._layer = this;
        tile._tilePoint = tilePoint;
        this._redrawTile(tile);
        if (!this.options.async) {
            this.tileDrawn(tile);
        }
    },
    drawTile: function (/*tile, tilePoint*/) {
        // override with rendering code
    },
    tileDrawn: function (tile) {
        this._tileOnLoad.call(tile);
    }
});
L.tileLayer.canvas = function (options) {
    return new L.TileLayer.Canvas(options);
};
/*
 * L.ImageOverlay is used to overlay images over the map (to specific geographical bounds).
 */
L.ImageOverlay = L.Class.extend({
    includes: L.Mixin.Events,
    options: {
        opacity: 1
    },
    initialize: function (url, bounds, options) { // (String, LatLngBounds, Object)
        this._url = url;
        this._bounds = L.latLngBounds(bounds);
        L.setOptions(this, options);
    },
    onAdd: function (map) {
        this._map = map;
        if (!this._image) {
            this._initImage();
        }
        map._panes.overlayPane.appendChild(this._image);
        map.on('viewreset', this._reset, this);
        if (map.options.zoomAnimation && L.Browser.any3d) {
            map.on('zoomanim', this._animateZoom, this);
        }
        this._reset();
    },
    onRemove: function (map) {
        map.getPanes().overlayPane.removeChild(this._image);
        map.off('viewreset', this._reset, this);
        if (map.options.zoomAnimation) {
            map.off('zoomanim', this._animateZoom, this);
        }
    },
    addTo: function (map) {
        map.addLayer(this);
        return this;
    },
    setOpacity: function (opacity) {
        this.options.opacity = opacity;
        this._updateOpacity();
        return this;
    },
    // TODO remove bringToFront/bringToBack duplication from TileLayer/Path
    bringToFront: function () {
        if (this._image) {
            this._map._panes.overlayPane.appendChild(this._image);
        }
        return this;
    },
    bringToBack: function () {
        var pane = this._map._panes.overlayPane;
        if (this._image) {
            pane.insertBefore(this._image, pane.firstChild);
        }
        return this;
    },
    setUrl: function (url) {
        this._url = url;
        this._image.src = this._url;
    },
    getAttribution: function () {
        return this.options.attribution;
    },
    _initImage: function () {
        this._image = L.DomUtil.create('img', 'leaflet-image-layer');
        if (this._map.options.zoomAnimation && L.Browser.any3d) {
            L.DomUtil.addClass(this._image, 'leaflet-zoom-animated');
        } else {
            L.DomUtil.addClass(this._image, 'leaflet-zoom-hide');
        }
        this._updateOpacity();
        //TODO createImage util method to remove duplication
        L.extend(this._image, {
            galleryimg: 'no',
            onselectstart: L.Util.falseFn,
            onmousemove: L.Util.falseFn,
            onload: L.bind(this._onImageLoad, this),
            src: this._url
        });
    },
    _animateZoom: function (e) {
        var map = this._map,
            image = this._image,
            scale = map.getZoomScale(e.zoom),
            nw = this._bounds.getNorthWest(),
            se = this._bounds.getSouthEast(),
            topLeft = map._latLngToNewLayerPoint(nw, e.zoom, e.center),
            size = map._latLngToNewLayerPoint(se, e.zoom, e.center)._subtract(topLeft),
            origin = topLeft._add(size._multiplyBy((1 / 2) * (1 - 1 / scale)));
        image.style[L.DomUtil.TRANSFORM] =
                L.DomUtil.getTranslateString(origin) + ' scale(' + scale + ') ';
    },
    _reset: function () {
        var image   = this._image,
            topLeft = this._map.latLngToLayerPoint(this._bounds.getNorthWest()),
            size = this._map.latLngToLayerPoint(this._bounds.getSouthEast())._subtract(topLeft);
        L.DomUtil.setPosition(image, topLeft);
        image.style.width  = size.x + 'px';
        image.style.height = size.y + 'px';
    },
    _onImageLoad: function () {
        this.fire('load');
    },
    _updateOpacity: function () {
        L.DomUtil.setOpacity(this._image, this.options.opacity);
    }
});
L.imageOverlay = function (url, bounds, options) {
    return new L.ImageOverlay(url, bounds, options);
};
/*
 * L.Icon is an image-based icon class that you can use with L.Marker for custom markers.
 */
L.Icon = L.Class.extend({
    options: {
        /*
        iconUrl: (String) (required)
        iconRetinaUrl: (String) (optional, used for retina devices if detected)
        iconSize: (Point) (can be set through CSS)
        iconAnchor: (Point) (centered by default, can be set in CSS with negative margins)
        popupAnchor: (Point) (if not specified, popup opens in the anchor point)
        shadowUrl: (String) (no shadow by default)
        shadowRetinaUrl: (String) (optional, used for retina devices if detected)
        shadowSize: (Point)
        shadowAnchor: (Point)
        */
        className: ''
    },
    initialize: function (options) {
        L.setOptions(this, options);
    },
    createIcon: function (oldIcon) {
        return this._createIcon('icon', oldIcon);
    },
    createShadow: function (oldIcon) {
        return this._createIcon('shadow', oldIcon);
    },
    _createIcon: function (name, oldIcon) {
        var src = this._getIconUrl(name);
        if (!src) {
            if (name === 'icon') {
                throw new Error('iconUrl not set in Icon options (see the docs).');
            }
            return null;
        }
        var img;
        if (!oldIcon || oldIcon.tagName !== 'IMG') {
            img = this._createImg(src);
        } else {
            img = this._createImg(src, oldIcon);
        }
        this._setIconStyles(img, name);
        return img;
    },
    _setIconStyles: function (img, name) {
        var options = this.options,
            size = L.point(options[name + 'Size']),
            anchor;
        if (name === 'shadow') {
            anchor = L.point(options.shadowAnchor || options.iconAnchor);
        } else {
            anchor = L.point(options.iconAnchor);
        }
        if (!anchor && size) {
            anchor = size.divideBy(2, true);
        }
        img.className = 'leaflet-marker-' + name + ' ' + options.className;
        if (anchor) {
            img.style.marginLeft = (-anchor.x) + 'px';
            img.style.marginTop  = (-anchor.y) + 'px';
        }
        if (size) {
            img.style.width  = size.x + 'px';
            img.style.height = size.y + 'px';
        }
    },
    _createImg: function (src, el) {
        el = el || document.createElement('img');
        el.src = src;
        return el;
    },
    _getIconUrl: function (name) {
        if (L.Browser.retina && this.options[name + 'RetinaUrl']) {
            return this.options[name + 'RetinaUrl'];
        }
        return this.options[name + 'Url'];
    }
});
L.icon = function (options) {
    return new L.Icon(options);
};
/*
 * L.Icon.Default is the blue marker icon used by default in Leaflet.
 */
L.Icon.Default = L.Icon.extend({
    options: {
        iconSize: [25, 41],
        iconAnchor: [12, 41],
        popupAnchor: [1, -34],
        shadowSize: [41, 41]
    },
    _getIconUrl: function (name) {
        var key = name + 'Url';
        if (this.options[key]) {
            return this.options[key];
        }
        if (L.Browser.retina && name === 'icon') {
            name += '-2x';
        }
        var path = L.Icon.Default.imagePath;
        if (!path) {
            throw new Error('Couldn\'t autodetect L.Icon.Default.imagePath, set it manually.');
        }
        return path + '/marker-' + name + '.png';
    }
});
L.Icon.Default.imagePath = (function () {
    var scripts = document.getElementsByTagName('script'),
        leafletRe = /[\/^]leaflet[\-\._]?([\w\-\._]*)\.js\??/;
    var i, len, src, matches, path;
    for (i = 0, len = scripts.length; i
< len; i++) {
        src = scripts[i].src;
        matches = src.match(leafletRe);
        if (matches) {
            path = src.split(leafletRe)[0];
            return (path ? path + '/' : '') + 'images';
        }
    }
}());
/*
 * L.Marker is used to display clickable/draggable icons on the map.
 */
L.Marker = L.Class.extend({
    includes: L.Mixin.Events,
    options: {
        icon: new L.Icon.Default(),
        title: '',
        alt: '',
        clickable: true,
        draggable: false,
        keyboard: true,
        zIndexOffset: 0,
        opacity: 1,
        riseOnHover: false,
        riseOffset: 250
    },
    initialize: function (latlng, options) {
        L.setOptions(this, options);
        this._latlng = L.latLng(latlng);
    },
    onAdd: function (map) {
        this._map = map;
        map.on('viewreset', this.update, this);
        this._initIcon();
        this.update();
        this.fire('add');
        if (map.options.zoomAnimation && map.options.markerZoomAnimation) {
            map.on('zoomanim', this._animateZoom, this);
        }
    },
    addTo: function (map) {
        map.addLayer(this);
        return this;
    },
    onRemove: function (map) {
        if (this.dragging) {
            this.dragging.disable();
        }
        this._removeIcon();
        this._removeShadow();
        this.fire('remove');
        map.off({
            'viewreset': this.update,
            'zoomanim': this._animateZoom
        }, this);
        this._map = null;
    },
    getLatLng: function () {
        return this._latlng;
    },
    setLatLng: function (latlng) {
        this._latlng = L.latLng(latlng);
        this.update();
        return this.fire('move', { latlng: this._latlng });
    },
    setZIndexOffset: function (offset) {
        this.options.zIndexOffset = offset;
        this.update();
        return this;
    },
    setIcon: function (icon) {
        this.options.icon = icon;
        if (this._map) {
            this._initIcon();
            this.update();
        }
        if (this._popup) {
            this.bindPopup(this._popup);
        }
        return this;
    },
    update: function () {
        if (this._icon) {
            var pos = this._map.latLngToLayerPoint(this._latlng).round();
            this._setPos(pos);
        }
        return this;
    },
    _initIcon: function () {
        var options = this.options,
            map = this._map,
            animation = (map.options.zoomAnimation && map.options.markerZoomAnimation),
            classToAdd = animation ? 'leaflet-zoom-animated' : 'leaflet-zoom-hide';
        var icon = options.icon.createIcon(this._icon),
            addIcon = false;
        // if we're not reusing the icon, remove the old one and init new one
        if (icon !== this._icon) {
            if (this._icon) {
                this._removeIcon();
            }
            addIcon = true;
            if (options.title) {
                icon.title = options.title;
            }
            if (options.alt) {
                icon.alt = options.alt;
            }
        }
        L.DomUtil.addClass(icon, classToAdd);
        if (options.keyboard) {
            icon.tabIndex = '0';
        }
        this._icon = icon;
        this._initInteraction();
        if (options.riseOnHover) {
            L.DomEvent
                .on(icon, 'mouseover', this._bringToFront, this)
                .on(icon, 'mouseout', this._resetZIndex, this);
        }
        var newShadow = options.icon.createShadow(this._shadow),
            addShadow = false;
        if (newShadow !== this._shadow) {
            this._removeShadow();
            addShadow = true;
        }
        if (newShadow) {
            L.DomUtil.addClass(newShadow, classToAdd);
        }
        this._shadow = newShadow;
        if (options.opacity
< 1) {
            this._updateOpacity();
        }
        var panes = this._map._panes;
        if (addIcon) {
            panes.markerPane.appendChild(this._icon);
        }
        if (newShadow && addShadow) {
            panes.shadowPane.appendChild(this._shadow);
        }
    },
    _removeIcon: function () {
        if (this.options.riseOnHover) {
            L.DomEvent
                .off(this._icon, 'mouseover', this._bringToFront)
                .off(this._icon, 'mouseout', this._resetZIndex);
        }
        this._map._panes.markerPane.removeChild(this._icon);
        this._icon = null;
    },
    _removeShadow: function () {
        if (this._shadow) {
            this._map._panes.shadowPane.removeChild(this._shadow);
        }
        this._shadow = null;
    },
    _setPos: function (pos) {
        L.DomUtil.setPosition(this._icon, pos);
        if (this._shadow) {
            L.DomUtil.setPosition(this._shadow, pos);
        }
        this._zIndex = pos.y + this.options.zIndexOffset;
        this._resetZIndex();
    },
    _updateZIndex: function (offset) {
        this._icon.style.zIndex = this._zIndex + offset;
    },
    _animateZoom: function (opt) {
        var pos = this._map._latLngToNewLayerPoint(this._latlng, opt.zoom, opt.center).round();
        this._setPos(pos);
    },
    _initInteraction: function () {
        if (!this.options.clickable) { return; }
        // TODO refactor into something shared with Map/Path/etc. to DRY it up
        var icon = this._icon,
            events = ['dblclick', 'mousedown', 'mouseover', 'mouseout', 'contextmenu'];
        L.DomUtil.addClass(icon, 'leaflet-clickable');
        L.DomEvent.on(icon, 'click', this._onMouseClick, this);
        L.DomEvent.on(icon, 'keypress', this._onKeyPress, this);
        for (var i = 0; i
< events.length; i++) {
            L.DomEvent.on(icon, events[i], this._fireMouseEvent, this);
        }
        if (L.Handler.MarkerDrag) {
            this.dragging = new L.Handler.MarkerDrag(this);
            if (this.options.draggable) {
                this.dragging.enable();
            }
        }
    },
    _onMouseClick: function (e) {
        var wasDragged = this.dragging && this.dragging.moved();
        if (this.hasEventListeners(e.type) || wasDragged) {
            L.DomEvent.stopPropagation(e);
        }
        if (wasDragged) { return; }
        if ((!this.dragging || !this.dragging._enabled) && this._map.dragging && this._map.dragging.moved()) { return; }
        this.fire(e.type, {
            originalEvent: e,
            latlng: this._latlng
        });
    },
    _onKeyPress: function (e) {
        if (e.keyCode === 13) {
            this.fire('click', {
                originalEvent: e,
                latlng: this._latlng
            });
        }
    },
    _fireMouseEvent: function (e) {
        this.fire(e.type, {
            originalEvent: e,
            latlng: this._latlng
        });
        // TODO proper custom event propagation
        // this line will always be called if marker is in a FeatureGroup
        if (e.type === 'contextmenu' && this.hasEventListeners(e.type)) {
            L.DomEvent.preventDefault(e);
        }
        if (e.type !== 'mousedown') {
            L.DomEvent.stopPropagation(e);
        } else {
            L.DomEvent.preventDefault(e);
        }
    },
    setOpacity: function (opacity) {
        this.options.opacity = opacity;
        if (this._map) {
            this._updateOpacity();
        }
        return this;
    },
    _updateOpacity: function () {
        L.DomUtil.setOpacity(this._icon, this.options.opacity);
        if (this._shadow) {
            L.DomUtil.setOpacity(this._shadow, this.options.opacity);
        }
    },
    _bringToFront: function () {
        this._updateZIndex(this.options.riseOffset);
    },
    _resetZIndex: function () {
        this._updateZIndex(0);
    }
});
L.marker = function (latlng, options) {
    return new L.Marker(latlng, options);
};
/*
 * L.DivIcon is a lightweight HTML-based icon class (as opposed to the image-based L.Icon)
 * to use with L.Marker.
 */
L.DivIcon = L.Icon.extend({
    options: {
        iconSize: [12, 12], // also can be set through CSS
        /*
        iconAnchor: (Point)
        popupAnchor: (Point)
        html: (String)
        bgPos: (Point)
        */
        className: 'leaflet-div-icon',
        html: false
    },
    createIcon: function (oldIcon) {
        var div = (oldIcon && oldIcon.tagName === 'DIV') ? oldIcon : document.createElement('div'),
            options = this.options;
        if (options.html !== false) {
            div.innerHTML = options.html;
        } else {
            div.innerHTML = '';
        }
        if (options.bgPos) {
            div.style.backgroundPosition =
                    (-options.bgPos.x) + 'px ' + (-options.bgPos.y) + 'px';
        }
        this._setIconStyles(div, 'icon');
        return div;
    },
    createShadow: function () {
        return null;
    }
});
L.divIcon = function (options) {
    return new L.DivIcon(options);
};
/*
 * L.Popup is used for displaying popups on the map.
 */
L.Map.mergeOptions({
    closePopupOnClick: true
});
L.Popup = L.Class.extend({
    includes: L.Mixin.Events,
    options: {
        minWidth: 50,
        maxWidth: 300,
        // maxHeight: null,
        autoPan: true,
        closeButton: true,
        offset: [0, 7],
        autoPanPadding: [5, 5],
        // autoPanPaddingTopLeft: null,
        // autoPanPaddingBottomRight: null,
        keepInView: false,
        className: '',
        zoomAnimation: true
    },
    initialize: function (options, source) {
        L.setOptions(this, options);
        this._source = source;
        this._animated = L.Browser.any3d && this.options.zoomAnimation;
        this._isOpen = false;
    },
    onAdd: function (map) {
        this._map = map;
        if (!this._container) {
            this._initLayout();
        }
        var animFade = map.options.fadeAnimation;
        if (animFade) {
            L.DomUtil.setOpacity(this._container, 0);
        }
        map._panes.popupPane.appendChild(this._container);
        map.on(this._getEvents(), this);
        this.update();
        if (animFade) {
            L.DomUtil.setOpacity(this._container, 1);
        }
        this.fire('open');
        map.fire('popupopen', {popup: this});
        if (this._source) {
            this._source.fire('popupopen', {popup: this});
        }
    },
    addTo: function (map) {
        map.addLayer(this);
        return this;
    },
    openOn: function (map) {
        map.openPopup(this);
        return this;
    },
    onRemove: function (map) {
        map._panes.popupPane.removeChild(this._container);
        L.Util.falseFn(this._container.offsetWidth); // force reflow
        map.off(this._getEvents(), this);
        if (map.options.fadeAnimation) {
            L.DomUtil.setOpacity(this._container, 0);
        }
        this._map = null;
        this.fire('close');
        map.fire('popupclose', {popup: this});
        if (this._source) {
            this._source.fire('popupclose', {popup: this});
        }
    },
    getLatLng: function () {
        return this._latlng;
    },
    setLatLng: function (latlng) {
        this._latlng = L.latLng(latlng);
        if (this._map) {
            this._updatePosition();
            this._adjustPan();
        }
        return this;
    },
    getContent: function () {
        return this._content;
    },
    setContent: function (content) {
        this._content = content;
        this.update();
        return this;
    },
    update: function () {
        if (!this._map) { return; }
        this._container.style.visibility = 'hidden';
        this._updateContent();
        this._updateLayout();
        this._updatePosition();
        this._container.style.visibility = '';
        this._adjustPan();
    },
    _getEvents: function () {
        var events = {
            viewreset: this._updatePosition
        };
        if (this._animated) {
            events.zoomanim = this._zoomAnimation;
        }
        if ('closeOnClick' in this.options ? this.options.closeOnClick : this._map.options.closePopupOnClick) {
            events.preclick = this._close;
        }
        if (this.options.keepInView) {
            events.moveend = this._adjustPan;
        }
        return events;
    },
    _close: function () {
        if (this._map) {
            this._map.closePopup(this);
        }
    },
    _initLayout: function () {
        var prefix = 'leaflet-popup',
            containerClass = prefix + ' ' + this.options.className + ' leaflet-zoom-' +
                    (this._animated ? 'animated' : 'hide'),
            container = this._container = L.DomUtil.create('div', containerClass),
            closeButton;
        if (this.options.closeButton) {
            closeButton = this._closeButton =
                    L.DomUtil.create('a', prefix + '-close-button', container);
            closeButton.href = '#close';
            closeButton.innerHTML = '&#215;';
            L.DomEvent.disableClickPropagation(closeButton);
            L.DomEvent.on(closeButton, 'click', this._onCloseButtonClick, this);
        }
        var wrapper = this._wrapper =
                L.DomUtil.create('div', prefix + '-content-wrapper', container);
        L.DomEvent.disableClickPropagation(wrapper);
        this._contentNode = L.DomUtil.create('div', prefix + '-content', wrapper);
        L.DomEvent.disableScrollPropagation(this._contentNode);
        L.DomEvent.on(wrapper, 'contextmenu', L.DomEvent.stopPropagation);
        this._tipContainer = L.DomUtil.create('div', prefix + '-tip-container', container);
        this._tip = L.DomUtil.create('div', prefix + '-tip', this._tipContainer);
    },
    _updateContent: function () {
        if (!this._content) { return; }
        if (typeof this._content === 'string') {
            this._contentNode.innerHTML = this._content;
        } else {
            while (this._contentNode.hasChildNodes()) {
                this._contentNode.removeChild(this._contentNode.firstChild);
            }
            this._contentNode.appendChild(this._content);
        }
        this.fire('contentupdate');
    },
    _updateLayout: function () {
        var container = this._contentNode,
            style = container.style;
        style.width = '';
        style.whiteSpace = 'nowrap';
        var width = container.offsetWidth;
        width = Math.min(width, this.options.maxWidth);
        width = Math.max(width, this.options.minWidth);
        style.width = (width + 1) + 'px';
        style.whiteSpace = '';
        style.height = '';
        var height = container.offsetHeight,
            maxHeight = this.options.maxHeight,
            scrolledClass = 'leaflet-popup-scrolled';
        if (maxHeight && height >
 maxHeight) {
            style.height = maxHeight + 'px';
            L.DomUtil.addClass(container, scrolledClass);
        } else {
            L.DomUtil.removeClass(container, scrolledClass);
        }
        this._containerWidth = this._container.offsetWidth;
    },
    _updatePosition: function () {
        if (!this._map) { return; }
        var pos = this._map.latLngToLayerPoint(this._latlng),
            animated = this._animated,
            offset = L.point(this.options.offset);
        if (animated) {
            L.DomUtil.setPosition(this._container, pos);
        }
        this._containerBottom = -offset.y - (animated ? 0 : pos.y);
        this._containerLeft = -Math.round(this._containerWidth / 2) + offset.x + (animated ? 0 : pos.x);
        // bottom position the popup in case the height of the popup changes (images loading etc)
        this._container.style.bottom = this._containerBottom + 'px';
        this._container.style.left = this._containerLeft + 'px';
    },
    _zoomAnimation: function (opt) {
        var pos = this._map._latLngToNewLayerPoint(this._latlng, opt.zoom, opt.center);
        L.DomUtil.setPosition(this._container, pos);
    },
    _adjustPan: function () {
        if (!this.options.autoPan) { return; }
        var map = this._map,
            containerHeight = this._container.offsetHeight,
            containerWidth = this._containerWidth,
            layerPos = new L.Point(this._containerLeft, -containerHeight - this._containerBottom);
        if (this._animated) {
            layerPos._add(L.DomUtil.getPosition(this._container));
        }
        var containerPos = map.layerPointToContainerPoint(layerPos),
            padding = L.point(this.options.autoPanPadding),
            paddingTL = L.point(this.options.autoPanPaddingTopLeft || padding),
            paddingBR = L.point(this.options.autoPanPaddingBottomRight || padding),
            size = map.getSize(),
            dx = 0,
            dy = 0;
        if (containerPos.x + containerWidth + paddingBR.x >
 size.x) { // right
            dx = containerPos.x + containerWidth - size.x + paddingBR.x;
        }
        if (containerPos.x - dx - paddingTL.x
< 0) { // left
            dx = containerPos.x - paddingTL.x;
        }
        if (containerPos.y + containerHeight + paddingBR.y >
 size.y) { // bottom
            dy = containerPos.y + containerHeight - size.y + paddingBR.y;
        }
        if (containerPos.y - dy - paddingTL.y
< 0) { // top
            dy = containerPos.y - paddingTL.y;
        }
        if (dx || dy) {
            map
                .fire('autopanstart')
                .panBy([dx, dy]);
        }
    },
    _onCloseButtonClick: function (e) {
        this._close();
        L.DomEvent.stop(e);
    }
});
L.popup = function (options, source) {
    return new L.Popup(options, source);
};
L.Map.include({
    openPopup: function (popup, latlng, options) { // (Popup) or (String || HTMLElement, LatLng[, Object])
        this.closePopup();
        if (!(popup instanceof L.Popup)) {
            var content = popup;
            popup = new L.Popup(options)
                .setLatLng(latlng)
                .setContent(content);
        }
        popup._isOpen = true;
        this._popup = popup;
        return this.addLayer(popup);
    },
    closePopup: function (popup) {
        if (!popup || popup === this._popup) {
            popup = this._popup;
            this._popup = null;
        }
        if (popup) {
            this.removeLayer(popup);
            popup._isOpen = false;
        }
        return this;
    }
});
/*
 * Popup extension to L.Marker, adding popup-related methods.
 */
L.Marker.include({
    openPopup: function () {
        if (this._popup && this._map && !this._map.hasLayer(this._popup)) {
            this._popup.setLatLng(this._latlng);
            this._map.openPopup(this._popup);
        }
        return this;
    },
    closePopup: function () {
        if (this._popup) {
            this._popup._close();
        }
        return this;
    },
    togglePopup: function () {
        if (this._popup) {
            if (this._popup._isOpen) {
                this.closePopup();
            } else {
                this.openPopup();
            }
        }
        return this;
    },
    bindPopup: function (content, options) {
        var anchor = L.point(this.options.icon.options.popupAnchor || [0, 0]);
        anchor = anchor.add(L.Popup.prototype.options.offset);
        if (options && options.offset) {
            anchor = anchor.add(options.offset);
        }
        options = L.extend({offset: anchor}, options);
        if (!this._popupHandlersAdded) {
            this
                .on('click', this.togglePopup, this)
                .on('remove', this.closePopup, this)
                .on('move', this._movePopup, this);
            this._popupHandlersAdded = true;
        }
        if (content instanceof L.Popup) {
            L.setOptions(content, options);
            this._popup = content;
        } else {
            this._popup = new L.Popup(options, this)
                .setContent(content);
        }
        return this;
    },
    setPopupContent: function (content) {
        if (this._popup) {
            this._popup.setContent(content);
        }
        return this;
    },
    unbindPopup: function () {
        if (this._popup) {
            this._popup = null;
            this
                .off('click', this.togglePopup, this)
                .off('remove', this.closePopup, this)
                .off('move', this._movePopup, this);
            this._popupHandlersAdded = false;
        }
        return this;
    },
    getPopup: function () {
        return this._popup;
    },
    _movePopup: function (e) {
        this._popup.setLatLng(e.latlng);
    }
});
/*
 * L.LayerGroup is a class to combine several layers into one so that
 * you can manipulate the group (e.g. add/remove it) as one layer.
 */
L.LayerGroup = L.Class.extend({
    initialize: function (layers) {
        this._layers = {};
        var i, len;
        if (layers) {
            for (i = 0, len = layers.length; i
< len; i++) {
                this.addLayer(layers[i]);
            }
        }
    },
    addLayer: function (layer) {
        var id = this.getLayerId(layer);
        this._layers[id] = layer;
        if (this._map) {
            this._map.addLayer(layer);
        }
        return this;
    },
    removeLayer: function (layer) {
        var id = layer in this._layers ? layer : this.getLayerId(layer);
        if (this._map && this._layers[id]) {
            this._map.removeLayer(this._layers[id]);
        }
        delete this._layers[id];
        return this;
    },
    hasLayer: function (layer) {
        if (!layer) { return false; }
        return (layer in this._layers || this.getLayerId(layer) in this._layers);
    },
    clearLayers: function () {
        this.eachLayer(this.removeLayer, this);
        return this;
    },
    invoke: function (methodName) {
        var args = Array.prototype.slice.call(arguments, 1),
            i, layer;
        for (i in this._layers) {
            layer = this._layers[i];
            if (layer[methodName]) {
                layer[methodName].apply(layer, args);
            }
        }
        return this;
    },
    onAdd: function (map) {
        this._map = map;
        this.eachLayer(map.addLayer, map);
    },
    onRemove: function (map) {
        this.eachLayer(map.removeLayer, map);
        this._map = null;
    },
    addTo: function (map) {
        map.addLayer(this);
        return this;
    },
    eachLayer: function (method, context) {
        for (var i in this._layers) {
            method.call(context, this._layers[i]);
        }
        return this;
    },
    getLayer: function (id) {
        return this._layers[id];
    },
    getLayers: function () {
        var layers = [];
        for (var i in this._layers) {
            layers.push(this._layers[i]);
        }
        return layers;
    },
    setZIndex: function (zIndex) {
        return this.invoke('setZIndex', zIndex);
    },
    getLayerId: function (layer) {
        return L.stamp(layer);
    }
});
L.layerGroup = function (layers) {
    return new L.LayerGroup(layers);
};
/*
 * L.FeatureGroup extends L.LayerGroup by introducing mouse events and additional methods
 * shared between a group of interactive layers (like vectors or markers).
 */
L.FeatureGroup = L.LayerGroup.extend({
    includes: L.Mixin.Events,
    statics: {
        EVENTS: 'click dblclick mouseover mouseout mousemove contextmenu popupopen popupclose'
    },
    addLayer: function (layer) {
        if (this.hasLayer(layer)) {
            return this;
        }
        if ('on' in layer) {
            layer.on(L.FeatureGroup.EVENTS, this._propagateEvent, this);
        }
        L.LayerGroup.prototype.addLayer.call(this, layer);
        if (this._popupContent && layer.bindPopup) {
            layer.bindPopup(this._popupContent, this._popupOptions);
        }
        return this.fire('layeradd', {layer: layer});
    },
    removeLayer: function (layer) {
        if (!this.hasLayer(layer)) {
            return this;
        }
        if (layer in this._layers) {
            layer = this._layers[layer];
        }
        layer.off(L.FeatureGroup.EVENTS, this._propagateEvent, this);
        L.LayerGroup.prototype.removeLayer.call(this, layer);
        if (this._popupContent) {
            this.invoke('unbindPopup');
        }
        return this.fire('layerremove', {layer: layer});
    },
    bindPopup: function (content, options) {
        this._popupContent = content;
        this._popupOptions = options;
        return this.invoke('bindPopup', content, options);
    },
    openPopup: function (latlng) {
        // open popup on the first layer
        for (var id in this._layers) {
            this._layers[id].openPopup(latlng);
            break;
        }
        return this;
    },
    setStyle: function (style) {
        return this.invoke('setStyle', style);
    },
    bringToFront: function () {
        return this.invoke('bringToFront');
    },
    bringToBack: function () {
        return this.invoke('bringToBack');
    },
    getBounds: function () {
        var bounds = new L.LatLngBounds();
        this.eachLayer(function (layer) {
            bounds.extend(layer instanceof L.Marker ? layer.getLatLng() : layer.getBounds());
        });
        return bounds;
    },
    _propagateEvent: function (e) {
        e = L.extend({
            layer: e.target,
            target: this
        }, e);
        this.fire(e.type, e);
    }
});
L.featureGroup = function (layers) {
    return new L.FeatureGroup(layers);
};
/*
 * L.Path is a base class for rendering vector paths on a map. Inherited by Polyline, Circle, etc.
 */
L.Path = L.Class.extend({
    includes: [L.Mixin.Events],
    statics: {
        // how much to extend the clip area around the map view
        // (relative to its size, e.g. 0.5 is half the screen in each direction)
        // set it so that SVG element doesn't exceed 1280px (vectors flicker on dragend if it is)
        CLIP_PADDING: (function () {
            var max = L.Browser.mobile ? 1280 : 2000,
                target = (max / Math.max(window.outerWidth, window.outerHeight) - 1) / 2;
            return Math.max(0, Math.min(0.5, target));
        })()
    },
    options: {
        stroke: true,
        color: '#0033ff',
        dashArray: null,
        lineCap: null,
        lineJoin: null,
        weight: 5,
        opacity: 0.5,
        fill: false,
        fillColor: null, //same as color by default
        fillOpacity: 0.2,
        clickable: true
    },
    initialize: function (options) {
        L.setOptions(this, options);
    },
    onAdd: function (map) {
        this._map = map;
        if (!this._container) {
            this._initElements();
            this._initEvents();
        }
        this.projectLatlngs();
        this._updatePath();
        if (this._container) {
            this._map._pathRoot.appendChild(this._container);
        }
        this.fire('add');
        map.on({
            'viewreset': this.projectLatlngs,
            'moveend': this._updatePath
        }, this);
    },
    addTo: function (map) {
        map.addLayer(this);
        return this;
    },
    onRemove: function (map) {
        map._pathRoot.removeChild(this._container);
        // Need to fire remove event before we set _map to null as the event hooks might need the object
        this.fire('remove');
        this._map = null;
        if (L.Browser.vml) {
            this._container = null;
            this._stroke = null;
            this._fill = null;
        }
        map.off({
            'viewreset': this.projectLatlngs,
            'moveend': this._updatePath
        }, this);
    },
    projectLatlngs: function () {
        // do all projection stuff here
    },
    setStyle: function (style) {
        L.setOptions(this, style);
        if (this._container) {
            this._updateStyle();
        }
        return this;
    },
    redraw: function () {
        if (this._map) {
            this.projectLatlngs();
            this._updatePath();
        }
        return this;
    }
});
L.Map.include({
    _updatePathViewport: function () {
        var p = L.Path.CLIP_PADDING,
            size = this.getSize(),
            panePos = L.DomUtil.getPosition(this._mapPane),
            min = panePos.multiplyBy(-1)._subtract(size.multiplyBy(p)._round()),
            max = min.add(size.multiplyBy(1 + p * 2)._round());
        this._pathViewport = new L.Bounds(min, max);
    }
});
/*
 * Extends L.Path with SVG-specific rendering code.
 */
L.Path.SVG_NS = 'http://www.w3.org/2000/svg';
L.Browser.svg = !!(document.createElementNS && document.createElementNS(L.Path.SVG_NS, 'svg').createSVGRect);
L.Path = L.Path.extend({
    statics: {
        SVG: L.Browser.svg
    },
    bringToFront: function () {
        var root = this._map._pathRoot,
            path = this._container;
        if (path && root.lastChild !== path) {
            root.appendChild(path);
        }
        return this;
    },
    bringToBack: function () {
        var root = this._map._pathRoot,
            path = this._container,
            first = root.firstChild;
        if (path && first !== path) {
            root.insertBefore(path, first);
        }
        return this;
    },
    getPathString: function () {
        // form path string here
    },
    _createElement: function (name) {
        return document.createElementNS(L.Path.SVG_NS, name);
    },
    _initElements: function () {
        this._map._initPathRoot();
        this._initPath();
        this._initStyle();
    },
    _initPath: function () {
        this._container = this._createElement('g');
        this._path = this._createElement('path');
        if (this.options.className) {
            L.DomUtil.addClass(this._path, this.options.className);
        }
        this._container.appendChild(this._path);
    },
    _initStyle: function () {
        if (this.options.stroke) {
            this._path.setAttribute('stroke-linejoin', 'round');
            this._path.setAttribute('stroke-linecap', 'round');
        }
        if (this.options.fill) {
            this._path.setAttribute('fill-rule', 'evenodd');
        }
        if (this.options.pointerEvents) {
            this._path.setAttribute('pointer-events', this.options.pointerEvents);
        }
        if (!this.options.clickable && !this.options.pointerEvents) {
            this._path.setAttribute('pointer-events', 'none');
        }
        this._updateStyle();
    },
    _updateStyle: function () {
        if (this.options.stroke) {
            this._path.setAttribute('stroke', this.options.color);
            this._path.setAttribute('stroke-opacity', this.options.opacity);
            this._path.setAttribute('stroke-width', this.options.weight);
            if (this.options.dashArray) {
                this._path.setAttribute('stroke-dasharray', this.options.dashArray);
            } else {
                this._path.removeAttribute('stroke-dasharray');
            }
            if (this.options.lineCap) {
                this._path.setAttribute('stroke-linecap', this.options.lineCap);
            }
            if (this.options.lineJoin) {
                this._path.setAttribute('stroke-linejoin', this.options.lineJoin);
            }
        } else {
            this._path.setAttribute('stroke', 'none');
        }
        if (this.options.fill) {
            this._path.setAttribute('fill', this.options.fillColor || this.options.color);
            this._path.setAttribute('fill-opacity', this.options.fillOpacity);
        } else {
            this._path.setAttribute('fill', 'none');
        }
    },
    _updatePath: function () {
        var str = this.getPathString();
        if (!str) {
            // fix webkit empty string parsing bug
            str = 'M0 0';
        }
        this._path.setAttribute('d', str);
    },
    // TODO remove duplication with L.Map
    _initEvents: function () {
        if (this.options.clickable) {
            if (L.Browser.svg || !L.Browser.vml) {
                L.DomUtil.addClass(this._path, 'leaflet-clickable');
            }
            L.DomEvent.on(this._container, 'click', this._onMouseClick, this);
            var events = ['dblclick', 'mousedown', 'mouseover',
                          'mouseout', 'mousemove', 'contextmenu'];
            for (var i = 0; i
< events.length; i++) {
                L.DomEvent.on(this._container, events[i], this._fireMouseEvent, this);
            }
        }
    },
    _onMouseClick: function (e) {
        if (this._map.dragging && this._map.dragging.moved()) { return; }
        this._fireMouseEvent(e);
    },
    _fireMouseEvent: function (e) {
        if (!this.hasEventListeners(e.type)) { return; }
        var map = this._map,
            containerPoint = map.mouseEventToContainerPoint(e),
            layerPoint = map.containerPointToLayerPoint(containerPoint),
            latlng = map.layerPointToLatLng(layerPoint);
        this.fire(e.type, {
            latlng: latlng,
            layerPoint: layerPoint,
            containerPoint: containerPoint,
            originalEvent: e
        });
        if (e.type === 'contextmenu') {
            L.DomEvent.preventDefault(e);
        }
        if (e.type !== 'mousemove') {
            L.DomEvent.stopPropagation(e);
        }
    }
});
L.Map.include({
    _initPathRoot: function () {
        if (!this._pathRoot) {
            this._pathRoot = L.Path.prototype._createElement('svg');
            this._panes.overlayPane.appendChild(this._pathRoot);
            if (this.options.zoomAnimation && L.Browser.any3d) {
                L.DomUtil.addClass(this._pathRoot, 'leaflet-zoom-animated');
                this.on({
                    'zoomanim': this._animatePathZoom,
                    'zoomend': this._endPathZoom
                });
            } else {
                L.DomUtil.addClass(this._pathRoot, 'leaflet-zoom-hide');
            }
            this.on('moveend', this._updateSvgViewport);
            this._updateSvgViewport();
        }
    },
    _animatePathZoom: function (e) {
        var scale = this.getZoomScale(e.zoom),
            offset = this._getCenterOffset(e.center)._multiplyBy(-scale)._add(this._pathViewport.min);
        this._pathRoot.style[L.DomUtil.TRANSFORM] =
                L.DomUtil.getTranslateString(offset) + ' scale(' + scale + ') ';
        this._pathZooming = true;
    },
    _endPathZoom: function () {
        this._pathZooming = false;
    },
    _updateSvgViewport: function () {
        if (this._pathZooming) {
            // Do not update SVGs while a zoom animation is going on otherwise the animation will break.
            // When the zoom animation ends we will be updated again anyway
            // This fixes the case where you do a momentum move and zoom while the move is still ongoing.
            return;
        }
        this._updatePathViewport();
        var vp = this._pathViewport,
            min = vp.min,
            max = vp.max,
            width = max.x - min.x,
            height = max.y - min.y,
            root = this._pathRoot,
            pane = this._panes.overlayPane;
        // Hack to make flicker on drag end on mobile webkit less irritating
        if (L.Browser.mobileWebkit) {
            pane.removeChild(root);
        }
        L.DomUtil.setPosition(root, min);
        root.setAttribute('width', width);
        root.setAttribute('height', height);
        root.setAttribute('viewBox', [min.x, min.y, width, height].join(' '));
        if (L.Browser.mobileWebkit) {
            pane.appendChild(root);
        }
    }
});
/*
 * Popup extension to L.Path (polylines, polygons, circles), adding popup-related methods.
 */
L.Path.include({
    bindPopup: function (content, options) {
        if (content instanceof L.Popup) {
            this._popup = content;
        } else {
            if (!this._popup || options) {
                this._popup = new L.Popup(options, this);
            }
            this._popup.setContent(content);
        }
        if (!this._popupHandlersAdded) {
            this
                .on('click', this._openPopup, this)
                .on('remove', this.closePopup, this);
            this._popupHandlersAdded = true;
        }
        return this;
    },
    unbindPopup: function () {
        if (this._popup) {
            this._popup = null;
            this
                .off('click', this._openPopup)
                .off('remove', this.closePopup);
            this._popupHandlersAdded = false;
        }
        return this;
    },
    openPopup: function (latlng) {
        if (this._popup) {
            // open the popup from one of the path's points if not specified
            latlng = latlng || this._latlng ||
                     this._latlngs[Math.floor(this._latlngs.length / 2)];
            this._openPopup({latlng: latlng});
        }
        return this;
    },
    closePopup: function () {
        if (this._popup) {
            this._popup._close();
        }
        return this;
    },
    _openPopup: function (e) {
        this._popup.setLatLng(e.latlng);
        this._map.openPopup(this._popup);
    }
});
/*
 * Vector rendering for IE6-8 through VML.
 * Thanks to Dmitry Baranovsky and his Raphael library for inspiration!
 */
L.Browser.vml = !L.Browser.svg && (function () {
    try {
        var div = document.createElement('div');
        div.innerHTML = '
<v:shape adj="1"/>
';
        var shape = div.firstChild;
        shape.style.behavior = 'url(#default#VML)';
        return shape && (typeof shape.adj === 'object');
    } catch (e) {
        return false;
    }
}());
L.Path = L.Browser.svg || !L.Browser.vml ? L.Path : L.Path.extend({
    statics: {
        VML: true,
        CLIP_PADDING: 0.02
    },
    _createElement: (function () {
        try {
            document.namespaces.add('lvml', 'urn:schemas-microsoft-com:vml');
            return function (name) {
                return document.createElement('
<lvml:' + name + ' class="lvml">
');
            };
        } catch (e) {
            return function (name) {
                return document.createElement(
                        '
<' + name + ' xmlns="urn:schemas-microsoft.com:vml" class="lvml">
');
            };
        }
    }()),
    _initPath: function () {
        var container = this._container = this._createElement('shape');
        L.DomUtil.addClass(container, 'leaflet-vml-shape' +
            (this.options.className ? ' ' + this.options.className : ''));
        if (this.options.clickable) {
            L.DomUtil.addClass(container, 'leaflet-clickable');
        }
        container.coordsize = '1 1';
        this._path = this._createElement('path');
        container.appendChild(this._path);
        this._map._pathRoot.appendChild(container);
    },
    _initStyle: function () {
        this._updateStyle();
    },
    _updateStyle: function () {
        var stroke = this._stroke,
            fill = this._fill,
            options = this.options,
            container = this._container;
        container.stroked = options.stroke;
        container.filled = options.fill;
        if (options.stroke) {
            if (!stroke) {
                stroke = this._stroke = this._createElement('stroke');
                stroke.endcap = 'round';
                container.appendChild(stroke);
            }
            stroke.weight = options.weight + 'px';
            stroke.color = options.color;
            stroke.opacity = options.opacity;
            if (options.dashArray) {
                stroke.dashStyle = L.Util.isArray(options.dashArray) ?
                    options.dashArray.join(' ') :
                    options.dashArray.replace(/( *, *)/g, ' ');
            } else {
                stroke.dashStyle = '';
            }
            if (options.lineCap) {
                stroke.endcap = options.lineCap.replace('butt', 'flat');
            }
            if (options.lineJoin) {
                stroke.joinstyle = options.lineJoin;
            }
        } else if (stroke) {
            container.removeChild(stroke);
            this._stroke = null;
        }
        if (options.fill) {
            if (!fill) {
                fill = this._fill = this._createElement('fill');
                container.appendChild(fill);
            }
            fill.color = options.fillColor || options.color;
            fill.opacity = options.fillOpacity;
        } else if (fill) {
            container.removeChild(fill);
            this._fill = null;
        }
    },
    _updatePath: function () {
        var style = this._container.style;
        style.display = 'none';
        this._path.v = this.getPathString() + ' '; // the space fixes IE empty path string bug
        style.display = '';
    }
});
L.Map.include(L.Browser.svg || !L.Browser.vml ? {} : {
    _initPathRoot: function () {
        if (this._pathRoot) { return; }
        var root = this._pathRoot = document.createElement('div');
        root.className = 'leaflet-vml-container';
        this._panes.overlayPane.appendChild(root);
        this.on('moveend', this._updatePathViewport);
        this._updatePathViewport();
    }
});
/*
 * Vector rendering for all browsers that support canvas.
 */
L.Browser.canvas = (function () {
    return !!document.createElement('canvas').getContext;
}());
L.Path = (L.Path.SVG && !window.L_PREFER_CANVAS) || !L.Browser.canvas ? L.Path : L.Path.extend({
    statics: {
        //CLIP_PADDING: 0.02, // not sure if there's a need to set it to a small value
        CANVAS: true,
        SVG: false
    },
    redraw: function () {
        if (this._map) {
            this.projectLatlngs();
            this._requestUpdate();
        }
        return this;
    },
    setStyle: function (style) {
        L.setOptions(this, style);
        if (this._map) {
            this._updateStyle();
            this._requestUpdate();
        }
        return this;
    },
    onAdd: function (map) {
        this._map = map;
        if (!this._container) {
            this._initElements();
            this._initEvents();
        }
        this.projectLatlngs();
        this._updatePath();
        if (this._container) {
            this._map._pathRoot.appendChild(this._container);
        }
        this.fire('add');
        map.on({
            'viewreset': this.projectLatlngs,
            'moveend': this._updatePath,
            'canvasredraw': this._updatePath
        }, this);
    },
    onRemove: function (map) {
        map
            .off('viewreset', this.projectLatlngs, this)
            .off('moveend', this._updatePath, this)
            .off('canvasredraw', this._updatePath, this);
        if (this.options.clickable) {
            this._map.off('click', this._onClick, this);
            this._map.off('mousemove', this._onMouseMove, this);
        }
        this._requestUpdate();
        this.fire('remove');
        this._map = null;
    },
    _requestUpdate: function () {
        if (this._map && !L.Path._updateRequest) {
            L.Path._updateRequest = L.Util.requestAnimFrame(this._fireCanvasRedraw, this._map);
        }
    },
    _fireCanvasRedraw: function () {
        L.Path._updateRequest = null;
        this.fire('canvasredraw');
    },
    _initElements: function () {
        this._map._initPathRoot();
        this._ctx = this._map._canvasCtx;
    },
    _updateStyle: function () {
        var options = this.options;
        if (options.stroke) {
            this._ctx.lineWidth = options.weight;
            this._ctx.strokeStyle = options.color;
        }
        if (options.fill) {
            this._ctx.fillStyle = options.fillColor || options.color;
        }
    },
    _drawPath: function () {
        var i, j, len, len2, point, drawMethod;
        this._ctx.beginPath();
        for (i = 0, len = this._parts.length; i
< len; i++) {
            for (j = 0, len2 = this._parts[i].length; j
< len2; j++) {
                point = this._parts[i][j];
                drawMethod = (j === 0 ? 'move' : 'line') + 'To';
                this._ctx[drawMethod](point.x, point.y);
            }
            // TODO refactor ugly hack
            if (this instanceof L.Polygon) {
                this._ctx.closePath();
            }
        }
    },
    _checkIfEmpty: function () {
        return !this._parts.length;
    },
    _updatePath: function () {
        if (this._checkIfEmpty()) { return; }
        var ctx = this._ctx,
            options = this.options;
        this._drawPath();
        ctx.save();
        this._updateStyle();
        if (options.fill) {
            ctx.globalAlpha = options.fillOpacity;
            ctx.fill();
        }
        if (options.stroke) {
            ctx.globalAlpha = options.opacity;
            ctx.stroke();
        }
        ctx.restore();
        // TODO optimization: 1 fill/stroke for all features with equal style instead of 1 for each feature
    },
    _initEvents: function () {
        if (this.options.clickable) {
            // TODO dblclick
            this._map.on('mousemove', this._onMouseMove, this);
            this._map.on('click', this._onClick, this);
        }
    },
    _onClick: function (e) {
        if (this._containsPoint(e.layerPoint)) {
            this.fire('click', e);
        }
    },
    _onMouseMove: function (e) {
        if (!this._map || this._map._animatingZoom) { return; }
        // TODO don't do on each move
        if (this._containsPoint(e.layerPoint)) {
            this._ctx.canvas.style.cursor = 'pointer';
            this._mouseInside = true;
            this.fire('mouseover', e);
        } else if (this._mouseInside) {
            this._ctx.canvas.style.cursor = '';
            this._mouseInside = false;
            this.fire('mouseout', e);
        }
    }
});
L.Map.include((L.Path.SVG && !window.L_PREFER_CANVAS) || !L.Browser.canvas ? {} : {
    _initPathRoot: function () {
        var root = this._pathRoot,
            ctx;
        if (!root) {
            root = this._pathRoot = document.createElement('canvas');
            root.style.position = 'absolute';
            ctx = this._canvasCtx = root.getContext('2d');
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            this._panes.overlayPane.appendChild(root);
            if (this.options.zoomAnimation) {
                this._pathRoot.className = 'leaflet-zoom-animated';
                this.on('zoomanim', this._animatePathZoom);
                this.on('zoomend', this._endPathZoom);
            }
            this.on('moveend', this._updateCanvasViewport);
            this.on('canvasredraw', this._updateCanvasViewport);
            this._updateCanvasViewport();
        }
    },
    _updateCanvasViewport: function () {
        // don't redraw while zooming. See _updateSvgViewport for more details
        if (this._pathZooming) { return; }
        this._updatePathViewport();
        var vp = this._pathViewport,
            min = vp.min,
            size = vp.max.subtract(min),
            root = this._pathRoot;
        //TODO check if this works properly on mobile webkit
        L.DomUtil.setPosition(root, min);
        root.width = size.x;
        root.height = size.y;
        root.getContext('2d').translate(-min.x, -min.y);
    }
});
/*
 * L.LineUtil contains different utility functions for line segments
 * and polylines (clipping, simplification, distances, etc.)
 */
/*jshint bitwise:false */ // allow bitwise operations for this file
L.LineUtil = {
    // Simplify polyline with vertex reduction and Douglas-Peucker simplification.
    // Improves rendering performance dramatically by lessening the number of points to draw.
    simplify: function (/*Point[]*/ points, /*Number*/ tolerance) {
        if (!tolerance || !points.length) {
            return points.slice();
        }
        var sqTolerance = tolerance * tolerance;
        // stage 1: vertex reduction
        points = this._reducePoints(points, sqTolerance);
        // stage 2: Douglas-Peucker simplification
        points = this._simplifyDP(points, sqTolerance);
        return points;
    },
    // distance from a point to a segment between two points
    pointToSegmentDistance:  function (/*Point*/ p, /*Point*/ p1, /*Point*/ p2) {
        return Math.sqrt(this._sqClosestPointOnSegment(p, p1, p2, true));
    },
    closestPointOnSegment: function (/*Point*/ p, /*Point*/ p1, /*Point*/ p2) {
        return this._sqClosestPointOnSegment(p, p1, p2);
    },
    // Douglas-Peucker simplification, see http://en.wikipedia.org/wiki/Douglas-Peucker_algorithm
    _simplifyDP: function (points, sqTolerance) {
        var len = points.length,
            ArrayConstructor = typeof Uint8Array !== undefined + '' ? Uint8Array : Array,
            markers = new ArrayConstructor(len);
        markers[0] = markers[len - 1] = 1;
        this._simplifyDPStep(points, markers, sqTolerance, 0, len - 1);
        var i,
            newPoints = [];
        for (i = 0; i
< len; i++) {
            if (markers[i]) {
                newPoints.push(points[i]);
            }
        }
        return newPoints;
    },
    _simplifyDPStep: function (points, markers, sqTolerance, first, last) {
        var maxSqDist = 0,
            index, i, sqDist;
        for (i = first + 1; i
<= last - 1; i++) {
            sqDist = this._sqClosestPointOnSegment(points[i], points[first], points[last], true);
            if (sqDist >
 maxSqDist) {
                index = i;
                maxSqDist = sqDist;
            }
        }
        if (maxSqDist >
 sqTolerance) {
            markers[index] = 1;
            this._simplifyDPStep(points, markers, sqTolerance, first, index);
            this._simplifyDPStep(points, markers, sqTolerance, index, last);
        }
    },
    // reduce points that are too close to each other to a single point
    _reducePoints: function (points, sqTolerance) {
        var reducedPoints = [points[0]];
        for (var i = 1, prev = 0, len = points.length; i
< len; i++) {
            if (this._sqDist(points[i], points[prev]) >
 sqTolerance) {
                reducedPoints.push(points[i]);
                prev = i;
            }
        }
        if (prev
< len - 1) {
            reducedPoints.push(points[len - 1]);
        }
        return reducedPoints;
    },
    // Cohen-Sutherland line clipping algorithm.
    // Used to avoid rendering parts of a polyline that are not currently visible.
    clipSegment: function (a, b, bounds, useLastCode) {
        var codeA = useLastCode ? this._lastCode : this._getBitCode(a, bounds),
            codeB = this._getBitCode(b, bounds),
            codeOut, p, newCode;
        // save 2nd code to avoid calculating it on the next segment
        this._lastCode = codeB;
        while (true) {
            // if a,b is inside the clip window (trivial accept)
            if (!(codeA | codeB)) {
                return [a, b];
            // if a,b is outside the clip window (trivial reject)
            } else if (codeA & codeB) {
                return false;
            // other cases
            } else {
                codeOut = codeA || codeB;
                p = this._getEdgeIntersection(a, b, codeOut, bounds);
                newCode = this._getBitCode(p, bounds);
                if (codeOut === codeA) {
                    a = p;
                    codeA = newCode;
                } else {
                    b = p;
                    codeB = newCode;
                }
            }
        }
    },
    _getEdgeIntersection: function (a, b, code, bounds) {
        var dx = b.x - a.x,
            dy = b.y - a.y,
            min = bounds.min,
            max = bounds.max;
        if (code & 8) { // top
            return new L.Point(a.x + dx * (max.y - a.y) / dy, max.y);
        } else if (code & 4) { // bottom
            return new L.Point(a.x + dx * (min.y - a.y) / dy, min.y);
        } else if (code & 2) { // right
            return new L.Point(max.x, a.y + dy * (max.x - a.x) / dx);
        } else if (code & 1) { // left
            return new L.Point(min.x, a.y + dy * (min.x - a.x) / dx);
        }
    },
    _getBitCode: function (/*Point*/ p, bounds) {
        var code = 0;
        if (p.x
< bounds.min.x) { // left
            code |= 1;
        } else if (p.x >
 bounds.max.x) { // right
            code |= 2;
        }
        if (p.y
< bounds.min.y) { // bottom
            code |= 4;
        } else if (p.y >
 bounds.max.y) { // top
            code |= 8;
        }
        return code;
    },
    // square distance (to avoid unnecessary Math.sqrt calls)
    _sqDist: function (p1, p2) {
        var dx = p2.x - p1.x,
            dy = p2.y - p1.y;
        return dx * dx + dy * dy;
    },
    // return closest point on segment or distance to that point
    _sqClosestPointOnSegment: function (p, p1, p2, sqDist) {
        var x = p1.x,
            y = p1.y,
            dx = p2.x - x,
            dy = p2.y - y,
            dot = dx * dx + dy * dy,
            t;
        if (dot >
 0) {
            t = ((p.x - x) * dx + (p.y - y) * dy) / dot;
            if (t >
 1) {
                x = p2.x;
                y = p2.y;
            } else if (t >
 0) {
                x += dx * t;
                y += dy * t;
            }
        }
        dx = p.x - x;
        dy = p.y - y;
        return sqDist ? dx * dx + dy * dy : new L.Point(x, y);
    }
};
/*
 * L.Polyline is used to display polylines on a map.
 */
L.Polyline = L.Path.extend({
    initialize: function (latlngs, options) {
        L.Path.prototype.initialize.call(this, options);
        this._latlngs = this._convertLatLngs(latlngs);
    },
    options: {
        // how much to simplify the polyline on each zoom level
        // more = better performance and smoother look, less = more accurate
        smoothFactor: 1.0,
        noClip: false
    },
    projectLatlngs: function () {
        this._originalPoints = [];
        for (var i = 0, len = this._latlngs.length; i
< len; i++) {
            this._originalPoints[i] = this._map.latLngToLayerPoint(this._latlngs[i]);
        }
    },
    getPathString: function () {
        for (var i = 0, len = this._parts.length, str = ''; i
< len; i++) {
            str += this._getPathPartStr(this._parts[i]);
        }
        return str;
    },
    getLatLngs: function () {
        return this._latlngs;
    },
    setLatLngs: function (latlngs) {
        this._latlngs = this._convertLatLngs(latlngs);
        return this.redraw();
    },
    addLatLng: function (latlng) {
        this._latlngs.push(L.latLng(latlng));
        return this.redraw();
    },
    spliceLatLngs: function () { // (Number index, Number howMany)
        var removed = [].splice.apply(this._latlngs, arguments);
        this._convertLatLngs(this._latlngs, true);
        this.redraw();
        return removed;
    },
    closestLayerPoint: function (p) {
        var minDistance = Infinity, parts = this._parts, p1, p2, minPoint = null;
        for (var j = 0, jLen = parts.length; j
< jLen; j++) {
            var points = parts[j];
            for (var i = 1, len = points.length; i
< len; i++) {
                p1 = points[i - 1];
                p2 = points[i];
                var sqDist = L.LineUtil._sqClosestPointOnSegment(p, p1, p2, true);
                if (sqDist
< minDistance) {
                    minDistance = sqDist;
                    minPoint = L.LineUtil._sqClosestPointOnSegment(p, p1, p2);
                }
            }
        }
        if (minPoint) {
            minPoint.distance = Math.sqrt(minDistance);
        }
        return minPoint;
    },
    getBounds: function () {
        return new L.LatLngBounds(this.getLatLngs());
    },
    _convertLatLngs: function (latlngs, overwrite) {
        var i, len, target = overwrite ? latlngs : [];
        for (i = 0, len = latlngs.length; i
< len; i++) {
            if (L.Util.isArray(latlngs[i]) && typeof latlngs[i][0] !== 'number') {
                return;
            }
            target[i] = L.latLng(latlngs[i]);
        }
        return target;
    },
    _initEvents: function () {
        L.Path.prototype._initEvents.call(this);
    },
    _getPathPartStr: function (points) {
        var round = L.Path.VML;
        for (var j = 0, len2 = points.length, str = '', p; j
< len2; j++) {
            p = points[j];
            if (round) {
                p._round();
            }
            str += (j ? 'L' : 'M') + p.x + ' ' + p.y;
        }
        return str;
    },
    _clipPoints: function () {
        var points = this._originalPoints,
            len = points.length,
            i, k, segment;
        if (this.options.noClip) {
            this._parts = [points];
            return;
        }
        this._parts = [];
        var parts = this._parts,
            vp = this._map._pathViewport,
            lu = L.LineUtil;
        for (i = 0, k = 0; i
< len - 1; i++) {
            segment = lu.clipSegment(points[i], points[i + 1], vp, i);
            if (!segment) {
                continue;
            }
            parts[k] = parts[k] || [];
            parts[k].push(segment[0]);
            // if segment goes out of screen, or it's the last one, it's the end of the line part
            if ((segment[1] !== points[i + 1]) || (i === len - 2)) {
                parts[k].push(segment[1]);
                k++;
            }
        }
    },
    // simplify each clipped part of the polyline
    _simplifyPoints: function () {
        var parts = this._parts,
            lu = L.LineUtil;
        for (var i = 0, len = parts.length; i
< len; i++) {
            parts[i] = lu.simplify(parts[i], this.options.smoothFactor);
        }
    },
    _updatePath: function () {
        if (!this._map) { return; }
        this._clipPoints();
        this._simplifyPoints();
        L.Path.prototype._updatePath.call(this);
    }
});
L.polyline = function (latlngs, options) {
    return new L.Polyline(latlngs, options);
};
/*
 * L.PolyUtil contains utility functions for polygons (clipping, etc.).
 */
/*jshint bitwise:false */ // allow bitwise operations here
L.PolyUtil = {};
/*
 * Sutherland-Hodgeman polygon clipping algorithm.
 * Used to avoid rendering parts of a polygon that are not currently visible.
 */
L.PolyUtil.clipPolygon = function (points, bounds) {
    var clippedPoints,
        edges = [1, 4, 2, 8],
        i, j, k,
        a, b,
        len, edge, p,
        lu = L.LineUtil;
    for (i = 0, len = points.length; i
< len; i++) {
        points[i]._code = lu._getBitCode(points[i], bounds);
    }
    // for each edge (left, bottom, right, top)
    for (k = 0; k
< 4; k++) {
        edge = edges[k];
        clippedPoints = [];
        for (i = 0, len = points.length, j = len - 1; i
< len; j = i++) {
            a = points[i];
            b = points[j];
            // if a is inside the clip window
            if (!(a._code & edge)) {
                // if b is outside the clip window (a->
b goes out of screen)
                if (b._code & edge) {
                    p = lu._getEdgeIntersection(b, a, edge, bounds);
                    p._code = lu._getBitCode(p, bounds);
                    clippedPoints.push(p);
                }
                clippedPoints.push(a);
            // else if b is inside the clip window (a->
b enters the screen)
            } else if (!(b._code & edge)) {
                p = lu._getEdgeIntersection(b, a, edge, bounds);
                p._code = lu._getBitCode(p, bounds);
                clippedPoints.push(p);
            }
        }
        points = clippedPoints;
    }
    return points;
};
/*
 * L.Polygon is used to display polygons on a map.
 */
L.Polygon = L.Polyline.extend({
    options: {
        fill: true
    },
    initialize: function (latlngs, options) {
        L.Polyline.prototype.initialize.call(this, latlngs, options);
        this._initWithHoles(latlngs);
    },
    _initWithHoles: function (latlngs) {
        var i, len, hole;
        if (latlngs && L.Util.isArray(latlngs[0]) && (typeof latlngs[0][0] !== 'number')) {
            this._latlngs = this._convertLatLngs(latlngs[0]);
            this._holes = latlngs.slice(1);
            for (i = 0, len = this._holes.length; i
< len; i++) {
                hole = this._holes[i] = this._convertLatLngs(this._holes[i]);
                if (hole[0].equals(hole[hole.length - 1])) {
                    hole.pop();
                }
            }
        }
        // filter out last point if its equal to the first one
        latlngs = this._latlngs;
        if (latlngs.length >
= 2 && latlngs[0].equals(latlngs[latlngs.length - 1])) {
            latlngs.pop();
        }
    },
    projectLatlngs: function () {
        L.Polyline.prototype.projectLatlngs.call(this);
        // project polygon holes points
        // TODO move this logic to Polyline to get rid of duplication
        this._holePoints = [];
        if (!this._holes) { return; }
        var i, j, len, len2;
        for (i = 0, len = this._holes.length; i
< len; i++) {
            this._holePoints[i] = [];
            for (j = 0, len2 = this._holes[i].length; j
< len2; j++) {
                this._holePoints[i][j] = this._map.latLngToLayerPoint(this._holes[i][j]);
            }
        }
    },
    setLatLngs: function (latlngs) {
        if (latlngs && L.Util.isArray(latlngs[0]) && (typeof latlngs[0][0] !== 'number')) {
            this._initWithHoles(latlngs);
            return this.redraw();
        } else {
            return L.Polyline.prototype.setLatLngs.call(this, latlngs);
        }
    },
    _clipPoints: function () {
        var points = this._originalPoints,
            newParts = [];
        this._parts = [points].concat(this._holePoints);
        if (this.options.noClip) { return; }
        for (var i = 0, len = this._parts.length; i
< len; i++) {
            var clipped = L.PolyUtil.clipPolygon(this._parts[i], this._map._pathViewport);
            if (clipped.length) {
                newParts.push(clipped);
            }
        }
        this._parts = newParts;
    },
    _getPathPartStr: function (points) {
        var str = L.Polyline.prototype._getPathPartStr.call(this, points);
        return str + (L.Browser.svg ? 'z' : 'x');
    }
});
L.polygon = function (latlngs, options) {
    return new L.Polygon(latlngs, options);
};
/*
 * Contains L.MultiPolyline and L.MultiPolygon layers.
 */
(function () {
    function createMulti(Klass) {
        return L.FeatureGroup.extend({
            initialize: function (latlngs, options) {
                this._layers = {};
                this._options = options;
                this.setLatLngs(latlngs);
            },
            setLatLngs: function (latlngs) {
                var i = 0,
                    len = latlngs.length;
                this.eachLayer(function (layer) {
                    if (i
< len) {
                        layer.setLatLngs(latlngs[i++]);
                    } else {
                        this.removeLayer(layer);
                    }
                }, this);
                while (i
< len) {
                    this.addLayer(new Klass(latlngs[i++], this._options));
                }
                return this;
            },
            getLatLngs: function () {
                var latlngs = [];
                this.eachLayer(function (layer) {
                    latlngs.push(layer.getLatLngs());
                });
                return latlngs;
            }
        });
    }
    L.MultiPolyline = createMulti(L.Polyline);
    L.MultiPolygon = createMulti(L.Polygon);
    L.multiPolyline = function (latlngs, options) {
        return new L.MultiPolyline(latlngs, options);
    };
    L.multiPolygon = function (latlngs, options) {
        return new L.MultiPolygon(latlngs, options);
    };
}());
/*
 * L.Rectangle extends Polygon and creates a rectangle when passed a LatLngBounds object.
 */
L.Rectangle = L.Polygon.extend({
    initialize: function (latLngBounds, options) {
        L.Polygon.prototype.initialize.call(this, this._boundsToLatLngs(latLngBounds), options);
    },
    setBounds: function (latLngBounds) {
        this.setLatLngs(this._boundsToLatLngs(latLngBounds));
    },
    _boundsToLatLngs: function (latLngBounds) {
        latLngBounds = L.latLngBounds(latLngBounds);
        return [
            latLngBounds.getSouthWest(),
            latLngBounds.getNorthWest(),
            latLngBounds.getNorthEast(),
            latLngBounds.getSouthEast()
        ];
    }
});
L.rectangle = function (latLngBounds, options) {
    return new L.Rectangle(latLngBounds, options);
};
/*
 * L.Circle is a circle overlay (with a certain radius in meters).
 */
L.Circle = L.Path.extend({
    initialize: function (latlng, radius, options) {
        L.Path.prototype.initialize.call(this, options);
        this._latlng = L.latLng(latlng);
        this._mRadius = radius;
    },
    options: {
        fill: true
    },
    setLatLng: function (latlng) {
        this._latlng = L.latLng(latlng);
        return this.redraw();
    },
    setRadius: function (radius) {
        this._mRadius = radius;
        return this.redraw();
    },
    projectLatlngs: function () {
        var lngRadius = this._getLngRadius(),
            latlng = this._latlng,
            pointLeft = this._map.latLngToLayerPoint([latlng.lat, latlng.lng - lngRadius]);
        this._point = this._map.latLngToLayerPoint(latlng);
        this._radius = Math.max(this._point.x - pointLeft.x, 1);
    },
    getBounds: function () {
        var lngRadius = this._getLngRadius(),
            latRadius = (this._mRadius / 40075017) * 360,
            latlng = this._latlng;
        return new L.LatLngBounds(
                [latlng.lat - latRadius, latlng.lng - lngRadius],
                [latlng.lat + latRadius, latlng.lng + lngRadius]);
    },
    getLatLng: function () {
        return this._latlng;
    },
    getPathString: function () {
        var p = this._point,
            r = this._radius;
        if (this._checkIfEmpty()) {
            return '';
        }
        if (L.Browser.svg) {
            return 'M' + p.x + ',' + (p.y - r) +
                   'A' + r + ',' + r + ',0,1,1,' +
                   (p.x - 0.1) + ',' + (p.y - r) + ' z';
        } else {
            p._round();
            r = Math.round(r);
            return 'AL ' + p.x + ',' + p.y + ' ' + r + ',' + r + ' 0,' + (65535 * 360);
        }
    },
    getRadius: function () {
        return this._mRadius;
    },
    // TODO Earth hardcoded, move into projection code!
    _getLatRadius: function () {
        return (this._mRadius / 40075017) * 360;
    },
    _getLngRadius: function () {
        return this._getLatRadius() / Math.cos(L.LatLng.DEG_TO_RAD * this._latlng.lat);
    },
    _checkIfEmpty: function () {
        if (!this._map) {
            return false;
        }
        var vp = this._map._pathViewport,
            r = this._radius,
            p = this._point;
        return p.x - r >
 vp.max.x || p.y - r >
 vp.max.y ||
               p.x + r
< vp.min.x || p.y + r
< vp.min.y;
    }
});
L.circle = function (latlng, radius, options) {
    return new L.Circle(latlng, radius, options);
};
/*
 * L.CircleMarker is a circle overlay with a permanent pixel radius.
 */
L.CircleMarker = L.Circle.extend({
    options: {
        radius: 10,
        weight: 2
    },
    initialize: function (latlng, options) {
        L.Circle.prototype.initialize.call(this, latlng, null, options);
        this._radius = this.options.radius;
    },
    projectLatlngs: function () {
        this._point = this._map.latLngToLayerPoint(this._latlng);
    },
    _updateStyle : function () {
        L.Circle.prototype._updateStyle.call(this);
        this.setRadius(this.options.radius);
    },
    setLatLng: function (latlng) {
        L.Circle.prototype.setLatLng.call(this, latlng);
        if (this._popup && this._popup._isOpen) {
            this._popup.setLatLng(latlng);
        }
        return this;
    },
    setRadius: function (radius) {
        this.options.radius = this._radius = radius;
        return this.redraw();
    },
    getRadius: function () {
        return this._radius;
    }
});
L.circleMarker = function (latlng, options) {
    return new L.CircleMarker(latlng, options);
};
/*
 * Extends L.Polyline to be able to manually detect clicks on Canvas-rendered polylines.
 */
L.Polyline.include(!L.Path.CANVAS ? {} : {
    _containsPoint: function (p, closed) {
        var i, j, k, len, len2, dist, part,
            w = this.options.weight / 2;
        if (L.Browser.touch) {
            w += 10; // polyline click tolerance on touch devices
        }
        for (i = 0, len = this._parts.length; i
< len; i++) {
            part = this._parts[i];
            for (j = 0, len2 = part.length, k = len2 - 1; j
< len2; k = j++) {
                if (!closed && (j === 0)) {
                    continue;
                }
                dist = L.LineUtil.pointToSegmentDistance(p, part[k], part[j]);
                if (dist
<= w) {
                    return true;
                }
            }
        }
        return false;
    }
});
/*
 * Extends L.Polygon to be able to manually detect clicks on Canvas-rendered polygons.
 */
L.Polygon.include(!L.Path.CANVAS ? {} : {
    _containsPoint: function (p) {
        var inside = false,
            part, p1, p2,
            i, j, k,
            len, len2;
        // TODO optimization: check if within bounds first
        if (L.Polyline.prototype._containsPoint.call(this, p, true)) {
            // click on polygon border
            return true;
        }
        // ray casting algorithm for detecting if point is in polygon
        for (i = 0, len = this._parts.length; i
< len; i++) {
            part = this._parts[i];
            for (j = 0, len2 = part.length, k = len2 - 1; j
< len2; k = j++) {
                p1 = part[j];
                p2 = part[k];
                if (((p1.y >
 p.y) !== (p2.y >
 p.y)) &&
                        (p.x
< (p2.x - p1.x) * (p.y - p1.y) / (p2.y - p1.y) + p1.x)) {
                    inside = !inside;
                }
            }
        }
        return inside;
    }
});
/*
 * Extends L.Circle with Canvas-specific code.
 */
L.Circle.include(!L.Path.CANVAS ? {} : {
    _drawPath: function () {
        var p = this._point;
        this._ctx.beginPath();
        this._ctx.arc(p.x, p.y, this._radius, 0, Math.PI * 2, false);
    },
    _containsPoint: function (p) {
        var center = this._point,
            w2 = this.options.stroke ? this.options.weight / 2 : 0;
        return (p.distanceTo(center)
<= this._radius + w2);
    }
});
/*
 * CircleMarker canvas specific drawing parts.
 */
L.CircleMarker.include(!L.Path.CANVAS ? {} : {
    _updateStyle: function () {
        L.Path.prototype._updateStyle.call(this);
    }
});
/*
 * L.GeoJSON turns any GeoJSON data into a Leaflet layer.
 */
L.GeoJSON = L.FeatureGroup.extend({
    initialize: function (geojson, options) {
        L.setOptions(this, options);
        this._layers = {};
        if (geojson) {
            this.addData(geojson);
        }
    },
    addData: function (geojson) {
        var features = L.Util.isArray(geojson) ? geojson : geojson.features,
            i, len, feature;
        if (features) {
            for (i = 0, len = features.length; i
< len; i++) {
                // Only add this if geometry or geometries are set and not null
                feature = features[i];
                if (feature.geometries || feature.geometry || feature.features || feature.coordinates) {
                    this.addData(features[i]);
                }
            }
            return this;
        }
        var options = this.options;
        if (options.filter && !options.filter(geojson)) { return; }
        var layer = L.GeoJSON.geometryToLayer(geojson, options.pointToLayer, options.coordsToLatLng, options);
        layer.feature = L.GeoJSON.asFeature(geojson);
        layer.defaultOptions = layer.options;
        this.resetStyle(layer);
        if (options.onEachFeature) {
            options.onEachFeature(geojson, layer);
        }
        return this.addLayer(layer);
    },
    resetStyle: function (layer) {
        var style = this.options.style;
        if (style) {
            // reset any custom styles
            L.Util.extend(layer.options, layer.defaultOptions);
            this._setLayerStyle(layer, style);
        }
    },
    setStyle: function (style) {
        this.eachLayer(function (layer) {
            this._setLayerStyle(layer, style);
        }, this);
    },
    _setLayerStyle: function (layer, style) {
        if (typeof style === 'function') {
            style = style(layer.feature);
        }
        if (layer.setStyle) {
            layer.setStyle(style);
        }
    }
});
L.extend(L.GeoJSON, {
    geometryToLayer: function (geojson, pointToLayer, coordsToLatLng, vectorOptions) {
        var geometry = geojson.type === 'Feature' ? geojson.geometry : geojson,
            coords = geometry.coordinates,
            layers = [],
            latlng, latlngs, i, len;
        coordsToLatLng = coordsToLatLng || this.coordsToLatLng;
        switch (geometry.type) {
        case 'Point':
            latlng = coordsToLatLng(coords);
            return pointToLayer ? pointToLayer(geojson, latlng) : new L.Marker(latlng);
        case 'MultiPoint':
            for (i = 0, len = coords.length; i
< len; i++) {
                latlng = coordsToLatLng(coords[i]);
                layers.push(pointToLayer ? pointToLayer(geojson, latlng) : new L.Marker(latlng));
            }
            return new L.FeatureGroup(layers);
        case 'LineString':
            latlngs = this.coordsToLatLngs(coords, 0, coordsToLatLng);
            return new L.Polyline(latlngs, vectorOptions);
        case 'Polygon':
            if (coords.length === 2 && !coords[1].length) {
                throw new Error('Invalid GeoJSON object.');
            }
            latlngs = this.coordsToLatLngs(coords, 1, coordsToLatLng);
            return new L.Polygon(latlngs, vectorOptions);
        case 'MultiLineString':
            latlngs = this.coordsToLatLngs(coords, 1, coordsToLatLng);
            return new L.MultiPolyline(latlngs, vectorOptions);
        case 'MultiPolygon':
            latlngs = this.coordsToLatLngs(coords, 2, coordsToLatLng);
            return new L.MultiPolygon(latlngs, vectorOptions);
        case 'GeometryCollection':
            for (i = 0, len = geometry.geometries.length; i
< len; i++) {
                layers.push(this.geometryToLayer({
                    geometry: geometry.geometries[i],
                    type: 'Feature',
                    properties: geojson.properties
                }, pointToLayer, coordsToLatLng, vectorOptions));
            }
            return new L.FeatureGroup(layers);
        default:
            throw new Error('Invalid GeoJSON object.');
        }
    },
    coordsToLatLng: function (coords) { // (Array[, Boolean]) ->
 LatLng
        return new L.LatLng(coords[1], coords[0], coords[2]);
    },
    coordsToLatLngs: function (coords, levelsDeep, coordsToLatLng) { // (Array[, Number, Function]) ->
 Array
        var latlng, i, len,
            latlngs = [];
        for (i = 0, len = coords.length; i
< len; i++) {
            latlng = levelsDeep ?
                    this.coordsToLatLngs(coords[i], levelsDeep - 1, coordsToLatLng) :
                    (coordsToLatLng || this.coordsToLatLng)(coords[i]);
            latlngs.push(latlng);
        }
        return latlngs;
    },
    latLngToCoords: function (latlng) {
        var coords = [latlng.lng, latlng.lat];
        if (latlng.alt !== undefined) {
            coords.push(latlng.alt);
        }
        return coords;
    },
    latLngsToCoords: function (latLngs) {
        var coords = [];
        for (var i = 0, len = latLngs.length; i
< len; i++) {
            coords.push(L.GeoJSON.latLngToCoords(latLngs[i]));
        }
        return coords;
    },
    getFeature: function (layer, newGeometry) {
        return layer.feature ? L.extend({}, layer.feature, {geometry: newGeometry}) : L.GeoJSON.asFeature(newGeometry);
    },
    asFeature: function (geoJSON) {
        if (geoJSON.type === 'Feature') {
            return geoJSON;
        }
        return {
            type: 'Feature',
            properties: {},
            geometry: geoJSON
        };
    }
});
var PointToGeoJSON = {
    toGeoJSON: function () {
        return L.GeoJSON.getFeature(this, {
            type: 'Point',
            coordinates: L.GeoJSON.latLngToCoords(this.getLatLng())
        });
    }
};
L.Marker.include(PointToGeoJSON);
L.Circle.include(PointToGeoJSON);
L.CircleMarker.include(PointToGeoJSON);
L.Polyline.include({
    toGeoJSON: function () {
        return L.GeoJSON.getFeature(this, {
            type: 'LineString',
            coordinates: L.GeoJSON.latLngsToCoords(this.getLatLngs())
        });
    }
});
L.Polygon.include({
    toGeoJSON: function () {
        var coords = [L.GeoJSON.latLngsToCoords(this.getLatLngs())],
            i, len, hole;
        coords[0].push(coords[0][0]);
        if (this._holes) {
            for (i = 0, len = this._holes.length; i
< len; i++) {
                hole = L.GeoJSON.latLngsToCoords(this._holes[i]);
                hole.push(hole[0]);
                coords.push(hole);
            }
        }
        return L.GeoJSON.getFeature(this, {
            type: 'Polygon',
            coordinates: coords
        });
    }
});
(function () {
    function multiToGeoJSON(type) {
        return function () {
            var coords = [];
            this.eachLayer(function (layer) {
                coords.push(layer.toGeoJSON().geometry.coordinates);
            });
            return L.GeoJSON.getFeature(this, {
                type: type,
                coordinates: coords
            });
        };
    }
    L.MultiPolyline.include({toGeoJSON: multiToGeoJSON('MultiLineString')});
    L.MultiPolygon.include({toGeoJSON: multiToGeoJSON('MultiPolygon')});
    L.LayerGroup.include({
        toGeoJSON: function () {
            var geometry = this.feature && this.feature.geometry,
                jsons = [],
                json;
            if (geometry && geometry.type === 'MultiPoint') {
                return multiToGeoJSON('MultiPoint').call(this);
            }
            var isGeometryCollection = geometry && geometry.type === 'GeometryCollection';
            this.eachLayer(function (layer) {
                if (layer.toGeoJSON) {
                    json = layer.toGeoJSON();
                    jsons.push(isGeometryCollection ? json.geometry : L.GeoJSON.asFeature(json));
                }
            });
            if (isGeometryCollection) {
                return L.GeoJSON.getFeature(this, {
                    geometries: jsons,
                    type: 'GeometryCollection'
                });
            }
            return {
                type: 'FeatureCollection',
                features: jsons
            };
        }
    });
}());
L.geoJson = function (geojson, options) {
    return new L.GeoJSON(geojson, options);
};
/*
 * L.DomEvent contains functions for working with DOM events.
 */
L.DomEvent = {
    /* inspired by John Resig, Dean Edwards and YUI addEvent implementations */
    addListener: function (obj, type, fn, context) { // (HTMLElement, String, Function[, Object])
        var id = L.stamp(fn),
            key = '_leaflet_' + type + id,
            handler, originalHandler, newType;
        if (obj[key]) { return this; }
        handler = function (e) {
            return fn.call(context || obj, e || L.DomEvent._getEvent());
        };
        if (L.Browser.pointer && type.indexOf('touch') === 0) {
            return this.addPointerListener(obj, type, handler, id);
        }
        if (L.Browser.touch && (type === 'dblclick') && this.addDoubleTapListener) {
            this.addDoubleTapListener(obj, handler, id);
        }
        if ('addEventListener' in obj) {
            if (type === 'mousewheel') {
                obj.addEventListener('DOMMouseScroll', handler, false);
                obj.addEventListener(type, handler, false);
            } else if ((type === 'mouseenter') || (type === 'mouseleave')) {
                originalHandler = handler;
                newType = (type === 'mouseenter' ? 'mouseover' : 'mouseout');
                handler = function (e) {
                    if (!L.DomEvent._checkMouse(obj, e)) { return; }
                    return originalHandler(e);
                };
                obj.addEventListener(newType, handler, false);
            } else if (type === 'click' && L.Browser.android) {
                originalHandler = handler;
                handler = function (e) {
                    return L.DomEvent._filterClick(e, originalHandler);
                };
                obj.addEventListener(type, handler, false);
            } else {
                obj.addEventListener(type, handler, false);
            }
        } else if ('attachEvent' in obj) {
            obj.attachEvent('on' + type, handler);
        }
        obj[key] = handler;
        return this;
    },
    removeListener: function (obj, type, fn) {  // (HTMLElement, String, Function)
        var id = L.stamp(fn),
            key = '_leaflet_' + type + id,
            handler = obj[key];
        if (!handler) { return this; }
        if (L.Browser.pointer && type.indexOf('touch') === 0) {
            this.removePointerListener(obj, type, id);
        } else if (L.Browser.touch && (type === 'dblclick') && this.removeDoubleTapListener) {
            this.removeDoubleTapListener(obj, id);
        } else if ('removeEventListener' in obj) {
            if (type === 'mousewheel') {
                obj.removeEventListener('DOMMouseScroll', handler, false);
                obj.removeEventListener(type, handler, false);
            } else if ((type === 'mouseenter') || (type === 'mouseleave')) {
                obj.removeEventListener((type === 'mouseenter' ? 'mouseover' : 'mouseout'), handler, false);
            } else {
                obj.removeEventListener(type, handler, false);
            }
        } else if ('detachEvent' in obj) {
            obj.detachEvent('on' + type, handler);
        }
        obj[key] = null;
        return this;
    },
    stopPropagation: function (e) {
        if (e.stopPropagation) {
            e.stopPropagation();
        } else {
            e.cancelBubble = true;
        }
        L.DomEvent._skipped(e);
        return this;
    },
    disableScrollPropagation: function (el) {
        var stop = L.DomEvent.stopPropagation;
        return L.DomEvent
            .on(el, 'mousewheel', stop)
            .on(el, 'MozMousePixelScroll', stop);
    },
    disableClickPropagation: function (el) {
        var stop = L.DomEvent.stopPropagation;
        for (var i = L.Draggable.START.length - 1; i >
= 0; i--) {
            L.DomEvent.on(el, L.Draggable.START[i], stop);
        }
        return L.DomEvent
            .on(el, 'click', L.DomEvent._fakeStop)
            .on(el, 'dblclick', stop);
    },
    preventDefault: function (e) {
        if (e.preventDefault) {
            e.preventDefault();
        } else {
            e.returnValue = false;
        }
        return this;
    },
    stop: function (e) {
        return L.DomEvent
            .preventDefault(e)
            .stopPropagation(e);
    },
    getMousePosition: function (e, container) {
        if (!container) {
            return new L.Point(e.clientX, e.clientY);
        }
        var rect = container.getBoundingClientRect();
        return new L.Point(
            e.clientX - rect.left - container.clientLeft,
            e.clientY - rect.top - container.clientTop);
    },
    getWheelDelta: function (e) {
        var delta = 0;
        if (e.wheelDelta) {
            delta = e.wheelDelta / 120;
        }
        if (e.detail) {
            delta = -e.detail / 3;
        }
        return delta;
    },
    _skipEvents: {},
    _fakeStop: function (e) {
        // fakes stopPropagation by setting a special event flag, checked/reset with L.DomEvent._skipped(e)
        L.DomEvent._skipEvents[e.type] = true;
    },
    _skipped: function (e) {
        var skipped = this._skipEvents[e.type];
        // reset when checking, as it's only used in map container and propagates outside of the map
        this._skipEvents[e.type] = false;
        return skipped;
    },
    // check if element really left/entered the event target (for mouseenter/mouseleave)
    _checkMouse: function (el, e) {
        var related = e.relatedTarget;
        if (!related) { return true; }
        try {
            while (related && (related !== el)) {
                related = related.parentNode;
            }
        } catch (err) {
            return false;
        }
        return (related !== el);
    },
    _getEvent: function () { // evil magic for IE
        /*jshint noarg:false */
        var e = window.event;
        if (!e) {
            var caller = arguments.callee.caller;
            while (caller) {
                e = caller['arguments'][0];
                if (e && window.Event === e.constructor) {
                    break;
                }
                caller = caller.caller;
            }
        }
        return e;
    },
    // this is a horrible workaround for a bug in Android where a single touch triggers two click events
    _filterClick: function (e, handler) {
        var timeStamp = (e.timeStamp || e.originalEvent.timeStamp),
            elapsed = L.DomEvent._lastClick && (timeStamp - L.DomEvent._lastClick);
        // are they closer together than 500ms yet more than 100ms?
        // Android typically triggers them ~300ms apart while multiple listeners
        // on the same event should be triggered far faster;
        // or check if click is simulated on the element, and if it is, reject any non-simulated events
        if ((elapsed && elapsed >
 100 && elapsed
< 500) || (e.target._simulatedClick && !e._simulated)) {
            L.DomEvent.stop(e);
            return;
        }
        L.DomEvent._lastClick = timeStamp;
        return handler(e);
    }
};
L.DomEvent.on = L.DomEvent.addListener;
L.DomEvent.off = L.DomEvent.removeListener;
/*
 * L.Draggable allows you to add dragging capabilities to any element. Supports mobile devices too.
 */
L.Draggable = L.Class.extend({
    includes: L.Mixin.Events,
    statics: {
        START: L.Browser.touch ? ['touchstart', 'mousedown'] : ['mousedown'],
        END: {
            mousedown: 'mouseup',
            touchstart: 'touchend',
            pointerdown: 'touchend',
            MSPointerDown: 'touchend'
        },
        MOVE: {
            mousedown: 'mousemove',
            touchstart: 'touchmove',
            pointerdown: 'touchmove',
            MSPointerDown: 'touchmove'
        }
    },
    initialize: function (element, dragStartTarget) {
        this._element = element;
        this._dragStartTarget = dragStartTarget || element;
    },
    enable: function () {
        if (this._enabled) { return; }
        for (var i = L.Draggable.START.length - 1; i >
= 0; i--) {
            L.DomEvent.on(this._dragStartTarget, L.Draggable.START[i], this._onDown, this);
        }
        this._enabled = true;
    },
    disable: function () {
        if (!this._enabled) { return; }
        for (var i = L.Draggable.START.length - 1; i >
= 0; i--) {
            L.DomEvent.off(this._dragStartTarget, L.Draggable.START[i], this._onDown, this);
        }
        this._enabled = false;
        this._moved = false;
    },
    _onDown: function (e) {
        this._moved = false;
        if (e.shiftKey || ((e.which !== 1) && (e.button !== 1) && !e.touches)) { return; }
        L.DomEvent.stopPropagation(e);
        if (L.Draggable._disabled) { return; }
        L.DomUtil.disableImageDrag();
        L.DomUtil.disableTextSelection();
        if (this._moving) { return; }
        var first = e.touches ? e.touches[0] : e;
        this._startPoint = new L.Point(first.clientX, first.clientY);
        this._startPos = this._newPos = L.DomUtil.getPosition(this._element);
        L.DomEvent
            .on(document, L.Draggable.MOVE[e.type], this._onMove, this)
            .on(document, L.Draggable.END[e.type], this._onUp, this);
    },
    _onMove: function (e) {
        if (e.touches && e.touches.length >
 1) {
            this._moved = true;
            return;
        }
        var first = (e.touches && e.touches.length === 1 ? e.touches[0] : e),
            newPoint = new L.Point(first.clientX, first.clientY),
            offset = newPoint.subtract(this._startPoint);
        if (!offset.x && !offset.y) { return; }
        if (L.Browser.touch && Math.abs(offset.x) + Math.abs(offset.y)
< 3) { return; }
        L.DomEvent.preventDefault(e);
        if (!this._moved) {
            this.fire('dragstart');
            this._moved = true;
            this._startPos = L.DomUtil.getPosition(this._element).subtract(offset);
            L.DomUtil.addClass(document.body, 'leaflet-dragging');
            this._lastTarget = e.target || e.srcElement;
            L.DomUtil.addClass(this._lastTarget, 'leaflet-drag-target');
        }
        this._newPos = this._startPos.add(offset);
        this._moving = true;
        L.Util.cancelAnimFrame(this._animRequest);
        this._animRequest = L.Util.requestAnimFrame(this._updatePosition, this, true, this._dragStartTarget);
    },
    _updatePosition: function () {
        this.fire('predrag');
        L.DomUtil.setPosition(this._element, this._newPos);
        this.fire('drag');
    },
    _onUp: function () {
        L.DomUtil.removeClass(document.body, 'leaflet-dragging');
        if (this._lastTarget) {
            L.DomUtil.removeClass(this._lastTarget, 'leaflet-drag-target');
            this._lastTarget = null;
        }
        for (var i in L.Draggable.MOVE) {
            L.DomEvent
                .off(document, L.Draggable.MOVE[i], this._onMove)
                .off(document, L.Draggable.END[i], this._onUp);
        }
        L.DomUtil.enableImageDrag();
        L.DomUtil.enableTextSelection();
        if (this._moved && this._moving) {
            // ensure drag is not fired after dragend
            L.Util.cancelAnimFrame(this._animRequest);
            this.fire('dragend', {
                distance: this._newPos.distanceTo(this._startPos)
            });
        }
        this._moving = false;
    }
});
/*
    L.Handler is a base class for handler classes that are used internally to inject
    interaction features like dragging to classes like Map and Marker.
*/
L.Handler = L.Class.extend({
    initialize: function (map) {
        this._map = map;
    },
    enable: function () {
        if (this._enabled) { return; }
        this._enabled = true;
        this.addHooks();
    },
    disable: function () {
        if (!this._enabled) { return; }
        this._enabled = false;
        this.removeHooks();
    },
    enabled: function () {
        return !!this._enabled;
    }
});
/*
 * L.Handler.MapDrag is used to make the map draggable (with panning inertia), enabled by default.
 */
L.Map.mergeOptions({
    dragging: true,
    inertia: !L.Browser.android23,
    inertiaDeceleration: 3400, // px/s^2
    inertiaMaxSpeed: Infinity, // px/s
    inertiaThreshold: L.Browser.touch ? 32 : 18, // ms
    easeLinearity: 0.25,
    // TODO refactor, move to CRS
    worldCopyJump: false
});
L.Map.Drag = L.Handler.extend({
    addHooks: function () {
        if (!this._draggable) {
            var map = this._map;
            this._draggable = new L.Draggable(map._mapPane, map._container);
            this._draggable.on({
                'dragstart': this._onDragStart,
                'drag': this._onDrag,
                'dragend': this._onDragEnd
            }, this);
            if (map.options.worldCopyJump) {
                this._draggable.on('predrag', this._onPreDrag, this);
                map.on('viewreset', this._onViewReset, this);
                map.whenReady(this._onViewReset, this);
            }
        }
        this._draggable.enable();
    },
    removeHooks: function () {
        this._draggable.disable();
    },
    moved: function () {
        return this._draggable && this._draggable._moved;
    },
    _onDragStart: function () {
        var map = this._map;
        if (map._panAnim) {
            map._panAnim.stop();
        }
        map
            .fire('movestart')
            .fire('dragstart');
        if (map.options.inertia) {
            this._positions = [];
            this._times = [];
        }
    },
    _onDrag: function () {
        if (this._map.options.inertia) {
            var time = this._lastTime = +new Date(),
                pos = this._lastPos = this._draggable._newPos;
            this._positions.push(pos);
            this._times.push(time);
            if (time - this._times[0] >
 200) {
                this._positions.shift();
                this._times.shift();
            }
        }
        this._map
            .fire('move')
            .fire('drag');
    },
    _onViewReset: function () {
        // TODO fix hardcoded Earth values
        var pxCenter = this._map.getSize()._divideBy(2),
            pxWorldCenter = this._map.latLngToLayerPoint([0, 0]);
        this._initialWorldOffset = pxWorldCenter.subtract(pxCenter).x;
        this._worldWidth = this._map.project([0, 180]).x;
    },
    _onPreDrag: function () {
        // TODO refactor to be able to adjust map pane position after zoom
        var worldWidth = this._worldWidth,
            halfWidth = Math.round(worldWidth / 2),
            dx = this._initialWorldOffset,
            x = this._draggable._newPos.x,
            newX1 = (x - halfWidth + dx) % worldWidth + halfWidth - dx,
            newX2 = (x + halfWidth + dx) % worldWidth - halfWidth - dx,
            newX = Math.abs(newX1 + dx)
< Math.abs(newX2 + dx) ? newX1 : newX2;
        this._draggable._newPos.x = newX;
    },
    _onDragEnd: function (e) {
        var map = this._map,
            options = map.options,
            delay = +new Date() - this._lastTime,
            noInertia = !options.inertia || delay >
 options.inertiaThreshold || !this._positions[0];
        map.fire('dragend', e);
        if (noInertia) {
            map.fire('moveend');
        } else {
            var direction = this._lastPos.subtract(this._positions[0]),
                duration = (this._lastTime + delay - this._times[0]) / 1000,
                ease = options.easeLinearity,
                speedVector = direction.multiplyBy(ease / duration),
                speed = speedVector.distanceTo([0, 0]),
                limitedSpeed = Math.min(options.inertiaMaxSpeed, speed),
                limitedSpeedVector = speedVector.multiplyBy(limitedSpeed / speed),
                decelerationDuration = limitedSpeed / (options.inertiaDeceleration * ease),
                offset = limitedSpeedVector.multiplyBy(-decelerationDuration / 2).round();
            if (!offset.x || !offset.y) {
                map.fire('moveend');
            } else {
                offset = map._limitOffset(offset, map.options.maxBounds);
                L.Util.requestAnimFrame(function () {
                    map.panBy(offset, {
                        duration: decelerationDuration,
                        easeLinearity: ease,
                        noMoveStart: true
                    });
                });
            }
        }
    }
});
L.Map.addInitHook('addHandler', 'dragging', L.Map.Drag);
/*
 * L.Handler.DoubleClickZoom is used to handle double-click zoom on the map, enabled by default.
 */
L.Map.mergeOptions({
    doubleClickZoom: true
});
L.Map.DoubleClickZoom = L.Handler.extend({
    addHooks: function () {
        this._map.on('dblclick', this._onDoubleClick, this);
    },
    removeHooks: function () {
        this._map.off('dblclick', this._onDoubleClick, this);
    },
    _onDoubleClick: function (e) {
        var map = this._map,
            zoom = map.getZoom() + (e.originalEvent.shiftKey ? -1 : 1);
        if (map.options.doubleClickZoom === 'center') {
            map.setZoom(zoom);
        } else {
            map.setZoomAround(e.containerPoint, zoom);
        }
    }
});
L.Map.addInitHook('addHandler', 'doubleClickZoom', L.Map.DoubleClickZoom);
/*
 * L.Handler.ScrollWheelZoom is used by L.Map to enable mouse scroll wheel zoom on the map.
 */
L.Map.mergeOptions({
    scrollWheelZoom: true
});
L.Map.ScrollWheelZoom = L.Handler.extend({
    addHooks: function () {
        L.DomEvent.on(this._map._container, 'mousewheel', this._onWheelScroll, this);
        L.DomEvent.on(this._map._container, 'MozMousePixelScroll', L.DomEvent.preventDefault);
        this._delta = 0;
    },
    removeHooks: function () {
        L.DomEvent.off(this._map._container, 'mousewheel', this._onWheelScroll);
        L.DomEvent.off(this._map._container, 'MozMousePixelScroll', L.DomEvent.preventDefault);
    },
    _onWheelScroll: function (e) {
        var delta = L.DomEvent.getWheelDelta(e);
        this._delta += delta;
        this._lastMousePos = this._map.mouseEventToContainerPoint(e);
        if (!this._startTime) {
            this._startTime = +new Date();
        }
        var left = Math.max(40 - (+new Date() - this._startTime), 0);
        clearTimeout(this._timer);
        this._timer = setTimeout(L.bind(this._performZoom, this), left);
        L.DomEvent.preventDefault(e);
        L.DomEvent.stopPropagation(e);
    },
    _performZoom: function () {
        var map = this._map,
            delta = this._delta,
            zoom = map.getZoom();
        delta = delta >
 0 ? Math.ceil(delta) : Math.floor(delta);
        delta = Math.max(Math.min(delta, 4), -4);
        delta = map._limitZoom(zoom + delta) - zoom;
        this._delta = 0;
        this._startTime = null;
        if (!delta) { return; }
        if (map.options.scrollWheelZoom === 'center') {
            map.setZoom(zoom + delta);
        } else {
            map.setZoomAround(this._lastMousePos, zoom + delta);
        }
    }
});
L.Map.addInitHook('addHandler', 'scrollWheelZoom', L.Map.ScrollWheelZoom);
/*
 * Extends the event handling code with double tap support for mobile browsers.
 */
L.extend(L.DomEvent, {
    _touchstart: L.Browser.msPointer ? 'MSPointerDown' : L.Browser.pointer ? 'pointerdown' : 'touchstart',
    _touchend: L.Browser.msPointer ? 'MSPointerUp' : L.Browser.pointer ? 'pointerup' : 'touchend',
    // inspired by Zepto touch code by Thomas Fuchs
    addDoubleTapListener: function (obj, handler, id) {
        var last,
            doubleTap = false,
            delay = 250,
            touch,
            pre = '_leaflet_',
            touchstart = this._touchstart,
            touchend = this._touchend,
            trackedTouches = [];
        function onTouchStart(e) {
            var count;
            if (L.Browser.pointer) {
                trackedTouches.push(e.pointerId);
                count = trackedTouches.length;
            } else {
                count = e.touches.length;
            }
            if (count >
 1) {
                return;
            }
            var now = Date.now(),
                delta = now - (last || now);
            touch = e.touches ? e.touches[0] : e;
            doubleTap = (delta >
 0 && delta
<= delay);
            last = now;
        }
        function onTouchEnd(e) {
            if (L.Browser.pointer) {
                var idx = trackedTouches.indexOf(e.pointerId);
                if (idx === -1) {
                    return;
                }
                trackedTouches.splice(idx, 1);
            }
            if (doubleTap) {
                if (L.Browser.pointer) {
                    // work around .type being readonly with MSPointer* events
                    var newTouch = { },
                        prop;
                    // jshint forin:false
                    for (var i in touch) {
                        prop = touch[i];
                        if (typeof prop === 'function') {
                            newTouch[i] = prop.bind(touch);
                        } else {
                            newTouch[i] = prop;
                        }
                    }
                    touch = newTouch;
                }
                touch.type = 'dblclick';
                handler(touch);
                last = null;
            }
        }
        obj[pre + touchstart + id] = onTouchStart;
        obj[pre + touchend + id] = onTouchEnd;
        // on pointer we need to listen on the document, otherwise a drag starting on the map and moving off screen
        // will not come through to us, so we will lose track of how many touches are ongoing
        var endElement = L.Browser.pointer ? document.documentElement : obj;
        obj.addEventListener(touchstart, onTouchStart, false);
        endElement.addEventListener(touchend, onTouchEnd, false);
        if (L.Browser.pointer) {
            endElement.addEventListener(L.DomEvent.POINTER_CANCEL, onTouchEnd, false);
        }
        return this;
    },
    removeDoubleTapListener: function (obj, id) {
        var pre = '_leaflet_';
        obj.removeEventListener(this._touchstart, obj[pre + this._touchstart + id], false);
        (L.Browser.pointer ? document.documentElement : obj).removeEventListener(
                this._touchend, obj[pre + this._touchend + id], false);
        if (L.Browser.pointer) {
            document.documentElement.removeEventListener(L.DomEvent.POINTER_CANCEL, obj[pre + this._touchend + id],
                false);
        }
        return this;
    }
});
/*
 * Extends L.DomEvent to provide touch support for Internet Explorer and Windows-based devices.
 */
L.extend(L.DomEvent, {
    //static
    POINTER_DOWN: L.Browser.msPointer ? 'MSPointerDown' : 'pointerdown',
    POINTER_MOVE: L.Browser.msPointer ? 'MSPointerMove' : 'pointermove',
    POINTER_UP: L.Browser.msPointer ? 'MSPointerUp' : 'pointerup',
    POINTER_CANCEL: L.Browser.msPointer ? 'MSPointerCancel' : 'pointercancel',
    _pointers: [],
    _pointerDocumentListener: false,
    // Provides a touch events wrapper for (ms)pointer events.
    // Based on changes by veproza https://github.com/CloudMade/Leaflet/pull/1019
    //ref http://www.w3.org/TR/pointerevents/ https://www.w3.org/Bugs/Public/show_bug.cgi?id=22890
    addPointerListener: function (obj, type, handler, id) {
        switch (type) {
        case 'touchstart':
            return this.addPointerListenerStart(obj, type, handler, id);
        case 'touchend':
            return this.addPointerListenerEnd(obj, type, handler, id);
        case 'touchmove':
            return this.addPointerListenerMove(obj, type, handler, id);
        default:
            throw 'Unknown touch event type';
        }
    },
    addPointerListenerStart: function (obj, type, handler, id) {
        var pre = '_leaflet_',
            pointers = this._pointers;
        var cb = function (e) {
            L.DomEvent.preventDefault(e);
            var alreadyInArray = false;
            for (var i = 0; i
< pointers.length; i++) {
                if (pointers[i].pointerId === e.pointerId) {
                    alreadyInArray = true;
                    break;
                }
            }
            if (!alreadyInArray) {
                pointers.push(e);
            }
            e.touches = pointers.slice();
            e.changedTouches = [e];
            handler(e);
        };
        obj[pre + 'touchstart' + id] = cb;
        obj.addEventListener(this.POINTER_DOWN, cb, false);
        // need to also listen for end events to keep the _pointers list accurate
        // this needs to be on the body and never go away
        if (!this._pointerDocumentListener) {
            var internalCb = function (e) {
                for (var i = 0; i
< pointers.length; i++) {
                    if (pointers[i].pointerId === e.pointerId) {
                        pointers.splice(i, 1);
                        break;
                    }
                }
            };
            //We listen on the documentElement as any drags that end by moving the touch off the screen get fired there
            document.documentElement.addEventListener(this.POINTER_UP, internalCb, false);
            document.documentElement.addEventListener(this.POINTER_CANCEL, internalCb, false);
            this._pointerDocumentListener = true;
        }
        return this;
    },
    addPointerListenerMove: function (obj, type, handler, id) {
        var pre = '_leaflet_',
            touches = this._pointers;
        function cb(e) {
            // don't fire touch moves when mouse isn't down
            if ((e.pointerType === e.MSPOINTER_TYPE_MOUSE || e.pointerType === 'mouse') && e.buttons === 0) { return; }
            for (var i = 0; i
< touches.length; i++) {
                if (touches[i].pointerId === e.pointerId) {
                    touches[i] = e;
                    break;
                }
            }
            e.touches = touches.slice();
            e.changedTouches = [e];
            handler(e);
        }
        obj[pre + 'touchmove' + id] = cb;
        obj.addEventListener(this.POINTER_MOVE, cb, false);
        return this;
    },
    addPointerListenerEnd: function (obj, type, handler, id) {
        var pre = '_leaflet_',
            touches = this._pointers;
        var cb = function (e) {
            for (var i = 0; i
< touches.length; i++) {
                if (touches[i].pointerId === e.pointerId) {
                    touches.splice(i, 1);
                    break;
                }
            }
            e.touches = touches.slice();
            e.changedTouches = [e];
            handler(e);
        };
        obj[pre + 'touchend' + id] = cb;
        obj.addEventListener(this.POINTER_UP, cb, false);
        obj.addEventListener(this.POINTER_CANCEL, cb, false);
        return this;
    },
    removePointerListener: function (obj, type, id) {
        var pre = '_leaflet_',
            cb = obj[pre + type + id];
        switch (type) {
        case 'touchstart':
            obj.removeEventListener(this.POINTER_DOWN, cb, false);
            break;
        case 'touchmove':
            obj.removeEventListener(this.POINTER_MOVE, cb, false);
            break;
        case 'touchend':
            obj.removeEventListener(this.POINTER_UP, cb, false);
            obj.removeEventListener(this.POINTER_CANCEL, cb, false);
            break;
        }
        return this;
    }
});
/*
 * L.Handler.TouchZoom is used by L.Map to add pinch zoom on supported mobile browsers.
 */
L.Map.mergeOptions({
    touchZoom: L.Browser.touch && !L.Browser.android23,
    bounceAtZoomLimits: true
});
L.Map.TouchZoom = L.Handler.extend({
    addHooks: function () {
        L.DomEvent.on(this._map._container, 'touchstart', this._onTouchStart, this);
    },
    removeHooks: function () {
        L.DomEvent.off(this._map._container, 'touchstart', this._onTouchStart, this);
    },
    _onTouchStart: function (e) {
        var map = this._map;
        if (!e.touches || e.touches.length !== 2 || map._animatingZoom || this._zooming) { return; }
        var p1 = map.mouseEventToLayerPoint(e.touches[0]),
            p2 = map.mouseEventToLayerPoint(e.touches[1]),
            viewCenter = map._getCenterLayerPoint();
        this._startCenter = p1.add(p2)._divideBy(2);
        this._startDist = p1.distanceTo(p2);
        this._moved = false;
        this._zooming = true;
        this._centerOffset = viewCenter.subtract(this._startCenter);
        if (map._panAnim) {
            map._panAnim.stop();
        }
        L.DomEvent
            .on(document, 'touchmove', this._onTouchMove, this)
            .on(document, 'touchend', this._onTouchEnd, this);
        L.DomEvent.preventDefault(e);
    },
    _onTouchMove: function (e) {
        var map = this._map;
        if (!e.touches || e.touches.length !== 2 || !this._zooming) { return; }
        var p1 = map.mouseEventToLayerPoint(e.touches[0]),
            p2 = map.mouseEventToLayerPoint(e.touches[1]);
        this._scale = p1.distanceTo(p2) / this._startDist;
        this._delta = p1._add(p2)._divideBy(2)._subtract(this._startCenter);
        if (this._scale === 1) { return; }
        if (!map.options.bounceAtZoomLimits) {
            if ((map.getZoom() === map.getMinZoom() && this._scale
< 1) ||
                (map.getZoom() === map.getMaxZoom() && this._scale >
 1)) { return; }
        }
        if (!this._moved) {
            L.DomUtil.addClass(map._mapPane, 'leaflet-touching');
            map
                .fire('movestart')
                .fire('zoomstart');
            this._moved = true;
        }
        L.Util.cancelAnimFrame(this._animRequest);
        this._animRequest = L.Util.requestAnimFrame(
                this._updateOnMove, this, true, this._map._container);
        L.DomEvent.preventDefault(e);
    },
    _updateOnMove: function () {
        var map = this._map,
            origin = this._getScaleOrigin(),
            center = map.layerPointToLatLng(origin),
            zoom = map.getScaleZoom(this._scale);
        map._animateZoom(center, zoom, this._startCenter, this._scale, this._delta, false, true);
    },
    _onTouchEnd: function () {
        if (!this._moved || !this._zooming) {
            this._zooming = false;
            return;
        }
        var map = this._map;
        this._zooming = false;
        L.DomUtil.removeClass(map._mapPane, 'leaflet-touching');
        L.Util.cancelAnimFrame(this._animRequest);
        L.DomEvent
            .off(document, 'touchmove', this._onTouchMove)
            .off(document, 'touchend', this._onTouchEnd);
        var origin = this._getScaleOrigin(),
            center = map.layerPointToLatLng(origin),
            oldZoom = map.getZoom(),
            floatZoomDelta = map.getScaleZoom(this._scale) - oldZoom,
            roundZoomDelta = (floatZoomDelta >
 0 ?
                    Math.ceil(floatZoomDelta) : Math.floor(floatZoomDelta)),
            zoom = map._limitZoom(oldZoom + roundZoomDelta),
            scale = map.getZoomScale(zoom) / this._scale;
        map._animateZoom(center, zoom, origin, scale);
    },
    _getScaleOrigin: function () {
        var centerOffset = this._centerOffset.subtract(this._delta).divideBy(this._scale);
        return this._startCenter.add(centerOffset);
    }
});
L.Map.addInitHook('addHandler', 'touchZoom', L.Map.TouchZoom);
/*
 * L.Map.Tap is used to enable mobile hacks like quick taps and long hold.
 */
L.Map.mergeOptions({
    tap: true,
    tapTolerance: 15
});
L.Map.Tap = L.Handler.extend({
    addHooks: function () {
        L.DomEvent.on(this._map._container, 'touchstart', this._onDown, this);
    },
    removeHooks: function () {
        L.DomEvent.off(this._map._container, 'touchstart', this._onDown, this);
    },
    _onDown: function (e) {
        if (!e.touches) { return; }
        L.DomEvent.preventDefault(e);
        this._fireClick = true;
        // don't simulate click or track longpress if more than 1 touch
        if (e.touches.length >
 1) {
            this._fireClick = false;
            clearTimeout(this._holdTimeout);
            return;
        }
        var first = e.touches[0],
            el = first.target;
        this._startPos = this._newPos = new L.Point(first.clientX, first.clientY);
        // if touching a link, highlight it
        if (el.tagName && el.tagName.toLowerCase() === 'a') {
            L.DomUtil.addClass(el, 'leaflet-active');
        }
        // simulate long hold but setting a timeout
        this._holdTimeout = setTimeout(L.bind(function () {
            if (this._isTapValid()) {
                this._fireClick = false;
                this._onUp();
                this._simulateEvent('contextmenu', first);
            }
        }, this), 1000);
        L.DomEvent
            .on(document, 'touchmove', this._onMove, this)
            .on(document, 'touchend', this._onUp, this);
    },
    _onUp: function (e) {
        clearTimeout(this._holdTimeout);
        L.DomEvent
            .off(document, 'touchmove', this._onMove, this)
            .off(document, 'touchend', this._onUp, this);
        if (this._fireClick && e && e.changedTouches) {
            var first = e.changedTouches[0],
                el = first.target;
            if (el && el.tagName && el.tagName.toLowerCase() === 'a') {
                L.DomUtil.removeClass(el, 'leaflet-active');
            }
            // simulate click if the touch didn't move too much
            if (this._isTapValid()) {
                this._simulateEvent('click', first);
            }
        }
    },
    _isTapValid: function () {
        return this._newPos.distanceTo(this._startPos)
<= this._map.options.tapTolerance;
    },
    _onMove: function (e) {
        var first = e.touches[0];
        this._newPos = new L.Point(first.clientX, first.clientY);
    },
    _simulateEvent: function (type, e) {
        var simulatedEvent = document.createEvent('MouseEvents');
        simulatedEvent._simulated = true;
        e.target._simulatedClick = true;
        simulatedEvent.initMouseEvent(
                type, true, true, window, 1,
                e.screenX, e.screenY,
                e.clientX, e.clientY,
                false, false, false, false, 0, null);
        e.target.dispatchEvent(simulatedEvent);
    }
});
if (L.Browser.touch && !L.Browser.pointer) {
    L.Map.addInitHook('addHandler', 'tap', L.Map.Tap);
}
/*
 * L.Handler.ShiftDragZoom is used to add shift-drag zoom interaction to the map
  * (zoom to a selected bounding box), enabled by default.
 */
L.Map.mergeOptions({
    boxZoom: true
});
L.Map.BoxZoom = L.Handler.extend({
    initialize: function (map) {
        this._map = map;
        this._container = map._container;
        this._pane = map._panes.overlayPane;
        this._moved = false;
    },
    addHooks: function () {
        L.DomEvent.on(this._container, 'mousedown', this._onMouseDown, this);
    },
    removeHooks: function () {
        L.DomEvent.off(this._container, 'mousedown', this._onMouseDown);
        this._moved = false;
    },
    moved: function () {
        return this._moved;
    },
    _onMouseDown: function (e) {
        this._moved = false;
        if (!e.shiftKey || ((e.which !== 1) && (e.button !== 1))) { return false; }
        L.DomUtil.disableTextSelection();
        L.DomUtil.disableImageDrag();
        this._startLayerPoint = this._map.mouseEventToLayerPoint(e);
        L.DomEvent
            .on(document, 'mousemove', this._onMouseMove, this)
            .on(document, 'mouseup', this._onMouseUp, this)
            .on(document, 'keydown', this._onKeyDown, this);
    },
    _onMouseMove: function (e) {
        if (!this._moved) {
            this._box = L.DomUtil.create('div', 'leaflet-zoom-box', this._pane);
            L.DomUtil.setPosition(this._box, this._startLayerPoint);
            //TODO refactor: move cursor to styles
            this._container.style.cursor = 'crosshair';
            this._map.fire('boxzoomstart');
        }
        var startPoint = this._startLayerPoint,
            box = this._box,
            layerPoint = this._map.mouseEventToLayerPoint(e),
            offset = layerPoint.subtract(startPoint),
            newPos = new L.Point(
                Math.min(layerPoint.x, startPoint.x),
                Math.min(layerPoint.y, startPoint.y));
        L.DomUtil.setPosition(box, newPos);
        this._moved = true;
        // TODO refactor: remove hardcoded 4 pixels
        box.style.width  = (Math.max(0, Math.abs(offset.x) - 4)) + 'px';
        box.style.height = (Math.max(0, Math.abs(offset.y) - 4)) + 'px';
    },
    _finish: function () {
        if (this._moved) {
            this._pane.removeChild(this._box);
            this._container.style.cursor = '';
        }
        L.DomUtil.enableTextSelection();
        L.DomUtil.enableImageDrag();
        L.DomEvent
            .off(document, 'mousemove', this._onMouseMove)
            .off(document, 'mouseup', this._onMouseUp)
            .off(document, 'keydown', this._onKeyDown);
    },
    _onMouseUp: function (e) {
        this._finish();
        var map = this._map,
            layerPoint = map.mouseEventToLayerPoint(e);
        if (this._startLayerPoint.equals(layerPoint)) { return; }
        var bounds = new L.LatLngBounds(
                map.layerPointToLatLng(this._startLayerPoint),
                map.layerPointToLatLng(layerPoint));
        map.fitBounds(bounds);
        map.fire('boxzoomend', {
            boxZoomBounds: bounds
        });
    },
    _onKeyDown: function (e) {
        if (e.keyCode === 27) {
            this._finish();
        }
    }
});
L.Map.addInitHook('addHandler', 'boxZoom', L.Map.BoxZoom);
/*
 * L.Map.Keyboard is handling keyboard interaction with the map, enabled by default.
 */
L.Map.mergeOptions({
    keyboard: true,
    keyboardPanOffset: 80,
    keyboardZoomOffset: 1
});
L.Map.Keyboard = L.Handler.extend({
    keyCodes: {
        left:    [37],
        right:   [39],
        down:    [40],
        up:      [38],
        zoomIn:  [187, 107, 61, 171],
        zoomOut: [189, 109, 173]
    },
    initialize: function (map) {
        this._map = map;
        this._setPanOffset(map.options.keyboardPanOffset);
        this._setZoomOffset(map.options.keyboardZoomOffset);
    },
    addHooks: function () {
        var container = this._map._container;
        // make the container focusable by tabbing
        if (container.tabIndex === -1) {
            container.tabIndex = '0';
        }
        L.DomEvent
            .on(container, 'focus', this._onFocus, this)
            .on(container, 'blur', this._onBlur, this)
            .on(container, 'mousedown', this._onMouseDown, this);
        this._map
            .on('focus', this._addHooks, this)
            .on('blur', this._removeHooks, this);
    },
    removeHooks: function () {
        this._removeHooks();
        var container = this._map._container;
        L.DomEvent
            .off(container, 'focus', this._onFocus, this)
            .off(container, 'blur', this._onBlur, this)
            .off(container, 'mousedown', this._onMouseDown, this);
        this._map
            .off('focus', this._addHooks, this)
            .off('blur', this._removeHooks, this);
    },
    _onMouseDown: function () {
        if (this._focused) { return; }
        var body = document.body,
            docEl = document.documentElement,
            top = body.scrollTop || docEl.scrollTop,
            left = body.scrollLeft || docEl.scrollLeft;
        this._map._container.focus();
        window.scrollTo(left, top);
    },
    _onFocus: function () {
        this._focused = true;
        this._map.fire('focus');
    },
    _onBlur: function () {
        this._focused = false;
        this._map.fire('blur');
    },
    _setPanOffset: function (pan) {
        var keys = this._panKeys = {},
            codes = this.keyCodes,
            i, len;
        for (i = 0, len = codes.left.length; i
< len; i++) {
            keys[codes.left[i]] = [-1 * pan, 0];
        }
        for (i = 0, len = codes.right.length; i
< len; i++) {
            keys[codes.right[i]] = [pan, 0];
        }
        for (i = 0, len = codes.down.length; i
< len; i++) {
            keys[codes.down[i]] = [0, pan];
        }
        for (i = 0, len = codes.up.length; i
< len; i++) {
            keys[codes.up[i]] = [0, -1 * pan];
        }
    },
    _setZoomOffset: function (zoom) {
        var keys = this._zoomKeys = {},
            codes = this.keyCodes,
            i, len;
        for (i = 0, len = codes.zoomIn.length; i
< len; i++) {
            keys[codes.zoomIn[i]] = zoom;
        }
        for (i = 0, len = codes.zoomOut.length; i
< len; i++) {
            keys[codes.zoomOut[i]] = -zoom;
        }
    },
    _addHooks: function () {
        L.DomEvent.on(document, 'keydown', this._onKeyDown, this);
    },
    _removeHooks: function () {
        L.DomEvent.off(document, 'keydown', this._onKeyDown, this);
    },
    _onKeyDown: function (e) {
        var key = e.keyCode,
            map = this._map;
        if (key in this._panKeys) {
            if (map._panAnim && map._panAnim._inProgress) { return; }
            map.panBy(this._panKeys[key]);
            if (map.options.maxBounds) {
                map.panInsideBounds(map.options.maxBounds);
            }
        } else if (key in this._zoomKeys) {
            map.setZoom(map.getZoom() + this._zoomKeys[key]);
        } else {
            return;
        }
        L.DomEvent.stop(e);
    }
});
L.Map.addInitHook('addHandler', 'keyboard', L.Map.Keyboard);
/*
 * L.Handler.MarkerDrag is used internally by L.Marker to make the markers draggable.
 */
L.Handler.MarkerDrag = L.Handler.extend({
    initialize: function (marker) {
        this._marker = marker;
    },
    addHooks: function () {
        var icon = this._marker._icon;
        if (!this._draggable) {
            this._draggable = new L.Draggable(icon, icon);
        }
        this._draggable
            .on('dragstart', this._onDragStart, this)
            .on('drag', this._onDrag, this)
            .on('dragend', this._onDragEnd, this);
        this._draggable.enable();
        L.DomUtil.addClass(this._marker._icon, 'leaflet-marker-draggable');
    },
    removeHooks: function () {
        this._draggable
            .off('dragstart', this._onDragStart, this)
            .off('drag', this._onDrag, this)
            .off('dragend', this._onDragEnd, this);
        this._draggable.disable();
        L.DomUtil.removeClass(this._marker._icon, 'leaflet-marker-draggable');
    },
    moved: function () {
        return this._draggable && this._draggable._moved;
    },
    _onDragStart: function () {
        this._marker
            .closePopup()
            .fire('movestart')
            .fire('dragstart');
    },
    _onDrag: function () {
        var marker = this._marker,
            shadow = marker._shadow,
            iconPos = L.DomUtil.getPosition(marker._icon),
            latlng = marker._map.layerPointToLatLng(iconPos);
        // update shadow position
        if (shadow) {
            L.DomUtil.setPosition(shadow, iconPos);
        }
        marker._latlng = latlng;
        marker
            .fire('move', {latlng: latlng})
            .fire('drag');
    },
    _onDragEnd: function (e) {
        this._marker
            .fire('moveend')
            .fire('dragend', e);
    }
});
/*
 * L.Control is a base class for implementing map controls. Handles positioning.
 * All other controls extend from this class.
 */
L.Control = L.Class.extend({
    options: {
        position: 'topright'
    },
    initialize: function (options) {
        L.setOptions(this, options);
    },
    getPosition: function () {
        return this.options.position;
    },
    setPosition: function (position) {
        var map = this._map;
        if (map) {
            map.removeControl(this);
        }
        this.options.position = position;
        if (map) {
            map.addControl(this);
        }
        return this;
    },
    getContainer: function () {
        return this._container;
    },
    addTo: function (map) {
        this._map = map;
        var container = this._container = this.onAdd(map),
            pos = this.getPosition(),
            corner = map._controlCorners[pos];
        L.DomUtil.addClass(container, 'leaflet-control');
        if (pos.indexOf('bottom') !== -1) {
            corner.insertBefore(container, corner.firstChild);
        } else {
            corner.appendChild(container);
        }
        return this;
    },
    removeFrom: function (map) {
        var pos = this.getPosition(),
            corner = map._controlCorners[pos];
        corner.removeChild(this._container);
        this._map = null;
        if (this.onRemove) {
            this.onRemove(map);
        }
        return this;
    },
    _refocusOnMap: function () {
        if (this._map) {
            this._map.getContainer().focus();
        }
    }
});
L.control = function (options) {
    return new L.Control(options);
};
// adds control-related methods to L.Map
L.Map.include({
    addControl: function (control) {
        control.addTo(this);
        return this;
    },
    removeControl: function (control) {
        control.removeFrom(this);
        return this;
    },
    _initControlPos: function () {
        var corners = this._controlCorners = {},
            l = 'leaflet-',
            container = this._controlContainer =
                    L.DomUtil.create('div', l + 'control-container', this._container);
        function createCorner(vSide, hSide) {
            var className = l + vSide + ' ' + l + hSide;
            corners[vSide + hSide] = L.DomUtil.create('div', className, container);
        }
        createCorner('top', 'left');
        createCorner('top', 'right');
        createCorner('bottom', 'left');
        createCorner('bottom', 'right');
    },
    _clearControlPos: function () {
        this._container.removeChild(this._controlContainer);
    }
});
/*
 * L.Control.Zoom is used for the default zoom buttons on the map.
 */
L.Control.Zoom = L.Control.extend({
    options: {
        position: 'topleft',
        zoomInText: '+',
        zoomInTitle: 'Zoom in',
        zoomOutText: '-',
        zoomOutTitle: 'Zoom out'
    },
    onAdd: function (map) {
        var zoomName = 'leaflet-control-zoom',
            container = L.DomUtil.create('div', zoomName + ' leaflet-bar');
        this._map = map;
        this._zoomInButton  = this._createButton(
                this.options.zoomInText, this.options.zoomInTitle,
                zoomName + '-in',  container, this._zoomIn,  this);
        this._zoomOutButton = this._createButton(
                this.options.zoomOutText, this.options.zoomOutTitle,
                zoomName + '-out', container, this._zoomOut, this);
        this._updateDisabled();
        map.on('zoomend zoomlevelschange', this._updateDisabled, this);
        return container;
    },
    onRemove: function (map) {
        map.off('zoomend zoomlevelschange', this._updateDisabled, this);
    },
    _zoomIn: function (e) {
        this._map.zoomIn(e.shiftKey ? 3 : 1);
    },
    _zoomOut: function (e) {
        this._map.zoomOut(e.shiftKey ? 3 : 1);
    },
    _createButton: function (html, title, className, container, fn, context) {
        var link = L.DomUtil.create('a', className, container);
        link.innerHTML = html;
        link.href = '#';
        link.title = title;
        var stop = L.DomEvent.stopPropagation;
        L.DomEvent
            .on(link, 'click', stop)
            .on(link, 'mousedown', stop)
            .on(link, 'dblclick', stop)
            .on(link, 'click', L.DomEvent.preventDefault)
            .on(link, 'click', fn, context)
            .on(link, 'click', this._refocusOnMap, context);
        return link;
    },
    _updateDisabled: function () {
        var map = this._map,
            className = 'leaflet-disabled';
        L.DomUtil.removeClass(this._zoomInButton, className);
        L.DomUtil.removeClass(this._zoomOutButton, className);
        if (map._zoom === map.getMinZoom()) {
            L.DomUtil.addClass(this._zoomOutButton, className);
        }
        if (map._zoom === map.getMaxZoom()) {
            L.DomUtil.addClass(this._zoomInButton, className);
        }
    }
});
L.Map.mergeOptions({
    zoomControl: true
});
L.Map.addInitHook(function () {
    if (this.options.zoomControl) {
        this.zoomControl = new L.Control.Zoom();
        this.addControl(this.zoomControl);
    }
});
L.control.zoom = function (options) {
    return new L.Control.Zoom(options);
};
/*
 * L.Control.Attribution is used for displaying attribution on the map (added by default).
 */
L.Control.Attribution = L.Control.extend({
    options: {
        position: 'bottomright',
        prefix: '
<a href="http://leafletjs.com" title="A JS library for interactive maps">
Leaflet
</a>
'
    },
    initialize: function (options) {
        L.setOptions(this, options);
        this._attributions = {};
    },
    onAdd: function (map) {
        this._container = L.DomUtil.create('div', 'leaflet-control-attribution');
        L.DomEvent.disableClickPropagation(this._container);
        for (var i in map._layers) {
            if (map._layers[i].getAttribution) {
                this.addAttribution(map._layers[i].getAttribution());
            }
        }
        map
            .on('layeradd', this._onLayerAdd, this)
            .on('layerremove', this._onLayerRemove, this);
        this._update();
        return this._container;
    },
    onRemove: function (map) {
        map
            .off('layeradd', this._onLayerAdd)
            .off('layerremove', this._onLayerRemove);
    },
    setPrefix: function (prefix) {
        this.options.prefix = prefix;
        this._update();
        return this;
    },
    addAttribution: function (text) {
        if (!text) { return; }
        if (!this._attributions[text]) {
            this._attributions[text] = 0;
        }
        this._attributions[text]++;
        this._update();
        return this;
    },
    removeAttribution: function (text) {
        if (!text) { return; }
        if (this._attributions[text]) {
            this._attributions[text]--;
            this._update();
        }
        return this;
    },
    _update: function () {
        if (!this._map) { return; }
        var attribs = [];
        for (var i in this._attributions) {
            if (this._attributions[i]) {
                attribs.push(i);
            }
        }
        var prefixAndAttribs = [];
        if (this.options.prefix) {
            prefixAndAttribs.push(this.options.prefix);
        }
        if (attribs.length) {
            prefixAndAttribs.push(attribs.join(', '));
        }
        this._container.innerHTML = prefixAndAttribs.join(' | ');
    },
    _onLayerAdd: function (e) {
        if (e.layer.getAttribution) {
            this.addAttribution(e.layer.getAttribution());
        }
    },
    _onLayerRemove: function (e) {
        if (e.layer.getAttribution) {
            this.removeAttribution(e.layer.getAttribution());
        }
    }
});
L.Map.mergeOptions({
    attributionControl: true
});
L.Map.addInitHook(function () {
    if (this.options.attributionControl) {
        this.attributionControl = (new L.Control.Attribution()).addTo(this);
    }
});
L.control.attribution = function (options) {
    return new L.Control.Attribution(options);
};
/*
 * L.Control.Scale is used for displaying metric/imperial scale on the map.
 */
L.Control.Scale = L.Control.extend({
    options: {
        position: 'bottomleft',
        maxWidth: 100,
        metric: true,
        imperial: true,
        updateWhenIdle: false
    },
    onAdd: function (map) {
        this._map = map;
        var className = 'leaflet-control-scale',
            container = L.DomUtil.create('div', className),
            options = this.options;
        this._addScales(options, className, container);
        map.on(options.updateWhenIdle ? 'moveend' : 'move', this._update, this);
        map.whenReady(this._update, this);
        return container;
    },
    onRemove: function (map) {
        map.off(this.options.updateWhenIdle ? 'moveend' : 'move', this._update, this);
    },
    _addScales: function (options, className, container) {
        if (options.metric) {
            this._mScale = L.DomUtil.create('div', className + '-line', container);
        }
        if (options.imperial) {
            this._iScale = L.DomUtil.create('div', className + '-line', container);
        }
    },
    _update: function () {
        var bounds = this._map.getBounds(),
            centerLat = bounds.getCenter().lat,
            halfWorldMeters = 6367000.0 * Math.PI * Math.cos(centerLat * Math.PI / 180),
            dist = halfWorldMeters * (bounds.getNorthEast().lng - bounds.getSouthWest().lng) / 180,
            size = this._map.getSize(),
            options = this.options,
            maxMeters = 0;
        if (size.x >
 0) {
            maxMeters = dist * (options.maxWidth / size.x);
        }
        this._updateScales(options, maxMeters);
    },
    _updateScales: function (options, maxMeters) {
        if (options.metric && maxMeters) {
            this._updateMetric(maxMeters);
        }
        if (options.imperial && maxMeters) {
            this._updateImperial(maxMeters);
        }
    },
    _updateMetric: function (maxMeters) {
        var meters = this._getRoundNum(maxMeters);
        this._mScale.style.width = this._getScaleWidth(meters / maxMeters) + 'px';
        this._mScale.innerHTML = meters
< 1000 ? meters + ' m' : (meters / 1000) + ' km';
    },
    _updateImperial: function (maxMeters) {
        var maxFeet = maxMeters * 3.2808399,
            scale = this._iScale,
            maxMiles, miles, feet;
        if (maxFeet >
 5280) {
            maxMiles = maxFeet / 5280;
            miles = this._getRoundNum(maxMiles);
            scale.style.width = this._getScaleWidth(miles / maxMiles) + 'px';
            scale.innerHTML = miles + ' mi';
        } else {
            feet = this._getRoundNum(maxFeet);
            scale.style.width = this._getScaleWidth(feet / maxFeet) + 'px';
            scale.innerHTML = feet + ' ft';
        }
    },
    _getScaleWidth: function (ratio) {
        return Math.round(this.options.maxWidth * ratio) - 10;
    },
    _getRoundNum: function (num) {
        var pow10 = Math.pow(10, (Math.floor(num) + '').length - 1),
            d = num / pow10;
        d = d >
= 10 ? 10 : d >
= 5 ? 5 : d >
= 3 ? 3 : d >
= 2 ? 2 : 1;
        return pow10 * d;
    }
});
L.control.scale = function (options) {
    return new L.Control.Scale(options);
};
/*
 * L.Control.Layers is a control to allow users to switch between different layers on the map.
 */
L.Control.Layers = L.Control.extend({
    options: {
        collapsed: true,
        position: 'topright',
        autoZIndex: true
    },
    initialize: function (baseLayers, overlays, options) {
        L.setOptions(this, options);
        this._layers = {};
        this._lastZIndex = 0;
        this._handlingClick = false;
        for (var i in baseLayers) {
            this._addLayer(baseLayers[i], i);
        }
        for (i in overlays) {
            this._addLayer(overlays[i], i, true);
        }
    },
    onAdd: function (map) {
        this._initLayout();
        this._update();
        map
            .on('layeradd', this._onLayerChange, this)
            .on('layerremove', this._onLayerChange, this);
        return this._container;
    },
    onRemove: function (map) {
        map
            .off('layeradd', this._onLayerChange, this)
            .off('layerremove', this._onLayerChange, this);
    },
    addBaseLayer: function (layer, name) {
        this._addLayer(layer, name);
        this._update();
        return this;
    },
    addOverlay: function (layer, name) {
        this._addLayer(layer, name, true);
        this._update();
        return this;
    },
    removeLayer: function (layer) {
        var id = L.stamp(layer);
        delete this._layers[id];
        this._update();
        return this;
    },
    _initLayout: function () {
        var className = 'leaflet-control-layers',
            container = this._container = L.DomUtil.create('div', className);
        //Makes this work on IE10 Touch devices by stopping it from firing a mouseout event when the touch is released
        container.setAttribute('aria-haspopup', true);
        if (!L.Browser.touch) {
            L.DomEvent
                .disableClickPropagation(container)
                .disableScrollPropagation(container);
        } else {
            L.DomEvent.on(container, 'click', L.DomEvent.stopPropagation);
        }
        var form = this._form = L.DomUtil.create('form', className + '-list');
        if (this.options.collapsed) {
            if (!L.Browser.android) {
                L.DomEvent
                    .on(container, 'mouseover', this._expand, this)
                    .on(container, 'mouseout', this._collapse, this);
            }
            var link = this._layersLink = L.DomUtil.create('a', className + '-toggle', container);
            link.href = '#';
            link.title = 'Layers';
            if (L.Browser.touch) {
                L.DomEvent
                    .on(link, 'click', L.DomEvent.stop)
                    .on(link, 'click', this._expand, this);
            }
            else {
                L.DomEvent.on(link, 'focus', this._expand, this);
            }
            //Work around for Firefox android issue https://github.com/Leaflet/Leaflet/issues/2033
            L.DomEvent.on(form, 'click', function () {
                setTimeout(L.bind(this._onInputClick, this), 0);
            }, this);
            this._map.on('click', this._collapse, this);
            // TODO keyboard accessibility
        } else {
            this._expand();
        }
        this._baseLayersList = L.DomUtil.create('div', className + '-base', form);
        this._separator = L.DomUtil.create('div', className + '-separator', form);
        this._overlaysList = L.DomUtil.create('div', className + '-overlays', form);
        container.appendChild(form);
    },
    _addLayer: function (layer, name, overlay) {
        var id = L.stamp(layer);
        this._layers[id] = {
            layer: layer,
            name: name,
            overlay: overlay
        };
        if (this.options.autoZIndex && layer.setZIndex) {
            this._lastZIndex++;
            layer.setZIndex(this._lastZIndex);
        }
    },
    _update: function () {
        if (!this._container) {
            return;
        }
        this._baseLayersList.innerHTML = '';
        this._overlaysList.innerHTML = '';
        var baseLayersPresent = false,
            overlaysPresent = false,
            i, obj;
        for (i in this._layers) {
            obj = this._layers[i];
            this._addItem(obj);
            overlaysPresent = overlaysPresent || obj.overlay;
            baseLayersPresent = baseLayersPresent || !obj.overlay;
        }
        this._separator.style.display = overlaysPresent && baseLayersPresent ? '' : 'none';
    },
    _onLayerChange: function (e) {
        var obj = this._layers[L.stamp(e.layer)];
        if (!obj) { return; }
        if (!this._handlingClick) {
            this._update();
        }
        var type = obj.overlay ?
            (e.type === 'layeradd' ? 'overlayadd' : 'overlayremove') :
            (e.type === 'layeradd' ? 'baselayerchange' : null);
        if (type) {
            this._map.fire(type, obj);
        }
    },
    // IE7 bugs out if you create a radio dynamically, so you have to do it this hacky way (see http://bit.ly/PqYLBe)
    _createRadioElement: function (name, checked) {
        var radioHtml = '
<input type="radio" class="leaflet-control-layers-selector" name="' + name + '"';
        if (checked) {
            radioHtml += ' checked="checked"';
        }
        radioHtml += '/>
';
        var radioFragment = document.createElement('div');
        radioFragment.innerHTML = radioHtml;
        return radioFragment.firstChild;
    },
    _addItem: function (obj) {
        var label = document.createElement('label'),
            input,
            checked = this._map.hasLayer(obj.layer);
        if (obj.overlay) {
            input = document.createElement('input');
            input.type = 'checkbox';
            input.className = 'leaflet-control-layers-selector';
            input.defaultChecked = checked;
        } else {
            input = this._createRadioElement('leaflet-base-layers', checked);
        }
        input.layerId = L.stamp(obj.layer);
        L.DomEvent.on(input, 'click', this._onInputClick, this);
        var name = document.createElement('span');
        name.innerHTML = ' ' + obj.name;
        label.appendChild(input);
        label.appendChild(name);
        var container = obj.overlay ? this._overlaysList : this._baseLayersList;
        container.appendChild(label);
        return label;
    },
    _onInputClick: function () {
        var i, input, obj,
            inputs = this._form.getElementsByTagName('input'),
            inputsLen = inputs.length;
        this._handlingClick = true;
        for (i = 0; i
< inputsLen; i++) {
            input = inputs[i];
            obj = this._layers[input.layerId];
            if (input.checked && !this._map.hasLayer(obj.layer)) {
                this._map.addLayer(obj.layer);
            } else if (!input.checked && this._map.hasLayer(obj.layer)) {
                this._map.removeLayer(obj.layer);
            }
        }
        this._handlingClick = false;
        this._refocusOnMap();
    },
    _expand: function () {
        L.DomUtil.addClass(this._container, 'leaflet-control-layers-expanded');
    },
    _collapse: function () {
        this._container.className = this._container.className.replace(' leaflet-control-layers-expanded', '');
    }
});
L.control.layers = function (baseLayers, overlays, options) {
    return new L.Control.Layers(baseLayers, overlays, options);
};
/*
 * L.PosAnimation is used by Leaflet internally for pan animations.
 */
L.PosAnimation = L.Class.extend({
    includes: L.Mixin.Events,
    run: function (el, newPos, duration, easeLinearity) { // (HTMLElement, Point[, Number, Number])
        this.stop();
        this._el = el;
        this._inProgress = true;
        this._newPos = newPos;
        this.fire('start');
        el.style[L.DomUtil.TRANSITION] = 'all ' + (duration || 0.25) +
                's cubic-bezier(0,0,' + (easeLinearity || 0.5) + ',1)';
        L.DomEvent.on(el, L.DomUtil.TRANSITION_END, this._onTransitionEnd, this);
        L.DomUtil.setPosition(el, newPos);
        // toggle reflow, Chrome flickers for some reason if you don't do this
        L.Util.falseFn(el.offsetWidth);
        // there's no native way to track value updates of transitioned properties, so we imitate this
        this._stepTimer = setInterval(L.bind(this._onStep, this), 50);
    },
    stop: function () {
        if (!this._inProgress) { return; }
        // if we just removed the transition property, the element would jump to its final position,
        // so we need to make it stay at the current position
        L.DomUtil.setPosition(this._el, this._getPos());
        this._onTransitionEnd();
        L.Util.falseFn(this._el.offsetWidth); // force reflow in case we are about to start a new animation
    },
    _onStep: function () {
        var stepPos = this._getPos();
        if (!stepPos) {
            this._onTransitionEnd();
            return;
        }
        // jshint camelcase: false
        // make L.DomUtil.getPosition return intermediate position value during animation
        this._el._leaflet_pos = stepPos;
        this.fire('step');
    },
    // you can't easily get intermediate values of properties animated with CSS3 Transitions,
    // we need to parse computed style (in case of transform it returns matrix string)
    _transformRe: /([-+]?(?:\d*\.)?\d+)\D*, ([-+]?(?:\d*\.)?\d+)\D*\)/,
    _getPos: function () {
        var left, top, matches,
            el = this._el,
            style = window.getComputedStyle(el);
        if (L.Browser.any3d) {
            matches = style[L.DomUtil.TRANSFORM].match(this._transformRe);
            if (!matches) { return; }
            left = parseFloat(matches[1]);
            top  = parseFloat(matches[2]);
        } else {
            left = parseFloat(style.left);
            top  = parseFloat(style.top);
        }
        return new L.Point(left, top, true);
    },
    _onTransitionEnd: function () {
        L.DomEvent.off(this._el, L.DomUtil.TRANSITION_END, this._onTransitionEnd, this);
        if (!this._inProgress) { return; }
        this._inProgress = false;
        this._el.style[L.DomUtil.TRANSITION] = '';
        // jshint camelcase: false
        // make sure L.DomUtil.getPosition returns the final position value after animation
        this._el._leaflet_pos = this._newPos;
        clearInterval(this._stepTimer);
        this.fire('step').fire('end');
    }
});
/*
 * Extends L.Map to handle panning animations.
 */
L.Map.include({
    setView: function (center, zoom, options) {
        zoom = zoom === undefined ? this._zoom : this._limitZoom(zoom);
        center = this._limitCenter(L.latLng(center), zoom, this.options.maxBounds);
        options = options || {};
        if (this._panAnim) {
            this._panAnim.stop();
        }
        if (this._loaded && !options.reset && options !== true) {
            if (options.animate !== undefined) {
                options.zoom = L.extend({animate: options.animate}, options.zoom);
                options.pan = L.extend({animate: options.animate}, options.pan);
            }
            // try animating pan or zoom
            var animated = (this._zoom !== zoom) ?
                this._tryAnimatedZoom && this._tryAnimatedZoom(center, zoom, options.zoom) :
                this._tryAnimatedPan(center, options.pan);
            if (animated) {
                // prevent resize handler call, the view will refresh after animation anyway
                clearTimeout(this._sizeTimer);
                return this;
            }
        }
        // animation didn't start, just reset the map view
        this._resetView(center, zoom);
        return this;
    },
    panBy: function (offset, options) {
        offset = L.point(offset).round();
        options = options || {};
        if (!offset.x && !offset.y) {
            return this;
        }
        if (!this._panAnim) {
            this._panAnim = new L.PosAnimation();
            this._panAnim.on({
                'step': this._onPanTransitionStep,
                'end': this._onPanTransitionEnd
            }, this);
        }
        // don't fire movestart if animating inertia
        if (!options.noMoveStart) {
            this.fire('movestart');
        }
        // animate pan unless animate: false specified
        if (options.animate !== false) {
            L.DomUtil.addClass(this._mapPane, 'leaflet-pan-anim');
            var newPos = this._getMapPanePos().subtract(offset);
            this._panAnim.run(this._mapPane, newPos, options.duration || 0.25, options.easeLinearity);
        } else {
            this._rawPanBy(offset);
            this.fire('move').fire('moveend');
        }
        return this;
    },
    _onPanTransitionStep: function () {
        this.fire('move');
    },
    _onPanTransitionEnd: function () {
        L.DomUtil.removeClass(this._mapPane, 'leaflet-pan-anim');
        this.fire('moveend');
    },
    _tryAnimatedPan: function (center, options) {
        // difference between the new and current centers in pixels
        var offset = this._getCenterOffset(center)._floor();
        // don't animate too far unless animate: true specified in options
        if ((options && options.animate) !== true && !this.getSize().contains(offset)) { return false; }
        this.panBy(offset, options);
        return true;
    }
});
/*
 * L.PosAnimation fallback implementation that powers Leaflet pan animations
 * in browsers that don't support CSS3 Transitions.
 */
L.PosAnimation = L.DomUtil.TRANSITION ? L.PosAnimation : L.PosAnimation.extend({
    run: function (el, newPos, duration, easeLinearity) { // (HTMLElement, Point[, Number, Number])
        this.stop();
        this._el = el;
        this._inProgress = true;
        this._duration = duration || 0.25;
        this._easeOutPower = 1 / Math.max(easeLinearity || 0.5, 0.2);
        this._startPos = L.DomUtil.getPosition(el);
        this._offset = newPos.subtract(this._startPos);
        this._startTime = +new Date();
        this.fire('start');
        this._animate();
    },
    stop: function () {
        if (!this._inProgress) { return; }
        this._step();
        this._complete();
    },
    _animate: function () {
        // animation loop
        this._animId = L.Util.requestAnimFrame(this._animate, this);
        this._step();
    },
    _step: function () {
        var elapsed = (+new Date()) - this._startTime,
            duration = this._duration * 1000;
        if (elapsed
< duration) {
            this._runFrame(this._easeOut(elapsed / duration));
        } else {
            this._runFrame(1);
            this._complete();
        }
    },
    _runFrame: function (progress) {
        var pos = this._startPos.add(this._offset.multiplyBy(progress));
        L.DomUtil.setPosition(this._el, pos);
        this.fire('step');
    },
    _complete: function () {
        L.Util.cancelAnimFrame(this._animId);
        this._inProgress = false;
        this.fire('end');
    },
    _easeOut: function (t) {
        return 1 - Math.pow(1 - t, this._easeOutPower);
    }
});
/*
 * Extends L.Map to handle zoom animations.
 */
L.Map.mergeOptions({
    zoomAnimation: true,
    zoomAnimationThreshold: 4
});
if (L.DomUtil.TRANSITION) {
    L.Map.addInitHook(function () {
        // don't animate on browsers without hardware-accelerated transitions or old Android/Opera
        this._zoomAnimated = this.options.zoomAnimation && L.DomUtil.TRANSITION &&
                L.Browser.any3d && !L.Browser.android23 && !L.Browser.mobileOpera;
        // zoom transitions run with the same duration for all layers, so if one of transitionend events
        // happens after starting zoom animation (propagating to the map pane), we know that it ended globally
        if (this._zoomAnimated) {
            L.DomEvent.on(this._mapPane, L.DomUtil.TRANSITION_END, this._catchTransitionEnd, this);
        }
    });
}
L.Map.include(!L.DomUtil.TRANSITION ? {} : {
    _catchTransitionEnd: function (e) {
        if (this._animatingZoom && e.propertyName.indexOf('transform') >
= 0) {
            this._onZoomTransitionEnd();
        }
    },
    _nothingToAnimate: function () {
        return !this._container.getElementsByClassName('leaflet-zoom-animated').length;
    },
    _tryAnimatedZoom: function (center, zoom, options) {
        if (this._animatingZoom) { return true; }
        options = options || {};
        // don't animate if disabled, not supported or zoom difference is too large
        if (!this._zoomAnimated || options.animate === false || this._nothingToAnimate() ||
                Math.abs(zoom - this._zoom) >
 this.options.zoomAnimationThreshold) { return false; }
        // offset is the pixel coords of the zoom origin relative to the current center
        var scale = this.getZoomScale(zoom),
            offset = this._getCenterOffset(center)._divideBy(1 - 1 / scale),
            origin = this._getCenterLayerPoint()._add(offset);
        // don't animate if the zoom origin isn't within one screen from the current center, unless forced
        if (options.animate !== true && !this.getSize().contains(offset)) { return false; }
        this
            .fire('movestart')
            .fire('zoomstart');
        this._animateZoom(center, zoom, origin, scale, null, true);
        return true;
    },
    _animateZoom: function (center, zoom, origin, scale, delta, backwards, forTouchZoom) {
        if (!forTouchZoom) {
            this._animatingZoom = true;
        }
        // put transform transition on all layers with leaflet-zoom-animated class
        L.DomUtil.addClass(this._mapPane, 'leaflet-zoom-anim');
        // remember what center/zoom to set after animation
        this._animateToCenter = center;
        this._animateToZoom = zoom;
        // disable any dragging during animation
        if (L.Draggable) {
            L.Draggable._disabled = true;
        }
        L.Util.requestAnimFrame(function () {
            this.fire('zoomanim', {
                center: center,
                zoom: zoom,
                origin: origin,
                scale: scale,
                delta: delta,
                backwards: backwards
            });
        }, this);
    },
    _onZoomTransitionEnd: function () {
        this._animatingZoom = false;
        L.DomUtil.removeClass(this._mapPane, 'leaflet-zoom-anim');
        this._resetView(this._animateToCenter, this._animateToZoom, true, true);
        if (L.Draggable) {
            L.Draggable._disabled = false;
        }
    }
});
/*
    Zoom animation logic for L.TileLayer.
*/
L.TileLayer.include({
    _animateZoom: function (e) {
        if (!this._animating) {
            this._animating = true;
            this._prepareBgBuffer();
        }
        var bg = this._bgBuffer,
            transform = L.DomUtil.TRANSFORM,
            initialTransform = e.delta ? L.DomUtil.getTranslateString(e.delta) : bg.style[transform],
            scaleStr = L.DomUtil.getScaleString(e.scale, e.origin);
        bg.style[transform] = e.backwards ?
                scaleStr + ' ' + initialTransform :
                initialTransform + ' ' + scaleStr;
    },
    _endZoomAnim: function () {
        var front = this._tileContainer,
            bg = this._bgBuffer;
        front.style.visibility = '';
        front.parentNode.appendChild(front); // Bring to fore
        // force reflow
        L.Util.falseFn(bg.offsetWidth);
        this._animating = false;
    },
    _clearBgBuffer: function () {
        var map = this._map;
        if (map && !map._animatingZoom && !map.touchZoom._zooming) {
            this._bgBuffer.innerHTML = '';
            this._bgBuffer.style[L.DomUtil.TRANSFORM] = '';
        }
    },
    _prepareBgBuffer: function () {
        var front = this._tileContainer,
            bg = this._bgBuffer;
        // if foreground layer doesn't have many tiles but bg layer does,
        // keep the existing bg layer and just zoom it some more
        var bgLoaded = this._getLoadedTilesPercentage(bg),
            frontLoaded = this._getLoadedTilesPercentage(front);
        if (bg && bgLoaded >
 0.5 && frontLoaded
< 0.5) {
            front.style.visibility = 'hidden';
            this._stopLoadingImages(front);
            return;
        }
        // prepare the buffer to become the front tile pane
        bg.style.visibility = 'hidden';
        bg.style[L.DomUtil.TRANSFORM] = '';
        // switch out the current layer to be the new bg layer (and vice-versa)
        this._tileContainer = bg;
        bg = this._bgBuffer = front;
        this._stopLoadingImages(bg);
        //prevent bg buffer from clearing right after zoom
        clearTimeout(this._clearBgBufferTimer);
    },
    _getLoadedTilesPercentage: function (container) {
        var tiles = container.getElementsByTagName('img'),
            i, len, count = 0;
        for (i = 0, len = tiles.length; i
< len; i++) {
            if (tiles[i].complete) {
                count++;
            }
        }
        return count / len;
    },
    // stops loading all tiles in the background layer
    _stopLoadingImages: function (container) {
        var tiles = Array.prototype.slice.call(container.getElementsByTagName('img')),
            i, len, tile;
        for (i = 0, len = tiles.length; i
< len; i++) {
            tile = tiles[i];
            if (!tile.complete) {
                tile.onload = L.Util.falseFn;
                tile.onerror = L.Util.falseFn;
                tile.src = L.Util.emptyImageUrl;
                tile.parentNode.removeChild(tile);
            }
        }
    }
});
/*
 * Provides L.Map with convenient shortcuts for using browser geolocation features.
 */
L.Map.include({
    _defaultLocateOptions: {
        watch: false,
        setView: false,
        maxZoom: Infinity,
        timeout: 10000,
        maximumAge: 0,
        enableHighAccuracy: false
    },
    locate: function (/*Object*/ options) {
        options = this._locateOptions = L.extend(this._defaultLocateOptions, options);
        if (!navigator.geolocation) {
            this._handleGeolocationError({
                code: 0,
                message: 'Geolocation not supported.'
            });
            return this;
        }
        var onResponse = L.bind(this._handleGeolocationResponse, this),
            onError = L.bind(this._handleGeolocationError, this);
        if (options.watch) {
            this._locationWatchId =
                    navigator.geolocation.watchPosition(onResponse, onError, options);
        } else {
            navigator.geolocation.getCurrentPosition(onResponse, onError, options);
        }
        return this;
    },
    stopLocate: function () {
        if (navigator.geolocation) {
            navigator.geolocation.clearWatch(this._locationWatchId);
        }
        if (this._locateOptions) {
            this._locateOptions.setView = false;
        }
        return this;
    },
    _handleGeolocationError: function (error) {
        var c = error.code,
            message = error.message ||
                    (c === 1 ? 'permission denied' :
                    (c === 2 ? 'position unavailable' : 'timeout'));
        if (this._locateOptions.setView && !this._loaded) {
            this.fitWorld();
        }
        this.fire('locationerror', {
            code: c,
            message: 'Geolocation error: ' + message + '.'
        });
    },
    _handleGeolocationResponse: function (pos) {
        var lat = pos.coords.latitude,
            lng = pos.coords.longitude,
            latlng = new L.LatLng(lat, lng),
            latAccuracy = 180 * pos.coords.accuracy / 40075017,
            lngAccuracy = latAccuracy / Math.cos(L.LatLng.DEG_TO_RAD * lat),
            bounds = L.latLngBounds(
                    [lat - latAccuracy, lng - lngAccuracy],
                    [lat + latAccuracy, lng + lngAccuracy]),
            options = this._locateOptions;
        if (options.setView) {
            var zoom = Math.min(this.getBoundsZoom(bounds), options.maxZoom);
            this.setView(latlng, zoom);
        }
        var data = {
            latlng: latlng,
            bounds: bounds,
            timestamp: pos.timestamp
        };
        for (var i in pos.coords) {
            if (typeof pos.coords[i] === 'number') {
                data[i] = pos.coords[i];
            }
        }
        this.fire('locationfound', data);
    }
});
}(window, document));
/*
Geodesic extension to Leaflet library, by Fragger
https://github.com/Fragger/Leaflet.Geodesic
Version from master branch, dated Apr 26, 2013
Modified by qnstie 2013-07-17 to maintain compatibility with Leaflet.draw
*/
(function () {
  function geodesicPoly(Klass, fill) {
    return Klass.extend({
      initialize: function (latlngs, options) {
        Klass.prototype.initialize.call(this, L.geodesicConvertLines(latlngs, fill), options);
        this._latlngsinit = this._convertLatLngs(latlngs);
      },
      getLatLngs: function () {
        return this._latlngsinit;
      },
      setLatLngs: function (latlngs) {
        this._latlngsinit = this._convertLatLngs(latlngs);
        return this.redraw();
      },
      addLatLng: function (latlng) {
        this._latlngsinit.push(L.latLng(latlng));
        return this.redraw();
      },
      spliceLatLngs: function () { // (Number index, Number howMany)
        var removed = [].splice.apply(this._latlngsinit, arguments);
        this._convertLatLngs(this._latlngsinit);
        this.redraw();
        return removed;
      },
      redraw: function() {
        this._latlngs = this._convertLatLngs(L.geodesicConvertLines(this._latlngsinit, fill));
        return Klass.prototype.redraw.call(this);
      }
    });
  }
  // alternative geodesic line intermediate points function
  // as north/south lines have very little curvature in the projection, we cam use longitude (east/west) seperation
  // to calculate intermediate points. hopeefully this will avoid the rounding issues seen in the full intermediate
  // points code that have been seen
  function geodesicConvertLine(startLatLng, endLatLng, convertedPoints) {
    var R = 6367000.0; // earth radius in meters (doesn't have to be exact)
    var d2r = Math.PI/180.0;
    var r2d = 180.0/Math.PI;
    // maths based on http://williams.best.vwh.net/avform.htm#Int
    var lat1 = startLatLng.lat * d2r;
    var lat2 = endLatLng.lat * d2r;
    var lng1 = startLatLng.lng * d2r;
    var lng2 = endLatLng.lng * d2r;
    var dLng = lng2-lng1;
    var segments = Math.floor(Math.abs(dLng * R / 5000));
    if (segments >
 1) {
      // pre-calculate some constant values for the loop
      var sinLat1 = Math.sin(lat1);
      var sinLat2 = Math.sin(lat2);
      var cosLat1 = Math.cos(lat1);
      var cosLat2 = Math.cos(lat2);
      var sinLat1CosLat2 = sinLat1*cosLat2;
      var sinLat2CosLat1 = sinLat2*cosLat1;
      var cosLat1CosLat2SinDLng = cosLat1*cosLat2*Math.sin(dLng);
      for (var i=1; i
< segments; i++) {
        var iLng = lng1+dLng*(i/segments);
        var iLat = Math.atan( (sinLat1CosLat2*Math.sin(lng2-iLng) + sinLat2CosLat1*Math.sin(iLng-lng1))
                              / cosLat1CosLat2SinDLng)
        var point = L.latLng ( [iLat*r2d, iLng*r2d] );
        convertedPoints.push(point);
      }
    }
    convertedPoints.push(L.latLng(endLatLng));
  }
  L.geodesicConvertLines = function (latlngs, fill) {
    if (latlngs.length == 0) {
      return [];
    }
    for (var i = 0, len = latlngs.length; i
< len; i++) {
      if (L.Util.isArray(latlngs[i]) && typeof latlngs[i][0] !== 'number') {
        return;
      }
      latlngs[i] = L.latLng(latlngs[i]);
    }
    // geodesic calculations have issues when crossing the anti-meridian. so offset the points
    // so this isn't an issue, then add back the offset afterwards
    // a center longitude would be ideal - but the start point longitude will be 'good enough'
    var lngOffset = latlngs[0].lng;
    // points are wrapped after being offset relative to the first point coordinate, so they're
    // within +-180 degrees
    latlngs = latlngs.map(function(a){ return L.latLng(a.lat, a.lng-lngOffset).wrap(); });
    var geodesiclatlngs = [];
    if(!fill) {
      geodesiclatlngs.push(latlngs[0]);
    }
    for (i = 0, len = latlngs.length - 1; i
< len; i++) {
      geodesicConvertLine(latlngs[i], latlngs[i+1], geodesiclatlngs);
    }
    if(fill) {
      geodesicConvertLine(latlngs[len], latlngs[0], geodesiclatlngs);
    }
    // now add back the offset subtracted above. no wrapping here - the drawing code handles
    // things better when there's no sudden jumps in coordinates. yes, lines will extend
    // beyond +-180 degrees - but they won't be 'broken'
    geodesiclatlngs = geodesiclatlngs.map(function(a){ return L.latLng(a.lat, a.lng+lngOffset); });
    return geodesiclatlngs;
  }
  L.GeodesicPolyline = geodesicPoly(L.Polyline, 0);
  L.GeodesicPolygon = geodesicPoly(L.Polygon, 1);
  //L.GeodesicMultiPolyline = createMulti(L.GeodesicPolyline);
  //L.GeodesicMultiPolygon = createMulti(L.GeodesicPolygon);
  /*L.GeodesicMultiPolyline = L.MultiPolyline.extend({
    initialize: function (latlngs, options) {
      L.MultiPolyline.prototype.initialize.call(this, L.geodesicConvertLines(latlngs), options);
    }
  });*/
  /*L.GeodesicMultiPolygon = L.MultiPolygon.extend({
    initialize: function (latlngs, options) {
      L.MultiPolygon.prototype.initialize.call(this, L.geodesicConvertLines(latlngs), options);
    }
  });*/
  L.GeodesicCircle = L.Polygon.extend({
    initialize: function (latlng, radius, options) {
      this._latlng = L.latLng(latlng);
      this._mRadius = radius;
      points = this._calcPoints();
      L.Polygon.prototype.initialize.call(this, points, options);
    },
    options: {
      fill: true
    },
    setLatLng: function (latlng) {
      this._latlng = L.latLng(latlng);
      points = this._calcPoints();
      this.setLatLngs(points);
    },
    setRadius: function (radius) {
      this._mRadius = radius;
      points = this._calcPoints();
      this.setLatLngs(points);
    },
    getLatLng: function () {
      return this._latlng;
    },
    getRadius: function() {
      return this._mRadius;
    },
    _calcPoints: function() {
      var R = 6367000.0; //earth radius in meters (approx - taken from leaflet source code)
      var d2r = Math.PI/180.0;
      var r2d = 180.0/Math.PI;
//console.log("geodesicCircle: radius = "+this._mRadius+"m, centre "+this._latlng.lat+","+this._latlng.lng);
      // circle radius as an angle from the centre of the earth
      var radRadius = this._mRadius / R;
//console.log(" (radius in radians "+radRadius);
      // pre-calculate various values used for every point on the circle
      var centreLat = this._latlng.lat * d2r;
      var centreLng = this._latlng.lng * d2r;
      var cosCentreLat = Math.cos(centreLat);
      var sinCentreLat = Math.sin(centreLat);
      var cosRadRadius = Math.cos(radRadius);
      var sinRadRadius = Math.sin(radRadius);
      var calcLatLngAtAngle = function(angle) {
        var lat = Math.asin(sinCentreLat*cosRadRadius + cosCentreLat*sinRadRadius*Math.cos(angle));
        var lng = centreLng + Math.atan2(Math.sin(angle)*sinRadRadius*cosCentreLat, cosRadRadius-sinCentreLat*Math.sin(lat));
        return L.latLng(lat * r2d,lng * r2d);
      }
      var segments = Math.max(48,Math.floor(this._mRadius/1000));
//console.log(" (drawing circle as "+segments+" lines)");
      var points = [];
      for (var i=0; i
<segments; i++) {
        var angle = Math.PI*2/segments*i;
        var point = calcLatLngAtAngle(angle)
        points.push ( point );
      }
      return points;
    },
  });
  L.geodesicPolyline = function (latlngs, options) {
    return new L.GeodesicPolyline(latlngs, options);
  };
  L.geodesicPolygon = function (latlngs, options) {
    return new L.GeodesicPolygon(latlngs, options);
  };
  /*
  L.geodesicMultiPolyline = function (latlngs, options) {
    return new L.GeodesicMultiPolyline(latlngs, options);
  };
  L.geodesicMultiPolygon = function (latlngs, options) {
    return new L.GeodesicMultiPolygon(latlngs, options);
  };
  */
  L.geodesicCircle = function (latlng, radius, options) {
    return new L.GeodesicCircle(latlng, radius, options);
  }
}());
// modified version of https://github.com/shramov/leaflet-plugins. Also
// contains the default Ingress map style.
/*
 * Google layer using Google Maps API
 */
//(function (google, L) {
L.Google = L.Class.extend({
    includes: L.Mixin.Events,
    options: {
        minZoom: 0,
        maxZoom: 18,
        tileSize: 256,
        subdomains: 'abc',
        errorTileUrl: '',
        attribution: '',
        opacity: 1,
        continuousWorld: false,
        noWrap: false,
        mapOptions: {
            backgroundColor: '#dddddd'
        }
    },
    // Possible types: SATELLITE, ROADMAP, HYBRID, TERRAIN
    initialize: function(type, options) {
        L.Util.setOptions(this, options);
        this._ready = google.maps.Map != undefined;
        if (!this._ready) L.Google.asyncWait.push(this);
        this._type = type || 'SATELLITE';
    },
    onAdd: function(map, insertAtTheBottom) {
        this._map = map;
        this._insertAtTheBottom = insertAtTheBottom;
        // create a container div for tiles
        this._initContainer();
        this._initMapObject();
        // set up events
        map.on('viewreset', this._resetCallback, this);
        this._limitedUpdate = L.Util.limitExecByInterval(this._update, 150, this);
        map.on('move', this._update, this);
        map.on('zoomanim', this._handleZoomAnim, this);
        //20px instead of 1em to avoid a slight overlap with google's attribution
        map._controlCorners['bottomright'].style.marginBottom = "20px";
        this._reset();
        this._update();
    },
    onRemove: function(map) {
        this._map._container.removeChild(this._container);
        //this._container = null;
        this._map.off('viewreset', this._resetCallback, this);
        this._map.off('move', this._update, this);
        this._map.off('zoomanim', this._handleZoomAnim, this);
        map._controlCorners['bottomright'].style.marginBottom = "0em";
        //this._map.off('moveend', this._update, this);
    },
    getAttribution: function() {
        return this.options.attribution;
    },
    setOpacity: function(opacity) {
        this.options.opacity = opacity;
        if (opacity
< 1) {
            L.DomUtil.setOpacity(this._container, opacity);
        }
    },
    setElementSize: function(e, size) {
        e.style.width = size.x + "px";
        e.style.height = size.y + "px";
    },
    _initContainer: function() {
        var tilePane = this._map._container,
            first = tilePane.firstChild;
        if (!this._container) {
            this._container = L.DomUtil.create('div', 'leaflet-google-layer leaflet-top leaflet-left');
            this._container.id = "_GMapContainer_" + L.Util.stamp(this);
            this._container.style.zIndex = "auto";
        }
        if (true) {
            tilePane.insertBefore(this._container, first);
            this.setOpacity(this.options.opacity);
            this.setElementSize(this._container, this._map.getSize());
        }
    },
    _initMapObject: function() {
        if (!this._ready) return;
        this._google_center = new google.maps.LatLng(0, 0);
        var map = new google.maps.Map(this._container, {
            center: this._google_center,
            zoom: 0,
            tilt: 0,
            mapTypeId: google.maps.MapTypeId[this._type],
            disableDefaultUI: true,
            keyboardShortcuts: false,
            draggable: false,
            disableDoubleClickZoom: true,
            scrollwheel: false,
            streetViewControl: false,
            styles: this.options.mapOptions.styles,
            backgroundColor: this.options.mapOptions.backgroundColor
        });
        var _this = this;
        this._reposition = google.maps.event.addListenerOnce(map, "center_changed",
            function() { _this.onReposition(); });
        this._google = map;
        google.maps.event.addListenerOnce(map, "idle",
            function() { _this._checkZoomLevels(); });
    },
    _checkZoomLevels: function() {
        //setting the zoom level on the Google map may result in a different zoom level than the one requested
        //(it won't go beyond the level for which they have data).
        // verify and make sure the zoom levels on both Leaflet and Google maps are consistent
        if (this._google.getZoom() !== this._map.getZoom()) {
            //zoom levels are out of sync. Set the leaflet zoom level to match the google one
            this._map.setZoom( this._google.getZoom() );
        }
    },
    _resetCallback: function(e) {
        this._reset(e.hard);
    },
    _reset: function(clearOldContainer) {
        this._initContainer();
    },
    _update: function(e) {
        if (!this._google) return;
        this._resize();
        var center = e && e.latlng ? e.latlng : this._map.getCenter();
        var _center = new google.maps.LatLng(center.lat, center.lng);
        this._google.setCenter(_center);
        this._google.setZoom(this._map.getZoom());
        this._checkZoomLevels();
        //this._google.fitBounds(google_bounds);
    },
    _resize: function() {
        var size = this._map.getSize();
        if (this._container.style.width == size.x &&
            this._container.style.height == size.y)
            return;
        this.setElementSize(this._container, size);
        this.onReposition();
    },
    _handleZoomAnim: function (e) {
        var center = e.center;
        var _center = new google.maps.LatLng(center.lat, center.lng);
        this._google.setCenter(_center);
        this._google.setZoom(e.zoom);
    },
    onReposition: function() {
        if (!this._google) return;
        google.maps.event.trigger(this._google, "resize");
    }
});
L.Google.asyncWait = [];
L.Google.asyncInitialize = function() {
    var i;
    for (i = 0; i
< L.Google.asyncWait.length; i++) {
        var o = L.Google.asyncWait[i];
        o._ready = true;
        if (o._container) {
            o._initMapObject();
            o._update();
        }
    }
    L.Google.asyncWait = [];
};
//})(window.google, L)
(function(){var f=[].slice;String.prototype.autoLink=function(){var c,e,d,a,b;a=1
<=arguments.length?f.call(arguments,0):[];e="";d=a[0];b=/(^|\s)((?:https?|ftp):\/\/[\-A-Z0-9+\u0026@#\/%?=~_|!:,.;]*[\-A-Z0-9+\u0026@#\/%=~_|])/gi;if(!(0
<a.length))return this.replace(b,"$1
<a href='$2'>
$2
</a>
");for(c in d)a=d[c],"callback"!==c&&(e+=" "+c+"='"+a+"'");return this.replace(b,function(a,c,b){a=("function"===typeof d.callback?d.callback(b):void 0)||"
<a href='"+b+"'"+e+">
"+b+"
</a>
";return""+c+a})}}).call(this);
(function(){/*
 OverlappingMarkerSpiderfier
https://github.com/jawj/OverlappingMarkerSpiderfier-Leaflet
Copyright (c) 2011 - 2012 George MacKerron
Released under the MIT licence: http://opensource.org/licenses/mit-license
Note: The Leaflet maps API must be included *before* this code
*/
(function(){var q={}.hasOwnProperty,r=[].slice;null!=this.L&&(this.OverlappingMarkerSpiderfier=function(){function n(c,b){var a,e,g,f,d=this;this.map=c;null==b&&(b={});for(a in b)q.call(b,a)&&(e=b[a],this[a]=e);this.initMarkerArrays();this.listeners={};f=["click","zoomend"];e=0;for(g=f.length;e
<g;e++)a=f[e],this.map.addEventListener(a,function(){return d.unspiderfy()})}var d,k;d=n.prototype;d.VERSION="0.2.6";k=2*Math.PI;d.keepSpiderfied=!1;d.nearbyDistance=20;d.circleSpiralSwitchover=9;d.circleFootSeparation=
25;d.circleStartAngle=k/12;d.spiralFootSeparation=28;d.spiralLengthStart=11;d.spiralLengthFactor=5;d.legWeight=1.5;d.legColors={usual:"#222",highlighted:"#f00"};d.initMarkerArrays=function(){this.markers=[];return this.markerListeners=[]};d.addMarker=function(c){var b,a=this;if(null!=c._oms)return this;c._oms=!0;b=function(){return a.spiderListener(c)};c.addEventListener("click",b);this.markerListeners.push(b);this.markers.push(c);return this};d.getMarkers=function(){return this.markers.slice(0)};
d.removeMarker=function(c){var b,a;null!=c._omsData&&this.unspiderfy();b=this.arrIndexOf(this.markers,c);if(0>
b)return this;a=this.markerListeners.splice(b,1)[0];c.removeEventListener("click",a);delete c._oms;this.markers.splice(b,1);return this};d.clearMarkers=function(){var c,b,a,e,g;this.unspiderfy();g=this.markers;c=a=0;for(e=g.length;a
<e;c=++a)b=g[c],c=this.markerListeners[c],b.removeEventListener("click",c),delete b._oms;this.initMarkerArrays();return this};d.addListener=function(c,b){var a,
e;(null!=(e=(a=this.listeners)[c])?e:a[c]=[]).push(b);return this};d.removeListener=function(c,b){var a;a=this.arrIndexOf(this.listeners[c],b);0>
a||this.listeners[c].splice(a,1);return this};d.clearListeners=function(c){this.listeners[c]=[];return this};d.trigger=function(){var c,b,a,e,g,f;b=arguments[0];c=2
<=arguments.length?r.call(arguments,1):[];b=null!=(a=this.listeners[b])?a:[];f=[];e=0;for(g=b.length;e
<g;e++)a=b[e],f.push(a.apply(null,c));return f};d.generatePtsCircle=function(c,b){var a,e,
g,f,d;g=this.circleFootSeparation*(2+c)/k;e=k/c;d=[];for(a=f=0;0
<=c?f
<c:f>
c;a=0
<=c?++f:--f)a=this.circleStartAngle+a*e,d.push(new L.Point(b.x+g*Math.cos(a),b.y+g*Math.sin(a)));return d};d.generatePtsSpiral=function(c,b){var a,e,g,f,d;g=this.spiralLengthStart;a=0;d=[];for(e=f=0;0
<=c?f
<c:f>
c;e=0
<=c?++f:--f)a+=this.spiralFootSeparation/g+5E-4*e,e=new L.Point(b.x+g*Math.cos(a),b.y+g*Math.sin(a)),g+=k*this.spiralLengthFactor/a,d.push(e);return d};d.spiderListener=function(c){var b,a,e,g,f,d,h,k,l;(b=null!=
c._omsData)&&this.keepSpiderfied||this.unspiderfy();if(b)return this.trigger("click",c);g=[];f=[];d=this.nearbyDistance*this.nearbyDistance;e=this.map.latLngToLayerPoint(c.getLatLng());l=this.markers;h=0;for(k=l.length;h
<k;h++)b=l[h],this.map.hasLayer(b)&&(a=this.map.latLngToLayerPoint(b.getLatLng()),this.ptDistanceSq(a,e)
<d?g.push({marker:b,markerPt:a}):f.push(b));return 1===g.length?this.trigger("click",c):this.spiderfy(g,f)};d.makeHighlightListeners=function(c){var b=this;return{highlight:function(){return c._omsData.leg.setStyle({color:b.legColors.highlighted})},
unhighlight:function(){return c._omsData.leg.setStyle({color:b.legColors.usual})}}};d.spiderfy=function(c,b){var a,e,g,d,p,h,k,l,n,m;this.spiderfying=!0;m=c.length;a=this.ptAverage(function(){var a,b,e;e=[];a=0;for(b=c.length;a
<b;a++)k=c[a],e.push(k.markerPt);return e}());d=m>
=this.circleSpiralSwitchover?this.generatePtsSpiral(m,a).reverse():this.generatePtsCircle(m,a);a=function(){var a,b,k,m=this;k=[];a=0;for(b=d.length;a
<b;a++)g=d[a],e=this.map.layerPointToLatLng(g),n=this.minExtract(c,function(a){return m.ptDistanceSq(a.markerPt,
g)}),h=n.marker,p=new L.Polyline([h.getLatLng(),e],{color:this.legColors.usual,weight:this.legWeight,clickable:!1}),this.map.addLayer(p),h._omsData={usualPosition:h.getLatLng(),leg:p},this.legColors.highlighted!==this.legColors.usual&&(l=this.makeHighlightListeners(h),h._omsData.highlightListeners=l,h.addEventListener("mouseover",l.highlight),h.addEventListener("mouseout",l.unhighlight)),h.setLatLng(e),h.setZIndexOffset(1E6),k.push(h);return k}.call(this);delete this.spiderfying;this.spiderfied=!0;
return this.trigger("spiderfy",a,b)};d.unspiderfy=function(c){var b,a,e,d,f,k,h;null==c&&(c=null);if(null==this.spiderfied)return this;this.unspiderfying=!0;d=[];e=[];h=this.markers;f=0;for(k=h.length;f
<k;f++)b=h[f],null!=b._omsData?(this.map.removeLayer(b._omsData.leg),b!==c&&b.setLatLng(b._omsData.usualPosition),b.setZIndexOffset(0),a=b._omsData.highlightListeners,null!=a&&(b.removeEventListener("mouseover",a.highlight),b.removeEventListener("mouseout",a.unhighlight)),delete b._omsData,d.push(b)):
e.push(b);delete this.unspiderfying;delete this.spiderfied;this.trigger("unspiderfy",d,e);return this};d.ptDistanceSq=function(c,b){var a,e;a=c.x-b.x;e=c.y-b.y;return a*a+e*e};d.ptAverage=function(c){var b,a,e,d,f;d=a=e=0;for(f=c.length;d
<f;d++)b=c[d],a+=b.x,e+=b.y;c=c.length;return new L.Point(a/c,e/c)};d.minExtract=function(c,b){var a,d,g,f,k,h;g=k=0;for(h=c.length;k
<h;g=++k)if(f=c[g],f=b(f),"undefined"===typeof a||null===a||f
<d)d=f,a=g;return c.splice(a,1)[0]};d.arrIndexOf=function(c,b){var a,
d,g,f;if(null!=c.indexOf)return c.indexOf(b);a=g=0;for(f=c.length;g
<f;a=++g)if(d=c[a],d===b)return a;return-1};return n}())}).call(this);}).call(this);
/* Mon 14 Oct 2013 10:54:59 BST */
try { console.log('done loading included JS'); } catch(e) {}
//note: no protocol - so uses http or https as used on the current page
var JQUERY = '//ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js';
var JQUERYUI = '//ajax.googleapis.com/ajax/libs/jqueryui/1.11.3/jquery-ui.min.js';
// after all scripts have loaded, boot the actual app
load(JQUERY).then(JQUERYUI).thenRun(boot);
;
window.chat = function() {};
//WORK IN PROGRESS - NOT YET USED!!
window.chat.commTabs = [
// channel: the COMM channel ('tab' parameter in server requests)
// name: visible name
// inputPrompt: string for the input prompt
// inputColor: (optional) color for input
// sendMessage: (optional) function to send the message (to override the default of sendPlext)
// globalBounds: (optional) if true, always use global latLng bounds
  {channel:'all', name:'All', inputPrompt: 'broadcast:', inputColor:'#f66'},
  {channel:'faction', name:'Aaction', inputPrompt: 'tell faction:'},
  {channel:'alerts', name:'Alerts', inputPrompt: 'tell Jarvis:', inputColor: '#666', globalBounds: true, sendMessage: function() {
    alert("Jarvis: A strange game. The only winning move is not to play. How about a nice game of chess?\n(You can't chat to the 'alerts' channel!)");
  }},
];
window.chat.handleTabCompletion = function() {
  var el = $('#chatinput input');
  var curPos = el.get(0).selectionStart;
  var text = el.val();
  var word = text.slice(0, curPos).replace(/.*\b([a-z0-9-_])/, '$1').toLowerCase();
  var list = $('#chat >
 div:visible mark');
  list = list.map(function(ind, mark) { return $(mark).text(); } );
  list = uniqueArray(list);
  var nick = null;
  for(var i = 0; i
< list.length; i++) {
    if(!list[i].toLowerCase().startsWith(word)) continue;
    if(nick && nick !== list[i]) {
      console.log('More than one nick matches, aborting. ('+list[i]+' vs '+nick+')');
      return;
    }
    nick = list[i];
  }
  if(!nick) {
    console.log('No matches for ' + word);
    return;
  }
  var posStart = curPos - word.length;
  var newText = text.substring(0, posStart);
  var atPresent = text.substring(posStart-1, posStart) === '@';
  newText += (atPresent ? '' : '@') + nick + ' ';
  newText += text.substring(curPos);
  el.val(newText);
}
//
// clear management
//
window.chat._oldBBox = null;
window.chat.genPostData = function(channel, storageHash, getOlderMsgs) {
  if (typeof channel !== 'string') throw ('API changed: isFaction flag now a channel string - all, faction, alerts');
  var b = clampLatLngBounds(map.getBounds());
  // set a current bounding box if none set so far
  if (!chat._oldBBox) chat._oldBBox = b;
  // to avoid unnecessary chat refreshes, a small difference compared to the previous bounding box
  // is not considered different
  var CHAT_BOUNDINGBOX_SAME_FACTOR = 0.1;
  // if the old and new box contain each other, after expanding by the factor, don't reset chat
  if (!(b.pad(CHAT_BOUNDINGBOX_SAME_FACTOR).contains(chat._oldBBox) && chat._oldBBox.pad(CHAT_BOUNDINGBOX_SAME_FACTOR).contains(b))) {
    console.log('Bounding Box changed, chat will be cleared (old: '+chat._oldBBox.toBBoxString()+'; new: '+b.toBBoxString()+')');
    $('#chat >
 div').data('needsClearing', true);
    // need to reset these flags now because clearing will only occur
    // after the request is finished – i.e. there would be one almost
    // useless request.
    chat._faction.data = {};
    chat._faction.oldestTimestamp = -1;
    chat._faction.newestTimestamp = -1;
    chat._public.data = {};
    chat._public.oldestTimestamp = -1;
    chat._public.newestTimestamp = -1;
    chat._alerts.data = {};
    chat._alerts.oldestTimestamp = -1;
    chat._alerts.newestTimestamp = -1;
    chat._oldBBox = b;
  }
  var ne = b.getNorthEast();
  var sw = b.getSouthWest();
  var data = {
//    desiredNumItems: isFaction ? CHAT_FACTION_ITEMS : CHAT_PUBLIC_ITEMS ,
    minLatE6: Math.round(sw.lat*1E6),
    minLngE6: Math.round(sw.lng*1E6),
    maxLatE6: Math.round(ne.lat*1E6),
    maxLngE6: Math.round(ne.lng*1E6),
    minTimestampMs: -1,
    maxTimestampMs: -1,
    tab: channel,
  }
  if(getOlderMsgs) {
    // ask for older chat when scrolling up
    data = $.extend(data, {maxTimestampMs: storageHash.oldestTimestamp});
  } else {
    // ask for newer chat
    var min = storageHash.newestTimestamp;
    // the initial request will have both timestamp values set to -1,
    // thus we receive the newest desiredNumItems. After that, we will
    // only receive messages with a timestamp greater or equal to min
    // above.
    // After resuming from idle, there might be more new messages than
    // desiredNumItems. So on the first request, we are not really up to
    // date. We will eventually catch up, as long as there are less new
    // messages than desiredNumItems per each refresh cycle.
    // A proper solution would be to query until no more new results are
    // returned. Another way would be to set desiredNumItems to a very
    // large number so we really get all new messages since the last
    // request. Setting desiredNumItems to -1 does unfortunately not
    // work.
    // Currently this edge case is not handled. Let’s see if this is a
    // problem in crowded areas.
    $.extend(data, {minTimestampMs: min});
    // when requesting with an actual minimum timestamp, request oldest rather than newest first.
    // this matches the stock intel site, and ensures no gaps when continuing after an extended idle period
    if (min >
 -1) $.extend(data, {ascendingTimestampOrder: true});
  }
  return data;
}
//
// faction
//
window.chat._requestFactionRunning = false;
window.chat.requestFaction = function(getOlderMsgs, isRetry) {
  if(chat._requestFactionRunning && !isRetry) return;
  if(isIdle()) return renderUpdateStatus();
  chat._requestFactionRunning = true;
  $("#chatcontrols a:contains('faction')").addClass('loading');
  var d = chat.genPostData('faction', chat._faction, getOlderMsgs);
  var r = window.postAjax(
    'getPlexts',
    d,
    function(data, textStatus, jqXHR) { chat.handleFaction(data, getOlderMsgs); },
    isRetry
      ? function() { window.chat._requestFactionRunning = false; }
      : function() { window.chat.requestFaction(getOlderMsgs, true) }
  );
}
window.chat._faction = {data:{}, oldestTimestamp:-1, newestTimestamp:-1};
window.chat.handleFaction = function(data, olderMsgs) {
  chat._requestFactionRunning = false;
  $("#chatcontrols a:contains('faction')").removeClass('loading');
  if(!data || !data.result) {
    window.failedRequestCount++;
    return console.warn('faction chat error. Waiting for next auto-refresh.');
  }
  if(data.result.length === 0) return;
  var old = chat._faction.oldestTimestamp;
  chat.writeDataToHash(data, chat._faction, false, olderMsgs);
  var oldMsgsWereAdded = old !== chat._faction.oldestTimestamp;
  runHooks('factionChatDataAvailable', {raw: data, result: data.result, processed: chat._faction.data});
  window.chat.renderFaction(oldMsgsWereAdded);
}
window.chat.renderFaction = function(oldMsgsWereAdded) {
  chat.renderData(chat._faction.data, 'chatfaction', oldMsgsWereAdded);
}
//
// all
//
window.chat._requestPublicRunning = false;
window.chat.requestPublic = function(getOlderMsgs, isRetry) {
  if(chat._requestPublicRunning && !isRetry) return;
  if(isIdle()) return renderUpdateStatus();
  chat._requestPublicRunning = true;
  $("#chatcontrols a:contains('all')").addClass('loading');
  var d = chat.genPostData('all', chat._public, getOlderMsgs);
  var r = window.postAjax(
    'getPlexts',
    d,
    function(data, textStatus, jqXHR) { chat.handlePublic(data, getOlderMsgs); },
    isRetry
      ? function() { window.chat._requestPublicRunning = false; }
      : function() { window.chat.requestPublic(getOlderMsgs, true) }
  );
}
window.chat._public = {data:{}, oldestTimestamp:-1, newestTimestamp:-1};
window.chat.handlePublic = function(data, olderMsgs) {
  chat._requestPublicRunning = false;
  $("#chatcontrols a:contains('all')").removeClass('loading');
  if(!data || !data.result) {
    window.failedRequestCount++;
    return console.warn('public chat error. Waiting for next auto-refresh.');
  }
  if(data.result.length === 0) return;
  var old = chat._public.oldestTimestamp;
  chat.writeDataToHash(data, chat._public, undefined, olderMsgs);   //NOTE: isPublic passed as undefined - this is the 'all' channel, so not really public or private
  var oldMsgsWereAdded = old !== chat._public.oldestTimestamp;
  runHooks('publicChatDataAvailable', {raw: data, result: data.result, processed: chat._public.data});
  window.chat.renderPublic(oldMsgsWereAdded);
}
window.chat.renderPublic = function(oldMsgsWereAdded) {
  chat.renderData(chat._public.data, 'chatall', oldMsgsWereAdded);
}
//
// alerts
//
window.chat._requestAlertsRunning = false;
window.chat.requestAlerts = function(getOlderMsgs, isRetry) {
  if(chat._requestAlertsRunning && !isRetry) return;
  if(isIdle()) return renderUpdateStatus();
  chat._requestAlertsRunning = true;
  $("#chatcontrols a:contains('alerts')").addClass('loading');
  var d = chat.genPostData('alerts', chat._alerts, getOlderMsgs);
  var r = window.postAjax(
    'getPlexts',
    d,
    function(data, textStatus, jqXHR) { chat.handleAlerts(data, getOlderMsgs); },
    isRetry
      ? function() { window.chat._requestAlertsRunning = false; }
      : function() { window.chat.requestAlerts(getOlderMsgs, true) }
  );
}
window.chat._alerts = {data:{}, oldestTimestamp:-1, newestTimestamp:-1};
window.chat.handleAlerts = function(data, olderMsgs) {
  chat._requestAlertsRunning = false;
  $("#chatcontrols a:contains('alerts')").removeClass('loading');
  if(!data || !data.result) {
    window.failedRequestCount++;
    return console.warn('alerts chat error. Waiting for next auto-refresh.');
  }
  if(data.result.length === 0) return;
  var old = chat._alerts.oldestTimestamp;
  chat.writeDataToHash(data, chat._alerts, undefined, olderMsgs); //NOTE: isPublic passed as undefined - it's nether public or private!
  var oldMsgsWereAdded = old !== chat._alerts.oldestTimestamp;
// no hoot for alerts - API change planned here...
//  runHooks('alertsChatDataAvailable', {raw: data, result: data.result, processed: chat._alerts.data});
  window.chat.renderAlerts(oldMsgsWereAdded);
}
window.chat.renderAlerts = function(oldMsgsWereAdded) {
  chat.renderData(chat._alerts.data, 'chatalerts', oldMsgsWereAdded);
}
//
// common
//
window.chat.nicknameClicked = function(event, nickname) {
  var hookData = { event: event, nickname: nickname };
  if (window.runHooks('nicknameClicked', hookData)) {
    window.chat.addNickname('@' + nickname);
  }
  event.preventDefault();
  event.stopPropagation();
  return false;
}
window.chat.writeDataToHash = function(newData, storageHash, isPublicChannel, isOlderMsgs) {
  $.each(newData.result, function(ind, json) {
    // avoid duplicates
    if(json[0] in storageHash.data) return true;
    var isSecureMessage = false;
    var msgToPlayer = false;
    var time = json[1];
    var team = json[2].plext.team === 'RESISTANCE' ? TEAM_RES : TEAM_ENL;
    var auto = json[2].plext.plextType !== 'PLAYER_GENERATED';
    var systemNarrowcast = json[2].plext.plextType === 'SYSTEM_NARROWCAST';
    //track oldest + newest timestamps
    if (storageHash.oldestTimestamp === -1 || storageHash.oldestTimestamp >
 time) storageHash.oldestTimestamp = time;
    if (storageHash.newestTimestamp === -1 || storageHash.newestTimestamp
< time) storageHash.newestTimestamp = time;
    //remove "Your X on Y was destroyed by Z" from the faction channel
//    if (systemNarrowcast && !isPublicChannel) return true;
    var msg = '', nick = '';
    $.each(json[2].plext.markup, function(ind, markup) {
      switch(markup[0]) {
      case 'SENDER': // user generated messages
        nick = markup[1].plain.slice(0, -2); // cut “: ” at end
        break;
      case 'PLAYER': // automatically generated messages
        nick = markup[1].plain;
        team = markup[1].team === 'RESISTANCE' ? TEAM_RES : TEAM_ENL;
        if(ind >
 0) msg += nick; // don’t repeat nick directly
        break;
      case 'TEXT':
        msg += $('
<div/>
').text(markup[1].plain).html().autoLink();
        break;
      case 'AT_PLAYER':
        var thisToPlayer = (markup[1].plain == ('@'+window.PLAYER.nickname));
        var spanClass = thisToPlayer ? "pl_nudge_me" : (markup[1].team + " pl_nudge_player");
        var atPlayerName = markup[1].plain.replace(/^@/, "");
        msg += $('
<div/>
').html($('
<span/>
')
                          .attr('class', spanClass)
                          .attr('onclick',"window.chat.nicknameClicked(event, '"+atPlayerName+"')")
                          .text(markup[1].plain)).html();
        msgToPlayer = msgToPlayer || thisToPlayer;
        break;
      case 'PORTAL':
        var latlng = [markup[1].latE6/1E6, markup[1].lngE6/1E6];
        var perma = '/intel?ll='+latlng[0]+','+latlng[1]+'&z=17&pll='+latlng[0]+','+latlng[1];
        var js = 'window.selectPortalByLatLng('+latlng[0]+', '+latlng[1]+');return false';
        msg += '
<a onclick="'+js+'"'
          + ' title="'+markup[1].address+'"'
          + ' href="'+perma+'" class="help">
'
          + window.chat.getChatPortalName(markup[1])
          + '
</a>
';
        break;
      case 'SECURE':
        //NOTE: we won't add the '[secure]' string here - it'll be handled below instead
        isSecureMessage = true;
        break;
      default:
        //handle unknown types by outputting the plain text version, marked with it's type
        msg += $('
<div/>
').text(markup[0]+':
<'+markup[1].plain+'>
').html();
        break;
      }
    });
//    //skip secure messages on the public channel
//    if (isPublicChannel && isSecureMessage) return true;
//    //skip public messages (e.g. @player mentions) on the secure channel
//    if ((!isPublicChannel) && (!isSecureMessage)) return true;
    //NOTE: these two are redundant with the above two tests in place - but things have changed...
    //from the server, private channel messages are flagged with a SECURE string '[secure] ', and appear in
    //both the public and private channels
    //we don't include this '[secure]' text above, as it's redundant in the faction-only channel
    //let's add it here though if we have a secure message in the public channel, or the reverse if a non-secure in the faction one
    if (!auto && !(isPublicChannel===false) && isSecureMessage) msg = '
<span style="color: #f88; background-color: #500;">
[faction]
</span>
 ' + msg;
    //and, add the reverse - a 'public' marker to messages in the private channel
    if (!auto && !(isPublicChannel===true) && (!isSecureMessage)) msg = '
<span style="color: #ff6; background-color: #550">
[public]
</span>
 ' + msg;
    // format: timestamp, autogenerated, HTML message
    storageHash.data[json[0]] = [json[1], auto, chat.renderMsg(msg, nick, time, team, msgToPlayer, systemNarrowcast), nick];
  });
}
// Override portal names that are used over and over, such as 'US Post Office'
window.chat.getChatPortalName = function(markup) {
  var name = markup.name;
  if(name === 'US Post Office') {
    var address = markup.address.split(',');
    name = 'USPS: ' + address[0];
  }
  return name;
}
// renders data from the data-hash to the element defined by the given
// ID. Set 3rd argument to true if it is likely that old data has been
// added. Latter is only required for scrolling.
window.chat.renderData = function(data, element, likelyWereOldMsgs) {
  var elm = $('#'+element);
  if(elm.is(':hidden')) return;
  // discard guids and sort old to new
//TODO? stable sort, to preserve server message ordering? or sort by GUID if timestamps equal?
  var vals = $.map(data, function(v, k) { return [v]; });
  vals = vals.sort(function(a, b) { return a[0]-b[0]; });
  // render to string with date separators inserted
  var msgs = '';
  var prevTime = null;
  $.each(vals, function(ind, msg) {
    var nextTime = new Date(msg[0]).toLocaleDateString();
    if(prevTime && prevTime !== nextTime)
      msgs += chat.renderDivider(nextTime);
    msgs += msg[2];
    prevTime = nextTime;
  });
  var scrollBefore = scrollBottom(elm);
  elm.html('
<table>
' + msgs + '
</table>
');
  chat.keepScrollPosition(elm, scrollBefore, likelyWereOldMsgs);
}
window.chat.renderDivider = function(text) {
  var d = ' ──────────────────────────────────────────────────────────────────────────';
  return '
<tr>
<td colspan="3" style="padding-top:3px">
<summary>
─ ' + text + d + '
</summary>
</td>
</tr>
';
}
window.chat.renderMsg = function(msg, nick, time, team, msgToPlayer, systemNarrowcast) {
  var ta = unixTimeToHHmm(time);
  var tb = unixTimeToDateTimeString(time, true);
  //add
<small>
 tags around the milliseconds
  tb = (tb.slice(0,19)+'
<small class="milliseconds">
'+tb.slice(19)+'
</small>
').replace(/
</g,'&lt;').replace(/>
/g,'&gt;').replace(/"/g,'&quot;');
  // help cursor via “#chat time”
  var t = '
<time title="'+tb+'" data-timestamp="'+time+'">
'+ta+'
</time>
';
  if ( msgToPlayer )
  {
    t = '
<div class="pl_nudge_date">
' + t + '
</div>
<div class="pl_nudge_pointy_spacer">
</div>
';
  }
  if (systemNarrowcast)
  {
    msg = '
<div class="system_narrowcast">
' + msg + '
</div>
';
  }
  var color = COLORS[team];
  if (nick === window.PLAYER.nickname) color = '#fd6';    //highlight things said/done by the player in a unique colour (similar to @player mentions from others in the chat text itself)
  var s = 'style="cursor:pointer; color:'+color+'"';
  var i = ['
<span class="invisep">
&lt;
</span>
', '
<span class="invisep">
&gt;
</span>
'];
  return '
<tr>
<td>
'+t+'
</td>
<td>
'+i[0]+'
<mark class="nickname" ' + s + '>
'+ nick+'
</mark>
'+i[1]+'
</td>
<td>
'+msg+'
</td>
</tr>
';
}
window.chat.addNickname= function(nick) {
  var c = document.getElementById("chattext");
  c.value = [c.value.trim(), nick].join(" ").trim() + " ";
  c.focus()
}
window.chat.getActive = function() {
  return $('#chatcontrols .active').text();
}
window.chat.tabToChannel = function(tab) {
  if (tab == 'faction') return 'faction';
  if (tab == 'alerts') return 'alerts';
  return 'all';
};
window.chat.toggle = function() {
  var c = $('#chat, #chatcontrols');
  if(c.hasClass('expand')) {
    $('#chatcontrols a:first').html('
<span class="toggle expand">
</span>
');
    c.removeClass('expand');
    var div = $('#chat >
 div:visible');
    div.data('ignoreNextScroll', true);
    div.scrollTop(99999999); // scroll to bottom
    $('.leaflet-control').css('margin-left', '13px');
  } else {
    $('#chatcontrols a:first').html('
<span class="toggle shrink">
</span>
');
    c.addClass('expand');
    $('.leaflet-control').css('margin-left', '720px');
    chat.needMoreMessages();
  }
}
// called by plugins (or other things?) that need to monitor COMM data streams when the user is not viewing them
// instance: a unique string identifying the plugin requesting background COMM
// channel: either 'all', 'faction' or (soon) 'alerts' - others possible in the future
// flag: true for data wanted, false for not wanted
window.chat.backgroundChannelData = function(instance,channel,flag) {
  //first, store the state for this instance
  if (!window.chat.backgroundInstanceChannel) window.chat.backgroundInstanceChannel = {};
  if (!window.chat.backgroundInstanceChannel[instance]) window.chat.backgroundInstanceChannel[instance] = {};
  window.chat.backgroundInstanceChannel[instance][channel] = flag;
  //now, to simplify the request code, merge the flags for all instances into one
  // 1. clear existing overall flags
  window.chat.backgroundChannels = {};
  // 2. for each instance monitoring COMM...
  $.each(window.chat.backgroundInstanceChannel, function(instance,channels) {
    // 3. and for each channel monitored by this instance...
    $.each(window.chat.backgroundInstanceChannel[instance],function(channel,flag) {
      // 4. if it's monitored, set the channel flag
      if (flag) window.chat.backgroundChannels[channel] = true;
    });
  });
}
window.chat.request = function() {
  console.log('refreshing chat');
  var channel = chat.tabToChannel(chat.getActive());
  if (channel == 'faction' || (window.chat.backgroundChannels && window.chat.backgroundChannels['faction'])) {
    chat.requestFaction(false);
  }
  if (channel == 'all' || (window.chat.backgroundChannels && window.chat.backgroundChannels['all'])) {
    chat.requestPublic(false);
  }
  if (channel == 'alerts' || (window.chat.backgroundChannels && window.chat.backgroundChannels['alerts'])) {
    chat.requestAlerts(false);
  }
}
// checks if there are enough messages in the selected chat tab and
// loads more if not.
window.chat.needMoreMessages = function() {
  var activeTab = chat.getActive();
  if(activeTab === 'debug') return;
  var activeChat = $('#chat >
 :visible');
  if(activeChat.length === 0) return;
  var hasScrollbar = scrollBottom(activeChat) !== 0 || activeChat.scrollTop() !== 0;
  var nearTop = activeChat.scrollTop()
<= CHAT_REQUEST_SCROLL_TOP;
  if(hasScrollbar && !nearTop) return;
  console.log('No scrollbar or near top in active chat. Requesting more data.');
  if(activeTab === 'faction')
    chat.requestFaction(true);
  else
    chat.requestPublic(true);
};
window.chat.chooseTab = function(tab) {
  if (tab != 'all' && tab != 'faction' && tab != 'alerts') {
    console.warn('chat tab "'+tab+'" requested - but only "all", "faction" and "alerts" are valid - assuming "all" wanted');
    tab = 'all';
  }
  var oldTab = chat.getActive();
  localStorage['iitc-chat-tab'] = tab;
  var mark = $('#chatinput mark');
  var input = $('#chatinput input');
  $('#chatcontrols .active').removeClass('active');
  $("#chatcontrols a:contains('" + tab + "')").addClass('active');
  if (tab != oldTab) startRefreshTimeout(0.1*1000); //only chat uses the refresh timer stuff, so a perfect way of forcing an early refresh after a tab change
  $('#chat >
 div').hide();
  var elm;
  switch(tab) {
    case 'faction':
      input.css('color', '');
      mark.css('color', '');
      mark.text('tell faction:');
      chat.renderFaction(false);
      break;
    case 'all':
      input.css('cssText', 'color: #f66 !important');
      mark.css('cssText', 'color: #f66 !important');
      mark.text('broadcast:');
      chat.renderPublic(false);
      break;
    case 'alerts':
      mark.css('cssText', 'color: #bbb !important');
      input.css('cssText', 'color: #bbb !important');
      mark.text('tell Jarvis:');
      chat.renderAlerts(false);
      break;
    default:
      throw('chat.chooser was asked to handle unknown button: ' + tt);
  }
  var elm = $('#chat' + tab);
  elm.show();
  if(elm.data('needsScrollTop')) {
    elm.data('ignoreNextScroll', true);
    elm.scrollTop(elm.data('needsScrollTop'));
    elm.data('needsScrollTop', null);
  }
}
window.chat.show = function(name) {
    window.isSmartphone()
        ? $('#updatestatus').hide()
        : $('#updatestatus').show();
    $('#chat, #chatinput').show();
    window.chat.chooseTab(name);
}
window.chat.chooser = function(event) {
  var t = $(event.target);
  var tab = t.text();
  window.chat.chooseTab(tab);
}
// contains the logic to keep the correct scroll position.
window.chat.keepScrollPosition = function(box, scrollBefore, isOldMsgs) {
  // If scrolled down completely, keep it that way so new messages can
  // be seen easily. If scrolled up, only need to fix scroll position
  // when old messages are added. New messages added at the bottom don’t
  // change the view and enabling this would make the chat scroll down
  // for every added message, even if the user wants to read old stuff.
  if(box.is(':hidden') && !isOldMsgs) {
    box.data('needsScrollTop', 99999999);
    return;
  }
  if(scrollBefore === 0 || isOldMsgs) {
    box.data('ignoreNextScroll', true);
    box.scrollTop(box.scrollTop() + (scrollBottom(box)-scrollBefore));
  }
}
//
// setup
//
window.chat.setup = function() {
  if (localStorage['iitc-chat-tab']) {
    chat.chooseTab(localStorage['iitc-chat-tab']);
 }
  $('#chatcontrols, #chat, #chatinput').show();
  $('#chatcontrols a:first').click(window.chat.toggle);
  $('#chatcontrols a').each(function(ind, elm) {
    if($.inArray($(elm).text(), ['all', 'faction', 'alerts']) !== -1)
      $(elm).click(window.chat.chooser);
  });
  $('#chatinput').click(function() {
    $('#chatinput input').focus();
  });
  window.chat.setupTime();
  window.chat.setupPosting();
  $('#chatfaction').scroll(function() {
    var t = $(this);
    if(t.data('ignoreNextScroll')) return t.data('ignoreNextScroll', false);
    if(t.scrollTop()
< CHAT_REQUEST_SCROLL_TOP) chat.requestFaction(true);
    if(scrollBottom(t) === 0) chat.requestFaction(false);
  });
  $('#chatall').scroll(function() {
    var t = $(this);
    if(t.data('ignoreNextScroll')) return t.data('ignoreNextScroll', false);
    if(t.scrollTop()
< CHAT_REQUEST_SCROLL_TOP) chat.requestPublic(true);
    if(scrollBottom(t) === 0) chat.requestPublic(false);
  });
  $('#chatalerts').scroll(function() {
    var t = $(this);
    if(t.data('ignoreNextScroll')) return t.data('ignoreNextScroll', false);
    if(t.scrollTop()
< CHAT_REQUEST_SCROLL_TOP) chat.requestAlerts(true);
    if(scrollBottom(t) === 0) chat.requestAlerts(false);
  });
  window.requests.addRefreshFunction(chat.request);
  var cls = PLAYER.team === 'RESISTANCE' ? 'res' : 'enl';
  $('#chatinput mark').addClass(cls);
  $(document).on('click', '.nickname', function(event) {
    return window.chat.nicknameClicked(event, $(this).text());
  });
}
window.chat.setupTime = function() {
  var inputTime = $('#chatinput time');
  var updateTime = function() {
    if(window.isIdle()) return;
    var d = new Date();
    var h = d.getHours() + ''; if(h.length === 1) h = '0' + h;
    var m = d.getMinutes() + ''; if(m.length === 1) m = '0' + m;
    inputTime.text(h+':'+m);
    // update ON the minute (1ms after)
    setTimeout(updateTime, (60 - d.getSeconds()) * 1000 + 1);
  };
  updateTime();
  window.addResumeFunction(updateTime);
}
//
// posting
//
window.chat.setupPosting = function() {
  if (!isSmartphone()) {
    $('#chatinput input').keydown(function(event) {
      try {
        var kc = (event.keyCode ? event.keyCode : event.which);
        if(kc === 13) { // enter
          chat.postMsg();
          event.preventDefault();
        } else if (kc === 9) { // tab
          event.preventDefault();
          window.chat.handleTabCompletion();
        }
      } catch(error) {
        console.log(error);
        debug.printStackTrace();
      }
    });
  }
  $('#chatinput').submit(function(event) {
    event.preventDefault();
    chat.postMsg();
  });
}
window.chat.postMsg = function() {
  var c = chat.getActive();
  if(c == 'alerts')
    return alert("Jarvis: A strange game. The only winning move is not to play. How about a nice game of chess?\n(You can't chat to the 'alerts' channel!)");
  var msg = $.trim($('#chatinput input').val());
  if(!msg || msg === '') return;
  if(c === 'debug') {
    var result;
    try {
      result = eval(msg);
    } catch(e) {
      if(e.stack) console.error(e.stack);
      throw e; // to trigger native error message
    }
    if(result !== undefined)
      console.log(result.toString());
    return result;
  }
  var latlng = map.getCenter();
  var data = {message: msg,
              latE6: Math.round(latlng.lat*1E6),
              lngE6: Math.round(latlng.lng*1E6),
              tab: c};
  var errMsg = 'Your message could not be delivered. You can copy&' +
               'paste it here and try again if you want:\n\n' + msg;
  window.postAjax('sendPlext', data,
    function(response) {
      if(response.error) alert(errMsg);
      startRefreshTimeout(0.1*1000); //only chat uses the refresh timer stuff, so a perfect way of forcing an early refresh after a send message
    },
    function() {
      alert(errMsg);
    }
  );
  $('#chatinput input').val('');
}
;
// MAP DATA CACHE ///////////////////////////////////
// cache for map data tiles.
window.DataCache = function() {
  this.REQUEST_CACHE_FRESH_AGE = 3*60;  // if younger than this, use data in the cache rather than fetching from the server
  this.REQUEST_CACHE_MAX_AGE = 5*60;  // maximum cache age. entries are deleted from the cache after this time
  //NOTE: characters are 16 bits (ECMAScript standard), so divide byte size by two for correct limit
  if (L.Browser.mobile) {
    // on mobile devices, smaller cache size
    this.REQUEST_CACHE_MAX_ITEMS = 300;  // if more than this many entries, expire early
    this.REQUEST_CACHE_MAX_CHARS = 5000000/2; // or more than this total size
  } else {
    // but on desktop, allow more
    this.REQUEST_CACHE_MAX_ITEMS = 1000;  // if more than this many entries, expire early
    this.REQUEST_CACHE_MAX_CHARS = 20000000/2; // or more than this total size
  }
  this._cache = {};
  this._cacheCharSize = 0;
  this._interval = undefined;
}
window.DataCache.prototype.store = function(qk,data,freshTime) {
  // fixme? common behaviour for objects is that properties are kept in the order they're added
  // this is handy, as it allows easy retrieval of the oldest entries for expiring
  // however, this is not guaranteed by the standards, but all our supported browsers work this way
  this.remove(qk);
  var time = new Date().getTime();
  if (freshTime===undefined) freshTime = this.REQUEST_CACHE_FRESH_AGE*1000;
  var expire = time + freshTime;
  var dataStr = JSON.stringify(data);
  this._cacheCharSize += dataStr.length;
  this._cache[qk] = { time: time, expire: expire, dataStr: dataStr };
}
window.DataCache.prototype.remove = function(qk) {
  if (qk in this._cache) {
    this._cacheCharSize -= this._cache[qk].dataStr.length;
    delete this._cache[qk];
  }
}
window.DataCache.prototype.get = function(qk) {
  if (qk in this._cache) return JSON.parse(this._cache[qk].dataStr);
  else return undefined;
}
window.DataCache.prototype.getTime = function(qk) {
  if (qk in this._cache) return this._cache[qk].time;
  else return 0;
}
window.DataCache.prototype.isFresh = function(qk) {
  if (qk in this._cache) {
    var d = new Date();
    var t = d.getTime();
    if (this._cache[qk].expire >
= t) return true;
    else return false;
  }
  return undefined;
}
window.DataCache.prototype.startExpireInterval = function(period) {
  if (this._interval === undefined) {
    var savedContext = this;
    this._interval = setInterval (function() { savedContext.runExpire(); }, period*1000);
  }
}
window.DataCache.prototype.stopExpireInterval = function() {
  if (this._interval !== undefined) {
    stopInterval (this._interval);
    this._interval = undefined;
  }
}
window.DataCache.prototype.runExpire = function() {
  var d = new Date();
  var t = d.getTime()-this.REQUEST_CACHE_MAX_AGE*1000;
  var cacheSize = Object.keys(this._cache).length;
  for(var qk in this._cache) {
    // fixme? our MAX_SIZE test here assumes we're processing the oldest first. this relies
    // on looping over object properties in the order they were added. this is true in most browsers,
    // but is not a requirement of the standards
    if (cacheSize >
 this.REQUEST_CACHE_MAX_ITEMS || this._cacheCharSize >
 this.REQUEST_CACHE_MAX_CHARS || this._cache[qk].time
< t) {
      this._cacheCharSize -= this._cache[qk].dataStr.length;
      delete this._cache[qk];
      cacheSize--;
    }
  }
}
window.DataCache.prototype.debug = function() {
//NOTE: ECMAScript strings use 16 bit chars (it's in the standard), so convert for bytes/Kb
  return 'Cache: '+Object.keys(this._cache).length+' items, '+(this._cacheCharSize*2).toLocaleString()+' bytes ('+Math.ceil(this._cacheCharSize/512).toLocaleString()+'K)';
}
;
// DEBUGGING TOOLS ///////////////////////////////////////////////////
// meant to be used from browser debugger tools and the like.
window.debug = function() {}
window.debug.renderDetails = function() {
  console.log('portals: ' + Object.keys(window.portals).length);
  console.log('links:   ' + Object.keys(window.links).length);
  console.log('fields:  ' + Object.keys(window.fields).length);
}
window.debug.printStackTrace = function() {
  var e = new Error('dummy');
  console.log(e.stack);
  return e.stack;
}
window.debug.console = function() {
  $('#debugconsole').text();
}
window.debug.console.show = function() {
    $('#chat, #chatinput').show();
    window.debug.console.create();
    $('#chatinput mark').css('cssText', 'color: #bbb !important').text('debug:');
    $('#chat >
 div').hide();
    $('#debugconsole').show();
    $('#chatcontrols .active').removeClass('active');
    $("#chatcontrols a:contains('debug')").addClass('active');
}
window.debug.console.create = function() {
  if($('#debugconsole').length) return;
  $('#chatcontrols').append('
<a>
debug
</a>
');
  $('#chatcontrols a:last').click(window.debug.console.show);
  $('#chat').append('
<div style="display: none" id="debugconsole">
<table>
</table>
</div>
');
}
window.debug.console.renderLine = function(text, errorType) {
  debug.console.create();
  switch(errorType) {
    case 'error':   var color = '#FF424D'; break;
    case 'warning': var color = '#FFDE42'; break;
    default:        var color = '#eee';
  }
  if(typeof text !== 'string' && typeof text !== 'number') {
    var cache = [];
    text = JSON.stringify(text, function(key, value) {
      if(typeof value === 'object' && value !== null) {
        if(cache.indexOf(value) !== -1) {
          // Circular reference found, discard key
          return;
        }
        // Store value in our collection
        cache.push(value);
      }
      return value;
    });
    cache = null;
  }
  var d = new Date();
  var ta = d.toLocaleTimeString(); // print line instead maybe?
  var tb = d.toLocaleString();
  var t = '
<time title="'+tb+'" data-timestamp="'+d.getTime()+'">
'+ta+'
</time>
';
  var s = 'style="color:'+color+'"';
  var l = '
<tr>
<td>
'+t+'
</td>
<td>
<mark '+s+'>
'+errorType+'
</mark>
</td>
<td>
'+text+'
</td>
</tr>
';
  $('#debugconsole table').prepend(l);
}
window.debug.console.log = function(text) {
  debug.console.renderLine(text, 'notice');
}
window.debug.console.warn = function(text) {
  debug.console.renderLine(text, 'warning');
}
window.debug.console.error = function(text) {
  debug.console.renderLine(text, 'error');
}
window.debug.console.overwriteNative = function() {
  window.debug.console.create();
  var nativeConsole = window.console;
  window.console = {};
  function overwrite(which) {
    window.console[which] = function() {
      nativeConsole[which].apply(nativeConsole, arguments);
      window.debug.console[which].apply(window.debug.console, arguments);
    }
  }
  overwrite("log");
  overwrite("warn");
  overwrite("error");
}
window.debug.console.overwriteNativeIfRequired = function() {
  if(!window.console || L.Browser.mobile)
    window.debug.console.overwriteNative();
}
;
// DIALOGS /////////////////////////////////////////////////////////
// Inspired by TES III: Morrowind. Long live House Telvanni. ///////
////////////////////////////////////////////////////////////////////
/* The global ID of onscreen dialogs.
 * Starts at 0.
 */
window.DIALOG_ID = 0;
/* All onscreen dialogs, keyed by their ID.
 */
window.DIALOGS = {};
/* The number of dialogs on screen.
 */
window.DIALOG_COUNT = 0;
/* The dialog that has focus.
 */
window.DIALOG_FOCUS = null;
/* Controls how quickly the slide toggle animation
 * should play for dialog collapsing and expanding.
 */
window.DIALOG_SLIDE_DURATION = 100;
/* Creates a dialog and puts it onscreen. Takes one argument: options, a JS object.
 * == Common options
 * (text|html): The text or HTML to display in the dialog. Text is auto-converted to HTML.
 * title: The dialog's title.
 * modal: Whether to open a modal dialog. Implies draggable=false; dialogClass='ui-dialog-modal'.
 *        Please note that modal dialogs hijack the entire screen and should only be used in very
 *        specific cases. (If IITC is running on mobile, modal will always be true).
 * id:   A unique ID for this dialog. If a dialog with id `id' is already open and dialog() is called
 *       again, it will be automatically closed.
 *
 * == Callbacks
 * closeCallback: A callback to run on close. Takes no arguments.
 * collapseCallback: A callback to run on dialog collapse.  Takes no arguments.
 * expandCallback:   A callback to run on dialog expansion. Takes no arguments.
 * collapseExpandCallback: A callback to run on both collapse and expand (overrides collapseCallback
 *                         and expandCallback, takes a boolean argument `collapsing' - true if collapsing;
 *                         false if expanding)
 * focusCallback: A callback to run when the dialog gains focus.
 * blurCallback:  A callback to run when the dialog loses focus.
 *
 * See http://docs.jquery.com/UI/API/1.8/Dialog for a list of all the options. If you previously
 * applied a class to your dialog after creating it with alert(), dialogClass may be particularly
 * useful.
 */
window.dialog = function(options) {
  // Override for smartphones. Preserve default behavior and create a modal dialog.
  options = options || {};
  if(isSmartphone()) {
    options.modal = true;
    options.width = 'auto';
  }
  // Build an identifier for this dialog
  var id = 'dialog-' + (options.modal ? 'modal' : (options.id ? options.id : 'anon-' + window.DIALOG_ID++));
  var jqID = '#' + id;
  var html = '';
  // hint for iitc mobile that a dialog was opened
  if (typeof android !== 'undefined' && android && android.dialogOpened) {
    android.dialogOpened(id, true);
  }
  // Convert text to HTML if necessary
  if(options.text) {
    html = window.convertTextToTableMagic(options.text);
  } else if(options.html) {
    html = options.html;
  } else {
    console.log('window.dialog: warning: no text in dialog');
    html = window.convertTextToTableMagic('');
  }
  // Modal dialogs should not be draggable
  if(options.modal) {
    options.dialogClass = 'ui-dialog-modal';
    options.draggable = false;
  }
  // Close out existing dialogs.
  if(window.DIALOGS[id]) {
    try {
      var selector = $(window.DIALOGS[id]);
      selector.dialog('close');
      selector.remove();
    } catch(err) {
      console.log('window.dialog: Tried to close nonexistent dialog ' + id);
    }
  }
  // Create the window, appending a div to the body
  $('body').append('
<div id="' + id + '">
</div>
');
  var dialog = $(jqID).dialog($.extend(true, {
    autoOpen: false,
    modal: false,
    draggable: true,
    closeText: '&nbsp;',
    title: '',
    buttons: {
      'OK': function() {
        $(this).dialog('close');
      }
    },
    open: function() {
      var titlebar = $(this).closest('.ui-dialog').find('.ui-dialog-titlebar');
      titlebar.find('.ui-dialog-title').addClass('ui-dialog-title-active');
      var close = titlebar.find('.ui-dialog-titlebar-close');
      // Title should not show up on mouseover
      close.removeAttr('title').addClass('ui-dialog-titlebar-button');
      if(!$(this).dialog('option', 'modal')) {
        // Start out with a cloned version of the close button
        var collapse = close.clone();
        // Change it into a collapse button and set the click handler
        collapse.addClass('ui-dialog-titlebar-button-collapse ui-dialog-titlebar-button-collapse-expanded');
        collapse.click($.proxy(function() {
          var collapsed = ($(this).data('collapsed') === true);
          // Run callbacks if we have them
          if($(this).data('collapseExpandCallback')) {
            $.proxy($(this).data('collapseExpandCallback'), this)(!collapsed);
          } else {
            if(!collapsed && $(this).data('collapseCallback')) {
              $.proxy($(this).data('collapseCallback'), this)();
            } else if (collapsed && $(this).data('expandCallback')) {
              $.proxy($(this).data('expandCallback'), this)();
            }
          }
          // Find the button pane and content dialog in this ui-dialog, and add or remove the 'hidden' class.
          var dialog   = $(this).closest('.ui-dialog');
          var selector = dialog.find('.ui-dialog-content,.ui-dialog-buttonpane');
          var button   = dialog.find('.ui-dialog-titlebar-button-collapse');
          // Slide toggle
          $(selector).slideToggle({duration: window.DIALOG_SLIDE_DURATION});
          if(collapsed) {
            $(button).removeClass('ui-dialog-titlebar-button-collapse-collapsed');
            $(button).addClass('ui-dialog-titlebar-button-collapse-expanded');
          } else {
            $(button).removeClass('ui-dialog-titlebar-button-collapse-expanded');
            $(button).addClass('ui-dialog-titlebar-button-collapse-collapsed');
          }
          // Toggle collapsed state
          $(this).data('collapsed', !collapsed);
        }, this));
        // Put it into the titlebar
        titlebar.prepend(collapse);
        close.addClass('ui-dialog-titlebar-button-close');
      }
      window.DIALOGS[$(this).data('id')] = this;
      window.DIALOG_COUNT++;
      console.log('window.dialog: ' + $(this).data('id') + ' (' + $(this).dialog('option', 'title') + ') opened. ' + window.DIALOG_COUNT + ' remain.');
    },
    close: function() {
      // Run the close callback if we have one
      if($(this).data('closeCallback')) {
        $.proxy($(this).data('closeCallback'), this)();
      }
      // Make sure that we don't keep a dead dialog in focus
      if(window.DIALOG_FOCUS && $(window.DIALOG_FOCUS).data('id') === $(this).data('id')) {
        window.DIALOG_FOCUS = null;
      }
      // Finalize
      delete window.DIALOGS[$(this).data('id')];
      window.DIALOG_COUNT--;
      console.log('window.dialog: ' + $(this).data('id') + ' (' + $(this).dialog('option', 'title') + ') closed. ' + window.DIALOG_COUNT + ' remain.');
      // hint for iitc mobile that a dialog was closed
      if (typeof android !== 'undefined' && android && android.dialogOpened) {
        android.dialogOpened(id, false);
      }
      // remove from DOM and destroy
      $(this).dialog('destroy').remove();
    },
    focus: function() {
      if($(this).data('focusCallback')) {
        $.proxy($(this).data('focusCallback'), this)();
      }
      // Blur the window currently in focus unless we're gaining focus
      if(window.DIALOG_FOCUS && $(window.DIALOG_FOCUS).data('id') !== $(this).data('id')) {
        $.proxy(function(event, ui) {
          if($(this).data('blurCallback')) {
            $.proxy($(this).data('blurCallback'), this)();
          }
          $(this).closest('.ui-dialog').find('.ui-dialog-title').removeClass('ui-dialog-title-active').addClass('ui-dialog-title-inactive');
        }, window.DIALOG_FOCUS)();
      }
      // This dialog is now in focus
      window.DIALOG_FOCUS = this;
      // hint for iitc mobile that a dialog was focused
      if (typeof android !== 'undefined' && android && android.dialogFocused) {
        android.dialogFocused($(window.DIALOG_FOCUS).data('id'));
      }
      $(this).closest('.ui-dialog').find('.ui-dialog-title').removeClass('ui-dialog-title-inactive').addClass('ui-dialog-title-active');
    }
  }, options));
  // Set HTML and IDs
  dialog.html(html);
  dialog.data('id', id);
  dialog.data('jqID', jqID);
  // Set callbacks
  dialog.data('closeCallback', options.closeCallback);
  dialog.data('collapseCallback', options.collapseCallback);
  dialog.data('expandCallback', options.expandCallback);
  dialog.data('collapseExpandCallback', options.collapseExpandCallback);
  dialog.data('focusCallback', options.focusCallback);
  dialog.data('blurCallback', options.blurCallback);
  if(options.modal) {
    // ui-modal includes overrides for modal dialogs
    dialog.parent().addClass('ui-modal');
  } else {
    // Enable snapping
    dialog.dialog().parents('.ui-dialog').draggable('option', 'snap', true);
  }
  // Run it
  dialog.dialog('open');
  return dialog;
}
/* Creates an alert dialog with default settings.
 * If you want more configurability, use window.dialog instead.
 */
window.alert = function(text, isHTML, closeCallback) {
  var obj = {closeCallback: closeCallback};
  if(isHTML) {
    obj.html = text;
  } else {
    obj.text = text;
  }
  return dialog(obj);
}
window.setupDialogs = function() {
  window.DIALOG_ID = 0;
  window.DIALOGS   = {}
  window.DIALOG_COUNT = 0;
  window.DIALOG_FOCUS = null;
}
;
// decode the on-network array entity format into an object format closer to that used before
// makes much more sense as an object, means that existing code didn't need to change, and it's what the
// stock intel site does internally too (the array format is only on the network)
// anonymous wrapper function
(function(){
  window.decodeArray = function(){};
  function parseMod(arr) {
    if(arr == null) { return null; }
    return {
      owner: arr[0],
      name: arr[1],
      rarity: arr[2],
      stats: arr[3],
    };
  }
  function parseResonator(arr) {
    if(arr == null) { return null; }
    return {
      owner: arr[0],
      level: arr[1],
      energy: arr[2],
    };
  }
  function parseArtifactBrief(arr) {
    if (arr === null) return null;
    // array index 0 is for fragments at the portal. index 1 is for target portals
    // each of those is two dimensional - not sure why. part of this is to allow for multiple types of artifacts,
    // with their own targets, active at once - but one level for the array is enough for that
    // making a guess - first level is for different artifact types, second index would allow for
    // extra data for that artifact type
    function decodeArtifactArray(arr) {
      var result = {};
      for (var i=0; i
<arr.length; i++) {
        // we'll use the type as the key - and store any additional array values as the value
        // that will be an empty array for now, so only object keys are useful data
        result[arr[i][0]] = arr[i].slice(1);
      }
      return result;
    }
    return {
      fragment: decodeArtifactArray(arr[0]),
      target: decodeArtifactArray(arr[1]),
    };
  }
  function parseArtifactDetail(arr) {
    if (arr == null) { return null; }
    // empty artifact data is pointless - ignore it
    if (arr.length == 3 && arr[0] == "" && arr[1] == "" && arr[2].length == 0) { return null; }
    return {
      type: arr[0],
      displayName: arr[1],
      fragments: arr[2],
    };
  }
//there's also a 'placeholder' portal - generated from the data in links/fields. only has team/lat/lng
  var CORE_PORTA_DATA_LENGTH = 4;
  function corePortalData(a) {
    return {
      // a[0] == type (always 'p')
      team:          a[1],
      latE6:         a[2],
      lngE6:         a[3]
    }
  };
  var SUMMARY_PORTAL_DATA_LENGTH = 14;
  function summaryPortalData(a) {
    return {
      level:         a[4],
      health:        a[5],
      resCount:      a[6],
      image:         a[7],
      title:         a[8],
      ornaments:     a[9],
      mission:       a[10],
      mission50plus: a[11],
      artifactBrief: parseArtifactBrief(a[12]),
      timestamp:     a[13]
    };
  };
  var DETAILED_PORTAL_DATA_LENGTH = SUMMARY_PORTAL_DATA_LENGTH+4;
  window.decodeArray.portalSummary = function(a) {
    if (!a) return undefined;
    if (a[0] != 'p') throw 'Error: decodeArray.portalSUmmary - not a portal';
    if (a.length == CORE_PORTA_DATA_LENGTH) {
      return corePortalData(a);
    }
    // NOTE: allow for either summary or detailed portal data to be passed in here, as details are sometimes
    // passed into code only expecting summaries
    if (a.length != SUMMARY_PORTAL_DATA_LENGTH && a.length != DETAILED_PORTAL_DATA_LENGTH) {
      console.warn('Portal summary length changed - portal details likely broken!');
      debugger;
    }
    return $.extend(corePortalData(a), summaryPortalData(a));
  }
  window.decodeArray.portalDetail = function(a) {
    if (!a) return undefined;
    if (a[0] != 'p') throw 'Error: decodeArray.portalDetail - not a portal';
    if (a.length != DETAILED_PORTAL_DATA_LENGTH) {
      console.warn('Portal detail length changed - portal details may be wrong');
      debugger;
    }
    //TODO look at the array values, make a better guess as to which index the mods start at, rather than using the hard-coded SUMMARY_PORTAL_DATA_LENGTH constant
    // the portal details array is just an extension of the portal summary array
    // to allow for niantic adding new items into the array before the extended details start,
    // use the length of the summary array
    return $.extend(corePortalData(a), summaryPortalData(a),{
      mods:      a[SUMMARY_PORTAL_DATA_LENGTH+0].map(parseMod),
      resonators:a[SUMMARY_PORTAL_DATA_LENGTH+1].map(parseResonator),
      owner:     a[SUMMARY_PORTAL_DATA_LENGTH+2],
      artifactDetail:  parseArtifactDetail(a[SUMMARY_PORTAL_DATA_LENGTH+3]),
    });
  }
})();
;
// ENTITY DETAILS TOOLS //////////////////////////////////////////////
// hand any of these functions the details-hash of an entity (i.e.
// portal, link, field) and they will return useful data.
// given the entity detail data, returns the team the entity belongs
// to. Uses TEAM_* enum values.
window.getTeam = function(details) {
  return teamStringToId(details.team);
}
window.teamStringToId = function(teamStr) {
  var team = TEAM_NONE;
  if(teamStr === 'ENLIGHTENED') team = TEAM_ENL;
  if(teamStr === 'RESISTANCE') team = TEAM_RES;
  if(teamStr === 'E') team = TEAM_ENL;
  if(teamStr === 'R') team = TEAM_RES;
  return team;
}
;
// as of 2014-08-14, Niantic have returned to minifying the javascript. This means we no longer get the nemesis object
// and it's various member objects, functions, etc.
// so we need to extract some essential parameters from the code for IITC to use
window.extractFromStock = function() {
  window.niantic_params = {}
  // extract the former nemesis.dashboard.config.CURRENT_VERSION from the code
  var reVersion = new RegExp('"X-CSRFToken".*[a-z].v="([a-f0-9]{40})";');
  var minified = new RegExp('^[a-zA-Z$][a-zA-Z$0-9]?$');
  for (var topLevel in window) {
    if (minified.test(topLevel)) {
      // a minified object - check for minified prototype entries
      var topObject = window[topLevel];
      if (topObject && topObject.prototype) {
        // the object has a prototype - iterate through the properties of that
        for (var secLevel in topObject.prototype) {
          if (minified.test(secLevel)) {
            // looks like we've found an object of the format "XX.prototype.YY"...
            var item = topObject.prototype[secLevel];
            if (item && typeof(item) == "function") {
              // a function - test it against the relevant regular expressions
              var funcStr = item.toString();
              var match = reVersion.exec(funcStr);
              if (match) {
                console.log('Found former CURRENT_VERSION in '+topLevel+'.prototype.'+secLevel);
                niantic_params.CURRENT_VERSION = match[1];
              }
            }
          }
        }
      } //end 'if .prototype'
      if (topObject && Array.isArray && Array.isArray(topObject)) {
        // find all non-zero length arrays containing just numbers
        if (topObject.length>
0) {
          var justInts = true;
          for (var i=0; i
<topObject.length; i++) {
            if (typeof(topObject[i]) !== 'number' || topObject[i] != parseInt(topObject[i])) {
              justInts = false;
              break;
            }
          }
          if (justInts) {
            // current lengths are: 17: ZOOM_TO_LEVEL, 14: TILES_PER_EDGE
            // however, slightly longer or shorter are a possibility in the future
            if (topObject.length >
= 12 && topObject.length
<= 18) {
              // a reasonable array length for tile parameters
              // need to find two types:
              // a. portal level limits. decreasing numbers, starting at 8
              // b. tiles per edge. increasing numbers. current max is 36000, 9000 was the previous value - 18000 is a likely possibility too
              if (topObject[0] == 8) {
                // check for tile levels
                var decreasing = true;
                for (var i=1; i
<topObject.length; i++) {
                  if (topObject[i-1]
< topObject[i]) {
                    decreasing = false;
                    break;
                  }
                }
                if (decreasing) {
                  console.log ('int array '+topLevel+' looks like ZOOM_TO_LEVEL: '+JSON.stringify(topObject));
                  window.niantic_params.ZOOM_TO_LEVEL = topObject;
                }
              } // end if (topObject[0] == 8)
              // 2015-06-25 - changed to top value of 64000, then to 32000 - allow for them to restore it just in case
              if (topObject[topObject.length-1] >
= 9000 && topObject[topObject.length-1]
<= 64000) {
                var increasing = true;
                for (var i=1; i
<topObject.length; i++) {
                  if (topObject[i-1] >
 topObject[i]) {
                    increasing = false;
                    break;
                  }
                }
                if (increasing) {
                  console.log ('int array '+topLevel+' looks like TILES_PER_EDGE: '+JSON.stringify(topObject));
                  window.niantic_params.TILES_PER_EDGE = topObject;
                }
              } //end if (topObject[topObject.length-1] == 9000) {
            }
          }
        }
      }
    }
  }
  if (niantic_params.CURRENT_VERSION === undefined) {
    dialog({
      title: 'IITC Broken',
      html: '
<p>
IITC failed to extract the required parameters from the intel site
</p>
'
           +'
<p>
This can happen after Niantic update the standard intel site. A fix will be needed from the IITC developers.
</p>
',
    });
    console.log('Discovered parameters');
    console.log(JSON.stringify(window.niantic_params,null,2));
    throw('Error: IITC failed to extract CURRENT_VERSION string - cannot continue');
  }
}
;
// GAME STATUS ///////////////////////////////////////////////////////
// MindUnit display
window.updateGameScore = function(data) {
  if(!data) {
    // move the postAjax call onto a very short timer. this way, if it throws an exception, it won't prevent IITC booting
    setTimeout (function() { window.postAjax('getGameScore', {}, window.updateGameScore); }, 1);
    return;
  }
  if (data && data.result) {
    var e = parseInt(data.result[0]); //enlightened score in result[0]
    var r = parseInt(data.result[1]); //resistance score in result[1]
    var s = r+e;
    var rp = r/s*100, ep = e/s*100;
    r = digits(r), e = digits(e);
    var rs = '
<span class="res" style="width:'+rp+'%;">
'+Math.round(rp)+'%&nbsp;
</span>
';
    var es = '
<span class="enl" style="width:'+ep+'%;">
&nbsp;'+Math.round(ep)+'%
</span>
';
    $('#gamestat').html(rs+es).one('click', function() { window.updateGameScore() });
    // help cursor via “#gamestat span”
    $('#gamestat').attr('title', 'Resistance:\t'+r+' MindUnits\nEnlightened:\t'+e+' MindUnits');
  } else if (data && data.error) {
    console.warn('game score failed to load: '+data.error);
  } else {
    console.warn('game score failed to load - unknown reason');
  }
  // TODO: idle handling - don't refresh when IITC is idle!
  window.setTimeout('window.updateGameScore', REFRESH_GAME_SCORE*1000);
}
;
// PLUGIN HOOKS ////////////////////////////////////////////////////////
// Plugins may listen to any number of events by specifying the name of
// the event to listen to and handing a function that should be exe-
// cuted when an event occurs. Callbacks will receive additional data
// the event created as their first parameter. The value is always a
// hash that contains more details.
//
// For example, this line will listen for portals to be added and print
// the data generated by the event to the console:
// window.addHook('portalAdded', function(data) { console.log(data) });
//
// Boot hook: booting is handled differently because IITC may not yet
//            be available. Have a look at the plugins in plugins/. All
//            code before “// PLUGIN START” and after “// PLUGIN END” is
//            required to successfully boot the plugin.
//
// Here’s more specific information about each event:
// portalSelected: called when portal on map is selected/unselected.
//              Provide guid of selected and unselected portal.
// mapDataRefreshStart: called when we start refreshing map data
// mapDataEntityInject: called just as we start to render data. has callback to inject cached entities into the map render
// mapDataRefreshEnd: called when we complete the map data load
// portalAdded: called when a portal has been received and is about to
//              be added to its layer group. Note that this does NOT
//              mean it is already visible or will be, shortly after.
//              If a portal is added to a hidden layer it may never be
//              shown at all. Injection point is in
//              code/map_data.js#renderPortal near the end. Will hand
//              the Leaflet CircleMarker for the portal in "portal" var.
// linkAdded:   called when a link is about to be added to the map
// fieldAdded:  called when a field is about to be added to the map
// portalDetailsUpdated: fired after the details in the sidebar have
//              been (re-)rendered Provides data about the portal that
//              has been selected.
// publicChatDataAvailable: this hook runs after data for any of the
//              public chats has been received and processed, but not
//              yet been displayed. The data hash contains both the un-
//              processed raw ajax response as well as the processed
//              chat data that is going to be used for display.
// factionChatDataAvailable: this hook runs after data for the faction
//              chat has been received and processed, but not yet been
//              displayed. The data hash contains both the unprocessed
//              raw ajax response as well as the processed chat data
//              that is going to be used for display.
// requestFinished: DEPRECATED: best to use mapDataRefreshEnd instead
//              called after each map data request finished. Argument is
//              {success: boolean} indicated the request success or fail.
// iitcLoaded: called after IITC and all plugins loaded
// portalDetailLoaded: called when a request to load full portal detail
//              completes. guid, success, details parameters
// paneChanged  called when the current pane has changed. On desktop,
//              this only selects the current chat pane; on mobile, it
//              also switches between map, info and other panes defined
//              by plugins
window._hooks = {}
window.VALID_HOOKS = [
  'portalSelected', 'portalDetailsUpdated',
  'mapDataRefreshStart', 'mapDataEntityInject', 'mapDataRefreshEnd',
  'portalAdded', 'linkAdded', 'fieldAdded',
  'publicChatDataAvailable', 'factionChatDataAvailable',
  'requestFinished', 'nicknameClicked',
  'geoSearch', 'search', 'iitcLoaded',
  'portalDetailLoaded', 'paneChanged'];
window.runHooks = function(event, data) {
  if(VALID_HOOKS.indexOf(event) === -1) throw('Unknown event type: ' + event);
  if(!_hooks[event]) return true;
  var interrupted = false;
  $.each(_hooks[event], function(ind, callback) {
    try {
      if (callback(data) === false) {
        interrupted = true;
        return false;  //break from $.each
      }
    } catch(err) {
      console.error('error running hook '+event+', error: '+err);
      debugger;
    }
  });
  return !interrupted;
}
// helper method to allow plugins to create new hooks
window.pluginCreateHook = function(event) {
  if($.inArray(event, window.VALID_HOOKS)
< 0) {
    window.VALID_HOOKS.push(event);
  }
}
window.addHook = function(event, callback) {
  if(VALID_HOOKS.indexOf(event) === -1) {
    console.error('addHook: Unknown event type: ' + event + ' - ignoring');
    debugger;
    return;
  }
  if(typeof callback !== 'function') throw('Callback must be a function.');
  if(!_hooks[event])
    _hooks[event] = [callback];
  else
    _hooks[event].push(callback);
}
;
// IDLE HANDLING /////////////////////////////////////////////////////
window.idleTime = 0; // in seconds
window._idleTimeLimit = MAX_IDLE_TIME;
var IDLE_POLL_TIME = 10;
var idlePoll = function() {
  var wasIdle = isIdle();
  window.idleTime += IDLE_POLL_TIME;
  var hidden = (document.hidden || document.webkitHidden || document.mozHidden || document.msHidden || false);
  if (hidden) {
    window._idleTimeLimit = window.REFRESH; // set a small time limit before entering idle mode
  }
  if (!wasIdle && isIdle()) {
    console.log('idlePoll: entering idle mode');
  }
}
setInterval(idlePoll, IDLE_POLL_TIME*1000);
window.idleReset = function () {
  // update immediately when the user comes back
  if(isIdle()) {
    console.log ('idleReset: leaving idle mode');
    window.idleTime = 0;
    $.each(window._onResumeFunctions, function(ind, f) {
      f();
    });
  }
  window.idleTime = 0;
  window._idleTimeLimit = MAX_IDLE_TIME;
};
window.idleSet = function() {
  var wasIdle = isIdle();
  window._idleTimeLimit = 0; // a zero time here will cause idle to start immediately
  if (!wasIdle && isIdle()) {
    console.log ('idleSet: entering idle mode');
  }
}
// only reset idle on mouse move where the coordinates are actually different.
// some browsers send the event when not moving!
var _lastMouseX=-1, _lastMouseY=-1;
var idleMouseMove = function(e) {
  var dX = _lastMouseX-e.clientX;
  var dY = _lastMouseY-e.clientY;
  var deltaSquared = dX*dX + dY*dY;
  // only treat movements over 3 pixels as enough to reset us
  if (deltaSquared >
 3*3) {
    _lastMouseX = e.clientX;
    _lastMouseY = e.clientY;
    idleReset();
  }
}
window.setupIdle = function() {
  $('body').keypress(idleReset);
  $('body').mousemove(idleMouseMove);
}
window.isIdle = function() {
  return window.idleTime >
= window._idleTimeLimit;
}
window._onResumeFunctions = [];
// add your function here if you want to be notified when the user
// resumes from being idle
window.addResumeFunction = function(f) {
  window._onResumeFunctions.push(f);
}
;
// LOCATION HANDLING /////////////////////////////////////////////////
// i.e. setting initial position and storing new position after moving
// retrieves current position from map and stores it cookies
window.storeMapPosition = function() {
  var m = window.map.getCenter();
  if(m['lat'] >
= -90  && m['lat']
<= 90)
    writeCookie('ingress.intelmap.lat', m['lat']);
  if(m['lng'] >
= -180 && m['lng']
<= 180)
    writeCookie('ingress.intelmap.lng', m['lng']);
  writeCookie('ingress.intelmap.zoom', window.map.getZoom());
}
// either retrieves the last shown position from a cookie, from the
// URL or if neither is present, via Geolocation. If that fails, it
// returns a map that shows the whole world.
window.getPosition = function() {
  if(getURLParam('latE6') && getURLParam('lngE6')) {
    console.log("mappos: reading email URL params");
    var lat = parseInt(getURLParam('latE6'))/1E6 || 0.0;
    var lng = parseInt(getURLParam('lngE6'))/1E6 || 0.0;
    var z = parseInt(getURLParam('z')) || 17;
    return {center: new L.LatLng(lat, lng), zoom: z};
  }
  if(getURLParam('ll')) {
    console.log("mappos: reading stock Intel URL params");
    var lat = parseFloat(getURLParam('ll').split(",")[0]) || 0.0;
    var lng = parseFloat(getURLParam('ll').split(",")[1]) || 0.0;
    var z = parseInt(getURLParam('z')) || 17;
    return {center: new L.LatLng(lat, lng), zoom: z};
  }
  if(readCookie('ingress.intelmap.lat') && readCookie('ingress.intelmap.lng')) {
    console.log("mappos: reading cookies");
    var lat = parseFloat(readCookie('ingress.intelmap.lat')) || 0.0;
    var lng = parseFloat(readCookie('ingress.intelmap.lng')) || 0.0;
    var z = parseInt(readCookie('ingress.intelmap.zoom')) || 17;
    if(lat
< -90  || lat >
 90) lat = 0.0;
    if(lng
< -180 || lng >
 180) lng = 0.0;
    return {center: new L.LatLng(lat, lng), zoom: z};
  }
  setTimeout("window.map.locate({setView : true});", 50);
  return {center: new L.LatLng(0.0, 0.0), zoom: 1};
}
;
// MAP DATA REQUEST CALCULATORS //////////////////////////////////////
// Ingress Intel splits up requests for map data (portals, links,
// fields) into tiles. To get data for the current viewport (i.e. what
// is currently visible) it first calculates which tiles intersect.
// For all those tiles, it then calculates the lat/lng bounds of that
// tile and a quadkey. Both the bounds and the quadkey are “somewhat”
// required to get complete data.
//
// Conversion functions courtesy of
// http://wiki.openstreetmap.org/wiki/Slippy_map_tilenames
window.setupDataTileParams = function() {
  // default values - used to fall back to if we can't detect those used in stock intel
  var DEFAULT_ZOOM_TO_TILES_PER_EDGE = [1,1,1,40,40,80,80,320,1000,2000,2000,4000,8000,16000,16000,32000];
  var DEFAULT_ZOOM_TO_LEVEL = [8,8,8,8,7,7,7,6,6,5,4,4,3,2,2,1,1];
  // stock intel doesn't have this array (they use a switch statement instead), but this is far neater
  var DEFAULT_ZOOM_TO_LINK_LENGTH = [200000,200000,200000,200000,200000,60000,60000,10000,5000,2500,2500,800,300,0,0];
  window.TILE_PARAMS = {};
  // not in stock to detect - we'll have to assume the above values...
  window.TILE_PARAMS.ZOOM_TO_LINK_LENGTH = DEFAULT_ZOOM_TO_LINK_LENGTH;
  if (niantic_params.ZOOM_TO_LEVEL && niantic_params.TILES_PER_EDGE) {
    window.TILE_PARAMS.ZOOM_TO_LEVEL = niantic_params.ZOOM_TO_LEVEL;
    window.TILE_PARAMS.TILES_PER_EDGE = niantic_params.TILES_PER_EDGE;
    // lazy numerical array comparison
    if ( JSON.stringify(niantic_params.ZOOM_TO_LEVEL) != JSON.stringify(DEFAULT_ZOOM_TO_LEVEL)) {
      console.warn('Tile parameter ZOOM_TO_LEVEL have changed in stock intel. Detected correct values, but code should be updated');
      debugger;
    }
    if ( JSON.stringify(niantic_params.TILES_PER_EDGE) != JSON.stringify(DEFAULT_ZOOM_TO_TILES_PER_EDGE)) {
      console.warn('Tile parameter TILES_PER_EDGE have changed in stock intel. Detected correct values, but code should be updated');
      debugger;
    }
  } else {
    dialog({
      title: 'IITC Warning',
      html: "
<p>
IITC failed to detect the ZOOM_TO_LEVEL and/or TILES_PER_EDGE settings from the stock intel site.
</p>
"
           +"
<p>
IITC is now using fallback default values. However, if detection has failed it's likely the values have changed."
           +" IITC may not load the map if these default values are wrong.
</p>
",
    });
    window.TILE_PARAMS.ZOOM_TO_LEVEL = DEFAULT_ZOOM_TO_LEVEL;
    window.TILE_PARAMS.TILES_PER_EDGE = DEFAULT_ZOOM_TO_TILES_PER_EDGE;
  }
  // 2015-07-01: niantic added code to the stock site that overrides the min zoom level for unclaimed portals to 15 and above
  // instead of updating the zoom-to-level array. makes no sense really....
  // we'll just chop off the array at that point, so the code defaults to level 0 (unclaimed) everywhere...
  window.TILE_PARAMS.ZOOM_TO_LEVEL = window.TILE_PARAMS.ZOOM_TO_LEVEL.slice(0,15);
}
window.debugMapZoomParameters = function() {
  //for debug purposes, log the tile params used for each zoom level
  console.log('DEBUG: Map Zoom Parameters');
  var doneZooms = {};
  for (var z=MIN_ZOOM; z
<=21; z++) {
    var ourZoom = getDataZoomForMapZoom(z);
    console.log('DEBUG: map zoom '+z+': IITC requests '+ourZoom+(ourZoom!=z?' instead':''));
    if (!doneZooms[ourZoom]) {
      var params = getMapZoomTileParameters(ourZoom);
      var msg = 'DEBUG: data zoom '+ourZoom;
      if (params.hasPortals) {
        msg += ' has portals, L'+params.level+'+';
      } else {
        msg += ' NO portals (was L'+params.level+'+)';
      }
      msg += ', minLinkLength='+params.minLinkLength;
      msg += ', tiles per edge='+params.tilesPerEdge;
      console.log(msg);
      doneZooms[ourZoom] = true;
    }
  }
}
window.getMapZoomTileParameters = function(zoom) {
  // the current API allows the client to request a minimum portal level. the window.TILE_PARAMS.ZOOM_TO_LEVEL list are minimums
  // however, in my view, this can return excessive numbers of portals in many cases. let's try an optional reduction
  // of detail level at some zoom levels
  var level = window.TILE_PARAMS.ZOOM_TO_LEVEL[zoom] || 0;  // default to level 0 (all portals) if not in array
//  if (window.CONFIG_ZOOM_SHOW_LESS_PORTALS_ZOOMED_OUT) {
//    if (level
<= 7 && level >
= 4) {
//      // reduce portal detail level by one - helps reduce clutter
//      level = level+1;
//    }
//  }
  var maxTilesPerEdge = window.TILE_PARAMS.TILES_PER_EDGE[window.TILE_PARAMS.TILES_PER_EDGE.length-1];
  return {
    level: level,
    maxLevel: window.TILE_PARAMS.ZOOM_TO_LEVEL[zoom] || 0,  // for reference, for log purposes, etc
    tilesPerEdge: window.TILE_PARAMS.TILES_PER_EDGE[zoom] || maxTilesPerEdge,
    minLinkLength: window.TILE_PARAMS.ZOOM_TO_LINK_LENGTH[zoom] || 0,
    hasPortals: zoom >
= window.TILE_PARAMS.ZOOM_TO_LINK_LENGTH.length,  // no portals returned at all when link length limits things
    zoom: zoom  // include the zoom level, for reference
  };
}
window.getDataZoomForMapZoom = function(zoom) {
  // we can fetch data at a zoom level different to the map zoom.
  //NOTE: the specifics of this are tightly coupled with the above ZOOM_TO_LEVEL and TILES_PER_EDGE arrays
  // firstly, some of IITCs zoom levels, depending on base map layer, can be higher than stock. limit zoom level
  // (stock site max zoom may vary depending on google maps detail in the area - 20 or 21 max is common)
  if (zoom >
 21) {
    zoom = 21;
  }
  if (!window.CONFIG_ZOOM_DEFAULT_DETAIL_LEVEL) {
    // to improve the cacheing performance, we try and limit the number of zoom levels we retrieve data for
    // to avoid impacting server load, we keep ourselves restricted to a zoom level with the sane numbre
    // of tilesPerEdge and portal levels visible
    var origTileParams = getMapZoomTileParameters(zoom);
    while (zoom >
 MIN_ZOOM) {
      var newTileParams = getMapZoomTileParameters(zoom-1);
      if ( newTileParams.tilesPerEdge != origTileParams.tilesPerEdge
        || newTileParams.hasPortals != origTileParams.hasPortals
        || newTileParams.level*newTileParams.hasPortals != origTileParams.level*origTileParams.hasPortals  // multiply by 'hasPortals' bool - so comparison does not matter when no portals available
      ) {
        // switching to zoom-1 would result in a different detail level - so we abort changing things
        break;
      } else {
        // changing to zoom = zoom-1 results in identical tile parameters - so we can safely step back
        // with no increase in either server load or number of requests
        zoom = zoom-1;
      }
    }
  }
  return zoom;
}
window.lngToTile = function(lng, params) {
  return Math.floor((lng + 180) / 360 * params.tilesPerEdge);
}
window.latToTile = function(lat, params) {
  return Math.floor((1 - Math.log(Math.tan(lat * Math.PI / 180) +
    1 / Math.cos(lat * Math.PI / 180)) / Math.PI) / 2 * params.tilesPerEdge);
}
window.tileToLng = function(x, params) {
  return x / params.tilesPerEdge * 360 - 180;
}
window.tileToLat = function(y, params) {
  var n = Math.PI - 2 * Math.PI * y / params.tilesPerEdge;
  return 180 / Math.PI * Math.atan(0.5 * (Math.exp(n) - Math.exp(-n)));
}
window.pointToTileId = function(params, x, y) {
//change to quadkey construction
//as of 2014-05-06: zoom_x_y_minlvl_maxlvl_maxhealth
  return params.zoom + "_" + x + "_" + y + "_" + params.level + "_8_100";
}
window.getResonatorLatLng = function(dist, slot, portalLatLng) {
  // offset in meters
  var dn = dist*SLOT_TO_LAT[slot];
  var de = dist*SLOT_TO_LNG[slot];
  // Coordinate offset in radians
  var dLat = dn/EARTH_RADIUS;
  var dLon = de/(EARTH_RADIUS*Math.cos(Math.PI/180*portalLatLng[0]));
  // OffsetPosition, decimal degrees
  var lat0 = portalLatLng[0] + dLat * 180/Math.PI;
  var lon0 = portalLatLng[1] + dLon * 180/Math.PI;
  return [lat0, lon0];
}
;
// MAP DATA DEBUG //////////////////////////////////////
// useful bits to assist debugging map data tiles
window.RenderDebugTiles = function() {
  this.CLEAR_CHECK_TIME = L.Path.CANVAS ? 2.0 : 0.5;
  this.FADE_TIME = 2.0;
  this.debugTileLayer = L.layerGroup();
  window.addLayerGroup("DEBUG Data Tiles", this.debugTileLayer, false);
  this.debugTileToRectangle = {};
  this.debugTileClearTimes = {};
  this.timer = undefined;
}
window.RenderDebugTiles.prototype.reset = function() {
  this.debugTileLayer.clearLayers();
  this.debugTileToRectangle = {};
  this.debugTileClearTimes = {};
}
window.RenderDebugTiles.prototype.create = function(id,bounds) {
  var s = {color: '#666', weight: 2, opacity: 0.4, fillColor: '#666', fillOpacity: 0.1, clickable: false};
  var bounds = new L.LatLngBounds(bounds);
  bounds = bounds.pad(-0.02);
  var l = L.rectangle(bounds,s);
  this.debugTileToRectangle[id] = l;
  this.debugTileLayer.addLayer(l);
  if (map.hasLayer(this.debugTileLayer)) {
    // only bring to back if we have the debug layer turned on
    l.bringToBack();
  }
}
window.RenderDebugTiles.prototype.setColour = function(id,bordercol,fillcol) {
  var l = this.debugTileToRectangle[id];
  if (l) {
    var s = {color: bordercol, fillColor: fillcol};
    l.setStyle(s);
  }
}
window.RenderDebugTiles.prototype.setState = function(id,state) {
  var col = '#f0f';
  var fill = '#f0f';
  var clearDelay = -1;
  switch(state) {
    case 'ok': col='#0f0'; fill='#0f0'; clearDelay = 2; break;
    case 'error': col='#f00'; fill='#f00'; clearDelay = 30; break;
    case 'cache-fresh': col='#0f0'; fill='#ff0'; clearDelay = 2; break;
    case 'cache-stale': col='#f00'; fill='#ff0'; clearDelay = 10; break;
    case 'requested': col='#66f'; fill='#66f'; break;
    case 'retrying': col='#666'; fill='#666'; break;
    case 'request-fail': col='#a00'; fill='#666'; break;
    case 'tile-fail': col='#f00'; fill='#666'; break;
    case 'tile-timeout': col='#ff0'; fill='#666'; break;
    case 'render-queue': col='#f0f'; fill='#f0f'; break;
  }
  this.setColour (id, col, fill);
  if (clearDelay >
= 0) {
    var clearAt = Date.now() + clearDelay*1000;
    this.debugTileClearTimes[id] = clearAt;
    if (!this.timer) {
      this.startTimer(clearDelay*1000);
    }
  }
}
window.RenderDebugTiles.prototype.startTimer = function(waitTime) {
  var _this = this;
  if (!_this.timer) {
    // a timeout of 0 firing the actual timeout - helps things run smoother
    _this.timer = setTimeout ( function() {
      _this.timer = setTimeout ( function() { _this.timer = undefined; _this.runClearPass(); }, waitTime );
    }, 0);
  }
}
window.RenderDebugTiles.prototype.runClearPass = function() {
  var now = Date.now();
  for (var id in this.debugTileClearTimes) {
    var diff = now - this.debugTileClearTimes[id];
    if (diff >
 0) {
      if (diff >
 this.FADE_TIME*1000) {
        this.debugTileLayer.removeLayer(this.debugTileToRectangle[id]);
        delete this.debugTileClearTimes[id];
      } else {
        var fade = 1.0 - (diff / (this.FADE_TIME*1000));
        this.debugTileToRectangle[id].setStyle ({ opacity: 0.4*fade, fillOpacity: 0.1*fade });
      }
    }
  }
  if (Object.keys(this.debugTileClearTimes).length >
 0) {
    this.startTimer(this.CLEAR_CHECK_TIME*1000);
  }
}
;
// MAP DATA RENDER ////////////////////////////////////////////////
// class to handle rendering into leaflet the JSON data from the servers
window.Render = function() {
  this.portalMarkerScale = undefined;
}
// start a render pass. called as we start to make the batch of data requests to the servers
window.Render.prototype.startRenderPass = function(level,bounds) {
  this.isRendering = true;
  this.deletedGuid = {};  // object - represents the set of all deleted game entity GUIDs seen in a render pass
  this.seenPortalsGuid = {};
  this.seenLinksGuid = {};
  this.seenFieldsGuid = {};
  this.bounds = bounds;
  this.level = level;
  // we pad the bounds used for clearing a litle bit, as entities are sometimes returned outside of their specified tile boundaries
  // this will just avoid a few entity removals at start of render when they'll just be added again
  var paddedBounds = bounds.pad(0.1);
  this.clearPortalsOutsideBounds(paddedBounds);
  this.clearLinksOutsideBounds(paddedBounds);
  this.clearFieldsOutsideBounds(paddedBounds);
  this.rescalePortalMarkers();
}
window.Render.prototype.clearPortalsOutsideBounds = function(bounds) {
  var count = 0;
  for (var guid in window.portals) {
    var p = portals[guid];
    // clear portals outside visible bounds - unless it's the selected portal, or it's relevant to artifacts
    if (!bounds.contains(p.getLatLng()) && guid !== selectedPortal && !artifact.isInterestingPortal(guid)) {
      this.deletePortalEntity(guid);
      count++;
    }
  }
  console.log('Render: deleted '+count+' portals by level/bounds');
}
window.Render.prototype.clearLinksOutsideBounds = function(bounds) {
  var count = 0;
  for (var guid in window.links) {
    var l = links[guid];
    // NOTE: our geodesic lines can have lots of intermediate points. the bounds calculation hasn't been optimised for this
    // so can be particularly slow. a simple bounds check based on start+end point will be good enough for this check
    var lls = l.getLatLngs();
    var linkBounds = L.latLngBounds(lls);
    if (!bounds.intersects(linkBounds)) {
      this.deleteLinkEntity(guid);
      count++;
    }
  }
  console.log('Render: deleted '+count+' links by bounds');
}
window.Render.prototype.clearFieldsOutsideBounds = function(bounds) {
  var count = 0;
  for (var guid in window.fields) {
    var f = fields[guid];
    // NOTE: our geodesic polys can have lots of intermediate points. the bounds calculation hasn't been optimised for this
    // so can be particularly slow. a simple bounds check based on corner points will be good enough for this check
    var lls = f.getLatLngs();
    var fieldBounds = L.latLngBounds([lls[0],lls[1]]).extend(lls[2]);
    if (!bounds.intersects(fieldBounds)) {
      this.deleteFieldEntity(guid);
      count++;
    }
  }
  console.log('Render: deleted '+count+' fields by bounds');
}
// process deleted entity list and entity data
window.Render.prototype.processTileData = function(tiledata) {
  this.processDeletedGameEntityGuids(tiledata.deletedGameEntityGuids||[]);
  this.processGameEntities(tiledata.gameEntities||[]);
}
window.Render.prototype.processDeletedGameEntityGuids = function(deleted) {
  for(var i in deleted) {
    var guid = deleted[i];
    if ( !(guid in this.deletedGuid) ) {
      this.deletedGuid[guid] = true;  // flag this guid as having being processed
      if (guid == selectedPortal) {
        // the rare case of the selected portal being deleted. clear the details tab and deselect it
        renderPortalDetails(null);
      }
      this.deleteEntity(guid);
    }
  }
}
window.Render.prototype.processGameEntities = function(entities) {
  // we loop through the entities three times - for fields, links and portals separately
  // this is a reasonably efficient work-around for leafletjs limitations on svg render order
  for (var i in entities) {
    var ent = entities[i];
    if (ent[2][0] == 'r' && !(ent[0] in this.deletedGuid)) {
      this.createFieldEntity(ent);
    }
  }
  for (var i in entities) {
    var ent = entities[i];
    if (ent[2][0] == 'e' && !(ent[0] in this.deletedGuid)) {
      this.createLinkEntity(ent);
    }
  }
  for (var i in entities) {
    var ent = entities[i];
    if (ent[2][0] == 'p' && !(ent[0] in this.deletedGuid)) {
      this.createPortalEntity(ent);
    }
  }
}
// end a render pass. does any cleaning up required, postponed processing of data, etc. called when the render
// is considered complete
window.Render.prototype.endRenderPass = function() {
  var countp=0,countl=0,countf=0;
  // check to see if there are any entities we haven't seen. if so, delete them
  for (var guid in window.portals) {
    // special case for selected portal - it's kept even if not seen
    // artifact (e.g. jarvis shard) portals are also kept - but they're always 'seen'
    if (!(guid in this.seenPortalsGuid) && guid !== selectedPortal) {
      this.deletePortalEntity(guid);
      countp++;
    }
  }
  for (var guid in window.links) {
    if (!(guid in this.seenLinksGuid)) {
      this.deleteLinkEntity(guid);
      countl++;
    }
  }
  for (var guid in window.fields) {
    if (!(guid in this.seenFieldsGuid)) {
      this.deleteFieldEntity(guid);
      countf++;
    }
  }
  console.log('Render: end cleanup: removed '+countp+' portals, '+countl+' links, '+countf+' fields');
  // reorder portals to be after links/fields
  this.bringPortalsToFront();
  this.isRendering = false;
  // re-select the selected portal, to re-render the side-bar. ensures that any data calculated from the map data is up to date
  if (selectedPortal) {
    renderPortalDetails (selectedPortal);
  }
}
window.Render.prototype.bringPortalsToFront = function() {
  for (var lvl in portalsFactionLayers) {
    // portals are stored in separate layers per faction
    // to avoid giving weight to one faction or another, we'll push portals to front based on GUID order
    var lvlPortals = {};
    for (var fac in portalsFactionLayers[lvl]) {
      var layer = portalsFactionLayers[lvl][fac];
      if (layer._map) {
        layer.eachLayer (function(p) {
          lvlPortals[p.options.guid] = p;
        });
      }
    }
    var guids = Object.keys(lvlPortals);
    guids.sort();
    for (var j in guids) {
      var guid = guids[j];
      lvlPortals[guid].bringToFront();
    }
  }
  // artifact portals are always brought to the front, above all others
  $.each(artifact.getInterestingPortals(), function(i,guid) {
    if (portals[guid] && portals[guid]._map) {
      portals[guid].bringToFront();
    }
  });
}
window.Render.prototype.deleteEntity = function(guid) {
  this.deletePortalEntity(guid);
  this.deleteLinkEntity(guid);
  this.deleteFieldEntity(guid);
}
window.Render.prototype.deletePortalEntity = function(guid) {
  if (guid in window.portals) {
    var p = window.portals[guid];
    window.ornaments.removePortal(p);
    this.removePortalFromMapLayer(p);
    delete window.portals[guid];
  }
}
window.Render.prototype.deleteLinkEntity = function(guid) {
  if (guid in window.links) {
    var l = window.links[guid];
    linksFactionLayers[l.options.team].removeLayer(l);
    delete window.links[guid];
  }
}
window.Render.prototype.deleteFieldEntity = function(guid) {
  if (guid in window.fields) {
    var f = window.fields[guid];
    var fd = f.options.details;
    fieldsFactionLayers[f.options.team].removeLayer(f);
    delete window.fields[guid];
  }
}
window.Render.prototype.createPlaceholderPortalEntity = function(guid,latE6,lngE6,team) {
  // intel no longer returns portals at anything but the closest zoom
  // stock intel creates 'placeholder' portals from the data in links/fields - IITC needs to do the same
  // we only have the portal guid, lat/lng coords, and the faction - no other data
  // having the guid, at least, allows the portal details to be loaded once it's selected. however,
  // no highlighters, portal level numbers, portal names, useful counts of portals, etc are possible
  var ent = [
    guid,       //ent[0] = guid
    0,          //ent[1] = timestamp - zero will mean any other source of portal data will have a higher timestamp
                //ent[2] = an array with the entity data
    [ 'p',      //0 - a portal
      team,     //1 - team
      latE6,    //2 - lat
      lngE6     //3 - lng
    ]
  ];
  this.createPortalEntity(ent);
}
window.Render.prototype.createPortalEntity = function(ent) {
  this.seenPortalsGuid[ent[0]] = true;  // flag we've seen it
  var previousData = undefined;
  // check if entity already exists
  if (ent[0] in window.portals) {
    // yes. now check to see if the entity data we have is newer than that in place
    var p = window.portals[ent[0]];
    if (p.options.timestamp >
= ent[1]) return; // this data is identical or older - abort processing
    // the data we have is newer. many data changes require re-rendering of the portal
    // (e.g. level changed, so size is different, or stats changed so highlighter is different)
    // so to keep things simple we'll always re-create the entity in this case
    // remember the old details, for the callback
    previousData = p.options.data;
    this.deletePortalEntity(ent[0]);
  }
  var portalLevel = parseInt(ent[2][4])||0;
  var team = teamStringToId(ent[2][1]);
  // the data returns unclaimed portals as level 1 - but IITC wants them treated as level 0
  if (team == TEAM_NONE) portalLevel = 0;
  var latlng = L.latLng(ent[2][2]/1E6, ent[2][3]/1E6);
  var data = decodeArray.portalSummary(ent[2]);
  var dataOptions = {
    level: portalLevel,
    team: team,
    ent: ent,  // LEGACY - TO BE REMOVED AT SOME POINT! use .guid, .timestamp and .data instead
    guid: ent[0],
    timestamp: ent[1],
    data: data
  };
  window.pushPortalGuidPositionCache(ent[0], data.latE6, data.lngE6);
  var marker = createMarker(latlng, dataOptions);
  marker.on('click', function() { window.renderPortalDetails(ent[0]); });
  marker.on('dblclick', function() { window.renderPortalDetails(ent[0]); window.map.setView(latlng, 17); });
  window.runHooks('portalAdded', {portal: marker, previousData: previousData});
  window.portals[ent[0]] = marker;
  // check for URL links to portal, and select it if this is the one
  if (urlPortalLL && urlPortalLL[0] == marker.getLatLng().lat && urlPortalLL[1] == marker.getLatLng().lng) {
    // URL-passed portal found via pll parameter - set the guid-based parameter
    console.log('urlPortalLL '+urlPortalLL[0]+','+urlPortalLL[1]+' matches portal GUID '+ent[0]);
    urlPortal = ent[0];
    urlPortalLL = undefined;  // clear the URL parameter so it's not matched again
  }
  if (urlPortal == ent[0]) {
    // URL-passed portal found via guid parameter - set it as the selected portal
    console.log('urlPortal GUID '+urlPortal+' found - selecting...');
    selectedPortal = ent[0];
    urlPortal = undefined;  // clear the URL parameter so it's not matched again
  }
  // (re-)select the portal, to refresh the sidebar on any changes
  if (ent[0] == selectedPortal) {
    console.log('portal guid '+ent[0]+' is the selected portal - re-rendering portal details');
    renderPortalDetails (selectedPortal);
  }
  window.ornaments.addPortal(marker);
  //TODO? postpone adding to the map layer
  this.addPortalToMapLayer(marker);
}
window.Render.prototype.createFieldEntity = function(ent) {
  this.seenFieldsGuid[ent[0]] = true;  // flag we've seen it
  var data = {
//    type: ent[2][0],
    team: ent[2][1],
    points: ent[2][2].map(function(arr) { return {guid: arr[0], latE6: arr[1], lngE6: arr[2] }; })
  };
  //create placeholder portals for field corners. we already do links, but there are the odd case where this is useful
  for (var i=0; i
<3; i++) {
    var p=data.points[i];
    this.createPlaceholderPortalEntity(p.guid, p.latE6, p.lngE6, data.team);
  }
  // check if entity already exists
  if(ent[0] in window.fields) {
    // yes. in theory, we should never get updated data for an existing field. they're created, and they're destroyed - never changed
    // but theory and practice may not be the same thing...
    var f = window.fields[ent[0]];
    if (f.options.timestamp >
= ent[1]) return; // this data is identical (or order) than that rendered - abort processing
    // the data we have is newer - two options
    // 1. just update the data, assume the field render appearance is unmodified
    // 2. delete the entity, then re-create with the new data
    this.deleteFieldEntity(ent[0]); // option 2, for now
  }
  var team = teamStringToId(ent[2][1]);
  var latlngs = [
    L.latLng(data.points[0].latE6/1E6, data.points[0].lngE6/1E6),
    L.latLng(data.points[1].latE6/1E6, data.points[1].lngE6/1E6),
    L.latLng(data.points[2].latE6/1E6, data.points[2].lngE6/1E6)
  ];
  var poly = L.geodesicPolygon(latlngs, {
    fillColor: COLORS[team],
    fillOpacity: 0.25,
    stroke: false,
    clickable: false,
    team: team,
    ent: ent,  // LEGACY - TO BE REMOVED AT SOME POINT! use .guid, .timestamp and .data instead
    guid: ent[0],
    timestamp: ent[1],
    data: data,
  });
  runHooks('fieldAdded',{field: poly});
  window.fields[ent[0]] = poly;
  // TODO? postpone adding to the layer??
  fieldsFactionLayers[poly.options.team].addLayer(poly);
}
window.Render.prototype.createLinkEntity = function(ent,faked) {
  // Niantic have been faking link entities, based on data from fields
  // these faked links are sent along with the real portal links, causing duplicates
  // the faked ones all have longer GUIDs, based on the field GUID (with _ab, _ac, _bc appended)
  var fakedLink = new RegExp("^[0-9a-f]{32}\.b_[ab][bc]$"); //field GUIDs always end with ".b" - faked links append the edge identifier
  if (fakedLink.test(ent[0])) return;
  this.seenLinksGuid[ent[0]] = true;  // flag we've seen it
  var data = { // TODO add other properties and check correction direction
//    type:   ent[2][0],
    team:   ent[2][1],
    oGuid:  ent[2][2],
    oLatE6: ent[2][3],
    oLngE6: ent[2][4],
    dGuid:  ent[2][5],
    dLatE6: ent[2][6],
    dLngE6: ent[2][7]
  };
  // create placeholder entities for link start and end points (before checking if the link itself already exists
  this.createPlaceholderPortalEntity(data.oGuid, data.oLatE6, data.oLngE6, data.team);
  this.createPlaceholderPortalEntity(data.dGuid, data.dLatE6, data.dLngE6, data.team);
  // check if entity already exists
  if (ent[0] in window.links) {
    // yes. now, as sometimes links are 'faked', they have incomplete data. if the data we have is better, replace the data
    var l = window.links[ent[0]];
    // the faked data will have older timestamps than real data (currently, faked set to zero)
    if (l.options.timestamp >
= ent[1]) return; // this data is older or identical to the rendered data - abort processing
    // the data is newer/better - two options
    // 1. just update the data. assume the link render appearance is unmodified
    // 2. delete the entity, then re-create it with the new data
    this.deleteLinkEntity(ent[0]); // option 2 - for now
  }
  var team = teamStringToId(ent[2][1]);
  var latlngs = [
    L.latLng(data.oLatE6/1E6, data.oLngE6/1E6),
    L.latLng(data.dLatE6/1E6, data.dLngE6/1E6)
  ];
  var poly = L.geodesicPolyline(latlngs, {
    color: COLORS[team],
    opacity: 1,
    weight: faked ? 1 : 2,
    clickable: false,
    team: team,
    ent: ent,  // LEGACY - TO BE REMOVED AT SOME POINT! use .guid, .timestamp and .data instead
    guid: ent[0],
    timestamp: ent[1],
    data: data
  });
  runHooks('linkAdded', {link: poly});
  window.links[ent[0]] = poly;
  linksFactionLayers[poly.options.team].addLayer(poly);
}
window.Render.prototype.rescalePortalMarkers = function() {
  if (this.portalMarkerScale === undefined || this.portalMarkerScale != portalMarkerScale()) {
    this.portalMarkerScale = portalMarkerScale();
    console.log('Render: map zoom '+map.getZoom()+' changes portal scale to '+portalMarkerScale()+' - redrawing all portals');
    //NOTE: we're not calling this because it resets highlights - we're calling it as it
    // resets the style (inc size) of all portal markers, applying the new scale
    resetHighlightedPortals();
  }
}
// add the portal to the visible map layer
window.Render.prototype.addPortalToMapLayer = function(portal) {
  portalsFactionLayers[parseInt(portal.options.level)||0][portal.options.team].addLayer(portal);
}
window.Render.prototype.removePortalFromMapLayer = function(portal) {
  //remove it from the portalsLevels layer
  portalsFactionLayers[parseInt(portal.options.level)||0][portal.options.team].removeLayer(portal);
}
;
// MAP DATA REQUEST ///////////////////////////////////////////////////
// class to request the map data tiles from the Ingress servers
// and then pass it on to the render class for display purposes
// Uses the map data cache class to reduce network requests
window.MapDataRequest = function() {
  this.cache = new DataCache();
  this.render = new Render();
  this.debugTiles = new RenderDebugTiles();
  this.activeRequestCount = 0;
  this.requestedTiles = {};
  this.renderQueue = [];
  this.renderQueueTimer = undefined;
  this.renderQueuePaused = false;
  this.idle = false;
  // no more than this many requests in parallel. stock site seems to rely on browser limits (6, usually), sending
  // many requests at once.
  // using our own queue limit ensures that other requests (e.g. chat, portal details) don't get delayed
  this.MAX_REQUESTS = 5;
  // this many tiles in one request
  this.NUM_TILES_PER_REQUEST = 25;
  // number of times to retry a tile after an error (including "error: TIMEOUT" now - as stock intel does)
  // TODO? different retry counters for TIMEOUT vs other errors..?
  this.MAX_TILE_RETRIES = 5;
  // refresh timers
  this.MOVE_REFRESH = 3; //time, after a map move (pan/zoom) before starting the refresh processing
  this.STARTUP_REFRESH = 3; //refresh time used on first load of IITC
  this.IDLE_RESUME_REFRESH = 5; //refresh time used after resuming from idle
  // after one of the above, there's an additional delay between preparing the refresh (clearing out of bounds,
  // processing cache, etc) and actually sending the first network requests
  this.DOWNLOAD_DELAY = 1;  //delay after preparing the data download before tile requests are sent
  // a short delay between one request finishing and the queue being run for the next request.
  this.RUN_QUEUE_DELAY = 0;
  // delay before processing the queue after failed requests
  this.BAD_REQUEST_RUN_QUEUE_DELAY = 5; // longer delay before doing anything after errors (other than TIMEOUT)
  // delay before processing the queue after empty responses
  this.EMPTY_RESPONSE_RUN_QUEUE_DELAY = 5; // also long delay - empty responses are likely due to some server issues
  // delay before processing the queue after error==TIMEOUT requests. this is 'expected', so minimal extra delay over the regular RUN_QUEUE_DELAY
  this.TIMEOUT_REQUEST_RUN_QUEUE_DELAY = 0;
  // render queue
  // number of items to process in each render pass. there are pros and cons to smaller and larger values
  // (however, if using leaflet canvas rendering, it makes sense to push as much as possible through every time)
  this.RENDER_BATCH_SIZE = L.Path.CANVAS ? 1E9 : 1500;
  // delay before repeating the render loop. this gives a better chance for user interaction
  this.RENDER_PAUSE = (typeof android === 'undefined') ? 0.1 : 0.2; //100ms desktop, 200ms mobile
  this.REFRESH_CLOSE = 300;  // refresh time to use for close views z>
12 when not idle and not moving
  this.REFRESH_FAR = 900;  // refresh time for far views z
<= 12
  this.FETCH_TO_REFRESH_FACTOR = 2;  //minumum refresh time is based on the time to complete a data fetch, times this value
  // ensure we have some initial map status
  this.setStatus ('startup', undefined, -1);
  // add a portalDetailLoaded hook, so we can use the exteneed details to update portals on the map
  var _this = this;
  addHook('portalDetailLoaded',function(data){
    _this.render.processGameEntities([data.ent]);
  });
}
window.MapDataRequest.prototype.start = function() {
  var savedContext = this;
  // setup idle resume function
  window.addResumeFunction ( function() { savedContext.idleResume(); } );
  // and map move start/end callbacks
  window.map.on('movestart', this.mapMoveStart, this);
  window.map.on('moveend', this.mapMoveEnd, this);
  // then set a timeout to start the first refresh
  this.refreshOnTimeout (this.STARTUP_REFRESH);
  this.setStatus ('refreshing', undefined, -1);
  this.cache && this.cache.startExpireInterval (15);
}
window.MapDataRequest.prototype.mapMoveStart = function() {
  console.log('refresh map movestart');
  this.setStatus('paused');
  this.clearTimeout();
  this.pauseRenderQueue(true);
}
window.MapDataRequest.prototype.mapMoveEnd = function() {
  var bounds = clampLatLngBounds(map.getBounds());
  var zoom = map.getZoom();
  if (this.fetchedDataParams) {
    // we have fetched (or are fetching) data...
    if (this.fetchedDataParams.mapZoom == map.getZoom() && this.fetchedDataParams.bounds.contains(bounds)) {
      // ... and the zoom level is the same and the current bounds is inside the fetched bounds
      // so, no need to fetch data. if there's time left, restore the original timeout
      var remainingTime = (this.timerExpectedTimeoutTime - new Date().getTime())/1000;
      if (remainingTime >
 this.MOVE_REFRESH) {
        this.setStatus('done','Map moved, but no data updates needed');
        this.refreshOnTimeout(remainingTime);
        this.pauseRenderQueue(false);
        return;
      }
    }
  }
  this.setStatus('refreshing', undefined, -1);
  this.refreshOnTimeout(this.MOVE_REFRESH);
}
window.MapDataRequest.prototype.idleResume = function() {
  // if we have no timer set and there are no active requests, refresh has gone idle and the timer needs restarting
  if (this.idle) {
    console.log('refresh map idle resume');
    this.idle = false;
    this.setStatus('idle restart', undefined, -1);
    this.refreshOnTimeout(this.IDLE_RESUME_REFRESH);
  }
}
window.MapDataRequest.prototype.clearTimeout = function() {
  if (this.timer) {
    console.log('cancelling existing map refresh timer');
    clearTimeout(this.timer);
    this.timer = undefined;
  }
}
window.MapDataRequest.prototype.refreshOnTimeout = function(seconds) {
  this.clearTimeout();
  console.log('starting map refresh in '+seconds+' seconds');
  // 'this' won't be right inside the callback, so save it
  // also, double setTimeout used to ensure the delay occurs after any browser-related rendering/updating/etc
  var _this = this;
  this.timer = setTimeout ( function() {
    _this.timer = setTimeout ( function() { _this.timer = undefined; _this.refresh(); }, seconds*1000);
  }, 0);
  this.timerExpectedTimeoutTime = new Date().getTime() + seconds*1000;
}
window.MapDataRequest.prototype.setStatus = function(short,long,progress) {
  this.status = { short: short, long: long, progress: progress };
  window.renderUpdateStatus();
}
window.MapDataRequest.prototype.getStatus = function() {
  return this.status;
};
window.MapDataRequest.prototype.refresh = function() {
  // if we're idle, don't refresh
  if (window.isIdle()) {
    console.log('suspending map refresh - is idle');
    this.setStatus ('idle');
    this.idle = true;
    return;
  }
  //time the refresh cycle
  this.refreshStartTime = new Date().getTime();
  this.debugTiles.reset();
  this.resetRenderQueue();
  // a 'set' to keep track of hard failures for tiles
  this.tileErrorCount = {};
  // the 'set' of requested tile QKs
  // NOTE: javascript does not guarantee any order to properties of an object. however, in all major implementations
  // properties retain the order they are added in. IITC uses this to control the tile fetch order. if browsers change
  // then fetch order isn't optimal, but it won't break things.
  this.queuedTiles = {};
  var bounds = clampLatLngBounds(map.getBounds());
  var mapZoom = map.getZoom();
  var dataZoom = getDataZoomForMapZoom(mapZoom);
  var tileParams = getMapZoomTileParameters(dataZoom);
//DEBUG: resize the bounds so we only retrieve some data
//bounds = bounds.pad(-0.4);
//var debugrect = L.rectangle(bounds,{color: 'red', fill: false, weight: 4, opacity: 0.8}).addTo(map);
//setTimeout (function(){ map.removeLayer(debugrect); }, 10*1000);
  var x1 = lngToTile(bounds.getWest(), tileParams);
  var x2 = lngToTile(bounds.getEast(), tileParams);
  var y1 = latToTile(bounds.getNorth(), tileParams);
  var y2 = latToTile(bounds.getSouth(), tileParams);
  // calculate the full bounds for the data - including the part of the tiles off the screen edge
  var dataBounds = L.latLngBounds([
    [tileToLat(y2+1,tileParams), tileToLng(x1,tileParams)],
    [tileToLat(y1,tileParams), tileToLng(x2+1,tileParams)]
  ]);
//var debugrect2 = L.rectangle(dataBounds,{color: 'magenta', fill: false, weight: 4, opacity: 0.8}).addTo(map);
//setTimeout (function(){ map.removeLayer(debugrect2); }, 10*1000);
  // store the parameters used for fetching the data. used to prevent unneeded refreshes after move/zoom
  this.fetchedDataParams = { bounds: dataBounds, mapZoom: mapZoom, dataZoom: dataZoom };
  window.runHooks ('mapDataRefreshStart', {bounds: bounds, mapZoom: mapZoom, dataZoom: dataZoom, minPortalLevel: tileParams.level, tileBounds: dataBounds});
  this.render.startRenderPass(tileParams.level, dataBounds);
  var _render = this.render;
  window.runHooks ('mapDataEntityInject', {callback: function(ents) { _render.processGameEntities(ents);}});
  this.render.processGameEntities(artifact.getArtifactEntities());
  var logMessage = 'requesting data tiles at zoom '+dataZoom;
  if (tileParams.level != tileParams.maxLevel) {
    logMessage += ' (L'+tileParams.level+'+ portals - could have done L'+tileParams.maxLevel+'+';
  } else {
    logMessage += ' (L'+tileParams.level+'+ portals';
  }
  logMessage += ', '+tileParams.tilesPerEdge+' tiles per global edge), map zoom is '+mapZoom;
  console.log(logMessage);
  this.cachedTileCount = 0;
  this.requestedTileCount = 0;
  this.successTileCount = 0;
  this.failedTileCount = 0;
  this.staleTileCount = 0;
  var tilesToFetchDistance = {};
  // map center point - for fetching center tiles first
  var mapCenterPoint = map.project(map.getCenter(), mapZoom);
  // y goes from left to right
  for (var y = y1; y
<= y2; y++) {
    // x goes from bottom to top(?)
    for (var x = x1; x
<= x2; x++) {
      var tile_id = pointToTileId(tileParams, x, y);
      var latNorth = tileToLat(y,tileParams);
      var latSouth = tileToLat(y+1,tileParams);
      var lngWest = tileToLng(x,tileParams);
      var lngEast = tileToLng(x+1,tileParams);
      this.debugTiles.create(tile_id,[[latSouth,lngWest],[latNorth,lngEast]]);
//TODO: with recent backend changes there are now multiple zoom levels of data that is identical except perhaps for some
// reduction of detail when zoomed out. to take good advantage of the cache, a check for cached data at a closer zoom
// but otherwise the same parameters (min portal level, tiles per edge) will mean less downloads when zooming out
// (however, the default code in getDataZoomForMapZoom currently reduces the need for this, as it forces the furthest
//  out zoom tiles for a detail level)
      if (this.cache && this.cache.isFresh(tile_id) ) {
        // data is fresh in the cache - just render it
        this.pushRenderQueue(tile_id,this.cache.get(tile_id),'cache-fresh');
        this.cachedTileCount += 1;
      } else {
        // no fresh data
        // tile needed. calculate the distance from the centre of the screen, to optimise the load order
        var latCenter = (latNorth+latSouth)/2;
        var lngCenter = (lngEast+lngWest)/2;
        var tileLatLng = L.latLng(latCenter,lngCenter);
        var tilePoint = map.project(tileLatLng, mapZoom);
        var delta = mapCenterPoint.subtract(tilePoint);
        var distanceSquared = delta.x*delta.x + delta.y*delta.y;
        tilesToFetchDistance[tile_id] = distanceSquared;
        this.requestedTileCount += 1;
      }
    }
  }
  // re-order the tile list by distance from the centre of the screen. this should load more relevant data first
  var tilesToFetch = Object.keys(tilesToFetchDistance);
  tilesToFetch.sort(function(a,b) {
    return tilesToFetchDistance[a]-tilesToFetchDistance[b];
  });
  for (var i in tilesToFetch) {
    var qk = tilesToFetch[i];
    this.queuedTiles[qk] = qk;
  }
  this.setStatus ('loading', undefined, -1);
  // technically a request hasn't actually finished - however, displayed portal data has been refreshed
  // so as far as plugins are concerned, it should be treated as a finished request
  window.runHooks('requestFinished', {success: true});
  console.log ('done request preparation (cleared out-of-bounds and invalid for zoom, and rendered cached data)');
  if (Object.keys(this.queuedTiles).length >
 0) {
    // queued requests - don't start processing the download queue immediately - start it after a short delay
    this.delayProcessRequestQueue (this.DOWNLOAD_DELAY,true);
  } else {
    // all data was from the cache, nothing queued - run the queue 'immediately' so it handles the end request processing
    this.delayProcessRequestQueue (0,true);
  }
}
window.MapDataRequest.prototype.delayProcessRequestQueue = function(seconds,isFirst) {
  if (this.timer === undefined) {
    var _this = this;
    this.timer = setTimeout ( function() {
      _this.timer = setTimeout ( function() { _this.timer = undefined; _this.processRequestQueue(isFirst); }, seconds*1000 );
    }, 0);
  }
}
window.MapDataRequest.prototype.processRequestQueue = function(isFirstPass) {
  // if nothing left in the queue, finish
  if (Object.keys(this.queuedTiles).length == 0) {
    // we leave the renderQueue code to handle ending the render pass now
    // (but we need to make sure it's not left without it's timer running!)
    if (!this.renderQueuePaused) {
      this.startQueueTimer(this.RENDER_PAUSE);
    }
    return;
  }
  // create a list of tiles that aren't requested over the network
  var pendingTiles = [];
  for (var id in this.queuedTiles) {
    if (!(id in this.requestedTiles) ) {
      pendingTiles.push(id);
    }
  }
//  console.log('- request state: '+Object.keys(this.requestedTiles).length+' tiles in '+this.activeRequestCount+' active requests, '+pendingTiles.length+' tiles queued');
  var requestBuckets = this.MAX_REQUESTS - this.activeRequestCount;
  if (pendingTiles.length >
 0 && requestBuckets >
 0) {
    for (var bucket=0; bucket
< requestBuckets; bucket++) {
      // if the tiles for this request have had several retries, use smaller requests
      // maybe some of the tiles caused all the others to error? no harm anyway, and it may help...
      var numTilesThisRequest = Math.min(this.NUM_TILES_PER_REQUEST,pendingTiles.length);
      var id = pendingTiles[0];
      var retryTotal = (this.tileErrorCount[id]||0);
      for (var i=1; i
<numTilesThisRequest; i++) {
        id = pendingTiles[i];
        retryTotal += (this.tileErrorCount[id]||0);
        if (retryTotal >
 this.MAX_TILE_RETRIES) {
          numTilesThisRequest = i;
          break;
        }
      }
      var tiles = pendingTiles.splice(0, numTilesThisRequest);
      if (tiles.length >
 0) {
        this.sendTileRequest(tiles);
      }
    }
  }
  // update status
  var pendingTileCount = this.requestedTileCount - (this.successTileCount+this.failedTileCount+this.staleTileCount);
  var longText = 'Tiles: ' + this.cachedTileCount + ' cached, ' +
                 this.successTileCount + ' loaded, ' +
                 (this.staleTileCount ? this.staleTileCount + ' stale, ' : '') +
                 (this.failedTileCount ? this.failedTileCount + ' failed, ' : '') +
                 pendingTileCount + ' remaining';
  progress = this.requestedTileCount >
 0 ? (this.requestedTileCount-pendingTileCount) / this.requestedTileCount : undefined;
  this.setStatus ('loading', longText, progress);
}
window.MapDataRequest.prototype.sendTileRequest = function(tiles) {
  var tilesList = [];
  for (var i in tiles) {
    var id = tiles[i];
    this.debugTiles.setState (id, 'requested');
    this.requestedTiles[id] = true;
    if (id in this.queuedTiles) {
      tilesList.push (id);
    } else {
      console.warn('no queue entry for tile id '+id);
    }
  }
  var data = { tileKeys: tilesList };
  this.activeRequestCount += 1;
  var savedThis = this;
  // NOTE: don't add the request with window.request.add, as we don't want the abort handling to apply to map data any more
  window.postAjax('getEntities', data,
    function(data, textStatus, jqXHR) { savedThis.handleResponse (data, tiles, true); },  // request successful callback
    function() { savedThis.handleResponse (undefined, tiles, false); }  // request failed callback
  );
}
window.MapDataRequest.prototype.requeueTile = function(id, error) {
  if (id in this.queuedTiles) {
    // tile is currently wanted...
    // first, see if the error can be ignored due to retry counts
    if (error) {
      this.tileErrorCount[id] = (this.tileErrorCount[id]||0)+1;
      if (this.tileErrorCount[id]
<= this.MAX_TILE_RETRIES) {
        // retry limit low enough - clear the error flag
        error = false;
      }
    }
    if (error) {
      // if error is still true, retry limit hit. use stale data from cache if available
      var data = this.cache ? this.cache.get(id) : undefined;
      if (data) {
        // we have cached data - use it, even though it's stale
        this.pushRenderQueue(id,data,'cache-stale');
        this.staleTileCount += 1;
      } else {
        // no cached data
        this.debugTiles.setState (id, 'error');
        this.failedTileCount += 1;
      }
      // and delete from the pending requests...
      delete this.queuedTiles[id];
    } else {
      // if false, was a 'timeout' or we're retrying, so unlimited retries (as the stock site does)
      this.debugTiles.setState (id, 'retrying');
      // FIXME? it's nice to move retried tiles to the end of the request queue. however, we don't actually have a
      // proper queue, just an object with guid as properties. Javascript standards don't guarantee the order of properties
      // within an object. however, all current browsers do keep property order, and new properties are added at the end.
      // therefore, delete and re-add the requeued tile and it will be added to the end of the queue
      delete this.queuedTiles[id];
      this.queuedTiles[id] = id;
    }
  } // else the tile wasn't currently wanted (an old non-cancelled request) - ignore
}
window.MapDataRequest.prototype.handleResponse = function (data, tiles, success) {
  this.activeRequestCount -= 1;
  var successTiles = [];
  var errorTiles = [];
  var retryTiles = [];
  var timeoutTiles = [];
  var unaccountedTiles = tiles.slice(0); // Clone
  if (!success || !data || !data.result) {
    console.warn('Request.handleResponse: request failed - requeuing...'+(data && data.error?' error: '+data.error:''));
    //request failed - requeue all the tiles(?)
    if (data && data.error && data.error == 'RETRY') {
      // the server can sometimes ask us to retry a request. this is botguard related, I believe
      for (var i in tiles) {
        var id = tiles[i];
        retryTiles.push(id);
        this.debugTiles.setState (id, 'retrying');
      }
      window.runHooks('requestFinished', {success: false});
    } else {
      for (var i in tiles) {
        var id = tiles[i];
        errorTiles.push(id);
        this.debugTiles.setState (id, 'request-fail');
      }
      window.runHooks('requestFinished', {success: false});
    }
    unaccountedTiles = [];
  } else {
    // TODO: use result.minLevelOfDetail ??? stock site doesn't use it yet...
    var m = data.result.map;
    for (var id in m) {
      var val = m[id];
      unaccountedTiles.splice(unaccountedTiles.indexOf(id), 1);
      if ('error' in val) {
        // server returned an error for this individual data tile
        if (val.error == "TIMEOUT") {
          // TIMEOUT errors for individual tiles are quite common. used to be unlimited retries, but not any more
          timeoutTiles.push (id);
        } else {
          console.warn('map data tile '+id+' failed: error=='+val.error);
          errorTiles.push (id);
          this.debugTiles.setState (id, 'tile-fail');
        }
      } else {
        // no error for this data tile - process it
        successTiles.push (id);
        // store the result in the cache
        this.cache && this.cache.store (id, val);
        // if this tile was in the render list, render it
        // (requests aren't aborted when new requests are started, so it's entirely possible we don't want to render it!)
        if (id in this.queuedTiles) {
          this.pushRenderQueue(id,val,'ok');
          delete this.queuedTiles[id];
          this.successTileCount += 1;
        } // else we don't want this tile (from an old non-cancelled request) - ignore
      }
    }
    // TODO? check for any requested tiles in 'tiles' not being mentioned in the response - and handle as if it's a 'timeout'?
    window.runHooks('requestFinished', {success: true});
  }
  // set the queue delay based on any errors or timeouts
  // NOTE: retryTimes are retried at the regular delay - no longer wait as for error/timeout cases
  var nextQueueDelay = errorTiles.length >
 0 ? this.BAD_REQUEST_RUN_QUEUE_DELAY :
                       unaccountedTiles.length >
 0 ? this.EMPTY_RESPONSE_RUN_QUEUE_DELAY :
                       timeoutTiles.length >
 0 ? this.TIMEOUT_REQUEST_RUN_QUEUE_DELAY :
                       this.RUN_QUEUE_DELAY;
  var statusMsg = 'getEntities status: '+tiles.length+' tiles: ';
  statusMsg += successTiles.length+' successful';
  if (retryTiles.length) statusMsg += ', '+retryTiles.length+' retried';
  if (timeoutTiles.length) statusMsg += ', '+timeoutTiles.length+' timed out';
  if (errorTiles.length) statusMsg += ', '+errorTiles.length+' failed';
  if (unaccountedTiles.length) statusMsg += ', '+unaccountedTiles.length+' unaccounted';
  statusMsg += '. delay '+nextQueueDelay+' seconds';
  console.log (statusMsg);
  // requeue any 'timeout' tiles immediately
  if (timeoutTiles.length >
 0) {
    for (var i in timeoutTiles) {
      var id = timeoutTiles[i];
      delete this.requestedTiles[id];
      this.requeueTile(id, true);
    }
  }
  if (retryTiles.length >
 0) {
    for (var i in retryTiles) {
      var id = retryTiles[i];
      delete this.requestedTiles[id];
      this.requeueTile(id, false);  //tiles from a error==RETRY request are requeued without counting it as an error
    }
  }
  if (errorTiles.length >
 0) {
    for (var i in errorTiles) {
      var id = errorTiles[i];
      delete this.requestedTiles[id];
      this.requeueTile(id, true);
    }
  }
  if (unaccountedTiles.length >
 0) {
    for (var i in unaccountedTiles) {
      var id = unaccountedTiles[i];
      delete this.requestedTiles[id];
      this.requeueTile(id, true);
    }
  }
  for (var i in successTiles) {
    var id = successTiles[i];
    delete this.requestedTiles[id];
  }
  this.delayProcessRequestQueue(nextQueueDelay);
}
window.MapDataRequest.prototype.resetRenderQueue = function() {
  this.renderQueue = [];
  if (this.renderQueueTimer) {
    clearTimeout(this.renderQueueTimer);
    this.renderQueueTimer = undefined;
  }
  this.renderQueuePaused = false;
}
window.MapDataRequest.prototype.pushRenderQueue = function (id, data, status) {
  this.debugTiles.setState(id,'render-queue');
  this.renderQueue.push({
    id:id,
    // the data in the render queue is modified as we go, so we need to copy the values of the arrays. just storing the reference would modify the data in the cache!
    deleted: (data.deletedGameEntityGuids||[]).slice(0),
    entities: (data.gameEntities||[]).slice(0),
    status:status});
  if (!this.renderQueuePaused) {
    this.startQueueTimer(this.RENDER_PAUSE);
  }
}
window.MapDataRequest.prototype.startQueueTimer = function(delay) {
  if (this.renderQueueTimer === undefined) {
    var _this = this;
    this.renderQueueTimer = setTimeout( function() {
      _this.renderQueueTimer = setTimeout ( function() { _this.renderQueueTimer = undefined; _this.processRenderQueue(); }, (delay||0)*1000 );
    }, 0);
  }
}
window.MapDataRequest.prototype.pauseRenderQueue = function(pause) {
  this.renderQueuePaused = pause;
  if (pause) {
    if (this.renderQueueTimer) {
      clearTimeout(this.renderQueueTimer);
      this.renderQueueTimer = undefined;
    }
  } else {
    if (this.renderQueue.length >
 0) {
      this.startQueueTimer(this.RENDER_PAUSE);
    }
  }
}
window.MapDataRequest.prototype.processRenderQueue = function() {
  var drawEntityLimit = this.RENDER_BATCH_SIZE;
//TODO: we don't take account of how many of the entities are actually new/removed - they
// could already be drawn and not changed. will see how it works like this...
  while (drawEntityLimit >
 0 && this.renderQueue.length >
 0) {
    var current = this.renderQueue[0];
    if (current.deleted.length >
 0) {
      var deleteThisPass = current.deleted.splice(0,drawEntityLimit);
      drawEntityLimit -= deleteThisPass.length;
      this.render.processDeletedGameEntityGuids(deleteThisPass);
    }
    if (drawEntityLimit >
 0 && current.entities.length >
 0) {
      var drawThisPass = current.entities.splice(0,drawEntityLimit);
      drawEntityLimit -= drawThisPass.length;
      this.render.processGameEntities(drawThisPass);
    }
    if (current.deleted.length == 0 && current.entities.length == 0) {
      this.renderQueue.splice(0,1);
      this.debugTiles.setState(current.id, current.status);
    }
  }
  if (this.renderQueue.length >
 0) {
    this.startQueueTimer(this.RENDER_PAUSE);
  } else if (Object.keys(this.queuedTiles).length == 0) {
    this.render.endRenderPass();
    var endTime = new Date().getTime();
    var duration = (endTime - this.refreshStartTime)/1000;
    console.log('finished requesting data! (took '+duration+' seconds to complete)');
    window.runHooks ('mapDataRefreshEnd', {});
    var longStatus = 'Tiles: ' + this.cachedTileCount + ' cached, ' +
                 this.successTileCount + ' loaded, ' +
                 (this.staleTileCount ? this.staleTileCount + ' stale, ' : '') +
                 (this.failedTileCount ? this.failedTileCount + ' failed, ' : '') +
                 'in ' + duration + ' seconds';
    // refresh timer based on time to run this pass, with a minimum of REFRESH seconds
    var minRefresh = map.getZoom()>
12 ? this.REFRESH_CLOSE : this.REFRESH_FAR;
    var refreshTimer = Math.max(minRefresh, duration*this.FETCH_TO_REFRESH_FACTOR);
    this.refreshOnTimeout(refreshTimer);
    this.setStatus (this.failedTileCount ? 'errors' : this.staleTileCount ? 'out of date' : 'done', longStatus);
  }
}
;
/*
OMS doesn't cancel the original click event, so the topmost marker will get a click event while spiderfying.
Also, OMS only supports a global callback for all managed markers. Therefore, we will use a custom event that gets fired
for each marker.
*/
window.setupOMS = function() {
  window.oms = new OverlappingMarkerSpiderfier(map, {
    keepSpiderfied: true,
    legWeight: 3.5,
    legColors: {
      usual: '#FFFF00',
      highlighted: '#FF0000'
    }
  });
  window.oms.addListener('click', function(marker) {
    map.closePopup();
    marker.fireEvent('spiderfiedclick', {target: marker});
  });
  window.oms.addListener('spiderfy', function(markers) {
    map.closePopup();
  });
  map._container.addEventListener("keypress", function(ev) {
    if(ev.keyCode === 27) // Esc
      window.oms.unspiderfy();
  }, false);
}
window.registerMarkerForOMS = function(marker) {
  marker.on('add', function () {
    window.oms.addMarker(marker);
  });
  marker.on('remove', function () {
    window.oms.removeMarker(marker);
  });
  if(marker._map) // marker has already been added
    window.oms.addMarker(marker);
}
;
// ORNAMENTS ///////////////////////////////////////////////////////
// added as part of the ingress #helios in 2014, ornaments
// are additional image overlays for portals
// currently there are 28 known ornaments: ap$x$suffix
// - cluster portals (without suffix)
// - volatile portals (_v)
// - meeting points (_start)
// - finish points (_end)
// (there are 7 different colors for each of them)
window.ornaments = {}
window.ornaments.OVERLAY_SIZE = 60;
window.ornaments.OVERLAY_OPACITY = 0.6;
window.ornaments.setup = function() {
  window.ornaments._portals = {};
  window.ornaments._layer = L.layerGroup();
  window.addLayerGroup('Ornaments', window.ornaments._layer, true);
}
// quick test for portal having ornaments
window.ornaments.isInterestingPortal = function(portal) {
  return portal.options.data.ornaments.length != 0;
}
window.ornaments.addPortal = function(portal) {
  var guid = portal.options.guid;
  window.ornaments.removePortal(portal);
  var size = window.ornaments.OVERLAY_SIZE;
  var latlng = portal.getLatLng();
  if (portal.options.data.ornaments) {
    window.ornaments._portals[guid] = portal.options.data.ornaments.map(function(ornament) {
      var icon = L.icon({
        iconUrl: "//commondatastorage.googleapis.com/ingress.com/img/map_icons/marker_images/"+ornament+".png",
        iconSize: [size, size],
        iconAnchor: [size/2,size/2],
        className: 'no-pointer-events'  // the clickable: false below still blocks events going through to the svg underneath
      });
      return L.marker(latlng, {icon: icon, clickable: false, keyboard: false, opacity: window.ornaments.OVERLAY_OPACITY }).addTo(window.ornaments._layer);
    });
  }
}
window.ornaments.removePortal = function(portal) {
  var guid = portal.options.guid;
  if(window.ornaments._portals[guid]) {
    window.ornaments._portals[guid].forEach(function(marker) {
      window.ornaments._layer.removeLayer(marker);
    });
    delete window.ornaments._portals[guid];
  }
}
;
// created to start cleaning up "window" interaction
//
window.currentPane = '';
window.show = function(id) {
  if(window.currentPane == id) return;
  window.currentPane = id;
  window.hideall();
  runHooks("paneChanged", id);
  switch(id) {
    case 'all':
    case 'faction':
    case 'alerts':
      window.chat.show(id);
      break;
    case 'debug':
      window.debug.console.show();
      break;
    case 'map':
      window.smartphone.mapButton.click();
      $('#portal_highlight_select').show();
      $('#farm_level_select').show();
      break;
    case 'info':
      window.smartphone.sideButton.click();
      break;
  }
  if (typeof android !== 'undefined' && android && android.switchToPane) {
    android.switchToPane(id);
  }
}
window.hideall = function() {
  $('#chatcontrols, #chat, #chatinput, #sidebartoggle, #scrollwrapper, #updatestatus, #portal_highlight_select').hide();
  $('#farm_level_select').hide();
  $('#map').css('visibility', 'hidden');
  $('.ui-tooltip').remove();
}
;
// PLAYER NAMES //////////////////////////////////////////////////////
// test to see if a specific player GUID is a special system account (e.g. __JARVIS__, __ADA__) that shouldn't
// be listed as a player
window.isSystemPlayer = function(name) {
  switch (name) {
    case '__ADA__':
    case '__JARVIS__':
      return true;
    default:
      return false;
  }
}
;
/// PORTAL DATA TOOLS ///////////////////////////////////////////////////
// misc functions to get portal info
// search through the links data for all that link from or to a portal. returns an object with separate lists of in
// and out links. may or may not be as accurate as the portal details, depending on how much data the API returns
window.getPortalLinks = function(guid) {
  var links = { in: [], out: [] };
  $.each(window.links, function(g,l) {
    var d = l.options.data;
    if (d.oGuid == guid) {
      links.out.push(g);
    }
    if (d.dGuid == guid) {
      links.in.push(g);
    }
  });
  return links;
}
window.getPortalLinksCount = function(guid) {
  var links = getPortalLinks(guid);
  return links.in.length+links.out.length;
}
// search through the fields for all that reference a portal
window.getPortalFields = function(guid) {
  var fields = [];
  $.each(window.fields, function(g,f) {
    var d = f.options.data;
    if ( d.points[0].guid == guid
      || d.points[1].guid == guid
      || d.points[2].guid == guid ) {
      fields.push(g);
    }
  });
  return fields;
}
window.getPortalFieldsCount = function(guid) {
  var fields = getPortalFields(guid);
  return fields.length;
}
// find the lat/lon for a portal, using any and all available data
// (we have the list of portals, the cached portal details, plus links and fields as sources of portal locations)
window.findPortalLatLng = function(guid) {
  if (window.portals[guid]) {
    return window.portals[guid].getLatLng();
  }
  // not found in portals - try the cached (and possibly stale) details - good enough for location
  var details = portalDetail.get(guid);
  if (details) {
    return L.latLng (details.latE6/1E6, details.lngE6/1E6);
  }
  // now try searching through fields
  for (var fguid in window.fields) {
    var f = window.fields[fguid].options.data;
    for (var i in f.points) {
      if (f.points[i].guid == guid) {
        return L.latLng (f.points[i].latE6/1E6, f.points[i].lngE6/1E6);
      }
    }
  }
  // and finally search through links
  for (var lguid in window.links) {
    var l = window.links[lguid].options.data;
    if (l.oGuid == guid) {
      return L.latLng (l.oLatE6/1E6, l.oLngE6/1E6);
    }
    if (l.dGuid == guid) {
      return L.latLng (l.dLatE6/1E6, l.dLngE6/1E6);
    }
  }
  // no luck finding portal lat/lng
  return undefined;
};
(function() {
  var cache = {};
  var cache_level = 0;
  var GC_LIMIT = 15000; // run garbage collector when cache has more that 5000 items
  var GC_KEEP  = 10000; // keep the 4000 most recent items
  window.findPortalGuidByPositionE6 = function(latE6, lngE6) {
    var item = cache[latE6+","+lngE6];
    if(item) return item[0];
    // now try searching through currently rendered portals
    for(var guid in window.portals) {
      var data = window.portals[guid].options.data;
      if(data.latE6 == latE6 && data.lngE6 == lngE6) return guid;
    }
    // now try searching through fields
    for(var fguid in window.fields) {
      var points = window.fields[fguid].options.data.points;
      for(var i in points) {
        var point = points[i];
        if(point.latE6 == latE6 && point.lngE6 == lngE6) return point.guid;
      }
    }
    // and finally search through links
    for(var lguid in window.links) {
      var l = window.links[lguid].options.data;
      if(l.oLatE6 == latE6 && l.oLngE6 == lngE6) return l.oGuid;
      if(l.dLatE6 == latE6 && l.dLngE6 == lngE6) return l.dGuid;
    }
    return null;
  };
  window.pushPortalGuidPositionCache = function(guid, latE6, lngE6) {
    cache[latE6+","+lngE6] = [guid, Date.now()];
    cache_level += 1;
    if(cache_level >
 GC_LIMIT) {
      Object.keys(cache) // get all latlngs
        .map(function(latlng) { return [latlng, cache[latlng][1]]; })  // map them to [latlng, timestamp]
        .sort(function(a,b) { return b[1] - a[1]; }) // sort them
        .slice(GC_KEEP) // drop the MRU
        .forEach(function(item) { delete cache[item[0]] }); // delete the rest
      cache_level = Object.keys(cache).length
    }
  }
})();
// get the AP gains from a portal, based only on the brief summary data from portals, links and fields
// not entirely accurate - but available for all portals on the screen
window.getPortalApGain = function(guid) {
  var p = window.portals[guid];
  if (p) {
    var data = p.options.data;
    var linkCount = getPortalLinksCount(guid);
    var fieldCount = getPortalFieldsCount(guid);
    var result = portalApGainMaths(data.resCount, linkCount, fieldCount);
    return result;
  }
  return undefined;
}
// given counts of resonators, links and fields, calculate the available AP
// doesn't take account AP for resonator upgrades or AP for adding mods
window.portalApGainMaths = function(resCount, linkCount, fieldCount) {
  var deployAp = (8-resCount)*DEPLOY_RESONATOR;
  if (resCount == 0) deployAp += CAPTURE_PORTAL;
  if (resCount != 8) deployAp += COMPLETION_BONUS;
  // there could also be AP for upgrading existing resonators, and for deploying mods - but we don't have data for that
  var friendlyAp = deployAp;
  var destroyResoAp = resCount*DESTROY_RESONATOR;
  var destroyLinkAp = linkCount*DESTROY_LINK;
  var destroyFieldAp = fieldCount*DESTROY_FIELD;
  var captureAp = CAPTURE_PORTAL + 8 * DEPLOY_RESONATOR + COMPLETION_BONUS;
  var destroyAp = destroyResoAp+destroyLinkAp+destroyFieldAp;
  var enemyAp = destroyAp+captureAp;
  return {
    friendlyAp: friendlyAp,
    enemyAp: enemyAp,
    destroyAp: destroyAp,
    destroyResoAp: destroyResoAp,
    captureAp: captureAp
  }
}
;
/// PORTAL DETAIL //////////////////////////////////////
// code to retrieve the new portal detail data from the servers
// NOTE: the API for portal detailed information is NOT FINAL
// this is a temporary measure to get things working again after a major change to the intel map
// API. expect things to change here
// anonymous function wrapper for the code - any variables/functions not placed into 'window' will be private
(function(){
var cache;
var requestQueue = {};
window.portalDetail = function() {};
window.portalDetail.setup = function() {
  cache = new DataCache();
  cache.startExpireInterval(20);
}
window.portalDetail.get = function(guid) {
  return cache.get(guid);
}
window.portalDetail.isFresh = function(guid) {
  return cache.isFresh(guid);
}
var handleResponse = function(guid, data, success) {
  delete requestQueue[guid];
  if (!data || data.error || !data.result) {
    success = false;
  }
  if (success) {
    var dict = decodeArray.portalDetail(data.result);
    // entity format, as used in map data
    var ent = [guid,dict.timestamp,data.result];
    cache.store(guid,dict);
    //FIXME..? better way of handling sidebar refreshing...
    if (guid == selectedPortal) {
      renderPortalDetails(guid);
    }
    window.runHooks ('portalDetailLoaded', {guid:guid, success:success, details:dict, ent:ent});
  } else {
    if (data && data.error == "RETRY") {
      // server asked us to try again
      portalDetail.request(guid);
    } else {
      window.runHooks ('portalDetailLoaded', {guid:guid, success:success});
    }
  }
}
window.portalDetail.request = function(guid) {
  if (!requestQueue[guid]) {
    requestQueue[guid] = true;
    window.postAjax('getPortalDetails', {guid:guid},
      function(data,textStatus,jqXHR) { handleResponse(guid, data, true); },
      function() { handleResponse(guid, undefined, false); }
    );
  }
}
})(); // anonymous wrapper function end
;
// PORTAL DETAILS MAIN ///////////////////////////////////////////////
// main code block that renders the portal details in the sidebar and
// methods that highlight the portal in the map view.
window.renderPortalDetails = function(guid) {
  selectPortal(window.portals[guid] ? guid : null);
  if (guid && !portalDetail.isFresh(guid)) {
    portalDetail.request(guid);
  }
  // TODO? handle the case where we request data for a particular portal GUID, but it *isn't* in
  // window.portals....
  if(!window.portals[guid]) {
    urlPortal = guid;
    $('#portaldetails').html('');
    if(isSmartphone()) {
      $('.fullimg').remove();
      $('#mobileinfo').html('
<div style="text-align: center">
<b>
tap here for info screen
</b>
</div>
');
    }
    return;
  }
  var portal = window.portals[guid];
  var data = portal.options.data;
  var details = portalDetail.get(guid);
  // details and data can get out of sync. if we have details, construct a matching 'data'
  if (details) {
    data = getPortalSummaryData(details);
  }
  var modDetails = details ? '
<div class="mods">
'+getModDetails(details)+'
</div>
' : '';
  var miscDetails = details ? getPortalMiscDetails(guid,details) : '';
  var resoDetails = details ? getResonatorDetails(details) : '';
//TODO? other status details...
  var statusDetails = details ? '' : '
<div id="portalStatus">
Loading details...
</div>
';
  var img = fixPortalImageUrl(details ? details.image : data.image);
  var title = (details && details.title) || (data && data.title) || '(untitled)';
  var lat = data.latE6/1E6;
  var lng = data.lngE6/1E6;
  var imgTitle = title+'\n\nClick to show full image.';
  // portal level. start with basic data - then extend with fractional info in tooltip if available
  var levelInt = (teamStringToId(data.team) == TEAM_NONE) ? 0 : data.level;
  var levelDetails = levelInt;
  if (details) {
    levelDetails = getPortalLevel(details);
    if(levelDetails != 8) {
      if(levelDetails==Math.ceil(levelDetails))
        levelDetails += "\n8";
      else
        levelDetails += "\n" + (Math.ceil(levelDetails) - levelDetails)*8;
      levelDetails += " resonator level(s) needed for next portal level";
    } else {
      levelDetails += "\nfully upgraded";
    }
  }
  levelDetails = "Level " + levelDetails;
  var linkDetails = [];
  var posOnClick = 'window.showPortalPosLinks('+lat+','+lng+',\''+escapeJavascriptString(title)+'\')';
  var permalinkUrl = '/intel?ll='+lat+','+lng+'&z=17&pll='+lat+','+lng;
  if (typeof android !== 'undefined' && android && android.intentPosLink) {
    // android devices. one share link option - and the android app provides an interface to share the URL,
    // share as a geo: intent (navigation via google maps), etc
    var shareLink = $('
<div>
').html( $('
<a>
').attr({onclick:posOnClick}).text('Share portal') ).html();
    linkDetails.push('
<aside>
'+shareLink+'
</aside>
');
  } else {
    // non-android - a permalink for the portal
    var permaHtml = $('
<div>
').html( $('
<a>
').attr({href:permalinkUrl, title:'Create a URL link to this portal'}).text('Portal link') ).html();
    linkDetails.push ( '
<aside>
'+permaHtml+'
</aside>
' );
    // and a map link popup dialog
    var mapHtml = $('
<div>
').html( $('
<a>
').attr({onclick:posOnClick, title:'Link to alternative maps (Google, etc)'}).text('Map links') ).html();
    linkDetails.push('
<aside>
'+mapHtml+'
</aside>
');
  }
  $('#portaldetails')
    .html('') //to ensure it's clear
    .attr('class', TEAM_TO_CSS[teamStringToId(data.team)])
    .append(
      $('
<h3>
').attr({class:'title'}).text(title),
      $('
<span>
').attr({
        class: 'close',
        title: 'Close [w]',
        onclick:'renderPortalDetails(null); if(isSmartphone()) show("map");',
        accesskey: 'w'
      }).text('X'),
      // help cursor via ".imgpreview img"
      $('
<div>
')
      .attr({class:'imgpreview', title:imgTitle, style:"background-image: url('"+img+"')"})
      .append(
        $('
<span>
').attr({id:'level', title: levelDetails}).text(levelInt),
        $('
<img>
').attr({class:'hide', src:img})
      ),
      modDetails,
      miscDetails,
      resoDetails,
      statusDetails,
      '
<div class="linkdetails">
' + linkDetails.join('') + '
</div>
'
    );
  // only run the hooks when we have a portalDetails object - most plugins rely on the extended data
  // TODO? another hook to call always, for any plugins that can work with less data?
  if (details) {
    runHooks('portalDetailsUpdated', {guid: guid, portal: portal, portalDetails: details, portalData: data});
  }
}
window.getPortalMiscDetails = function(guid,d) {
  var randDetails;
  if (d) {
    // collect some random data that’s not worth to put in an own method
    var linkInfo = getPortalLinks(guid);
    var maxOutgoing = getMaxOutgoingLinks(d);
    var linkCount = linkInfo.in.length + linkInfo.out.length;
    var links = {incoming: linkInfo.in.length, outgoing: linkInfo.out.length};
    var title = 'at most ' + maxOutgoing + ' outgoing links\n' +
                links.outgoing + ' links out\n' +
                links.incoming + ' links in\n' +
                '(' + (links.outgoing+links.incoming) + ' total)'
    var linksText = ['links', links.outgoing+' out / '+links.incoming+' in', title];
    var player = d.owner
      ? '
<span class="nickname">
' + d.owner + '
</span>
'
      : '-';
    var playerText = ['owner', player];
    var fieldCount = getPortalFieldsCount(guid);
    var fieldsText = ['fields', fieldCount];
    var apGainText = getAttackApGainText(d,fieldCount,linkCount);
    var attackValues = getPortalAttackValues(d);
    // collect and html-ify random data
    var randDetailsData = [
      // these pieces of data are only relevant when the portal is captured
      // maybe check if portal is captured and remove?
      // But this makes the info panel look rather empty for unclaimed portals
      playerText, getRangeText(d),
      linksText, fieldsText,
      getMitigationText(d,linkCount), getEnergyText(d),
      // and these have some use, even for uncaptured portals
      apGainText, getHackDetailsText(d),
    ];
    if(attackValues.attack_frequency != 0)
      randDetailsData.push([
        '
<span title="attack frequency" class="text-overflow-ellipsis">
attack frequency
</span>
',
        '×'+attackValues.attack_frequency]);
    if(attackValues.hit_bonus != 0)
      randDetailsData.push(['hit bonus', attackValues.hit_bonus+'%']);
    if(attackValues.force_amplifier != 0)
      randDetailsData.push([
        '
<span title="force amplifier" class="text-overflow-ellipsis">
force amplifier
</span>
',
        '×'+attackValues.force_amplifier]);
    randDetails = '
<table id="randdetails">
' + genFourColumnTable(randDetailsData) + '
</table>
';
    // artifacts - tacked on after (but not as part of) the 'randdetails' table
    // instead of using the existing columns....
    if (d.artifactBrief && d.artifactBrief.target && Object.keys(d.artifactBrief.target).length >
 0) {
      var targets = Object.keys(d.artifactBrief.target);
//currently (2015-07-10) we no longer know the team each target portal is for - so we'll just show the artifact type(s)
       randDetails += '
<div id="artifact_target">
Target portal: '+targets.map(function(x) { return x.capitalize(); }).join(', ')+'
</div>
';
    }
    // shards - taken directly from the portal details
    if (d.artifactDetail) {
      randDetails += '
<div id="artifact_fragments">
Shards: '+d.artifactDetail.displayName+' #'+d.artifactDetail.fragments.join(', ')+'
</div>
';
    }
  }
  return randDetails;
}
// draws link-range and hack-range circles around the portal with the
// given details. Clear them if parameter 'd' is null.
window.setPortalIndicators = function(p) {
  if(portalRangeIndicator) map.removeLayer(portalRangeIndicator);
  portalRangeIndicator = null;
  if(portalAccessIndicator) map.removeLayer(portalAccessIndicator);
  portalAccessIndicator = null;
  // if we have a portal...
  if(p) {
    var coord = p.getLatLng();
    // range is only known for sure if we have portal details
    // TODO? render a min range guess until details are loaded..?
    var d = portalDetail.get(p.options.guid);
    if (d) {
      var range = getPortalRange(d);
      portalRangeIndicator = (range.range >
 0
          ? L.geodesicCircle(coord, range.range, {
              fill: false,
              color: RANGE_INDICATOR_COLOR,
              weight: 3,
              dashArray: range.isLinkable ? undefined : "10,10",
              clickable: false })
          : L.circle(coord, range.range, { fill: false, stroke: false, clickable: false })
        ).addTo(map);
    }
    portalAccessIndicator = L.circle(coord, HACK_RANGE,
      { fill: false, color: ACCESS_INDICATOR_COLOR, weight: 2, clickable: false }
    ).addTo(map);
  }
}
// highlights portal with given GUID. Automatically clears highlights
// on old selection. Returns false if the selected portal changed.
// Returns true if it's still the same portal that just needs an
// update.
window.selectPortal = function(guid) {
  var update = selectedPortal === guid;
  var oldPortalGuid = selectedPortal;
  selectedPortal = guid;
  var oldPortal = portals[oldPortalGuid];
  var newPortal = portals[guid];
  // Restore style of unselected portal
  if(!update && oldPortal) setMarkerStyle(oldPortal,false);
  // Change style of selected portal
  if(newPortal) {
    setMarkerStyle(newPortal, true);
    if (map.hasLayer(newPortal)) {
      newPortal.bringToFront();
    }
  }
  setPortalIndicators(newPortal);
  runHooks('portalSelected', {selectedPortalGuid: guid, unselectedPortalGuid: oldPortalGuid});
  return update;
}
;
// PORTAL DETAILS DISPLAY ////////////////////////////////////////////
// hand any of these functions the details-hash of a portal, and they
// will return pretty, displayable HTML or parts thereof.
// returns displayable text+link about portal range
window.getRangeText = function(d) {
  var range = getPortalRange(d);
  var title = 'Base range:\t' + digits(Math.floor(range.base))+'m'
    + '\nLink amp boost:\t×'+range.boost
    + '\nRange:\t'+digits(Math.floor(range.range))+'m';
  if(!range.isLinkable) title += '\nPortal is missing resonators,\nno new links can be made';
  return ['range',
      '
<a onclick="window.rangeLinkClick()"'
    + (range.isLinkable ? '' : ' style="text-decoration:line-through;"')
    + '>
'
    + (range.range >
 1000
      ? Math.floor(range.range/1000) + ' km'
      : Math.floor(range.range)      + ' m')
    + '
</a>
',
    title];
}
// given portal details, returns html code to display mod details.
window.getModDetails = function(d) {
  var mods = [];
  var modsTitle = [];
  var modsColor = [];
  $.each(d.mods, function(ind, mod) {
    var modName = '';
    var modTooltip = '';
    var modColor = '#000';
    if (mod) {
      // all mods seem to follow the same pattern for the data structure
      // but let's try and make this robust enough to handle possible future differences
      modName = mod.name || '(unknown mod)';
      if (mod.rarity) {
        modName = mod.rarity.capitalize().replace(/_/g,' ') + ' ' + modName;
      }
      modTooltip = modName + '\n';
      if (mod.owner) {
        modTooltip += 'Installed by: '+ mod.owner + '\n';
      }
      if (mod.stats) {
        modTooltip += 'Stats:';
        for (var key in mod.stats) {
          if (!mod.stats.hasOwnProperty(key)) continue;
          var val = mod.stats[key];
          // if (key === 'REMOVAL_STICKINESS' && val == 0) continue;  // stat on all mods recently - unknown meaning, not displayed in stock client
          // special formatting for known mod stats, where the display of the raw value is less useful
          if      (key === 'HACK_SPEED')            val = (val/10000)+'%'; // 500000 = 50%
          else if (key === 'HIT_BONUS')             val = (val/10000)+'%'; // 300000 = 30%
          else if (key === 'ATTACK_FREQUENCY')      val = (val/1000) +'x'; // 2000 = 2x
          else if (key === 'FORCE_AMPLIFIER')       val = (val/1000) +'x'; // 2000 = 2x
          else if (key === 'LINK_RANGE_MULTIPLIER') val = (val/1000) +'x'; // 2000 = 2x
          else if (key === 'LINK_DEFENSE_BOOST')    val = (val/1000) +'x'; // 1500 = 1.5x
          else if (key === 'REMOVAL_STICKINESS' && val >
 100) val = (val/10000)+'%'; // an educated guess
          // else display unmodified. correct for shield mitigation and multihack - unknown for future/other mods
          modTooltip += '\n+' +  val + ' ' + key.capitalize().replace(/_/g,' ');
        }
      }
      if (mod.rarity) {
        modColor = COLORS_MOD[mod.rarity];
      } else {
        modColor = '#fff';
      }
    }
    mods.push(modName);
    modsTitle.push(modTooltip);
    modsColor.push(modColor);
  });
  var t = '';
  for (var i=0; i
<mods.length; i++) {
    t += '
<span'+(modsTitle[i].length ? ' title="'+modsTitle[i]+'"' : '')+' style="color:'+modsColor[i]+'">
'+mods[i]+'
</span>
'
  }
  // and add blank entries if we have less than 4 mods (as the server no longer returns all mod slots, but just the filled ones)
  for (var i=mods.length; i
<4; i++) {
    t += '
<span style="color:#000">
</span>
'
  }
  return t;
}
window.getEnergyText = function(d) {
  var currentNrg = getCurrentPortalEnergy(d);
  var totalNrg = getTotalPortalEnergy(d);
  var title = currentNrg + ' / ' + totalNrg;
  var fill = prettyEnergy(currentNrg) + ' / ' + prettyEnergy(totalNrg)
  return ['energy', fill, title];
}
window.getResonatorDetails = function(d) {
  var resoDetails = [];
  // octant=slot: 0=E, 1=NE, 2=N, 3=NW, 4=W, 5=SW, 6=S, SE=7
  // resos in the display should be ordered like this:
  //   N    NE         Since the view is displayed in rows, they
  //  NW    E          need to be ordered like this: N NE NW E W SE SW S
  //   W    SE         i.e. 2 1 3 0 4 7 5 6
  //  SW    S
  // note: as of 2014-05-23 update, this is not true for portals with empty slots!
  var processResonatorSlot = function(reso,slot) {
    var lvl=0, nrg=0, owner=null;
    if (reso) {
      lvl = parseInt(reso.level);
      nrg = parseInt(reso.energy);
      owner = reso.owner;
    }
    resoDetails.push(renderResonatorDetails(slot, lvl, nrg, owner));
  };
  // if all 8 resonators are deployed, we know which is in which slot
  if (d.resonators.length == 8) {
    // fully deployed - we can make assumptions about deployment slots
    $.each([2, 1, 3, 0, 4, 7, 5, 6], function(ind, slot) {
      processResonatorSlot(d.resonators[slot],slot);
    });
  } else {
    // partially deployed portal - we can no longer find out which resonator is in which slot
    for(var ind=0; ind
<8; ind++) {
      processResonatorSlot(ind
< d.resonators.length ? d.resonators[ind] : null, null);
    }
  }
  return '
<table id="resodetails">
' + genFourColumnTable(resoDetails) + '
</table>
';
}
// helper function that renders the HTML for a given resonator. Does
// not work with raw details-hash. Needs digested infos instead:
// slot: which slot this resonator occupies. Starts with 0 (east) and
// rotates clockwise. So, last one is 7 (southeast).
window.renderResonatorDetails = function(slot, level, nrg, nick) {
  if(OCTANTS[slot] === 'N')
    var className = 'meter north';
  else
    var className = 'meter';
  var max = RESO_NRG[level];
  var fillGrade = level >
 0 ? nrg/max*100 : 0;
  var inf = (level >
 0 ? 'energy:\t' + nrg   + ' / ' + max + ' (' + Math.round(fillGrade) + '%)\n'
                        +'level:\t'  + level + '\n'
                        +'owner:\t'  + nick  + '\n'
                       : '')
          + (slot !== null ? 'octant:\t' + OCTANTS[slot] + ' ' + OCTANTS_ARROW[slot]:'');
  var style = fillGrade ? 'width:'+fillGrade+'%; background:'+COLORS_LVL[level]+';':'';
  var color = (level
< 3 ? "#9900FF" : "#FFFFFF");
  var lbar = level >
 0 ? '
<span class="meter-level" style="color: ' + color + ';">
 L ' + level + '
</span>
' : '';
  var fill  = '
<span style="'+style+'">
</span>
';
  var meter = '
<span class="' + className + '" title="'+inf+'">
' + fill + lbar + '
</span>
';
  nick = nick ? '
<span class="nickname">
'+nick+'
</span>
' : null;
  return [meter, nick || ''];
}
// calculate AP gain from destroying portal and then capturing it by deploying resonators
window.getAttackApGainText = function(d,fieldCount,linkCount) {
  var breakdown = getAttackApGain(d,fieldCount,linkCount);
  var totalGain = breakdown.enemyAp;
  var t = '';
  if (teamStringToId(PLAYER.team) == teamStringToId(d.team)) {
    totalGain = breakdown.friendlyAp;
    t += 'Friendly AP:\t' + breakdown.friendlyAp + '\n';
    t += '  Deploy ' + breakdown.deployCount + ', ';
    t += 'Upgrade ' + breakdown.upgradeCount + '\n';
    t += '\n';
  }
  t += 'Enemy AP:\t' + breakdown.enemyAp + '\n';
  t += '  Destroy AP:\t' + breakdown.destroyAp + '\n';
  t += '  Capture AP:\t' + breakdown.captureAp + '\n';
  return ['AP Gain', digits(totalGain), t];
}
window.getHackDetailsText = function(d) {
  var hackDetails = getPortalHackDetails(d);
  var shortHackInfo = hackDetails.hacks+' @ '+formatInterval(hackDetails.cooldown);
  var title = 'Hacks available every 4 hours\n'
            + 'Hack count:\t'+hackDetails.hacks+'\n'
            + 'Cooldown time:\t'+formatInterval(hackDetails.cooldown)+'\n'
            + 'Burnout time:\t'+formatInterval(hackDetails.burnout);
  return ['hacks', shortHackInfo, title];
}
window.getMitigationText = function(d,linkCount) {
  var mitigationDetails = getPortalMitigationDetails(d,linkCount);
  var mitigationShort = mitigationDetails.total;
  if (mitigationDetails.excess) mitigationShort += ' (+'+mitigationDetails.excess+')';
  var title = 'Total shielding:\t'+(mitigationDetails.shields+mitigationDetails.links)+'\n'
            + '- active:\t'+mitigationDetails.total+'\n'
            + '- excess:\t'+mitigationDetails.excess+'\n'
            + 'From\n'
            + '- shields:\t'+mitigationDetails.shields+'\n'
            + '- links:\t'+mitigationDetails.links;
  return ['shielding', mitigationShort, title];
}
;
// Portal Highlighter //////////////////////////////////////////////////////////
// these functions handle portal highlighters
// an object mapping highlighter names to the object containing callback functions
window._highlighters = null;
// the name of the current highlighter
window._current_highlighter = localStorage.portal_highlighter;
window._no_highlighter = 'No Highlights';
window.addPortalHighlighter = function(name, data) {
  if(_highlighters === null) {
    _highlighters = {};
  }
  // old-format highlighters just passed a callback function. this is the same as just a highlight method
  if (!data.highlight) {
    data = {highlight: data}
  }
  _highlighters[name] = data;
  if (typeof android !== 'undefined' && android && android.addPortalHighlighter)
    android.addPortalHighlighter(name);
  if(window._current_highlighter === undefined) {
    _current_highlighter = name;
  }
  if (_current_highlighter == name) {
    if (typeof android !== 'undefined' && android && android.setActiveHighlighter)
      android.setActiveHighlighter(name);
    // call the setSelected callback
    if (_highlighters[_current_highlighter].setSelected) {
      _highlighters[_current_highlighter].setSelected(true);
    }
  }
  updatePortalHighlighterControl();
}
// (re)creates the highlighter dropdown list
window.updatePortalHighlighterControl = function() {
  if (typeof android !== 'undefined' && android && android.addPortalHighlighter) {
    $('#portal_highlight_select').remove();
    return;
  }
  if(_highlighters !== null) {
    if($('#portal_highlight_select').length === 0) {
      $("body").append("
<select id='portal_highlight_select'>
</select>
");
      $("#portal_highlight_select").change(function(){ changePortalHighlights($(this).val());});
      $(".leaflet-top.leaflet-left").css('padding-top', '20px');
      $(".leaflet-control-scale-line").css('margin-top','25px');
    }
    $("#portal_highlight_select").html('');
    $("#portal_highlight_select").append($("
<option>
").attr('value',_no_highlighter).text(_no_highlighter));
    var h_names = Object.keys(_highlighters).sort();
    $.each(h_names, function(i, name) {
      $("#portal_highlight_select").append($("
<option>
").attr('value',name).text(name));
    });
    $("#portal_highlight_select").val(_current_highlighter);
  }
}
window.changePortalHighlights = function(name) {
  // first call any previous highlighter select callback
  if (_current_highlighter && _highlighters[_current_highlighter] && _highlighters[_current_highlighter].setSelected) {
    _highlighters[_current_highlighter].setSelected(false);
  }
  _current_highlighter = name;
  if (typeof android !== 'undefined' && android && android.setActiveHighlighter)
    android.setActiveHighlighter(name);
  // now call the setSelected callback for the new highlighter
  if (_current_highlighter && _highlighters[_current_highlighter] && _highlighters[_current_highlighter].setSelected) {
    _highlighters[_current_highlighter].setSelected(true);
  }
  resetHighlightedPortals();
  localStorage.portal_highlighter = name;
}
window.highlightPortal = function(p) {
  if(_highlighters !== null && _highlighters[_current_highlighter] !== undefined) {
    _highlighters[_current_highlighter].highlight({portal: p});
  }
}
window.resetHighlightedPortals = function() {
  $.each(portals, function(guid, portal) {
    setMarkerStyle(portal, guid === selectedPortal);
  });
}
;
// PORTAL DETAILS TOOLS //////////////////////////////////////////////
// hand any of these functions the details-hash of a portal, and they
// will return useful, but raw data.
// returns a float. Displayed portal level is always rounded down from
// that value.
window.getPortalLevel = function(d) {
  var lvl = 0;
  var hasReso = false;
  $.each(d.resonators, function(ind, reso) {
    if(!reso) return true;
    lvl += parseInt(reso.level);
    hasReso = true;
  });
  return hasReso ? Math.max(1, lvl/8) : 0;
}
window.getTotalPortalEnergy = function(d) {
  var nrg = 0;
  $.each(d.resonators, function(ind, reso) {
    if(!reso) return true;
    var level = parseInt(reso.level);
    var max = RESO_NRG[level];
    nrg += max;
  });
  return nrg;
}
// For backwards compatibility
window.getPortalEnergy = window.getTotalPortalEnergy;
window.getCurrentPortalEnergy = function(d) {
  var nrg = 0;
  $.each(d.resonators, function(ind, reso) {
    if(!reso) return true;
    nrg += parseInt(reso.energy);
  });
  return nrg;
}
window.getPortalRange = function(d) {
  // formula by the great gals and guys at
  // http://decodeingress.me/2012/11/18/ingress-portal-levels-and-link-range/
  var lvl = 0;
  var resoMissing = false;
  // currently we get a short resonator array when some are missing
  if (d.resonators.length
< 8) {
    resoMissing = true;
  }
  // but in the past we used to always get an array of 8, but will 'null' objects for some entries. maybe that will return?
  $.each(d.resonators, function(ind, reso) {
    if(!reso) {
      resoMissing = true;
      return;
    }
  });
  var range = {
    base: 160*Math.pow(getPortalLevel(d), 4),
    boost: getLinkAmpRangeBoost(d)
  };
  range.range = range.boost * range.base;
  range.isLinkable = !resoMissing;
  return range;
}
window.getLinkAmpRangeBoost = function(d) {
  // additional range boost calculation
  // link amps scale: first is full, second a quarter, the last two an eighth
  var scale = [1.0, 0.25, 0.125, 0.125];
  var boost = 0.0;  // initial boost is 0.0 (i.e. no boost over standard range)
  var linkAmps = getPortalModsByType(d, 'LINK_AMPLIFIER');
  linkAmps.forEach(function(mod, i) {
    // link amp stat LINK_RANGE_MULTIPLIER is 2000 for rare, and gives 2x boost to the range
    // and very-rare is 7000 and gives 7x the range
    var baseMultiplier = mod.stats.LINK_RANGE_MULTIPLIER/1000;
    boost += baseMultiplier*scale[i];
  });
  return (linkAmps.length >
 0) ? boost : 1.0;
}
window.getAttackApGain = function(d,fieldCount,linkCount) {
  if (!fieldCount) fieldCount = 0;
  var resoCount = 0;
  var maxResonators = MAX_RESO_PER_PLAYER.slice(0);
  var curResonators = [ 0, 0, 0, 0, 0, 0, 0, 0, 0];
  for(var n = PLAYER.level + 1; n
< 9; n++) {
    maxResonators[n] = 0;
  }
  $.each(d.resonators, function(ind, reso) {
    if(!reso)
      return true;
    resoCount += 1;
    var reslevel=parseInt(reso.level);
    if(reso.owner === PLAYER.nickname) {
      if(maxResonators[reslevel] >
 0) {
        maxResonators[reslevel] -= 1;
      }
    } else {
      curResonators[reslevel] += 1;
    }
  });
  var resoAp = resoCount * DESTROY_RESONATOR;
  var linkAp = linkCount * DESTROY_LINK;
  var fieldAp = fieldCount * DESTROY_FIELD;
  var destroyAp = resoAp + linkAp + fieldAp;
  var captureAp = CAPTURE_PORTAL + 8 * DEPLOY_RESONATOR + COMPLETION_BONUS;
  var enemyAp = destroyAp + captureAp;
  var deployCount = 8 - resoCount;
  var completionAp = (deployCount >
 0) ? COMPLETION_BONUS : 0;
  var upgradeCount = 0;
  var upgradeAvailable = maxResonators[8];
  for(var n = 7; n >
= 0; n--) {
    upgradeCount += curResonators[n];
    if(upgradeAvailable
< upgradeCount) {
        upgradeCount -= (upgradeCount - upgradeAvailable);
    }
    upgradeAvailable += maxResonators[n];
  }
  var friendlyAp = deployCount * DEPLOY_RESONATOR + upgradeCount * UPGRADE_ANOTHERS_RESONATOR + completionAp;
  return {
    friendlyAp: friendlyAp,
    deployCount: deployCount,
    upgradeCount: upgradeCount,
    enemyAp: enemyAp,
    destroyAp: destroyAp,
    resoAp: resoAp,
    captureAp: captureAp
  };
}
//This function will return the potential level a player can upgrade it to
window.potentialPortalLevel = function(d) {
  var current_level = getPortalLevel(d);
  var potential_level = current_level;
  if(PLAYER.team === d.team) {
    var resonators_on_portal = d.resonators;
    var resonator_levels = new Array();
    // figure out how many of each of these resonators can be placed by the player
    var player_resontators = new Array();
    for(var i=1;i
<=MAX_PORTAL_LEVEL; i++) {
      player_resontators[i] = i >
 PLAYER.level ? 0 : MAX_RESO_PER_PLAYER[i];
    }
    $.each(resonators_on_portal, function(ind, reso) {
      if(reso !== null && reso.owner === window.PLAYER.nickname) {
        player_resontators[reso.level]--;
      }
      resonator_levels.push(reso === null ? 0 : reso.level);
    });
    resonator_levels.sort(function(a, b) {
      return(a - b);
    });
    // Max out portal
    var install_index = 0;
    for(var i=MAX_PORTAL_LEVEL;i>
=1; i--) {
      for(var install = player_resontators[i]; install>
0; install--) {
        if(resonator_levels[install_index]
< i) {
          resonator_levels[install_index] = i;
          install_index++;
        }
      }
    }
    //console.log(resonator_levels);
    potential_level = resonator_levels.reduce(function(a, b) {return a + b;}) / 8;
  }
  return(potential_level);
}
window.fixPortalImageUrl = function(url) {
  if (url) {
    if (window.location.protocol === 'https:') {
      url = url.indexOf('www.panoramio.com') !== -1
            ? url.replace(/^http:\/\/www/, 'https://ssl').replace('small', 'medium')
            : url.replace(/^http:\/\//, '//');
    }
    return url;
  } else {
    return DEFAULT_PORTAL_IMG;
  }
}
window.getPortalModsByType = function(d, type) {
  var mods = [];
  var typeToStat = {
    RES_SHIELD: 'MITIGATION',
    FORCE_AMP: 'FORCE_AMPLIFIER',
    TURRET: 'HIT_BONUS',  // and/or ATTACK_FREQUENCY??
    HEATSINK: 'HACK_SPEED',
    MULTIHACK: 'BURNOUT_INSULATION',
    LINK_AMPLIFIER: 'LINK_RANGE_MULTIPLIER',
    ULTRA_LINK_AMP: 'OUTGOING_LINKS_BONUS', // and/or LINK_DEFENSE_BOOST??
  };
  var stat = typeToStat[type];
  $.each(d.mods || [], function(i,mod) {
    if (mod && mod.stats.hasOwnProperty(stat)) mods.push(mod);
  });
  // sorting mods by the stat keeps code simpler, when calculating combined mod effects
  mods.sort (function(a,b) {
    return b.stats[stat] - a.stats[stat];
  });
  return mods;
}
window.getPortalShieldMitigation = function(d) {
  var shields = getPortalModsByType(d, 'RES_SHIELD');
  var mitigation = 0;
  $.each(shields, function(i,s) {
    mitigation += parseInt(s.stats.MITIGATION);
  });
  return mitigation;
}
window.getPortalLinksMitigation = function(linkCount) {
  var mitigation = Math.round(400/9*Math.atan(linkCount/Math.E));
  return mitigation;
}
window.getPortalMitigationDetails = function(d,linkCount) {
  var mitigation = {
    shields: getPortalShieldMitigation(d),
    links: getPortalLinksMitigation(linkCount)
  };
  // mitigation is limited to 95% (as confirmed by Brandon Badger on G+)
  mitigation.total = Math.min(95, mitigation.shields+mitigation.links);
  mitigation.excess = (mitigation.shields+mitigation.links) - mitigation.total;
  return mitigation;
}
window.getMaxOutgoingLinks = function(d) {
  var linkAmps = getPortalModsByType(d, 'ULTRA_LINK_AMP');
  var links = 8;
  linkAmps.forEach(function(mod, i) {
    links += parseInt(mod.stats.OUTGOING_LINKS_BONUS);
  });
  return links;
};
window.getPortalHackDetails = function(d) {
  var heatsinks = getPortalModsByType(d, 'HEATSINK');
  var multihacks = getPortalModsByType(d, 'MULTIHACK');
  // first mod of type is fully effective, the others are only 50% effective
  var effectivenessReduction = [ 1, 0.5, 0.5, 0.5 ];
  var cooldownTime = 300; // 5 mins - 300 seconds
  $.each(heatsinks, function(index,mod) {
    var hackSpeed = parseInt(mod.stats.HACK_SPEED)/1000000;
    cooldownTime = Math.round(cooldownTime * (1 - hackSpeed * effectivenessReduction[index]));
  });
  var numHacks = 4; // default hacks
  $.each(multihacks, function(index,mod) {
    var extraHacks = parseInt(mod.stats.BURNOUT_INSULATION);
    numHacks = numHacks + (extraHacks * effectivenessReduction[index]);
  });
  return {cooldown: cooldownTime, hacks: numHacks, burnout: cooldownTime*(numHacks-1)};
}
// given a detailed portal structure, return summary portal data, as seen in the map tile data
window.getPortalSummaryData = function(d) {
  // NOTE: the summary data reports unclaimed portals as level 1 - not zero as elsewhere in IITC
  var level = parseInt(getPortalLevel(d));
  if (level == 0) level = 1; //niantic returns neutral portals as level 1, not 0 as used throughout IITC elsewhere
  var resCount = 0;
  if (d.resonators) {
    for (var x in d.resonators) {
      if (d.resonators[x]) resCount++;
    }
  }
  var maxEnergy = getTotalPortalEnergy(d);
  var curEnergy = getCurrentPortalEnergy(d);
  var health = maxEnergy>
0 ? parseInt(curEnergy/maxEnergy*100) : 0;
  return {
    level: level,
    title: d.title,
    image: d.image,
    resCount: resCount,
    latE6: d.latE6,
    health: health,
    team: d.team,
    lngE6: d.lngE6,
    type: 'portal'
  };
}
window.getPortalAttackValues = function(d) {
  var forceamps = getPortalModsByType(d, 'FORCE_AMP');
  var turrets = getPortalModsByType(d, 'TURRET');
  // at the time of writing, only rare force amps and turrets have been seen in the wild, so there's a little guesswork
  // at how the stats work and combine
  // algorithm has been compied from getLinkAmpRangeBoost
  // FIXME: only extract stats and put the calculation in a method to be used for link range, force amplifier and attack
  // frequency
  // note: scanner shows rounded values (adding a second FA shows: 2.5x+0.2x=2.8x, which should be 2.5x+0.25x=2.75x)
  // amplifier scale: first is full, second a quarter, the last two an eighth
  var scale = [1.0, 0.25, 0.125, 0.125];
  var attackValues = {
    hit_bonus: 0,
    force_amplifier: 0,
    attack_frequency: 0,
  };
  forceamps.forEach(function(mod, i) {
    // force amp stat FORCE_AMPLIFIER is 2000 for rare, and gives 2x boost to the range
    var baseMultiplier = mod.stats.FORCE_AMPLIFIER / 1000;
    attackValues.force_amplifier += baseMultiplier * scale[i];
  });
  turrets.forEach(function(mod, i) {
    // turret stat ATTACK_FREQUENCY is 2000 for rare, and gives 2x boost to the range
    var baseMultiplier = mod.stats.ATTACK_FREQUENCY / 1000;
    attackValues.attack_frequency += baseMultiplier * scale[i];
    attackValues.hit_bonus += mod.stats.HIT_BONUS / 10000;
  });
  return attackValues;
}
;
// PORTAL MARKER //////////////////////////////////////////////
// code to create and update a portal marker
window.portalMarkerScale = function() {
  var zoom = map.getZoom();
  if (L.Browser.mobile)
    return zoom >
= 16 ? 1.5 : zoom >
= 14 ? 1.2 : zoom >
= 11 ? 1.0 : zoom >
= 8 ? 0.65 : 0.5;
  else
    return zoom >
= 14 ? 1 : zoom >
= 11 ? 0.8 : zoom >
= 8 ? 0.65 : 0.5;
}
// create a new marker. 'data' contain the IITC-specific entity data to be stored in the object options
window.createMarker = function(latlng, data) {
  var styleOptions = window.getMarkerStyleOptions(data);
  var options = L.extend({}, data, styleOptions, { clickable: true });
  var marker = L.circleMarker(latlng, options);
  highlightPortal(marker);
  return marker;
}
window.setMarkerStyle = function(marker, selected) {
  var styleOptions = window.getMarkerStyleOptions(marker.options);
  marker.setStyle(styleOptions);
  // FIXME? it's inefficient to set the marker style (above), then do it again inside the highlighter
  // the highlighter API would need to be changed for this to be improved though. will it be too slow?
  highlightPortal(marker);
  if (selected) {
    marker.setStyle ({color: COLOR_SELECTED_PORTAL});
  }
}
window.getMarkerStyleOptions = function(details) {
  var scale = window.portalMarkerScale();
  //   portal level      0  1  2  3  4  5  6  7  8
  var LEVEL_TO_WEIGHT = [2, 2, 2, 2, 2, 3, 3, 4, 4];
  var LEVEL_TO_RADIUS = [7, 7, 7, 7, 8, 8, 9,10,11];
  var level = Math.floor(details.level||0);
  var lvlWeight = LEVEL_TO_WEIGHT[level] * Math.sqrt(scale);
  var lvlRadius = LEVEL_TO_RADIUS[level] * scale;
  var dashArray = null;
  // thinner and dashed outline for placeholder portals
  if (details.team != TEAM_NONE && level==0) {
    lvlWeight = 1;
    dashArray = [1,2];
  }
  var options = {
    radius: lvlRadius,
    stroke: true,
    color: COLORS[details.team],
    weight: lvlWeight,
    opacity: 1,
    fill: true,
    fillColor: COLORS[details.team],
    fillOpacity: 0.5,
    dashArray: dashArray
  };
  return options;
}
;
// REDEEMING ///////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////
window.REDEEM_SHORT_NAMES = {
  'portal shield':'S',
  'force amp':'FA',
  'link amp':'LA',
  'heatsink':'H',
  'multihack':'M',
  'turret':'T',
  'unusual object':'U',
  'resonator':'R',
  'xmp burster':'X',
  'power cube':'C',
  'media':'M',
  'ultra strike':'US',
}
/* These are HTTP status codes returned by the redemption API.
 * TODO: Move to another file? Use more generally across IITC?
 */
window.REDEEM_STATUSES = {
  429: 'You have been rate-limited by the server. Wait a bit and try again.',
  500: 'Internal server error'
};
window.handleRedeemResponse = function(data, textStatus, jqXHR) {
  var passcode = jqXHR.passcode;
  if(data.error) {
    console.error('Error redeeming passcode "'+passcode+'": ' + data.error)
    dialog({
      title: 'Error: ' + passcode,
      html: '
<strong>
' + data.error + '
</strong>
'
    });
    return;
  }
  if(!data.rewards) {
    console.error('Error redeeming passcode "'+passcode+'": ', data)
    dialog({
      title: 'Error: ' + passcode,
      html: '
<strong>
An unexpected error occured
</strong>
'
    });
    return;
  }
  if(data.playerData) {
    window.PLAYER = data.playerData;
    window.setupPlayerStat();
  }
  var format = "long";
  try {
    format = localStorage["iitc-passcode-format"];
  } catch(e) {}
  var formatHandlers = {
    "short": formatPasscodeShort,
    "long": formatPasscodeLong
  }
  if(!formatHandlers[format])
    format = "long";
  var html = formatHandlers[format](data.rewards);
  var buttons = {};
  Object.keys(formatHandlers).forEach(function(label) {
    if(label == format) return;
    buttons[label.toUpperCase()] = function() {
      $(this).dialog("close");
      localStorage["iitc-passcode-format"] = label;
      handleRedeemResponse(data, textStatus, jqXHR);
    }
  });
  // Display it
  dialog({
    title: 'Passcode: ' + passcode,
    html: html,
    buttons: buttons
  });
};
window.formatPasscodeLong = function(data) {
  var html = '
<p>
<strong>
Passcode confirmed. Acquired items:
</strong>
</p>
<ul class="redeemReward">
';
  if(data.other) {
    data.other.forEach(function(item) {
      html += '
<li>
' + window.escapeHtmlSpecialChars(item) + '
</li>
';
    });
  }
  if(0
< data.xm)
    html += '
<li>
' + window.escapeHtmlSpecialChars(data.xm) + ' XM
</li>
';
  if(0
< data.ap)
    html += '
<li>
' + window.escapeHtmlSpecialChars(data.ap) + ' AP
</li>
';
  if(data.inventory) {
    data.inventory.forEach(function(type) {
      type.awards.forEach(function(item) {
        html += '
<li>
' + item.count + 'x ';
        var l = item.level;
        if(0
< l) {
          l = parseInt(l);
          html += '
<span class="itemlevel" style="color:' + COLORS_LVL[l] + '">
L' + l + '
</span>
 ';
        }
        html += window.escapeHtmlSpecialChars(type.name) + '
</li>
';
      });
    });
  }
  html += '
</ul>
'
  return html;
}
window.formatPasscodeShort = function(data) {
  if(data.other) {
    var awards = data.other.map(window.escapeHtmlSpecialChars);
  } else {
    var awards = [];
  }
  if(0
< data.xm)
    awards.push(window.escapeHtmlSpecialChars(data.xm) + ' XM');
  if(0
< data.ap)
    awards.push(window.escapeHtmlSpecialChars(data.ap) + ' AP');
  if(data.inventory) {
    data.inventory.forEach(function(type) {
      type.awards.forEach(function(item) {
        var str = "";
        if(item.count >
 1)
          str += item.count + "&nbsp;";
        if(window.REDEEM_SHORT_NAMES[type.name.toLowerCase()]) {
          var shortName = window.REDEEM_SHORT_NAMES[type.name.toLowerCase()];
          var l = item.level;
          if(0
< l) {
            l = parseInt(l);
            str += '
<span class="itemlevel" style="color:' + COLORS_LVL[l] + '">
' + shortName + l + '
</span>
';
          } else {
            str += shortName;
          }
        } else { // no short name known
          var l = item.level;
          if(0
< l) {
            l = parseInt(l);
            str += '
<span class="itemlevel" style="color:' + COLORS_LVL[l] + '">
L' + l + '
</span>
 ';
          }
          str += type.name;
        }
        awards.push(str);
      });
    });
  }
  return '
<p class="redeemReward">
' + awards.join(', ') + '
</p>
'
}
window.setupRedeem = function() {
  $("#redeem").keypress(function(e) {
    if((e.keyCode ? e.keyCode : e.which) !== 13) return;
    var passcode = $(this).val();
    if(!passcode) return;
    var jqXHR = window.postAjax('redeemReward', {passcode:passcode}, window.handleRedeemResponse, function(response) {
      var extra = '';
      if(response.status) {
        extra = (window.REDEEM_STATUSES[response.status] || 'The server indicated an error.') + ' (HTTP ' + response.status + ')';
      } else {
        extra = 'No status code was returned.';
      }
      dialog({
        title: 'Request failed: ' + data.passcode,
        html: '
<strong>
The HTTP request failed.
</strong>
 ' + extra
      });
    });
    jqXHR.passcode = passcode;
  });
};
;
window.regionScoreboard = function() {
  // TODO: rather than just load the region scores for the center of the map, display a list of regions in the current view
  // and let the user select one (with automatic selection when just one region, and limited to close enough zooms so list size is reasonable)
  var latLng = map.getCenter();
  var latE6 = Math.round(latLng.lat*1E6);
  var lngE6 = Math.round(latLng.lng*1E6);
  var dlg = dialog({title:'Region scores',html:'Loading regional scores...',width:450,minHeight:320});
  window.postAjax('getRegionScoreDetails', {latE6:latE6,lngE6:lngE6}, function(res){regionScoreboardSuccess(res,dlg);}, function(){regionScoreboardFailure(dlg);});
}
function regionScoreboardFailure(dlg) {
  dlg.html('Failed to load region scores - try again');
}
function regionScoreboardScoreHistoryChart(result, logscale) {
  // svg area 400x130. graph area 350x100, offset to 40,10
  if(!Math.log10)
    Math.log10 = function(x) { return Math.log(x) / Math.LN10; };
  var max = Math.max(result.gameScore[0],result.gameScore[1],10); //NOTE: ensure a min of 10 for the graph
  var items = []; //we'll copy the items to an array indexed by checkpoint number - easier to access!
  for (var i=0; i
<result.scoreHistory.length; i++) {
    max = Math.max(max, result.scoreHistory[i][1], result.scoreHistory[i][2]); //note: index 0 is the checkpoint number here
    items[result.scoreHistory[i][0]] = [result.scoreHistory[i][1], result.scoreHistory[i][2]];
  }
  // scale up maximum a little, so graph isn't squashed right against upper edge
  max *= 1.09;
  // 0 cannot be displayed on a log scale, so we set the minimum to 0.001 and divide by lg(0.001)=-3
  var scale = logscale
    ? function(y) { return  10 - Math.log10(Math.max(0.001,y/max)) / 3 * 100; }
    : function(y) { return 110-y/max*100; };
  var teamPaths = [[],[]];
  var otherSvg = [];
  for (var i=0; i
<items.length; i++) {
    var x=i*10+40;
    if (items[i] !== undefined) {
      // paths
      if (i>
0 && items[i-1] !== undefined) {
        for (var t=0; t
<2; t++) {
          teamPaths[t].push('M'+(x-10)+','+scale(items[i-1][t])+' L'+x+','+scale(items[i][t]));
        }
      }
      // markers
      otherSvg.push('
<g title="test" class="checkpoint" data-cp="'+i+'" data-enl="'+items[i][0]+'" data-res="'+items[i][1]+'">
');
      otherSvg.push('
<rect x="'+(i*10+35)+'" y="10" width="10" height="100" fill="black" fill-opacity="0" />
');
      for (var t=0; t
<2; t++) {
        var col = t==0 ? COLORS[TEAM_ENL] : COLORS[TEAM_RES];
        otherSvg.push('
<circle cx="'+x+'" cy="'+scale(items[i][t])+'" r="3" stroke-width="1" stroke="'+col+'" fill="'+col+'" fill-opacity="0.5" />
');
      }
      otherSvg.push('
</g>
');
    }
  }
  var paths = '
<path d="M40,110 L40,10 M40,110 L390,110" stroke="#fff" />
';
  // graph tickmarks - horizontal
  var ticks = [];
  for (var i=5; i
<=35; i+=5) {
    var x=i*10+40;
    ticks.push('M'+x+',10 L'+x+',110');
    otherSvg.push('
<text x="'+x+'" y="125" font-size="12" font-family="Roboto, Helvetica, sans-serif" text-anchor="middle" fill="#fff">
'+i+'
</text>
');
  }
  // vertical
  // first we calculate the power of 10 that is smaller than the max limit
  var vtickStep = Math.pow(10,Math.floor(Math.log10(max)));
  var vticks = [];
  if(logscale) {
    for(var i=0;i
<4;i++) {
      vticks.push(vtickStep);
      vtickStep /= 10;
    }
  } else {
    // this could be between 1 and 10 grid lines - so we adjust to give nicer spacings
    if (vtickStep
< (max/5)) {
      vtickStep *= 2;
    } else if (vtickStep >
 (max/2)) {
      vtickStep /= 2;
    }
    for (var i=vtickStep; i
<=max; i+=vtickStep) {
      vticks.push(i);
    }
  }
  vticks.forEach(function(i) {
    var y = scale(i);
    ticks.push('M40,'+y+' L390,'+y);
    var istr = i>
=1000000000 ? i/1000000000+'B' : i>
=1000000 ? i/1000000+'M' : i>
=1000 ? i/1000+'k' : i;
    otherSvg.push('
<text x="35" y="'+y+'" font-size="12" font-family="Roboto, Helvetica, sans-serif" text-anchor="end" fill="#fff">
'+istr+'
</text>
');
  });
  paths += '
<path d="'+ticks.join(' ')+'" stroke="#fff" opacity="0.3" />
;'
  for (var t=0; t
<2; t++) {
    var col = t==0 ? COLORS[TEAM_ENL] : COLORS[TEAM_RES];
    if (teamPaths[t].length >
 0) {
      paths += '
<path d="'+teamPaths[t].join(' ')+'" stroke="'+col+'" />
';
    }
    var y = scale(result.gameScore[t]);
    paths += '
<path d="M40,'+y+' L390,'+y+'" stroke="'+col+'" stroke-dasharray="3,2" opacity="0.8" />
';
  }
  var svg = '
<div>
<svg width="400" height="130">
'
           +'
<rect x="0" y="0" width="400" height="130" stroke="#FFCE00" fill="#08304E" />
'
           +paths
           +otherSvg.join('')
           +'
<foreignObject height="18" width="45" y="111" x="0" class="node">
<label title="Logarithmic scale">
'
           +'
<input type="checkbox" class="logscale" style="height:auto;padding:0;vertical-align:middle"'+(logscale?' checked':'')+'/>
'
           +'log
</label>
</foreignObject>
'
           +'
</svg>
</div>
';
  return svg;
}
function regionScoreboardScoreHistoryTable(result) {
  var history = result.scoreHistory;
  var table = '
<table class="checkpoint_table">
<thead>
<tr>
<th>
Checkpoint
</th>
<th>
Enlightened
</th>
<th>
Resistance
</th>
</tr>
</thead>
';
  for(var i=0; i
<history.length; i++) {
    table += '
<tr>
<td>
' + history[i][0] + '
</td>
<td>
' + digits(history[i][1]) + '
</td>
<td>
' + digits(history[i][2]) + '
</td>
</tr>
';
  }
  table += '
</table>
';
  return table;
}
function regionScoreboardSuccess(data,dlg,logscale) {
  if (data.result === undefined) {
    return regionScoreboardFailure(dlg);
  }
  var agentTable = '
<table>
<tr>
<th>
#
</th>
<th>
Agent
</th>
</tr>
';
  for (var i=0; i
<data.result.topAgents.length; i++) {
    var agent = data.result.topAgents[i];
    agentTable += '
<tr>
<td>
'+(i+1)+'
</td>
<td class="nickname '+(agent.team=='RESISTANCE'?'res':'enl')+'">
'+agent.nick+'
</td>
</tr>
';
  }
  if (data.result.topAgents.length==0) {
    agentTable += '
<tr>
<td colspan="2">
<i>
no top agents
</i>
</td>
</tr>
';
  }
  agentTable += '
</table>
';
  var maxAverage = Math.max(data.result.gameScore[0], data.result.gameScore[1], 1);
  var teamRow = [];
  for (var t=0; t
<2; t++) {
    var team = t==0 ? 'Enlightened' : 'Resistance';
    var teamClass = t==0 ? 'enl' : 'res';
    var teamCol = t==0 ? COLORS[TEAM_ENL] : COLORS[TEAM_RES];
    var barSize = Math.round(data.result.gameScore[t]/maxAverage*200);
    teamRow[t] = '
<tr>
<th class="'+teamClass+'">
'+team+'
</th>
<td class="'+teamClass+'">
'+digits(data.result.gameScore[t])+'
</td>
<td>
<div style="background:'+teamCol+'; width: '+barSize+'px; height: 1.3ex; border: 2px outset '+teamCol+'">

</td>
</tr>
';
  }
  var first = PLAYER.team == 'RESISTANCE' ? 1 : 0;
  // we need some divs to make the accordion work properly
  dlg.html('
<div class="cellscore">
'
         +'
<b>
Region scores for '+data.result.regionName+'
</b>
'
         +'
<div>
<table>
'+teamRow[first]+teamRow[1-first]+'
</table>
'
         +regionScoreboardScoreHistoryChart(data.result, logscale)+'
</div>
'
         +'
<b>
Checkpoint overview
</b>
'
         +'
<div>
'+regionScoreboardScoreHistoryTable(data.result)+'
</div>
'
         +'
<b>
Top agents
</b>
'
         +'
<div>
'+agentTable+'
</div>
'
         +'
</div>
');
  $('g.checkpoint', dlg).each(function(i, elem) {
    elem = $(elem);
    var tooltip = 'CP:\t'+elem.attr('data-cp')
      + '\nEnl:\t' + digits(elem.attr('data-enl'))
      + '\nRes:\t' + digits(elem.attr('data-res'));
    elem.tooltip({
      content: convertTextToTableMagic(tooltip),
      position: {my: "center bottom", at: "center top-10"}
    });
  });
  $('.cellscore', dlg).accordion({
    header: 'b',
    heightStyle: "fill",
  });
  $('input.logscale', dlg).change(function(){
    var input = $(this);
    regionScoreboardSuccess(data, dlg, input.prop('checked'));
  });
}
;
// REQUEST HANDLING //////////////////////////////////////////////////
// note: only meant for portal/links/fields request, everything else
// does not count towards “loading”
window.activeRequests = [];
window.failedRequestCount = 0;
window.statusTotalMapTiles = 0;
window.statusCachedMapTiles = 0;
window.statusSuccessMapTiles = 0;
window.statusStaleMapTiles = 0;
window.statusErrorMapTiles = 0;
window.requests = function() {}
//time of last refresh
window.requests._lastRefreshTime = 0;
window.requests._quickRefreshPending = false;
window.requests.add = function(ajax) {
  window.activeRequests.push(ajax);
  renderUpdateStatus();
}
window.requests.remove = function(ajax) {
  window.activeRequests.splice(window.activeRequests.indexOf(ajax), 1);
  renderUpdateStatus();
}
window.requests.abort = function() {
  $.each(window.activeRequests, function(ind, actReq) {
    if(actReq) actReq.abort();
  });
  window.activeRequests = [];
  window.failedRequestCount = 0;
  window.chat._requestPublicRunning  = false;
  window.chat._requestFactionRunning  = false;
  renderUpdateStatus();
}
// sets the timer for the next auto refresh. Ensures only one timeout
// is queued. May be given 'override' in milliseconds if time should
// not be guessed automatically. Especially useful if a little delay
// is required, for example when zooming.
window.startRefreshTimeout = function(override) {
  // may be required to remove 'paused during interaction' message in
  // status bar
  window.renderUpdateStatus();
  if(refreshTimeout) clearTimeout(refreshTimeout);
  if(override == -1) return;  //don't set a new timeout
  var t = 0;
  if(override) {
    window.requests._quickRefreshPending = true;
    t = override;
    //ensure override can't cause too fast a refresh if repeatedly used (e.g. lots of scrolling/zooming)
    timeSinceLastRefresh = new Date().getTime()-window.requests._lastRefreshTime;
    if(timeSinceLastRefresh
< 0) timeSinceLastRefresh = 0;  //in case of clock adjustments
    if(timeSinceLastRefresh
< MINIMUM_OVERRIDE_REFRESH*1000)
      t = (MINIMUM_OVERRIDE_REFRESH*1000-timeSinceLastRefresh);
  } else {
    window.requests._quickRefreshPending = false;
    t = REFRESH*1000;
    var adj = ZOOM_LEVEL_ADJ * (18 - map.getZoom());
    if(adj >
 0) t += adj*1000;
  }
  var next = new Date(new Date().getTime() + t).toLocaleTimeString();
//  console.log('planned refresh in ' + (t/1000) + ' seconds, at ' + next);
  refreshTimeout = setTimeout(window.requests._callOnRefreshFunctions, t);
  renderUpdateStatus();
}
window.requests._onRefreshFunctions = [];
window.requests._callOnRefreshFunctions = function() {
//  console.log('running refresh at ' + new Date().toLocaleTimeString());
  startRefreshTimeout();
  if(isIdle()) {
//    console.log('user has been idle for ' + idleTime + ' seconds, or window hidden. Skipping refresh.');
    renderUpdateStatus();
    return;
  }
//  console.log('refreshing');
  //store the timestamp of this refresh
  window.requests._lastRefreshTime = new Date().getTime();
  $.each(window.requests._onRefreshFunctions, function(ind, f) {
    f();
  });
}
// add method here to be notified of auto-refreshes
window.requests.addRefreshFunction = function(f) {
  window.requests._onRefreshFunctions.push(f);
}
window.requests.isLastRequest = function(action) {
  var result = true;
  $.each(window.activeRequests, function(ind, req) {
    if(req.action === action) {
      result = false;
      return false;
    }
  });
  return result;
}
;
// SEARCH /////////////////////////////////////////////////////////
/*
you can implement your own result provider by listing to the search hook:
addHook('search', function(query) {});
`query` is an object with the following members:
- `term` is the term for which the user has searched
- `confirmed` is a boolean indicating if the user has pressed enter after searching. You should not search online or
  heavy processing unless the user has confirmed the search term
- `addResult(result)` can be called to add a result to the query.
`result` may have the following members (`title` is required, as well as one of `position` and `bounds`):
- `title`: the label for this result. Will be interpreted as HTML, so make sure to escape properly.
- `description`: secondary information for this result. Will be interpreted as HTML, so make sure to escape properly.
- `position`: a L.LatLng object describing the position of this result
- `bounds`: a L.LatLngBounds object describing the bounds of this result
- `layer`: a ILayer to be added to the map when the user selects this search result. Will be generated if not set.
  Set to `null` to prevent the result from being added to the map.
- `icon`: a URL to a icon to display in the result list. Should be 12x12.
- `onSelected(result, event)`: a handler to be called when the result is selected. May return `true` to prevent the map
  from being repositioned. You may reposition the map yourself or do other work.
- `onRemove(result)`: a handler to be called when the result is removed from the map (because another result has been
  selected or the search was cancelled by the user).
*/
window.search = {
  lastSearch: null,
};
window.search.Query = function(term, confirmed) {
  this.term = term;
  this.confirmed = confirmed;
  this.init();
};
window.search.Query.prototype.init = function() {
  this.results = [];
  this.container = $('
<div>
').addClass('searchquery');
  this.header = $('
<h3>
')
    .text(this.confirmed
      ? this.term
      : ((this.term.length >
 16
        ? this.term.substr(0,8) + '…' + this.term.substr(this.term.length-8,8)
        : this.term)
        + ' (Return to load more)'))
    .appendTo(this.container);
  this.list = $('
<ul>
')
    .appendTo(this.container)
    .append($('
<li>
').text(this.confirmed ? 'No local results, searching online...' : 'No local results.'));
  this.container.accordion({
    collapsible: true,
    heightStyle: 'content',
  });
  runHooks('search', this);
};
window.search.Query.prototype.show = function() {
  this.container.appendTo('#searchwrapper');
};
window.search.Query.prototype.hide = function() {
  this.container.remove();
  this.removeSelectedResult();
};
window.search.Query.prototype.addResult = function(result) {
  if(this.results.length == 0) {
    // remove 'No results'
    this.list.empty();
  }
  this.results.push(result);
  var item = $('
<li>
')
    .appendTo(this.list)
    .attr('tabindex', '0')
    .on('click dblclick', function(ev) {
      this.onResultSelected(result, ev);
    }.bind(this))
    .keypress(function(ev) {
      if((ev.keyCode || ev.charCode || ev.which) == 32) {
        ev.preventDefault();
        ev.type = 'click';
        $(this).trigger(ev);
        return;
      }
      if((ev.keyCode || ev.charCode || ev.which) == 13) {
        ev.preventDefault();
        ev.type = 'dblclick';
        $(this).trigger(ev);
        return;
      }
    });
  var link = $('
<a>
')
    .append(result.title)
    .appendTo(item);
  if(result.icon) {
    link.css('background-image', 'url("'+result.icon+'")');
    item.css('list-style', 'none');
  }
  if(result.description) {
    item
      .append($('
<br>
'))
      .append($('
<em>
')
        .append(result.description));
  }
};
window.search.Query.prototype.onResultSelected = function(result, ev) {
  this.removeSelectedResult();
  this.selectedResult = result;
  if(result.onSelected) {
    if(result.onSelected(result, ev)) return;
  }
  if(ev.type == 'dblclick') {
    if(result.position) {
      map.setView(result.position, 17);
    } else if(result.bounds) {
      map.fitBounds(result.bounds, {maxZoom: 17});
    }
  } else { // ev.type != 'dblclick'
    if(result.bounds) {
      map.fitBounds(result.bounds, {maxZoom: 17});
    } else if(result.position) {
      map.setView(result.position);
    }
  }
  if(result.layer !== null && !result.layer) {
    result.layer = L.layerGroup();
    if(result.position) {
      createGenericMarker(result.position, 'red', {
        title: result.title
      }).addTo(result.layer);
    }
    if(result.bounds) {
      L.rectangle(result.bounds, {
        title: result.title,
        clickable: false,
        color: 'red',
        fill: false,
      }).addTo(result.layer);
    }
  }
  if(result.layer)
    map.addLayer(result.layer);
  if(window.isSmartphone()) window.show('map');
}
window.search.Query.prototype.removeSelectedResult = function() {
  if(this.selectedResult) {
    if(this.selectedResult.layer) map.removeLayer(this.selectedResult.layer);
    if(this.selectedResult.onRemove) this.selectedResult.onRemove(this.selectedResult);
  }
}
window.search.doSearch = function(term, confirmed) {
  term = term.trim();
  // minimum 3 characters for automatic search
  if(term.length
< 3 && !confirmed) return;
  // don't clear last confirmed search
  if(window.search.lastSearch
  && window.search.lastSearch.confirmed
  && !confirmed)
    return;
  // don't make the same query again
  if(window.search.lastSearch
  && window.search.lastSearch.confirmed == confirmed
  && window.search.lastSearch.term == term)
    return;
  if(window.search.lastSearch) window.search.lastSearch.hide();
  window.search.lastSearch = null;
  // clear results
  if(term == '') return;
  if(useAndroidPanes()) show('info');
  $('.ui-tooltip').remove();
  window.search.lastSearch = new window.search.Query(term, confirmed);
  window.search.lastSearch.show();
};
window.search.setup = function() {
  $('#search')
    .keypress(function(e) {
      if((e.keyCode ? e.keyCode : e.which) != 13) return;
      e.preventDefault();
      var term = $(this).val();
      clearTimeout(window.search.timer);
      window.search.doSearch(term, true);
    })
    .on('keyup keypress change paste', function(e) {
      clearTimeout(window.search.timer);
      window.search.timer = setTimeout(function() {
        var term = $(this).val();
        window.search.doSearch(term, false);
      }.bind(this), 500);
    });
  $('#buttongeolocation').click(function(){
    map.locate({setView : true, maxZoom: 13});
  });
};
addHook('search', function(query) {
  var term = query.term.toLowerCase();
  var teams = ['NEU','RES','ENL'];
  $.each(portals, function(guid, portal) {
    var data = portal.options.data;
    if(!data.title) return;
    if(data.title.toLowerCase().indexOf(term) !== -1) {
      var team = portal.options.team;
      var color = team==TEAM_NONE ? '#CCC' : COLORS[team];
      query.addResult({
        title: data.title,
        description: teams[team] + ', L' + data.level + ', ' + data.health + '%, ' + data.resCount + ' Resonators',
        position: portal.getLatLng(),
        icon: 'data:image/svg+xml;base64,'+btoa('
<svg xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" width="12" height="12" version="1.1">
\n
<g style="fill:%COLOR%;stroke:none">
\n
<path d="m 6,12 -2,-12  4,0 z" />
\n
<path d="m 6,12 -4, -8  8,0 z" />
\n
<path d="m 6,12 -6, -4 12,0 z" />
\n
</g>
\n
</svg>
\n'.replace(/%COLOR%/g, color)),
        onSelected: function(result, event) {
          if(event.type == 'dblclick') {
            zoomToAndShowPortal(guid, portal.getLatLng());
          } else if(window.portals[guid]) {
            if(!map.getBounds().contains(result.position)) map.setView(result.position);
            renderPortalDetails(guid);
          } else {
            window.selectPortalByLatLng(portal.getLatLng());
          }
          return true; // prevent default behavior
        },
      });
    }
  });
});
// TODO: recognize 50°31'03.8"N 7°59'05.3"E and similar formats
// TODO: if a portal with these exact coordinates is found, select it
addHook('search', function(query) {
  if(query.term.split(',').length == 2) {
    var ll = query.term.split(',');
    if(!isNaN(ll[0]) && !isNaN(ll[1])) {
      query.addResult({
        title: query.term,
        description: 'geo coordinates',
        position: L.latLng(parseFloat(ll[0]), parseFloat(ll[1])),
      });
    }
  }
});
addHook('search', function(query) {
  if(!query.confirmed) return;
  $.getJSON(NOMINATIM + encodeURIComponent(query.term), function(data) {
    if(data.length == 0) {
      query.addResult({
        title: 'No results on OpenStreetMap',
        icon: '//www.openstreetmap.org/favicon.ico',
        onSelected: function() {return true;},
      });
      return;
    }
    data.forEach(function(item) {
      var result = {
        title: item.display_name,
        description: 'Type: ' + item.type,
        position: L.latLng(parseFloat(item.lat), parseFloat(item.lon)),
        icon: item.icon,
      };
      if(item.geojson) {
        result.layer = L.geoJson(item.geojson, {
          clickable: false,
          color: 'red',
          opacity: 0.7,
          weight: 2,
          fill: false,
          pointToLayer: function(featureData,latLng) {
            return createGenericMarker(latLng,'red');
          }
        });
      }
      var b = item.boundingbox;
      if(b) {
        var southWest = new L.LatLng(b[0], b[2]),
            northEast = new L.LatLng(b[1], b[3]);
        result.bounds = new L.LatLngBounds(southWest, northEast);
      }
      query.addResult(result);
    });
  });
});
;
// posts AJAX request to Ingress API.
// action: last part of the actual URL, the rpc/dashboard. is
//         added automatically
// data: JSON data to post. method will be derived automatically from
//       action, but may be overridden. Expects to be given Hash.
//       Strings are not supported.
// success: method to call on success. See jQuery API docs for avail-
//          able arguments: http://api.jquery.com/jQuery.ajax/
// error: see above. Additionally it is logged if the request failed.
window.postAjax = function(action, data, successCallback, errorCallback) {
  // state management functions... perhaps should be outside of this func?
//  var remove = function(data, textStatus, jqXHR) { window.requests.remove(jqXHR); };
//  var errCnt = function(jqXHR) { window.failedRequestCount++; window.requests.remove(jqXHR); };
  if (window.latestFailedRequestTime && window.latestFailedRequestTime
< Date.now()-120*1000) {
    // no errors in the last two minutes - clear the error count
    window.failedRequestCount = 0;
    window.latestFailedRequestTime = undefined;
  }
  var onError = function(jqXHR, textStatus, errorThrown) {
    window.requests.remove(jqXHR);
    window.failedRequestCount++;
    window.latestFailedRequestTime = Date.now();
    // pass through to the user error func, if one exists
    if (errorCallback) {
      errorCallback(jqXHR, textStatus, errorThrown);
    }
  };
  var onSuccess = function(data, textStatus, jqXHR) {
    window.requests.remove(jqXHR);
    // the Niantic server can return a HTTP success, but the JSON response contains an error. handle that sensibly
    if (data && data.error && data.error == 'out of date') {
      window.failedRequestCount++;
      // let's call the error callback in thos case...
      if (errorCallback) {
        errorCallback(jqXHR, textStatus, "data.error == 'out of date'");
      }
      window.outOfDateUserPrompt();
    } else {
      successCallback(data, textStatus, jqXHR);
    }
  };
  // we set this flag when we want to block all requests due to having an out of date CURRENT_VERSION
  if (window.blockOutOfDateRequests) {
    window.failedRequestCount++;
    window.latestFailedRequestTime = Date.now();
    // call the error callback, if one exists
    if (errorCallback) {
      // NOTE: error called on a setTimeout - as it won't be expected to be synchronous
      // ensures no recursion issues if the error handler immediately resends the request
      setTimeout(function(){errorCallback(null, undefined, "window.blockOutOfDateRequests is set");}, 10);
    }
    return;
  }
  var versionStr = niantic_params.CURRENT_VERSION;
  var post_data = JSON.stringify($.extend({}, data, {v: versionStr}));
  var result = $.ajax({
    url: '/r/'+action,
    type: 'POST',
    data: post_data,
    context: data,
    dataType: 'json',
    success: [onSuccess],
    error: [onError],
    contentType: 'application/json; charset=utf-8',
    beforeSend: function(req) {
      req.setRequestHeader('X-CSRFToken', readCookie('csrftoken'));
    }
  });
  result.action = action;
  requests.add(result);
  return result;
}
window.outOfDateUserPrompt = function()
{
  // we block all requests while the dialog is open.
  if (!window.blockOutOfDateRequests) {
    window.blockOutOfDateRequests = true;
    dialog({
      title: 'Reload IITC',
      html: '
<p>
IITC is using an outdated version code. This will happen when Niantic update the standard intel site.
</p>
'
           +'
<p>
You need to reload the page to get the updated changes.
</p>
'
           +'
<p>
If you have just reloaded the page, then an old version of the standard site script is cached somewhere.'
           +'In this case, try clearing your cache, or waiting 15-30 minutes for the stale data to expire.
</p>
',
      buttons: {
        'RELOAD': function() {
          if (typeof android !== 'undefined' && android && android.reloadIITC) {
            android.reloadIITC();
          } else {
            window.location.reload();
          }
        }
      },
      close: function(event, ui) {
        delete window.blockOutOfDateRequests;
      }
    });
  }
}
;
window.isSmartphone = function() {
  // this check is also used in main.js. Note it should not detect
  // tablets because their display is large enough to use the desktop
  // version.
  // The stock intel site allows forcing mobile/full sites with a vp=m or vp=f
  // parameter - let's support the same. (stock only allows this for some
  // browsers - e.g. android phone/tablet. let's allow it for all, but
  // no promises it'll work right)
  var viewParam = getURLParam('vp');
  if (viewParam == 'm') return true;
  if (viewParam == 'f') return false;
  return navigator.userAgent.match(/Android.*Mobile/);
}
window.smartphone = function() {};
window.runOnSmartphonesBeforeBoot = function() {
  if(!isSmartphone()) return;
  console.warn('running smartphone pre boot stuff');
  // add smartphone stylesheet
  headHTML = document.getElementsByTagName('head')[0].innerHTML;
  headHTML += '
<style>
body {\n  color: #fff;\n}\n\n#updatestatus {\n  background: #262c32;\n  width: 100%;\n  color: #d4d5d6;\n  border: 0;\n  padding: 0;\n}\n\n#updatestatus .map {\n  margin-left: 4px;\n}\n\n#innerstatus {\n  padding: 4px;\n  float: right;\n  width: 50%;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n  overflow: hidden;\n  -moz-box-sizing: border-box;\n  -webkit-box-sizing: border-box;\n  box-sizing: border-box;\n}\n\n#loadlevel {\n  border-width: 0;\n  background: transparent;\n  color: #FFF;\n}\n\n#mobileinfo {\n  float: left;\n  width: 50%;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n  overflow: hidden;\n  position:relative;\n  padding: 4px 0;\n  -moz-box-sizing: border-box;\n  -webkit-box-sizing: border-box;\n  box-sizing: border-box;\n}\n\n#mobileinfo .portallevel {\n  padding: 0 0.25em;\n  color: #FFF;\n}\n\n#mobileinfo .resonator {\n  position: absolute;\n  width: 12%; /* a little less that 1/8 to have a small distance */\n  height: 100%;\n  top: 0;\n  border-top: 3px solid red;\n  box-sizing: border-box;\n  -moz-box-sizing: border-box;\n  -webkit-box-sizing: border-box;\n}\n\n#mobileinfo .resonator.north:before {\n  content: "";\n  background-color: red;\n  border-radius: 100%;\n  display: block;\n  height: 6px;\n  width: 6px;\n  left: 50%;\n  top: -3px; \n  margin-left: -3px;\n  position: absolute;\n  z-index: -1;\n}\n\n#mobileinfo .filllevel {\n  position: absolute;\n  bottom: 0;\n  height: 3px;\n}\n\n#mobileinfo .enl .filllevel {\n  background-color: #03fe03 !important;\n}\n\n#mobileinfo .res .filllevel {\n  background-color: #00c5ff !important;\n}\n\n#name #signout { /* no hover, always show signout button */\n  display: block;\n}\n\n#sidebar, #chatcontrols, #chat, #chatinput {\n  background: transparent !important;\n}\n\n.leaflet-top .leaflet-control {\n  margin-top: 5px !important;\n  margin-left: 5px !important;\n}\n\n#searchwrapper {\n  font-size: 1.2em;\n}\n#searchwrapper .ui-accordion-header {\n  padding: 0.3em 0;\n}\n#searchwrapper li {\n  line-height: 1.3em;\n}\n\n#chatcontrols {\n  height: 38px;\n  width: 100%;\n  display: none !important;\n}\n\n/* hide shrink button */\n#chatcontrols a:first-child {\n  display: none;\n}\n\n#chatcontrols a {\n  width: 50px;\n  height:36px;\n  overflow: hidden;\n  vertical-align: middle;\n  line-height: 36px;\n  text-decoration: none;\n  -moz-box-sizing: border-box;\n  -webkit-box-sizing: border-box;\n  box-sizing: border-box;\n}\n\n#chat {\n  left:0;\n  right:0;\n  top: 1px !important;\n  bottom:30px;\n  width: auto;\n}\n\n#chatinput {\n  width: 100%;\n  height: 30px;\n}\n\n#chat td:nth-child(2), #chatinput td:nth-child(2) {\n  width: 77px;\n}\n\n#chatcontrols a.active {\n  border-color: #FFCE00;\n  border-bottom-width:0px;\n  font-weight:bold\n}\n\n#chatcontrols a.active + a {\n  border-left-color: #FFCE00\n}\n\n#sidebartoggle {\n  display: none !important;\n}\n\n#scrollwrapper {\n  bottom: 0;\n  max-height: none !important;\n  width: 100% !important;\n  right: 0;\n  left:0;\n}\n\n#sidebar {\n  width: 100% !important;\n  min-height: 100%;\n  border:0;\n}\n\n#sidebar >
 * {\n  width: 100%;\n}\n\n#playerstat {\n  margin-top: 5px;\n}\n\n#portaldetails {\n  min-height: 0;\n}\n\n.fullimg {\n  width: 100%;\n}\n\n/*\n * for some reason leaflet popups on mobile are colored white on white\n * so force the popup msg color to black\n */\n.leaflet-popup-content{\n    color:black;\n}\n\n\n/* add extra padding, and a button effect, to sidebar link areas */\n.linkdetails aside  {\n  padding: 5px;\n  margin-top: 3px;\n  margin-bottom: 3px;\n  border: 2px outset #20A8B1;\n}\n\n#toolbox >
 a {\n  padding: 5px;\n  margin-top: 3px;\n  margin-bottom: 3px;\n  border: 2px outset #20A8B1;\n}\n\n#portaldetails .close {\n  padding: 4px;\n  border: 1px outset #20A8B1;\n  margin-top: 2px;\n}\n
</style>
';
  document.getElementsByTagName('head')[0].innerHTML = headHTML;
  // don’t need many of those
  window.setupStyles = function() {
    $('head').append('
<style>
' +
      [ '#largepreview.enl img { border:2px solid '+COLORS[TEAM_ENL]+'; } ',
        '#largepreview.res img { border:2px solid '+COLORS[TEAM_RES]+'; } ',
        '#largepreview.none img { border:2px solid '+COLORS[TEAM_NONE]+'; } '].join("\n")
      + '
</style>
');
  }
  window.smartphone.mapButton = $('
<a>
map
</a>
').click(function() {
    $('#map').css('visibility', 'visible');
    $('#updatestatus').show();
    $('#chatcontrols a .active').removeClass('active');
    $("#chatcontrols a:contains('map')").addClass('active');
  });
  window.smartphone.sideButton = $('
<a>
info
</a>
').click(function() {
    $('#scrollwrapper').show();
    $('.active').removeClass('active');
    $("#chatcontrols a:contains('info')").addClass('active');
  });
  $('#chatcontrols').append(smartphone.mapButton).append(smartphone.sideButton);
  window.addHook('portalDetailsUpdated', function(data) {
    var x = $('.imgpreview img').removeClass('hide');
    if(!x.length) {
      $('.fullimg').remove();
      return;
    }
    if($('.fullimg').length) {
      $('.fullimg').replaceWith(x.addClass('fullimg'));
    } else {
      x.addClass('fullimg').appendTo('#sidebar');
    }
  });
}
window.smartphoneInfo = function(data) {
  var guid = data.selectedPortalGuid;
  if(!window.portals[guid]) return;
  var data = window.portals[selectedPortal].options.data;
  var details = window.portalDetail.get(guid);
  var lvl = data.level;
  if(data.team === "NEUTRAL")
    var t = '
<span class="portallevel">
L0
</span>
';
  else
    var t = '
<span class="portallevel" style="background: '+COLORS_LVL[lvl]+';">
L' + lvl + '
</span>
';
  var percentage = data.health;
  if(details) {
    var totalEnergy = getTotalPortalEnergy(details);
    if(getTotalPortalEnergy(details) >
 0) {
      percentage = Math.floor(getCurrentPortalEnergy(details) / totalEnergy * 100);
    }
  }
  t += ' ' + percentage + '% ';
  t += data.title;
  if(details) {
    var l,v,max,perc;
    var eastAnticlockwiseToNorthClockwise = [2,1,0,7,6,5,4,3];
    for(var ind=0;ind
<8;ind++)
    {
      if (details.resonators.length == 8) {
        var slot = eastAnticlockwiseToNorthClockwise[ind];
        var reso = details.resonators[slot];
      } else {
        var slot = null;
        var reso = ind
< details.resonators.length ? details.resonators[ind] : null;
      }
      var className = TEAM_TO_CSS[getTeam(details)];
      if(slot !== null && OCTANTS[slot] === 'N')
        className += ' north'
      if(reso) {
        l = parseInt(reso.level);
        v = parseInt(reso.energy);
        max = RESO_NRG[l];
        perc = v/max*100;
      } else {
        l = 0;
        v = 0;
        max = 0;
        perc = 0;
      }
      t += '
<div class="resonator '+className+'" style="border-top-color: '+COLORS_LVL[l]+';left: '+(100*ind/8.0)+'%;">
';
      t += '
<div class="filllevel" style="width:'+perc+'%;">
</div>
';
      t += '
</div>
'
    }
  }
  $('#mobileinfo').html(t);
}
window.runOnSmartphonesAfterBoot = function() {
  if(!isSmartphone()) return;
  console.warn('running smartphone post boot stuff');
  window.show('map');
  // add a div/hook for updating mobile info
  $('#updatestatus').prepend('
<div id="mobileinfo" onclick="show(\'info\')">
</div>
');
  window.addHook('portalSelected', window.smartphoneInfo);
  // init msg of status bar. hint for the user that a tap leads to the info screen
  $('#mobileinfo').html('
<div style="text-align: center">
<b>
tap here for info screen
</b>
</div>
');
  // disable img full view
  $('#portaldetails').off('click', '**');
  // make buttons in action bar flexible
  var l = $('#chatcontrols a:visible');
  l.css('width', 100/l.length + '%');
  // notify android that a select spinner is enabled.
  // this disables javascript injection on android side.
  // if android is not notified, the spinner closes on the next JS call
  if (typeof android !== 'undefined' && android && android.spinnerEnabled) {
    $("body").on("click", "select", function() {
      android.spinnerEnabled(true);
    });
  }
  // add event to portals that allows long press to switch to sidebar
  window.addHook('portalAdded', function(data) {
    data.portal.on('add', function() {
      if(!this._container || this.options.addedTapHoldHandler) return;
      this.options.addedTapHoldHandler = true;
      var guid = this.options.guid;
      // this is a hack, accessing Leaflet’s private _container is evil
      $(this._container).on('taphold', function() {
        window.renderPortalDetails(guid);
        window.show('info');
      });
    });
  });
  if(typeof android !== 'undefined' && android && android.setPermalink) {
    window.map.on('moveend', window.setAndroidPermalink);
    addHook('portalSelected', window.setAndroidPermalink);
  }
  // for some reason, leaflet misses the WebView size being set at startup on IITC Mobile
  // create a short timer that checks for this issue
  setTimeout (function() { map.invalidateSize(); }, 0.2*1000);
}
window.setAndroidPermalink = function() {
  var c = window.map.getCenter();
  var lat = Math.round(c.lat*1E6)/1E6;
  var lng = Math.round(c.lng*1E6)/1E6;
  var href = '/intel?ll='+lat+','+lng+'&z=' + map.getZoom();
  if(window.selectedPortal && window.portals[window.selectedPortal]) {
    var p = window.portals[window.selectedPortal].getLatLng();
    lat = Math.round(p.lat*1E6)/1E6;
    lng = Math.round(p.lng*1E6)/1E6;
    href += '&pll='+lat+','+lng;
  }
  href = $('
<a>
').prop('href',  href).prop('href'); // to get absolute URI
  android.setPermalink(href);
}
window.useAndroidPanes = function() {
  // isSmartphone is important to disable panes in desktop mode
  return (typeof android !== 'undefined' && android && android.addPane && window.isSmartphone());
}
if(typeof android !== 'undefined' && android && android.getFileRequestUrlPrefix) {
  window.requestFile = function(callback) {
    do {
      var funcName = "onFileSelected" + parseInt(Math.random()*0xFFFF).toString(16);
    } while(window[funcName] !== undefined)
    window[funcName] = function(filename, content) {
      callback(decodeURIComponent(filename), atob(content));
    };
    var script = document.createElement('script');
    script.src = android.getFileRequestUrlPrefix() + funcName;
    (document.body || document.head || document.documentElement).appendChild(script);
  };
}
;
// STATUS BAR ///////////////////////////////////////
// gives user feedback about pending operations. Draws current status
// to website. Updates info in layer chooser.
window.renderUpdateStatusTimer_ = undefined;
window.renderUpdateStatus = function() {
  var progress = 1;
  // portal/limk level display
  var zoom = map.getZoom();
  zoom = getDataZoomForMapZoom(zoom);
  var tileParams = getMapZoomTileParameters(zoom);
  var t = '
<span class="help portallevel" title="Indicates portal levels/link lengths displayed.  Zoom in to display more.">
';
  if (tileParams.hasPortals) {
    // zoom level includes portals (and also all links/fields)
    if(!window.isSmartphone()) // space is valuable
      t += '
<b>
portals
</b>
: ';
    if(tileParams.level === 0)
      t += '
<span id="loadlevel">
all
</span>
';
    else
      t += '
<span id="loadlevel" style="background:'+COLORS_LVL[tileParams.level]+'">
L'+tileParams.level+(tileParams.level
<8?'+':'') + '
</span>
';
  } else {
    if(!window.isSmartphone()) // space is valuable
      t += '
<b>
links
</b>
: ';
    if (tileParams.minLinkLength >
 0)
      t += '
<span id="loadlevel">
&gt;'+(tileParams.minLinkLength>
1000?tileParams.minLinkLength/1000+'km':tileParams.minLinkLength+'m')+'
</span>
';
    else
      t += '
<span id="loadlevel">
all links
</span>
';
  }
  t +='
</span>
';
  // map status display
  t += '
<span class="map">
<b>
map
</b>
: ';
  if (window.mapDataRequest) {
    var status = window.mapDataRequest.getStatus();
    // status.short - short description of status
    // status.long - longer description, for tooltip (optional)
    // status.progress - fractional progress (from 0 to 1; -1 for indeterminate) of current state (optional)
    if (status.long)
      t += '
<span class="help" title="'+status.long+'">
'+status.short+'
</span>
';
    else
      t += '
<span>
'+status.short+'
</span>
';
    if (status.progress !== undefined) {
      if(status.progress !== -1)
        t += ' '+Math.floor(status.progress*100)+'%';
      progress = status.progress;
    }
  } else {
    // no mapDataRequest object - no status known
    t += '...unknown...';
  }
  t += '
</span>
';
  //request status
  if (window.activeRequests.length >
 0)
    t += ' ' + window.activeRequests.length + ' requests';
  if (window.failedRequestCount >
 0)
    t += '
<span style="color:#f66">
' + window.failedRequestCount + ' failed
</span>
'
  //it's possible that updating the status bar excessively causes some performance issues. so rather than doing it
  //immediately, delay it to the next javascript event loop, cancelling any pending update
  // will also cause any browser-related rendering to occur first, before the status actually updates
  if (window.renderUpdateStatusTimer_) clearTimeout(window.renderUpdateStatusTimer_);
  window.renderUpdateStatusTimer_ = setTimeout ( function() {
    window.renderUpdateStatusTimer_ = undefined;
    $('#innerstatus').html(t);
    //$('#updatestatus').click(function() { startRefreshTimeout(10); });
    //.
<a style="cursor: pointer" onclick="startRefreshTimeout(10)" title="Refresh">
⟳
</a>
';
    if(progress == 1 && window.activeRequests.length >
 0) {
      // we don't know the exact progress, but we have requests (e.g. chat) running, so show it as indeterminate.
      progress = -1;
    }
    if (typeof android !== 'undefined' && android && android.setProgress)
      android.setProgress(progress);
  }, 0);
}
;
// UTILS + MISC  ///////////////////////////////////////////////////////
window.aboutIITC = function() {
  var v = (script_info.script && script_info.script.version || script_info.dateTimeVersion) + ' ['+script_info.buildName+']';
  if (typeof android !== 'undefined' && android && android.getVersionName) {
    v += '[IITC Mobile '+android.getVersionName()+']';
  }
  var plugins = '
<ul>
';
  for (var i in bootPlugins) {
    var info = bootPlugins[i].info;
    if (info) {
      var pname = info.script && info.script.name || info.pluginId;
      if (pname.substr(0,13) == 'IITC plugin: ' || pname.substr(0,13) == 'IITC Plugin: ') {
        pname = pname.substr(13);
      }
      var pvers = info.script && info.script.version || info.dateTimeVersion;
      var ptext = pname + ' - ' + pvers;
      if (info.buildName != script_info.buildName) {
        ptext += ' ['+(info.buildName||'
<i>
non-standard plugin
</i>
')+']';
      }
      plugins += '
<li>
'+ptext+'
</li>
';
    } else {
      // no 'info' property of the plugin setup function - old plugin wrapper code
      // could attempt to find the "window.plugin.NAME = function() {};" line it's likely to have..?
      plugins += '
<li>
(unknown plugin: index '+i+')
</li>
';
    }
  }
  plugins += '
</ul>
';
  var attrib = '
<p>
This project is licensed under the permissive
<a href="http://www.isc.org/downloads/software-support-policy/isc-license/">
ISC license
</a>
. Parts imported from other projects remain under their respective licenses:
</p>
\n\n
<ul>
\n
<li>
<a href="https://github.com/bryanwoods/autolink-js">
autolink-js by Bryan Woods; MIT
</a>
</li>
\n
<li>
<a href="https://github.com/chriso/load.js">
load.js by Chris O\'Hara; MIT
</a>
</li>
\n
<li>
<a href="http://leafletjs.com/">
leaflet.js; custom license (but appears free)
</a>
</li>
\n
<li>
<a href="https://github.com/Leaflet/Leaflet.draw">
leaflet.draw.js by jacobtoye; MIT
</a>
</li>
\n
<li>
\n
<a href="https://github.com/shramov/leaflet-plugins">
leaflet_google.js by Pavel Shramov; same as Leaflet
</a>
 (modified, though)
</li>
\n
<li>
<a href="https://github.com/jeromeetienne/jquery-qrcode">
jquery.qrcode.js by Jerome Etienne; MIT
</a>
</li>
\n
<li>
<a href="https://github.com/jawj/OverlappingMarkerSpiderfier-Leaflet">
oms.min.js by George MacKerron; MIT
</a>
</li>
\n
<li>
<a href="https://github.com/richadams/jquery-taphold">
taphold.js by Rich Adams; unknown
</a>
</li>
\n
<li>
<a href="https://github.com/kartena/Leaflet.Pancontrol">
L.Control.Pan.js by Kartena AB; same as Leaflet
</a>
</li>
\n
<li>
<a href="https://github.com/kartena/Leaflet.zoomslider">
L.Control.Zoomslider.js by Kartena AB; same as Leaflet
</a>
</li>
\n
<li>
<a href="https://github.com/shramov/leaflet-plugins">
KML.js by shramov; same as Leaflet
</a>
</li>
\n
<li>
<a href="https://github.com/shramov/leaflet-plugins">
leaflet.filelayer.js by shramov; same as Leaflet
</a>
</li>
\n
<li>
<a href="https://github.com/shramov/leaflet-plugins">
togeojson.js by shramov; same as Leaflet
</a>
</li>
\n
<li>
StackOverflow-CopyPasta is attributed in the source;
<a href="https://creativecommons.org/licenses/by-sa/3.0/">
CC-Wiki
</a>
\n
</li>
\n
<li>
all Ingress/Niantic related stuff obviously remains non-free and is still copyrighted by Niantic/Google
</li>
\n
</ul>
';
  var contrib = '
<p>
So far, these people have contributed:
</p>
\n\n
<p>
<a href="https://github.com/Bananeweizen">
Bananeweizen
</a>
,\n
<a href="https://github.com/blakjakau">
blakjakau
</a>
,\n
<a href="https://github.com/boombuler">
boombuler
</a>
,\n
<a href="https://github.com/breunigs">
breunigs
</a>
,\n
<a href="https://github.com/cathesaurus">
cathesaurus
</a>
,\n
<a href="https://github.com/ccjon">
ccjon
</a>
,\n
<a href="https://github.com/cmrn">
cmrn
</a>
,\n
<a href="https://github.com/epf">
epf
</a>
,\n
<a href="https://github.com/fkloft">
fkloft
</a>
,\n
<a href="https://github.com/Fragger">
Fragger
</a>
,\n
<a href="https://github.com/hastarin">
hastarin
</a>
,\n
<a href="https://github.com/integ3r">
integ3r
</a>
,\n
<a href="https://github.com/j16sdiz">
j16sdiz
</a>
,\n
<a href="https://github.com/JasonMillward">
JasonMillward
</a>
,\n
<a href="https://github.com/jonatkins">
jonatkins
</a>
,\n
<a href="https://github.com/leCradle">
leCradle
</a>
,\n
<a href="https://github.com/Merovius">
Merovius
</a>
,\n
<a href="https://github.com/mledoze">
mledoze
</a>
,\n
<a href="https://github.com/OshiHidra">
OshiHidra
</a>
,\n
<a href="https://github.com/phoenixsong6">
phoenixsong6
</a>
,\n
<a href="https://github.com/Pirozek">
Pirozek
</a>
,\n
<a href="https://github.com/saithis">
saithis
</a>
,\n
<a href="https://github.com/Scrool">
Scrool
</a>
,\n
<a href="https://github.com/sorgo">
sorgo
</a>
,\n
<a href="https://github.com/tpenner">
tpenner
</a>
,\n
<a href="https://github.com/vita10gy">
vita10gy
</a>
,\n
<a href="https://github.com/Xelio">
Xelio
</a>
,\n
<a href="https://github.com/ZauberNerd">
ZauberNerd
</a>
,\n
<a href="https://github.com/waynn">
waynn
</a>
</p>
'
  var a = ''
  + '
<div>
<b>
About IITC
</b>
</div>
 '
  + '
<div>
Ingress Intel Total Conversion
</div>
 '
  + '
<hr>
'
  + '
<div>
'
  + '
<a href="http://iitc.jonatkins.com/" target="_blank">
IITC Homepage
</a>
<br />
'
  + '     On the script’s homepage you can:'
  + '
<ul>
'
  + '
<li>
Find Updates
</li>
'
  + '
<li>
Get Plugins
</li>
'
  + '
<li>
Report Bugs
</li>
'
  + '
<li>
Contribute!
</li>
'
  + '
</ul>
'
  + '
</div>
'
  + '
<div>
'
  + '    MapQuest OSM tiles Courtesy of
<a href="http://www.mapquest.com/" target="_blank">
MapQuest
</a>

<img src="https://developer.mapquest.com/content/osm/mq_logo.png">
'
  + '
</div>
'
  + '
<hr>
'
  + '
<div>
Version: ' + v + '
</div>
'
  + '
<div>
Plugins: ' + plugins + '
</div>
'
  + '
<hr>
'
  + '
<div>
' + attrib + '
</div>
'
  + '
<hr>
'
  + '
<div>
' + contrib + '
</div>
';
  dialog({
    title: 'IITC ' + v,
    html: a,
    dialogClass: 'ui-dialog-aboutIITC'
  });
}
window.layerGroupLength = function(layerGroup) {
  var layersCount = 0;
  var layers = layerGroup._layers;
  if (layers)
    layersCount = Object.keys(layers).length;
  return layersCount;
}
// retrieves parameter from the URL?query=string.
window.getURLParam = function(param) {
  var items = window.location.search.substr(1).split('&');
  if (items == "") return "";
  for (var i=0; i
<items.length; i++) {
    var item = items[i].split('=');
    if (item[0] == param) {
      var val = item.length==1 ? '' : decodeURIComponent (item[1].replace(/\+/g,' '));
      return val;
    }
  }
  return '';
}
// read cookie by name.
// http://stackoverflow.com/a/5639455/1684530 by cwolves
window.readCookie = function(name){
  var C, i, c = document.cookie.split('; ');
  var cookies = {};
  for(i=c.length-1; i>
=0; i--){
    C = c[i].split('=');
    cookies[C[0]] = unescape(C[1]);
  }
  return cookies[name];
}
window.writeCookie = function(name, val) {
  var d = new Date(Date.now() + 10 * 365 * 24 * 60 * 60 * 1000).toUTCString();
  document.cookie = name + "=" + val + '; expires='+d+'; path=/';
}
window.eraseCookie = function(name) {
  document.cookie = name + '=; expires=Thu, 1 Jan 1970 00:00:00 GMT; path=/';
}
//certain values were stored in cookies, but we're better off using localStorage instead - make it easy to convert
window.convertCookieToLocalStorage = function(name) {
  var cookie=readCookie(name);
  if(cookie !== undefined) {
    console.log('converting cookie '+name+' to localStorage');
    if(localStorage[name] === undefined) {
      localStorage[name] = cookie;
    }
    eraseCookie(name);
  }
}
// add thousand separators to given number.
// http://stackoverflow.com/a/1990590/1684530 by Doug Neiner.
window.digits = function(d) {
  // U+2009 - Thin Space. Recommended for use as a thousands separator...
  // https://en.wikipedia.org/wiki/Space_(punctuation)#Table_of_spaces
  return (d+"").replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1&#8201;");
}
window.zeroPad = function(number,pad) {
  number = number.toString();
  var zeros = pad - number.length;
  return Array(zeros>
0?zeros+1:0).join("0") + number;
}
// converts javascript timestamps to HH:mm:ss format if it was today;
// otherwise it returns YYYY-MM-DD
window.unixTimeToString = function(time, full) {
  if(!time) return null;
  var d = new Date(typeof time === 'string' ? parseInt(time) : time);
  var time = d.toLocaleTimeString();
//  var time = zeroPad(d.getHours(),2)+':'+zeroPad(d.getMinutes(),2)+':'+zeroPad(d.getSeconds(),2);
  var date = d.getFullYear()+'-'+zeroPad(d.getMonth()+1,2)+'-'+zeroPad(d.getDate(),2);
  if(typeof full !== 'undefined' && full) return date + ' ' + time;
  if(d.toDateString() == new Date().toDateString())
    return time;
  else
    return date;
}
// converts a javascript time to a precise date and time (optionally with millisecond precision)
// formatted in ISO-style YYYY-MM-DD hh:mm:ss.mmm - but using local timezone
window.unixTimeToDateTimeString = function(time, millisecond) {
  if(!time) return null;
  var d = new Date(typeof time === 'string' ? parseInt(time) : time);
  return d.getFullYear()+'-'+zeroPad(d.getMonth()+1,2)+'-'+zeroPad(d.getDate(),2)
    +' '+zeroPad(d.getHours(),2)+':'+zeroPad(d.getMinutes(),2)+':'+zeroPad(d.getSeconds(),2)+(millisecond?'.'+zeroPad(d.getMilliseconds(),3):'');
}
window.unixTimeToHHmm = function(time) {
  if(!time) return null;
  var d = new Date(typeof time === 'string' ? parseInt(time) : time);
  var h = '' + d.getHours(); h = h.length === 1 ? '0' + h : h;
  var s = '' + d.getMinutes(); s = s.length === 1 ? '0' + s : s;
  return  h + ':' + s;
}
window.formatInterval = function(seconds,maxTerms) {
  var d = Math.floor(seconds / 86400);
  var h = Math.floor((seconds % 86400) / 3600);
  var m = Math.floor((seconds % 3600) / 60);
  var s = seconds % 60;
  var terms = [];
  if (d >
 0) terms.push(d+'d');
  if (h >
 0) terms.push(h+'h');
  if (m >
 0) terms.push(m+'m');
  if (s >
 0 || terms.length==0) terms.push(s+'s');
  if (maxTerms) terms = terms.slice(0,maxTerms);
  return terms.join(' ');
}
window.rangeLinkClick = function() {
  if(window.portalRangeIndicator)
    window.map.fitBounds(window.portalRangeIndicator.getBounds());
  if(window.isSmartphone())
    window.show('map');
}
window.showPortalPosLinks = function(lat, lng, name) {
  var encoded_name = 'undefined';
  if(name !== undefined) {
    encoded_name = encodeURIComponent(name);
  }
  if (typeof android !== 'undefined' && android && android.intentPosLink) {
    android.intentPosLink(lat, lng, map.getZoom(), name, true);
  } else {
    var qrcode = '
<div id="qrcode">
</div>
';
    var script = '
<script>
$(\'#qrcode\').qrcode({text:\'GEO:'+lat+','+lng+'\'});
</script>
';
    var gmaps = '
<a href="https://maps.google.com/maps?ll='+lat+','+lng+'&q='+lat+','+lng+'%20('+encoded_name+')">
Google Maps
</a>
';
    var bingmaps = '
<a href="http://www.bing.com/maps/?v=2&cp='+lat+'~'+lng+'&lvl=16&sp=Point.'+lat+'_'+lng+'_'+encoded_name+'___">
Bing Maps
</a>
';
    var osm = '
<a href="http://www.openstreetmap.org/?mlat='+lat+'&mlon='+lng+'&zoom=16">
OpenStreetMap
</a>
';
    var latLng = '
<span>
&lt;' + lat + ',' + lng +'&gt;
</span>
';
    dialog({
      html: '
<div style="text-align: center;">
' + qrcode + script + gmaps + '; ' + bingmaps + '; ' + osm + '
<br />
' + latLng + '
</div>
',
      title: name,
      id: 'poslinks'
    });
  }
}
window.isTouchDevice = function() {
  return 'ontouchstart' in window // works on most browsers
      || 'onmsgesturechange' in window; // works on ie10
};
window.androidCopy = function(text) {
  if(typeof android === 'undefined' || !android || !android.copy)
    return true; // i.e. execute other actions
  else
    android.copy(text);
  return false;
}
window.androidPermalink = function() {
  if(typeof android === 'undefined' || !android || !android.intentPosLink)
    return true; // i.e. execute other actions
  var center = map.getCenter();
  android.intentPosLink(center.lat, center.lng, map.getZoom(), "Selected map view", false);
  return false;
}
window.getMinPortalLevel = function() {
  var z = map.getZoom();
  z = getDataZoomForMapZoom(z);
  return getMapZoomTileParameters(z).level;
}
// returns number of pixels left to scroll down before reaching the
// bottom. Works similar to the native scrollTop function.
window.scrollBottom = function(elm) {
  if(typeof elm === 'string') elm = $(elm);
  return elm.get(0).scrollHeight - elm.innerHeight() - elm.scrollTop();
}
window.zoomToAndShowPortal = function(guid, latlng) {
  map.setView(latlng, 17);
  // if the data is available, render it immediately. Otherwise defer
  // until it becomes available.
  if(window.portals[guid])
    renderPortalDetails(guid);
  else
    urlPortal = guid;
}
window.selectPortalByLatLng = function(lat, lng) {
  if(lng === undefined && lat instanceof Array) {
    lng = lat[1];
    lat = lat[0];
  } else if(lng === undefined && lat instanceof L.LatLng) {
    lng = lat.lng;
    lat = lat.lat;
  }
  for(var guid in window.portals) {
    var latlng = window.portals[guid].getLatLng();
    if(latlng.lat == lat && latlng.lng == lng) {
      renderPortalDetails(guid);
      return;
    }
  }
  // not currently visible
  urlPortalLL = [lat, lng];
  map.setView(urlPortalLL, 17);
};
String.prototype.capitalize = function() {
    return this.charAt(0).toUpperCase() + this.slice(1).toLowerCase();
}
// http://stackoverflow.com/a/646643/1684530 by Bergi and CMS
if (typeof String.prototype.startsWith !== 'function') {
  String.prototype.startsWith = function (str){
    return this.slice(0, str.length) === str;
  };
}
// escape a javascript string, so quotes and backslashes are escaped with a backslash
// (for strings passed as parameters to html onclick="..." for example)
window.escapeJavascriptString = function(str) {
  return (str+'').replace(/[\\"']/g,'\\$&');
}
//escape special characters, such as tags
window.escapeHtmlSpecialChars = function(str) {
  var div = document.createElement(div);
  var text = document.createTextNode(str);
  div.appendChild(text);
  return div.innerHTML;
}
window.prettyEnergy = function(nrg) {
  return nrg>
 1000 ? Math.round(nrg/1000) + ' k': nrg;
}
window.setPermaLink = function(elm) {
  var c = map.getCenter();
  var lat = Math.round(c.lat*1E6)/1E6;
  var lng = Math.round(c.lng*1E6)/1E6;
  var qry = 'll='+lat+','+lng+'&z=' + map.getZoom();
  $(elm).attr('href',  '/intel?' + qry);
}
window.uniqueArray = function(arr) {
  return $.grep(arr, function(v, i) {
    return $.inArray(v, arr) === i;
  });
}
window.genFourColumnTable = function(blocks) {
  var t = $.map(blocks, function(detail, index) {
    if(!detail) return '';
    var title = detail[2] ? ' title="'+escapeHtmlSpecialChars(detail[2]) + '"' : '';
    if(index % 2 === 0)
      return '
<tr>
<td'+title+'>
'+detail[1]+'
</td>
<th'+title+'>
'+detail[0]+'
</th>
';
    else
      return '
<th'+title+'>
'+detail[0]+'
</th>
<td'+title+'>
'+detail[1]+'
</td>
</tr>
';
  }).join('');
  if(t.length % 2 === 1) t + '
<td>
</td>
<td>
</td>
</tr>
';
  return t;
}
// converts given text with newlines (\n) and tabs (\t) to a HTML
// table automatically.
window.convertTextToTableMagic = function(text) {
  // check if it should be converted to a table
  if(!text.match(/\t/)) return text.replace(/\n/g, '
<br>
');
  var data = [];
  var columnCount = 0;
  // parse data
  var rows = text.split('\n');
  $.each(rows, function(i, row) {
    data[i] = row.split('\t');
    if(data[i].length >
 columnCount) columnCount = data[i].length;
  });
  // build the table
  var table = '
<table>
';
  $.each(data, function(i, row) {
    table += '
<tr>
';
    $.each(data[i], function(k, cell) {
      var attributes = '';
      if(k === 0 && data[i].length
< columnCount) {
        attributes = ' colspan="'+(columnCount - data[i].length + 1)+'"';
      }
      table += '
<td'+attributes+'>
'+cell+'
</td>
';
    });
    table += '
</tr>
';
  });
  table += '
</table>
';
  return table;
}
// Given 3 sets of points in an array[3]{lat, lng} returns the area of the triangle
window.calcTriArea = function(p) {
  return Math.abs((p[0].lat*(p[1].lng-p[2].lng)+p[1].lat*(p[2].lng-p[0].lng)+p[2].lat*(p[0].lng-p[1].lng))/2);
}
// Update layerGroups display status to window.overlayStatus and localStorage 'ingress.intelmap.layergroupdisplayed'
window.updateDisplayedLayerGroup = function(name, display) {
  overlayStatus[name] = display;
  localStorage['ingress.intelmap.layergroupdisplayed'] = JSON.stringify(overlayStatus);
}
// Read layerGroup status from window.overlayStatus if it was added to map,
// read from cookie if it has not added to map yet.
// return 'defaultDisplay' if both overlayStatus and cookie didn't have the record
window.isLayerGroupDisplayed = function(name, defaultDisplay) {
  if(typeof(overlayStatus[name]) !== 'undefined') return overlayStatus[name];
  convertCookieToLocalStorage('ingress.intelmap.layergroupdisplayed');
  var layersJSON = localStorage['ingress.intelmap.layergroupdisplayed'];
  if(!layersJSON) return defaultDisplay;
  var layers = JSON.parse(layersJSON);
  // keep latest overlayStatus
  overlayStatus = $.extend(layers, overlayStatus);
  if(typeof(overlayStatus[name]) === 'undefined') return defaultDisplay;
  return overlayStatus[name];
}
window.addLayerGroup = function(name, layerGroup, defaultDisplay) {
  if (defaultDisplay === undefined) defaultDisplay = true;
  if(isLayerGroupDisplayed(name, defaultDisplay)) map.addLayer(layerGroup);
  layerChooser.addOverlay(layerGroup, name);
}
window.clampLat = function(lat) {
  // the map projection used does not handle above approx +- 85 degrees north/south of the equator
  if (lat >
 85.051128)
    lat = 85.051128;
  else if (lat
< -85.051128)
    lat = -85.051128;
  return lat;
}
window.clampLng = function(lng) {
  if (lng >
 179.999999)
    lng = 179.999999;
  else if (lng
< -180.0)
    lng = -180.0;
  return lng;
}
window.clampLatLng = function(latlng) {
  return new L.LatLng ( clampLat(latlng.lat), clampLng(latlng.lng) );
}
window.clampLatLngBounds = function(bounds) {
  return new L.LatLngBounds ( clampLatLng(bounds.getSouthWest()), clampLatLng(bounds.getNorthEast()) );
}
window.getGenericMarkerSvg = function(color) {
  var markerTemplate = '
<?xml version="1.0" encoding="UTF-8"?>
\n
<svg xmlns="http://www.w3.org/2000/svg"\n   version="1.1" baseProfile="full"\n  width="25px" height="41px" viewBox="0 0 25 41">
\n\n
<path d="M1.36241844765,18.67488124675 A12.5,12.5 0 1,1 23.63758155235,18.67488124675 L12.5,40.5336158073 Z" style="stroke:none; fill: %COLOR%;" />
\n
<path d="M1.80792170975,18.44788599685 A12,12 0 1,1 23.19207829025,18.44788599685 L12.5,39.432271175 Z" style="stroke:#000000; stroke-width:1px; stroke-opacity: 0.15; fill: none;" />
\n
<path d="M2.921679865,17.8803978722 A10.75,10.75 0 1,1 22.078320135,17.8803978722 L12.5,36.6789095943 Z" style="stroke:#ffffff; stroke-width:1.5px; stroke-opacity: 0.35; fill: none;" />
\n\n
<path d="M19.86121593215,17.25 L12.5,21.5 L5.13878406785,17.25 L5.13878406785,8.75 L12.5,4.5 L19.86121593215,8.75 Z M7.7368602792,10.25 L17.2631397208,10.25 L12.5,18.5 Z M12.5,13 L7.7368602792,10.25 M12.5,13 L17.2631397208,10.25 M12.5,13 L12.5,18.5 M19.86121593215,17.25 L16.39711431705,15.25 M5.13878406785,17.25 L8.60288568295,15.25 M12.5,4.5 L12.5,8.5" style="stroke:#ffffff; stroke-width:1.25px; stroke-opacity: 1; fill: none;" />
\n\n
</svg>
';
  return markerTemplate.replace(/%COLOR%/g, color);
}
window.getGenericMarkerIcon = function(color,className) {
  return L.divIcon({
    iconSize: new L.Point(25, 41),
    iconAnchor: new L.Point(12, 41),
    html: getGenericMarkerSvg(color),
    className: className || 'leaflet-iitc-divicon-generic-marker'
  });
}
window.createGenericMarker = function(ll,color,options) {
  options = options || {};
  var markerOpt = $.extend({
    icon: getGenericMarkerIcon(color || '#a24ac3')
  }, options);
  return L.marker(ll, markerOpt);
}
// Fix Leaflet: handle touchcancel events in Draggable
L.Draggable.prototype._onDownOrig = L.Draggable.prototype._onDown;
L.Draggable.prototype._onDown = function(e) {
  L.Draggable.prototype._onDownOrig.apply(this, arguments);
  if(e.type === "touchstart") {
    L.DomEvent.on(document, "touchcancel", this._onUp, this);
  }
}
})({"buildName":"jonatkins","dateTimeVersion":"20150917.154202","script":{"version":"0.25.1.20150917.154202","name":"IITC: Ingress intel map total conversion","description":"[jonatkins-2015-09-17-154202] Total conversion for the ingress intel map."}});
</script>
<script>
(function wrapper(plugin_info) {
// ensure plugin framework is there, even if iitc is not yet loaded
if(typeof window.plugin !== 'function') window.plugin = function() {};
//PLUGIN AUTHORS: writing a plugin outside of the IITC build environment? if so, delete these lines!!
//(leaving them in place might break the 'About IITC' page or break update checks)
plugin_info.buildName = 'jonatkins';
plugin_info.dateTimeVersion = '20150917.154202';
plugin_info.pluginId = 'keys';
//END PLUGIN AUTHORS NOTE
// PLUGIN START ////////////////////////////////////////////////////////
// use own namespace for plugin
window.plugin.keys = function() {};
// delay in ms
window.plugin.keys.SYNC_DELAY = 5000;
window.plugin.keys.LOCAL_STORAGE_KEY = 'plugin-keys-data';
window.plugin.keys.KEY = {key: 'plugin-keys-data', field: 'keys'};
window.plugin.keys.UPDATE_QUEUE = {key: 'plugin-keys-data-queue', field: 'updateQueue'};
window.plugin.keys.UPDATING_QUEUE = {key: 'plugin-keys-data-updating-queue', field: 'updatingQueue'};
window.plugin.keys.keys = {};
window.plugin.keys.updateQueue = {};
window.plugin.keys.updatingQueue = {};
window.plugin.keys.enableSync = false;
window.plugin.keys.disabledMessage = null;
window.plugin.keys.contentHTML = null;
window.plugin.keys.addToSidebar = function() {
  if(typeof(Storage) === "undefined") {
    $('#portaldetails >
 .imgpreview').after(plugin.keys.disabledMessage);
    return;
  }
  $('#portaldetails >
 .imgpreview').after(plugin.keys.contentHTML);
  plugin.keys.updateDisplayCount();
}
window.plugin.keys.updateDisplayCount = function() {
  var guid = window.selectedPortal;
  var count = plugin.keys.keys[guid] || 0;
  $('#keys-count').html(count);
}
window.plugin.keys.addKey = function(addCount, guid) {
  if(guid == undefined) guid = window.selectedPortal;
  var oldCount = plugin.keys.keys[guid];
  var newCount = Math.max((oldCount || 0) + addCount, 0);
  if(oldCount !== newCount) {
    if(newCount === 0) {
      delete plugin.keys.keys[guid];
      plugin.keys.updateQueue[guid] = null;
    } else {
      plugin.keys.keys[guid] = newCount;
      plugin.keys.updateQueue[guid] = newCount;
    }
    plugin.keys.storeLocal(plugin.keys.KEY);
    plugin.keys.storeLocal(plugin.keys.UPDATE_QUEUE);
    plugin.keys.updateDisplayCount();
    window.runHooks('pluginKeysUpdateKey', {guid: guid, count: newCount});
    plugin.keys.delaySync();
  }
}
// Delay the syncing to group a few updates in a single request
window.plugin.keys.delaySync = function() {
  if(!plugin.keys.enableSync) return;
  clearTimeout(plugin.keys.delaySync.timer);
  plugin.keys.delaySync.timer = setTimeout(function() {
      plugin.keys.delaySync.timer = null;
      window.plugin.keys.syncNow();
    }, plugin.keys.SYNC_DELAY);
}
// Store the updateQueue in updatingQueue and upload
window.plugin.keys.syncNow = function() {
  if(!plugin.keys.enableSync) return;
  $.extend(plugin.keys.updatingQueue, plugin.keys.updateQueue);
  plugin.keys.updateQueue = {};
  plugin.keys.storeLocal(plugin.keys.UPDATING_QUEUE);
  plugin.keys.storeLocal(plugin.keys.UPDATE_QUEUE);
  plugin.sync.updateMap('keys', 'keys', Object.keys(plugin.keys.updatingQueue));
}
// Call after IITC and all plugin loaded
window.plugin.keys.registerFieldForSyncing = function() {
  if(!window.plugin.sync) return;
  window.plugin.sync.registerMapForSync('keys', 'keys', window.plugin.keys.syncCallback, window.plugin.keys.syncInitialed);
}
// Call after local or remote change uploaded
window.plugin.keys.syncCallback = function(pluginName, fieldName, e, fullUpdated) {
  if(fieldName === 'keys') {
    plugin.keys.storeLocal(plugin.keys.KEY);
    // All data is replaced if other client update the data during this client offline,
    // fire 'pluginKeysRefreshAll' to notify a full update
    if(fullUpdated) {
      plugin.keys.updateDisplayCount();
      window.runHooks('pluginKeysRefreshAll');
      return;
    }
    if(!e) return;
    if(e.isLocal) {
      // Update pushed successfully, remove it from updatingQueue
      delete plugin.keys.updatingQueue[e.property];
    } else {
      // Remote update
      delete plugin.keys.updateQueue[e.property];
      plugin.keys.storeLocal(plugin.keys.UPDATE_QUEUE);
      plugin.keys.updateDisplayCount();
      window.runHooks('pluginKeysUpdateKey', {guid: e.property, count: plugin.keys.keys[e.property]});
    }
  }
}
// syncing of the field is initialed, upload all queued update
window.plugin.keys.syncInitialed = function(pluginName, fieldName) {
  if(fieldName === 'keys') {
    plugin.keys.enableSync = true;
    if(Object.keys(plugin.keys.updateQueue).length >
 0) {
      plugin.keys.delaySync();
    }
  }
}
window.plugin.keys.storeLocal = function(mapping) {
  if(typeof(plugin.keys[mapping.field]) !== 'undefined' && plugin.keys[mapping.field] !== null) {
    localStorage[mapping.key] = JSON.stringify(plugin.keys[mapping.field]);
  } else {
    localStorage.removeItem(mapping.key);
  }
}
window.plugin.keys.loadLocal = function(mapping) {
  var objectJSON = localStorage[mapping.key];
  if(!objectJSON) return;
  plugin.keys[mapping.field] = mapping.convertFunc
                          ? mapping.convertFunc(JSON.parse(objectJSON))
                          : JSON.parse(objectJSON);
}
// For backward compatibility, will change to use loadLocal after a few version
window.plugin.keys.loadKeys = function() {
  var keysObjectJSON = localStorage[plugin.keys.KEY.key];
  if(!keysObjectJSON) return;
  var keysObject = JSON.parse(keysObjectJSON);
  // Move keys data up one level, it was {keys: keys_data} in localstorage in previous version
  plugin.keys.keys = keysObject.keys ? keysObject.keys : keysObject;
  if(keysObject.keys) plugin.keys.storeLocal(plugin.keys.KEY);
}
window.plugin.keys.setupCSS = function() {
  $("
<style>
")
    .prop("type", "text/css")
    .html("#keys-content-outer {\n  display: table;\n  width: 100%;\n  height: 26px;\n  text-align: center;\n}\n\n#keys-content-outer >
 div{\n  display: inline-block;\n  vertical-align: middle;\n  margin: 6px 3px 1px 3px;\n}\n\n#keys-label {\n  padding: 0 4px;\n  cursor: help;\n}\n\n#keys-add {\n}\n\n#keys-count {\n  width: 26px;\n  height: 18px !important;\n  border: 1px solid;\n  text-align: center;\n  cursor: help;\n}\n\n#keys-subtract {\n}\n\n.keys-button {\n  position:relative;\n  width: 16px;\n  height: 16px !important;\n}\n\n.keys-button >
 div {\n  background-color: rgb(32, 168, 177);\n  position: absolute;\n}\n\n.keys-button-minus {\n  width: 100%;\n  height: 4px;\n  top: 6px;\n}\n\n.keys-button-plus-h {\n  width: 100%;\n  height: 4px;\n  top: 6px;\n}\n\n.keys-button-plus-v {\n  width: 4px;\n  height: 100%;\n  left: 6px;\n}\n\n#keys-help {\n  font-weight: 900;\n  margin: 6px 3px 1px 20px !important;\n  cursor: help;\n}\n\n.portal-list-keys button {\n  font-family: monospace;\n  font-size: 0.9em;\n  text-align: center;\n  vertical-align: middle;\n  min-width: 0;\n  padding: 0;\n  width: 1.5em;\n  margin: -6px 0 -3px;\n}\n#portalslist.mobile .portal-list-keys button {\n  width: 3em;\n  height: 1.5em;\n}\n.portal-list-keys .plus {\n  margin-left: 0.3em;\n  margin-right: -1px;\n}\n\n")
    .appendTo("head");
}
window.plugin.keys.setupContent = function() {
  plugin.keys.contentHTML = '
<div id="keys-content-outer">
'
                              + '
<div id="keys-label" title="Problem? Point to the question mark!">
Key(s):
</div>
'
                              + '
<div id="keys-add" class="keys-button" '
                              + 'onclick="window.plugin.keys.addKey(-1);">
'
                               + '
<div class="keys-button-minus">
</div>
'
                              + '
</div>
'
                              + '
<div id="keys-count" title="Problem? Point to the question mark!">
</div>
'
                              + '
<div id="keys-subtract" class="keys-button" '
                              + 'onclick="window.plugin.keys.addKey(1);">
'
                                + '
<div class="keys-button-plus-v">
</div>
'
                                + '
<div class="keys-button-plus-h">
</div>
'
                              + '
</div>
'
                              + '
<div id="keys-help" title="You MUST manually input your count of keys!\n'
                              + 'This plugin CANNOT automatically get the keys from Ingress!">
?
</div>
'
                          + '
</div>
';
  plugin.keys.disabledMessage = '
<div id="keys-content-outer" title="Your browser do not support localStorage">
Plugin Keys disabled
</div>
';
}
window.plugin.keys.setupPortalsList = function() {
  if(!window.plugin.portalslist) return;
  window.addHook('pluginKeysUpdateKey', function(data) {
    $('[data-list-keycount="'+data.guid+'"]').text(data.count);
  });
  window.addHook('pluginKeysRefreshAll', function() {
    $('[data-list-keycount]').each(function(i, element) {
      var guid = element.getAttribute("data-list-keycount");
      $(element).text(plugin.keys.keys[guid] || 0);
    });
  });
  window.plugin.portalslist.fields.push({
    title: "Keys",
    value: function(portal) { return portal.options.guid; }, // we store the guid, but implement a custom comparator so the list does sort properly without closing and reopening the dialog
    sort: function(guidA, guidB) {
      var keysA = plugin.keys.keys[guidA] || 0;
      var keysB = plugin.keys.keys[guidB] || 0;
      return keysA - keysB;
    },
    format: function(cell, portal, guid) {
      $(cell)
        .addClass("alignR portal-list-keys ui-dialog-buttonset") // ui-dialog-buttonset for proper button styles
        .append($('
<span>
')
          .text(plugin.keys.keys[guid] || 0)
          .attr({
            "class": "value",
            "data-list-keycount": guid
          }));
      // for some reason, jQuery removes event listeners when the list is sorted. Therefore we use DOM's addEventListener
      $('
<button>
')
        .text('+')
        .addClass("plus")
        .appendTo(cell)
        [0].addEventListener("click", function() { window.plugin.keys.addKey(1, guid); }, false);
      $('
<button>
')
        .text('-')
        .addClass("minus")
        .appendTo(cell)
        [0].addEventListener("click", function() { window.plugin.keys.addKey(-1, guid); }, false);
    },
  });
}
var setup =  function() {
  if($.inArray('pluginKeysUpdateKey', window.VALID_HOOKS)
< 0)
    window.VALID_HOOKS.push('pluginKeysUpdateKey');
  if($.inArray('pluginKeysRefreshAll', window.VALID_HOOKS)
< 0)
    window.VALID_HOOKS.push('pluginKeysRefreshAll');
  window.plugin.keys.setupCSS();
  window.plugin.keys.setupContent();
  window.plugin.keys.loadLocal(plugin.keys.UPDATE_QUEUE);
  window.plugin.keys.loadKeys();
  window.addHook('portalDetailsUpdated', window.plugin.keys.addToSidebar);
  window.addHook('iitcLoaded', window.plugin.keys.registerFieldForSyncing);
  if(window.plugin.portalslist) {
    window.plugin.keys.setupPortalsList();
  } else {
    setTimeout(function() {
      if(window.plugin.portalslist)
        window.plugin.keys.setupPortalsList();
    }, 500);
  }
}
// PLUGIN END //////////////////////////////////////////////////////////
setup.info = plugin_info; //add the script info data to the function as a property
if(!window.bootPlugins) window.bootPlugins = [];
window.bootPlugins.push(setup);
// if IITC has already booted, immediately run the 'setup' function
if(window.iitcLoaded && typeof setup === 'function') setup();
})({"script":{"version":"0.3.0.20150917.154202","name":"IITC plugin: Keys","description":"[jonatkins-2015-09-17-154202] Allow manual entry of key counts for each portal. Use the 'keys-on-map' plugin to show the numbers on the map, and 'sync' to share between multiple browsers or desktop/mobile."}});
</script>
<script>
(function wrapper(plugin_info) {
// ensure plugin framework is there, even if iitc is not yet loaded
if(typeof window.plugin !== 'function') window.plugin = function() {};
//PLUGIN AUTHORS: writing a plugin outside of the IITC build environment? if so, delete these lines!!
//(leaving them in place might break the 'About IITC' page or break update checks)
plugin_info.buildName = 'jonatkins';
plugin_info.dateTimeVersion = '20150917.154202';
plugin_info.pluginId = 'portal-highlighter-forgotten';
//END PLUGIN AUTHORS NOTE
// PLUGIN START ////////////////////////////////////////////////////////
// use own namespace for plugin
window.plugin.portalHighlighterInactive = function() {};
window.plugin.portalHighlighterInactive.highlight = function(data) {
  if (data.portal.options.timestamp >
 0) {
    var daysUnmodified = (new Date().getTime() - data.portal.options.timestamp) / (24*60*60*1000);
    if (daysUnmodified >
= 7) {
      var fill_opacity = Math.min(1,((daysUnmodified-7)/24)*.85 + .15);
      var blue = Math.max(0,Math.min(255,Math.round((daysUnmodified-31)/62*255)));
      var colour = 'rgb(255,0,'+blue+')';
      var params = {fillColor: colour, fillOpacity: fill_opacity};
      data.portal.setStyle(params);
    }
  }
}
var setup =  function() {
  window.addPortalHighlighter('Inactive Portals', window.plugin.portalHighlighterInactive.highlight);
}
// PLUGIN END //////////////////////////////////////////////////////////
setup.info = plugin_info; //add the script info data to the function as a property
if(!window.bootPlugins) window.bootPlugins = [];
window.bootPlugins.push(setup);
// if IITC has already booted, immediately run the 'setup' function
if(window.iitcLoaded && typeof setup === 'function') setup();
})({"script":{"version":"0.1.0.20150917.154202","name":"IITC plugin: Inactive portals. Hightlight unclaimed portals with no recent activity","description":"[jonatkins-2015-09-17-154202] Use the portal fill color to denote if the portal is unclaimed with no recent activity. Shades of red from one week to one month, then tinted to purple for longer. May also highlight captured portals that are stuck and fail to decay every 24 hours."}});
</script>
<script>
(function wrapper(plugin_info) {
// ensure plugin framework is there, even if iitc is not yet loaded
if(typeof window.plugin !== 'function') window.plugin = function() {};
//PLUGIN AUTHORS: writing a plugin outside of the IITC build environment? if so, delete these lines!!
//(leaving them in place might break the 'About IITC' page or break update checks)
plugin_info.buildName = 'jonatkins';
plugin_info.dateTimeVersion = '20150917.154202';
plugin_info.pluginId = 'cache-details-on-map';
//END PLUGIN AUTHORS NOTE
// PLUGIN START ////////////////////////////////////////////////////////
// use own namespace for plugin
window.plugin.cachePortalDetailsOnMap = function() {};
window.plugin.cachePortalDetailsOnMap.MAX_AGE = 12*60*60;  //12 hours max age for cached data
window.plugin.cachePortalDetailsOnMap.portalDetailLoaded = function(data) {
  window.plugin.cachePortalDetailsOnMap.cache[data.guid] = { loadtime: Date.now(), ent: data.ent };
};
window.plugin.cachePortalDetailsOnMap.entityInject = function(data) {
  var maxAge = Date.now() - window.plugin.cachePortalDetailsOnMap.MAX_AGE*1000;
  var ents = [];
  for (var guid in window.plugin.cachePortalDetailsOnMap.cache) {
    if (window.plugin.cachePortalDetailsOnMap.cache[guid].loadtime
< maxAge) {
      delete window.plugin.cachePortalDetailsOnMap.cache[guid];
    } else {
      ents.push(window.plugin.cachePortalDetailsOnMap.cache[guid].ent);
    }
  }
  data.callback(ents);
};
window.plugin.cachePortalDetailsOnMap.setup  = function() {
  window.plugin.cachePortalDetailsOnMap.cache = {};
  addHook('portalDetailLoaded', window.plugin.cachePortalDetailsOnMap.portalDetailLoaded);
  addHook('mapDataEntityInject', window.plugin.cachePortalDetailsOnMap.entityInject);
};
var setup =  window.plugin.cachePortalDetailsOnMap.setup;
// PLUGIN END //////////////////////////////////////////////////////////
setup.info = plugin_info; //add the script info data to the function as a property
if(!window.bootPlugins) window.bootPlugins = [];
window.bootPlugins.push(setup);
// if IITC has already booted, immediately run the 'setup' function
if(window.iitcLoaded && typeof setup === 'function') setup();
})({"script":{"version":"0.1.0.20150917.154202","name":"IITC plugin: Cache viewed portal details and always show them on the map","description":"[jonatkins-2015-09-17-154202] Cache the details of recently viewed portals and use this to populate the map when possible"}});
</script>
<script>
(function wrapper(plugin_info) {
// ensure plugin framework is there, even if iitc is not yet loaded
if(typeof window.plugin !== 'function') window.plugin = function() {};
//PLUGIN AUTHORS: writing a plugin outside of the IITC build environment? if so, delete these lines!!
//(leaving them in place might break the 'About IITC' page or break update checks)
plugin_info.buildName = 'jonatkins';
plugin_info.dateTimeVersion = '20150917.154202';
plugin_info.pluginId = 'max-links';
//END PLUGIN AUTHORS NOTE
// PLUGIN START ////////////////////////////////////////////////////////
// use own namespace for plugin
window.plugin.maxLinks = function() {};
// const values
window.plugin.maxLinks.MAX_PORTALS_TO_LINK = 200;
// zoom level used for projecting points between latLng and pixel coordinates. may affect precision of triangulation
window.plugin.maxLinks.PROJECT_ZOOM = 16;
window.plugin.maxLinks.STROKE_STYLE = {
  color: '#FF0000',
  opacity: 1,
  weight: 1.5,
  clickable: false,
  dashArray: [6,4],
  smoothFactor: 10,
};
window.plugin.maxLinks.layer = null;
window.plugin.maxLinks.errorMarker = null;
window.plugin.maxLinks.addErrorMarker = function() {
  if (window.plugin.maxLinks.errorMarker == null) {
    window.plugin.maxLinks.errorMarker = L.marker (window.map.getCenter(), {
      icon: L.divIcon({
        className: 'max-links-error',
        iconSize: [300,30],
        html: 'Tidy Links: too many portals!'
      }),
      clickable: false
    });
    window.map.addLayer(window.plugin.maxLinks.errorMarker);
  }
}
window.plugin.maxLinks.clearErrorMarker = function() {
  if (window.plugin.maxLinks.errorMarker != null) {
    window.map.removeLayer(window.plugin.maxLinks.errorMarker);
    window.plugin.maxLinks.errorMarker = null;
  }
}
window.plugin.maxLinks.updateLayer = function() {
  if (!window.map.hasLayer(window.plugin.maxLinks.layer))
    return;
  window.plugin.maxLinks.layer.clearLayers();
  var locations = [];
  var bounds = map.getBounds();
  $.each(window.portals, function(guid, portal) {
    var ll = portal.getLatLng();
    if (bounds.contains(ll)) {
      var p = map.project (portal.getLatLng(), window.plugin.maxLinks.PROJECT_ZOOM);
      locations.push(p);
      if (locations.length >
 window.plugin.maxLinks.MAX_PORTALS_TO_LINK) return false; //$.each break
    }
  });
  if (locations.length >
 window.plugin.maxLinks.MAX_PORTALS_TO_LINK) {
    window.plugin.maxLinks.addErrorMarker();
    return;
  }
  var triangles = window.delaunay.triangulate(locations);
  var drawnLinkCount = 0;
  var orderedPoints = function(a,b) {
    if(a.x
<b.x) return [a,b];
    if(a.x==b.x && a.y
<b.y) return [a,b];
    return [b,a];
  }
  var drawnLinks = {};
  //draw a link, but only if it hasn't already been drawn
  var drawLink = function(a,b) {
    //order the points, so a pair of coordinates in any order is handled in one direction only
    var points = orderedPoints(a,b);
    a=points[0];
    b=points[1];
    //do we have a line already drawn from a to b?
    if(!(a in drawnLinks)) {
      //no lines from a to anywhere yet - create an empty target array
      drawnLinks[a] = {};
    }
    if (!(b in drawnLinks[a])) {
      //no line from a to b yet
      //using drawnLinks[a] as a set - so the stored value is of no importance
      drawnLinks[a][b] = null;
      // convert back from x/y coordinates to lat/lng for drawing
      var alatlng = map.unproject (a, window.plugin.maxLinks.PROJECT_ZOOM);
      var blatlng = map.unproject (b, window.plugin.maxLinks.PROJECT_ZOOM);
      var poly = L.polyline([alatlng, blatlng], window.plugin.maxLinks.STROKE_STYLE);
      poly.addTo(window.plugin.maxLinks.layer);
      drawnLinkCount++;
    }
  }
  $.each(triangles, function(idx, triangle) {
    drawLink(triangle.a,triangle.b);
    drawLink(triangle.b,triangle.c);
    drawLink(triangle.c,triangle.a);
  });
}
window.plugin.maxLinks.setup = function() {
  try { console.log('Loading delaunay JS now'); } catch(e) {}
   // Source from https://github.com/ironwallaby/delaunay
 window.delaunay = function() {};
 window.delaunay.Triangle = function (a, b, c) {
        this.a = a
        this.b = b
        this.c = c
        var A = b.x - a.x,
            B = b.y - a.y,
            C = c.x - a.x,
            D = c.y - a.y,
            E = A * (a.x + b.x) + B * (a.y + b.y),
            F = C * (a.x + c.x) + D * (a.y + c.y),
            G = 2 * (A * (c.y - b.y) - B * (c.x - b.x)),
            minx, miny, dx, dy
        /* If the points of the triangle are collinear, then just find the
         * extremes and use the midpoint as the center of the circumcircle. */
        if(Math.abs(G)
< 1e-12) {
          minx = Math.min(a.x, b.x, c.x)
          miny = Math.min(a.y, b.y, c.y)
          dx   = (Math.max(a.x, b.x, c.x) - minx) * 0.5
          dy   = (Math.max(a.y, b.y, c.y) - miny) * 0.5
          this.x = minx + dx
          this.y = miny + dy
          this.r = dx * dx + dy * dy
        }
        else {
          this.x = (D*E - B*F) / G
          this.y = (A*F - C*E) / G
          dx = this.x - a.x
          dy = this.y - a.y
          this.r = dx * dx + dy * dy
        }
      }
      function byX(a, b) {
        return b.x - a.x
      }
      function dedup(edges) {
        var j = edges.length,
            a, b, i, m, n
        outer: while(j) {
          b = edges[--j]
          a = edges[--j]
          i = j
          while(i) {
            n = edges[--i]
            m = edges[--i]
            if((a === m && b === n) || (a === n && b === m)) {
              edges.splice(j, 2)
              edges.splice(i, 2)
              j -= 2
              continue outer
            }
          }
        }
      }
  window.delaunay.triangulate = function (vertices) {
        /* Bail if there aren't enough vertices to form any triangles. */
        if(vertices.length
< 3)
          return []
        /* Ensure the vertex array is in order of descending X coordinate
         * (which is needed to ensure a subquadratic runtime), and then find
         * the bounding box around the points. */
        vertices.sort(byX)
        var i    = vertices.length - 1,
            xmin = vertices[i].x,
            xmax = vertices[0].x,
            ymin = vertices[i].y,
            ymax = ymin
        while(i--) {
          if(vertices[i].y
< ymin) ymin = vertices[i].y
          if(vertices[i].y >
 ymax) ymax = vertices[i].y
        }
        /* Find a supertriangle, which is a triangle that surrounds all the
         * vertices. This is used like something of a sentinel value to remove
         * cases in the main algorithm, and is removed before we return any
         * results.
         *
         * Once found, put it in the "open" list. (The "open" list is for
         * triangles who may still need to be considered; the "closed" list is
         * for triangles which do not.) */
        var dx     = xmax - xmin,
            dy     = ymax - ymin,
            dmax   = (dx >
 dy) ? dx : dy,
            xmid   = (xmax + xmin) * 0.5,
            ymid   = (ymax + ymin) * 0.5,
            open   = [
              new window.delaunay.Triangle(
                {x: xmid - 20 * dmax, y: ymid -      dmax, __sentinel: true},
                {x: xmid            , y: ymid + 20 * dmax, __sentinel: true},
                {x: xmid + 20 * dmax, y: ymid -      dmax, __sentinel: true}
              )
            ],
            closed = [],
            edges = [],
            j, a, b
        /* Incrementally add each vertex to the mesh. */
        i = vertices.length
        while(i--) {
          /* For each open triangle, check to see if the current point is
           * inside it's circumcircle. If it is, remove the triangle and add
           * it's edges to an edge list. */
          edges.length = 0
          j = open.length
          while(j--) {
            /* If this point is to the right of this triangle's circumcircle,
             * then this triangle should never get checked again. Remove it
             * from the open list, add it to the closed list, and skip. */
            dx = vertices[i].x - open[j].x
            if(dx >
 0 && dx * dx >
 open[j].r) {
              closed.push(open[j])
              open.splice(j, 1)
              continue
            }
            /* If not, skip this triangle. */
            dy = vertices[i].y - open[j].y
            if(dx * dx + dy * dy >
 open[j].r)
              continue
            /* Remove the triangle and add it's edges to the edge list. */
            edges.push(
              open[j].a, open[j].b,
              open[j].b, open[j].c,
              open[j].c, open[j].a
            )
            open.splice(j, 1)
          }
          /* Remove any doubled edges. */
          dedup(edges)
          /* Add a new triangle for each edge. */
          j = edges.length
          while(j) {
            b = edges[--j]
            a = edges[--j]
            open.push(new window.delaunay.Triangle(a, b, vertices[i]))
          }
        }
        /* Copy any remaining open triangles to the closed list, and then
         * remove any triangles that share a vertex with the supertriangle. */
        Array.prototype.push.apply(closed, open)
        i = closed.length
        while(i--)
          if(closed[i].a.__sentinel ||
             closed[i].b.__sentinel ||
             closed[i].c.__sentinel)
            closed.splice(i, 1)
        /* Yay, we're done! */
        return closed
      }
  try { console.log('done loading delaunay JS'); } catch(e) {}
  window.plugin.maxLinks.layer = L.layerGroup([]);
  window.addHook('mapDataRefreshEnd', function(e) {
    window.plugin.maxLinks.updateLayer();
  });
  window.addHook('mapDataRefreshStart', function(e) {
    window.plugin.maxLinks.clearErrorMarker();
  });
  window.map.on('layeradd', function(e) {
    if (e.layer === window.plugin.maxLinks.layer)
      window.plugin.maxLinks.updateLayer();
  });
  window.map.on('layerremove', function(e) {
    if (e.layer === window.plugin.maxLinks.layer)
      window.plugin.maxLinks.clearErrorMarker();
  });
  window.addLayerGroup('Tidy Links (was Max Links)', window.plugin.maxLinks.layer, false);
  $('head').append('
<style>
'+
    '.max-links-error { color: #F88; font-size: 20px; font-weight: bold; text-align: center; text-shadow: -1px -1px #000, 1px -1px #000, -1px 1px #000, 1px 1px #000; background-color: rgba(0,0,0,0.6); border-radius: 5px; }'+
    '
</style>
');
}
var setup = window.plugin.maxLinks.setup;
// PLUGIN END //////////////////////////////////////////////////////////
setup.info = plugin_info; //add the script info data to the function as a property
if(!window.bootPlugins) window.bootPlugins = [];
window.bootPlugins.push(setup);
// if IITC has already booted, immediately run the 'setup' function
if(window.iitcLoaded && typeof setup === 'function') setup();
})({"script":{"version":"0.4.3.20150917.154202","name":"IITC plugin: Max Links","description":"[jonatkins-2015-09-17-154202] Calculate how to link the portals to create a reasonably tidy set of links/fields. Enable from the layer chooser. (Max Links is a poor name, but remains for historical reasons.)"}});
</script>
<script>
(function wrapper(plugin_info) {
// ensure plugin framework is there, even if iitc is not yet loaded
if(typeof window.plugin !== 'function') window.plugin = function() {};
//PLUGIN AUTHORS: writing a plugin outside of the IITC build environment? if so, delete these lines!!
//(leaving them in place might break the 'About IITC' page or break update checks)
plugin_info.buildName = 'jonatkins';
plugin_info.dateTimeVersion = '20150917.154202';
plugin_info.pluginId = 'done-links';
//END PLUGIN AUTHORS NOTE
// PLUGIN START ////////////////////////////////////////////////////////
window.plugin.doneLinks = function() {};
window.plugin.doneLinks.sameLink = function(a0, a1, b0, b1) {
  if (a0.equals(b0) && a1.equals(b1)) return true;
  if (a0.equals(b1) && a1.equals(b0)) return true;
  return false;
}
window.plugin.doneLinks.testPolyLine = function (polyline, link,closed) {
    var a = link.getLatLngs();
    var b = polyline.getLatLngs();
    for (var i=0;i
<b.length-1;++i) {
        if (window.plugin.doneLinks.sameLink(a[0],a[1],b[i],b[i+1])) return true;
    }
    if (closed) {
        if (window.plugin.doneLinks.sameLink(a[0],a[1],b[b.length-1],b[0])) return true;
    }
    return false;
}
window.plugin.doneLinks.onLinkAdded = function (data) {
    if (window.plugin.doneLinks.disabled) return;
    plugin.doneLinks.testLink(data.link);
}
window.plugin.doneLinks.checkAllLinks = function() {
    if (window.plugin.doneLinks.disabled) return;
    console.debug("Done-Links: checking all links");
    plugin.doneLinks.linkLayer.clearLayers();
    plugin.doneLinks.linkLayerGuids = {};
    $.each(window.links, function(guid, link) {
        plugin.doneLinks.testLink(link);
    });
}
window.plugin.doneLinks.testLink = function (link) {
    if (plugin.doneLinks.linkLayerGuids[link.options.guid]) return;
    for (var i in plugin.drawTools.drawnItems._layers) { // leaflet don't support breaking out of the loop
       var layer = plugin.drawTools.drawnItems._layers[i];
       if (layer instanceof L.GeodesicPolygon) {
           if (plugin.doneLinks.testPolyLine(layer, link,true)) {
               plugin.doneLinks.showLink(link);
               break;
           }
        } else if (layer instanceof L.GeodesicPolyline) {
            if (plugin.doneLinks.testPolyLine(layer, link)) {
                plugin.doneLinks.showLink(link);
                break;
            }
        }
    };
}
window.plugin.doneLinks.showLink = function(link) {
    var poly = L.geodesicPolyline(link.getLatLngs(), {
       color: COLORS[link.options.team],
       opacity: 0.8,
       weight: 6,
       clickable: false,
       dashArray: [6,12],
       guid: link.options.guid
    });
    poly.addTo(plugin.doneLinks.linkLayer);
    plugin.doneLinks.linkLayerGuids[link.options.guid]=poly;
}
window.plugin.doneLinks.onMapDataRefreshEnd = function () {
    if (window.plugin.doneLinks.disabled) return;
    window.plugin.doneLinks.linkLayer.bringToFront();
    window.plugin.doneLinks.testForDeletedLinks();
}
window.plugin.doneLinks.testAllLinksAgainstLayer = function (layer) {
    if (window.plugin.doneLinks.disabled) return;
    $.each(window.links, function(guid, link) {
        if (!plugin.doneLinks.linkLayerGuids[link.options.guid])
        {
            if (layer instanceof L.GeodesicPolygon) {
                if (plugin.doneLinks.testPolyLine(layer, link,true)) {
                    plugin.doneLinks.showLink(link);
                }
            } else if (layer instanceof L.GeodesicPolyline) {
                if (plugin.doneLinks.testPolyLine(layer, link)) {
                    plugin.doneLinks.showLink(link);
                }
            }
        }
    });
}
window.plugin.doneLinks.testForDeletedLinks = function () {
    window.plugin.doneLinks.linkLayer.eachLayer( function(layer) {
        var guid = layer.options.guid;
        if (!window.links[guid]) {
            console.log("link removed");
            plugin.doneLinks.linkLayer.removeLayer(layer);
            delete plugin.doneLinks.linkLayerGuids[guid];
        }
    });
}
window.plugin.doneLinks.createLayer = function() {
    window.plugin.doneLinks.linkLayer = new L.FeatureGroup();
    window.plugin.doneLinks.linkLayerGuids={};
    window.addLayerGroup('Done Links', window.plugin.doneLinks.linkLayer, true);
    map.on('layeradd', function(obj) {
      if(obj.layer === window.plugin.doneLinks.linkLayer) {
        delete window.plugin.doneLinks.disabled;
        window.plugin.doneLinks.checkAllLinks();
      }
    });
    map.on('layerremove', function(obj) {
      if(obj.layer === window.plugin.doneLinks.linkLayer) {
        window.plugin.doneLinks.disabled = true;
        window.plugin.doneLinks.linkLayer.clearLayers();
        plugin.doneLinks.linkLayerGuids = {};
      }
    });
    // ensure 'disabled' flag is initialised
    if (!map.hasLayer(window.plugin.doneLinks.linkLayer)) {
        window.plugin.doneLinks.disabled = true;
    }
}
var setup = function() {
    if (window.plugin.drawTools === undefined) {
       alert("'Done-Links' requires 'draw-tools'");
       return;
    }
    // this plugin also needs to create the draw-tools hook, in case it is initialised before draw-tools
    window.pluginCreateHook('pluginDrawTools');
    window.plugin.doneLinks.createLayer();
    // events
    window.addHook('pluginDrawTools',function(e) {
        if (e.event == 'layerCreated') {
            // we can just test the new layer in this case
            window.plugin.doneLinks.testAllLinksAgainstLayer(e.layer);
        } else {
            // all other event types - assume anything could have been modified and re-check all links
            window.plugin.doneLinks.checkAllLinks();
        }
    });
    window.addHook('linkAdded', window.plugin.doneLinks.onLinkAdded);
    window.addHook('mapDataRefreshEnd', window.plugin.doneLinks.onMapDataRefreshEnd);
}
// PLUGIN END //////////////////////////////////////////////////////////
setup.info = plugin_info; //add the script info data to the function as a property
if(!window.bootPlugins) window.bootPlugins = [];
window.bootPlugins.push(setup);
// if IITC has already booted, immediately run the 'setup' function
if(window.iitcLoaded && typeof setup === 'function') setup();
})({"script":{"version":"0.0.1.20150917.154202","name":"IITC plugin: done links","description":"[jonatkins-2015-09-17-154202] A companion to the Cross Links plugin. Highlights any links that match existing draw-tools line/polygon edges"}});
</script>
<script>
(function wrapper(plugin_info) {
// ensure plugin framework is there, even if iitc is not yet loaded
if(typeof window.plugin !== 'function') window.plugin = function() {};
//PLUGIN AUTHORS: writing a plugin outside of the IITC build environment? if so, delete these lines!!
//(leaving them in place might break the 'About IITC' page or break update checks)
plugin_info.buildName = 'jonatkins';
plugin_info.dateTimeVersion = '20150917.154202';
plugin_info.pluginId = 'portal-level-numbers';
//END PLUGIN AUTHORS NOTE
// PLUGIN START ////////////////////////////////////////////////////////
// use own namespace for plugin
window.plugin.portalLevelNumbers = function() {
};
window.plugin.portalLevelNumbers.ICON_SIZE = 12;
window.plugin.portalLevelNumbers.MOBILE_SCALE = 1.5;
window.plugin.portalLevelNumbers.levelLayers = {};
window.plugin.portalLevelNumbers.levelLayerGroup = null;
window.plugin.portalLevelNumbers.setupCSS = function() {
  $("
<style>
")
    .prop("type", "text/css")
    .html(".plugin-portal-level-numbers {\
            font-size: 10px;\
            color: #FFFFBB;\
            font-family: monospace;\
            text-align: center;\
            text-shadow: 0 0 0.5em black, 0 0 0.5em black, 0 0 0.5em black;\
            pointer-events: none;\
            -webkit-text-size-adjust:none;\
          }")
  .appendTo("head");
}
window.plugin.portalLevelNumbers.removeLabel = function(guid) {
  var previousLayer = window.plugin.portalLevelNumbers.levelLayers[guid];
  if(previousLayer) {
    window.plugin.portalLevelNumbers.levelLayerGroup.removeLayer(previousLayer);
    delete plugin.portalLevelNumbers.levelLayers[guid];
  }
}
window.plugin.portalLevelNumbers.addLabel = function(guid,latLng) {
  // remove old layer before updating
  window.plugin.portalLevelNumbers.removeLabel(guid);
  // add portal level to layers
  var p = window.portals[guid];
  var levelNumber = p.options.level;
  var level = L.marker(latLng, {
    icon: L.divIcon({
      className: 'plugin-portal-level-numbers',
      iconSize: [window.plugin.portalLevelNumbers.ICON_SIZE, window.plugin.portalLevelNumbers.ICON_SIZE],
      html: levelNumber
      }),
    guid: guid
  });
  plugin.portalLevelNumbers.levelLayers[guid] = level;
  level.addTo(plugin.portalLevelNumbers.levelLayerGroup);
}
window.plugin.portalLevelNumbers.updatePortalLabels = function() {
  var SQUARE_SIZE = L.Browser.mobile ? (window.plugin.portalLevelNumbers.ICON_SIZE + 3) * window.plugin.portalLevelNumbers.MOBILE_SCALE
                                     : (window.plugin.portalLevelNumbers.ICON_SIZE + 3);
  // as this is called every time layers are toggled, there's no point in doing it when the layer is off
  if (!map.hasLayer(window.plugin.portalLevelNumbers.levelLayerGroup)) {
    return;
  }
  var portalPoints = {};
  for (var guid in window.portals) {
    var p = window.portals[guid];
    if (p._map && p.options.data.level !== undefined) {  // only consider portals added to the map, and that have a level set
      var point = map.project(p.getLatLng());
      portalPoints[guid] = point;
    }
  }
  // for efficient testing of intersection, group portals into buckets based on the defined rectangle size
  var buckets = {};
  for (var guid in portalPoints) {
    var point = portalPoints[guid];
    var bucketId = L.point([Math.floor(point.x/(SQUARE_SIZE*2)),Math.floor(point.y/SQUARE_SIZE*2)]);
    // the guid is added to four buckets. this way, when testing for overlap we don't need to test
    // all 8 buckets surrounding the one around the particular portal, only the bucket it is in itself
    var bucketIds = [bucketId, bucketId.add([1,0]), bucketId.add([0,1]), bucketId.add([1,1])];
    for (var i in bucketIds) {
      var b = bucketIds[i].toString();
      if (!buckets[b]) buckets[b] = {};
      buckets[b][guid] = true;
    }
  }
  var coveredPortals = {};
  for (var bucket in buckets) {
    var bucketGuids = buckets[bucket];
    for (var guid in bucketGuids) {
      var point = portalPoints[guid];
      // the bounds used for testing are twice as wide as the rectangle. this is so that there's no left/right
      // overlap between two different portals text
      var southWest = point.subtract([SQUARE_SIZE, SQUARE_SIZE]);
      var northEast = point.add([SQUARE_SIZE, SQUARE_SIZE]);
      var largeBounds = L.bounds(southWest, northEast);
      for (var otherGuid in bucketGuids) {
        // do not check portals already marked as covered
        if (guid != otherGuid && !coveredPortals[otherGuid]) {
          var otherPoint = portalPoints[otherGuid];
          if (largeBounds.contains(otherPoint)) {
            // another portal is within the rectangle - remove if it has not a higher level
            if (portals[guid].options.level >
 portals[otherGuid].options.level) continue;
            else coveredPortals[guid] = true;
            break;
          }
        }
      }
    }
  }
  for (var guid in coveredPortals) {
    delete portalPoints[guid];
  }
  // remove any not wanted
  for (var guid in window.plugin.portalLevelNumbers.levelLayers) {
    if (!(guid in portalPoints)) {
      window.plugin.portalLevelNumbers.removeLabel(guid);
    }
  }
  // and add those we do
  for (var guid in portalPoints) {
    window.plugin.portalLevelNumbers.addLabel(guid, portals[guid].getLatLng());
  }
}
// as calculating portal marker visibility can take some time when there's lots of portals shown, we'll do it on
// a short timer. this way it doesn't get repeated so much
window.plugin.portalLevelNumbers.delayedUpdatePortalLabels = function(wait) {
  if (window.plugin.portalLevelNumbers.timer === undefined) {
    window.plugin.portalLevelNumbers.timer = setTimeout ( function() {
      window.plugin.portalLevelNumbers.timer = undefined;
      window.plugin.portalLevelNumbers.updatePortalLabels();
    }, wait*1000);
  }
}
var setup = function() {
  window.plugin.portalLevelNumbers.setupCSS();
  window.plugin.portalLevelNumbers.levelLayerGroup = new L.LayerGroup();
  window.addLayerGroup('Portal Levels', window.plugin.portalLevelNumbers.levelLayerGroup, true);
  window.addHook('requestFinished', function() { setTimeout(function(){window.plugin.portalLevelNumbers.delayedUpdatePortalLabels(3.0);},1); });
  window.addHook('mapDataRefreshEnd', function() { window.plugin.portalLevelNumbers.delayedUpdatePortalLabels(0.5); });
  window.map.on('overlayadd overlayremove', function() { setTimeout(function(){window.plugin.portalLevelNumbers.delayedUpdatePortalLabels(1.0);},1); });
}
// PLUGIN END //////////////////////////////////////////////////////////
setup.info = plugin_info; //add the script info data to the function as a property
if(!window.bootPlugins) window.bootPlugins = [];
window.bootPlugins.push(setup);
// if IITC has already booted, immediately run the 'setup' function
if(window.iitcLoaded && typeof setup === 'function') setup();
})({"script":{"version":"0.1.5.20150917.154202","name":"IITC plugin: Portal Level Numbers","description":"[jonatkins-2015-09-17-154202] Show portal level numbers on map."}});
</script>
<script>
(function wrapper(plugin_info) {
// ensure plugin framework is there, even if iitc is not yet loaded
if(typeof window.plugin !== 'function') window.plugin = function() {};
//PLUGIN AUTHORS: writing a plugin outside of the IITC build environment? if so, delete these lines!!
//(leaving them in place might break the 'About IITC' page or break update checks)
plugin_info.buildName = 'jonatkins';
plugin_info.dateTimeVersion = '20150917.154202';
plugin_info.pluginId = 'uniques';
//END PLUGIN AUTHORS NOTE
//PLUGIN START ////////////////////////////////////////////////////////
//use own namespace for plugin
window.plugin.uniques = function() {};
//delay in ms
window.plugin.uniques.SYNC_DELAY = 5000;
// maps the JS property names to localStorage keys
window.plugin.uniques.FIELDS = {
    'uniques': 'plugin-uniques-data',
    'updateQueue': 'plugin-uniques-data-queue',
    'updatingQueue': 'plugin-uniques-data-updating-queue',
};
window.plugin.uniques.uniques = {};
window.plugin.uniques.updateQueue = {};
window.plugin.uniques.updatingQueue = {};
window.plugin.uniques.enableSync = false;
window.plugin.uniques.disabledMessage = null;
window.plugin.uniques.contentHTML = null;
window.plugin.uniques.isHighlightActive = false;
window.plugin.uniques.onPortalDetailsUpdated = function() {
    if(typeof(Storage) === "undefined") {
        $('#portaldetails >
 .imgpreview').after(plugin.uniques.disabledMessage);
        return;
    }
    var guid = window.selectedPortal,
        details = portalDetail.get(guid),
        nickname = window.PLAYER.nickname;
    if(details) {
        if(details.owner == nickname) {
            //FIXME: a virus flip will set the owner of the portal, but doesn't count as a unique capture
            plugin.uniques.updateCaptured(true);
            // no further logic required
        } else {
            function installedByPlayer(entity) {
                return entity && entity.owner == nickname;
            }
            if(details.resonators.some(installedByPlayer) || details.mods.some(installedByPlayer)) {
                plugin.uniques.updateVisited(true);
            }
        }
    }
    $('#portaldetails >
 .imgpreview').after(plugin.uniques.contentHTML);
    plugin.uniques.updateCheckedAndHighlight(guid);
}
window.plugin.uniques.onPublicChatDataAvailable = function(data) {
    var nick = window.PLAYER.nickname;
    data.result.forEach(function(msg) {
        var plext = msg[2].plext,
            markup = plext.markup;
        if(plext.plextType == 'SYSTEM_BROADCAST'
        && markup.length==5
        && markup[0][0] == 'PLAYER'
        && markup[0][1].plain == nick
        && markup[1][0] == 'TEXT'
        && markup[1][1].plain == ' deployed an '
        && markup[2][0] == 'TEXT'
        && markup[3][0] == 'TEXT'
        && markup[3][1].plain == ' Resonator on '
        && markup[4][0] == 'PORTAL') {
            // search for "x deployed an Ly Resonator on z"
            var portal = markup[4][1];
            var guid = window.findPortalGuidByPositionE6(portal.latE6, portal.lngE6);
            if(guid) plugin.uniques.setPortalVisited(guid);
        } else if(plext.plextType == 'SYSTEM_BROADCAST'
        && markup.length==3
        && markup[0][0] == 'PLAYER'
        && markup[0][1].plain == nick
        && markup[1][0] == 'TEXT'
        && markup[1][1].plain == ' deployed a Resonator on '
        && markup[2][0] == 'PORTAL') {
            // search for "x deployed a Resonator on z"
            var portal = markup[2][1];
            var guid = window.findPortalGuidByPositionE6(portal.latE6, portal.lngE6);
            if(guid) plugin.uniques.setPortalVisited(guid);
        } else if(plext.plextType == 'SYSTEM_BROADCAST'
        && markup.length==3
        && markup[0][0] == 'PLAYER'
        && markup[0][1].plain == nick
        && markup[1][0] == 'TEXT'
        && markup[1][1].plain == ' captured '
        && markup[2][0] == 'PORTAL') {
            // search for "x captured y"
            var portal = markup[2][1];
            var guid = window.findPortalGuidByPositionE6(portal.latE6, portal.lngE6);
            if(guid) plugin.uniques.setPortalCaptured(guid);
        } else if(plext.plextType == 'SYSTEM_BROADCAST'
        && markup.length==5
        && markup[0][0] == 'PLAYER'
        && markup[0][1].plain == nick
        && markup[1][0] == 'TEXT'
        && markup[1][1].plain == ' linked '
        && markup[2][0] == 'PORTAL'
        && markup[3][0] == 'TEXT'
        && markup[3][1].plain == ' to '
        && markup[4][0] == 'PORTAL') {
            // search for "x linked y to z"
            var portal = markup[2][1];
            var guid = window.findPortalGuidByPositionE6(portal.latE6, portal.lngE6);
            if(guid) plugin.uniques.setPortalVisited(guid);
        } else if(plext.plextType == 'SYSTEM_NARROWCAST'
        && markup.length==6
        && markup[0][0] == 'TEXT'
        && markup[0][1].plain == 'Your '
        && markup[1][0] == 'TEXT'
        && markup[2][0] == 'TEXT'
        && markup[2][1].plain == ' Resonator on '
        && markup[3][0] == 'PORTAL'
        && markup[4][0] == 'TEXT'
        && markup[4][1].plain == ' was destroyed by '
        && markup[5][0] == 'PLAYER') {
            // search for "Your Lx Resonator on y was destroyed by z"
            var portal = markup[3][1];
            var guid = window.findPortalGuidByPositionE6(portal.latE6, portal.lngE6);
            if(guid) plugin.uniques.setPortalVisited(guid);
        } else if(plext.plextType == 'SYSTEM_NARROWCAST'
        && markup.length==5
        && markup[0][0] == 'TEXT'
        && markup[0][1].plain == 'Your '
        && markup[1][0] == 'TEXT'
        && markup[2][0] == 'TEXT'
        && markup[2][1].plain == ' Resonator on '
        && markup[3][0] == 'PORTAL'
        && markup[4][0] == 'TEXT'
        && markup[4][1].plain == ' has decayed') {
            // search for "Your Lx Resonator on y has decayed"
            var portal = markup[3][1];
            var guid = window.findPortalGuidByPositionE6(portal.latE6, portal.lngE6);
            if(guid) plugin.uniques.setPortalVisited(guid);
        } else if(plext.plextType == 'SYSTEM_NARROWCAST'
        && markup.length==4
        && markup[0][0] == 'TEXT'
        && markup[0][1].plain == 'Your Portal '
        && markup[1][0] == 'PORTAL'
        && markup[2][0] == 'TEXT'
        && (markup[2][1].plain == ' neutralized by ' || markup[2][1].plain == ' is under attack by ')
        && markup[3][0] == 'PLAYER') {
            // search for "Your Portal x neutralized by y"
            // search for "Your Portal x is under attack by y"
            var portal = markup[1][1];
            var guid = window.findPortalGuidByPositionE6(portal.latE6, portal.lngE6);
            if(guid) plugin.uniques.setPortalVisited(guid);
        }
    });
}
window.plugin.uniques.updateCheckedAndHighlight = function(guid) {
    runHooks('pluginUniquesUpdateUniques', { guid: guid });
    if (guid == window.selectedPortal) {
        var uniqueInfo = plugin.uniques.uniques[guid],
            visited = (uniqueInfo && uniqueInfo.visited) || false,
            captured = (uniqueInfo && uniqueInfo.captured) || false;
        $('#visited').prop('checked', visited);
        $('#captured').prop('checked', captured);
    }
    if (window.plugin.uniques.isHighlightActive) {
        if (portals[guid]) {
            window.setMarkerStyle (portals[guid], guid == selectedPortal);
        }
    }
}
window.plugin.uniques.setPortalVisited = function(guid) {
    var uniqueInfo = plugin.uniques.uniques[guid];
    if (uniqueInfo) {
        if(uniqueInfo.visited) return;
        uniqueInfo.visited = true;
    } else {
        plugin.uniques.uniques[guid] = {
            visited: true,
            captured: false
        };
    }
    plugin.uniques.updateCheckedAndHighlight(guid);
    plugin.uniques.sync(guid);
}
window.plugin.uniques.setPortalCaptured = function(guid) {
    var uniqueInfo = plugin.uniques.uniques[guid];
    if (uniqueInfo) {
        if(uniqueInfo.visited && uniqueInfo.captured) return;
        uniqueInfo.visited = true;
        uniqueInfo.captured = true;
    } else {
        plugin.uniques.uniques[guid] = {
            visited: true,
            captured: true
        };
    }
    plugin.uniques.updateCheckedAndHighlight(guid);
    plugin.uniques.sync(guid);
}
window.plugin.uniques.updateVisited = function(visited, guid) {
    if(guid == undefined) guid = window.selectedPortal;
    var uniqueInfo = plugin.uniques.uniques[guid];
    if (!uniqueInfo) {
        plugin.uniques.uniques[guid] = uniqueInfo = {
            visited: false,
            captured: false
        };
    }
    if(visited == uniqueInfo.visited) return;
    if (visited) {
        uniqueInfo.visited = true;
    } else { // not visited -->
 not captured
        uniqueInfo.visited = false;
        uniqueInfo.captured = false;
    }
    plugin.uniques.updateCheckedAndHighlight(guid);
    plugin.uniques.sync(guid);
}
window.plugin.uniques.updateCaptured = function(captured, guid) {
    if(guid == undefined) guid = window.selectedPortal;
    var uniqueInfo = plugin.uniques.uniques[guid];
    if (!uniqueInfo) {
        plugin.uniques.uniques[guid] = uniqueInfo = {
            visited: false,
            captured: false
        };
    }
    if(captured == uniqueInfo.captured) return;
    if (captured) { // captured -->
 visited
        uniqueInfo.captured = true;
        uniqueInfo.visited = true;
    } else {
        uniqueInfo.captured = false;
    }
    plugin.uniques.updateCheckedAndHighlight(guid);
    plugin.uniques.sync(guid);
}
// stores the gived GUID for sync
plugin.uniques.sync = function(guid) {
    plugin.uniques.updateQueue[guid] = true;
    plugin.uniques.storeLocal('uniques');
    plugin.uniques.storeLocal('updateQueue');
    plugin.uniques.syncQueue();
}
// sync the queue, but delay the actual sync to group a few updates in a single request
window.plugin.uniques.syncQueue = function() {
    if(!plugin.uniques.enableSync) return;
    clearTimeout(plugin.uniques.syncTimer);
    plugin.uniques.syncTimer = setTimeout(function() {
        plugin.uniques.syncTimer = null;
        $.extend(plugin.uniques.updatingQueue, plugin.uniques.updateQueue);
        plugin.uniques.updateQueue = {};
        plugin.uniques.storeLocal('updatingQueue');
        plugin.uniques.storeLocal('updateQueue');
        plugin.sync.updateMap('uniques', 'uniques', Object.keys(plugin.uniques.updatingQueue));
    }, plugin.uniques.SYNC_DELAY);
}
//Call after IITC and all plugin loaded
window.plugin.uniques.registerFieldForSyncing = function() {
    if(!window.plugin.sync) return;
    window.plugin.sync.registerMapForSync('uniques', 'uniques', window.plugin.uniques.syncCallback, window.plugin.uniques.syncInitialed);
}
//Call after local or remote change uploaded
window.plugin.uniques.syncCallback = function(pluginName, fieldName, e, fullUpdated) {
    if(fieldName === 'uniques') {
        plugin.uniques.storeLocal('uniques');
        // All data is replaced if other client update the data during this client
        // offline,
        // fire 'pluginUniquesRefreshAll' to notify a full update
        if(fullUpdated) {
            // a full update - update the selected portal sidebar
            if (window.selectedPortal) {
                plugin.uniques.updateCheckedAndHighlight(window.selectedPortal);
            }
            // and also update all highlights, if needed
            if (window.plugin.uniques.isHighlightActive) {
                resetHighlightedPortals();
            }
            window.runHooks('pluginUniquesRefreshAll');
            return;
        }
        if(!e) return;
        if(e.isLocal) {
            // Update pushed successfully, remove it from updatingQueue
            delete plugin.uniques.updatingQueue[e.property];
        } else {
            // Remote update
            delete plugin.uniques.updateQueue[e.property];
            plugin.uniques.storeLocal('updateQueue');
            plugin.uniques.updateCheckedAndHighlight(e.property);
            window.runHooks('pluginUniquesUpdateUniques', {guid: e.property});
        }
    }
}
//syncing of the field is initialed, upload all queued update
window.plugin.uniques.syncInitialed = function(pluginName, fieldName) {
    if(fieldName === 'uniques') {
        plugin.uniques.enableSync = true;
        if(Object.keys(plugin.uniques.updateQueue).length >
 0) {
            plugin.uniques.syncQueue();
        }
    }
}
window.plugin.uniques.storeLocal = function(name) {
    var key = window.plugin.uniques.FIELDS[name];
    if(key === undefined) return;
    var value = plugin.uniques[name];
    if(typeof value !== 'undefined' && value !== null) {
        localStorage[key] = JSON.stringify(plugin.uniques[name]);
    } else {
        localStorage.removeItem(key);
    }
}
window.plugin.uniques.loadLocal = function(name) {
    var key = window.plugin.uniques.FIELDS[name];
    if(key === undefined) return;
    if(localStorage[key] !== undefined) {
        plugin.uniques[name] = JSON.parse(localStorage[key]);
    }
}
/***************************************************************************************************************************************************************/
/** HIGHLIGHTER ************************************************************************************************************************************************/
/***************************************************************************************************************************************************************/
window.plugin.uniques.highlighter = {
    highlight: function(data) {
        var guid = data.portal.options.ent[0];
        var uniqueInfo = window.plugin.uniques.uniques[guid];
        var style = {};
        if (uniqueInfo) {
            if (uniqueInfo.captured) {
                // captured (and, implied, visited too) - no highlights
            } else if (uniqueInfo.visited) {
                style.fillColor = 'yellow';
                style.fillOpacity = 0.6;
            } else {
                // we have an 'uniqueInfo' entry for the portal, but it's not set visited or captured?
                // could be used to flag a portal you don't plan to visit, so use a less opaque red
                style.fillColor = 'red';
                style.fillOpacity = 0.5;
            }
        } else {
            // no visit data at all
            style.fillColor = 'red';
            style.fillOpacity = 0.7;
        }
        data.portal.setStyle(style);
    },
    setSelected: function(active) {
        window.plugin.uniques.isHighlightActive = active;
    }
}
window.plugin.uniques.setupCSS = function() {
    $("
<style>
")
    .prop("type", "text/css")
    .html("#uniques-container {\n  display: block;\n  text-align: center;\n  margin: 6px 3px 1px 3px;\n  padding: 0 4px;\n}\n#uniques-container label {\n  margin: 0 0.5em;\n}\n#uniques-container input {\n  vertical-align: middle;\n}\n\n.portal-list-uniques input[type=\'checkbox\'] {\n  padding: 0;\n  height: auto;\n  margin-top: -5px;\n  margin-bottom: -5px;\n}\n")
    .appendTo("head");
}
window.plugin.uniques.setupContent = function() {
    plugin.uniques.contentHTML = '
<div id="uniques-container">
'
        + '
<label>
<input type="checkbox" id="visited" onclick="window.plugin.uniques.updateVisited($(this).prop(\'checked\'))">
 Visited
</label>
'
        + '
<label>
<input type="checkbox" id="captured" onclick="window.plugin.uniques.updateCaptured($(this).prop(\'checked\'))">
 Captured
</label>
'
        + '
</div>
';
    plugin.uniques.disabledMessage = '
<div id="uniques-container" class="help" title="Your browser does not support localStorage">
Plugin Uniques disabled
</div>
';
}
window.plugin.uniques.setupPortalsList = function() {
    if(!window.plugin.portalslist) return;
    window.addHook('pluginUniquesUpdateUniques', function(data) {
        var info = plugin.uniques.uniques[data.guid];
        if(!info) info = { visited: false, captured: false };
        $('[data-list-uniques="'+data.guid+'"].visited').prop('checked', !!info.visited);
        $('[data-list-uniques="'+data.guid+'"].captured').prop('checked', !!info.captured);
    });
    window.addHook('pluginUniquesRefreshAll', function() {
        $('[data-list-uniques]').each(function(i, element) {
            var guid = element.getAttribute("data-list-uniques");
            var info = plugin.uniques.uniques[guid];
            if(!info) info = { visited: false, captured: false };
            var e = $(element);
            if(e.hasClass('visited')) e.prop('checked', !!info.visited);
            if(e.hasClass('captured')) e.prop('checked', !!info.captured);
        });
    });
    function uniqueValue(guid) {
        var info = plugin.uniques.uniques[guid];
        if(!info) return 0;
        if(info.visited && info.captured) return 2;
        if(info.visited) return 1;
    }
    window.plugin.portalslist.fields.push({
        title: "Visit",
        value: function(portal) { return portal.options.guid; }, // we store the guid, but implement a custom comparator so the list does sort properly without closing and reopening the dialog
        sort: function(guidA, guidB) {
            return uniqueValue(guidA) - uniqueValue(guidB);
        },
        format: function(cell, portal, guid) {
            var info = plugin.uniques.uniques[guid];
            if(!info) info = { visited: false, captured: false };
            $(cell).addClass("portal-list-uniques");
            // for some reason, jQuery removes event listeners when the list is sorted. Therefore we use DOM's addEventListener
            $('
<input>
')
                .prop({
                    type: "checkbox",
                    className: "visited",
                    title: "Portal visited?",
                    checked: !!info.visited,
                })
                .attr("data-list-uniques", guid)
                .appendTo(cell)
                [0].addEventListener("change", function(ev) {
                    window.plugin.uniques.updateVisited(this.checked, guid);
                    ev.preventDefault();
                    return false;
                }, false);
            $('
<input>
')
                .prop({
                    type: "checkbox",
                    className: "captured",
                    title: "Portal captured?",
                    checked: !!info.captured,
                })
                .attr("data-list-uniques", guid)
                .appendTo(cell)
                [0].addEventListener("change", function(ev) {
                    window.plugin.uniques.updateCaptured(this.checked, guid);
                    ev.preventDefault();
                    return false;
                }, false);
        },
    });
}
window.plugin.uniques.onMissionChanged = function(data) {
    if(!data.local) return;
    var mission = window.plugin.missions && window.plugin.missions.getMissionCache(data.mid, false);
    if(!mission) return;
    window.plugin.uniques.checkMissionWaypoints(mission);
};
window.plugin.uniques.onMissionLoaded = function(data) {
    // the mission has been loaded, but the dialog isn't visible yet.
    // we'll wait a moment so the mission dialog is opened behind the confirmation prompt
    setTimeout(function() {
        window.plugin.uniques.checkMissionWaypoints(data.mission);
    }, 0);
};
window.plugin.uniques.checkMissionWaypoints = function(mission) {
    if(!(window.plugin.missions && window.plugin.missions.checkedMissions[mission.guid])) return;
    if(!mission.waypoints) return;
    function isValidWaypoint(wp) {
        // might be hidden or field trip card
        if(!(wp && wp.portal && wp.portal.guid)) return false;
        // only use hack, deploy, link, field and upgrade; ignore photo and passphrase
        if(wp.objectiveNum
<= 0 || wp.objectiveNum >
 5) return false;
        return true;
    }
    function isVisited(wp) {
        var guid = wp.portal.guid,
            uniqueInfo = plugin.uniques.uniques[guid],
            visited = (uniqueInfo && uniqueInfo.visited) || false;
        return visited;
    }
    // check if all waypoints are already visited
    if(mission.waypoints.every(function(wp) {
        if(!isValidWaypoint(wp)) return true;
        return isVisited(wp);
    })) return;
    if(!confirm('The mission ' + mission.title + ' contains waypoints not yet marked as visited.\n\n' +
            'Do you want to set them to \'visited\' now?'))
        return;
    mission.waypoints.forEach(function(wp) {
        if(!isValidWaypoint(wp)) return;
        if(isVisited(wp)) return;
        plugin.uniques.setPortalVisited(wp.portal.guid);
    });
};
var setup = function() {
    window.pluginCreateHook('pluginUniquesUpdateUniques');
    window.pluginCreateHook('pluginUniquesRefreshAll');
    // to mark mission portals as visited
    window.pluginCreateHook('plugin-missions-mission-changed');
    window.pluginCreateHook('plugin-missions-loaded-mission');
    window.plugin.uniques.setupCSS();
    window.plugin.uniques.setupContent();
    window.plugin.uniques.loadLocal('uniques');
    window.addPortalHighlighter('Uniques', window.plugin.uniques.highlighter);
    window.addHook('portalDetailsUpdated', window.plugin.uniques.onPortalDetailsUpdated);
    window.addHook('publicChatDataAvailable', window.plugin.uniques.onPublicChatDataAvailable);
    window.addHook('iitcLoaded', window.plugin.uniques.registerFieldForSyncing);
    window.addHook('plugin-missions-mission-changed', window.plugin.uniques.onMissionChanged);
    window.addHook('plugin-missions-loaded-mission', window.plugin.uniques.onMissionLoaded);
    if(window.plugin.portalslist) {
        window.plugin.uniques.setupPortalsList();
    } else {
        setTimeout(function() {
            if(window.plugin.portalslist)
                window.plugin.uniques.setupPortalsList();
        }, 500);
    }
}
//PLUGIN END //////////////////////////////////////////////////////////
setup.info = plugin_info; //add the script info data to the function as a property
if(!window.bootPlugins) window.bootPlugins = [];
window.bootPlugins.push(setup);
// if IITC has already booted, immediately run the 'setup' function
if(window.iitcLoaded && typeof setup === 'function') setup();
})({"script":{"version":"0.2.4.20150917.154202","name":"IITC plugin: Uniques","description":"[jonatkins-2015-09-17-154202] Allow manual entry of portals visited/captured. Use the 'highlighter-uniques' plugin to show the uniques on the map, and 'sync' to share between multiple browsers or desktop/mobile. It will try and guess which portals you have captured from COMM/portal details, but this will not catch every case."}});
</script>
<script>
(function wrapper(plugin_info) {
// ensure plugin framework is there, even if iitc is not yet loaded
if(typeof window.plugin !== 'function') window.plugin = function() {};
//PLUGIN AUTHORS: writing a plugin outside of the IITC build environment? if so, delete these lines!!
//(leaving them in place might break the 'About IITC' page or break update checks)
plugin_info.buildName = 'jonatkins';
plugin_info.dateTimeVersion = '20150917.154202';
plugin_info.pluginId = 'debug-raw-portal-data';
//END PLUGIN AUTHORS NOTE
// PLUGIN START ////////////////////////////////////////////////////////
// use own namespace for plugin
window.plugin.rawdata = function() {};
window.plugin.rawdata.setupCallback = function() {
    addHook('portalDetailsUpdated', window.plugin.rawdata.addLink);
}
window.plugin.rawdata.addLink = function(d) {
  $('.linkdetails').append('
<aside>
<a onclick="window.plugin.rawdata.showPortalData(\''+window.selectedPortal+'\')" title="Display raw data of the portal">
Raw Data
</a>
</aside>
');
}
window.plugin.rawdata.showPortalData = function(guid) {
  if (!window.portals[guid]) {
    console.warn ('Error: failed to find portal details for guid '+guid+' - failed to show debug data');
    return;
  }
  var data = window.portals[guid].options.data;
  var ts = window.portals[guid].options.timestamp;
  var title = 'Raw portal data: ' + (data.title || '
<no title>
') + ' ('+guid+')';
  var body =
    '
<b>
Portal GUID
</b>
:
<code>
'+guid+'
</code>
<br />
' +
    '
<b>
Entity timestamp
</b>
:
<code>
'+ts+'
</code>
 - '+window.unixTimeToDateTimeString(ts,true)+'
<br />
' +
    '
<b>
Portal map data:
</b>
<pre>
'+JSON.stringify(data,null,2)+'
</pre>
';
  var details = portalDetail.get(guid);
  if (details) {
    body += '
<b>
Portal details:
</b>
<pre>
'+JSON.stringify(details,null,2)+'
</pre>
';
  }
  body += '
<p>
<b>
Links referencing this portal
</b>
</p>
';
  var haslinks = false;
  var linkGuids = getPortalLinks(guid);
  $.each(linkGuids.in.concat(linkGuids.out), function(i,lguid) {
    var l = window.links[lguid];
    var ld = l.options.data;
    body += '
<b>
Link GUID
</b>
:
<code>
'+l.options.guid+'
</code>
<br />
<pre>
'+JSON.stringify(ld,null,2)+'
</pre>
';
    haslinks = true;
  });
  if (!haslinks) body += '
<p>
No links to/from this portal
</p>
';
  body += '
<p>
<b>
Fields referencing this portal
</b>
</p>
';
  var hasfields = false;
  var fieldGuids = getPortalFields(guid);
  $.each(fieldGuids, function(i,fguid) {
    var f = window.fields[fguid];
    var fd = f.options.data;
    body += '
<b>
Field guid
</b>
:
<code>
'+f.options.guid+'
</code>
<br />
<pre>
'+JSON.stringify(fd,null,2)+'
</pre>
';
    hasfields = true;
  });
  if (!hasfields) body += '
<p>
No fields linked to this portal
</p>
';
  dialog({
    title: title,
    html: body,
    id: 'dialog-rawdata',
    dialogClass: 'ui-dialog-rawdata',
  });
}
var setup = function () {
  window.plugin.rawdata.setupCallback();
  $('head').append('
<style>
' +
      '.ui-dialog-rawdata {' +
        'width: auto !important;' +
        'min-width: 400px !important;' +
        //'max-width: 600px !important;' +
    '}' +
      '#dialog-rawdata {' +
        'overflow-x: auto;' +
        'overflow-y: auto;' +
    '}' +
    '
</style>
');
}
// PLUGIN END //////////////////////////////////////////////////////////
setup.info = plugin_info; //add the script info data to the function as a property
if(!window.bootPlugins) window.bootPlugins = [];
window.bootPlugins.push(setup);
// if IITC has already booted, immediately run the 'setup' function
if(window.iitcLoaded && typeof setup === 'function') setup();
})({"script":{"version":"0.2.4.20150917.154202","name":"IITC plugin: Debug: Raw portal JSON data","description":"[jonatkins-2015-09-17-154202] Developer debugging aid: Add a link to the portal details to show the raw data of a portal."}});
</script>
<script>
(function wrapper(plugin_info) {
// ensure plugin framework is there, even if iitc is not yet loaded
if(typeof window.plugin !== 'function') window.plugin = function() {};
//PLUGIN AUTHORS: writing a plugin outside of the IITC build environment? if so, delete these lines!!
//(leaving them in place might break the 'About IITC' page or break update checks)
plugin_info.buildName = 'jonatkins';
plugin_info.dateTimeVersion = '20150917.154202';
plugin_info.pluginId = 'portals-list';
//END PLUGIN AUTHORS NOTE
// PLUGIN START ////////////////////////////////////////////////////////
// use own namespace for plugin
window.plugin.portalslist = function() {};
window.plugin.portalslist.listPortals = [];
window.plugin.portalslist.sortBy = 1; // second column: level
window.plugin.portalslist.sortOrder = -1;
window.plugin.portalslist.enlP = 0;
window.plugin.portalslist.resP = 0;
window.plugin.portalslist.neuP = 0;
window.plugin.portalslist.filter = 0;
/*
 * plugins may add fields by appending their specifiation to the following list. The following members are supported:
 * title: String
 *     Name of the column. Required.
 * value: function(portal)
 *     The raw value of this field. Can by anything. Required, but can be dummy implementation if sortValue and format
 *     are implemented.
 * sortValue: function(value, portal)
 *     The value to sort by. Optional, uses value if omitted. The raw value is passed as first argument.
 * sort: function(valueA, valueB, portalA, portalB)
 *     Custom sorting function. See Array.sort() for details on return value. Both the raw values and the portal objects
 *     are passed as arguments. Optional. Set to null to disable sorting
 * format: function(cell, portal, value)
 *     Used to fill and format the cell, which is given as a DOM node. If omitted, the raw value is put in the cell.
 * defaultOrder: -1|1
 *     Which order should by default be used for this column. -1 means descending. Default: 1
 */
window.plugin.portalslist.fields = [
  {
    title: "Portal Name",
    value: function(portal) { return portal.options.data.title; },
    sortValue: function(value, portal) { return value.toLowerCase(); },
    format: function(cell, portal, value) {
      $(cell)
        .append(plugin.portalslist.getPortalLink(portal))
        .addClass("portalTitle");
    }
  },
  {
    title: "Level",
    value: function(portal) { return portal.options.data.level; },
    format: function(cell, portal, value) {
      $(cell)
        .css('background-color', COLORS_LVL[value])
        .text('L' + value);
    },
    defaultOrder: -1,
  },
  {
    title: "Team",
    value: function(portal) { return portal.options.team; },
    format: function(cell, portal, value) {
      $(cell).text(['NEU', 'RES', 'ENL'][value]);
    }
  },
  {
    title: "Health",
    value: function(portal) { return portal.options.data.health; },
    sortValue: function(value, portal) { return portal.options.team===TEAM_NONE ? -1 : value; },
    format: function(cell, portal, value) {
      $(cell)
        .addClass("alignR")
        .text(portal.options.team===TEAM_NONE ? '-' : value+'%');
    },
    defaultOrder: -1,
  },
  {
    title: "Res",
    value: function(portal) { return portal.options.data.resCount; },
    format: function(cell, portal, value) {
      $(cell)
        .addClass("alignR")
        .text(value);
    },
    defaultOrder: -1,
  },
  {
    title: "Links",
    value: function(portal) { return window.getPortalLinks(portal.options.guid); },
    sortValue: function(value, portal) { return value.in.length + value.out.length; },
    format: function(cell, portal, value) {
      $(cell)
        .addClass("alignR")
        .addClass('help')
        .attr('title', 'In:\t' + value.in.length + '\nOut:\t' + value.out.length)
        .text(value.in.length+value.out.length);
    },
    defaultOrder: -1,
  },
  {
    title: "Fields",
    value: function(portal) { return getPortalFieldsCount(portal.options.guid) },
    format: function(cell, portal, value) {
      $(cell)
        .addClass("alignR")
        .text(value);
    },
    defaultOrder: -1,
  },
  {
    title: "AP",
    value: function(portal) {
      var links = window.getPortalLinks(portal.options.guid);
      var fields = getPortalFieldsCount(portal.options.guid);
      return portalApGainMaths(portal.options.data.resCount, links.in.length+links.out.length, fields);
    },
    sortValue: function(value, portal) { return value.enemyAp; },
    format: function(cell, portal, value) {
      var title = '';
      if (teamStringToId(PLAYER.team) == portal.options.team) {
        title += 'Friendly AP:\t'+value.friendlyAp+'\n'
               + '- deploy '+(8-portal.options.data.resCount)+' resonator(s)\n'
               + '- upgrades/mods unknown\n';
      }
      title += 'Enemy AP:\t'+value.enemyAp+'\n'
             + '- Destroy AP:\t'+value.destroyAp+'\n'
             + '- Capture AP:\t'+value.captureAp;
      $(cell)
        .addClass("alignR")
        .addClass('help')
        .prop('title', title)
        .html(digits(value.enemyAp));
    },
    defaultOrder: -1,
  },
];
//fill the listPortals array with portals avaliable on the map (level filtered portals will not appear in the table)
window.plugin.portalslist.getPortals = function() {
  //filter : 0 = All, 1 = Neutral, 2 = Res, 3 = Enl, -x = all but x
  var retval=false;
  var displayBounds = map.getBounds();
  window.plugin.portalslist.listPortals = [];
  $.each(window.portals, function(i, portal) {
    // eliminate offscreen portals (selected, and in padding)
    if(!displayBounds.contains(portal.getLatLng())) return true;
    retval=true;
    switch (portal.options.team) {
      case TEAM_RES:
        window.plugin.portalslist.resP++;
        break;
      case TEAM_ENL:
        window.plugin.portalslist.enlP++;
        break;
      default:
        window.plugin.portalslist.neuP++;
    }
    // cache values and DOM nodes
    var obj = { portal: portal, values: [], sortValues: [] };
    var row = document.createElement('tr');
    row.className = TEAM_TO_CSS[portal.options.team];
    obj.row = row;
    var cell = row.insertCell(-1);
    cell.className = 'alignR';
    window.plugin.portalslist.fields.forEach(function(field, i) {
      cell = row.insertCell(-1);
      var value = field.value(portal);
      obj.values.push(value);
      obj.sortValues.push(field.sortValue ? field.sortValue(value, portal) : value);
      if(field.format) {
        field.format(cell, portal, value);
      } else {
        cell.textContent = value;
      }
    });
    window.plugin.portalslist.listPortals.push(obj);
  });
  return retval;
}
window.plugin.portalslist.displayPL = function() {
  var list;
  // plugins (e.g. bookmarks) can insert fields before the standard ones - so we need to search for the 'level' column
  window.plugin.portalslist.sortBy = window.plugin.portalslist.fields.map(function(f){return f.title;}).indexOf('Level');
  window.plugin.portalslist.sortOrder = -1;
  window.plugin.portalslist.enlP = 0;
  window.plugin.portalslist.resP = 0;
  window.plugin.portalslist.neuP = 0;
  window.plugin.portalslist.filter = 0;
  if (window.plugin.portalslist.getPortals()) {
    list = window.plugin.portalslist.portalTable(window.plugin.portalslist.sortBy, window.plugin.portalslist.sortOrder,window.plugin.portalslist.filter);
  } else {
    list = $('
<table class="noPortals">
<tr>
<td>
Nothing to show!
</td>
</tr>
</table>
');
  };
  if(window.useAndroidPanes()) {
    $('
<div id="portalslist" class="mobile">
').append(list).appendTo(document.body);
  } else {
    dialog({
      html: $('
<div id="portalslist">
').append(list),
      dialogClass: 'ui-dialog-portalslist',
      title: 'Portal list: ' + window.plugin.portalslist.listPortals.length + ' ' + (window.plugin.portalslist.listPortals.length == 1 ? 'portal' : 'portals'),
      id: 'portal-list',
      width: 700
    });
  }
}
window.plugin.portalslist.portalTable = function(sortBy, sortOrder, filter) {
  // save the sortBy/sortOrder/filter
  window.plugin.portalslist.sortBy = sortBy;
  window.plugin.portalslist.sortOrder = sortOrder;
  window.plugin.portalslist.filter = filter;
  var portals = window.plugin.portalslist.listPortals;
  var sortField = window.plugin.portalslist.fields[sortBy];
  portals.sort(function(a, b) {
    var valueA = a.sortValues[sortBy];
    var valueB = b.sortValues[sortBy];
    if(sortField.sort) {
      return sortOrder * sortField.sort(valueA, valueB, a.portal, b.portal);
    }
//FIXME: sort isn't stable, so re-sorting identical values can change the order of the list.
//fall back to something constant (e.g. portal name?, portal GUID?),
//or switch to a stable sort so order of equal items doesn't change
    return sortOrder *
      (valueA
< valueB ? -1 :
      valueA >
 valueB ?  1 :
      0);
  });
  if(filter !== 0) {
    portals = portals.filter(function(obj) {
      return filter
< 0
        ? obj.portal.options.team+1 != -filter
        : obj.portal.options.team+1 == filter;
    });
  }
  var table, row, cell;
  var container = $('
<div>
');
  table = document.createElement('table');
  table.className = 'filter';
  container.append(table);
  row = table.insertRow(-1);
  var length = window.plugin.portalslist.listPortals.length;
  ["All", "Neutral", "Resistance", "Enlightened"].forEach(function(label, i) {
    cell = row.appendChild(document.createElement('th'));
    cell.className = 'filter' + label.substr(0, 3);
    cell.textContent = label+':';
    cell.title = 'Show only portals of this color';
    $(cell).click(function() {
      $('#portalslist').empty().append(window.plugin.portalslist.portalTable(sortBy, sortOrder, i));
    });
    cell = row.insertCell(-1);
    cell.className = 'filter' + label.substr(0, 3);
    if(i != 0) cell.title = 'Hide portals of this color';
    $(cell).click(function() {
      $('#portalslist').empty().append(window.plugin.portalslist.portalTable(sortBy, sortOrder, -i));
    });
    switch(i-1) {
      case -1:
        cell.textContent = length;
        break;
      case 0:
        cell.textContent = window.plugin.portalslist.neuP + ' (' + Math.round(window.plugin.portalslist.neuP/length*100) + '%)';
        break;
      case 1:
        cell.textContent = window.plugin.portalslist.resP + ' (' + Math.round(window.plugin.portalslist.resP/length*100) + '%)';
        break;
      case 2:
        cell.textContent = window.plugin.portalslist.enlP + ' (' + Math.round(window.plugin.portalslist.enlP/length*100) + '%)';
    }
  });
  table = document.createElement('table');
  table.className = 'portals';
  container.append(table);
  var thead = table.appendChild(document.createElement('thead'));
  row = thead.insertRow(-1);
  cell = row.appendChild(document.createElement('th'));
  cell.textContent = '#';
  window.plugin.portalslist.fields.forEach(function(field, i) {
    cell = row.appendChild(document.createElement('th'));
    cell.textContent = field.title;
    if(field.sort !== null) {
      cell.classList.add("sortable");
      if(i == window.plugin.portalslist.sortBy) {
        cell.classList.add("sorted");
      }
      $(cell).click(function() {
        var order;
        if(i == sortBy) {
          order = -sortOrder;
        } else {
          order = field.defaultOrder
< 0 ? -1 : 1;
        }
        $('#portalslist').empty().append(window.plugin.portalslist.portalTable(i, order, filter));
      });
    }
  });
  portals.forEach(function(obj, i) {
    var row = obj.row
    if(row.parentNode) row.parentNode.removeChild(row);
    row.cells[0].textContent = i+1;
    table.appendChild(row);
  });
  container.append('
<div class="disclaimer">
Click on portals table headers to sort by that column. '
    + 'Click on
<b>
All, Neutral, Resistance, Enlightened
</b>
 to only show portals owner by that faction or on the number behind the factions to show all but those portals.
</div>
');
  return container;
}
// portal link - single click: select portal
//               double click: zoom to and select portal
// code from getPortalLink function by xelio from iitc: AP List - https://raw.github.com/breunigs/ingress-intel-total-conversion/gh-pages/plugins/ap-list.user.js
window.plugin.portalslist.getPortalLink = function(portal) {
  var coord = portal.getLatLng();
  var perma = '/intel?ll='+coord.lat+','+coord.lng+'&z=17&pll='+coord.lat+','+coord.lng;
  // jQuery's event handlers seem to be removed when the nodes are remove from the DOM
  var link = document.createElement("a");
  link.textContent = portal.options.data.title;
  link.href = perma;
  link.addEventListener("click", function(ev) {
    renderPortalDetails(portal.options.guid);
    ev.preventDefault();
    return false;
  }, false);
  link.addEventListener("dblclick", function(ev) {
    zoomToAndShowPortal(portal.options.guid, [coord.lat, coord.lng]);
    ev.preventDefault();
    return false;
  });
  return link;
}
window.plugin.portalslist.onPaneChanged = function(pane) {
  if(pane == "plugin-portalslist")
    window.plugin.portalslist.displayPL();
  else
    $("#portalslist").remove()
};
var setup =  function() {
  if(window.useAndroidPanes()) {
    android.addPane("plugin-portalslist", "Portals list", "ic_action_paste");
    addHook("paneChanged", window.plugin.portalslist.onPaneChanged);
  } else {
    $('#toolbox').append('
<a onclick="window.plugin.portalslist.displayPL()" title="Display a list of portals in the current view [t]" accesskey="t">
Portals list
</a>
');
  }
  $("
<style>
")
    .prop("type", "text/css")
    .html("#portalslist.mobile {\n  background: transparent;\n  border: 0 none !important;\n  height: 100% !important;\n  width: 100% !important;\n  left: 0 !important;\n  top: 0 !important;\n  position: absolute;\n  overflow: auto;\n}\n\n#portalslist table {\n  margin-top: 5px;\n  border-collapse: collapse;\n  empty-cells: show;\n  width: 100%;\n  clear: both;\n}\n\n#portalslist table td, #portalslist table th {\n  background-color: #1b415e;\n  border-bottom: 1px solid #0b314e;\n  color: white;\n  padding: 3px;\n}\n\n#portalslist table th {\n  text-align: center;\n}\n\n#portalslist table .alignR {\n  text-align: right;\n}\n\n#portalslist table.portals td {\n  white-space: nowrap;\n}\n\n#portalslist table th.sortable {\n  cursor: pointer;\n}\n\n#portalslist table .portalTitle {\n  min-width: 120px !important;\n  max-width: 240px !important;\n  overflow: hidden;\n  white-space: nowrap;\n  text-overflow: ellipsis;\n}\n\n#portalslist .sorted {\n  color: #FFCE00;\n}\n\n#portalslist table.filter {\n  table-layout: fixed;\n  cursor: pointer;\n  border-collapse: separate;\n  border-spacing: 1px;\n}\n\n#portalslist table.filter th {\n  text-align: left;\n  padding-left: 0.3em;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n#portalslist table.filter td {\n  text-align: right;\n  padding-right: 0.3em;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n#portalslist .filterNeu {\n  background-color: #666;\n}\n\n#portalslist table tr.res td, #portalslist .filterRes {\n  background-color: #005684;\n}\n\n#portalslist table tr.enl td, #portalslist .filterEnl {\n  background-color: #017f01;\n}\n\n#portalslist table tr.none td {\n  background-color: #000;\n}\n\n#portalslist .disclaimer {\n  margin-top: 10px;\n  font-size: 10px;\n}\n\n#portalslist.mobile table.filter tr {\n  display: block;\n  text-align: center;\n}\n#portalslist.mobile table.filter th, #portalslist.mobile table.filter td {\n  display: inline-block;\n  width: 22%;\n}\n\n")
    .appendTo("head");
}
// PLUGIN END //////////////////////////////////////////////////////////
setup.info = plugin_info; //add the script info data to the function as a property
if(!window.bootPlugins) window.bootPlugins = [];
window.bootPlugins.push(setup);
// if IITC has already booted, immediately run the 'setup' function
if(window.iitcLoaded && typeof setup === 'function') setup();
})({"script":{"version":"0.2.1.20150917.154202","name":"IITC plugin: show list of portals","description":"[jonatkins-2015-09-17-154202] Display a sortable list of all visible portals with full details about the team, resonators, links, etc."}});
</script>
<script>
(function wrapper(plugin_info) {
// ensure plugin framework is there, even if iitc is not yet loaded
if(typeof window.plugin !== 'function') window.plugin = function() {};
//PLUGIN AUTHORS: writing a plugin outside of the IITC build environment? if so, delete these lines!!
//(leaving them in place might break the 'About IITC' page or break update checks)
plugin_info.buildName = 'jonatkins';
plugin_info.dateTimeVersion = '20150917.154202';
plugin_info.pluginId = 'cross_link';
//END PLUGIN AUTHORS NOTE
// PLUGIN START ////////////////////////////////////////////////////////
window.plugin.crossLinks = function() {};
window.plugin.crossLinks.greatCircleArcIntersect = function(a0,a1,b0,b1) {
  // based on the formula at http://williams.best.vwh.net/avform.htm#Int
  // method:
  // check to ensure no line segment is zero length - if so, cannot cross
  // check to see if either of the lines start/end at the same point. if so, then they cannot cross
  // check to see if the line segments overlap in longitude. if not, no crossing
  // if overlap, clip each line to the overlapping longitudes, then see if latitudes cross
  // anti-meridian handling. this code will not sensibly handle a case where one point is
  // close to -180 degrees and the other +180 degrees. unwrap coordinates in this case, so one point
  // is beyond +-180 degrees. this is already true in IITC
  // FIXME? if the two lines have been 'unwrapped' differently - one positive, one negative - it will fail
  // zero length line tests
  if (a0.equals(a1)) return false;
  if (b0.equals(b1)) return false;
  // lines have a common point
  if (a0.equals(b0) || a0.equals(b1)) return false;
  if (a1.equals(b0) || a1.equals(b1)) return false;
  // check for 'horizontal' overlap in lngitude
  if (Math.min(a0.lng,a1.lng) >
 Math.max(b0.lng,b1.lng)) return false;
  if (Math.max(a0.lng,a1.lng)
< Math.min(b0.lng,b1.lng)) return false;
  // ok, our two lines have some horizontal overlap in longitude
  // 1. calculate the overlapping min/max longitude
  // 2. calculate each line latitude at each point
  // 3. if latitudes change place between overlapping range, the lines cross
  // class to hold the pre-calculated maths for a geodesic line
  // TODO: move this outside this function, so it can be pre-calculated once for each line we test
  var GeodesicLine = function(start,end) {
    var d2r = Math.PI/180.0;
    var r2d = 180.0/Math.PI;
    // maths based on http://williams.best.vwh.net/avform.htm#Int
    if (start.lng == end.lng) {
      throw 'Error: cannot calculate latitude for meridians';
    }
    // only the variables needed to calculate a latitude for a given longitude are stored in 'this'
    this.lat1 = start.lat * d2r;
    this.lat2 = end.lat * d2r;
    this.lng1 = start.lng * d2r;
    this.lng2 = end.lng * d2r;
    var dLng = this.lng1-this.lng2;
    var sinLat1 = Math.sin(this.lat1);
    var sinLat2 = Math.sin(this.lat2);
    var cosLat1 = Math.cos(this.lat1);
    var cosLat2 = Math.cos(this.lat2);
    this.sinLat1CosLat2 = sinLat1*cosLat2;
    this.sinLat2CosLat1 = sinLat2*cosLat1;
    this.cosLat1CosLat2SinDLng = cosLat1*cosLat2*Math.sin(dLng);
  }
  GeodesicLine.prototype.isMeridian = function() {
    return this.lng1 == this.lng2;
  }
  GeodesicLine.prototype.latAtLng = function(lng) {
    lng = lng * Math.PI / 180; //to radians
    var lat;
    // if we're testing the start/end point, return that directly rather than calculating
    // 1. this may be fractionally faster, no complex maths
    // 2. there's odd rounding issues that occur on some browsers (noticed on IITC MObile) for very short links - this may help
    if (lng == this.lng1) {
      lat = this.lat1;
    } else if (lng == this.lng2) {
      lat = this.lat2;
    } else {
      lat = Math.atan ( (this.sinLat1CosLat2*Math.sin(lng-this.lng2) - this.sinLat2CosLat1*Math.sin(lng-this.lng1))
                       / this.cosLat1CosLat2SinDLng);
    }
    return lat * 180 / Math.PI; // return value in degrees
  }
  // calculate the longitude of the overlapping region
  var leftLng = Math.max( Math.min(a0.lng,a1.lng), Math.min(b0.lng,b1.lng) );
  var rightLng = Math.min( Math.max(a0.lng,a1.lng), Math.max(b0.lng,b1.lng) );
  // calculate the latitudes for each line at left + right longitudes
  // NOTE: need a special case for meridians - as GeodesicLine.latAtLng method is invalid in that case
  var aLeftLat, aRightLat;
  if (a0.lng == a1.lng) {
    // 'left' and 'right' now become 'top' and 'bottom' (in some order) - which is fine for the below intersection code
    aLeftLat = a0.lat;
    aRightLat = a1.lat;
  } else {
    var aGeo = new GeodesicLine(a0,a1);
    aLeftLat = aGeo.latAtLng(leftLng);
    aRightLat = aGeo.latAtLng(rightLng);
  }
  var bLeftLat, bRightLat;
  if (b0.lng == b1.lng) {
    // 'left' and 'right' now become 'top' and 'bottom' (in some order) - which is fine for the below intersection code
    bLeftLat = b0.lat;
    bRightLat = b1.lat;
  } else {
    var bGeo = new GeodesicLine(b0,b1);
    bLeftLat = bGeo.latAtLng(leftLng);
    bRightLat = bGeo.latAtLng(rightLng);
  }
  // if both a are less or greater than both b, then lines do not cross
  if (aLeftLat
< bLeftLat && aRightLat
< bRightLat) return false;
  if (aLeftLat >
 bLeftLat && aRightLat >
 bRightLat) return false;
  // latitudes cross between left and right - so geodesic lines cross
  return true;
}
window.plugin.crossLinks.testPolyLine = function (polyline, link,closed) {
    var a = link.getLatLngs();
    var b = polyline.getLatLngs();
    for (var i=0;i
<b.length-1;++i) {
        if (window.plugin.crossLinks.greatCircleArcIntersect(a[0],a[1],b[i],b[i+1])) return true;
    }
    if (closed) {
        if (window.plugin.crossLinks.greatCircleArcIntersect(a[0],a[1],b[b.length-1],b[0])) return true;
    }
    return false;
}
window.plugin.crossLinks.onLinkAdded = function (data) {
    if (window.plugin.crossLinks.disabled) return;
    plugin.crossLinks.testLink(data.link);
}
window.plugin.crossLinks.checkAllLinks = function() {
    if (window.plugin.crossLinks.disabled) return;
    console.debug("Cross-Links: checking all links");
    plugin.crossLinks.linkLayer.clearLayers();
    plugin.crossLinks.linkLayerGuids = {};
    $.each(window.links, function(guid, link) {
        plugin.crossLinks.testLink(link);
    });
}
window.plugin.crossLinks.testLink = function (link) {
    if (plugin.crossLinks.linkLayerGuids[link.options.guid]) return;
    for (var i in plugin.drawTools.drawnItems._layers) { // leaflet don't support breaking out of the loop
       var layer = plugin.drawTools.drawnItems._layers[i];
       if (layer instanceof L.GeodesicPolygon) {
           if (plugin.crossLinks.testPolyLine(layer, link,true)) {
               plugin.crossLinks.showLink(link);
               break;
           }
        } else if (layer instanceof L.GeodesicPolyline) {
            if (plugin.crossLinks.testPolyLine(layer, link)) {
                plugin.crossLinks.showLink(link);
                break;
            }
        }
    };
}
window.plugin.crossLinks.showLink = function(link) {
    var poly = L.geodesicPolyline(link.getLatLngs(), {
       color: '#d22',
       opacity: 0.7,
       weight: 5,
       clickable: false,
       dashArray: [8,8],
       guid: link.options.guid
    });
    poly.addTo(plugin.crossLinks.linkLayer);
    plugin.crossLinks.linkLayerGuids[link.options.guid]=poly;
}
window.plugin.crossLinks.onMapDataRefreshEnd = function () {
    if (window.plugin.crossLinks.disabled) return;
    window.plugin.crossLinks.linkLayer.bringToFront();
    window.plugin.crossLinks.testForDeletedLinks();
}
window.plugin.crossLinks.testAllLinksAgainstLayer = function (layer) {
    if (window.plugin.crossLinks.disabled) return;
    $.each(window.links, function(guid, link) {
        if (!plugin.crossLinks.linkLayerGuids[link.options.guid])
        {
            if (layer instanceof L.GeodesicPolygon) {
                if (plugin.crossLinks.testPolyLine(layer, link,true)) {
                    plugin.crossLinks.showLink(link);
                }
            } else if (layer instanceof L.GeodesicPolyline) {
                if (plugin.crossLinks.testPolyLine(layer, link)) {
                    plugin.crossLinks.showLink(link);
                }
            }
        }
    });
}
window.plugin.crossLinks.testForDeletedLinks = function () {
    window.plugin.crossLinks.linkLayer.eachLayer( function(layer) {
        var guid = layer.options.guid;
        if (!window.links[guid]) {
            console.log("link removed");
            plugin.crossLinks.linkLayer.removeLayer(layer);
            delete plugin.crossLinks.linkLayerGuids[guid];
        }
    });
}
window.plugin.crossLinks.createLayer = function() {
    window.plugin.crossLinks.linkLayer = new L.FeatureGroup();
    window.plugin.crossLinks.linkLayerGuids={};
    window.addLayerGroup('Cross Links', window.plugin.crossLinks.linkLayer, true);
    map.on('layeradd', function(obj) {
      if(obj.layer === window.plugin.crossLinks.linkLayer) {
        delete window.plugin.crossLinks.disabled;
        window.plugin.crossLinks.checkAllLinks();
      }
    });
    map.on('layerremove', function(obj) {
      if(obj.layer === window.plugin.crossLinks.linkLayer) {
        window.plugin.crossLinks.disabled = true;
        window.plugin.crossLinks.linkLayer.clearLayers();
        plugin.crossLinks.linkLayerGuids = {};
      }
    });
    // ensure 'disabled' flag is initialised
    if (!map.hasLayer(window.plugin.crossLinks.linkLayer)) {
        window.plugin.crossLinks.disabled = true;
    }
}
var setup = function() {
    if (window.plugin.drawTools === undefined) {
       alert("'Cross-Links' requires 'draw-tools'");
       return;
    }
    // this plugin also needs to create the draw-tools hook, in case it is initialised before draw-tools
    window.pluginCreateHook('pluginDrawTools');
    window.plugin.crossLinks.createLayer();
    // events
    window.addHook('pluginDrawTools',function(e) {
        if (e.event == 'layerCreated') {
            // we can just test the new layer in this case
            window.plugin.crossLinks.testAllLinksAgainstLayer(e.layer);
        } else {
            // all other event types - assume anything could have been modified and re-check all links
            window.plugin.crossLinks.checkAllLinks();
        }
    });
    window.addHook('linkAdded', window.plugin.crossLinks.onLinkAdded);
    window.addHook('mapDataRefreshEnd', window.plugin.crossLinks.onMapDataRefreshEnd);
}
// PLUGIN END //////////////////////////////////////////////////////////
setup.info = plugin_info; //add the script info data to the function as a property
if(!window.bootPlugins) window.bootPlugins = [];
window.bootPlugins.push(setup);
// if IITC has already booted, immediately run the 'setup' function
if(window.iitcLoaded && typeof setup === 'function') setup();
})({"script":{"version":"1.1.2.20150917.154202","name":"IITC plugin: cross links","description":"[jonatkins-2015-09-17-154202] EXPERIMENTAL: Checks for existing links that cross planned links. Requires draw-tools plugin."}});
</script>
<script>
(function wrapper(plugin_info) {
// ensure plugin framework is there, even if iitc is not yet loaded
if(typeof window.plugin !== 'function') window.plugin = function() {};
//PLUGIN AUTHORS: writing a plugin outside of the IITC build environment? if so, delete these lines!!
//(leaving them in place might break the 'About IITC' page or break update checks)
plugin_info.buildName = 'jonatkins';
plugin_info.dateTimeVersion = '20150917.154202';
plugin_info.pluginId = 'missions';
//END PLUGIN AUTHORS NOTE
// PLUGIN START ////////////////////////////////////////////////////////
var decodeWaypoint = function(data) {
    var result = {
        hidden: data[0],
        guid: data[1],
        title: data[2],
        typeNum: data[3],
        type: [null, 'Portal', 'Field Trip'][data[3]],
        objectiveNum: data[4],
        objective: [null, 'Hack this Portal', 'Capture or Upgrade Portal', 'Create Link from Portal', 'Create Field from Portal', 'Install a Mod on this Portal', 'Take a Photo', 'View this Field Trip Waypoint', 'Enter the Passphrase'][data[4]],
    };
    if (result.typeNum === 1 && data[5]) {
        result.portal = window.decodeArray.portalSummary(data[5]);
        // Portal waypoints have the same guid as the respective portal.
        result.portal.guid = result.guid;
    }
    return result;
};
var decodeMission = function(data) {
    return {
        guid: data[0],
        title: data[1],
        description: data[2],
        authorNickname: data[3],
        authorTeam: data[4],
        // Notice: this format is weird(100%: 1.000.000)
        ratingE6: data[5],
        medianCompletionTimeMs: data[6],
        numUniqueCompletedPlayers: data[7],
        typeNum: data[8],
        type: [null, 'Sequential', 'Non Sequential', 'Hidden'][data[8]],
        waypoints: data[9].map(decodeWaypoint),
        image: data[10]
    };
};
var decodeMissionSummary = function(data) {
    return {
        guid: data[0],
        title: data[1],
        image: data[2],
        ratingE6: data[3],
        medianCompletionTimeMs: data[4]
    };
};
var timeToRemaining = function(t) {
    var data = parseInt(t / 86400) + 'd ' + (new Date(t % 86400 * 1000)).toUTCString().replace(/.*(\d{2}):(\d{2}):(\d{2}).*/, '$1h $2m $3s');
    data = data.replace('0d', '');
    data = data.replace('00h', '');
    data = data.replace('00m', '');
    return data.trim();
};
window.plugin.missions = {
    // 3 days.
    missionCacheTime: 3 * 24 * 3600 * 1E3,
    // 3 weeks.
    portalMissionsCacheTime: 21 * 24 * 3600 * 1E3,
    MISSION_COLOR: '#404000',
    MISSION_COLOR_ACTIVE: '#7f7f00',
    MISSION_COLOR_START: '#A6A600',
    SYNC_DELAY: 5000,
    enableSync: false,
    missionTypeImages: [
        'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASAQMAAABsABwUAAAABlBMVEWN+1Sx+/dsz4yeAAAAAXRSTlMAQObYZgAAAClJREFUCNdjYIACxgcMDOwfGBjYKoAcCyCugOIPEDnGAxAMVnsAlQ8EAEkHCRVXxWK2AAAAAElFTkSuQmCC',
        'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASAQMAAABsABwUAAAABlBMVEUAAACy+/gnk9HpAAAAAXRSTlMAQObYZgAAAB9JREFUCNdjYMAGBIBYAohlGBju/zsAxiA2WEwAqw4Az84Fw61PmPwAAAAASUVORK5CYII=',
        'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASAQMAAABsABwUAAAABlBMVEUAAACy+/gnk9HpAAAAAXRSTlMAQObYZgAAAClJREFUCNdjYACBB0gYCBgFIJiJA4JZWCCYgwmCQaCA8QBD+d8DYBoIAN15B5HS9gdlAAAAAElFTkSuQmCC',
        'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASAQMAAABsABwUAAAABlBMVEWq+02y+/jJjgLNAAAAAXRSTlMAQObYZgAAADdJREFUCNdjYAAC9gMMDDwPgIwEIAbSjA0MDMwgzADBIMAsAMQSQIYMA8P9fwfAGMRmAIkJMAAAQKIJxqg43P4AAAAASUVORK5CYII=',
    ],
    onPortalSelected: function(event) {
        /*if(event.selectedPortalGuid === event.unselectedPortalGuid) {
            return;
        }*/
        if (window.selectedPortal === null) {
            return;
        }
        var portal = window.portals[window.selectedPortal];
        if (!portal || (!portal.options.data.mission && !portal.options.data.mission50plus)) {
            return;
        }
        // After select.
        setTimeout(function() {
            // #resodetails
            $('.linkdetails').append('
<aside>
<a tabindex="0" onclick="plugin.missions.openPortalMissions();" >
Missions
</a>
</aside>
');
        }, 0);
    },
    openTopMissions: function(bounds) {
        bounds = bounds || window.map.getBounds();
        this.loadMissionsInBounds(bounds, this.showMissionListDialog.bind(this));
    },
    openPortalMissions: function() {
        this.loadPortalMissions(window.selectedPortal, function(missions) {
            if (!missions.length) {
                return;
            }
            if (missions.length === 1) {
                this.loadMission(missions[0].guid, this.showMissionDialog.bind(this));
            } else {
                this.showMissionListDialog(missions);
            }
        }.bind(this));
    },
    openMission: function(guid) {
        this.loadMission(guid, this.showMissionDialog.bind(this));
    },
    showMissionDialog: function(mission) {
        var me = this;
        var markers = this.drawMission(mission);
        var content = this.renderMission(mission);
        var id = mission.guid.replace(/\./g, '_'); // dots irritate the dialog framework and are not allowed in HTML IDs
        if(useAndroidPanes()) {
            if(this.tabHeaders[id]) {
                this.tabHeaders[id].parentNode.querySelector('.ui-icon-close').click();
            }
            this.tabMarkers[id] = markers;
            var button = content.insertBefore(document.createElement('button'), content.lastChild);
            button.textContent = 'Zoom to mission';
            button.addEventListener('click', function() {
                me.zoomToMission(mission);
                show('map');
            }, false);
            var li = this.tabBar.appendChild(document.createElement('li'));
            li.dataset['mission_id'] = id;
            var a = li.appendChild(document.createElement('a'));
            a.textContent = mission.title;
            a.href = '#mission_pane_'+id;
            this.tabHeaders[id] = a;
            var span = li.appendChild(document.createElement('span'));
            span.className = 'ui-icon ui-icon-close';
            span.textContent = 'Close mission';
            span.addEventListener('click', function() {
                this.removeMissionLayers(markers);
                li.parentNode.removeChild(li);
                content.parentNode.removeChild(content);
                delete this.tabHeaders[id];
                delete this.tabMarkers[id];
                $(this.tabs)
                    .tabs('refresh')
                    .find('.ui-tabs-nav')
                        .sortable('refresh');
            }.bind(this), false);
            this.tabs.appendChild(content);
            content.id = 'mission_pane_'+id;
            var tabs = $(this.tabs);
            tabs.tabs('refresh');
            tabs.find('.ui-tabs-nav').sortable('refresh');
            tabs.tabs('option','active', -1);
            if(window.isSmartphone())
                show('plugin-missions');
        } else {
            dialog({
                id: 'plugin-mission-details-' + id,
                title: mission.title,
                height: 'auto',
                html: content,
                width: '450px',
                closeCallback: function() {
                    me.removeMissionLayers(markers);
                },
                collapseCallback: this.collapseFix,
                expandCallback: this.collapseFix,
                focus: function() {
                    me.highlightMissionLayers(markers);
                }
            }).dialog('option', 'buttons', {
                'Zoom to mission': function() {
                    me.zoomToMission(mission);
                },
                'OK': function() { $(this).dialog('close'); },
            });
        }
    },
    showMissionListDialog: function(missions) {
        dialog({
            html: this.renderMissionList(missions),
            height: 'auto',
            width: '400px',
            collapseCallback: this.collapseFix,
            expandCallback: this.collapseFix,
        }).dialog('option', 'buttons', {
            'Create new mission': function() { open('//mission-author-dot-betaspike.appspot.com'); },
            'OK': function() { $(this).dialog('close'); },
        });
    },
    collapseFix: function() {
        if (this && this.parentNode) {
            this.parentNode.style.height = 'auto';
        }
    },
    zoomToMission: function(mission) {
        map.fitBounds(this.getMissionBounds(mission), {maxZoom: 17});
    },
    getMissionBounds: function(mission) {
        var latlngs = mission.waypoints.filter(function(waypoint) {
            return !!waypoint.portal;
        }).map(function(waypoint) {
            return [waypoint.portal.latE6/1E6, waypoint.portal.lngE6/1E6];
        });
        return L.latLngBounds(latlngs);
    },
    loadMissionsInBounds: function(bounds, callback, errorcallback) {
        var me = this;
        window.postAjax('getTopMissionsInBounds', {
            northE6: ((bounds.getNorth() * 1000000) | 0),
            southE6: ((bounds.getSouth() * 1000000) | 0),
            westE6: ((bounds.getWest() * 1000000) | 0),
            eastE6: ((bounds.getEast() * 1000000) | 0)
        }, function(data) {
            var missions = data.result.map(decodeMissionSummary);
            if (!missions) {
                if (errorcallback) {
                    errorcallback('Invalid data');
                }
                return;
            }
            callback(missions);
        }, function(error) {
            console.error('Error loading missions in bounds', arguments);
            if (errorcallback) {
                errorcallback(error);
            }
        });
    },
    loadPortalMissions: function(guid, callback, errorcallback) {
        var me = this;
        // Mission summary rarely goes stale.
        if (me.cacheByPortalGuid[guid] && this.cacheByPortalGuid[guid].time >
 (Date.now() - this.portalMissionsCacheTime)) {
            callback(me.cacheByPortalGuid[guid].data);
            return;
        }
        window.postAjax('getTopMissionsForPortal', {
            guid: guid,
        }, function(data) {
            var missions = data.result.map(decodeMissionSummary);
            if (!missions) {
                if (errorcallback) {
                    errorcallback('Invalid data');
                }
                return;
            }
            window.runHooks('plugin-missions-on-portal-loaded', { missions: missions, portalguid: guid });
            me.cacheByPortalGuid[guid] = {
                time: Date.now(),
                data: missions
            };
            me.storeCache();
            callback(missions);
        }, function(error) {
            console.error('Error loading portal missions', arguments);
            if (errorcallback) {
                errorcallback(error);
            }
            // awww
        });
    },
    loadMission: function(guid, callback, errorcallback) {
        var me = this;
        // TODO: we need to refresh data often enough, portal data can quickly go stale
        if (this.cacheByMissionGuid[guid] && this.cacheByMissionGuid[guid].time >
 (Date.now() - this.missionCacheTime)) {
            callback(this.getMissionCache(guid, true));
            return;
        }
        window.postAjax('getMissionDetails', {
            guid: guid
        }, function(data) {
            var mission = decodeMission(data.result);
            if (!mission) {
                if (errorcallback) {
                    errorcallback('Invalid data');
                }
                return;
            }
            window.runHooks('plugin-missions-loaded-mission', { mission: mission });
            me.cacheByMissionGuid[guid] = {
                time: Date.now(),
                data: mission
            };
            me.storeCache();
            callback(mission);
        }, function() {
            console.error('Error loading mission data: ' + guid + ', ' + Array.prototype.slice.call(arguments));
            if (errorcallback) {
                errorcallback(error);
            }
            // awww
        });
    },
    renderMissionList: function(missions) {
        var container = document.createElement('div');
        missions.forEach(function(mission) {
            container.appendChild(this.renderMissionSummary(mission));
        }, this);
        return container;
    },
    renderMissionSummary: function(mission) {
        var cachedMission = this.getMissionCache(mission.guid);
        var checked = this.checkedMissions[mission.guid];
        var container = document.createElement('div');
        container.className = 'plugin-mission-summary';
        container.dataset['mission_mid'] = mission.guid;
        if(checked)
            container.classList.add('checked');
        var img = container.appendChild(document.createElement('img'));
        img.src = mission.image;
        img.addEventListener('click', function(ev) {
            plugin.missions.toggleMission(mission.guid);
        }, false);
        var title = container.appendChild(document.createElement('a'));
        title.textContent = mission.title;
        title.href = '/mission/' + mission.guid;
        title.addEventListener('click', function(ev) {
            this.openMission(mission.guid);
            // prevent browser from following link
            ev.preventDefault();
            return false;
        }.bind(this), false);
        if(cachedMission) {
            var span = container.appendChild(document.createElement('span'));
            span.className = 'nickname ' + (cachedMission.authorTeam === 'R' ? 'res' : 'enl')
            span.textContent = cachedMission.authorNickname;
            var len = cachedMission.waypoints.filter(function(waypoint) {
                return !!waypoint.portal;
            }).map(function(waypoint) {
                return L.latLng(waypoint.portal.latE6/1E6, waypoint.portal.lngE6/1E6);
            }).map(function(latlng1, i, latlngs) {
                if(i == 0) return 0;
                var latlng2 = latlngs[i - 1];
                return latlng1.distanceTo(latlng2);
            }).reduce(function(a, b) {
                return a + b;
            });
            if(len >
 0) {
                if(len >
 1000)
                    len = Math.round(len / 100) / 10 + 'km';
                else
                    len = Math.round(len * 10) / 10 + 'm';
                var infoLength = container.appendChild(document.createElement('span'));
                infoLength.className = 'plugin-mission-info length help';
                infoLength.title = 'Length of this mission.\n\nNOTE: The actual distance required to cover may vary depending on several factors!';
                infoLength.textContent = len;
                img = infoLength.insertBefore(document.createElement('img'), infoLength.firstChild);
                img.src = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASAQMAAABsABwUAAAABlBMVEUAAACy+/gnk9HpAAAAAXRSTlMAQObYZgAAABVJREFUCNdjYEADB9Dg//8QjA7RAAB2VBF9TkATUAAAAABJRU5ErkJggg==';
            }
            if(window.plugin.distanceToPortal && window.plugin.distanceToPortal.currentLoc) {
                var infoDistance = container.appendChild(document.createElement('span'));
                infoDistance.className = 'plugin-mission-info distance help';
                infoDistance.title = 'Distance to this mission. Click to update.';
                infoDistance.addEventListener('click', function() {
                    plugin.missions.renderMissionDistance(cachedMission, infoDistance);
                }, false);
                this.renderMissionDistance(cachedMission, infoDistance);
            }
        }
        container.appendChild(document.createElement('br'));
        var infoTime = container.appendChild(document.createElement('span'));
        infoTime.className = 'plugin-mission-info time help';
        infoTime.title = 'Typical duration';
        infoTime.textContent = timeToRemaining((mission.medianCompletionTimeMs / 1000) | 0) + ' ';
        img = infoTime.insertBefore(document.createElement('img'), infoTime.firstChild);
        img.src = 'https://commondatastorage.googleapis.com/ingress.com/img/tm_icons/time.png';
        var infoRating = container.appendChild(document.createElement('span'));
        infoRating.className = 'plugin-mission-info rating help';
        infoRating.title = 'Average rating';
        infoRating.textContent = (((mission.ratingE6 / 100) | 0) / 100) + '%' + ' ';
        img = infoRating.insertBefore(document.createElement('img'), infoRating.firstChild);
        img.src = 'https://commondatastorage.googleapis.com/ingress.com/img/tm_icons/like.png';
        if (cachedMission) {
            var infoPlayers = container.appendChild(document.createElement('span'));
            infoPlayers.className = 'plugin-mission-info players help';
            infoPlayers.title = 'Unique players who have completed this mission';
            infoPlayers.textContent = cachedMission.numUniqueCompletedPlayers + ' ';
            img = infoPlayers.insertBefore(document.createElement('img'), infoPlayers.firstChild);
            img.src = 'https://commondatastorage.googleapis.com/ingress.com/img/tm_icons/players.png';
            var infoWaypoints = container.appendChild(document.createElement('span'));
            infoWaypoints.className = 'plugin-mission-info waypoints help';
            infoWaypoints.title = (cachedMission.type ? cachedMission.type + ' mission' : 'Unknown mission type')
                                + ' with ' + cachedMission.waypoints.length + ' waypoints';
            infoWaypoints.textContent = cachedMission.waypoints.length + ' ';
            img = infoWaypoints.insertBefore(document.createElement('img'), infoWaypoints.firstChild);
            img.src = this.missionTypeImages[cachedMission.typeNum] || this.missionTypeImages[0];
        }
        return container;
    },
    renderMissionDistance: function(mission /* cached mission, full details*/, container) {
        if(!(plugin.distanceToPortal && plugin.distanceToPortal.currentLoc)) return;
        var distances = mission.waypoints
            .filter(function(waypoint) {
                return !!waypoint.portal;
            })
            .map(function(waypoint) {
                var position = L.latLng(waypoint.portal.latE6/1E6, waypoint.portal.lngE6/1E6);
                var distance = position.distanceTo(plugin.distanceToPortal.currentLoc);
                return {
                    waypoint: waypoint,
                    distance: distance,
                    position: position,
                };
            });
        if(!distances.length) return;
        if(mission.typeNum == 2) { // non-sequential
            distances.sort(function(a, b) { return a.distance - b.distance; });
        }
        var position = distances[0].position;
        var distance = distances[0].distance;
        var bearing = window.plugin.distanceToPortal.currentLoc.bearingTo(position);
        $(container)
            .text(window.plugin.distanceToPortal.formatDistance(distance))
            .prepend($('
<span>
')
                .addClass('portal-distance-bearing')
                .css({
                    'transform': 'rotate('+bearing+'deg)',
                    '-moz-transform': 'rotate('+bearing+'deg)',
                    '-webkit-transform': 'rotate('+bearing+'deg)',
                }));
    },
    renderMission: function(mission) {
        var container = document.createElement('div');
        container.className = 'plugin-mission-details';
        var summary = container.appendChild(this.renderMissionSummary(mission));
        var desc = summary.appendChild(document.createElement('p'));
        desc.className = 'description';
        desc.textContent = mission.description;
        var list = container.appendChild(document.createElement('ol'))
        mission.waypoints.forEach(function(waypoint, index) {
            list.appendChild(this.renderMissionWaypoint(waypoint, index, mission));
        }, this);
        return container;
    },
    renderMissionWaypoint: function(waypoint, index, mission) {
        var container = document.createElement('li');
        container.className = 'plugin-mission-waypoint';
        if (waypoint.portal) {
            container.appendChild(this.renderPortalCircle(waypoint.portal));
            var title = container.appendChild(document.createElement('a'));
            var lat = waypoint.portal.latE6/1E6;
            var lng = waypoint.portal.lngE6/1E6;
            var perma = '/intel?ll='+lat+','+lng+'&z=17&pll='+lat+','+lng;
            title.href = perma;
            title.addEventListener('click', function(ev) {
                if(window.isSmartphone())
                    show('map');
                selectPortalByLatLng(lat, lng);
                ev.preventDefault();
                return false;
            }, false);
            title.addEventListener('dblclick', function(ev) {
                if(window.isSmartphone())
                    show('map');
                zoomToAndShowPortal(waypoint.portal.guid, [lat, lng]);
                ev.preventDefault();
                return false;
            }, false);
        } else if(waypoint.typeNum === 1) {
            // if typeNum === 1 but portal is undefined, this waypoint is a deleted portal.
            var title = container.appendChild(document.createElement('span'));
            container.classList.add('unavailable');
        } else {
            var title = container.appendChild(document.createElement('span'));
        }
        title.className = 'title';
        if(waypoint.title)
            title.textContent = waypoint.title;
        else if(waypoint.portal && waypoint.portal.title)
            title.textContent = waypoint.portal.title;
        else
            title.textContent = 'Unknown';
        var mwpid = mission.guid + '-' + index + '-' + waypoint.guid;
        var checked = this.checkedWaypoints[mwpid];
        var label = container.appendChild(document.createElement('label'));
        var checkbox = label.appendChild(document.createElement('input'));
        checkbox.type = 'checkbox';
        checkbox.addEventListener('change', function() {
            plugin.missions.toggleWaypoint(mission.guid, mwpid);
        }, false);
        checkbox.dataset['mission_mwpid'] = mwpid;
        var objective = label.appendChild(document.createElement('span'));
        objective.textContent = waypoint.objective ? waypoint.objective : '?';
        return container;
    },
    renderPortalCircle: function(portal) {
        var team = TEAM_TO_CSS[getTeam(portal)];
        var resCount = portal.resCount;
        var level = resCount == 0 ? 0 : portal.level; // we want neutral portals to be level 0
        var container = document.createElement('div');
        container.className = 'plugin-mission-portal-indicator help ' + team;
        container.textContent = level;
        container.title = 'Level:\t'+level+'\nResonators:\t'+resCount+'\nHealth:\t'+portal.health+'%';
        for(var i = 0; i
< resCount; i++) {
            var resonator = container.appendChild(document.createElement('div'));
            /* Firefox supports transform* without vendor prefix, but Android does not yet */
            resonator.style.transform = 'rotate(' + i*45 + 'deg)';
            resonator.style.webkitTransform = 'rotate(' + i*45 + 'deg)';
        }
        return container;
    },
    toggleWaypoint: function(mid, mwpid, dontsave) {
        if(this.checkedWaypoints[mwpid])
            delete this.checkedWaypoints[mwpid];
        else
            this.checkedWaypoints[mwpid] = true;
        window.runHooks('plugin-missions-waypoint-changed', { mwpid: mwpid, local: true, });
        if (!dontsave) {
            this.checkedWaypointsUpdateQueue[mwpid] = true;
            this.storeLocal('checkedWaypoints');
            this.storeLocal('checkedWaypointsUpdateQueue');
            this.syncQueue();
        }
    },
    onWaypointChanged: function(data) {
        var mwpid = data.mwpid;
        var checked = !!this.checkedWaypoints[mwpid];
        $('[data-mission_mwpid="'+mwpid+'"]').prop('checked', checked);
    },
    onWaypointsRefreshed: function() {
        $('[data-mission_mwpid]').each(function(i, element) {
            var mwpid = element.dataset['mission_mwpid'];
            var checked = !!this.checkedWaypoints[mwpid];
            element.checked = checked;
        });
    },
    toggleMission: function(mid) {
        if(this.checkedMissions[mid])
            delete this.checkedMissions[mid];
        else
            this.checkedMissions[mid] = true;
        window.runHooks('plugin-missions-mission-changed', { mid: mid, local: true, });
        this.checkedMissionsUpdateQueue[mid] = true;
        this.storeLocal('checkedMissions');
        this.storeLocal('checkedMissionsUpdateQueue');
        this.syncQueue();
    },
    onMissionChanged: function(data) {
        var mid = data.mid;
        var checked = !!this.checkedMissions[mid];
        $('[data-mission_mid="'+mid+'"]').toggleClass('checked', checked);
    },
    onMissionsRefreshed: function() {
        $('[data-mission_mid]').each(function(i, element) {
            var mid = element.dataset['mission_mid'];
            var checked = !!this.checkedMissions[mid];
            $(element).toggleClass('checked', checked);
        });
    },
    getMissionCache: function(guid, updatePortals) {
        if (this.cacheByMissionGuid[guid]) {
            var cache = this.cacheByMissionGuid[guid];
            // Update portal data from map if older then 2 minutes.
            if (updatePortals && cache.time
< (Date.now() - (2 * 60 * 1000))) {
                cache.data.waypoints.map(function(waypoint) {
                    if (!waypoint.portal) {
                        return;
                    }
                    var wp = window.portals[waypoint.portal.guid];
                    if (!wp) {
                        return;
                    }
                    $.extend(waypoint.portal, wp.options.data);
                });
            }
            return cache.data;
        }
        return null;
    },
    getPortalCache: function(guid) {
        if (this.cacheByPortalGuid[guid]) {
            return this.cacheByPortalGuid[guid].data;
        }
        return null;
    },
    storeCache: function() {
        this.checkCacheSize();
        localStorage['plugins-missions-portalcache'] = JSON.stringify(this.cacheByPortalGuid);
        localStorage['plugins-missions-missioncache'] = JSON.stringify(this.cacheByMissionGuid);
    },
    storeLocal: function(key) {
        localStorage['plugins-missions-' + key] = JSON.stringify(this[key]);
    },
    loadData: function() {
        this.cacheByPortalGuid = JSON.parse(localStorage['plugins-missions-portalcache'] || '{}');
        this.cacheByMissionGuid = JSON.parse(localStorage['plugins-missions-missioncache'] || '{}');
        if('plugins-missions-settings' in localStorage) {
            var settings = JSON.parse(localStorage['plugins-missions-settings'] || '{}');
            localStorage['plugins-missions-checkedMissions'] = JSON.stringify(settings.checkedMissions);
            localStorage['plugins-missions-checkedWaypoints'] = JSON.stringify(settings.checkedWaypoints);
            delete localStorage['plugins-missions-settings'];
        }
        this.loadLocal('checkedMissions');
        this.loadLocal('checkedMissionsUpdateQueue');
        this.loadLocal('checkedMissionsUpdatingQueue');
        this.loadLocal('checkedWaypoints');
        this.loadLocal('checkedWaypointsUpdateQueue');
        this.loadLocal('checkedWaypointsUpdatingQueue');
    },
    loadLocal: function(key) {
        this[key] = JSON.parse(localStorage['plugins-missions-' + key] || '{}');
    },
    checkCacheSize: function() {
        if (JSON.stringify(this.cacheByPortalGuid).length >
 1e6) { // 1 MB not MiB ;)
            this.cleanupPortalCache();
        }
        if (JSON.stringify(this.cacheByMissionGuid).length >
 2e6) { // 2 MB not MiB ;)
            this.cleanupMissionCache();
        }
    },
    // Cleanup oldest half of the data.
    cleanupPortalCache: function() {
        var me = this;
        var cache = Object.keys(this.cacheByPortalGuid);
        cache.sort(function(a, b) {
            return me.cacheByPortalGuid[a].time - me.cacheByPortalGuid[b].time;
        });
        var toDelete = (cache.length / 2) | 0;
        cache.splice(0, toDelete + 1).forEach(function(el) {
            delete me.cacheByPortalGuid[el];
        });
    },
    // Cleanup oldest half of the data.
    cleanupMissionCache: function() {
        var me = this;
        var cache = Object.keys(this.cacheByMissionGuid);
        cache.sort(function(a, b) {
            return me.cacheByMissionGuid[a].time - me.cacheByMissionGuid[b].time;
        });
        var toDelete = (cache.length / 2) | 0;
        cache.splice(0, toDelete + 1).forEach(function(el) {
            delete me.cacheByMissionGuid[el];
        });
    },
    drawMission: function(mission) {
        var markers = [];
        var latlngs = [];
        mission.waypoints.forEach(function(waypoint) {
            if (!waypoint.portal) {
                return;
            }
            var radius = window.portals[waypoint.portal.guid] ? window.portals[waypoint.portal.guid].options.radius * 1.75 : 5;
            var ll = [waypoint.portal.latE6 / 1E6, waypoint.portal.lngE6 / 1E6];
            latlngs.push(ll);
            var marker = L.circleMarker(ll, {
                    radius: radius,
                    weight: 3,
                    opacity: 1,
                    color: this.MISSION_COLOR,
                    fill: false,
                    dashArray: null,
                    clickable: false
                }
            );
            this.missionLayer.addLayer(marker);
            markers.push(marker);
        }, this);
        var line = L.geodesicPolyline(latlngs, {
            color: this.MISSION_COLOR,
            opacity: 1,
            weight: 2,
            clickable: false,
            dashArray: (mission.typeNum == 2 /* non-sequential */ ? '1,5' : undefined),
        });
        this.missionLayer.addLayer(line);
        markers.push(line);
        return markers;
    },
    removeMissionLayers: function(markers) {
        markers.forEach(function(marker) {
            this.missionLayer.removeLayer(marker);
        }, this);
    },
    highlightMissionLayers: function(markers) {
        // layer.bringToFront() will break if the layer is not visible
        var bringToFront = map.hasLayer(plugin.missions.missionLayer);
        this.missionLayer.eachLayer(function(layer) {
            var active = (markers.indexOf(layer) !== -1);
            layer.setStyle({
                color: active ? this.MISSION_COLOR_ACTIVE : this.MISSION_COLOR,
            });
            if(active && bringToFront) layer.bringToFront();
        }, this);
    },
    onPortalChanged: function(type, guid, oldval) {
        var portal;
        if (type === 'add' || type === 'update') {
            // Compatibility
            portal = window.portals[guid] || oldval;
            if (!portal.options.data.mission && !portal.options.data.mission50plus) {
                return;
            }
            if (this.markedStarterPortals[guid]) {
                return;
            }
            this.markedStarterPortals[guid] = L.circleMarker(
                L.latLng(portal.options.data.latE6 / 1E6, portal.options.data.lngE6 / 1E6), {
                    radius: portal.options.radius + Math.ceil(portal.options.radius / 2),
                    weight: 3,
                    opacity: 1,
                    color: this.MISSION_COLOR_START,
                    fill: false,
                    dashArray: null,
                    clickable: false
                }
            );
            this.missionStartLayer.addLayer(this.markedStarterPortals[guid]);
        } else if (type === 'delete') {
            portal = oldval;
            if (!this.markedStarterPortals[guid]) {
                return;
            }
            this.missionStartLayer.removeLayer(this.markedStarterPortals[guid]);
            delete this.markedStarterPortals[guid];
        }
    },
    // sync the queue, but delay the actual sync to group a few updates in a single request
    syncQueue: function() {
        if(!this.enableSync) return;
        clearTimeout(this.syncTimer);
        this.syncTimer = setTimeout(function() {
            this.syncTimer = null;
            $.extend(this.checkedMissionsUpdatingQueue, this.checkedMissionsUpdateQueue);
            this.checkedMissionsUpdateQueue = {};
            this.storeLocal('checkedMissionsUpdatingQueue');
            this.storeLocal('checkedMissionsUpdateQueue');
            plugin.sync.updateMap('missions', 'checkedMissions', Object.keys(this.checkedMissionsUpdatingQueue));
            $.extend(this.checkedWaypointsUpdatingQueue, this.checkedWaypointsUpdateQueue);
            this.checkedWaypointsUpdateQueue = {};
            this.storeLocal('checkedWaypointsUpdatingQueue');
            this.storeLocal('checkedWaypointsUpdateQueue');
            plugin.sync.updateMap('missions', 'checkedWaypoints', Object.keys(this.checkedWaypointsUpdatingQueue));
        }.bind(this), this.SYNC_DELAY);
    },
    // called after IITC and all plugin loaded
    onIITCLoaded: function() {
        var match = location.pathname.match(/\/mission\/([0-9a-z.]+)/);
        if(match && match[1]) {
            var mid = match[1];
            this.loadMission(mid, function(mission) {
                this.openMission(mid);
                this.zoomToMission(mission);
            }.bind(this));
        }
        if(window.plugin.sync) {
            window.plugin.sync.registerMapForSync('missions', 'checkedMissions', this.syncCallback.bind(this), this.syncInitialed.bind(this));
            window.plugin.sync.registerMapForSync('missions', 'checkedWaypoints', this.syncCallback.bind(this), this.syncInitialed.bind(this));
        }
    },
    // called after local or remote change uploaded
    syncCallback: function(pluginName, fieldName, e, fullUpdated) {
        this.storeLocal(fieldName);
        // All data is replaced if another client updates the data while this client was offline,
        // fire a complete refresh
        if(fullUpdated) {
            if(fieldName === 'checkedMissions') {
                window.runHooks('plugin-missions-missions-refreshed');
            } else if(fieldName === 'checkedWaypoints') {
                window.runHooks('plugin-missions-waypoints-refreshed');
            }
            return;
        }
        if(!e) return;
        if(e.isLocal) {
            // Update pushed successfully, remove it from updatingQueue
            delete this[fieldName + 'UpdatingQueue'][e.property];
        } else {
            // Remote update
            delete this[fieldName + 'UpdateQueue'][e.property]
            this.storeLocal(fieldName + 'UpdateQueue');
            if(fieldName === 'checkedMissions') {
                window.runHooks('plugin-missions-mission-changed', { mid: e.property, local: false, });
            } else if(fieldName === 'checkedWaypoints') {
                window.runHooks('plugin-missions-waypoint-changed', { mwpid: e.property, local: false, });
            }
        }
    },
    // syncing of the field is initialed, upload all queued update
    syncInitialed: function(pluginName, fieldName) {
        this.enableSync = true;
        if(Object.keys(this[fieldName + 'UpdateQueue']).length >
 0) {
            this.syncQueue();
        }
    },
    onPaneChanged: function(pane) {
        if(pane == 'plugin-missions') {
            document.body.appendChild(this.mobilePane);
        } else if(this.mobilePane.parentNode) {
            this.mobilePane.parentNode.removeChild(this.mobilePane);
        }
    },
    onSearch: function(query) {
        var self = this;
        var bounds = window.map.getBounds();
        if(query.confirmed) {
            this.loadMissionsInBounds(bounds, function(missions) {
                self.addMissionsToQuery(query, missions);
            });
        }
        var cachedMissions = Object.keys(this.cacheByMissionGuid).map(function(guid) {
            return self.cacheByMissionGuid[guid].data;
        });
        var cachedMissionsInView = cachedMissions.filter(function(mission) {
            return mission.waypoints && mission.waypoints.some(function(waypoint) {
                if(!waypoint) return false;
                if(!waypoint.portal) return false;
                return bounds.contains([waypoint.portal.latE6/1E6, waypoint.portal.lngE6/1E6]);
            });
        });
        self.addMissionsToQuery(query, cachedMissionsInView);
    },
    addMissionsToQuery: function(query, missions) {
        var term = query.term.toLowerCase();
        missions.forEach(function(mission) {
            if(mission.title.toLowerCase().indexOf(term) === -1
            && ((!mission.description) || mission.description.toLowerCase().indexOf(term) === -1)) {
                return;
            }
            if(query.results.some(function(result) { return result.mission && (result.mission.guid == mission.guid); }))
                // mission already in list (a cached mission may be found again via missions in bounds)
                return;
            var result = {
                title: escapeHtmlSpecialChars(mission.title),
                description: mission.description
                    ? 'Recently viewed mission:
<small class="plugin-mission-search-result-desc">
' + escapeHtmlSpecialChars(mission.description) + '
</small>
'
                    : 'Mission in view',
                icon: 'https://commondatastorage.googleapis.com/ingress.com/img/tm_icons/tm_cyan.png',
                onSelected: this.onSearchResultSelected.bind(this),
                mission: mission,
                layer: null, // prevent a preview, we'll handle this
            };
            // mission may be a cached mission or contain the full details
            if(mission.waypoints) {
                result.bounds = this.getMissionBounds(mission);
            }
            if(mission.typeNum) {
                result.icon = this.missionTypeImages[mission.typeNum] || this.missionTypeImages[0];
            }
            query.addResult(result);
        }.bind(this));
    },
    onSearchResultSelected: function(result, event) {
        if(result.bounds) {
            map.fitBounds(result.bounds, {maxZoom: 17});
        }
        this.openMission(result.mission.guid);
        return false;
    },
    setup: function() {
        this.cacheByPortalGuid = {};
        this.cacheByMissionGuid = {};
        this.markedStarterPortals = {};
        this.markedMissionPortals = {};
        this.loadData();
        $('
<style>
').prop('type', 'text/css').html('.plugin-mission-pane {\n    background: transparent;\n  border: 0 none !important;\n    height: 100% !important;\n  width: 100% !important;\n   left: 0 !important;\n   top: 0 !important;\n    position: absolute;\n   overflow: auto;\n}\n.plugin-mission-pane >
 button {\n   padding: 0.3em 2em;\n}\n\n.plugin-mission-summary {\n   padding: 5px;\n border-top: black solid 1px;\n  min-height: 50px;\n position: relative;\n   clear: left;\n}\n.plugin-mission-summary.checked::after {\n content: "✓";\n display: block;\n   pointer-events: none;\n position: absolute;\n   text-align: center;\n   color: rgba(255, 187, 0, 0.3);\n    left: 5px;\n    top: 5px;\n font-size: 50px;\n  line-height: 50px;\n    width: 50px;\n}\n.plugin-mission-summary:first-child {\n    border-top-width: 0px;\n}\n\n.plugin-mission-summary.checked {\n    background-color: rgba(255, 187, 0, 0.3);\n}\n\n.plugin-mission-summary >
 img {\n   float: left;\n  cursor: pointer;\n  width: 50px;\n  margin-right: 10px;\n   margin-bottom: 5px;\n}\n\n.plugin-mission-summary >
 a {\n   display: block;\n   font-weight: bold;\n    font-size: 1.3em;\n margin: 0 0 2px 60px;\n}\n\n.plugin-mission-summary >
 br {\n    margin-bottom: 2px;\n}\n\n.plugin-mission-summary >
 .nickname {\n   display: inline-block;\n    box-sizing: border-box;\n   min-width: 8em; /* to align with time */\n  padding-right: 0.2em;\n}\n\n.plugin-mission-info .portal-distance-bearing {\n   font-size: 14px;\n  margin-right: 8px;\n    color: #b2fbff;\n}\n\n.plugin-mission-info {\n  display: inline-block;\n}\n.plugin-mission-info.length   { min-width: 6em; }\n.plugin-mission-info.distance { min-width: 6em; }\n.plugin-mission-info.time     { min-width: 8em; }\n.plugin-mission-info.rating   { min-width: 6em; }\n.plugin-mission-info.players  { min-width: 4em; }\n.plugin-mission-info.type     { min-width: 4em; }\n\n.plugin-mission-info img {\n height: 14px;\n margin-right: 8px;\n    vertical-align: top;\n}\n.plugin-mission-info.players img {\n   padding: 0 3px; /* the icon is 12x18 */\n}\n\n.plugin-mission-details .plugin-mission-summary >
 a,\n.plugin-mission-details .plugin-mission-summary .description {\n    white-space: pre-line;\n    margin-left: 110px;\n}\n\n.plugin-mission-details .plugin-mission-summary.checked::after {\n    left: 0px;\n    top: 0px;\n font-size: 100px;\n line-height: 100px;\n   width: 100px;\n}\n\n.plugin-mission-details .plugin-mission-summary {\n padding: 0;\n   background-color: transparent;\n}\n\n.plugin-mission-details .plugin-mission-summary >
 img {\n  width: 100px;\n}\n\n.plugin-mission-details ol {\n  clear: left;\n  list-style: none;\n margin: 10px 0 0;\n padding: 0;\n}\n\n.plugin-mission-portal-indicator {\n  position: relative;\n   text-align: center;\n   float: left;\n  line-height: 18px;\n    height: 18px;\n width: 18px;\n  margin-right: 5px;\n}\n\n.plugin-mission-portal-indicator div {\n   border-color: currentcolor transparent transparent;\n   border-style: solid;\n  border-width: 2px 1px;\n    box-sizing: border-box;\n   height: 0;\n    left: 6px;\n    position: absolute;\n   top: 0;\n   /* Firefox supports transform* without vendor prefix, but Android does not yet */\n transform-origin: 4px 9px 0;\n  -webkit-transform-origin: 4px 9px 0;\n  width: 8px;\n}\n\n.plugin-mission-waypoint.unavailable {\n  text-decoration: line-through;\n}\n.plugin-mission-waypoint .title {\n  font-size: 18px;\n  font-weight: bold;\n}\n.plugin-mission-waypoint label {\n   clear: left;\n  display: block;\n}\n.plugin-mission-waypoint input {\n  box-sizing: border-box;\n   margin: 3px 5px 8px 0;\n    width: 18px;\n}\n\n.plugin-mission-search-result-desc {\n   display: block;\n   max-height: 2em;\n  overflow: hidden;\n text-overflow: ellipsis;\n  white-space: nowrap;\n}\n\n').appendTo('head');
        $('#toolbox').append('
<a tabindex="0" onclick="plugin.missions.openTopMissions();">
Missions in view
</a>
');
        if(window.useAndroidPanes()) {
            this.mobilePane = document.createElement('div');
            this.mobilePane.className = 'plugin-mission-pane';
            var button = this.mobilePane.appendChild(document.createElement('button'));
            button.textContent = 'Missions in view';
            button.addEventListener('click', function(){ this.openTopMissions(); }.bind(this), false);
            this.tabs = this.mobilePane.appendChild(document.createElement('div'));
            this.tabBar = this.tabs.appendChild(document.createElement('ul'));
            this.tabHeaders = {};
            this.tabMarkers = {};
            $(this.tabs)
                .tabs({
                    activate: function(event, ui) {
                        if(!ui.newTab) return;
                        var header = $(ui.newTab)[0];
                        var id = header.dataset['mission_id'];
                        this.highlightMissionLayers(this.tabMarkers[id]);
                    }.bind(this),
                })
                .find('.ui-tabs-nav').sortable({
                    axis: 'x',
                    stop: function() {
                        $(this.tabs).tabs('refresh');
                    },
                });
            android.addPane('plugin-missions', 'Missions', 'ic_missions');
            addHook('paneChanged', this.onPaneChanged.bind(this));
        }
        // window.addPortalHighlighter('Mission start point', this.highlight.bind(this));
        window.addHook('portalSelected', this.onPortalSelected.bind(this));
        window.addHook('search', this.onSearch.bind(this));
        /*
          I know iitc has portalAdded event but it is missing portalDeleted. So we have to resort to Object.observe
        */
        var me = this;
        if (Object.observe) { // Chrome
            Object.observe(window.portals, function(changes) {
                changes.forEach(function(change) {
                    me.onPortalChanged(change.type, change.name, change.oldValue);
                });
            });
        } else { // Firefox why no Object.observer ? :
<
            window.addHook('portalAdded', function(data) {
                me.onPortalChanged('add', data.portal.options.guid, data.portal);
            });
            // TODO: bug iitc dev for portalRemoved event
            var oldDeletePortal = window.Render.prototype.deletePortalEntity;
            window.Render.prototype.deletePortalEntity = function(guid) {
                if (guid in window.portals) {
                    me.onPortalChanged('delete', guid, window.portals[guid]);
                }
                oldDeletePortal.apply(this, arguments);
            };
        }
        this.missionStartLayer = new L.LayerGroup();
        this.missionLayer = new L.LayerGroup();
        window.addLayerGroup('Mission start portals', this.missionStartLayer, false);
        window.addLayerGroup('Mission portals', this.missionLayer, true);
        window.pluginCreateHook('plugin-missions-loaded-mission');
        window.pluginCreateHook('plugin-missions-on-portal-loaded');
        window.pluginCreateHook('plugin-missions-mission-changed');
        window.pluginCreateHook('plugin-missions-missions-refreshed');
        window.pluginCreateHook('plugin-missions-waypoint-changed');
        window.pluginCreateHook('plugin-missions-waypoints-refreshed');
        window.addHook('plugin-missions-mission-changed',     this.onMissionChanged.bind(this));
        window.addHook('plugin-missions-missions-refreshed',  this.onMissionsRefreshed.bind(this));
        window.addHook('plugin-missions-waypoint-changed',    this.onWaypointChanged.bind(this));
        window.addHook('plugin-missions-waypoints-refreshed', this.onWaypointsRefreshed.bind(this));
        window.addHook('iitcLoaded', this.onIITCLoaded.bind(this));
    }
};
var setup = window.plugin.missions.setup.bind(window.plugin.missions);
// PLUGIN END //////////////////////////////////////////////////////////
setup.info = plugin_info; //add the script info data to the function as a property
if(!window.bootPlugins) window.bootPlugins = [];
window.bootPlugins.push(setup);
// if IITC has already booted, immediately run the 'setup' function
if(window.iitcLoaded && typeof setup === 'function') setup();
})({"script":{"version":"0.1.2.20150917.154202","name":"IITC plugin: Missions","description":"[jonatkins-2015-09-17-154202] View missions. Marking progress on waypoints/missions basis. Showing mission paths on the map."}});
</script>
<script>
(function wrapper(plugin_info) {
// ensure plugin framework is there, even if iitc is not yet loaded
if(typeof window.plugin !== 'function') window.plugin = function() {};
//PLUGIN AUTHORS: writing a plugin outside of the IITC build environment? if so, delete these lines!!
//(leaving them in place might break the 'About IITC' page or break update checks)
plugin_info.buildName = 'jonatkins';
plugin_info.dateTimeVersion = '20150917.154202';
plugin_info.pluginId = 'basemap-opencyclemap';
//END PLUGIN AUTHORS NOTE
// PLUGIN START ////////////////////////////////////////////////////////
// use own namespace for plugin
window.plugin.mapTileOpenCycleMap = function() {};
window.plugin.mapTileOpenCycleMap.addLayer = function() {
  //the Thunderforest (OpenCycleMap) tiles are free to use - http://www.thunderforest.com/terms/
  osmAttribution = 'Map data © OpenStreetMap';
  var ocmOpt = {attribution: 'Tiles © OpenCycleMap, '+osmAttribution, maxNativeZoom: 18, maxZoom: 21};
  var ocmCycle = new L.TileLayer('http://{s}.tile.opencyclemap.org/cycle/{z}/{x}/{y}.png', ocmOpt);
  var ocmTransport = new L.TileLayer('http://{s}.tile2.opencyclemap.org/transport/{z}/{x}/{y}.png', ocmOpt);
  var ocmLandscape = new L.TileLayer('http://{s}.tile3.opencyclemap.org/landscape/{z}/{x}/{y}.png', ocmOpt);
  layerChooser.addBaseLayer(ocmCycle, "Thunderforest OpenCycleMap");
  layerChooser.addBaseLayer(ocmTransport, "Thunderforest Transport");
  layerChooser.addBaseLayer(ocmLandscape, "Thunderforest Landscape");
};
var setup =  window.plugin.mapTileOpenCycleMap.addLayer;
// PLUGIN END //////////////////////////////////////////////////////////
setup.info = plugin_info; //add the script info data to the function as a property
if(!window.bootPlugins) window.bootPlugins = [];
window.bootPlugins.push(setup);
// if IITC has already booted, immediately run the 'setup' function
if(window.iitcLoaded && typeof setup === 'function') setup();
})({"script":{"version":"0.1.1.20150917.154202","name":"IITC plugin: OpenCycleMap.org map tiles","description":"[jonatkins-2015-09-17-154202] Add the OpenCycleMap.org map tiles as an optional layer."}});
</script>
<script>
(function wrapper(plugin_info) {
// ensure plugin framework is there, even if iitc is not yet loaded
if(typeof window.plugin !== 'function') window.plugin = function() {};
//PLUGIN AUTHORS: writing a plugin outside of the IITC build environment? if so, delete these lines!!
//(leaving them in place might break the 'About IITC' page or break update checks)
plugin_info.buildName = 'jonatkins';
plugin_info.dateTimeVersion = '20150917.154202';
plugin_info.pluginId = 'portal-names';
//END PLUGIN AUTHORS NOTE
// PLUGIN START ////////////////////////////////////////////////////////
// use own namespace for plugin
window.plugin.portalNames = function() {};
window.plugin.portalNames.NAME_WIDTH = 80;
window.plugin.portalNames.NAME_HEIGHT = 23;
window.plugin.portalNames.labelLayers = {};
window.plugin.portalNames.labelLayerGroup = null;
window.plugin.portalNames.setupCSS = function() {
  $("
<style>
").prop("type", "text/css").html(''
  +'.plugin-portal-names{'
    +'color:#FFFFBB;'
    +'font-size:11px;line-height:12px;'
    +'text-align:center;padding: 2px;'  // padding needed so shadow doesn't clip
    +'overflow:hidden;'
// could try this if one-line names are used
//    +'white-space: nowrap;text-overflow:ellipsis;'
    +'text-shadow:1px 1px #000,1px -1px #000,-1px 1px #000,-1px -1px #000, 0 0 5px #000;'
    +'pointer-events:none;'
  +'}'
  ).appendTo("head");
}
window.plugin.portalNames.removeLabel = function(guid) {
  var previousLayer = window.plugin.portalNames.labelLayers[guid];
  if(previousLayer) {
    window.plugin.portalNames.labelLayerGroup.removeLayer(previousLayer);
    delete plugin.portalNames.labelLayers[guid];
  }
}
window.plugin.portalNames.addLabel = function(guid, latLng) {
  var previousLayer = window.plugin.portalNames.labelLayers[guid];
  if (!previousLayer) {
    var d = window.portals[guid].options.data;
    var portalName = d.title;
    var label = L.marker(latLng, {
      icon: L.divIcon({
        className: 'plugin-portal-names',
        iconAnchor: [window.plugin.portalNames.NAME_WIDTH/2,0],
        iconSize: [window.plugin.portalNames.NAME_WIDTH,window.plugin.portalNames.NAME_HEIGHT],
        html: portalName
      }),
      guid: guid,
    });
    window.plugin.portalNames.labelLayers[guid] = label;
    label.addTo(window.plugin.portalNames.labelLayerGroup);
  }
}
window.plugin.portalNames.clearAllPortalLabels = function() {
  for (var guid in window.plugin.portalNames.labelLayers) {
    window.plugin.portalNames.removeLabel(guid);
  }
}
window.plugin.portalNames.updatePortalLabels = function() {
  // as this is called every time layers are toggled, there's no point in doing it when the leyer is off
  if (!map.hasLayer(window.plugin.portalNames.labelLayerGroup)) {
    return;
  }
  var portalPoints = {};
  for (var guid in window.portals) {
    var p = window.portals[guid];
    if (p._map && p.options.data.title) {  // only consider portals added to the map and with a title
      var point = map.project(p.getLatLng());
      portalPoints[guid] = point;
    }
  }
  // for efficient testing of intersection, group portals into buckets based on the label size
  var buckets = {};
  for (var guid in portalPoints) {
    var point = portalPoints[guid];
    var bucketId = L.point([Math.floor(point.x/(window.plugin.portalNames.NAME_WIDTH*2)),Math.floor(point.y/window.plugin.portalNames.NAME_HEIGHT)]);
    // the guid is added to four buckets. this way, when testing for overlap we don't need to test
    // all 8 buckets surrounding the one around the particular portal, only the bucket it is in itself
    var bucketIds = [bucketId, bucketId.add([1,0]), bucketId.add([0,1]), bucketId.add([1,1])];
    for (var i in bucketIds) {
      var b = bucketIds[i].toString();
      if (!buckets[b]) buckets[b] = {};
      buckets[b][guid] = true;
    }
  }
  var coveredPortals = {};
  for (var bucket in buckets) {
    var bucketGuids = buckets[bucket];
    for (var guid in bucketGuids) {
      var point = portalPoints[guid];
      // the bounds used for testing are twice as wide as the portal name marker. this is so that there's no left/right
      // overlap between two different portals text
      var largeBounds = L.bounds (
                point.subtract([window.plugin.portalNames.NAME_WIDTH,0]),
                point.add([window.plugin.portalNames.NAME_WIDTH,window.plugin.portalNames.NAME_HEIGHT])
      );
      for (var otherGuid in bucketGuids) {
        if (guid != otherGuid) {
          var otherPoint = portalPoints[otherGuid];
          if (largeBounds.contains(otherPoint)) {
            // another portal is within the rectangle for this one's name - so no name for this one
            coveredPortals[guid] = true;
            break;
          }
        }
      }
    }
  }
  for (var guid in coveredPortals) {
    delete portalPoints[guid];
  }
  // remove any not wanted
  for (var guid in window.plugin.portalNames.labelLayers) {
    if (!(guid in portalPoints)) {
      window.plugin.portalNames.removeLabel(guid);
    }
  }
  // and add those we do
  for (var guid in portalPoints) {
    window.plugin.portalNames.addLabel(guid, portals[guid].getLatLng());
  }
}
// ass calculating portal marker visibility can take some time when there's lots of portals shown, we'll do it on
// a short timer. this way it doesn't get repeated so much
window.plugin.portalNames.delayedUpdatePortalLabels = function(wait) {
  if (window.plugin.portalNames.timer === undefined) {
    window.plugin.portalNames.timer = setTimeout ( function() {
      window.plugin.portalNames.timer = undefined;
      window.plugin.portalNames.updatePortalLabels();
    }, wait*1000);
  }
}
var setup = function() {
  window.plugin.portalNames.setupCSS();
  window.plugin.portalNames.labelLayerGroup = new L.LayerGroup();
  window.addLayerGroup('Portal Names', window.plugin.portalNames.labelLayerGroup, true);
  window.addHook('requestFinished', function() { setTimeout(function(){window.plugin.portalNames.delayedUpdatePortalLabels(3.0);},1); });
  window.addHook('mapDataRefreshEnd', function() { window.plugin.portalNames.delayedUpdatePortalLabels(0.5); });
  window.map.on('overlayadd overlayremove', function() { setTimeout(function(){window.plugin.portalNames.delayedUpdatePortalLabels(1.0);},1); });
  window.map.on('zoomend', window.plugin.portalNames.clearAllPortalLabels );
}
// PLUGIN END //////////////////////////////////////////////////////////
setup.info = plugin_info; //add the script info data to the function as a property
if(!window.bootPlugins) window.bootPlugins = [];
window.bootPlugins.push(setup);
// if IITC has already booted, immediately run the 'setup' function
if(window.iitcLoaded && typeof setup === 'function') setup();
})({"script":{"version":"0.1.6.20150917.154202","name":"IITC plugin: Portal Names","description":"[jonatkins-2015-09-17-154202] Show portal names on the map."}});
</script>
<script>
(function wrapper(plugin_info) {
// ensure plugin framework is there, even if iitc is not yet loaded
if(typeof window.plugin !== 'function') window.plugin = function() {};
//PLUGIN AUTHORS: writing a plugin outside of the IITC build environment? if so, delete these lines!!
//(leaving them in place might break the 'About IITC' page or break update checks)
plugin_info.buildName = 'jonatkins';
plugin_info.dateTimeVersion = '20150917.154202';
plugin_info.pluginId = 'portal-highlighter-missing-resonators';
//END PLUGIN AUTHORS NOTE
// PLUGIN START ////////////////////////////////////////////////////////
// use own namespace for plugin
window.plugin.portalsMissingResonators = function() {};
window.plugin.portalsMissingResonators.highlight = function(data) {
  if(data.portal.options.team != TEAM_NONE) {
    var res_count = data.portal.options.data.resCount;
    if(res_count !== undefined && res_count
< 8) {
      var fill_opacity = ((8-res_count)/8)*.85 + .15;
      var color = 'red';
      var params = {fillColor: color, fillOpacity: fill_opacity};
      // Hole per missing resonator
      var dash = new Array((8 - res_count) + 1).join("1,4,") + "100,0"
      params.dashArray = dash;
      data.portal.setStyle(params);
    }
  }
}
var setup =  function() {
  window.addPortalHighlighter('Portals Missing Resonators', window.plugin.portalsMissingResonators.highlight);
}
// PLUGIN END //////////////////////////////////////////////////////////
setup.info = plugin_info; //add the script info data to the function as a property
if(!window.bootPlugins) window.bootPlugins = [];
window.bootPlugins.push(setup);
// if IITC has already booted, immediately run the 'setup' function
if(window.iitcLoaded && typeof setup === 'function') setup();
})({"script":{"version":"0.1.2.20150917.154202","name":"IITC plugin: highlight portals missing resonators","description":"[jonatkins-2015-09-17-154202] Use the portal fill color to denote if the portal is missing resonators."}});
</script>
<script>
(function wrapper(plugin_info) {
// ensure plugin framework is there, even if iitc is not yet loaded
if(typeof window.plugin !== 'function') window.plugin = function() {};
//PLUGIN AUTHORS: writing a plugin outside of the IITC build environment? if so, delete these lines!!
//(leaving them in place might break the 'About IITC' page or break update checks)
plugin_info.buildName = 'jonatkins';
plugin_info.dateTimeVersion = '20150917.154202';
plugin_info.pluginId = 'sync';
//END PLUGIN AUTHORS NOTE
// PLUGIN START ////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////
// Notice for developers:
//
// You should treat the data stored on Google Realtime API as volatile.
// Because if there are change in Google API client ID, Google will
// treat it as another application and could not access the data created
// by old client ID. Store any important data locally and only use this
// plugin as syncing function.
//
// Google Realtime API reference
// https://developers.google.com/drive/realtime/application
////////////////////////////////////////////////////////////////////////
// use own namespace for plugin
window.plugin.sync = function() {};
window.plugin.sync.KEY_UUID = {key: 'plugin-sync-data-uuid', field: 'uuid'};
// Each client has an unique UUID, to identify remote data is updated by other clients or not
window.plugin.sync.uuid = null;
window.plugin.sync.dialogHTML = null;
window.plugin.sync.authorizer = null;
// Store registered CollaborativeMap
window.plugin.sync.registeredPluginsFields = null;
window.plugin.sync.logger = null;
// Other plugin call this function to push update to Google Realtime API
// example:
// plugin.sync.updateMap('keys', 'keysdata', ['guid1', 'guid2', 'guid3'])
// Which will push plugin.keys.keysdata['guid1'] etc. to Google Realtime API
window.plugin.sync.updateMap = function(pluginName, fieldName, keyArray) {
  var registeredMap = plugin.sync.registeredPluginsFields.get(pluginName, fieldName);
  if(!registeredMap) return false;
  registeredMap.updateMap(keyArray);
}
// Other plugin call this to register a field as CollaborativeMap to sync with Google Realtime API
// example: plugin.sync.registerMapForSync('keys', 'keysdata', plugin.keys.updateCallback, plugin.keys.initializedCallback)
// which register plugin.keys.keysdata
//
// updateCallback function format: function(pluginName, fieldName, eventObject, fullUpdated)
// updateCallback will be fired when local or remote pushed update to Google Realtime API
// fullUpdated is true when remote update occur during local client offline, all data is replaced by remote data
// eventObject is a ValueChangedEvent, is null if fullUpdated is true
//
// detail of ValueChangedEvent refer to following url
// https://developers.google.com/drive/realtime/reference/gapi.drive.realtime.ValueChangedEvent
//
// initializedCallback function format: function(pluginName, fieldName)
// initializedCallback will be fired when the CollaborativeMap finished initialize and good to use
window.plugin.sync.registerMapForSync = function(pluginName, fieldName, callback, initializedCallback) {
  var options, registeredMap;
  options = {'pluginName': pluginName,
               'fieldName': fieldName,
               'callback': callback,
               'initializedCallback': initializedCallback,
               'authorizer': plugin.sync.authorizer,
               'uuid': plugin.sync.uuid};
  registeredMap = new plugin.sync.RegisteredMap(options);
  plugin.sync.registeredPluginsFields.add(registeredMap);
}
//// RegisteredMap
// Create a file named pluginName[fieldName] in folder specified by authorizer
// The file use as realtime document with CollaborativeMap to store the data and a
// CollaborativeString to store uuid of last update client
// callback will called when any local/remote update happen
// initializedCallback will called when RegisteredMap initialized and good to use.
window.plugin.sync.RegisteredMap = function(options) {
  this.pluginName = options['pluginName'];
  this.fieldName = options['fieldName'];
  this.callback = options['callback'];
  this.initializedCallback = options['initializedCallback'];
  this.authorizer = options['authorizer'];
  this.uuid = options['uuid'];
  this.fileId = null;
  this.doc = null;
  this.model = null;
  this.map = null;
  this.lastUpdateUUID = null;
  this.fileSearcher = null;
  this.forceFileSearch = false;
  this.initializing = false;
  this.initialized = false;
  this.failed = false;
  this.updateListener = this.updateListener.bind(this);
  this.initialize = this.initialize.bind(this);
  this.loadRealtimeDocument = this.loadRealtimeDocument.bind(this);
}
window.plugin.sync.RegisteredMap.prototype.updateMap = function(keyArray) {
  var _this = this;
  // Use compound operation to ensure update pushed as a batch
  this.model.beginCompoundOperation();
  try {
    // Remove before set text to ensure full text change
    if (this.lastUpdateUUID.length >
 0)
      this.lastUpdateUUID.removeRange(0, this.lastUpdateUUID.length);
    this.lastUpdateUUID.setText(this.uuid);
    $.each(keyArray, function(ind, key) {
      var value = window.plugin[_this.pluginName][_this.fieldName][key];
      if(typeof(value) !== 'undefined') {
        _this.map.set(key, value);
      } else {
        _this.map.delete(key);
      }
    });
  } finally {
    // Ensure endCompoundOperation is always called (see bug #896)
    this.model.endCompoundOperation();
  }
}
window.plugin.sync.RegisteredMap.prototype.isUpdatedByOthers = function() {
  var remoteUUID = this.lastUpdateUUID.toString();
  return (remoteUUID !== '') && (remoteUUID !== this.uuid);
}
window.plugin.sync.RegisteredMap.prototype.getFileName = function() {
  return this.pluginName + '[' + this.fieldName + ']'
}
window.plugin.sync.RegisteredMap.prototype.initFile = function(callback) {
  var assignIdCallback, failedCallback, _this;
  _this = this;
  assignIdCallback = function(id) {
    _this.forceFileSearch = false;
    _this.fileId = id;
    if(callback) callback();
  };
  failedCallback = function(resp) {
    _this.initializing = false;
    _this.failed = true;
    plugin.sync.logger.log('Could not create file: ' + _this.getFileName() + '. If this problem persist, delete this file in IITC-SYNC-DATA-V2 and empty trash in your Google drive and try again.');
  }
  this.fileSearcher = new plugin.sync.FileSearcher({'fileName': this.getFileName(),
                                                    'description': 'IITC plugin data for ' + this.getFileName()});
  this.fileSearcher.initialize(this.forceFileSearch, assignIdCallback, failedCallback);
}
window.plugin.sync.RegisteredMap.prototype.updateListener = function(e) {
  if(!e.isLocal) {
    if(!window.plugin[this.pluginName][this.fieldName]) {
      window.plugin[this.pluginName][this.fieldName] = {};
    }
    if(typeof(e.newValue) !== 'undefined' && e.newValue !== null) {
      window.plugin[this.pluginName][this.fieldName][e.property] = e.newValue;
    } else {
      delete window.plugin[this.pluginName][this.fieldName][e.property];
    }
  }
  if(this.callback) this.callback(this.pluginName, this.fieldName, e);
}
window.plugin.sync.RegisteredMap.prototype.initialize = function(callback) {
  this.initFile(this.loadRealtimeDocument);
}
window.plugin.sync.RegisteredMap.prototype.loadRealtimeDocument = function(callback) {
  this.initializing = true;
  var initRealtime, initializeModel, onFileLoaded, handleError, _this;
  _this = this;
  // this function called when the document is created first time
  // and the CollaborativeMap is populated with data in plugin field
  initializeModel = function(model) {
    var empty = true;
    var map = model.createMap();
    var lastUpdateUUID = model.createString();
    // Init the map values if this map is first created
    $.each(window.plugin[_this.pluginName][_this.fieldName], function(key, val) {
      map.set(key, val);
      empty = false;
    });
    // Only set the update client if the map is not empty, avoid clearing data of other clients
    lastUpdateUUID.setText(empty ? '' : _this.uuid);
    model.getRoot().set('map', map);
    model.getRoot().set('last-udpate-uuid', lastUpdateUUID);
    plugin.sync.logger.log('Model initialized: ' + _this.pluginName + '[' + _this.fieldName + ']');
  };
  // this function called when the document is loaded
  // update local data if the document is updated by other
  // and add update listener to CollaborativeMap
  onFileLoaded = function(doc) {
    _this.doc = doc;
    _this.model = doc.getModel();
    _this.map = doc.getModel().getRoot().get('map');
    _this.lastUpdateUUID = doc.getModel().getRoot().get('last-udpate-uuid');
    _this.map.addEventListener(gapi.drive.realtime.EventType.VALUE_CHANGED, _this.updateListener);
    // Replace local value if data is changed by others
    if(_this.isUpdatedByOthers()) {
    plugin.sync.logger.log('Updated by others, replacing content: ' + _this.pluginName + '[' + _this.fieldName + ']');
      window.plugin[_this.pluginName][_this.fieldName] = {};
      $.each(_this.map.keys(), function(ind, key) {
        window.plugin[_this.pluginName][_this.fieldName][key] = _this.map.get(key);
      });
      if(_this.callback) _this.callback(_this.pluginName, _this.fieldName, null, true);
    }
    _this.initialized = true;
    _this.initializing = false;
    plugin.sync.logger.log('Data loaded: ' + _this.pluginName + '[' + _this.fieldName + ']');
    if(callback) callback();
    if(_this.initializedCallback) _this.initializedCallback(_this.pluginName, _this.fieldName);
  };
  // Stop the sync if any error occur and try to re-authorize
  handleError = function(e) {
    plugin.sync.logger.log('Realtime API Error: ' + e.type);
    _this.stopSync();
    if(e.type === gapi.drive.realtime.ErrorType.TOKEN_REFRESH_REQUIRED) {
      _this.authorizer.authorize();
    } else if(e.type === gapi.drive.realtime.ErrorType.NOT_FOUND) {
      _this.forceFileSearch = true;
    } else if(e.type === gapi.drive.realtime.ErrorType.CLIENT_ERROR) {
      // Workaround: if Realtime API open a second document and the file do not exist,
      // it will rasie 'CLIENT_ERROR' instead of 'NOT_FOUND'. So we do a force file search here.
      _this.forceFileSearch = true;
    } else {
      alert('Plugin Sync error: ' + e.type + ', ' + e.message);
    }
  };
  gapi.drive.realtime.load(_this.fileId, onFileLoaded, initializeModel, handleError);
}
window.plugin.sync.RegisteredMap.prototype.stopSync = function() {
  if(this.map) this.map.removeEventListener(gapi.drive.realtime.EventType.VALUE_CHANGED, this.updateListener);
  this.fileId = null;
  this.doc = null;
  this.model = null;
  this.map = null;
  this.lastUpdateUUID = null;
  this.initializing = false;
  this.initialized = false;
  plugin.sync.registeredPluginsFields.addToWaitingInitialize(this.pluginName, this.fieldName);
}
//// end RegisteredMap
//// RegisteredPluginsFields
// Store RegisteredMap and handle initialization of RegisteredMap
window.plugin.sync.RegisteredPluginsFields = function(options) {
  this.authorizer = options['authorizer'];
  this.pluginsfields = {};
  this.waitingInitialize = {};
  this.anyFail = false;
  this.initializeRegistered = this.initializeRegistered.bind(this);
  this.cleanWaitingInitialize = this.cleanWaitingInitialize.bind(this);
  this.initializeWorker = this.initializeWorker.bind(this);
  this.authorizer.addAuthCallback(this.initializeRegistered);
}
window.plugin.sync.RegisteredPluginsFields.prototype.add = function(registeredMap) {
  var pluginName, fieldName;
  pluginName = registeredMap.pluginName;
  fieldName = registeredMap.fieldName;
  this.pluginsfields[pluginName] = this.pluginsfields[pluginName] || {};
  if(this.pluginsfields[pluginName][fieldName]) return false;
  this.pluginsfields[pluginName][fieldName] = registeredMap;
  this.waitingInitialize[registeredMap.getFileName()] = registeredMap;
  this.initializeWorker();
}
window.plugin.sync.RegisteredPluginsFields.prototype.addToWaitingInitialize = function(pluginName, fieldName) {
  var registeredMap, _this;
  _this = this;
  registeredMap = this.get(pluginName, fieldName);
  if(!registeredMap) return;
  this.waitingInitialize[registeredMap.getFileName()] = registeredMap;
  clearTimeout(this.timer);
  this.timer = setTimeout(function() {_this.initializeWorker()}, 10000);
  plugin.sync.logger.log('Retry in 10 sec.: ' +  pluginName + '[' + fieldName + ']');
}
window.plugin.sync.RegisteredPluginsFields.prototype.get = function(pluginName, fieldName) {
  if(!this.pluginsfields[pluginName]) return;
  return this.pluginsfields[pluginName][fieldName];
}
window.plugin.sync.RegisteredPluginsFields.prototype.initializeRegistered = function() {
  var _this = this;
  if(this.authorizer.isAuthed()) {
    $.each(this.waitingInitialize, function(key, map) {
      if(!map.initializing && !map.initialized) {
        map.initialize(_this.cleanWaitingInitialize);
      }
    });
  }
}
window.plugin.sync.RegisteredPluginsFields.prototype.cleanWaitingInitialize = function() {
  var newWaitingInitialize, _this;
  _this = this;
  newWaitingInitialize = {};
  $.each(this.waitingInitialize, function(key,map) {
    if(map.failed) _this.anyFail = true;
    if(map.initialized || map.failed) return true;
    newWaitingInitialize[map.getFileName()] = map;
  });
  this.waitingInitialize = newWaitingInitialize;
}
window.plugin.sync.RegisteredPluginsFields.prototype.initializeWorker = function() {
  var _this = this;
  this.cleanWaitingInitialize();
  plugin.sync.toggleDialogLink();
  this.initializeRegistered();
  clearTimeout(this.timer);
  if(Object.keys(this.waitingInitialize).length >
 0) {
    this.timer = setTimeout(function() {_this.initializeWorker()}, 10000);
  }
}
//// end RegisteredPluginsFields
//// FileSearcher
//
// assignIdCallback function format: function(id)
// allow you to assign the file/folder id elsewhere
//
// failedCallback function format: function()
// call when the file/folder couldn't create
window.plugin.sync.FileSearcher = function(options) {
  // return object created previously
  if(this.instances[options['fileName']]) return this.instances[options['fileName']];
  this.fileName = options['fileName'];
  this.description = options['description'];
  this.isFolder = options['isFolder'];
  this.force = false;
  this.parent = null;
  this.fileId = null;
  this.retryCount = 0;
  this.loadFileId();
  this.instances[this.fileName] = this;
}
window.plugin.sync.FileSearcher.prototype.instances = {};
window.plugin.sync.FileSearcher.prototype.RETRY_LIMIT = 2;
window.plugin.sync.FileSearcher.prototype.MIMETYPE_FILE = 'application/vnd.google-apps.drive-sdk';
window.plugin.sync.FileSearcher.prototype.MIMETYPE_FOLDER = 'application/vnd.google-apps.folder';
window.plugin.sync.FileSearcher.prototype.parentName = 'IITC-SYNC-DATA-V2';
window.plugin.sync.FileSearcher.prototype.parentDescription = 'Store IITC sync data';
window.plugin.sync.FileSearcher.prototype.initialize = function(force, assignIdCallback, failedCallback) {
  this.force = force;
  // throw error if too many retry
  if(this.retryCount >
= this.RETRY_LIMIT) {
    plugin.sync.logger.log('Too many file operation: ' + this.fileName);
    failedCallback();
    return;
  }
  if(this.force) this.retryCount++;
  if(this.isFolder) {
    this.initFile(assignIdCallback, failedCallback);
  } else {
    this.initParent(assignIdCallback, failedCallback);
  }
}
window.plugin.sync.FileSearcher.prototype.initFile = function(assignIdCallback, failedCallback) {
  // If not force search and have cached fileId, return the fileId
  if(!this.force && this.fileId) {
    assignIdCallback(this.fileId);
    return;
  }
  var searchCallback, createCallback, handleFileId, handleFailed, _this;
  _this = this;
  handleFileId = function(id) {
    _this.fileId = id;
    _this.saveFileId();
    assignIdCallback(id);
  };
  handleFailed = function(resp) {
    _this.fileId = null;
    _this.saveFileId();
    plugin.sync.logger.log('File operation failed: ' + (resp.error || 'unknown error'));
    failedCallback(resp);
  }
  createCallback = function(resp) {
    if(resp.id) {
      handleFileId(resp.id); // file created
    } else {
      handleFailed(resp) // could not create file
    }
  };
  searchCallback = function(resp) {
    if(resp.items && resp.items[0]) {
      handleFileId(resp.items[0].id);// file found
    } else if(!resp.error) {
      _this.createFileOrFolder(createCallback); // file not found, create file
    } else {
      handleFailed(resp); // Error
    }
  };
  this.searchFileOrFolder(searchCallback);
}
window.plugin.sync.FileSearcher.prototype.initParent = function(assignIdCallback, failedCallback) {
  var parentAssignIdCallback, parentFailedCallback, _this;
  _this = this;
  parentAssignIdCallback = function(id) {
    _this.initFile(assignIdCallback, failedCallback);
  }
  parentFailedCallback = function(resp) {
    _this.fileId = null;
    _this.saveFileId();
    plugin.sync.logger.log('File operation failed: ' + (resp.error || 'unknown error'));
    failedCallback(resp);
  }
  this.parent = new plugin.sync.FileSearcher({'fileName': this.parentName,
                                  'description': this.parentDescription,
                                  'isFolder': true});
  this.parent.initialize(this.force, parentAssignIdCallback, parentFailedCallback);
}
window.plugin.sync.FileSearcher.prototype.createFileOrFolder = function(callback) {
  var _this = this;
  gapi.client.load('drive', 'v2', function() {
    gapi.client.drive.files.insert(_this.getCreateOption()).execute(callback);
  });
}
window.plugin.sync.FileSearcher.prototype.searchFileOrFolder = function(callback) {
  var _this = this;
  gapi.client.load('drive', 'v2', function() {
    gapi.client.drive.files.list(_this.getSearchOption()).execute(callback);
  });
}
window.plugin.sync.FileSearcher.prototype.getCreateOption = function() {
  var resource = {
    'title': this.fileName,
    'description': this.description,
    'mimeType': (this.isFolder ? this.MIMETYPE_FOLDER : this.MIMETYPE_FILE)
  };
  if(this.parent) $.extend(resource, {'parents': [{'id': this.parent.fileId}]});
  return {'convert': 'false',
          'ocr': 'false',
          'resource': resource};
}
window.plugin.sync.FileSearcher.prototype.getSearchOption = function() {
  var q = 'title = "' + this.fileName +'" and trashed = false';
  if(this.parent) q += ' and "' + this.parent.fileId + '" in parents';
  return {'q': q};
}
window.plugin.sync.FileSearcher.prototype.localStorageKey = function() {
  return 'sync-file-' + this.fileName;
}
window.plugin.sync.FileSearcher.prototype.saveFileId = function() {
  if(this.fileId) {
    localStorage[this.localStorageKey()] = this.fileId;
  } else {
    localStorage.removeItem(this.localStorageKey());
  }
}
window.plugin.sync.FileSearcher.prototype.loadFileId = function() {
  var storedFileId = localStorage[this.localStorageKey()];
  if(storedFileId) this.fileId = storedFileId;
}
//// end FileSearcher
//// Authorizer
// authorize user's google account
window.plugin.sync.Authorizer = function(options) {
  this.authCallback = options['authCallback'];
  this.authorizing = false;
  this.authorized = false;
  this.isAuthed = this.isAuthed.bind(this);
  this.isAuthorizing = this.isAuthorizing.bind(this);
  this.authorize = this.authorize.bind(this);
}
window.plugin.sync.Authorizer.prototype.CLIENT_ID = '893806110732.apps.googleusercontent.com';
window.plugin.sync.Authorizer.prototype.SCOPES = ['https://www.googleapis.com/auth/drive.file', 'https://www.googleapis.com/auth/drive.metadata.readonly'];
window.plugin.sync.Authorizer.prototype.isAuthed = function() {
  return this.authorized;
}
window.plugin.sync.Authorizer.prototype.isAuthorizing = function() {
  return this.authorizing;
}
window.plugin.sync.Authorizer.prototype.addAuthCallback = function(callback) {
  if(typeof(this.authCallback) === 'function') this.authCallback = [this.authCallback];
  this.authCallback.push(callback);
}
window.plugin.sync.Authorizer.prototype.authComplete = function() {
  this.authorizing = false;
  if(this.authCallback) {
    if(typeof(this.authCallback) === 'function') this.authCallback();
    if(this.authCallback instanceof Array && this.authCallback.length >
 0) {
      $.each(this.authCallback, function(ind, func) {
        func();
      });
    }
  }
}
window.plugin.sync.Authorizer.prototype.authorize = function(popup) {
  this.authorizing = true;
  this.authorized = false;
  var handleAuthResult, _this;
  _this = this;
  handleAuthResult = function(authResult) {
    if(authResult && !authResult.error) {
      _this.authorized = true;
      plugin.sync.logger.log('Authorized');
    } else {
      _this.authorized = false;
      var error = (authResult && authResult.error) ? authResult.error : 'not authorized';
      plugin.sync.logger.log('Authorization error: ' + error);
    }
    _this.authComplete();
  };
  gapi.auth.authorize({'client_id': this.CLIENT_ID, 'scope': this.SCOPES, 'immediate': !popup}
    , handleAuthResult);
}
//// end Authorizer
//// Logger
window.plugin.sync.Logger = function(options) {
  this.logLimit = options['logLimit'];
  this.logUpdateCallback = options['logUpdateCallback'];
  this.logs = [];
  this.log = this.log.bind(this);
  this.getLogs = this.getLogs.bind(this);
}
window.plugin.sync.Logger.prototype.log = function(message) {
  var log = {'time': new Date(), 'message': message};
  this.logs.unshift(log);
  if(this.logs.length >
 this.logLimit) {
    this.logs.pop();
  }
  if(this.logUpdateCallback) this.logUpdateCallback(this.getLogs());
}
window.plugin.sync.Logger.prototype.getLogs = function() {
  var allLogs = '';
  $.each(this.logs, function(ind,log) {
    allLogs += log.time.toLocaleTimeString() + ': ' + log.message + '
<br />
';
  });
  return allLogs;
}
//// end Logger
// http://stackoverflow.com/a/8809472/2322660
// http://stackoverflow.com/a/7221797/2322660
// With format fixing: xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx where y in [8,9,a,b]
window.plugin.sync.generateUUID = function() {
  if(window.crypto && window.crypto.getRandomValues) {
    var buf = new Uint16Array(8);
    window.crypto.getRandomValues(buf);
    var S4 = function(num) {
      var ret = num.toString(16);
      return '000'.substring(0, 4-ret.length) + ret;
    };
    var yxxx = function(num) {
      return num&0x3fff|0x8000;
    }
    return (S4(buf[0])+S4(buf[1])+'-'+S4(buf[2])+'-4'+S4(buf[3]).substring(1)+'-'+S4(yxxx(buf[4]))+'-'+S4(buf[5])+S4(buf[6])+S4(buf[7]));
  } else {
    var d = new Date().getTime();
    var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
        var r = (d + Math.random()*16)%16 | 0;
        d = Math.floor(d/16);
        return (c=='x' ? r : (r&0x3|0x8)).toString(16);
    });
    return uuid;
  }
}
window.plugin.sync.storeLocal = function(mapping) {
  if(typeof(plugin.sync[mapping.field]) !== 'undefined' && plugin.sync[mapping.field] !== null) {
    localStorage[mapping.key] = JSON.stringify(plugin.sync[mapping.field]);
  } else {
    localStorage.removeItem(mapping.key);
  }
}
window.plugin.sync.loadLocal = function(mapping) {
  var objectJSON = localStorage[mapping.key];
  if(!objectJSON) return;
  plugin.sync[mapping.field] = mapping.convertFunc
                          ? mapping.convertFunc(JSON.parse(objectJSON))
                          : JSON.parse(objectJSON);
}
window.plugin.sync.loadUUID = function() {
  plugin.sync.loadLocal(plugin.sync.KEY_UUID);
  if(!plugin.sync.uuid) {
    plugin.sync.uuid = plugin.sync.generateUUID();
    plugin.sync.storeLocal(plugin.sync.KEY_UUID);
  }
}
window.plugin.sync.updateLog = function(messages) {
  $('#sync-log').html(messages);
}
window.plugin.sync.toggleAuthButton = function() {
  var authed, authorizing;
  authed = plugin.sync.authorizer.isAuthed();
  authorizing = plugin.sync.authorizer.isAuthorizing();
  $('#sync-authButton').html(authed ? 'Authorized' : 'Authorize');
  $('#sync-authButton').attr('disabled', (authed || authorizing));
  $('#sync-authButton').toggleClass('sync-authButton-dimmed', authed || authorizing);
}
window.plugin.sync.toggleDialogLink = function() {
  var authed, anyFail;
  authed = plugin.sync.authorizer.isAuthed();
  anyFail = plugin.sync.registeredPluginsFields.anyFail;
  $('#sync-show-dialog').toggleClass('sync-show-dialog-error', !authed || anyFail);
}
window.plugin.sync.showDialog = function() {
  window.dialog({html: plugin.sync.dialogHTML, title: 'Sync', modal: true, id: 'sync-setting'});
  plugin.sync.toggleAuthButton();
  plugin.sync.toggleDialogLink();
  plugin.sync.updateLog(plugin.sync.logger.getLogs());
}
window.plugin.sync.setupDialog = function() {
  plugin.sync.dialogHTML = '
<div id="sync-dialog">
'
                         + '
<button id="sync-authButton" class="sync-authButton-dimmed" '
                         + 'onclick="setTimeout(function(){window.plugin.sync.authorizer.authorize(true)}, 1)" '
                         + 'disabled="disabled">
Authorize
</button>
'
                         + '
<div id="sync-log">
</div>
'
                         + '
</div>
';
  $('#toolbox').append('
<a id="sync-show-dialog" onclick="window.plugin.sync.showDialog();">
Sync
</a>
 ');
}
window.plugin.sync.setupCSS = function() {
  $("
<style>
")
    .prop("type", "text/css")
    .html(".sync-authButton-dimmed {\
            opacity: 0.5;\
          }\
          .sync-show-dialog-error {\
            color: #FF2222;\
          }\
          #sync-log {\
            height: 300px;\
            white-space: pre-wrap;\
            white-space: -moz-pre-wrap;\
            white-space: -o-pre-wrap;\
            word-wrap: break-word;\
            overflow-y: auto;\
          }")
  .appendTo("head");
}
var setup =  function() {
  window.plugin.sync.logger = new plugin.sync.Logger({'logLimit':10, 'logUpdateCallback': plugin.sync.updateLog});
  window.plugin.sync.loadUUID();
  window.plugin.sync.setupCSS();
  window.plugin.sync.setupDialog();
  window.plugin.sync.authorizer = new window.plugin.sync.Authorizer({
    'authCallback': [plugin.sync.toggleAuthButton, plugin.sync.toggleDialogLink]
  });
  window.plugin.sync.registeredPluginsFields = new window.plugin.sync.RegisteredPluginsFields({
    'authorizer': window.plugin.sync.authorizer
  });
  var GOOGLEAPI = 'https://apis.google.com/js/api.js';
  load(GOOGLEAPI).thenRun(function() {
    gapi.load('auth:client,drive-realtime,drive-share', window.plugin.sync.authorizer.authorize);
  });
}
// PLUGIN END //////////////////////////////////////////////////////////
setup.info = plugin_info; //add the script info data to the function as a property
if(!window.bootPlugins) window.bootPlugins = [];
window.bootPlugins.push(setup);
// if IITC has already booted, immediately run the 'setup' function
if(window.iitcLoaded && typeof setup === 'function') setup();
})({"script":{"version":"0.2.3.20150917.154202","name":"IITC plugin: Sync","description":"[jonatkins-2015-09-17-154202] Sync data between clients via Google Realtime API. Only syncs data from specific plugins (currently: Keys, Bookmarks). Sign in via the 'Sync' link."}});
</script>
<script>
(function wrapper(plugin_info) {
// ensure plugin framework is there, even if iitc is not yet loaded
if(typeof window.plugin !== 'function') window.plugin = function() {};
//PLUGIN AUTHORS: writing a plugin outside of the IITC build environment? if so, delete these lines!!
//(leaving them in place might break the 'About IITC' page or break update checks)
plugin_info.buildName = 'jonatkins';
plugin_info.dateTimeVersion = '20150917.154202';
plugin_info.pluginId = 'draw-tools';
//END PLUGIN AUTHORS NOTE
// PLUGIN START ////////////////////////////////////////////////////////
// use own namespace for plugin
window.plugin.drawTools = function() {};
window.plugin.drawTools.loadExternals = function() {
  try { console.log('Loading leaflet.draw JS now'); } catch(e) {}
  /*
    Leaflet.draw, a plugin that adds drawing and editing tools to Leaflet powered maps.
    (c) 2012-2013, Jacob Toye, Smartrak
    https://github.com/Leaflet/Leaflet.draw
    http://leafletjs.com
    https://github.com/jacobtoye
*/
(function (window, document, undefined) {
/*
 * Leaflet.draw assumes that you have already included the Leaflet library.
 */
L.drawVersion = '0.2.1-dev';
L.drawLocal = {
    draw: {
        toolbar: {
            actions: {
                title: 'Cancel drawing',
                text: 'Cancel'
            },
            buttons: {
                polyline: 'Draw a polyline',
                polygon: 'Draw a polygon',
                rectangle: 'Draw a rectangle',
                circle: 'Draw a circle',
                marker: 'Draw a marker'
            }
        },
        handlers: {
            circle: {
                tooltip: {
                    start: 'Click and drag to draw circle.'
                }
            },
            marker: {
                tooltip: {
                    start: 'Click map to place marker.'
                }
            },
            polygon: {
                tooltip: {
                    start: 'Click to start drawing shape.',
                    cont: 'Click to continue drawing shape.',
                    end: 'Click first point to close this shape.'
                }
            },
            polyline: {
                error: '
<strong>
Error:
</strong>
 shape edges cannot cross!',
                tooltip: {
                    start: 'Click to start drawing line.',
                    cont: 'Click to continue drawing line.',
                    end: 'Click last point to finish line.'
                }
            },
            rectangle: {
                tooltip: {
                    start: 'Click and drag to draw rectangle.'
                }
            },
            simpleshape: {
                tooltip: {
                    end: 'Release mouse to finish drawing.'
                }
            }
        }
    },
    edit: {
        toolbar: {
            actions: {
                save: {
                    title: 'Save changes.',
                    text: 'Save'
                },
                cancel: {
                    title: 'Cancel editing, discards all changes.',
                    text: 'Cancel'
                }
            },
            buttons: {
                edit: 'Edit layers',
                remove: 'Delete layers'
            }
        },
        handlers: {
            edit: {
                tooltip: {
                    text: 'Drag handles, or marker to edit feature.',
                    subtext: 'Click cancel to undo changes.'
                }
            },
            remove: {
                tooltip: {
                    text: 'Click on a feature to remove'
                }
            }
        }
    }
};
L.Draw = {};
L.Draw.Feature = L.Handler.extend({
    includes: L.Mixin.Events,
    initialize: function (map, options) {
        this._map = map;
        this._container = map._container;
        this._overlayPane = map._panes.overlayPane;
        this._popupPane = map._panes.popupPane;
        // Merge default shapeOptions options with custom shapeOptions
        if (options && options.shapeOptions) {
            options.shapeOptions = L.Util.extend({}, this.options.shapeOptions, options.shapeOptions);
        }
        L.Util.extend(this.options, options);
    },
    enable: function () {
        if (this._enabled) { return; }
        L.Handler.prototype.enable.call(this);
        this.fire('enabled', { handler: this.type });
        this._map.fire('draw:drawstart', { layerType: this.type });
    },
    disable: function () {
        if (!this._enabled) { return; }
        L.Handler.prototype.disable.call(this);
        this.fire('disabled', { handler: this.type });
        this._map.fire('draw:drawstop', { layerType: this.type });
    },
    addHooks: function () {
        if (this._map) {
            L.DomUtil.disableTextSelection();
            this._tooltip = new L.Tooltip(this._map);
            L.DomEvent.addListener(this._container, 'keyup', this._cancelDrawing, this);
        }
    },
    removeHooks: function () {
        if (this._map) {
            L.DomUtil.enableTextSelection();
            this._tooltip.dispose();
            this._tooltip = null;
            L.DomEvent.removeListener(this._container, 'keyup', this._cancelDrawing);
        }
    },
    setOptions: function (options) {
        L.setOptions(this, options);
    },
    _fireCreatedEvent: function (layer) {
        this._map.fire('draw:created', { layer: layer, layerType: this.type });
    },
    // Cancel drawing when the escape key is pressed
    _cancelDrawing: function (e) {
        if (e.keyCode === 27) {
            this.disable();
        }
    }
});
L.Draw.Polyline = L.Draw.Feature.extend({
    statics: {
        TYPE: 'polyline'
    },
    Poly: L.GeodesicPolyline,
    options: {
        allowIntersection: true,
        repeatMode: false,
        drawError: {
            color: '#b00b00',
            timeout: 2500
        },
        icon: new L.DivIcon({
            iconSize: new L.Point(8, 8),
            className: 'leaflet-div-icon leaflet-editing-icon'
        }),
        guidelineDistance: 20,
        shapeOptions: {
            stroke: true,
            color: '#f06eaa',
            weight: 4,
            opacity: 0.5,
            fill: false,
            clickable: true
        },
        metric: true, // Whether to use the metric measurement system or imperial
        zIndexOffset: 2000 // This should be >
 than the highest z-index any map layers
    },
    initialize: function (map, options) {
        // Need to set this here to ensure the correct message is used.
        this.options.drawError.message = L.drawLocal.draw.handlers.polyline.error;
        // Merge default drawError options with custom options
        if (options && options.drawError) {
            options.drawError = L.Util.extend({}, this.options.drawError, options.drawError);
        }
        // Save the type so super can fire, need to do this as cannot do this.TYPE :(
        this.type = L.Draw.Polyline.TYPE;
        L.Draw.Feature.prototype.initialize.call(this, map, options);
    },
    addHooks: function () {
        L.Draw.Feature.prototype.addHooks.call(this);
        if (this._map) {
            this._markers = [];
            this._markerGroup = new L.LayerGroup();
            this._map.addLayer(this._markerGroup);
            this._poly = new L.GeodesicPolyline([], this.options.shapeOptions);
            this._tooltip.updateContent(this._getTooltipText());
            // Make a transparent marker that will used to catch click events. These click
            // events will create the vertices. We need to do this so we can ensure that
            // we can create vertices over other map layers (markers, vector layers). We
            // also do not want to trigger any click handlers of objects we are clicking on
            // while drawing.
            if (!this._mouseMarker) {
                this._mouseMarker = L.marker(this._map.getCenter(), {
                    icon: L.divIcon({
                        className: 'leaflet-mouse-marker',
                        iconAnchor: [20, 20],
                        iconSize: [40, 40]
                    }),
                    opacity: 0,
                    zIndexOffset: this.options.zIndexOffset
                });
            }
            this._mouseMarker
                .on('click', this._onClick, this)
                .addTo(this._map);
            this._map
                .on('mousemove', this._onMouseMove, this)
                .on('zoomend', this._onZoomEnd, this);
        }
    },
    removeHooks: function () {
        L.Draw.Feature.prototype.removeHooks.call(this);
        this._clearHideErrorTimeout();
        this._cleanUpShape();
        // remove markers from map
        this._map.removeLayer(this._markerGroup);
        delete this._markerGroup;
        delete this._markers;
        this._map.removeLayer(this._poly);
        delete this._poly;
        this._mouseMarker.off('click', this._onClick, this);
        this._map.removeLayer(this._mouseMarker);
        delete this._mouseMarker;
        // clean up DOM
        this._clearGuides();
        this._map
            .off('mousemove', this._onMouseMove, this)
            .off('zoomend', this._onZoomEnd, this);
    },
    _finishShape: function () {
        var intersects = this._poly.newLatLngIntersects(this._poly.getLatLngs()[0], true);
        if ((!this.options.allowIntersection && intersects) || !this._shapeIsValid()) {
            this._showErrorTooltip();
            return;
        }
        this._fireCreatedEvent();
        this.disable();
        if (this.options.repeatMode) {
            this.enable();
        }
    },
    //Called to verify the shape is valid when the user tries to finish it
    //Return false if the shape is not valid
    _shapeIsValid: function () {
        return true;
    },
    _onZoomEnd: function () {
        this._updateGuide();
    },
    _onMouseMove: function (e) {
        var newPos = e.layerPoint,
            latlng = e.latlng;
        // Save latlng
        // should this be moved to _updateGuide() ?
        this._currentLatLng = latlng;
        this._updateTooltip(latlng);
        // Update the guide line
        this._updateGuide(newPos);
        // Update the mouse marker position
        this._mouseMarker.setLatLng(latlng);
        L.DomEvent.preventDefault(e.originalEvent);
    },
    _onClick: function (e) {
        var latlng = e.target.getLatLng(),
            markerCount = this._markers.length;
                if (this.options.snapPoint) latlng = this.options.snapPoint(latlng);
        if (markerCount >
 0 && !this.options.allowIntersection && this._poly.newLatLngIntersects(latlng)) {
            this._showErrorTooltip();
            return;
        }
        else if (this._errorShown) {
            this._hideErrorTooltip();
        }
        this._markers.push(this._createMarker(latlng));
        this._poly.addLatLng(latlng);
        if (this._poly.getLatLngs().length === 2) {
            this._map.addLayer(this._poly);
        }
        this._updateFinishHandler();
        this._vertexAdded(latlng);
        this._clearGuides();
        this._updateTooltip();
    },
    _updateFinishHandler: function () {
        var markerCount = this._markers.length;
        // The last marker should have a click handler to close the polyline
        if (markerCount >
 1) {
            this._markers[markerCount - 1].on('click', this._finishShape, this);
        }
        // Remove the old marker click handler (as only the last point should close the polyline)
        if (markerCount >
 2) {
            this._markers[markerCount - 2].off('click', this._finishShape, this);
        }
    },
    _createMarker: function (latlng) {
        var marker = new L.Marker(latlng, {
            icon: this.options.icon,
            zIndexOffset: this.options.zIndexOffset * 2
        });
        this._markerGroup.addLayer(marker);
        return marker;
    },
    _updateGuide: function (newPos) {
        var markerCount = this._markers.length;
        if (markerCount >
 0) {
            newPos = newPos || this._map.latLngToLayerPoint(this._currentLatLng);
            // draw the guide line
            this._clearGuides();
            this._drawGuide(
                this._map.latLngToLayerPoint(this._markers[markerCount - 1].getLatLng()),
                newPos
            );
        }
    },
    _updateTooltip: function (latLng) {
        var text = this._getTooltipText();
        if (latLng) {
            this._tooltip.updatePosition(latLng);
        }
        if (!this._errorShown) {
            this._tooltip.updateContent(text);
        }
    },
    _drawGuide: function (pointA, pointB) {
//TODO: rewrite this to use a regular leaflet line with a dashpattern!
        var length = Math.floor(Math.sqrt(Math.pow((pointB.x - pointA.x), 2) + Math.pow((pointB.y - pointA.y), 2))),
            i,
            fraction,
            dashPoint,
            dash;
        //create the guides container if we haven't yet
        if (!this._guidesContainer) {
            this._guidesContainer = L.DomUtil.create('div', 'leaflet-draw-guides', this._overlayPane);
        }
        //draw a dash every GuildeLineDistance
        for (i = this.options.guidelineDistance; i
< length; i += this.options.guidelineDistance) {
            //work out fraction along line we are
            fraction = i / length;
            //calculate new x,y point
            dashPoint = {
                x: Math.floor((pointA.x * (1 - fraction)) + (fraction * pointB.x)),
                y: Math.floor((pointA.y * (1 - fraction)) + (fraction * pointB.y))
            };
            //add guide dash to guide container
            dash = L.DomUtil.create('div', 'leaflet-draw-guide-dash', this._guidesContainer);
            dash.style.backgroundColor =
                !this._errorShown ? this.options.shapeOptions.color : this.options.drawError.color;
            L.DomUtil.setPosition(dash, dashPoint);
        }
    },
    _updateGuideColor: function (color) {
        if (this._guidesContainer) {
            for (var i = 0, l = this._guidesContainer.childNodes.length; i
< l; i++) {
                this._guidesContainer.childNodes[i].style.backgroundColor = color;
            }
        }
    },
    // removes all child elements (guide dashes) from the guides container
    _clearGuides: function () {
        if (this._guidesContainer) {
            while (this._guidesContainer.firstChild) {
                this._guidesContainer.removeChild(this._guidesContainer.firstChild);
            }
        }
    },
    _getTooltipText: function () {
        var labelText,
            distance,
            distanceStr;
        if (this._markers.length === 0) {
            labelText = {
                text: L.drawLocal.draw.handlers.polyline.tooltip.start
            };
        } else {
            distanceStr = this._getMeasurementString();
            if (this._markers.length === 1) {
                labelText = {
                    text: L.drawLocal.draw.handlers.polyline.tooltip.cont,
                    subtext: distanceStr
                };
            } else {
                labelText = {
                    text: L.drawLocal.draw.handlers.polyline.tooltip.end,
                    subtext: distanceStr
                };
            }
        }
        return labelText;
    },
    _getMeasurementString: function () {
        var currentLatLng = this._currentLatLng,
            previousLatLng = this._markers[this._markers.length - 1].getLatLng(),
            distance;
        // calculate the distance from the last fixed point to the mouse position
        distance = this._measurementRunningTotal + currentLatLng.distanceTo(previousLatLng);
        return L.GeometryUtil.readableDistance(distance, this.options.metric);
    },
    _showErrorTooltip: function () {
        this._errorShown = true;
        // Update tooltip
        this._tooltip
            .showAsError()
            .updateContent({ text: this.options.drawError.message });
        // Update shape
        this._updateGuideColor(this.options.drawError.color);
        this._poly.setStyle({ color: this.options.drawError.color });
        // Hide the error after 2 seconds
        this._clearHideErrorTimeout();
        this._hideErrorTimeout = setTimeout(L.Util.bind(this._hideErrorTooltip, this), this.options.drawError.timeout);
    },
    _hideErrorTooltip: function () {
        this._errorShown = false;
        this._clearHideErrorTimeout();
        // Revert tooltip
        this._tooltip
            .removeError()
            .updateContent(this._getTooltipText());
        // Revert shape
        this._updateGuideColor(this.options.shapeOptions.color);
        this._poly.setStyle({ color: this.options.shapeOptions.color });
    },
    _clearHideErrorTimeout: function () {
        if (this._hideErrorTimeout) {
            clearTimeout(this._hideErrorTimeout);
            this._hideErrorTimeout = null;
        }
    },
    _vertexAdded: function (latlng) {
        if (this._markers.length === 1) {
            this._measurementRunningTotal = 0;
        }
        else {
            this._measurementRunningTotal +=
                latlng.distanceTo(this._markers[this._markers.length - 2].getLatLng());
        }
    },
    _cleanUpShape: function () {
        if (this._markers.length >
 1) {
            this._markers[this._markers.length - 1].off('click', this._finishShape, this);
        }
    },
    _fireCreatedEvent: function () {
        var poly = new this.Poly(this._poly.getLatLngs(), this.options.shapeOptions);
        L.Draw.Feature.prototype._fireCreatedEvent.call(this, poly);
    }
});
L.Draw.Polygon = L.Draw.Polyline.extend({
    statics: {
        TYPE: 'polygon'
    },
    Poly: L.GeodesicPolygon,
    options: {
        showArea: false,
        shapeOptions: {
            stroke: true,
            color: '#f06eaa',
            weight: 4,
            opacity: 0.5,
            fill: true,
            fillColor: null, //same as color by default
            fillOpacity: 0.2,
            clickable: true
        }
    },
    initialize: function (map, options) {
        L.Draw.Polyline.prototype.initialize.call(this, map, options);
        // Save the type so super can fire, need to do this as cannot do this.TYPE :(
        this.type = L.Draw.Polygon.TYPE;
    },
    _updateFinishHandler: function () {
        var markerCount = this._markers.length;
        // The first marker shold have a click handler to close the polygon
        if (markerCount === 1) {
            this._markers[0].on('click', this._finishShape, this);
        }
        // Add and update the double click handler
        if (markerCount >
 2) {
            this._markers[markerCount - 1].on('dblclick', this._finishShape, this);
            // Only need to remove handler if has been added before
            if (markerCount >
 3) {
                this._markers[markerCount - 2].off('dblclick', this._finishShape, this);
            }
        }
    },
    _getTooltipText: function () {
        var text, subtext;
        if (this._markers.length === 0) {
            text = L.drawLocal.draw.handlers.polygon.tooltip.start;
        } else if (this._markers.length
< 3) {
            text = L.drawLocal.draw.handlers.polygon.tooltip.cont;
        } else {
            text = L.drawLocal.draw.handlers.polygon.tooltip.end;
            subtext = this._getMeasurementString();
        }
        return {
            text: text,
            subtext: subtext
        };
    },
    _getMeasurementString: function () {
        var area = this._area;
        if (!area) {
            return null;
        }
        return L.GeometryUtil.readableArea(area, this.options.metric);
    },
    _shapeIsValid: function () {
        return this._markers.length >
= 3;
    },
    _vertexAdded: function () {
        // Check to see if we should show the area
        if (this.options.allowIntersection || !this.options.showArea) {
            return;
        }
        var latLngs = this._poly.getLatLngs();
        this._area = L.GeometryUtil.geodesicArea(latLngs);
    },
    _cleanUpShape: function () {
        var markerCount = this._markers.length;
        if (markerCount >
 0) {
            this._markers[0].off('click', this._finishShape, this);
            if (markerCount >
 2) {
                this._markers[markerCount - 1].off('dblclick', this._finishShape, this);
            }
        }
    }
});
L.SimpleShape = {};
L.Draw.SimpleShape = L.Draw.Feature.extend({
    options: {
        repeatMode: false
    },
    initialize: function (map, options) {
        this._endLabelText = L.drawLocal.draw.handlers.simpleshape.tooltip.end;
        L.Draw.Feature.prototype.initialize.call(this, map, options);
    },
    addHooks: function () {
        L.Draw.Feature.prototype.addHooks.call(this);
        if (this._map) {
            this._map.dragging.disable();
            //TODO refactor: move cursor to styles
            this._container.style.cursor = 'crosshair';
            this._tooltip.updateContent({ text: this._initialLabelText });
            this._map
                .on('mousedown', this._onMouseDown, this)
                .on('mousemove', this._onMouseMove, this);
        }
    },
    removeHooks: function () {
        L.Draw.Feature.prototype.removeHooks.call(this);
        if (this._map) {
            this._map.dragging.enable();
            //TODO refactor: move cursor to styles
            this._container.style.cursor = '';
            this._map
                .off('mousedown', this._onMouseDown, this)
                .off('mousemove', this._onMouseMove, this);
            L.DomEvent.off(document, 'mouseup', this._onMouseUp);
            // If the box element doesn't exist they must not have moved the mouse, so don't need to destroy/return
            if (this._shape) {
                this._map.removeLayer(this._shape);
                delete this._shape;
            }
        }
        this._isDrawing = false;
    },
    _onMouseDown: function (e) {
        this._isDrawing = true;
        this._startLatLng = e.latlng;
                if (this.options.snapPoint) this._startLatLng = this.options.snapPoint(this._startLatLng);
        L.DomEvent
            .on(document, 'mouseup', this._onMouseUp, this)
            .preventDefault(e.originalEvent);
    },
    _onMouseMove: function (e) {
        var latlng = e.latlng;
        this._tooltip.updatePosition(latlng);
        if (this._isDrawing) {
            this._tooltip.updateContent({ text: this._endLabelText });
            this._drawShape(latlng);
        }
    },
    _onMouseUp: function () {
        if (this._shape) {
            this._fireCreatedEvent();
        }
        this.disable();
        if (this.options.repeatMode) {
            this.enable();
        }
    }
});
L.Draw.Rectangle = L.Draw.SimpleShape.extend({
    statics: {
        TYPE: 'rectangle'
    },
    options: {
        shapeOptions: {
            stroke: true,
            color: '#f06eaa',
            weight: 4,
            opacity: 0.5,
            fill: true,
            fillColor: null, //same as color by default
            fillOpacity: 0.2,
            clickable: true
        }
    },
    initialize: function (map, options) {
        // Save the type so super can fire, need to do this as cannot do this.TYPE :(
        this.type = L.Draw.Rectangle.TYPE;
        this._initialLabelText = L.drawLocal.draw.handlers.rectangle.tooltip.start;
        L.Draw.SimpleShape.prototype.initialize.call(this, map, options);
    },
    _drawShape: function (latlng) {
        if (!this._shape) {
            this._shape = new L.Rectangle(new L.LatLngBounds(this._startLatLng, latlng), this.options.shapeOptions);
            this._map.addLayer(this._shape);
        } else {
            this._shape.setBounds(new L.LatLngBounds(this._startLatLng, latlng));
        }
    },
    _fireCreatedEvent: function () {
        var rectangle = new L.Rectangle(this._shape.getBounds(), this.options.shapeOptions);
        L.Draw.SimpleShape.prototype._fireCreatedEvent.call(this, rectangle);
    }
});
L.Draw.Circle = L.Draw.SimpleShape.extend({
    statics: {
        TYPE: 'circle'
    },
    options: {
        shapeOptions: {
            stroke: true,
            color: '#f06eaa',
            weight: 4,
            opacity: 0.5,
            fill: true,
            fillColor: null, //same as color by default
            fillOpacity: 0.2,
            clickable: true
        },
        metric: true // Whether to use the metric measurement system or imperial
    },
    initialize: function (map, options) {
        // Save the type so super can fire, need to do this as cannot do this.TYPE :(
        this.type = L.Draw.Circle.TYPE;
        this._initialLabelText = L.drawLocal.draw.handlers.circle.tooltip.start;
        L.Draw.SimpleShape.prototype.initialize.call(this, map, options);
    },
    _drawShape: function (latlng) {
        if (!this._shape) {
            this._shape = new L.GeodesicCircle(this._startLatLng, this._startLatLng.distanceTo(latlng), this.options.shapeOptions);
            this._map.addLayer(this._shape);
        } else {
            this._shape.setRadius(this._startLatLng.distanceTo(latlng));
        }
    },
    _fireCreatedEvent: function () {
        var circle = new L.GeodesicCircle(this._startLatLng, this._shape.getRadius(), this.options.shapeOptions);
        L.Draw.SimpleShape.prototype._fireCreatedEvent.call(this, circle);
    },
    _onMouseMove: function (e) {
        var latlng = e.latlng,
            metric = this.options.metric,
            radius;
        this._tooltip.updatePosition(latlng);
        if (this._isDrawing) {
            this._drawShape(latlng);
            // Get the new radius (rouded to 1 dp)
            radius = this._shape.getRadius().toFixed(1);
            this._tooltip.updateContent({
                text: this._endLabelText,
                subtext: 'Radius: ' + L.GeometryUtil.readableDistance(radius, this.options.metric)
            });
        }
    }
});
L.Draw.Marker = L.Draw.Feature.extend({
    statics: {
        TYPE: 'marker'
    },
    options: {
        icon: new L.Icon.Default(),
        repeatMode: false,
        zIndexOffset: 2000 // This should be >
 than the highest z-index any markers
    },
    initialize: function (map, options) {
        // Save the type so super can fire, need to do this as cannot do this.TYPE :(
        this.type = L.Draw.Marker.TYPE;
        L.Draw.Feature.prototype.initialize.call(this, map, options);
    },
    addHooks: function () {
        L.Draw.Feature.prototype.addHooks.call(this);
        if (this._map) {
            this._tooltip.updateContent({ text: L.drawLocal.draw.handlers.marker.tooltip.start });
            // Same mouseMarker as in Draw.Polyline
            if (!this._mouseMarker) {
                this._mouseMarker = L.marker(this._map.getCenter(), {
                    icon: L.divIcon({
                        className: 'leaflet-mouse-marker',
                        iconAnchor: [20, 20],
                        iconSize: [40, 40]
                    }),
                    opacity: 0,
                    zIndexOffset: this.options.zIndexOffset
                });
            }
            this._mouseMarker
                .on('click', this._onClick, this)
                .addTo(this._map);
            this._map.on('mousemove', this._onMouseMove, this);
        }
    },
    removeHooks: function () {
        L.Draw.Feature.prototype.removeHooks.call(this);
        if (this._map) {
            if (this._marker) {
                this._marker.off('click', this._onClick, this);
                this._map
                    .off('click', this._onClick, this)
                    .removeLayer(this._marker);
                delete this._marker;
            }
            this._mouseMarker.off('click', this._onClick, this);
            this._map.removeLayer(this._mouseMarker);
            delete this._mouseMarker;
            this._map.off('mousemove', this._onMouseMove, this);
        }
    },
    _onMouseMove: function (e) {
        var latlng = e.latlng;
        this._tooltip.updatePosition(latlng);
        this._mouseMarker.setLatLng(latlng);
        if (!this._marker) {
            this._marker = new L.Marker(latlng, {
                icon: this.options.icon,
                zIndexOffset: this.options.zIndexOffset
            });
            // Bind to both marker and map to make sure we get the click event.
            this._marker.on('click', this._onClick, this);
            this._map
                .on('click', this._onClick, this)
                .addLayer(this._marker);
        }
        else {
            this._marker.setLatLng(latlng);
        }
    },
    _onClick: function () {
                if (this.options.snapPoint) this._marker.setLatLng(this.options.snapPoint(this._marker.getLatLng()));
        this._fireCreatedEvent();
        this.disable();
        if (this.options.repeatMode) {
            this.enable();
        }
    },
    _fireCreatedEvent: function () {
        var marker = new L.Marker(this._marker.getLatLng(), { icon: this.options.icon });
        L.Draw.Feature.prototype._fireCreatedEvent.call(this, marker);
    }
});
L.Edit = L.Edit || {};
/*
 * L.Edit.Poly is an editing handler for polylines and polygons.
 */
L.Edit.Poly = L.Handler.extend({
    options: {
        icon: new L.DivIcon({
            iconSize: new L.Point(8, 8),
            className: 'leaflet-div-icon leaflet-editing-icon'
        })
    },
    initialize: function (poly, options) {
        this._poly = poly;
        L.setOptions(this, options);
    },
    addHooks: function () {
        if (this._poly._map) {
            if (!this._markerGroup) {
                this._initMarkers();
            }
            this._poly._map.addLayer(this._markerGroup);
        }
    },
    removeHooks: function () {
        if (this._poly._map) {
            this._poly._map.removeLayer(this._markerGroup);
            delete this._markerGroup;
            delete this._markers;
        }
    },
    updateMarkers: function () {
        this._markerGroup.clearLayers();
        this._initMarkers();
    },
    _initMarkers: function () {
        if (!this._markerGroup) {
            this._markerGroup = new L.LayerGroup();
        }
        this._markers = [];
        var latlngs = this._poly.getLatLngs(),
            i, j, len, marker;
        // TODO refactor holes implementation in Polygon to support it here
        for (i = 0, len = latlngs.length; i
< len; i++) {
            marker = this._createMarker(latlngs[i], i);
            marker.on('click', this._onMarkerClick, this);
            this._markers.push(marker);
        }
        var markerLeft, markerRight;
        for (i = 0, j = len - 1; i
< len; j = i++) {
            if (i === 0 && !(L.GeodesicPolygon && (this._poly instanceof L.GeodesicPolygon))) {
                continue;
            }
            markerLeft = this._markers[j];
            markerRight = this._markers[i];
            this._createMiddleMarker(markerLeft, markerRight);
            this._updatePrevNext(markerLeft, markerRight);
        }
    },
    _createMarker: function (latlng, index) {
        var marker = new L.Marker(latlng, {
            draggable: true,
            icon: this.options.icon
        });
        marker._origLatLng = latlng;
        marker._index = index;
        marker.on('drag', this._onMarkerDrag, this);
        marker.on('dragend', this._fireEdit, this);
        this._markerGroup.addLayer(marker);
        return marker;
    },
    _removeMarker: function (marker) {
        var i = marker._index;
        this._markerGroup.removeLayer(marker);
        this._markers.splice(i, 1);
        this._poly.spliceLatLngs(i, 1);
        this._updateIndexes(i, -1);
        marker
            .off('drag', this._onMarkerDrag, this)
            .off('dragend', this._fireEdit, this)
            .off('click', this._onMarkerClick, this);
    },
    _fireEdit: function () {
        this._poly.edited = true;
        this._poly.fire('edit');
    },
    _onMarkerDrag: function (e) {
        var marker = e.target;
        L.extend(marker._origLatLng, marker._latlng);
        if (marker._middleLeft) {
            marker._middleLeft.setLatLng(this._getMiddleLatLng(marker._prev, marker));
        }
        if (marker._middleRight) {
            marker._middleRight.setLatLng(this._getMiddleLatLng(marker, marker._next));
        }
        this._poly.redraw();
    },
    _onMarkerClick: function (e) {
        // we want to remove the marker on click, but if latlng count
< 3, polyline would be invalid
        if (this._poly.getLatLngs().length
< 3) { return; }
        var marker = e.target;
        // remove the marker
        this._removeMarker(marker);
        // update prev/next links of adjacent markers
        this._updatePrevNext(marker._prev, marker._next);
        // remove ghost markers near the removed marker
        if (marker._middleLeft) {
            this._markerGroup.removeLayer(marker._middleLeft);
        }
        if (marker._middleRight) {
            this._markerGroup.removeLayer(marker._middleRight);
        }
        // create a ghost marker in place of the removed one
        if (marker._prev && marker._next) {
            this._createMiddleMarker(marker._prev, marker._next);
        } else if (!marker._prev) {
            marker._next._middleLeft = null;
        } else if (!marker._next) {
            marker._prev._middleRight = null;
        }
        this._fireEdit();
    },
    _updateIndexes: function (index, delta) {
        this._markerGroup.eachLayer(function (marker) {
            if (marker._index >
 index) {
                marker._index += delta;
            }
        });
    },
    _createMiddleMarker: function (marker1, marker2) {
        var latlng = this._getMiddleLatLng(marker1, marker2),
            marker = this._createMarker(latlng),
            onClick,
            onDragStart,
            onDragEnd;
        marker.setOpacity(0.6);
        marker1._middleRight = marker2._middleLeft = marker;
        onDragStart = function () {
            var i = marker2._index;
            marker._index = i;
            marker
                .off('click', onClick, this)
                .on('click', this._onMarkerClick, this);
            latlng.lat = marker.getLatLng().lat;
            latlng.lng = marker.getLatLng().lng;
            this._poly.spliceLatLngs(i, 0, latlng);
            this._markers.splice(i, 0, marker);
            marker.setOpacity(1);
            this._updateIndexes(i, 1);
            marker2._index++;
            this._updatePrevNext(marker1, marker);
            this._updatePrevNext(marker, marker2);
        };
        onDragEnd = function () {
            marker.off('dragstart', onDragStart, this);
            marker.off('dragend', onDragEnd, this);
            this._createMiddleMarker(marker1, marker);
            this._createMiddleMarker(marker, marker2);
        };
        onClick = function () {
            onDragStart.call(this);
            onDragEnd.call(this);
            this._fireEdit();
        };
        marker
            .on('click', onClick, this)
            .on('dragstart', onDragStart, this)
            .on('dragend', onDragEnd, this);
        this._markerGroup.addLayer(marker);
    },
    _updatePrevNext: function (marker1, marker2) {
        if (marker1) {
            marker1._next = marker2;
        }
        if (marker2) {
            marker2._prev = marker1;
        }
    },
    _getMiddleLatLng: function (marker1, marker2) {
        var map = this._poly._map,
            p1 = map.latLngToLayerPoint(marker1.getLatLng()),
            p2 = map.latLngToLayerPoint(marker2.getLatLng());
        return map.layerPointToLatLng(p1._add(p2)._divideBy(2));
    }
});
L.Polyline.addInitHook(function () {
    // Check to see if handler has already been initialized. This is to support versions of Leaflet that still have L.Handler.PolyEdit
    if (this.editing) {
        return;
    }
    if (L.Edit.Poly) {
        this.editing = new L.Edit.Poly(this);
        if (this.options.editable) {
            this.editing.enable();
        }
    }
    this.on('add', function () {
        if (this.editing && this.editing.enabled()) {
            this.editing.addHooks();
        }
    });
    this.on('remove', function () {
        if (this.editing && this.editing.enabled()) {
            this.editing.removeHooks();
        }
    });
});
L.Edit = L.Edit || {};
L.Edit.SimpleShape = L.Handler.extend({
    options: {
        moveIcon: new L.DivIcon({
            iconSize: new L.Point(8, 8),
            className: 'leaflet-div-icon leaflet-editing-icon leaflet-edit-move'
        }),
        resizeIcon: new L.DivIcon({
            iconSize: new L.Point(8, 8),
            className: 'leaflet-div-icon leaflet-editing-icon leaflet-edit-resize'
        })
    },
    initialize: function (shape, options) {
        this._shape = shape;
        L.Util.setOptions(this, options);
    },
    addHooks: function () {
        if (this._shape._map) {
            this._map = this._shape._map;
            if (!this._markerGroup) {
                this._initMarkers();
            }
            this._map.addLayer(this._markerGroup);
        }
    },
    removeHooks: function () {
        if (this._shape._map) {
            this._unbindMarker(this._moveMarker);
            for (var i = 0, l = this._resizeMarkers.length; i
< l; i++) {
                this._unbindMarker(this._resizeMarkers[i]);
            }
            this._resizeMarkers = null;
            this._map.removeLayer(this._markerGroup);
            delete this._markerGroup;
        }
        this._map = null;
    },
    updateMarkers: function () {
        this._markerGroup.clearLayers();
        this._initMarkers();
    },
    _initMarkers: function () {
        if (!this._markerGroup) {
            this._markerGroup = new L.LayerGroup();
        }
        // Create center marker
        this._createMoveMarker();
        // Create edge marker
        this._createResizeMarker();
    },
    _createMoveMarker: function () {
        // Children override
    },
    _createResizeMarker: function () {
        // Children override
    },
    _createMarker: function (latlng, icon) {
        var marker = new L.Marker(latlng, {
            draggable: true,
            icon: icon,
            zIndexOffset: 10
        });
        this._bindMarker(marker);
        this._markerGroup.addLayer(marker);
        return marker;
    },
    _bindMarker: function (marker) {
        marker
            .on('dragstart', this._onMarkerDragStart, this)
            .on('drag', this._onMarkerDrag, this)
            .on('dragend', this._onMarkerDragEnd, this);
    },
    _unbindMarker: function (marker) {
        marker
            .off('dragstart', this._onMarkerDragStart, this)
            .off('drag', this._onMarkerDrag, this)
            .off('dragend', this._onMarkerDragEnd, this);
    },
    _onMarkerDragStart: function (e) {
        var marker = e.target;
        marker.setOpacity(0);
    },
    _fireEdit: function () {
        this._shape.edited = true;
        this._shape.fire('edit');
    },
    _onMarkerDrag: function (e) {
        var marker = e.target,
            latlng = marker.getLatLng();
        if (marker === this._moveMarker) {
            this._move(latlng);
        } else {
            this._resize(latlng);
        }
        this._shape.redraw();
    },
    _onMarkerDragEnd: function (e) {
        var marker = e.target;
        marker.setOpacity(1);
        this._shape.fire('edit');
        this._fireEdit();
    },
    _move: function () {
        // Children override
    },
    _resize: function () {
        // Children override
    }
});
L.Edit = L.Edit || {};
L.Edit.Rectangle = L.Edit.SimpleShape.extend({
    _createMoveMarker: function () {
        var bounds = this._shape.getBounds(),
            center = bounds.getCenter();
        this._moveMarker = this._createMarker(center, this.options.moveIcon);
    },
    _createResizeMarker: function () {
        var corners = this._getCorners();
        this._resizeMarkers = [];
        for (var i = 0, l = corners.length; i
< l; i++) {
            this._resizeMarkers.push(this._createMarker(corners[i], this.options.resizeIcon));
            // Monkey in the corner index as we will need to know this for dragging
            this._resizeMarkers[i]._cornerIndex = i;
        }
    },
    _onMarkerDragStart: function (e) {
        L.Edit.SimpleShape.prototype._onMarkerDragStart.call(this, e);
        // Save a reference to the opposite point
        var corners = this._getCorners(),
            marker = e.target,
            currentCornerIndex = marker._cornerIndex;
        this._oppositeCorner = corners[(currentCornerIndex + 2) % 4];
        this._toggleCornerMarkers(0, currentCornerIndex);
    },
    _onMarkerDragEnd: function (e) {
        var marker = e.target,
            bounds, center;
        // Reset move marker position to the center
        if (marker === this._moveMarker) {
            bounds = this._shape.getBounds();
            center = bounds.getCenter();
            marker.setLatLng(center);
        }
        this._toggleCornerMarkers(1);
        this._repositionCornerMarkers();
        L.Edit.SimpleShape.prototype._onMarkerDragEnd.call(this, e);
    },
    _move: function (newCenter) {
        var latlngs = this._shape.getLatLngs(),
            bounds = this._shape.getBounds(),
            center = bounds.getCenter(),
            offset, newLatLngs = [];
        // Offset the latlngs to the new center
        for (var i = 0, l = latlngs.length; i
< l; i++) {
            offset = [latlngs[i].lat - center.lat, latlngs[i].lng - center.lng];
            newLatLngs.push([newCenter.lat + offset[0], newCenter.lng + offset[1]]);
        }
        this._shape.setLatLngs(newLatLngs);
        // Respoition the resize markers
        this._repositionCornerMarkers();
    },
    _resize: function (latlng) {
        var bounds;
        // Update the shape based on the current position of this corner and the opposite point
        this._shape.setBounds(L.latLngBounds(latlng, this._oppositeCorner));
        // Respoition the move marker
        bounds = this._shape.getBounds();
        this._moveMarker.setLatLng(bounds.getCenter());
    },
    _getCorners: function () {
        var bounds = this._shape.getBounds(),
            nw = bounds.getNorthWest(),
            ne = bounds.getNorthEast(),
            se = bounds.getSouthEast(),
            sw = bounds.getSouthWest();
        return [nw, ne, se, sw];
    },
    _toggleCornerMarkers: function (opacity) {
        for (var i = 0, l = this._resizeMarkers.length; i
< l; i++) {
            this._resizeMarkers[i].setOpacity(opacity);
        }
    },
    _repositionCornerMarkers: function () {
        var corners = this._getCorners();
        for (var i = 0, l = this._resizeMarkers.length; i
< l; i++) {
            this._resizeMarkers[i].setLatLng(corners[i]);
        }
    }
});
L.Rectangle.addInitHook(function () {
    if (L.Edit.Rectangle) {
        this.editing = new L.Edit.Rectangle(this);
        if (this.options.editable) {
            this.editing.enable();
        }
    }
});
L.Edit = L.Edit || {};
L.Edit.Circle = L.Edit.SimpleShape.extend({
    _createMoveMarker: function () {
        var center = this._shape.getLatLng();
        this._moveMarker = this._createMarker(center, this.options.moveIcon);
    },
    _createResizeMarker: function () {
        var center = this._shape.getLatLng(),
            resizemarkerPoint = this._getResizeMarkerPoint(center);
        this._resizeMarkers = [];
        this._resizeMarkers.push(this._createMarker(resizemarkerPoint, this.options.resizeIcon));
    },
    _getResizeMarkerPoint: function (latlng) {
                var latRadius = (this._shape.getRadius() / 40075017) * 360;
        return L.latLng(latlng.lat+latRadius,latlng.lng);
    },
    _move: function (latlng) {
        var resizemarkerPoint = this._getResizeMarkerPoint(latlng);
        // Move the resize marker
        this._resizeMarkers[0].setLatLng(resizemarkerPoint);
        // Move the circle
        this._shape.setLatLng(latlng);
    },
    _resize: function (latlng) {
        var moveLatLng = this._moveMarker.getLatLng(),
            radius = moveLatLng.distanceTo(latlng);
        this._shape.setRadius(radius);
    }
});
L.Circle.addInitHook(function () {
    if (L.Edit.Circle) {
        this.editing = new L.Edit.Circle(this);
        if (this.options.editable) {
            this.editing.enable();
        }
    }
    this.on('add', function () {
        if (this.editing && this.editing.enabled()) {
            this.editing.addHooks();
        }
    });
    this.on('remove', function () {
        if (this.editing && this.editing.enabled()) {
            this.editing.removeHooks();
        }
    });
});
L.GeodesicCircle.addInitHook(function () {
    if (L.Edit.Circle) {
        this.editing = new L.Edit.Circle(this);
        if (this.options.editable) {
            this.editing.enable();
        }
    }
    this.on('add', function () {
        if (this.editing && this.editing.enabled()) {
            this.editing.addHooks();
        }
    });
    this.on('remove', function () {
        if (this.editing && this.editing.enabled()) {
            this.editing.removeHooks();
        }
    });
});
/*
 * L.LatLngUtil contains different utility functions for LatLngs.
 */
L.LatLngUtil = {
    // Clones a LatLngs[], returns [][]
    cloneLatLngs: function (latlngs) {
        var clone = [];
        for (var i = 0, l = latlngs.length; i
< l; i++) {
            clone.push(this.cloneLatLng(latlngs[i]));
        }
        return clone;
    },
    cloneLatLng: function (latlng) {
        return L.latLng(latlng.lat, latlng.lng);
    }
};
L.GeometryUtil = {
    // Ported from the OpenLayers implementation. See https://github.com/openlayers/openlayers/blob/master/lib/OpenLayers/Geometry/LinearRing.js#L270
    geodesicArea: function (latLngs) {
        var pointsCount = latLngs.length,
            area = 0.0,
            d2r = L.LatLng.DEG_TO_RAD,
            p1, p2;
        if (pointsCount >
 2) {
            for (var i = 0; i
< pointsCount; i++) {
                p1 = latLngs[i];
                p2 = latLngs[(i + 1) % pointsCount];
                area += ((p2.lng - p1.lng) * d2r) *
                        (2 + Math.sin(p1.lat * d2r) + Math.sin(p2.lat * d2r));
            }
            area = area * 6367000.0 * 6367000.0 / 2.0;
        }
        return Math.abs(area);
    },
    readableArea: function (area, isMetric) {
        var areaStr;
        if (isMetric) {
            if (area >
= 10000) {
                areaStr = (area * 0.0001).toFixed(2) + ' ha';
            } else {
                areaStr = area.toFixed(2) + ' m&sup2;';
            }
        } else {
            area *= 0.836127; // Square yards in 1 meter
            if (area >
= 3097600) { //3097600 square yards in 1 square mile
                areaStr = (area / 3097600).toFixed(2) + ' mi&sup2;';
            } else if (area >
= 4840) {//48040 square yards in 1 acre
                areaStr = (area / 4840).toFixed(2) + ' acres';
            } else {
                areaStr = Math.ceil(area) + ' yd&sup2;';
            }
        }
        return areaStr;
    },
    readableDistance: function (distance, isMetric) {
        var distanceStr;
        if (isMetric) {
            // show metres when distance is
< 1km, then show km
            if (distance >
 1000) {
                distanceStr = (distance  / 1000).toFixed(2) + ' km';
            } else {
                distanceStr = Math.ceil(distance) + ' m';
            }
        } else {
            distance *= 1.09361;
            if (distance >
 1760) {
                distanceStr = (distance / 1760).toFixed(2) + ' miles';
            } else {
                distanceStr = Math.ceil(distance) + ' yd';
            }
        }
        return distanceStr;
    }
};
L.Util.extend(L.LineUtil, {
    // Checks to see if two line segments intersect. Does not handle degenerate cases.
    // http://compgeom.cs.uiuc.edu/~jeffe/teaching/373/notes/x06-sweepline.pdf
    segmentsIntersect: function (/*Point*/ p, /*Point*/ p1, /*Point*/ p2, /*Point*/ p3) {
        return  this._checkCounterclockwise(p, p2, p3) !==
                this._checkCounterclockwise(p1, p2, p3) &&
                this._checkCounterclockwise(p, p1, p2) !==
                this._checkCounterclockwise(p, p1, p3);
    },
    // check to see if points are in counterclockwise order
    _checkCounterclockwise: function (/*Point*/ p, /*Point*/ p1, /*Point*/ p2) {
        return (p2.y - p.y) * (p1.x - p.x) >
 (p1.y - p.y) * (p2.x - p.x);
    }
});
L.Polyline.include({
    // Check to see if this polyline has any linesegments that intersect.
    // NOTE: does not support detecting intersection for degenerate cases.
    intersects: function () {
        var points = this._originalPoints,
            len = points ? points.length : 0,
            i, p, p1;
        if (this._tooFewPointsForIntersection()) {
            return false;
        }
        for (i = len - 1; i >
= 3; i--) {
            p = points[i - 1];
            p1 = points[i];
            if (this._lineSegmentsIntersectsRange(p, p1, i - 2)) {
                return true;
            }
        }
        return false;
    },
    // Check for intersection if new latlng was added to this polyline.
    // NOTE: does not support detecting intersection for degenerate cases.
    newLatLngIntersects: function (latlng, skipFirst) {
        // Cannot check a polyline for intersecting lats/lngs when not added to the map
        if (!this._map) {
            return false;
        }
        return this.newPointIntersects(this._map.latLngToLayerPoint(latlng), skipFirst);
    },
    // Check for intersection if new point was added to this polyline.
    // newPoint must be a layer point.
    // NOTE: does not support detecting intersection for degenerate cases.
    newPointIntersects: function (newPoint, skipFirst) {
        var points = this._originalPoints,
            len = points ? points.length : 0,
            lastPoint = points ? points[len - 1] : null,
            // The previous previous line segment. Previous line segement doesn't need testing.
            maxIndex = len - 2;
        if (this._tooFewPointsForIntersection(1)) {
            return false;
        }
        return this._lineSegmentsIntersectsRange(lastPoint, newPoint, maxIndex, skipFirst ? 1 : 0);
    },
    // Polylines with 2 sides can only intersect in cases where points are collinear (we don't support detecting these).
    // Cannot have intersection when
< 3 line segments (
< 4 points)
    _tooFewPointsForIntersection: function (extraPoints) {
        var points = this._originalPoints,
            len = points ? points.length : 0;
        // Increment length by extraPoints if present
        len += extraPoints || 0;
        return !this._originalPoints || len
<= 3;
    },
    // Checks a line segment intersections with any line segements before its predecessor.
    // Don't need to check the predecessor as will never intersect.
    _lineSegmentsIntersectsRange: function (p, p1, maxIndex, minIndex) {
        var points = this._originalPoints,
            p2, p3;
        minIndex = minIndex || 0;
        // Check all previous line segments (beside the immediately previous) for intersections
        for (var j = maxIndex; j >
 minIndex; j--) {
            p2 = points[j - 1];
            p3 = points[j];
            if (L.LineUtil.segmentsIntersect(p, p1, p2, p3)) {
                return true;
            }
        }
        return false;
    }
});
L.Polygon.include({
    // Checks a polygon for any intersecting line segments. Ignores holes.
    intersects: function () {
        var polylineIntersects,
            points = this._originalPoints,
            len, firstPoint, lastPoint, maxIndex;
        if (this._tooFewPointsForIntersection()) {
            return false;
        }
        polylineIntersects = L.Polyline.prototype.intersects.call(this);
        // If already found an intersection don't need to check for any more.
        if (polylineIntersects) {
            return true;
        }
        len = points.length;
        firstPoint = points[0];
        lastPoint = points[len - 1];
        maxIndex = len - 2;
        // Check the line segment between last and first point. Don't need to check the first line segment (minIndex = 1)
        return this._lineSegmentsIntersectsRange(lastPoint, firstPoint, maxIndex, 1);
    }
});
L.Control.Draw = L.Control.extend({
    options: {
        position: 'topleft',
        draw: {},
        edit: false
    },
    initialize: function (options) {
        if (L.version
<= "0.5.1") {
            throw new Error('Leaflet.draw 0.2.0+ requires Leaflet 0.6.0+. Download latest from https://github.com/Leaflet/Leaflet/');
        }
        L.Control.prototype.initialize.call(this, options);
        var id, toolbar;
        this._toolbars = {};
        // Initialize toolbars
        if (L.DrawToolbar && this.options.draw) {
            toolbar = new L.DrawToolbar(this.options.draw);
            id = L.stamp(toolbar);
            this._toolbars[id] = toolbar;
            // Listen for when toolbar is enabled
            this._toolbars[id].on('enable', this._toolbarEnabled, this);
        }
        if (L.EditToolbar && this.options.edit) {
            toolbar = new L.EditToolbar(this.options.edit);
            id = L.stamp(toolbar);
            this._toolbars[id] = toolbar;
            // Listen for when toolbar is enabled
            this._toolbars[id].on('enable', this._toolbarEnabled, this);
        }
    },
    onAdd: function (map) {
        var container = L.DomUtil.create('div', 'leaflet-draw'),
            addedTopClass = false,
            topClassName = 'leaflet-draw-toolbar-top',
            toolbarContainer;
        for (var toolbarId in this._toolbars) {
            if (this._toolbars.hasOwnProperty(toolbarId)) {
                toolbarContainer = this._toolbars[toolbarId].addToolbar(map);
                // Add class to the first toolbar to remove the margin
                if (!addedTopClass) {
                    if (!L.DomUtil.hasClass(toolbarContainer, topClassName)) {
                        L.DomUtil.addClass(toolbarContainer.childNodes[0], topClassName);
                    }
                    addedTopClass = true;
                }
                container.appendChild(toolbarContainer);
            }
        }
        return container;
    },
    onRemove: function () {
        for (var toolbarId in this._toolbars) {
            if (this._toolbars.hasOwnProperty(toolbarId)) {
                this._toolbars[toolbarId].removeToolbar();
            }
        }
    },
    setDrawingOptions: function (options) {
        for (var toolbarId in this._toolbars) {
            if (this._toolbars[toolbarId] instanceof L.DrawToolbar) {
                this._toolbars[toolbarId].setOptions(options);
            }
        }
    },
    _toolbarEnabled: function (e) {
        var id = '' + L.stamp(e.target);
        for (var toolbarId in this._toolbars) {
            if (this._toolbars.hasOwnProperty(toolbarId) && toolbarId !== id) {
                this._toolbars[toolbarId].disable();
            }
        }
    }
});
L.Map.mergeOptions({
    drawControl: false
});
L.Map.addInitHook(function () {
    if (this.options.drawControl) {
        this.drawControl = new L.Control.Draw();
        this.addControl(this.drawControl);
    }
});
L.Toolbar = L.Class.extend({
    includes: [L.Mixin.Events],
    initialize: function (options) {
        L.setOptions(this, options);
        this._modes = {};
        this._actionButtons = [];
        this._activeMode = null;
    },
    enabled: function () {
        return this._activeMode !== null;
    },
    disable: function () {
        if (!this.enabled()) { return; }
        this._activeMode.handler.disable();
    },
    removeToolbar: function () {
        // Dispose each handler
        for (var handlerId in this._modes) {
            if (this._modes.hasOwnProperty(handlerId)) {
                // Unbind handler button
                this._disposeButton(this._modes[handlerId].button, this._modes[handlerId].handler.enable);
                // Make sure is disabled
                this._modes[handlerId].handler.disable();
                // Unbind handler
                this._modes[handlerId].handler
                    .off('enabled', this._handlerActivated, this)
                    .off('disabled', this._handlerDeactivated, this);
            }
        }
        this._modes = {};
        // Dispose the actions toolbar
        for (var i = 0, l = this._actionButtons.length; i
< l; i++) {
            this._disposeButton(this._actionButtons[i].button, this._actionButtons[i].callback);
        }
        this._actionButtons = [];
        this._actionsContainer = null;
    },
    _initModeHandler: function (handler, container, buttonIndex, classNamePredix, buttonTitle) {
        var type = handler.type;
        this._modes[type] = {};
        this._modes[type].handler = handler;
        this._modes[type].button = this._createButton({
            title: buttonTitle,
            className: classNamePredix + '-' + type,
            container: container,
            callback: this._modes[type].handler.enable,
            context: this._modes[type].handler
        });
        this._modes[type].buttonIndex = buttonIndex;
        this._modes[type].handler
            .on('enabled', this._handlerActivated, this)
            .on('disabled', this._handlerDeactivated, this);
    },
    _createButton: function (options) {
        var link = L.DomUtil.create('a', options.className || '', options.container);
        link.href = '#';
        if (options.text) {
            link.innerHTML = options.text;
        }
        if (options.title) {
            link.title = options.title;
        }
        L.DomEvent
            .on(link, 'click', L.DomEvent.stopPropagation)
            .on(link, 'mousedown', L.DomEvent.stopPropagation)
            .on(link, 'dblclick', L.DomEvent.stopPropagation)
            .on(link, 'click', L.DomEvent.preventDefault)
            .on(link, 'click', options.callback, options.context);
        return link;
    },
    _disposeButton: function (button, callback) {
        L.DomEvent
            .off(button, 'click', L.DomEvent.stopPropagation)
            .off(button, 'mousedown', L.DomEvent.stopPropagation)
            .off(button, 'dblclick', L.DomEvent.stopPropagation)
            .off(button, 'click', L.DomEvent.preventDefault)
            .off(button, 'click', callback);
    },
    _handlerActivated: function (e) {
        // Disable active mode (if present)
        if (this._activeMode && this._activeMode.handler.enabled()) {
            this._activeMode.handler.disable();
        }
        // Cache new active feature
        this._activeMode = this._modes[e.handler];
        L.DomUtil.addClass(this._activeMode.button, 'leaflet-draw-toolbar-button-enabled');
        this._showActionsToolbar();
        this.fire('enable');
    },
    _handlerDeactivated: function () {
        this._hideActionsToolbar();
        L.DomUtil.removeClass(this._activeMode.button, 'leaflet-draw-toolbar-button-enabled');
        this._activeMode = null;
        this.fire('disable');
    },
    _createActions: function (buttons) {
        var container = L.DomUtil.create('ul', 'leaflet-draw-actions'),
            l = buttons.length,
            li, button;
        for (var i = 0; i
< l; i++) {
            li = L.DomUtil.create('li', '', container);
            button = this._createButton({
                title: buttons[i].title,
                text: buttons[i].text,
                container: li,
                callback: buttons[i].callback,
                context: buttons[i].context
            });
            this._actionButtons.push({
                button: button,
                callback: buttons[i].callback
            });
        }
        return container;
    },
    _showActionsToolbar: function () {
        var buttonIndex = this._activeMode.buttonIndex,
            lastButtonIndex = this._lastButtonIndex,
            buttonHeight = 26, // TODO: this should be calculated
            borderHeight = 1, // TODO: this should also be calculated
            toolbarPosition = (buttonIndex * buttonHeight) + (buttonIndex * borderHeight) - 1;
        // Correctly position the cancel button
        this._actionsContainer.style.top = toolbarPosition + 'px';
        if (buttonIndex === 0) {
            L.DomUtil.addClass(this._toolbarContainer, 'leaflet-draw-toolbar-notop');
            L.DomUtil.addClass(this._actionsContainer, 'leaflet-draw-actions-top');
        }
        if (buttonIndex === lastButtonIndex) {
            L.DomUtil.addClass(this._toolbarContainer, 'leaflet-draw-toolbar-nobottom');
            L.DomUtil.addClass(this._actionsContainer, 'leaflet-draw-actions-bottom');
        }
        this._actionsContainer.style.display = 'block';
    },
    _hideActionsToolbar: function () {
        this._actionsContainer.style.display = 'none';
        L.DomUtil.removeClass(this._toolbarContainer, 'leaflet-draw-toolbar-notop');
        L.DomUtil.removeClass(this._toolbarContainer, 'leaflet-draw-toolbar-nobottom');
        L.DomUtil.removeClass(this._actionsContainer, 'leaflet-draw-actions-top');
        L.DomUtil.removeClass(this._actionsContainer, 'leaflet-draw-actions-bottom');
    }
});
L.Tooltip = L.Class.extend({
    initialize: function (map) {
        this._map = map;
        this._popupPane = map._panes.popupPane;
        this._container = L.DomUtil.create('div', 'leaflet-draw-tooltip', this._popupPane);
        this._singleLineLabel = false;
    },
    dispose: function () {
        this._popupPane.removeChild(this._container);
        this._container = null;
    },
    updateContent: function (labelText) {
        labelText.subtext = labelText.subtext || '';
        // update the vertical position (only if changed)
        if (labelText.subtext.length === 0 && !this._singleLineLabel) {
            L.DomUtil.addClass(this._container, 'leaflet-draw-tooltip-single');
            this._singleLineLabel = true;
        }
        else if (labelText.subtext.length >
 0 && this._singleLineLabel) {
            L.DomUtil.removeClass(this._container, 'leaflet-draw-tooltip-single');
            this._singleLineLabel = false;
        }
        this._container.innerHTML =
            (labelText.subtext.length >
 0 ? '
<span class="leaflet-draw-tooltip-subtext">
' + labelText.subtext + '
</span>
' + '
<br />
' : '') +
            '
<span>
' + labelText.text + '
</span>
';
        return this;
    },
    updatePosition: function (latlng) {
        var pos = this._map.latLngToLayerPoint(latlng);
        L.DomUtil.setPosition(this._container, pos);
        return this;
    },
    showAsError: function () {
        L.DomUtil.addClass(this._container, 'leaflet-error-draw-tooltip');
        return this;
    },
    removeError: function () {
        L.DomUtil.removeClass(this._container, 'leaflet-error-draw-tooltip');
        return this;
    }
});
L.DrawToolbar = L.Toolbar.extend({
    options: {
        polyline: {},
        polygon: {},
        rectangle: {},
        circle: {},
        marker: {}
    },
    initialize: function (options) {
        // Ensure that the options are merged correctly since L.extend is only shallow
        for (var type in this.options) {
            if (this.options.hasOwnProperty(type)) {
                if (options[type]) {
                    options[type] = L.extend({}, this.options[type], options[type]);
                }
            }
        }
        L.Toolbar.prototype.initialize.call(this, options);
    },
    addToolbar: function (map) {
        var container = L.DomUtil.create('div', 'leaflet-draw-section'),
            buttonIndex = 0,
            buttonClassPrefix = 'leaflet-draw-draw';
        this._toolbarContainer = L.DomUtil.create('div', 'leaflet-draw-toolbar leaflet-bar');
        if (this.options.polyline) {
            this._initModeHandler(
                new L.Draw.Polyline(map, this.options.polyline),
                this._toolbarContainer,
                buttonIndex++,
                buttonClassPrefix,
                L.drawLocal.draw.toolbar.buttons.polyline
            );
        }
        if (this.options.polygon) {
            this._initModeHandler(
                new L.Draw.Polygon(map, this.options.polygon),
                this._toolbarContainer,
                buttonIndex++,
                buttonClassPrefix,
                L.drawLocal.draw.toolbar.buttons.polygon
            );
        }
        if (this.options.rectangle) {
            this._initModeHandler(
                new L.Draw.Rectangle(map, this.options.rectangle),
                this._toolbarContainer,
                buttonIndex++,
                buttonClassPrefix,
                L.drawLocal.draw.toolbar.buttons.rectangle
            );
        }
        if (this.options.circle) {
            this._initModeHandler(
                new L.Draw.Circle(map, this.options.circle),
                this._toolbarContainer,
                buttonIndex++,
                buttonClassPrefix,
                L.drawLocal.draw.toolbar.buttons.circle
            );
        }
        if (this.options.marker) {
            this._initModeHandler(
                new L.Draw.Marker(map, this.options.marker),
                this._toolbarContainer,
                buttonIndex++,
                buttonClassPrefix,
                L.drawLocal.draw.toolbar.buttons.marker
            );
        }
        // Save button index of the last button, -1 as we would have ++ after the last button
        this._lastButtonIndex = --buttonIndex;
        // Create the actions part of the toolbar
        this._actionsContainer = this._createActions([
            {
                title: L.drawLocal.draw.toolbar.actions.title,
                text: L.drawLocal.draw.toolbar.actions.text,
                callback: this.disable,
                context: this
            }
        ]);
        // Add draw and cancel containers to the control container
        container.appendChild(this._toolbarContainer);
        container.appendChild(this._actionsContainer);
        return container;
    },
    setOptions: function (options) {
        L.setOptions(this, options);
        for (var type in this._modes) {
            if (this._modes.hasOwnProperty(type) && options.hasOwnProperty(type)) {
                this._modes[type].handler.setOptions(options[type]);
            }
        }
    }
});
/*L.Map.mergeOptions({
    editControl: true
});*/
L.EditToolbar = L.Toolbar.extend({
    options: {
        edit: {
            selectedPathOptions: {
                color: '#fe57a1', /* Hot pink all the things! */
                opacity: 0.6,
                dashArray: '10, 10',
                fill: true,
                fillColor: '#fe57a1',
                fillOpacity: 0.1
            }
        },
        remove: {},
        featureGroup: null /* REQUIRED! TODO: perhaps if not set then all layers on the map are selectable? */
    },
    initialize: function (options) {
        // Need to set this manually since null is an acceptable value here
        if (options.edit) {
            if (typeof options.edit.selectedPathOptions === 'undefined') {
                options.edit.selectedPathOptions = this.options.edit.selectedPathOptions;
            }
            options.edit = L.extend({}, this.options.edit, options.edit);
        }
        if (options.remove) {
            options.remove = L.extend({}, this.options.remove, options.remove);
        }
        L.Toolbar.prototype.initialize.call(this, options);
        this._selectedFeatureCount = 0;
    },
    addToolbar: function (map) {
        var container = L.DomUtil.create('div', 'leaflet-draw-section'),
            buttonIndex = 0,
            buttonClassPrefix = 'leaflet-draw-edit';
        this._toolbarContainer = L.DomUtil.create('div', 'leaflet-draw-toolbar leaflet-bar');
        this._map = map;
        if (this.options.edit) {
            this._initModeHandler(
                new L.EditToolbar.Edit(map, {
                    featureGroup: this.options.featureGroup,
                    selectedPathOptions: this.options.edit.selectedPathOptions
                }),
                this._toolbarContainer,
                buttonIndex++,
                buttonClassPrefix,
                L.drawLocal.edit.toolbar.buttons.edit
            );
        }
        if (this.options.remove) {
            this._initModeHandler(
                new L.EditToolbar.Delete(map, {
                    featureGroup: this.options.featureGroup
                }),
                this._toolbarContainer,
                buttonIndex++,
                buttonClassPrefix,
                L.drawLocal.edit.toolbar.buttons.remove
            );
        }
        // Save button index of the last button, -1 as we would have ++ after the last button
        this._lastButtonIndex = --buttonIndex;
        // Create the actions part of the toolbar
        this._actionsContainer = this._createActions([
            {
                title: L.drawLocal.edit.toolbar.actions.save.title,
                text: L.drawLocal.edit.toolbar.actions.save.text,
                callback: this._save,
                context: this
            },
            {
                title: L.drawLocal.edit.toolbar.actions.cancel.title,
                text: L.drawLocal.edit.toolbar.actions.cancel.text,
                callback: this.disable,
                context: this
            }
        ]);
        // Add draw and cancel containers to the control container
        container.appendChild(this._toolbarContainer);
        container.appendChild(this._actionsContainer);
        return container;
    },
    disable: function () {
        if (!this.enabled()) { return; }
        this._activeMode.handler.revertLayers();
        L.Toolbar.prototype.disable.call(this);
    },
    _save: function () {
        this._activeMode.handler.save();
        this._activeMode.handler.disable();
    }
});
L.EditToolbar.Edit = L.Handler.extend({
    statics: {
        TYPE: 'edit'
    },
    includes: L.Mixin.Events,
    initialize: function (map, options) {
        L.Handler.prototype.initialize.call(this, map);
        // Set options to the default unless already set
        this._selectedPathOptions = options.selectedPathOptions;
        // Store the selectable layer group for ease of access
        this._featureGroup = options.featureGroup;
        if (!(this._featureGroup instanceof L.FeatureGroup)) {
            throw new Error('options.featureGroup must be a L.FeatureGroup');
        }
        this._uneditedLayerProps = {};
        // Save the type so super can fire, need to do this as cannot do this.TYPE :(
        this.type = L.EditToolbar.Edit.TYPE;
    },
    enable: function () {
        if (this._enabled) { return; }
        L.Handler.prototype.enable.call(this);
        this._featureGroup
            .on('layeradd', this._enableLayerEdit, this)
            .on('layerremove', this._disableLayerEdit, this);
        this.fire('enabled', {handler: this.type});
        this._map.fire('draw:editstart', { handler: this.type });
    },
    disable: function () {
        if (!this._enabled) { return; }
        this.fire('disabled', {handler: this.type});
        this._map.fire('draw:editstop', { handler: this.type });
        this._featureGroup
            .off('layeradd', this._enableLayerEdit, this)
            .off('layerremove', this._disableLayerEdit, this);
        L.Handler.prototype.disable.call(this);
    },
    addHooks: function () {
        if (this._map) {
            this._featureGroup.eachLayer(this._enableLayerEdit, this);
            this._tooltip = new L.Tooltip(this._map);
            this._tooltip.updateContent({
                text: L.drawLocal.edit.handlers.edit.tooltip.text,
                subtext: L.drawLocal.edit.handlers.edit.tooltip.subtext
            });
            this._map.on('mousemove', this._onMouseMove, this);
        }
    },
    removeHooks: function () {
        if (this._map) {
            // Clean up selected layers.
            this._featureGroup.eachLayer(this._disableLayerEdit, this);
            // Clear the backups of the original layers
            this._uneditedLayerProps = {};
            this._tooltip.dispose();
            this._tooltip = null;
            this._map.off('mousemove', this._onMouseMove, this);
        }
    },
    revertLayers: function () {
        this._featureGroup.eachLayer(function (layer) {
            this._revertLayer(layer);
        }, this);
    },
    save: function () {
        var editedLayers = new L.LayerGroup();
        this._featureGroup.eachLayer(function (layer) {
            if (layer.edited) {
                editedLayers.addLayer(layer);
                layer.edited = false;
            }
        });
        this._map.fire('draw:edited', {layers: editedLayers});
    },
    _backupLayer: function (layer) {
        var id = L.Util.stamp(layer);
        if (!this._uneditedLayerProps[id]) {
            if (layer instanceof L.GeodesicCircle || layer instanceof L.Circle) {
                this._uneditedLayerProps[id] = {
                    latlng: L.LatLngUtil.cloneLatLng(layer.getLatLng()),
                    radius: layer.getRadius()
                };
            } else if (layer instanceof L.GeodesicPolyline || layer instanceof L.GeodesicPolygon || layer instanceof L.Rectangle) {
                // Polyline, Polygon or Rectangle
                this._uneditedLayerProps[id] = {
                    latlngs: L.LatLngUtil.cloneLatLngs(layer.getLatLngs())
                };
            } else { // Marker
                this._uneditedLayerProps[id] = {
                    latlng: L.LatLngUtil.cloneLatLng(layer.getLatLng())
                };
            }
        }
    },
    _revertLayer: function (layer) {
        var id = L.Util.stamp(layer);
        layer.edited = false;
        if (this._uneditedLayerProps.hasOwnProperty(id)) {
            if (layer instanceof L.GeodesicCircle || layer instanceof L.Circle) {
                layer.setLatLng(this._uneditedLayerProps[id].latlng);
                layer.setRadius(this._uneditedLayerProps[id].radius);
            } else if (layer instanceof L.GeodesicPolyline || layer instanceof L.GeodesicPolygon || layer instanceof L.Rectangle) {
                // Polyline, Polygon or Rectangle
                layer.setLatLngs(this._uneditedLayerProps[id].latlngs);
            } else { // Marker
                layer.setLatLng(this._uneditedLayerProps[id].latlng);
            }
        }
    },
    _toggleMarkerHighlight: function (marker) {
        if (!marker._icon) {
            return;
        }
        // This is quite naughty, but I don't see another way of doing it. (short of setting a new icon)
        var icon = marker._icon;
        icon.style.display = 'none';
        if (L.DomUtil.hasClass(icon, 'leaflet-edit-marker-selected')) {
            L.DomUtil.removeClass(icon, 'leaflet-edit-marker-selected');
            // Offset as the border will make the icon move.
            this._offsetMarker(icon, -4);
        } else {
            L.DomUtil.addClass(icon, 'leaflet-edit-marker-selected');
            // Offset as the border will make the icon move.
            this._offsetMarker(icon, 4);
        }
        icon.style.display = '';
    },
    _offsetMarker: function (icon, offset) {
        var iconMarginTop = parseInt(icon.style.marginTop, 10) - offset,
            iconMarginLeft = parseInt(icon.style.marginLeft, 10) - offset;
        icon.style.marginTop = iconMarginTop + 'px';
        icon.style.marginLeft = iconMarginLeft + 'px';
    },
    _enableLayerEdit: function (e) {
        var layer = e.layer || e.target || e,
            isMarker = layer instanceof L.Marker,
            pathOptions;
        // Don't do anything if this layer is a marker but doesn't have an icon. Markers
        // should usually have icons. If using Leaflet.draw with Leaflet.markercluster there
        // is a chance that a marker doesn't.
        if (isMarker && !layer._icon) {
            return;
        }
        // Back up this layer (if haven't before)
        this._backupLayer(layer);
        // Update layer style so appears editable
        if (this._selectedPathOptions) {
            pathOptions = L.Util.extend({}, this._selectedPathOptions);
            if (isMarker) {
                this._toggleMarkerHighlight(layer);
            } else {
                layer.options.previousOptions = layer.options;
                // Make sure that Polylines are not filled
                if (!(layer instanceof L.Circle) && !(layer instanceof L.GeodesicCircle) && !(layer instanceof L.GeodesicPolygon) && !(layer instanceof L.Rectangle)) {
                    pathOptions.fill = false;
                }
                layer.setStyle(pathOptions);
            }
        }
        if (isMarker) {
            layer.dragging.enable();
            layer.on('dragend', this._onMarkerDragEnd);
        } else {
            layer.editing.enable();
        }
    },
    _disableLayerEdit: function (e) {
        var layer = e.layer || e.target || e;
        layer.edited = false;
        // Reset layer styles to that of before select
        if (this._selectedPathOptions) {
            if (layer instanceof L.Marker) {
                this._toggleMarkerHighlight(layer);
            } else {
                // reset the layer style to what is was before being selected
                layer.setStyle(layer.options.previousOptions);
                // remove the cached options for the layer object
                delete layer.options.previousOptions;
            }
        }
        if (layer instanceof L.Marker) {
            layer.dragging.disable();
            layer.off('dragend', this._onMarkerDragEnd, this);
        } else {
            layer.editing.disable();
        }
    },
    _onMarkerDragEnd: function (e) {
        var layer = e.target;
        layer.edited = true;
    },
    _onMouseMove: function (e) {
        this._tooltip.updatePosition(e.latlng);
    }
});
L.EditToolbar.Delete = L.Handler.extend({
    statics: {
        TYPE: 'remove' // not delete as delete is reserved in js
    },
    includes: L.Mixin.Events,
    initialize: function (map, options) {
        L.Handler.prototype.initialize.call(this, map);
        L.Util.setOptions(this, options);
        // Store the selectable layer group for ease of access
        this._deletableLayers = this.options.featureGroup;
        if (!(this._deletableLayers instanceof L.FeatureGroup)) {
            throw new Error('options.featureGroup must be a L.FeatureGroup');
        }
        // Save the type so super can fire, need to do this as cannot do this.TYPE :(
        this.type = L.EditToolbar.Delete.TYPE;
    },
    enable: function () {
        if (this._enabled) { return; }
        L.Handler.prototype.enable.call(this);
        this._deletableLayers
            .on('layeradd', this._enableLayerDelete, this)
            .on('layerremove', this._disableLayerDelete, this);
        this.fire('enabled', { handler: this.type});
        this._map.fire('draw:editstart', { handler: this.type });
    },
    disable: function () {
        if (!this._enabled) { return; }
        L.Handler.prototype.disable.call(this);
        this._deletableLayers
            .off('layeradd', this._enableLayerDelete, this)
            .off('layerremove', this._disableLayerDelete, this);
        this.fire('disabled', { handler: this.type});
        this._map.fire('draw:editstop', { handler: this.type });
    },
    addHooks: function () {
        if (this._map) {
            this._deletableLayers.eachLayer(this._enableLayerDelete, this);
            this._deletedLayers = new L.layerGroup();
            this._tooltip = new L.Tooltip(this._map);
            this._tooltip.updateContent({ text: L.drawLocal.edit.handlers.remove.tooltip.text });
            this._map.on('mousemove', this._onMouseMove, this);
        }
    },
    removeHooks: function () {
        if (this._map) {
            this._deletableLayers.eachLayer(this._disableLayerDelete, this);
            this._deletedLayers = null;
            this._tooltip.dispose();
            this._tooltip = null;
            this._map.off('mousemove', this._onMouseMove, this);
        }
    },
    revertLayers: function () {
        // Iterate of the deleted layers and add them back into the featureGroup
        this._deletedLayers.eachLayer(function (layer) {
            this._deletableLayers.addLayer(layer);
        }, this);
    },
    save: function () {
        this._map.fire('draw:deleted', { layers: this._deletedLayers });
    },
    _enableLayerDelete: function (e) {
        var layer = e.layer || e.target || e;
        layer.on('click', this._removeLayer, this);
    },
    _disableLayerDelete: function (e) {
        var layer = e.layer || e.target || e;
        layer.off('click', this._removeLayer, this);
        // Remove from the deleted layers so we can't accidently revert if the user presses cancel
        this._deletedLayers.removeLayer(layer);
    },
    _removeLayer: function (e) {
        var layer = e.layer || e.target || e;
        this._deletableLayers.removeLayer(layer);
        this._deletedLayers.addLayer(layer);
    },
    _onMouseMove: function (e) {
        this._tooltip.updatePosition(e.latlng);
    }
});
}(this, document));
  // Spectrum Colorpicker v1.2.0
// https://github.com/bgrins/spectrum
// Author: Brian Grinstead
// License: MIT
(function (window, $, undefined) {
    var defaultOpts = {
        // Callbacks
        beforeShow: noop,
        move: noop,
        change: noop,
        show: noop,
        hide: noop,
        // Options
        color: false,
        flat: false,
        showInput: false,
        allowEmpty: false,
        showButtons: true,
        clickoutFiresChange: false,
        showInitial: false,
        showPalette: false,
        showPaletteOnly: false,
        showSelectionPalette: true,
        localStorageKey: false,
        appendTo: "body",
        maxSelectionSize: 7,
        cancelText: "cancel",
        chooseText: "choose",
        preferredFormat: false,
        className: "",
        showAlpha: false,
        theme: "sp-light",
        palette: ['fff', '000'],
        selectionPalette: [],
        disabled: false
    },
    spectrums = [],
    IE = !!/msie/i.exec( window.navigator.userAgent ),
    rgbaSupport = (function() {
        function contains( str, substr ) {
            return !!~('' + str).indexOf(substr);
        }
        var elem = document.createElement('div');
        var style = elem.style;
        style.cssText = 'background-color:rgba(0,0,0,.5)';
        return contains(style.backgroundColor, 'rgba') || contains(style.backgroundColor, 'hsla');
    })(),
    inputTypeColorSupport = (function() {
        var colorInput = $("
<input type='color' value='!' />
")[0];
        return colorInput.type === "color" && colorInput.value !== "!";
    })(),
    replaceInput = [
        "
<div class='sp-replacer'>
",
            "
<div class='sp-preview'>
<div class='sp-preview-inner'>
</div>
</div>
",
            "
<div class='sp-dd'>
&#9660;
</div>
",
        "
</div>
"
    ].join(''),
    markup = (function () {
        // IE does not support gradients with multiple stops, so we need to simulate
        //  that for the rainbow slider with 8 divs that each have a single gradient
        var gradientFix = "";
        if (IE) {
            for (var i = 1; i
<= 6; i++) {
                gradientFix += "
<div class='sp-" + i + "'>
</div>
";
            }
        }
        return [
            "
<div class='sp-container sp-hidden'>
",
                "
<div class='sp-palette-container'>
",
                    "
<div class='sp-palette sp-thumb sp-cf'>
</div>
",
                "
</div>
",
                "
<div class='sp-picker-container'>
",
                    "
<div class='sp-top sp-cf'>
",
                        "
<div class='sp-fill'>
</div>
",
                        "
<div class='sp-top-inner'>
",
                            "
<div class='sp-color'>
",
                                "
<div class='sp-sat'>
",
                                    "
<div class='sp-val'>
",
                                        "
<div class='sp-dragger'>
</div>
",
                                    "
</div>
",
                                "
</div>
",
                            "
</div>
",
                            "
<div class='sp-clear sp-clear-display' title='Clear Color Selection'>
",
                            "
</div>
",
                            "
<div class='sp-hue'>
",
                                "
<div class='sp-slider'>
</div>
",
                                gradientFix,
                            "
</div>
",
                        "
</div>
",
                        "
<div class='sp-alpha'>
<div class='sp-alpha-inner'>
<div class='sp-alpha-handle'>
</div>
</div>
</div>
",
                    "
</div>
",
                    "
<div class='sp-input-container sp-cf'>
",
                        "
<input class='sp-input' type='text' spellcheck='false'  />
",
                    "
</div>
",
                    "
<div class='sp-initial sp-thumb sp-cf'>
</div>
",
                    "
<div class='sp-button-container sp-cf'>
",
                        "
<a class='sp-cancel' href='#'>
</a>
",
                        "
<button class='sp-choose'>
</button>
",
                    "
</div>
",
                "
</div>
",
            "
</div>
"
        ].join("");
    })();
    function paletteTemplate (p, color, className) {
        var html = [];
        for (var i = 0; i
< p.length; i++) {
            var current = p[i];
            if(current) {
                var tiny = tinycolor(current);
                var c = tiny.toHsl().l
< 0.5 ? "sp-thumb-el sp-thumb-dark" : "sp-thumb-el sp-thumb-light";
                c += (tinycolor.equals(color, current)) ? " sp-thumb-active" : "";
                var swatchStyle = rgbaSupport ? ("background-color:" + tiny.toRgbString()) : "filter:" + tiny.toFilter();
                html.push('
<span title="' + tiny.toRgbString() + '" data-color="' + tiny.toRgbString() + '" class="' + c + '">
<span class="sp-thumb-inner" style="' + swatchStyle + ';" />
</span>
');
            } else {
                var cls = 'sp-clear-display';
                html.push('
<span title="No Color Selected" data-color="" style="background-color:transparent;" class="' + cls + '">
</span>
');
            }
        }
        return "
<div class='sp-cf " + className + "'>
" + html.join('') + "
</div>
";
    }
    function hideAll() {
        for (var i = 0; i
< spectrums.length; i++) {
            if (spectrums[i]) {
                spectrums[i].hide();
            }
        }
    }
    function instanceOptions(o, callbackContext) {
        var opts = $.extend({}, defaultOpts, o);
        opts.callbacks = {
            'move': bind(opts.move, callbackContext),
            'change': bind(opts.change, callbackContext),
            'show': bind(opts.show, callbackContext),
            'hide': bind(opts.hide, callbackContext),
            'beforeShow': bind(opts.beforeShow, callbackContext)
        };
        return opts;
    }
    function spectrum(element, o) {
        var opts = instanceOptions(o, element),
            flat = opts.flat,
            showSelectionPalette = opts.showSelectionPalette,
            localStorageKey = opts.localStorageKey,
            theme = opts.theme,
            callbacks = opts.callbacks,
            resize = throttle(reflow, 10),
            visible = false,
            dragWidth = 0,
            dragHeight = 0,
            dragHelperHeight = 0,
            slideHeight = 0,
            slideWidth = 0,
            alphaWidth = 0,
            alphaSlideHelperWidth = 0,
            slideHelperHeight = 0,
            currentHue = 0,
            currentSaturation = 0,
            currentValue = 0,
            currentAlpha = 1,
            palette = opts.palette.slice(0),
            paletteArray = $.isArray(palette[0]) ? palette : [palette],
            selectionPalette = opts.selectionPalette.slice(0),
            maxSelectionSize = opts.maxSelectionSize,
            draggingClass = "sp-dragging",
            shiftMovementDirection = null;
        var doc = element.ownerDocument,
            body = doc.body,
            boundElement = $(element),
            disabled = false,
            container = $(markup, doc).addClass(theme),
            dragger = container.find(".sp-color"),
            dragHelper = container.find(".sp-dragger"),
            slider = container.find(".sp-hue"),
            slideHelper = container.find(".sp-slider"),
            alphaSliderInner = container.find(".sp-alpha-inner"),
            alphaSlider = container.find(".sp-alpha"),
            alphaSlideHelper = container.find(".sp-alpha-handle"),
            textInput = container.find(".sp-input"),
            paletteContainer = container.find(".sp-palette"),
            initialColorContainer = container.find(".sp-initial"),
            cancelButton = container.find(".sp-cancel"),
            clearButton = container.find(".sp-clear"),
            chooseButton = container.find(".sp-choose"),
            isInput = boundElement.is("input"),
            isInputTypeColor = isInput && inputTypeColorSupport && boundElement.attr("type") === "color",
            shouldReplace = isInput && !flat,
            replacer = (shouldReplace) ? $(replaceInput).addClass(theme).addClass(opts.className) : $([]),
            offsetElement = (shouldReplace) ? replacer : boundElement,
            previewElement = replacer.find(".sp-preview-inner"),
            initialColor = opts.color || (isInput && boundElement.val()),
            colorOnShow = false,
            preferredFormat = opts.preferredFormat,
            currentPreferredFormat = preferredFormat,
            clickoutFiresChange = !opts.showButtons || opts.clickoutFiresChange,
            isEmpty = !initialColor,
            allowEmpty = opts.allowEmpty && !isInputTypeColor;
        function applyOptions() {
            if (opts.showPaletteOnly) {
                opts.showPalette = true;
            }
            container.toggleClass("sp-flat", flat);
            container.toggleClass("sp-input-disabled", !opts.showInput);
            container.toggleClass("sp-alpha-enabled", opts.showAlpha);
            container.toggleClass("sp-clear-enabled", allowEmpty);
            container.toggleClass("sp-buttons-disabled", !opts.showButtons);
            container.toggleClass("sp-palette-disabled", !opts.showPalette);
            container.toggleClass("sp-palette-only", opts.showPaletteOnly);
            container.toggleClass("sp-initial-disabled", !opts.showInitial);
            container.addClass(opts.className);
            reflow();
        }
        function initialize() {
            if (IE) {
                container.find("*:not(input)").attr("unselectable", "on");
            }
            applyOptions();
            if (shouldReplace) {
                boundElement.after(replacer).hide();
            }
            if (!allowEmpty) {
                clearButton.hide();
            }
            if (flat) {
                boundElement.after(container).hide();
            }
            else {
                var appendTo = opts.appendTo === "parent" ? boundElement.parent() : $(opts.appendTo);
                if (appendTo.length !== 1) {
                    appendTo = $("body");
                }
                appendTo.append(container);
            }
            if (localStorageKey && window.localStorage) {
                // Migrate old palettes over to new format.  May want to remove this eventually.
                try {
                    var oldPalette = window.localStorage[localStorageKey].split(",#");
                    if (oldPalette.length >
 1) {
                        delete window.localStorage[localStorageKey];
                        $.each(oldPalette, function(i, c) {
                             addColorToSelectionPalette(c);
                        });
                    }
                }
                catch(e) { }
                try {
                    selectionPalette = window.localStorage[localStorageKey].split(";");
                }
                catch (e) { }
            }
            offsetElement.bind("click.spectrum touchstart.spectrum", function (e) {
                if (!disabled) {
                    toggle();
                }
                e.stopPropagation();
                if (!$(e.target).is("input")) {
                    e.preventDefault();
                }
            });
            if(boundElement.is(":disabled") || (opts.disabled === true)) {
                disable();
            }
            // Prevent clicks from bubbling up to document.  This would cause it to be hidden.
            container.click(stopPropagation);
            // Handle user typed input
            textInput.change(setFromTextInput);
            textInput.bind("paste", function () {
                setTimeout(setFromTextInput, 1);
            });
            textInput.keydown(function (e) { if (e.keyCode == 13) { setFromTextInput(); } });
            cancelButton.text(opts.cancelText);
            cancelButton.bind("click.spectrum", function (e) {
                e.stopPropagation();
                e.preventDefault();
                hide("cancel");
            });
            clearButton.bind("click.spectrum", function (e) {
                e.stopPropagation();
                e.preventDefault();
               isEmpty = true;
                move();
                if(flat) {
                    //for the flat style, this is a change event
                    updateOriginalInput(true);
                }
            });
            chooseButton.text(opts.chooseText);
            chooseButton.bind("click.spectrum", function (e) {
                e.stopPropagation();
                e.preventDefault();
                if (isValid()) {
                    updateOriginalInput(true);
                    hide();
                }
            });
            draggable(alphaSlider, function (dragX, dragY, e) {
                currentAlpha = (dragX / alphaWidth);
                isEmpty = false;
                if (e.shiftKey) {
                    currentAlpha = Math.round(currentAlpha * 10) / 10;
                }
                move();
            });
            draggable(slider, function (dragX, dragY) {
                currentHue = parseFloat(dragY / slideHeight);
                isEmpty = false;
                move();
            }, dragStart, dragStop);
            draggable(dragger, function (dragX, dragY, e) {
                // shift+drag should snap the movement to either the x or y axis.
                if (!e.shiftKey) {
                    shiftMovementDirection = null;
                }
                else if (!shiftMovementDirection) {
                    var oldDragX = currentSaturation * dragWidth;
                    var oldDragY = dragHeight - (currentValue * dragHeight);
                    var furtherFromX = Math.abs(dragX - oldDragX) >
 Math.abs(dragY - oldDragY);
                    shiftMovementDirection = furtherFromX ? "x" : "y";
                }
                var setSaturation = !shiftMovementDirection || shiftMovementDirection === "x";
                var setValue = !shiftMovementDirection || shiftMovementDirection === "y";
                if (setSaturation) {
                    currentSaturation = parseFloat(dragX / dragWidth);
                }
                if (setValue) {
                    currentValue = parseFloat((dragHeight - dragY) / dragHeight);
                }
                isEmpty = false;
                move();
            }, dragStart, dragStop);
            if (!!initialColor) {
                set(initialColor);
                // In case color was black - update the preview UI and set the format
                // since the set function will not run (default color is black).
                updateUI();
                currentPreferredFormat = preferredFormat || tinycolor(initialColor).format;
                addColorToSelectionPalette(initialColor);
            }
            else {
                updateUI();
            }
            if (flat) {
                show();
            }
            function palletElementClick(e) {
                if (e.data && e.data.ignore) {
                    set($(this).data("color"));
                    move();
                }
                else {
                    set($(this).data("color"));
                    updateOriginalInput(true);
                    move();
                    hide();
                }
                return false;
            }
            var paletteEvent = IE ? "mousedown.spectrum" : "click.spectrum touchstart.spectrum";
            paletteContainer.delegate(".sp-thumb-el", paletteEvent, palletElementClick);
            initialColorContainer.delegate(".sp-thumb-el:nth-child(1)", paletteEvent, { ignore: true }, palletElementClick);
        }
        function addColorToSelectionPalette(color) {
            if (showSelectionPalette) {
                var colorRgb = tinycolor(color).toRgbString();
                if ($.inArray(colorRgb, selectionPalette) === -1) {
                    selectionPalette.push(colorRgb);
                    while(selectionPalette.length >
 maxSelectionSize) {
                        selectionPalette.shift();
                    }
                }
                if (localStorageKey && window.localStorage) {
                    try {
                        window.localStorage[localStorageKey] = selectionPalette.join(";");
                    }
                    catch(e) { }
                }
            }
        }
        function getUniqueSelectionPalette() {
            var unique = [];
            var p = selectionPalette;
            var paletteLookup = {};
            var rgb;
            if (opts.showPalette) {
                for (var i = 0; i
< paletteArray.length; i++) {
                    for (var j = 0; j
< paletteArray[i].length; j++) {
                        rgb = tinycolor(paletteArray[i][j]).toRgbString();
                        paletteLookup[rgb] = true;
                    }
                }
                for (i = 0; i
< p.length; i++) {
                    rgb = tinycolor(p[i]).toRgbString();
                    if (!paletteLookup.hasOwnProperty(rgb)) {
                        unique.push(p[i]);
                        paletteLookup[rgb] = true;
                    }
                }
            }
            return unique.reverse().slice(0, opts.maxSelectionSize);
        }
        function drawPalette() {
            var currentColor = get();
            var html = $.map(paletteArray, function (palette, i) {
                return paletteTemplate(palette, currentColor, "sp-palette-row sp-palette-row-" + i);
            });
            if (selectionPalette) {
                html.push(paletteTemplate(getUniqueSelectionPalette(), currentColor, "sp-palette-row sp-palette-row-selection"));
            }
            paletteContainer.html(html.join(""));
        }
        function drawInitial() {
            if (opts.showInitial) {
                var initial = colorOnShow;
                var current = get();
                initialColorContainer.html(paletteTemplate([initial, current], current, "sp-palette-row-initial"));
            }
        }
        function dragStart() {
            if (dragHeight
<= 0 || dragWidth
<= 0 || slideHeight
<= 0) {
                reflow();
            }
            container.addClass(draggingClass);
            shiftMovementDirection = null;
        }
        function dragStop() {
            container.removeClass(draggingClass);
        }
        function setFromTextInput() {
            var value = textInput.val();
            if ((value === null || value === "") && allowEmpty) {
                set(null);
            }
            else {
                var tiny = tinycolor(value);
                if (tiny.ok) {
                    set(tiny);
                }
                else {
                    textInput.addClass("sp-validation-error");
                }
            }
        }
        function toggle() {
            if (visible) {
                hide();
            }
            else {
                show();
            }
        }
        function show() {
            var event = $.Event('beforeShow.spectrum');
            if (visible) {
                reflow();
                return;
            }
            boundElement.trigger(event, [ get() ]);
            if (callbacks.beforeShow(get()) === false || event.isDefaultPrevented()) {
                return;
            }
            hideAll();
            visible = true;
            $(doc).bind("click.spectrum", hide);
            $(window).bind("resize.spectrum", resize);
            replacer.addClass("sp-active");
            container.removeClass("sp-hidden");
            if (opts.showPalette) {
                drawPalette();
            }
            reflow();
            updateUI();
            colorOnShow = get();
            drawInitial();
            callbacks.show(colorOnShow);
            boundElement.trigger('show.spectrum', [ colorOnShow ]);
        }
        function hide(e) {
            // Return on right click
            if (e && e.type == "click" && e.button == 2) { return; }
            // Return if hiding is unnecessary
            if (!visible || flat) { return; }
            visible = false;
            $(doc).unbind("click.spectrum", hide);
            $(window).unbind("resize.spectrum", resize);
            replacer.removeClass("sp-active");
            container.addClass("sp-hidden");
            var colorHasChanged = !tinycolor.equals(get(), colorOnShow);
            if (colorHasChanged) {
                if (clickoutFiresChange && e !== "cancel") {
                    updateOriginalInput(true);
                }
                else {
                    revert();
                }
            }
            callbacks.hide(get());
            boundElement.trigger('hide.spectrum', [ get() ]);
        }
        function revert() {
            set(colorOnShow, true);
        }
        function set(color, ignoreFormatChange) {
            if (tinycolor.equals(color, get())) {
                return;
            }
            var newColor;
            if (!color && allowEmpty) {
                isEmpty = true;
            } else {
                isEmpty = false;
                newColor = tinycolor(color);
                var newHsv = newColor.toHsv();
                currentHue = (newHsv.h % 360) / 360;
                currentSaturation = newHsv.s;
                currentValue = newHsv.v;
                currentAlpha = newHsv.a;
            }
            updateUI();
            if (newColor && newColor.ok && !ignoreFormatChange) {
                currentPreferredFormat = preferredFormat || newColor.format;
            }
        }
        function get(opts) {
            opts = opts || { };
            if (allowEmpty && isEmpty) {
                return null;
            }
            return tinycolor.fromRatio({
                h: currentHue,
                s: currentSaturation,
                v: currentValue,
                a: Math.round(currentAlpha * 100) / 100
            }, { format: opts.format || currentPreferredFormat });
        }
        function isValid() {
            return !textInput.hasClass("sp-validation-error");
        }
        function move() {
            updateUI();
            callbacks.move(get());
            boundElement.trigger('move.spectrum', [ get() ]);
        }
        function updateUI() {
            textInput.removeClass("sp-validation-error");
            updateHelperLocations();
            // Update dragger background color (gradients take care of saturation and value).
            var flatColor = tinycolor.fromRatio({ h: currentHue, s: 1, v: 1 });
            dragger.css("background-color", flatColor.toHexString());
            // Get a format that alpha will be included in (hex and names ignore alpha)
            var format = currentPreferredFormat;
            if (currentAlpha
< 1) {
                if (format === "hex" || format === "hex3" || format === "hex6" || format === "name") {
                    format = "rgb";
                }
            }
            var realColor = get({ format: format }),
                displayColor = '';
             //reset background info for preview element
            previewElement.removeClass("sp-clear-display");
            previewElement.css('background-color', 'transparent');
            if (!realColor && allowEmpty) {
                // Update the replaced elements background with icon indicating no color selection
                previewElement.addClass("sp-clear-display");
            }
            else {
               var realHex = realColor.toHexString(),
                    realRgb = realColor.toRgbString();
                // Update the replaced elements background color (with actual selected color)
                if (rgbaSupport || realColor.alpha === 1) {
                    previewElement.css("background-color", realRgb);
                }
                else {
                    previewElement.css("background-color", "transparent");
                    previewElement.css("filter", realColor.toFilter());
                }
                if (opts.showAlpha) {
                    var rgb = realColor.toRgb();
                    rgb.a = 0;
                    var realAlpha = tinycolor(rgb).toRgbString();
                    var gradient = "linear-gradient(left, " + realAlpha + ", " + realHex + ")";
                    if (IE) {
                        alphaSliderInner.css("filter", tinycolor(realAlpha).toFilter({ gradientType: 1 }, realHex));
                    }
                    else {
                        alphaSliderInner.css("background", "-webkit-" + gradient);
                        alphaSliderInner.css("background", "-moz-" + gradient);
                        alphaSliderInner.css("background", "-ms-" + gradient);
                        alphaSliderInner.css("background", gradient);
                    }
                }
                displayColor = realColor.toString(format);
            }
            // Update the text entry input as it changes happen
            if (opts.showInput) {
                textInput.val(displayColor);
            }
            if (opts.showPalette) {
                drawPalette();
            }
            drawInitial();
        }
        function updateHelperLocations() {
            var s = currentSaturation;
            var v = currentValue;
            if(allowEmpty && isEmpty) {
                //if selected color is empty, hide the helpers
                alphaSlideHelper.hide();
                slideHelper.hide();
                dragHelper.hide();
            }
            else {
                //make sure helpers are visible
                alphaSlideHelper.show();
                slideHelper.show();
                dragHelper.show();
                // Where to show the little circle in that displays your current selected color
                var dragX = s * dragWidth;
                var dragY = dragHeight - (v * dragHeight);
                dragX = Math.max(
                    -dragHelperHeight,
                    Math.min(dragWidth - dragHelperHeight, dragX - dragHelperHeight)
                );
                dragY = Math.max(
                    -dragHelperHeight,
                    Math.min(dragHeight - dragHelperHeight, dragY - dragHelperHeight)
                );
                dragHelper.css({
                    "top": dragY,
                    "left": dragX
                });
                var alphaX = currentAlpha * alphaWidth;
                alphaSlideHelper.css({
                    "left": alphaX - (alphaSlideHelperWidth / 2)
                });
                // Where to show the bar that displays your current selected hue
                var slideY = (currentHue) * slideHeight;
                slideHelper.css({
                    "top": slideY - slideHelperHeight
                });
            }
        }
        function updateOriginalInput(fireCallback) {
            var color = get(),
                displayColor = '',
                hasChanged = !tinycolor.equals(color, colorOnShow);
            if(color) {
                displayColor = color.toString(currentPreferredFormat);
                // Update the selection palette with the current color
                addColorToSelectionPalette(color);
            }
            if (isInput) {
                boundElement.val(displayColor);
            }
            colorOnShow = color;
            if (fireCallback && hasChanged) {
                callbacks.change(color);
                boundElement.trigger('change', [ color ]);
            }
        }
        function reflow() {
            dragWidth = dragger.width();
            dragHeight = dragger.height();
            dragHelperHeight = dragHelper.height();
            slideWidth = slider.width();
            slideHeight = slider.height();
            slideHelperHeight = slideHelper.height();
            alphaWidth = alphaSlider.width();
            alphaSlideHelperWidth = alphaSlideHelper.width();
            if (!flat) {
                container.css("position", "absolute");
                container.offset(getOffset(container, offsetElement));
            }
            updateHelperLocations();
        }
        function destroy() {
            boundElement.show();
            offsetElement.unbind("click.spectrum touchstart.spectrum");
            container.remove();
            replacer.remove();
            spectrums[spect.id] = null;
        }
        function option(optionName, optionValue) {
            if (optionName === undefined) {
                return $.extend({}, opts);
            }
            if (optionValue === undefined) {
                return opts[optionName];
            }
            opts[optionName] = optionValue;
            applyOptions();
        }
        function enable() {
            disabled = false;
            boundElement.attr("disabled", false);
            offsetElement.removeClass("sp-disabled");
        }
        function disable() {
            hide();
            disabled = true;
            boundElement.attr("disabled", true);
            offsetElement.addClass("sp-disabled");
        }
        initialize();
        var spect = {
            show: show,
            hide: hide,
            toggle: toggle,
            reflow: reflow,
            option: option,
            enable: enable,
            disable: disable,
            set: function (c) {
                set(c);
                updateOriginalInput();
            },
            get: get,
            destroy: destroy,
            container: container
        };
        spect.id = spectrums.push(spect) - 1;
        return spect;
    }
    /**
    * checkOffset - get the offset below/above and left/right element depending on screen position
    * Thanks https://github.com/jquery/jquery-ui/blob/master/ui/jquery.ui.datepicker.js
    */
    function getOffset(picker, input) {
        var extraY = 0;
        var dpWidth = picker.outerWidth();
        var dpHeight = picker.outerHeight();
        var inputHeight = input.outerHeight();
        var doc = picker[0].ownerDocument;
        var docElem = doc.documentElement;
        var viewWidth = docElem.clientWidth + $(doc).scrollLeft();
        var viewHeight = docElem.clientHeight + $(doc).scrollTop();
        var offset = input.offset();
        offset.top += inputHeight;
        offset.left -=
            Math.min(offset.left, (offset.left + dpWidth >
 viewWidth && viewWidth >
 dpWidth) ?
            Math.abs(offset.left + dpWidth - viewWidth) : 0);
        offset.top -=
            Math.min(offset.top, ((offset.top + dpHeight >
 viewHeight && viewHeight >
 dpHeight) ?
            Math.abs(dpHeight + inputHeight - extraY) : extraY));
        return offset;
    }
    /**
    * noop - do nothing
    */
    function noop() {
    }
    /**
    * stopPropagation - makes the code only doing this a little easier to read in line
    */
    function stopPropagation(e) {
        e.stopPropagation();
    }
    /**
    * Create a function bound to a given object
    * Thanks to underscore.js
    */
    function bind(func, obj) {
        var slice = Array.prototype.slice;
        var args = slice.call(arguments, 2);
        return function () {
            return func.apply(obj, args.concat(slice.call(arguments)));
        };
    }
    /**
    * Lightweight drag helper.  Handles containment within the element, so that
    * when dragging, the x is within [0,element.width] and y is within [0,element.height]
    */
    function draggable(element, onmove, onstart, onstop) {
        onmove = onmove || function () { };
        onstart = onstart || function () { };
        onstop = onstop || function () { };
        var doc = element.ownerDocument || document;
        var dragging = false;
        var offset = {};
        var maxHeight = 0;
        var maxWidth = 0;
        var hasTouch = ('ontouchstart' in window);
        var duringDragEvents = {};
        duringDragEvents["selectstart"] = prevent;
        duringDragEvents["dragstart"] = prevent;
        duringDragEvents["touchmove mousemove"] = move;
        duringDragEvents["touchend mouseup"] = stop;
        function prevent(e) {
            if (e.stopPropagation) {
                e.stopPropagation();
            }
            if (e.preventDefault) {
                e.preventDefault();
            }
            e.returnValue = false;
        }
        function move(e) {
            if (dragging) {
                // Mouseup happened outside of window
                if (IE && document.documentMode
< 9 && !e.button) {
                    return stop();
                }
                var touches = e.originalEvent.touches;
                var pageX = touches ? touches[0].pageX : e.pageX;
                var pageY = touches ? touches[0].pageY : e.pageY;
                var dragX = Math.max(0, Math.min(pageX - offset.left, maxWidth));
                var dragY = Math.max(0, Math.min(pageY - offset.top, maxHeight));
                if (hasTouch) {
                    // Stop scrolling in iOS
                    prevent(e);
                }
                onmove.apply(element, [dragX, dragY, e]);
            }
        }
        function start(e) {
            var rightclick = (e.which) ? (e.which == 3) : (e.button == 2);
            var touches = e.originalEvent.touches;
            if (!rightclick && !dragging) {
                if (onstart.apply(element, arguments) !== false) {
                    dragging = true;
                    maxHeight = $(element).height();
                    maxWidth = $(element).width();
                    offset = $(element).offset();
                    $(doc).bind(duringDragEvents);
                    $(doc.body).addClass("sp-dragging");
                    if (!hasTouch) {
                        move(e);
                    }
                    prevent(e);
                }
            }
        }
        function stop() {
            if (dragging) {
                $(doc).unbind(duringDragEvents);
                $(doc.body).removeClass("sp-dragging");
                onstop.apply(element, arguments);
            }
            dragging = false;
        }
        $(element).bind("touchstart mousedown", start);
    }
    function throttle(func, wait, debounce) {
        var timeout;
        return function () {
            var context = this, args = arguments;
            var throttler = function () {
                timeout = null;
                func.apply(context, args);
            };
            if (debounce) clearTimeout(timeout);
            if (debounce || !timeout) timeout = setTimeout(throttler, wait);
        };
    }
    function log(){/* jshint -W021 */if(window.console){if(Function.prototype.bind)log=Function.prototype.bind.call(console.log,console);else log=function(){Function.prototype.apply.call(console.log,console,arguments);};log.apply(this,arguments);}}
    /**
    * Define a jQuery plugin
    */
    var dataID = "spectrum.id";
    $.fn.spectrum = function (opts, extra) {
        if (typeof opts == "string") {
            var returnValue = this;
            var args = Array.prototype.slice.call( arguments, 1 );
            this.each(function () {
                var spect = spectrums[$(this).data(dataID)];
                if (spect) {
                    var method = spect[opts];
                    if (!method) {
                        throw new Error( "Spectrum: no such method: '" + opts + "'" );
                    }
                    if (opts == "get") {
                        returnValue = spect.get();
                    }
                    else if (opts == "container") {
                        returnValue = spect.container;
                    }
                    else if (opts == "option") {
                        returnValue = spect.option.apply(spect, args);
                    }
                    else if (opts == "destroy") {
                        spect.destroy();
                        $(this).removeData(dataID);
                    }
                    else {
                        method.apply(spect, args);
                    }
                }
            });
            return returnValue;
        }
        // Initializing a new instance of spectrum
        return this.spectrum("destroy").each(function () {
            var spect = spectrum(this, opts);
            $(this).data(dataID, spect.id);
        });
    };
    $.fn.spectrum.load = true;
    $.fn.spectrum.loadOpts = {};
    $.fn.spectrum.draggable = draggable;
    $.fn.spectrum.defaults = defaultOpts;
    $.spectrum = { };
    $.spectrum.localization = { };
    $.spectrum.palettes = { };
    $.fn.spectrum.processNativeColorInputs = function () {
        if (!inputTypeColorSupport) {
            $("input[type=color]").spectrum({
                preferredFormat: "hex6"
            });
        }
    };
    // TinyColor v0.9.16
    // https://github.com/bgrins/TinyColor
    // 2013-08-10, Brian Grinstead, MIT License
    (function() {
    var trimLeft = /^[\s,#]+/,
        trimRight = /\s+$/,
        tinyCounter = 0,
        math = Math,
        mathRound = math.round,
        mathMin = math.min,
        mathMax = math.max,
        mathRandom = math.random;
    function tinycolor (color, opts) {
        color = (color) ? color : '';
        opts = opts || { };
        // If input is already a tinycolor, return itself
        if (typeof color == "object" && color.hasOwnProperty("_tc_id")) {
           return color;
        }
        var rgb = inputToRGB(color);
        var r = rgb.r,
            g = rgb.g,
            b = rgb.b,
            a = rgb.a,
            roundA = mathRound(100*a) / 100,
            format = opts.format || rgb.format;
        // Don't let the range of [0,255] come back in [0,1].
        // Potentially lose a little bit of precision here, but will fix issues where
        // .5 gets interpreted as half of the total, instead of half of 1
        // If it was supposed to be 128, this was already taken care of by `inputToRgb`
        if (r
< 1) { r = mathRound(r); }
        if (g
< 1) { g = mathRound(g); }
        if (b
< 1) { b = mathRound(b); }
        return {
            ok: rgb.ok,
            format: format,
            _tc_id: tinyCounter++,
            alpha: a,
            getAlpha: function() {
                return a;
            },
            setAlpha: function(value) {
                a = boundAlpha(value);
                roundA = mathRound(100*a) / 100;
            },
            toHsv: function() {
                var hsv = rgbToHsv(r, g, b);
                return { h: hsv.h * 360, s: hsv.s, v: hsv.v, a: a };
            },
            toHsvString: function() {
                var hsv = rgbToHsv(r, g, b);
                var h = mathRound(hsv.h * 360), s = mathRound(hsv.s * 100), v = mathRound(hsv.v * 100);
                return (a == 1) ?
                  "hsv("  + h + ", " + s + "%, " + v + "%)" :
                  "hsva(" + h + ", " + s + "%, " + v + "%, "+ roundA + ")";
            },
            toHsl: function() {
                var hsl = rgbToHsl(r, g, b);
                return { h: hsl.h * 360, s: hsl.s, l: hsl.l, a: a };
            },
            toHslString: function() {
                var hsl = rgbToHsl(r, g, b);
                var h = mathRound(hsl.h * 360), s = mathRound(hsl.s * 100), l = mathRound(hsl.l * 100);
                return (a == 1) ?
                  "hsl("  + h + ", " + s + "%, " + l + "%)" :
                  "hsla(" + h + ", " + s + "%, " + l + "%, "+ roundA + ")";
            },
            toHex: function(allow3Char) {
                return rgbToHex(r, g, b, allow3Char);
            },
            toHexString: function(allow3Char) {
                return '#' + rgbToHex(r, g, b, allow3Char);
            },
            toRgb: function() {
                return { r: mathRound(r), g: mathRound(g), b: mathRound(b), a: a };
            },
            toRgbString: function() {
                return (a == 1) ?
                  "rgb("  + mathRound(r) + ", " + mathRound(g) + ", " + mathRound(b) + ")" :
                  "rgba(" + mathRound(r) + ", " + mathRound(g) + ", " + mathRound(b) + ", " + roundA + ")";
            },
            toPercentageRgb: function() {
                return { r: mathRound(bound01(r, 255) * 100) + "%", g: mathRound(bound01(g, 255) * 100) + "%", b: mathRound(bound01(b, 255) * 100) + "%", a: a };
            },
            toPercentageRgbString: function() {
                return (a == 1) ?
                  "rgb("  + mathRound(bound01(r, 255) * 100) + "%, " + mathRound(bound01(g, 255) * 100) + "%, " + mathRound(bound01(b, 255) * 100) + "%)" :
                  "rgba(" + mathRound(bound01(r, 255) * 100) + "%, " + mathRound(bound01(g, 255) * 100) + "%, " + mathRound(bound01(b, 255) * 100) + "%, " + roundA + ")";
            },
            toName: function() {
                if (a === 0) {
                    return "transparent";
                }
                return hexNames[rgbToHex(r, g, b, true)] || false;
            },
            toFilter: function(secondColor) {
                var hex = rgbToHex(r, g, b);
                var secondHex = hex;
                var alphaHex = Math.round(parseFloat(a) * 255).toString(16);
                var secondAlphaHex = alphaHex;
                var gradientType = opts && opts.gradientType ? "GradientType = 1, " : "";
                if (secondColor) {
                    var s = tinycolor(secondColor);
                    secondHex = s.toHex();
                    secondAlphaHex = Math.round(parseFloat(s.alpha) * 255).toString(16);
                }
                return "progid:DXImageTransform.Microsoft.gradient("+gradientType+"startColorstr=#" + pad2(alphaHex) + hex + ",endColorstr=#" + pad2(secondAlphaHex) + secondHex + ")";
            },
            toString: function(format) {
                var formatSet = !!format;
                format = format || this.format;
                var formattedString = false;
                var hasAlphaAndFormatNotSet = !formatSet && a
< 1 && a >
 0;
                var formatWithAlpha = hasAlphaAndFormatNotSet && (format === "hex" || format === "hex6" || format === "hex3" || format === "name");
                if (format === "rgb") {
                    formattedString = this.toRgbString();
                }
                if (format === "prgb") {
                    formattedString = this.toPercentageRgbString();
                }
                if (format === "hex" || format === "hex6") {
                    formattedString = this.toHexString();
                }
                if (format === "hex3") {
                    formattedString = this.toHexString(true);
                }
                if (format === "name") {
                    formattedString = this.toName();
                }
                if (format === "hsl") {
                    formattedString = this.toHslString();
                }
                if (format === "hsv") {
                    formattedString = this.toHsvString();
                }
                if (formatWithAlpha) {
                    return this.toRgbString();
                }
                return formattedString || this.toHexString();
            }
        };
    }
    // If input is an object, force 1 into "1.0" to handle ratios properly
    // String input requires "1.0" as input, so 1 will be treated as 1
    tinycolor.fromRatio = function(color, opts) {
        if (typeof color == "object") {
            var newColor = {};
            for (var i in color) {
                if (color.hasOwnProperty(i)) {
                    if (i === "a") {
                        newColor[i] = color[i];
                    }
                    else {
                        newColor[i] = convertToPercentage(color[i]);
                    }
                }
            }
            color = newColor;
        }
        return tinycolor(color, opts);
    };
    // Given a string or object, convert that input to RGB
    // Possible string inputs:
    //
    //     "red"
    //     "#f00" or "f00"
    //     "#ff0000" or "ff0000"
    //     "rgb 255 0 0" or "rgb (255, 0, 0)"
    //     "rgb 1.0 0 0" or "rgb (1, 0, 0)"
    //     "rgba (255, 0, 0, 1)" or "rgba 255, 0, 0, 1"
    //     "rgba (1.0, 0, 0, 1)" or "rgba 1.0, 0, 0, 1"
    //     "hsl(0, 100%, 50%)" or "hsl 0 100% 50%"
    //     "hsla(0, 100%, 50%, 1)" or "hsla 0 100% 50%, 1"
    //     "hsv(0, 100%, 100%)" or "hsv 0 100% 100%"
    //
    function inputToRGB(color) {
        var rgb = { r: 0, g: 0, b: 0 };
        var a = 1;
        var ok = false;
        var format = false;
        if (typeof color == "string") {
            color = stringInputToObject(color);
        }
        if (typeof color == "object") {
            if (color.hasOwnProperty("r") && color.hasOwnProperty("g") && color.hasOwnProperty("b")) {
                rgb = rgbToRgb(color.r, color.g, color.b);
                ok = true;
                format = String(color.r).substr(-1) === "%" ? "prgb" : "rgb";
            }
            else if (color.hasOwnProperty("h") && color.hasOwnProperty("s") && color.hasOwnProperty("v")) {
                color.s = convertToPercentage(color.s);
                color.v = convertToPercentage(color.v);
                rgb = hsvToRgb(color.h, color.s, color.v);
                ok = true;
                format = "hsv";
            }
            else if (color.hasOwnProperty("h") && color.hasOwnProperty("s") && color.hasOwnProperty("l")) {
                color.s = convertToPercentage(color.s);
                color.l = convertToPercentage(color.l);
                rgb = hslToRgb(color.h, color.s, color.l);
                ok = true;
                format = "hsl";
            }
            if (color.hasOwnProperty("a")) {
                a = color.a;
            }
        }
        a = boundAlpha(a);
        return {
            ok: ok,
            format: color.format || format,
            r: mathMin(255, mathMax(rgb.r, 0)),
            g: mathMin(255, mathMax(rgb.g, 0)),
            b: mathMin(255, mathMax(rgb.b, 0)),
            a: a
        };
    }
    // Conversion Functions
    // --------------------
    // `rgbToHsl`, `rgbToHsv`, `hslToRgb`, `hsvToRgb` modified from:
    //
<http://mjijackson.com/2008/02/rgb-to-hsl-and-rgb-to-hsv-color-model-conversion-algorithms-in-javascript>
    // `rgbToRgb`
    // Handle bounds / percentage checking to conform to CSS color spec
    //
<http://www.w3.org/TR/css3-color/>
    // *Assumes:* r, g, b in [0, 255] or [0, 1]
    // *Returns:* { r, g, b } in [0, 255]
    function rgbToRgb(r, g, b){
        return {
            r: bound01(r, 255) * 255,
            g: bound01(g, 255) * 255,
            b: bound01(b, 255) * 255
        };
    }
    // `rgbToHsl`
    // Converts an RGB color value to HSL.
    // *Assumes:* r, g, and b are contained in [0, 255] or [0, 1]
    // *Returns:* { h, s, l } in [0,1]
    function rgbToHsl(r, g, b) {
        r = bound01(r, 255);
        g = bound01(g, 255);
        b = bound01(b, 255);
        var max = mathMax(r, g, b), min = mathMin(r, g, b);
        var h, s, l = (max + min) / 2;
        if(max == min) {
            h = s = 0; // achromatic
        }
        else {
            var d = max - min;
            s = l >
 0.5 ? d / (2 - max - min) : d / (max + min);
            switch(max) {
                case r: h = (g - b) / d + (g
< b ? 6 : 0); break;
                case g: h = (b - r) / d + 2; break;
                case b: h = (r - g) / d + 4; break;
            }
            h /= 6;
        }
        return { h: h, s: s, l: l };
    }
    // `hslToRgb`
    // Converts an HSL color value to RGB.
    // *Assumes:* h is contained in [0, 1] or [0, 360] and s and l are contained [0, 1] or [0, 100]
    // *Returns:* { r, g, b } in the set [0, 255]
    function hslToRgb(h, s, l) {
        var r, g, b;
        h = bound01(h, 360);
        s = bound01(s, 100);
        l = bound01(l, 100);
        function hue2rgb(p, q, t) {
            if(t
< 0) t += 1;
            if(t >
 1) t -= 1;
            if(t
< 1/6) return p + (q - p) * 6 * t;
            if(t
< 1/2) return q;
            if(t
< 2/3) return p + (q - p) * (2/3 - t) * 6;
            return p;
        }
        if(s === 0) {
            r = g = b = l; // achromatic
        }
        else {
            var q = l
< 0.5 ? l * (1 + s) : l + s - l * s;
            var p = 2 * l - q;
            r = hue2rgb(p, q, h + 1/3);
            g = hue2rgb(p, q, h);
            b = hue2rgb(p, q, h - 1/3);
        }
        return { r: r * 255, g: g * 255, b: b * 255 };
    }
    // `rgbToHsv`
    // Converts an RGB color value to HSV
    // *Assumes:* r, g, and b are contained in the set [0, 255] or [0, 1]
    // *Returns:* { h, s, v } in [0,1]
    function rgbToHsv(r, g, b) {
        r = bound01(r, 255);
        g = bound01(g, 255);
        b = bound01(b, 255);
        var max = mathMax(r, g, b), min = mathMin(r, g, b);
        var h, s, v = max;
        var d = max - min;
        s = max === 0 ? 0 : d / max;
        if(max == min) {
            h = 0; // achromatic
        }
        else {
            switch(max) {
                case r: h = (g - b) / d + (g
< b ? 6 : 0); break;
                case g: h = (b - r) / d + 2; break;
                case b: h = (r - g) / d + 4; break;
            }
            h /= 6;
        }
        return { h: h, s: s, v: v };
    }
    // `hsvToRgb`
    // Converts an HSV color value to RGB.
    // *Assumes:* h is contained in [0, 1] or [0, 360] and s and v are contained in [0, 1] or [0, 100]
    // *Returns:* { r, g, b } in the set [0, 255]
     function hsvToRgb(h, s, v) {
        h = bound01(h, 360) * 6;
        s = bound01(s, 100);
        v = bound01(v, 100);
        var i = math.floor(h),
            f = h - i,
            p = v * (1 - s),
            q = v * (1 - f * s),
            t = v * (1 - (1 - f) * s),
            mod = i % 6,
            r = [v, q, p, p, t, v][mod],
            g = [t, v, v, q, p, p][mod],
            b = [p, p, t, v, v, q][mod];
        return { r: r * 255, g: g * 255, b: b * 255 };
    }
    // `rgbToHex`
    // Converts an RGB color to hex
    // Assumes r, g, and b are contained in the set [0, 255]
    // Returns a 3 or 6 character hex
    function rgbToHex(r, g, b, allow3Char) {
        var hex = [
            pad2(mathRound(r).toString(16)),
            pad2(mathRound(g).toString(16)),
            pad2(mathRound(b).toString(16))
        ];
        // Return a 3 character hex if possible
        if (allow3Char && hex[0].charAt(0) == hex[0].charAt(1) && hex[1].charAt(0) == hex[1].charAt(1) && hex[2].charAt(0) == hex[2].charAt(1)) {
            return hex[0].charAt(0) + hex[1].charAt(0) + hex[2].charAt(0);
        }
        return hex.join("");
    }
    // `equals`
    // Can be called with any tinycolor input
    tinycolor.equals = function (color1, color2) {
        if (!color1 || !color2) { return false; }
        return tinycolor(color1).toRgbString() == tinycolor(color2).toRgbString();
    };
    tinycolor.random = function() {
        return tinycolor.fromRatio({
            r: mathRandom(),
            g: mathRandom(),
            b: mathRandom()
        });
    };
    // Modification Functions
    // ----------------------
    // Thanks to less.js for some of the basics here
    //
<https://github.com/cloudhead/less.js/blob/master/lib/less/functions.js>
    tinycolor.desaturate = function (color, amount) {
        amount = (amount === 0) ? 0 : (amount || 10);
        var hsl = tinycolor(color).toHsl();
        hsl.s -= amount / 100;
        hsl.s = clamp01(hsl.s);
        return tinycolor(hsl);
    };
    tinycolor.saturate = function (color, amount) {
        amount = (amount === 0) ? 0 : (amount || 10);
        var hsl = tinycolor(color).toHsl();
        hsl.s += amount / 100;
        hsl.s = clamp01(hsl.s);
        return tinycolor(hsl);
    };
    tinycolor.greyscale = function(color) {
        return tinycolor.desaturate(color, 100);
    };
    tinycolor.lighten = function(color, amount) {
        amount = (amount === 0) ? 0 : (amount || 10);
        var hsl = tinycolor(color).toHsl();
        hsl.l += amount / 100;
        hsl.l = clamp01(hsl.l);
        return tinycolor(hsl);
    };
    tinycolor.darken = function (color, amount) {
        amount = (amount === 0) ? 0 : (amount || 10);
        var hsl = tinycolor(color).toHsl();
        hsl.l -= amount / 100;
        hsl.l = clamp01(hsl.l);
        return tinycolor(hsl);
    };
    tinycolor.complement = function(color) {
        var hsl = tinycolor(color).toHsl();
        hsl.h = (hsl.h + 180) % 360;
        return tinycolor(hsl);
    };
    // Combination Functions
    // ---------------------
    // Thanks to jQuery xColor for some of the ideas behind these
    //
<https://github.com/infusion/jQuery-xcolor/blob/master/jquery.xcolor.js>
    tinycolor.triad = function(color) {
        var hsl = tinycolor(color).toHsl();
        var h = hsl.h;
        return [
            tinycolor(color),
            tinycolor({ h: (h + 120) % 360, s: hsl.s, l: hsl.l }),
            tinycolor({ h: (h + 240) % 360, s: hsl.s, l: hsl.l })
        ];
    };
    tinycolor.tetrad = function(color) {
        var hsl = tinycolor(color).toHsl();
        var h = hsl.h;
        return [
            tinycolor(color),
            tinycolor({ h: (h + 90) % 360, s: hsl.s, l: hsl.l }),
            tinycolor({ h: (h + 180) % 360, s: hsl.s, l: hsl.l }),
            tinycolor({ h: (h + 270) % 360, s: hsl.s, l: hsl.l })
        ];
    };
    tinycolor.splitcomplement = function(color) {
        var hsl = tinycolor(color).toHsl();
        var h = hsl.h;
        return [
            tinycolor(color),
            tinycolor({ h: (h + 72) % 360, s: hsl.s, l: hsl.l}),
            tinycolor({ h: (h + 216) % 360, s: hsl.s, l: hsl.l})
        ];
    };
    tinycolor.analogous = function(color, results, slices) {
        results = results || 6;
        slices = slices || 30;
        var hsl = tinycolor(color).toHsl();
        var part = 360 / slices;
        var ret = [tinycolor(color)];
        for (hsl.h = ((hsl.h - (part * results >
>
 1)) + 720) % 360; --results; ) {
            hsl.h = (hsl.h + part) % 360;
            ret.push(tinycolor(hsl));
        }
        return ret;
    };
    tinycolor.monochromatic = function(color, results) {
        results = results || 6;
        var hsv = tinycolor(color).toHsv();
        var h = hsv.h, s = hsv.s, v = hsv.v;
        var ret = [];
        var modification = 1 / results;
        while (results--) {
            ret.push(tinycolor({ h: h, s: s, v: v}));
            v = (v + modification) % 1;
        }
        return ret;
    };
    // Readability Functions
    // ---------------------
    //
<http://www.w3.org/TR/AERT#color-contrast>
    // `readability`
    // Analyze the 2 colors and returns an object with the following properties:
    //    `brightness`: difference in brightness between the two colors
    //    `color`: difference in color/hue between the two colors
    tinycolor.readability = function(color1, color2) {
        var a = tinycolor(color1).toRgb();
        var b = tinycolor(color2).toRgb();
        var brightnessA = (a.r * 299 + a.g * 587 + a.b * 114) / 1000;
        var brightnessB = (b.r * 299 + b.g * 587 + b.b * 114) / 1000;
        var colorDiff = (
            Math.max(a.r, b.r) - Math.min(a.r, b.r) +
            Math.max(a.g, b.g) - Math.min(a.g, b.g) +
            Math.max(a.b, b.b) - Math.min(a.b, b.b)
        );
        return {
            brightness: Math.abs(brightnessA - brightnessB),
            color: colorDiff
        };
    };
    // `readable`
    // http://www.w3.org/TR/AERT#color-contrast
    // Ensure that foreground and background color combinations provide sufficient contrast.
    // *Example*
    //    tinycolor.readable("#000", "#111") =>
 false
    tinycolor.readable = function(color1, color2) {
        var readability = tinycolor.readability(color1, color2);
        return readability.brightness >
 125 && readability.color >
 500;
    };
    // `mostReadable`
    // Given a base color and a list of possible foreground or background
    // colors for that base, returns the most readable color.
    // *Example*
    //    tinycolor.mostReadable("#123", ["#fff", "#000"]) =>
 "#000"
    tinycolor.mostReadable = function(baseColor, colorList) {
        var bestColor = null;
        var bestScore = 0;
        var bestIsReadable = false;
        for (var i=0; i
< colorList.length; i++) {
            // We normalize both around the "acceptable" breaking point,
            // but rank brightness constrast higher than hue.
            var readability = tinycolor.readability(baseColor, colorList[i]);
            var readable = readability.brightness >
 125 && readability.color >
 500;
            var score = 3 * (readability.brightness / 125) + (readability.color / 500);
            if ((readable && ! bestIsReadable) ||
                (readable && bestIsReadable && score >
 bestScore) ||
                ((! readable) && (! bestIsReadable) && score >
 bestScore)) {
                bestIsReadable = readable;
                bestScore = score;
                bestColor = tinycolor(colorList[i]);
            }
        }
        return bestColor;
    };
    // Big List of Colors
    // ------------------
    //
<http://www.w3.org/TR/css3-color/#svg-color>
    var names = tinycolor.names = {
        aliceblue: "f0f8ff",
        antiquewhite: "faebd7",
        aqua: "0ff",
        aquamarine: "7fffd4",
        azure: "f0ffff",
        beige: "f5f5dc",
        bisque: "ffe4c4",
        black: "000",
        blanchedalmond: "ffebcd",
        blue: "00f",
        blueviolet: "8a2be2",
        brown: "a52a2a",
        burlywood: "deb887",
        burntsienna: "ea7e5d",
        cadetblue: "5f9ea0",
        chartreuse: "7fff00",
        chocolate: "d2691e",
        coral: "ff7f50",
        cornflowerblue: "6495ed",
        cornsilk: "fff8dc",
        crimson: "dc143c",
        cyan: "0ff",
        darkblue: "00008b",
        darkcyan: "008b8b",
        darkgoldenrod: "b8860b",
        darkgray: "a9a9a9",
        darkgreen: "006400",
        darkgrey: "a9a9a9",
        darkkhaki: "bdb76b",
        darkmagenta: "8b008b",
        darkolivegreen: "556b2f",
        darkorange: "ff8c00",
        darkorchid: "9932cc",
        darkred: "8b0000",
        darksalmon: "e9967a",
        darkseagreen: "8fbc8f",
        darkslateblue: "483d8b",
        darkslategray: "2f4f4f",
        darkslategrey: "2f4f4f",
        darkturquoise: "00ced1",
        darkviolet: "9400d3",
        deeppink: "ff1493",
        deepskyblue: "00bfff",
        dimgray: "696969",
        dimgrey: "696969",
        dodgerblue: "1e90ff",
        firebrick: "b22222",
        floralwhite: "fffaf0",
        forestgreen: "228b22",
        fuchsia: "f0f",
        gainsboro: "dcdcdc",
        ghostwhite: "f8f8ff",
        gold: "ffd700",
        goldenrod: "daa520",
        gray: "808080",
        green: "008000",
        greenyellow: "adff2f",
        grey: "808080",
        honeydew: "f0fff0",
        hotpink: "ff69b4",
        indianred: "cd5c5c",
        indigo: "4b0082",
        ivory: "fffff0",
        khaki: "f0e68c",
        lavender: "e6e6fa",
        lavenderblush: "fff0f5",
        lawngreen: "7cfc00",
        lemonchiffon: "fffacd",
        lightblue: "add8e6",
        lightcoral: "f08080",
        lightcyan: "e0ffff",
        lightgoldenrodyellow: "fafad2",
        lightgray: "d3d3d3",
        lightgreen: "90ee90",
        lightgrey: "d3d3d3",
        lightpink: "ffb6c1",
        lightsalmon: "ffa07a",
        lightseagreen: "20b2aa",
        lightskyblue: "87cefa",
        lightslategray: "789",
        lightslategrey: "789",
        lightsteelblue: "b0c4de",
        lightyellow: "ffffe0",
        lime: "0f0",
        limegreen: "32cd32",
        linen: "faf0e6",
        magenta: "f0f",
        maroon: "800000",
        mediumaquamarine: "66cdaa",
        mediumblue: "0000cd",
        mediumorchid: "ba55d3",
        mediumpurple: "9370db",
        mediumseagreen: "3cb371",
        mediumslateblue: "7b68ee",
        mediumspringgreen: "00fa9a",
        mediumturquoise: "48d1cc",
        mediumvioletred: "c71585",
        midnightblue: "191970",
        mintcream: "f5fffa",
        mistyrose: "ffe4e1",
        moccasin: "ffe4b5",
        navajowhite: "ffdead",
        navy: "000080",
        oldlace: "fdf5e6",
        olive: "808000",
        olivedrab: "6b8e23",
        orange: "ffa500",
        orangered: "ff4500",
        orchid: "da70d6",
        palegoldenrod: "eee8aa",
        palegreen: "98fb98",
        paleturquoise: "afeeee",
        palevioletred: "db7093",
        papayawhip: "ffefd5",
        peachpuff: "ffdab9",
        peru: "cd853f",
        pink: "ffc0cb",
        plum: "dda0dd",
        powderblue: "b0e0e6",
        purple: "800080",
        red: "f00",
        rosybrown: "bc8f8f",
        royalblue: "4169e1",
        saddlebrown: "8b4513",
        salmon: "fa8072",
        sandybrown: "f4a460",
        seagreen: "2e8b57",
        seashell: "fff5ee",
        sienna: "a0522d",
        silver: "c0c0c0",
        skyblue: "87ceeb",
        slateblue: "6a5acd",
        slategray: "708090",
        slategrey: "708090",
        snow: "fffafa",
        springgreen: "00ff7f",
        steelblue: "4682b4",
        tan: "d2b48c",
        teal: "008080",
        thistle: "d8bfd8",
        tomato: "ff6347",
        turquoise: "40e0d0",
        violet: "ee82ee",
        wheat: "f5deb3",
        white: "fff",
        whitesmoke: "f5f5f5",
        yellow: "ff0",
        yellowgreen: "9acd32"
    };
    // Make it easy to access colors via `hexNames[hex]`
    var hexNames = tinycolor.hexNames = flip(names);
    // Utilities
    // ---------
    // `{ 'name1': 'val1' }` becomes `{ 'val1': 'name1' }`
    function flip(o) {
        var flipped = { };
        for (var i in o) {
            if (o.hasOwnProperty(i)) {
                flipped[o[i]] = i;
            }
        }
        return flipped;
    }
    // Return a valid alpha value [0,1] with all invalid values being set to 1
    function boundAlpha(a) {
        a = parseFloat(a);
        if (isNaN(a) || a
< 0 || a >
 1) {
            a = 1;
        }
        return a;
    }
    // Take input from [0, n] and return it as [0, 1]
    function bound01(n, max) {
        if (isOnePointZero(n)) { n = "100%"; }
        var processPercent = isPercentage(n);
        n = mathMin(max, mathMax(0, parseFloat(n)));
        // Automatically convert percentage into number
        if (processPercent) {
            n = parseInt(n * max, 10) / 100;
        }
        // Handle floating point rounding errors
        if ((math.abs(n - max)
< 0.000001)) {
            return 1;
        }
        // Convert into [0, 1] range if it isn't already
        return (n % max) / parseFloat(max);
    }
    // Force a number between 0 and 1
    function clamp01(val) {
        return mathMin(1, mathMax(0, val));
    }
    // Parse an integer into hex
    function parseHex(val) {
        return parseInt(val, 16);
    }
    // Need to handle 1.0 as 100%, since once it is a number, there is no difference between it and 1
    //
<http://stackoverflow.com/questions/7422072/javascript-how-to-detect-number-as-a-decimal-including-1-0>
    function isOnePointZero(n) {
        return typeof n == "string" && n.indexOf('.') != -1 && parseFloat(n) === 1;
    }
    // Check to see if string passed in is a percentage
    function isPercentage(n) {
        return typeof n === "string" && n.indexOf('%') != -1;
    }
    // Force a hex value to have 2 characters
    function pad2(c) {
        return c.length == 1 ? '0' + c : '' + c;
    }
    // Replace a decimal with it's percentage value
    function convertToPercentage(n) {
        if (n
<= 1) {
            n = (n * 100) + "%";
        }
        return n;
    }
    var matchers = (function() {
        //
<http://www.w3.org/TR/css3-values/#integers>
        var CSS_INTEGER = "[-\\+]?\\d+%?";
        //
<http://www.w3.org/TR/css3-values/#number-value>
        var CSS_NUMBER = "[-\\+]?\\d*\\.\\d+%?";
        // Allow positive/negative integer/number.  Don't capture the either/or, just the entire outcome.
        var CSS_UNIT = "(?:" + CSS_NUMBER + ")|(?:" + CSS_INTEGER + ")";
        // Actual matching.
        // Parentheses and commas are optional, but not required.
        // Whitespace can take the place of commas or opening paren
        var PERMISSIVE_MATCH3 = "[\\s|\\(]+(" + CSS_UNIT + ")[,|\\s]+(" + CSS_UNIT + ")[,|\\s]+(" + CSS_UNIT + ")\\s*\\)?";
        var PERMISSIVE_MATCH4 = "[\\s|\\(]+(" + CSS_UNIT + ")[,|\\s]+(" + CSS_UNIT + ")[,|\\s]+(" + CSS_UNIT + ")[,|\\s]+(" + CSS_UNIT + ")\\s*\\)?";
        return {
            rgb: new RegExp("rgb" + PERMISSIVE_MATCH3),
            rgba: new RegExp("rgba" + PERMISSIVE_MATCH4),
            hsl: new RegExp("hsl" + PERMISSIVE_MATCH3),
            hsla: new RegExp("hsla" + PERMISSIVE_MATCH4),
            hsv: new RegExp("hsv" + PERMISSIVE_MATCH3),
            hex3: /^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,
            hex6: /^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/
        };
    })();
    // `stringInputToObject`
    // Permissive string parsing.  Take in a number of formats, and output an object
    // based on detected format.  Returns `{ r, g, b }` or `{ h, s, l }` or `{ h, s, v}`
    function stringInputToObject(color) {
        color = color.replace(trimLeft,'').replace(trimRight, '').toLowerCase();
        var named = false;
        if (names[color]) {
            color = names[color];
            named = true;
        }
        else if (color == 'transparent') {
            return { r: 0, g: 0, b: 0, a: 0, format: "name" };
        }
        // Try to match string input using regular expressions.
        // Keep most of the number bounding out of this function - don't worry about [0,1] or [0,100] or [0,360]
        // Just return an object and let the conversion functions handle that.
        // This way the result will be the same whether the tinycolor is initialized with string or object.
        var match;
        if ((match = matchers.rgb.exec(color))) {
            return { r: match[1], g: match[2], b: match[3] };
        }
        if ((match = matchers.rgba.exec(color))) {
            return { r: match[1], g: match[2], b: match[3], a: match[4] };
        }
        if ((match = matchers.hsl.exec(color))) {
            return { h: match[1], s: match[2], l: match[3] };
        }
        if ((match = matchers.hsla.exec(color))) {
            return { h: match[1], s: match[2], l: match[3], a: match[4] };
        }
        if ((match = matchers.hsv.exec(color))) {
            return { h: match[1], s: match[2], v: match[3] };
        }
        if ((match = matchers.hex6.exec(color))) {
            return {
                r: parseHex(match[1]),
                g: parseHex(match[2]),
                b: parseHex(match[3]),
                format: named ? "name" : "hex"
            };
        }
        if ((match = matchers.hex3.exec(color))) {
            return {
                r: parseHex(match[1] + '' + match[1]),
                g: parseHex(match[2] + '' + match[2]),
                b: parseHex(match[3] + '' + match[3]),
                format: named ? "name" : "hex"
            };
        }
        return false;
    }
    // Expose tinycolor to window, does not need to run in non-browser context.
    window.tinycolor = tinycolor;
    })();
    $(function () {
        if ($.fn.spectrum.load) {
            $.fn.spectrum.processNativeColorInputs();
        }
    });
})(window, jQuery);
  try { console.log('done loading leaflet.draw JS'); } catch(e) {}
  window.plugin.drawTools.boot();
  $('head').append('
<style>
/* ================================================================== */\n/* Toolbars\n/* ================================================================== */\n\n.leaflet-draw-section {\n position: relative;\n}\n\n.leaflet-draw-toolbar {\n margin-top: 12px;\n}\n\n.leaflet-draw-toolbar-top {\n   margin-top: 0;\n}\n\n.leaflet-draw-toolbar-notop a:first-child {\n  border-top-right-radius: 0;\n}\n\n.leaflet-draw-toolbar-nobottom a:last-child {\n   border-bottom-right-radius: 0;\n}\n\n.leaflet-draw-toolbar a {\n    background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAANIAAAAeCAYAAABZs0CNAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAtVJREFUeNrsmlFy2jAQhkWG93CD0hM0PUHhhdfADeAECScInAA4QblBeOYFcoK6Jyg5QdwTtLvp747GhNgmWttx/m/GY42s8Uqy/l1JlnOEEEIIIYQQQgghhBBCCCGEHNNiF5C6MxgMOnIbb7fbpcG7Z3K7S2XPxdasyHvaASv0J0lLJVpGDb6Ra4OGHho+eLpyG8rVQVasbbduNwat2u0i6wC7sbHNq3S+2Nzj2U6fS/qL5E0MqvBfOBhn1UQkNPZJBaSCCi0keedYbt9T2WtLQfmO4TWMnMat3BYnHk8tPDPs6mC+90TkPDGNxG5kICC113vhsX7fKdLaFzoGJlKHtVEUyhSZqZB8j2ExuE6IyFxQVQkpQ0RmYsJ3/AERafRZ4dENoqL279eQkUls7iCiA64EFewc40rp6/jSCFXXGUQ7oIi08f3AHZ0lIgdPNW7Ceg/TuUWOogspG3qa50/n+kn0UTuewIZwXKF4FpHY+pzhnHtSZlPC2uisaPQmIdVERE1jWLBsyKjU9aJs5KflWxyVCcgmQ0STVLQKujYK9aKLOooIFBFR1BAhdYzKnrNWOkoLlwbmfmeIKPKmeLXloqYicgWnEHFDhPSpQtt+H+506oPpjz+IH43rcOuLCBsLQ0unUYmQShRREnbzvvuhIUL6WaHzWKei3R2uzpnO7S0E2Z2rpZBKFpHDQnr1wSLSxqhsnv6OM9YMc8vvjTrMdBf0vYkot5CwFfxUlog8ljlF0og1EpzHNEfRqdH/s+WJhf0h8MaGz3We59jRrC3tAh+5BUGVJaJnLyk2V+71bcrY2e3qVCGmJXbJSv8hi/4eYebhn6gYGX3zvVw9/E96aXr+Dc57X/eTLLn+vVgf/8lh/5f7t/W6h2gekY7KEnUFbe66Co4IwXZywsE5gxMNqeXCqZMNvtiCCzn0fyRCCCGEEEIIIYQQQgghhBBCCCFG/BVgAMuWWtfqVjkMAAAAAElFTkSuQmCC);\n    background-repeat: no-repeat;\n}\n\n.leaflet-retina .leaflet-draw-toolbar a {\n background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAaQAAAA8CAYAAAApDs6vAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAABV1JREFUeNrs3d1R20AUhmHBUIBLcCqI6UDccA0VYFcAqQBTAbgCQwVwzQ1OBTgVxCU4FZA9ydGMoki2flZmz+p9ZjTBxNaw7M+3KwkpSQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALo54lcAAMN1fn7+Ued9r6+vvefFCdUBAF4G9on7581t39zg/chvJIJAqkrrQ6SzxzJM3T9Lt0mjfHI/+4qmBgwijEbS993rxFooVY2xdVdQrJDCbZhLfSnBNHXfk0C6I5iiquNrt6VuGxf+e+O2VUwTEVfekbblK7dNCv+9lrLK5MuVdxtBOSc13rp1ZV3nPjfOhVHGZCh9tqMAG8VHPq2Lrw3NksqYDybfsyVjK9+xTjbSmh+Rep65Mm4M1/eFlnm0b5DWsr4YK5/U6a3bLmqUMTMrBo3bz1JDO//7OMsHV2x9t48+fBzggB7Dkr2KDGRv7r2ypQmsDczvDcIoq+93/azFMssA+1xzoJb3POtnLPXZdw2SxmEkYaarKhmUZ8nfQ/RBhhErJM8Desgz6ZphVDWDfrK0rB/iCkkD5bnjbi4trR52lFkG22ygnVS0+eDLqiuj94Z9Nh9GWZ/faPhs9fv32qcJI6uBVGdAD3Xg6hBGedKo7ywE09ACqeXAlVQM5KcWDt/prP9nSZmljc4L75XXtyVl/RLyOaWSQ2x/JofaF0vrLwuZkj6/zocS2jsJoGGUDegmlryewkjIoCcnQW9dmb/QLIOy9FC/ie5D9nVmoMzTOmGkE4q5nLwvhFJ2EcRDwGXMH0ZduXKcdejz2YVMl0M6ytHHZPL4k38xhNH/wYRw6jhNmp0z2ic1cp70qmR1MN8xMM213+7aR2jy/fauY5/f1t0HAg0kwqjUhiYZ9MDsw7WBcpdd2r3Pes8+Qrbu0OfNXsAgK5z8Kqfp62gCyXgYjXsKIwIpPKmRfaLbwLz1EUZ6XgqWAslyGKm6l8H2MlPDQY2N7PPQK6a27zGnYRhN6TKGAimCMMp+3r78okkiQCO9mq6qX897nKQRRgQSYbRDnycvVzRJBKCsP96WhVLFZd+xrPbrnjMijDw5yGXfEYWRHG9e6b3pUmOrL6DJxGhSEUrXyf4/jI1lchXNBQyskCIMo75XSTT04GyM7NO3xZ5BOtVt1HIfFhFG1gMp0jBK9OaojwMcqIa4UrCwT9/tW9pil1v/vFi+oWyhrrKNMDqA3g7ZxRpGhVXSlECK2iLxf35gYah9X3T4rHl1796AwFdIAwijbBbpc5XE7Cu8Ol57XtGsrLR//Tnb3PrngZUEPn2FtOf+SLEef81mkT4ueeWS7zDJYwV83Vx1ZrR9jxus8s2tjmQC3XZs4jEyBlZIAwmjbJXk6xDMiuYYbB37CBJzD+rTOxjMGpbRypWi+Z+zy/Oq0op9IoRAKrnfUewnAx88NUQac7gDs5zgv2xZR/KZS2tPUs2VfVUzlGbGnoScrw+5nP0me9heg9XRTfLv32C90Fu6OTlAg476eLLMCF3DXCTlfxxYd2W04bh7+KHk6lnqaFCPMNeyP7qyf3Vf3lRNyiw9ZFIVD7fLg/Xu9VEabSeU3PG7I293bq06h2ThiaCeyi8PNBvveIsMZjIw/dCv15FcGjs4etHOtQZTsc43GkSL2CYZ+njyZcnK6NFwPfq4UbKp0xIhPw/pJIHPGddSByTZvmdfGzuUgXqr/tkAyy0rpU0ulGaW27bUoyvPqR7daHNxkgSRHKa7Y3IJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAjLbwEGABdIk04CWmrYAAAAAElFTkSuQmCC);\n    background-size: 210px 30px;\n}\n\n.leaflet-draw a {\n  display: block;\n   text-align: center;\n   text-decoration: none;\n}\n\n/* ================================================================== */\n/* Toolbar actions menu\n/* ================================================================== */\n\n.leaflet-draw-actions {\n   display: none;\n    list-style: none;\n margin: 0;\n    padding: 0;\n   position: absolute;\n   left: 26px; /* leaflet-draw-toolbar.left + leaflet-draw-toolbar.width */\n  top: 0;\n   white-space: nowrap;\n}\n\n.leaflet-right .leaflet-draw-actions {\n right:26px;\n   left:auto;\n}\n\n.leaflet-draw-actions li {\n   display: inline-block;\n}\n\n.leaflet-draw-actions li:first-child a {\n border-left: none;\n}\n\n.leaflet-draw-actions li:last-child a {\n  -webkit-border-radius: 0 4px 4px 0;\n           border-radius: 0 4px 4px 0;\n}\n\n.leaflet-right .leaflet-draw-actions li:last-child a {\n  -webkit-border-radius: 0;\n         border-radius: 0;\n}\n\n.leaflet-right .leaflet-draw-actions li:first-child a {\n   -webkit-border-radius: 4px 0 0 4px;\n           border-radius: 4px 0 0 4px;\n}\n\n.leaflet-draw-actions a {\n   background-color: #919187;\n    border-left: 1px solid #AAA;\n  color: #FFF;\n  font: 11px/19px "Helvetica Neue", Arial, Helvetica, sans-serif;\n   line-height: 28px;\n    text-decoration: none;\n    padding-left: 10px;\n   padding-right: 10px;\n  height: 28px;\n}\n\n.leaflet-draw-actions-bottom {\n    margin-top: 0;\n}\n\n.leaflet-draw-actions-top {\n  margin-top: 1px;\n}\n\n.leaflet-draw-actions-top a,\n.leaflet-draw-actions-bottom a {\n height: 27px;\n line-height: 27px;\n}\n\n.leaflet-draw-actions a:hover {\n  background-color: #A0A098;\n}\n\n.leaflet-draw-actions-top.leaflet-draw-actions-bottom a {\n    height: 26px;\n line-height: 26px;\n}\n\n/* ================================================================== */\n/* Draw toolbar\n/* ================================================================== */\n\n.leaflet-draw-toolbar .leaflet-draw-draw-polyline {\n   background-position: -2px -2px;\n}\n\n.leaflet-draw-toolbar .leaflet-draw-draw-polygon {\n  background-position: -31px -2px;\n}\n\n.leaflet-draw-toolbar .leaflet-draw-draw-rectangle {\n   background-position: -62px -2px;\n}\n\n.leaflet-draw-toolbar .leaflet-draw-draw-circle {\n  background-position: -92px -2px;\n}\n\n.leaflet-draw-toolbar .leaflet-draw-draw-marker {\n  background-position: -122px -2px;\n}\n\n/* ================================================================== */\n/* Edit toolbar\n/* ================================================================== */\n\n.leaflet-draw-toolbar .leaflet-draw-edit-edit {\n    background-position: -152px -2px;\n}\n\n.leaflet-draw-toolbar .leaflet-draw-edit-remove {\n background-position: -182px -2px;\n}\n\n/* ================================================================== */\n/* Drawing styles\n/* ================================================================== */\n\n.leaflet-mouse-marker {\n  background-color: #fff;\n   cursor: crosshair;\n}\n\n.leaflet-draw-tooltip {\n  background: rgb(54, 54, 54);\n  background: rgba(0, 0, 0, 0.5);\n   border: 1px solid transparent;\n    -webkit-border-radius: 4px;\n           border-radius: 4px;\n   color: #fff;\n  font: 12px/18px "Helvetica Neue", Arial, Helvetica, sans-serif;\n   margin-left: 20px;\n    margin-top: -21px;\n    padding: 4px 8px;\n position: absolute;\n   white-space: nowrap;\n  z-index: 6;\n}\n\n.leaflet-draw-tooltip:before {\n  border-right: 6px solid black;\n    border-right-color: rgba(0, 0, 0, 0.5);\n   border-top: 6px solid transparent;\n    border-bottom: 6px solid transparent;\n content: "";\n  position: absolute;\n   top: 7px;\n left: -7px;\n}\n\n.leaflet-error-draw-tooltip {\n   background-color: #F2DEDE;\n    border: 1px solid #E6B6BD;\n    color: #B94A48;\n}\n\n.leaflet-error-draw-tooltip:before {\n    border-right-color: #E6B6BD;\n}\n\n.leaflet-draw-tooltip-single {\n margin-top: -12px\n}\n\n.leaflet-draw-tooltip-subtext {\n   color: #f8d5e4;\n}\n\n.leaflet-draw-guide-dash {\n  font-size: 1%;\n    opacity: 0.6;\n position: absolute;\n   width: 5px;\n   height: 5px;\n}\n\n/* ================================================================== */\n/* Edit styles\n/* ================================================================== */\n\n.leaflet-edit-marker-selected {\n  background: rgba(254, 87, 161, 0.1);\n  border: 4px dashed rgba(254, 87, 161, 0.6);\n   -webkit-border-radius: 4px;\n           border-radius: 4px;\n}\n\n.leaflet-edit-move {\n    cursor: move;\n}\n\n.leaflet-edit-resize {\n    cursor: pointer;\n}\n
</style>
');
  $('head').append('
<style>
/***\nSpectrum Colorpicker v1.2.0\nhttps://github.com/bgrins/spectrum\nAuthor: Brian Grinstead\nLicense: MIT\n***/\n\n.sp-container {\n    position:absolute;\n    top:0;\n    left:0;\n    display:inline-block;\n    *display: inline;\n    *zoom: 1;\n    /* https://github.com/bgrins/spectrum/issues/40 */\n    z-index: 9999994;\n    overflow: hidden;\n}\n.sp-container.sp-flat {\n    position: relative;\n}\n\n/* http://ansciath.tumblr.com/post/7347495869/css-aspect-ratio */\n.sp-top {\n  position:relative;\n  width: 100%;\n  display:inline-block;\n}\n.sp-top-inner {\n   position:absolute;\n   top:0;\n   left:0;\n   bottom:0;\n   right:0;\n}\n.sp-color {\n    position: absolute;\n    top:0;\n    left:0;\n    bottom:0;\n    right:20%;\n}\n.sp-hue {\n    position: absolute;\n    top:0;\n    right:0;\n    bottom:0;\n    left:84%;\n    height: 100%;\n}\n\n.sp-clear-enabled .sp-hue {\n    top:33px;\n    height: 77.5%;\n}\n\n.sp-fill {\n    padding-top: 80%;\n}\n.sp-sat, .sp-val {\n    position: absolute;\n    top:0;\n    left:0;\n    right:0;\n    bottom:0;\n}\n\n.sp-alpha-enabled .sp-top {\n    margin-bottom: 18px;\n}\n.sp-alpha-enabled .sp-alpha {\n    display: block;\n}\n.sp-alpha-handle {\n    position:absolute;\n    top:-4px;\n    bottom: -4px;\n    width: 6px;\n    left: 50%;\n    cursor: pointer;\n    border: 1px solid black;\n    background: white;\n    opacity: .8;\n}\n.sp-alpha {\n    display: none;\n    position: absolute;\n    bottom: -14px;\n    right: 0;\n    left: 0;\n    height: 8px;\n}\n.sp-alpha-inner {\n    border: solid 1px #333;\n}\n\n.sp-clear {\n    display: none;\n}\n\n.sp-clear.sp-clear-display {\n    background-position: center;\n}\n\n.sp-clear-enabled .sp-clear {\n    display: block;\n    position:absolute;\n    top:0px;\n    right:0;\n    bottom:0;\n    left:84%;\n    height: 28px;\n}\n\n/* Don\'t allow text selection */\n.sp-container, .sp-replacer, .sp-preview, .sp-dragger, .sp-slider, .sp-alpha, .sp-clear, .sp-alpha-handle, .sp-container.sp-dragging .sp-input, .sp-container button  {\n    -webkit-user-select:none;\n    -moz-user-select: -moz-none;\n    -o-user-select:none;\n    user-select: none;\n}\n\n.sp-container.sp-input-disabled .sp-input-container {\n    display: none;\n}\n.sp-container.sp-buttons-disabled .sp-button-container {\n    display: none;\n}\n.sp-palette-only .sp-picker-container {\n    display: none;\n}\n.sp-palette-disabled .sp-palette-container {\n    display: none;\n}\n\n.sp-initial-disabled .sp-initial {\n    display: none;\n}\n\n\n/* Gradients for hue, saturation and value instead of images.  Not pretty... but it works */\n.sp-sat {\n    background-image: -webkit-gradient(linear,  0 0, 100% 0, from(#FFF), to(rgba(204, 154, 129, 0)));\n    background-image: -webkit-linear-gradient(left, #FFF, rgba(204, 154, 129, 0));\n    background-image: -moz-linear-gradient(left, #fff, rgba(204, 154, 129, 0));\n    background-image: -o-linear-gradient(left, #fff, rgba(204, 154, 129, 0));\n    background-image: -ms-linear-gradient(left, #fff, rgba(204, 154, 129, 0));\n    background-image: linear-gradient(to right, #fff, rgba(204, 154, 129, 0));\n    -ms-filter: "progid:DXImageTransform.Microsoft.gradient(GradientType = 1, startColorstr=#FFFFFFFF, endColorstr=#00CC9A81)";\n    filter : progid:DXImageTransform.Microsoft.gradient(GradientType = 1, startColorstr=\'#FFFFFFFF\', endColorstr=\'#00CC9A81\');\n}\n.sp-val {\n    background-image: -webkit-gradient(linear, 0 100%, 0 0, from(#000000), to(rgba(204, 154, 129, 0)));\n    background-image: -webkit-linear-gradient(bottom, #000000, rgba(204, 154, 129, 0));\n    background-image: -moz-linear-gradient(bottom, #000, rgba(204, 154, 129, 0));\n    background-image: -o-linear-gradient(bottom, #000, rgba(204, 154, 129, 0));\n    background-image: -ms-linear-gradient(bottom, #000, rgba(204, 154, 129, 0));\n    background-image: linear-gradient(to top, #000, rgba(204, 154, 129, 0));\n    -ms-filter: "progid:DXImageTransform.Microsoft.gradient(startColorstr=#00CC9A81, endColorstr=#FF000000)";\n    filter : progid:DXImageTransform.Microsoft.gradient(startColorstr=\'#00CC9A81\', endColorstr=\'#FF000000\');\n}\n\n.sp-hue {\n    background: -moz-linear-gradient(top, #ff0000 0%, #ffff00 17%, #00ff00 33%, #00ffff 50%, #0000ff 67%, #ff00ff 83%, #ff0000 100%);\n    background: -ms-linear-gradient(top, #ff0000 0%, #ffff00 17%, #00ff00 33%, #00ffff 50%, #0000ff 67%, #ff00ff 83%, #ff0000 100%);\n    background: -o-linear-gradient(top, #ff0000 0%, #ffff00 17%, #00ff00 33%, #00ffff 50%, #0000ff 67%, #ff00ff 83%, #ff0000 100%);\n    background: -webkit-gradient(linear, left top, left bottom, from(#ff0000), color-stop(0.17, #ffff00), color-stop(0.33, #00ff00), color-stop(0.5, #00ffff), color-stop(0.67, #0000ff), color-stop(0.83, #ff00ff), to(#ff0000));\n    background: -webkit-linear-gradient(top, #ff0000 0%, #ffff00 17%, #00ff00 33%, #00ffff 50%, #0000ff 67%, #ff00ff 83%, #ff0000 100%);\n}\n\n/* IE filters do not support multiple color stops.\n   Generate 6 divs, line them up, and do two color gradients for each.\n   Yes, really.\n */\n.sp-1 {\n    height:17%;\n    filter: progid:DXImageTransform.Microsoft.gradient(startColorstr=\'#ff0000\', endColorstr=\'#ffff00\');\n}\n.sp-2 {\n    height:16%;\n    filter: progid:DXImageTransform.Microsoft.gradient(startColorstr=\'#ffff00\', endColorstr=\'#00ff00\');\n}\n.sp-3 {\n    height:17%;\n    filter: progid:DXImageTransform.Microsoft.gradient(startColorstr=\'#00ff00\', endColorstr=\'#00ffff\');\n}\n.sp-4 {\n    height:17%;\n    filter: progid:DXImageTransform.Microsoft.gradient(startColorstr=\'#00ffff\', endColorstr=\'#0000ff\');\n}\n.sp-5 {\n    height:16%;\n    filter: progid:DXImageTransform.Microsoft.gradient(startColorstr=\'#0000ff\', endColorstr=\'#ff00ff\');\n}\n.sp-6 {\n    height:17%;\n    filter: progid:DXImageTransform.Microsoft.gradient(startColorstr=\'#ff00ff\', endColorstr=\'#ff0000\');\n}\n\n.sp-hidden {\n    display: none !important;\n}\n\n/* Clearfix hack */\n.sp-cf:before, .sp-cf:after { content: ""; display: table; }\n.sp-cf:after { clear: both; }\n.sp-cf { *zoom: 1; }\n\n/* Mobile devices, make hue slider bigger so it is easier to slide */\n@media (max-device-width: 480px) {\n    .sp-color { right: 40%; }\n    .sp-hue { left: 63%; }\n    .sp-fill { padding-top: 60%; }\n}\n.sp-dragger {\n   border-radius: 5px;\n   height: 5px;\n   width: 5px;\n   border: 1px solid #fff;\n   background: #000;\n   cursor: pointer;\n   position:absolute;\n   top:0;\n   left: 0;\n}\n.sp-slider {\n    position: absolute;\n    top:0;\n    cursor:pointer;\n    height: 3px;\n    left: -1px;\n    right: -1px;\n    border: 1px solid #000;\n    background: white;\n    opacity: .8;\n}\n\n/*\nTheme authors:\nHere are the basic themeable display options (colors, fonts, global widths).\nSee http://bgrins.github.io/spectrum/themes/ for instructions.\n*/\n\n.sp-container {\n    border-radius: 0;\n    background-color: #ECECEC;\n    border: solid 1px #f0c49B;\n    padding: 0;\n}\n.sp-container, .sp-container button, .sp-container input, .sp-color, .sp-hue, .sp-clear\n{\n    font: normal 12px "Lucida Grande", "Lucida Sans Unicode", "Lucida Sans", Geneva, Verdana, sans-serif;\n    -webkit-box-sizing: border-box;\n    -moz-box-sizing: border-box;\n    -ms-box-sizing: border-box;\n    box-sizing: border-box;\n}\n.sp-top\n{\n    margin-bottom: 3px;\n}\n.sp-color, .sp-hue, .sp-clear\n{\n    border: solid 1px #666;\n}\n\n/* Input */\n.sp-input-container {\n    float:right;\n    width: 100px;\n    margin-bottom: 4px;\n}\n.sp-initial-disabled  .sp-input-container {\n    width: 100%;\n}\n.sp-input {\n   font-size: 12px !important;\n   border: 1px inset;\n   padding: 4px 5px;\n   margin: 0;\n   width: 100%;\n   background:transparent;\n   border-radius: 3px;\n   color: #222;\n}\n.sp-input:focus  {\n    border: 1px solid orange;\n}\n.sp-input.sp-validation-error\n{\n    border: 1px solid red;\n    background: #fdd;\n}\n.sp-picker-container , .sp-palette-container\n{\n    float:left;\n    position: relative;\n    padding: 10px;\n    padding-bottom: 300px;\n    margin-bottom: -290px;\n}\n.sp-picker-container\n{\n    width: 172px;\n    border-left: solid 1px #fff;\n}\n\n/* Palettes */\n.sp-palette-container\n{\n    border-right: solid 1px #ccc;\n}\n\n.sp-palette .sp-thumb-el {\n    display: block;\n    position:relative;\n    float:left;\n    width: 24px;\n    height: 15px;\n    margin: 3px;\n    cursor: pointer;\n    border:solid 2px transparent;\n}\n.sp-palette .sp-thumb-el:hover, .sp-palette .sp-thumb-el.sp-thumb-active {\n    border-color: orange;\n}\n.sp-thumb-el\n{\n    position:relative;\n}\n\n/* Initial */\n.sp-initial\n{\n    float: left;\n    border: solid 1px #333;\n}\n.sp-initial span {\n    width: 30px;\n    height: 25px;\n    border:none;\n    display:block;\n    float:left;\n    margin:0;\n}\n\n.sp-initial .sp-clear-display {\n    background-position: center;\n}\n\n/* Buttons */\n.sp-button-container {\n    float: right;\n}\n\n/* Replacer (the little preview div that shows up instead of the
<input>
) */\n.sp-replacer {\n    margin:0;\n    overflow:hidden;\n    cursor:pointer;\n    padding: 4px;\n    display:inline-block;\n    *zoom: 1;\n    *display: inline;\n    border: solid 1px #91765d;\n    background: #eee;\n    color: #333;\n    vertical-align: middle;\n}\n.sp-replacer:hover, .sp-replacer.sp-active {\n    border-color: #F0C49B;\n    color: #111;\n}\n.sp-replacer.sp-disabled {\n    cursor:default;\n    border-color: silver;\n    color: silver;\n}\n.sp-dd {\n    padding: 2px 0;\n    height: 16px;\n    line-height: 16px;\n    float:left;\n    font-size:10px;\n}\n.sp-preview\n{\n    position:relative;\n    width:25px;\n    height: 20px;\n    border: solid 1px #222;\n    margin-right: 5px;\n    float:left;\n    z-index: 0;\n}\n\n.sp-palette\n{\n    *width: 220px;\n    max-width: 220px;\n}\n.sp-palette .sp-thumb-el\n{\n    width:16px;\n    height: 16px;\n    margin:2px 1px;\n    border: solid 1px #d0d0d0;\n}\n\n.sp-container\n{\n    padding-bottom:0;\n}\n\n\n/* Buttons: http://hellohappy.org/css3-buttons/ */\n.sp-container button {\n  background-color: #eeeeee;\n  background-image: -webkit-linear-gradient(top, #eeeeee, #cccccc);\n  background-image: -moz-linear-gradient(top, #eeeeee, #cccccc);\n  background-image: -ms-linear-gradient(top, #eeeeee, #cccccc);\n  background-image: -o-linear-gradient(top, #eeeeee, #cccccc);\n  background-image: linear-gradient(to bottom, #eeeeee, #cccccc);\n  border: 1px solid #ccc;\n  border-bottom: 1px solid #bbb;\n  border-radius: 3px;\n  color: #333;\n  font-size: 14px;\n  line-height: 1;\n  padding: 5px 4px;\n  text-align: center;\n  text-shadow: 0 1px 0 #eee;\n  vertical-align: middle;\n}\n.sp-container button:hover {\n    background-color: #dddddd;\n    background-image: -webkit-linear-gradient(top, #dddddd, #bbbbbb);\n    background-image: -moz-linear-gradient(top, #dddddd, #bbbbbb);\n    background-image: -ms-linear-gradient(top, #dddddd, #bbbbbb);\n    background-image: -o-linear-gradient(top, #dddddd, #bbbbbb);\n    background-image: linear-gradient(to bottom, #dddddd, #bbbbbb);\n    border: 1px solid #bbb;\n    border-bottom: 1px solid #999;\n    cursor: pointer;\n    text-shadow: 0 1px 0 #ddd;\n}\n.sp-container button:active {\n    border: 1px solid #aaa;\n    border-bottom: 1px solid #888;\n    -webkit-box-shadow: inset 0 0 5px 2px #aaaaaa, 0 1px 0 0 #eeeeee;\n    -moz-box-shadow: inset 0 0 5px 2px #aaaaaa, 0 1px 0 0 #eeeeee;\n    -ms-box-shadow: inset 0 0 5px 2px #aaaaaa, 0 1px 0 0 #eeeeee;\n    -o-box-shadow: inset 0 0 5px 2px #aaaaaa, 0 1px 0 0 #eeeeee;\n    box-shadow: inset 0 0 5px 2px #aaaaaa, 0 1px 0 0 #eeeeee;\n}\n.sp-cancel\n{\n    font-size: 11px;\n    color: #d93f3f !important;\n    margin:0;\n    padding:2px;\n    margin-right: 5px;\n    vertical-align: middle;\n    text-decoration:none;\n\n}\n.sp-cancel:hover\n{\n    color: #d93f3f !important;\n    text-decoration: underline;\n}\n\n\n.sp-palette span:hover, .sp-palette span.sp-thumb-active\n{\n    border-color: #000;\n}\n\n.sp-preview, .sp-alpha, .sp-thumb-el\n{\n    position:relative;\n    background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAIAAADZF8uwAAAAGUlEQVQYV2M4gwH+YwCGIasIUwhT25BVBADtzYNYrHvv4gAAAABJRU5ErkJggg==);\n}\n.sp-preview-inner, .sp-alpha-inner, .sp-thumb-inner\n{\n    display:block;\n    position:absolute;\n    top:0;left:0;bottom:0;right:0;\n}\n\n.sp-palette .sp-thumb-inner\n{\n    background-position: 50% 50%;\n    background-repeat: no-repeat;\n}\n\n.sp-palette .sp-thumb-light.sp-thumb-active .sp-thumb-inner\n{\n    background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAIVJREFUeNpiYBhsgJFMffxAXABlN5JruT4Q3wfi/0DsT64h8UD8HmpIPCWG/KemIfOJCUB+Aoacx6EGBZyHBqI+WsDCwuQ9mhxeg2A210Ntfo8klk9sOMijaURm7yc1UP2RNCMbKE9ODK1HM6iegYLkfx8pligC9lCD7KmRof0ZhjQACDAAceovrtpVBRkAAAAASUVORK5CYII=);\n}\n\n.sp-palette .sp-thumb-dark.sp-thumb-active .sp-thumb-inner\n{\n    background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAadEVYdFNvZnR3YXJlAFBhaW50Lk5FVCB2My41LjEwMPRyoQAAAMdJREFUOE+tkgsNwzAMRMugEAahEAahEAZhEAqlEAZhEAohEAYh81X2dIm8fKpEspLGvudPOsUYpxE2BIJCroJmEW9qJ+MKaBFhEMNabSy9oIcIPwrB+afvAUFoK4H0tMaQ3XtlrggDhOVVMuT4E5MMG0FBbCEYzjYT7OxLEvIHQLY2zWwQ3D+9luyOQTfKDiFD3iUIfPk8VqrKjgAiSfGFPecrg6HN6m/iBcwiDAo7WiBeawa+Kwh7tZoSCGLMqwlSAzVDhoK+6vH4G0P5wdkAAAAASUVORK5CYII=);\n}\n\n.sp-clear-display {\n    background-repeat:no-repeat;\n    background-position: center;\n    background-image: url(data:image/gif;base64,R0lGODlhFAAUAPcAAAAAAJmZmZ2dnZ6enqKioqOjo6SkpKWlpaampqenp6ioqKmpqaqqqqurq/Hx8fLy8vT09PX19ff39/j4+Pn5+fr6+vv7+wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAAP8ALAAAAAAUABQAAAihAP9FoPCvoMGDBy08+EdhQAIJCCMybCDAAYUEARBAlFiQQoMABQhKUJBxY0SPICEYHBnggEmDKAuoPMjS5cGYMxHW3IiT478JJA8M/CjTZ0GgLRekNGpwAsYABHIypcAgQMsITDtWJYBR6NSqMico9cqR6tKfY7GeBCuVwlipDNmefAtTrkSzB1RaIAoXodsABiZAEFB06gIBWC1mLVgBa0AAOw==);\n}\n
</style>
');
}
window.plugin.drawTools.getMarkerIcon = function(color) {
  if (typeof(color) === 'undefined') {
    console.warn('Color is not set or not a valid color. Using default color as fallback.');
    color = '#a24ac3';
  }
  var svgIcon = window.plugin.drawTools.markerTemplate.replace(/%COLOR%/g, color);
  return L.divIcon({
    iconSize: new L.Point(25, 41),
    iconAnchor: new L.Point(12, 41),
    html: svgIcon,
    className: 'leaflet-iitc-custom-icon',
    // L.divIcon does not use the option color, but we store it here to
    // be able to simply retrieve the color for serializing markers
    color: color
  });
}
window.plugin.drawTools.currentColor = '#a24ac3';
window.plugin.drawTools.markerTemplate = '
<?xml version="1.0" encoding="UTF-8"?>
\n
<svg xmlns="http://www.w3.org/2000/svg"\n version="1.1" baseProfile="full"\n  width="25px" height="41px" viewBox="0 0 25 41">
\n\n
<path d="M1.36241844765,18.67488124675 A12.5,12.5 0 1,1 23.63758155235,18.67488124675 L12.5,40.5336158073 Z" style="stroke:none; fill: %COLOR%;" />
\n
<path d="M1.80792170975,18.44788599685 A12,12 0 1,1 23.19207829025,18.44788599685 L12.5,39.432271175 Z" style="stroke:#000000; stroke-width:1px; stroke-opacity: 0.15; fill: none;" />
\n
<path d="M2.921679865,17.8803978722 A10.75,10.75 0 1,1 22.078320135,17.8803978722 L12.5,36.6789095943 Z" style="stroke:#ffffff; stroke-width:1.5px; stroke-opacity: 0.35; fill: none;" />
\n\n
<path d="M19.86121593215,17.25 L12.5,21.5 L5.13878406785,17.25 L5.13878406785,8.75 L12.5,4.5 L19.86121593215,8.75 Z M7.7368602792,10.25 L17.2631397208,10.25 L12.5,18.5 Z M12.5,13 L7.7368602792,10.25 M12.5,13 L17.2631397208,10.25 M12.5,13 L12.5,18.5 M19.86121593215,17.25 L16.39711431705,15.25 M5.13878406785,17.25 L8.60288568295,15.25 M12.5,4.5 L12.5,8.5" style="stroke:#ffffff; stroke-width:1.25px; stroke-opacity: 1; fill: none;" />
\n\n
</svg>
';
window.plugin.drawTools.setOptions = function() {
  window.plugin.drawTools.lineOptions = {
    stroke: true,
    color: window.plugin.drawTools.currentColor,
    weight: 4,
    opacity: 0.5,
    fill: false,
    clickable: true
  };
  window.plugin.drawTools.polygonOptions = L.extend({}, window.plugin.drawTools.lineOptions, {
    fill: true,
    fillColor: null, // to use the same as 'color' for fill
    fillOpacity: 0.2
  });
  window.plugin.drawTools.editOptions = L.extend({}, window.plugin.drawTools.polygonOptions, {
    dashArray: [10,10]
  });
  delete window.plugin.drawTools.editOptions.color;
  window.plugin.drawTools.markerOptions = {
    icon: window.plugin.drawTools.currentMarker,
    zIndexOffset: 2000
  };
}
window.plugin.drawTools.setDrawColor = function(color) {
  window.plugin.drawTools.currentColor = color;
  window.plugin.drawTools.currentMarker = window.plugin.drawTools.getMarkerIcon(color);
  window.plugin.drawTools.lineOptions.color = color;
  window.plugin.drawTools.polygonOptions.color = color;
  window.plugin.drawTools.markerOptions.icon = window.plugin.drawTools.currentMarker;
  plugin.drawTools.drawControl.setDrawingOptions({
    polygon:  { shapeOptions: plugin.drawTools.polygonOptions },
    polyline: { shapeOptions: plugin.drawTools.lineOptions },
    circle:   { shapeOptions: plugin.drawTools.polygonOptions },
    marker:   { icon:         plugin.drawTools.markerOptions.icon },
  });
}
// renders the draw control buttons in the top left corner
window.plugin.drawTools.addDrawControl = function() {
  var drawControl = new L.Control.Draw({
    draw: {
      rectangle: false,
      polygon: {
        title: 'Add a polygon\n\n'
          + 'Click on the button, then click on the map to\n'
          + 'define the start of the polygon. Continue clicking\n'
          + 'to draw the line you want. Click the first or last\n'
          + 'point of the line (a small white rectangle) to\n'
          + 'finish. Double clicking also works.',
        shapeOptions: window.plugin.drawTools.polygonOptions,
        snapPoint: window.plugin.drawTools.getSnapLatLng,
      },
      polyline: {
        title: 'Add a (poly) line.\n\n'
          + 'Click on the button, then click on the map to\n'
          + 'define the start of the line. Continue clicking\n'
          + 'to draw the line you want. Click the
<b>
last
</b>
\n'
          + 'point of the line (a small white rectangle) to\n'
          + 'finish. Double clicking also works.',
        shapeOptions: window.plugin.drawTools.lineOptions,
        snapPoint: window.plugin.drawTools.getSnapLatLng,
      },
      circle: {
        title: 'Add a circle.\n\n'
          + 'Click on the button, then click-AND-HOLD on the\n'
          + 'map where the circle’s center should be. Move\n'
          + 'the mouse to control the radius. Release the mouse\n'
          + 'to finish.',
        shapeOptions: window.plugin.drawTools.polygonOptions,
        snapPoint: window.plugin.drawTools.getSnapLatLng,
      },
      // Options for marker (icon, zIndexOffset) are not set via shapeOptions,
      // so we have merge them here!
      marker: L.extend({}, window.plugin.drawTools.markerOptions, {
        title: 'Add a marker.\n\n'
          + 'Click on the button, then click on the map where\n'
          + 'you want the marker to appear.',
        snapPoint: window.plugin.drawTools.getSnapLatLng,
        repeatMode: true
      }),
    },
    edit: {
      featureGroup: window.plugin.drawTools.drawnItems,
      edit: {
        title: 'Edit drawn items',
        selectedPathOptions: window.plugin.drawTools.editOptions,
      },
      remove: {
        title: 'Delete drawn items'
      },
    },
  });
  window.plugin.drawTools.drawControl = drawControl;
  map.addControl(drawControl);
  //plugin.drawTools.addCustomButtons();
  window.plugin.drawTools.setAccessKeys();
  for (var toolbarId in drawControl._toolbars) {
    if (drawControl._toolbars[toolbarId] instanceof L.Toolbar) {
      drawControl._toolbars[toolbarId].on('enable', function() {
        setTimeout(window.plugin.drawTools.setAccessKeys, 10);
      });
    }
  }
}
window.plugin.drawTools.setAccessKeys = function() {
  var expr = /\s*\[\w+\]$/;
  // there is no API to add accesskeys, so have to dig in the DOM
  // must be same order as in markup. Note that each toolbar has a container for save/cancel
  var accessKeys = [
    'l', 'p', 'o', 'm', // line, polygon, circle, marker
    'a',                // cancel (_abort)
    'e', 'd',           // edit, delete
    's', 'a',           // save, cancel
  ];
  var buttons = window.plugin.drawTools.drawControl._container.getElementsByTagName('a');
  for(var i=0;i
<buttons.length;i++) {
    var button = buttons[i];
    var title = button.title;
    var index = title.search(expr);
    if(index !== -1) title = title.substr(0, index);
    if(!button.offsetParent) { // element hidden, delete accessKey (so other elements can use it)
      button.accessKey = '';
    } else if(accessKeys[i]) {
      button.accessKey = accessKeys[i];
      if(title === "") title = "[" + accessKeys[i] + "]";
      else title += " [" + accessKeys[i] + "]";
    }
    button.title = title;
  }
}
// given a point it tries to find the most suitable portal to
// snap to. It takes the CircleMarker’s radius and weight into account.
// Will return null if nothing to snap to or a LatLng instance.
window.plugin.drawTools.getSnapLatLng = function(unsnappedLatLng) {
  var containerPoint = map.latLngToContainerPoint(unsnappedLatLng);
  var candidates = [];
  $.each(window.portals, function(guid, portal) {
    var ll = portal.getLatLng();
    var pp = map.latLngToContainerPoint(ll);
    var size = portal.options.weight + portal.options.radius;
    var dist = pp.distanceTo(containerPoint);
    if(dist >
 size) return true;
    candidates.push([dist, ll]);
  });
  if(candidates.length === 0) return unsnappedLatLng;
  candidates = candidates.sort(function(a, b) { return a[0]-b[0]; });
  return new L.LatLng(candidates[0][1].lat, candidates[0][1].lng);  //return a clone of the portal location
}
window.plugin.drawTools.save = function() {
  var data = [];
  window.plugin.drawTools.drawnItems.eachLayer( function(layer) {
    var item = {};
    if (layer instanceof L.GeodesicCircle || layer instanceof L.Circle) {
      item.type = 'circle';
      item.latLng = layer.getLatLng();
      item.radius = layer.getRadius();
      item.color = layer.options.color;
    } else if (layer instanceof L.GeodesicPolygon || layer instanceof L.Polygon) {
      item.type = 'polygon';
      item.latLngs = layer.getLatLngs();
      item.color = layer.options.color;
    } else if (layer instanceof L.GeodesicPolyline || layer instanceof L.Polyline) {
      item.type = 'polyline';
      item.latLngs = layer.getLatLngs();
      item.color = layer.options.color;
    } else if (layer instanceof L.Marker) {
      item.type = 'marker';
      item.latLng = layer.getLatLng();
      item.color = layer.options.icon.options.color;
    } else {
      console.warn('Unknown layer type when saving draw tools layer');
      return; //.eachLayer 'continue'
    }
    data.push(item);
  });
  localStorage['plugin-draw-tools-layer'] = JSON.stringify(data);
  console.log('draw-tools: saved to localStorage');
}
window.plugin.drawTools.load = function() {
  try {
    var dataStr = localStorage['plugin-draw-tools-layer'];
    if (dataStr === undefined) return;
    var data = JSON.parse(dataStr);
    window.plugin.drawTools.import(data);
  } catch(e) {
    console.warn('draw-tools: failed to load data from localStorage: '+e);
  }
}
window.plugin.drawTools.import = function(data) {
  $.each(data, function(index,item) {
    var layer = null;
    var extraOpt = {};
    if (item.color) extraOpt.color = item.color;
    switch(item.type) {
      case 'polyline':
        layer = L.geodesicPolyline(item.latLngs, L.extend({},window.plugin.drawTools.lineOptions,extraOpt));
        break;
      case 'polygon':
        layer = L.geodesicPolygon(item.latLngs, L.extend({},window.plugin.drawTools.polygonOptions,extraOpt));
        break;
      case 'circle':
        layer = L.geodesicCircle(item.latLng, item.radius, L.extend({},window.plugin.drawTools.polygonOptions,extraOpt));
        break;
      case 'marker':
        var extraMarkerOpt = {};
        if (item.color) extraMarkerOpt.icon = window.plugin.drawTools.getMarkerIcon(item.color);
        layer = L.marker(item.latLng, L.extend({},window.plugin.drawTools.markerOptions,extraMarkerOpt));
        window.registerMarkerForOMS(layer);
        break;
      default:
        console.warn('unknown layer type "'+item.type+'" when loading draw tools layer');
        break;
    }
    if (layer) {
      window.plugin.drawTools.drawnItems.addLayer(layer);
    }
  });
  runHooks('pluginDrawTools', {event: 'import'});
}
//Draw Tools Options
// Manual import, export and reset data
window.plugin.drawTools.manualOpt = function() {
  var html = '
<div class="drawtoolsStyles">
'
           + '
<input type="color" name="drawColor" id="drawtools_color">
</input>
'
//TODO: add line style choosers: thickness, maybe dash styles?
           + '
</div>
'
           + '
<div class="drawtoolsSetbox">
'
           + '
<a onclick="window.plugin.drawTools.optCopy();" tabindex="0">
Copy Drawn Items
</a>
'
           + '
<a onclick="window.plugin.drawTools.optPaste();return false;" tabindex="0">
Paste Drawn Items
</a>
'
           + (window.requestFile != undefined
             ? '
<a onclick="window.plugin.drawTools.optImport();return false;" tabindex="0">
Import Drawn Items
</a>
' : '')
           + ((typeof android !== 'undefined' && android && android.saveFile)
             ? '
<a onclick="window.plugin.drawTools.optExport();return false;" tabindex="0">
Export Drawn Items
</a>
' : '')
           + '
<a onclick="window.plugin.drawTools.optReset();return false;" tabindex="0">
Reset Drawn Items
</a>
'
           + '
<a onclick="window.plugin.drawTools.snapToPortals();return false;" tabindex="0">
Snap to portals
</a>
'
           + '
</div>
';
  dialog({
    html: html,
    id: 'plugin-drawtools-options',
    dialogClass: 'ui-dialog-drawtoolsSet',
    title: 'Draw Tools Options'
  });
  // need to initialise the 'spectrum' colour picker
  $('#drawtools_color').spectrum({
    flat: false,
    showInput: false,
    showButtons: false,
    showPalette: true,
    showSelectionPalette: false,
    palette: [ ['#a24ac3','#514ac3','#4aa8c3','#51c34a'],
               ['#c1c34a','#c38a4a','#c34a4a','#c34a6f'],
               ['#000000','#666666','#bbbbbb','#ffffff']
    ],
    change: function(color) { window.plugin.drawTools.setDrawColor(color.toHexString()); },
//    move: function(color) { window.plugin.drawTools.setDrawColor(color.toHexString()); },
    color: window.plugin.drawTools.currentColor,
  });
}
window.plugin.drawTools.optAlert = function(message) {
    $('.ui-dialog-drawtoolsSet .ui-dialog-buttonset').prepend('
<p class="drawtools-alert" style="float:left;margin-top:4px;">
'+message+'
</p>
');
    $('.drawtools-alert').delay(2500).fadeOut();
}
window.plugin.drawTools.optCopy = function() {
    if (typeof android !== 'undefined' && android && android.shareString) {
        android.shareString(localStorage['plugin-draw-tools-layer']);
    } else {
      var stockWarnings = {};
      var stockLinks = [];
      window.plugin.drawTools.drawnItems.eachLayer( function(layer) {
        if (layer instanceof L.GeodesicCircle || layer instanceof L.Circle) {
          stockWarnings.noCircle = true;
          return; //.eachLayer 'continue'
        } else if (layer instanceof L.GeodesicPolygon || layer instanceof L.Polygon) {
          stockWarnings.polyAsLine = true;
          // but we can export them
        } else if (layer instanceof L.GeodesicPolyline || layer instanceof L.Polyline) {
          // polylines are fine
        } else if (layer instanceof L.Marker) {
          stockWarnings.noMarker = true;
          return; //.eachLayer 'continue'
        } else {
          stockWarnings.unknown = true; //should never happen
          return; //.eachLayer 'continue'
        }
        // only polygons and polylines make it through to here
        var latLngs = layer.getLatLngs();
        // stock only handles one line segment at a time
        for (var i=0; i
<latLngs.length-1; i++) {
          stockLinks.push([latLngs[i].lat,latLngs[i].lng,latLngs[i+1].lat,latLngs[i+1].lng]);
        }
        // for polygons, we also need a final link from last to first point
        if (layer instanceof L.GeodesicPolygon || layer instanceof L.Polygon) {
          stockLinks.push([latLngs[latLngs.length-1].lat,latLngs[latLngs.length-1].lng,latLngs[0].lat,latLngs[0].lng]);
        }
      });
      var stockUrl = 'https://www.ingress.com/intel?ll='+map.getCenter().lat+','+map.getCenter().lng+'&z='+map.getZoom()+'&pls='+stockLinks.map(function(link){return link.join(',');}).join('_');
      var stockWarnTexts = [];
      if (stockWarnings.polyAsLine) stockWarnTexts.push('Note: polygons are exported as lines');
      if (stockLinks.length>
40) stockWarnTexts.push('Warning: Stock intel may not work with more than 40 line segments - there are '+stockLinks.length);
      if (stockWarnings.noCircle) stockWarnTexts.push('Warning: Circles cannot be exported to stock intel');
      if (stockWarnings.noMarker) stockWarnTexts.push('Warning: Markers cannot be exported to stock intel');
      if (stockWarnings.unknown) stockWarnTexts.push('Warning: UNKNOWN ITEM TYPE');
      var html = '
<p>
<a onclick="$(\'.ui-dialog-drawtoolsSet-copy textarea\').select();">
Select all
</a>
 and press CTRL+C to copy it.
</p>
'
                +'
<textarea readonly onclick="$(\'.ui-dialog-drawtoolsSet-copy textarea\').select();">
'+localStorage['plugin-draw-tools-layer']+'
</textarea>
'
                +'
<p>
or, export as a link for the standard intel map (for non IITC users)
</p>
'
                +'
<input onclick="event.target.select();" type="text" size="90" value="'+stockUrl+'"/>
';
      if (stockWarnTexts.length>
0) {
        html += '
<ul>
<li>
'+stockWarnTexts.join('
</li>
<li>
')+'
</li>
</ul>
';
      }
      dialog({
        html: html,
        width: 600,
        dialogClass: 'ui-dialog-drawtoolsSet-copy',
        title: 'Draw Tools Export'
        });
    }
}
window.plugin.drawTools.optExport = function() {
  if(typeof android !== 'undefined' && android && android.saveFile) {
    android.saveFile('IITC-drawn-items.json', 'application/json', localStorage['plugin-draw-tools-layer']);
  }
}
window.plugin.drawTools.optPaste = function() {
  var promptAction = prompt('Press CTRL+V to paste (draw-tools data or stock intel URL).', '');
  if(promptAction !== null && promptAction !== '') {
    try {
      // first see if it looks like a URL-format stock intel link, and if so, try and parse out any stock drawn items
      // from the pls parameter
      if (promptAction.match(new RegExp("^(https?://)?(www\\.)ingress\\.com/intel.*[?&]pls="))) {
        //looks like a ingress URL that has drawn items...
        var items = promptAction.split(/[?&]/);
        var foundAt = -1;
        for (var i=0; i
<items.length; i++) {
          if (items[i].substr(0,4) == "pls=") {
            foundAt = i;
          }
        }
        if (foundAt == -1) throw ("No drawn items found in intel URL");
        var newLines = [];
        var linesStr = items[foundAt].substr(4).split('_');
        for (var i=0; i
<linesStr.length; i++) {
          var floats = linesStr[i].split(',').map(Number);
          if (floats.length != 4) throw("URL item not a set of four floats");
          for (var j=0; j
<floats.length; j++) {
            if (isNaN(floats[j])) throw("URL item had invalid number");
          }
          var layer = L.geodesicPolyline([[floats[0],floats[1]],[floats[2],floats[3]]], window.plugin.drawTools.lineOptions);
          newLines.push(layer);
        }
        // all parsed OK - clear and insert
        window.plugin.drawTools.drawnItems.clearLayers();
        for (var i=0; i
<newLines.length; i++) {
          window.plugin.drawTools.drawnItems.addLayer(newLines[i]);
        }
        runHooks('pluginDrawTools', {event: 'import'});
        console.log('DRAWTOOLS: reset and imported drawn items from stock URL');
        window.plugin.drawTools.optAlert('Import Successful.');
      } else {
        var data = JSON.parse(promptAction);
        window.plugin.drawTools.drawnItems.clearLayers();
        window.plugin.drawTools.import(data);
        console.log('DRAWTOOLS: reset and imported drawn items');
        window.plugin.drawTools.optAlert('Import Successful.');
      }
      // to write back the data to localStorage
      window.plugin.drawTools.save();
    } catch(e) {
      console.warn('DRAWTOOLS: failed to import data: '+e);
      window.plugin.drawTools.optAlert('
<span style="color: #f88">
Import failed
</span>
');
    }
  }
}
window.plugin.drawTools.optImport = function() {
  if (window.requestFile === undefined) return;
  window.requestFile(function(filename, content) {
    try {
      var data = JSON.parse(content);
      window.plugin.drawTools.drawnItems.clearLayers();
      window.plugin.drawTools.import(data);
      console.log('DRAWTOOLS: reset and imported drawn tiems');
      window.plugin.drawTools.optAlert('Import Successful.');
      // to write back the data to localStorage
      window.plugin.drawTools.save();
    } catch(e) {
      console.warn('DRAWTOOLS: failed to import data: '+e);
      window.plugin.drawTools.optAlert('
<span style="color: #f88">
Import failed
</span>
');
    }
  });
}
window.plugin.drawTools.optReset = function() {
  var promptAction = confirm('All drawn items will be deleted. Are you sure?', '');
  if(promptAction) {
    delete localStorage['plugin-draw-tools-layer'];
    window.plugin.drawTools.drawnItems.clearLayers();
    window.plugin.drawTools.load();
    console.log('DRAWTOOLS: reset all drawn items');
    window.plugin.drawTools.optAlert('Reset Successful. ');
    runHooks('pluginDrawTools', {event: 'clear'});
  }
}
window.plugin.drawTools.snapToPortals = function() {
  var dataParams = getMapZoomTileParameters(getDataZoomForMapZoom(map.getZoom()));
  if (dataParams.level >
 0) {
    if (!confirm('Not all portals are visible on the map. Snap to portals may move valid points to the wrong place. Continue?')) {
      return;
    }
  }
  if (mapDataRequest.status.short != 'done') {
    if (!confirm('Map data has not completely loaded, so some portals may be missing. Do you want to continue?')) {
      return;
    }
  }
  var visibleBounds = map.getBounds();
  // let's do all the distance calculations in screen space. 2d is much easier, should be faster, and is more than good enough
  // we'll pre-project all the on-screen portals too, to save repeatedly doing it
  var visiblePortals = {};
  $.each(window.portals, function(guid,portal) {
    var ll = portal.getLatLng();
    if (visibleBounds.contains(ll)) {
      visiblePortals[guid] = map.project(ll);
    }
  });
  if (Object.keys(visiblePortals).length == 0) {
    alert('Error: No portals visible in this view - nothing to snap points to!');
    return;
  }
  var findClosestPortalLatLng = function(latlng) {
    var testpoint = map.project(latlng);
    var minDistSquared = undefined;
    var minGuid = undefined;
    for (var guid in visiblePortals) {
      var p = visiblePortals[guid];
      var distSquared = (testpoint.x-p.x)*(testpoint.x-p.x) + (testpoint.y-p.y)*(testpoint.y-p.y);
      if (minDistSquared == undefined || minDistSquared >
 distSquared) {
        minDistSquared = distSquared;
        minGuid = guid;
      }
    }
    return minGuid ? portals[minGuid].getLatLng() : undefined; //should never hit 'undefined' case - as we abort when the list is empty
  };
  var changedCount = 0;
  var testCount = 0;
  window.plugin.drawTools.drawnItems.eachLayer(function(layer) {
    if (layer.getLatLng) {
      //circles and markers - a single point to snap
      var ll = layer.getLatLng();
      if (visibleBounds.contains(ll)) {
        testCount++;
        var newll = findClosestPortalLatLng(ll);
        if (!newll.equals(ll)) {
          layer.setLatLng(new L.LatLng(newll.lat,newll.lng));
          changedCount++;
        }
      }
    } else if (layer.getLatLngs) {
      var lls = layer.getLatLngs();
      var layerChanged = false;
      for (var i=0; i
<lls.length; i++) {
        if (visibleBounds.contains(lls[i])) {
          testCount++;
          var newll = findClosestPortalLatLng(lls[i]);
          if (!newll.equals(lls[i])) {
            lls[i] = new L.LatLng(newll.lat,newll.lng);
            changedCount++;
            layerChanged = true;
          }
        }
      }
      if (layerChanged) {
        layer.setLatLngs(lls);
      }
    }
  });
  if(changedCount >
 0) {
    runHooks('pluginDrawTools',{event:'layersSnappedToPortals'}); //or should we send 'layersEdited'? as that's effectively what's happened...
  }
  alert('Tested '+testCount+' points, and moved '+changedCount+' onto portal coordinates');
  window.plugin.drawTools.save();
}
window.plugin.drawTools.boot = function() {
  // add a custom hook for draw tools to share it's activity with other plugins
  pluginCreateHook('pluginDrawTools');
  window.plugin.drawTools.currentMarker = window.plugin.drawTools.getMarkerIcon(window.plugin.drawTools.currentColor);
  window.plugin.drawTools.setOptions();
  //create a leaflet FeatureGroup to hold drawn items
  window.plugin.drawTools.drawnItems = new L.FeatureGroup();
  //load any previously saved items
  plugin.drawTools.load();
  //add the draw control - this references the above FeatureGroup for editing purposes
  plugin.drawTools.addDrawControl();
  //start off hidden. if the layer is enabled, the below addLayerGroup will add it, triggering a 'show'
  $('.leaflet-draw-section').hide();
  //hide the draw tools when the 'drawn items' layer is off, show it when on
  map.on('layeradd', function(obj) {
    if(obj.layer === window.plugin.drawTools.drawnItems) {
      $('.leaflet-draw-section').show();
    }
  });
  map.on('layerremove', function(obj) {
    if(obj.layer === window.plugin.drawTools.drawnItems) {
      $('.leaflet-draw-section').hide();
    }
  });
  //add the layer
  window.addLayerGroup('Drawn Items', window.plugin.drawTools.drawnItems, true);
  //place created items into the specific layer
  map.on('draw:created', function(e) {
    var type=e.layerType;
    var layer=e.layer;
    window.plugin.drawTools.drawnItems.addLayer(layer);
    window.plugin.drawTools.save();
    if(layer instanceof L.Marker) {
      window.registerMarkerForOMS(layer);
    }
    runHooks('pluginDrawTools',{event:'layerCreated',layer:layer});
  });
  map.on('draw:deleted', function(e) {
    window.plugin.drawTools.save();
    runHooks('pluginDrawTools',{event:'layersDeleted'});
  });
  map.on('draw:edited', function(e) {
    window.plugin.drawTools.save();
    runHooks('pluginDrawTools',{event:'layersEdited'});
  });
  //add options menu
  $('#toolbox').append('
<a onclick="window.plugin.drawTools.manualOpt();return false;" accesskey="x" title="[x]">
DrawTools Opt
</a>
');
  $('head').append('
<style>
' +
        '.drawtoolsSetbox >
 a { display:block; color:#ffce00; border:1px solid #ffce00; padding:3px 0; margin:10px auto; width:80%; text-align:center; background:rgba(8,48,78,.9); }'+
        '.ui-dialog-drawtoolsSet-copy textarea { width:96%; height:250px; resize:vertical; }'+
        '
</style>
');
}
var setup =  window.plugin.drawTools.loadExternals;
// PLUGIN END //////////////////////////////////////////////////////////
setup.info = plugin_info; //add the script info data to the function as a property
if(!window.bootPlugins) window.bootPlugins = [];
window.bootPlugins.push(setup);
// if IITC has already booted, immediately run the 'setup' function
if(window.iitcLoaded && typeof setup === 'function') setup();
})({"script":{"version":"0.7.0.20150917.154202","name":"IITC plugin: draw tools","description":"[jonatkins-2015-09-17-154202] Allow drawing things onto the current map so you may plan your next move."}});
</script>
<script>
(function wrapper(plugin_info) {
// ensure plugin framework is there, even if iitc is not yet loaded
if(typeof window.plugin !== 'function') window.plugin = function() {};
//PLUGIN AUTHORS: writing a plugin outside of the IITC build environment? if so, delete these lines!!
//(leaving them in place might break the 'About IITC' page or break update checks)
plugin_info.buildName = 'jonatkins';
plugin_info.dateTimeVersion = '20150917.154202';
plugin_info.pluginId = 'distance-to-portal';
//END PLUGIN AUTHORS NOTE
// PLUGIN START ////////////////////////////////////////////////////////
// use own namespace for plugin
window.plugin.distanceToPortal = function() {};
window.plugin.distanceToPortal.addDistance = function() {
  var div = $('
<div>
')
    .attr({
      id: 'portal-distance',
      title: 'Double-click to set/change current location',
    })
    .on('dblclick', window.plugin.distanceToPortal.setLocation);
  $('#resodetails').after(div);
  window.plugin.distanceToPortal.updateDistance();
};
window.plugin.distanceToPortal.formatDistance = function(dist) {
  if (dist >
= 10000) {
    dist = Math.round(dist/1000)+'km';
  } else if (dist >
= 1000) {
    dist = Math.round(dist/100)/10+'km';
  } else {
    dist = Math.round(dist)+'m';
  }
  return dist;
}
window.plugin.distanceToPortal.updateDistance = function() {
  if(!(selectedPortal && portals[selectedPortal])) return;
  var portal = portals[selectedPortal];
  var ll = portal.getLatLng();
  var text;
  if (window.plugin.distanceToPortal.currentLoc) {
    var dist = window.plugin.distanceToPortal.currentLoc.distanceTo(ll);
    dist = window.plugin.distanceToPortal.formatDistance(dist);
    var bearing = window.plugin.distanceToPortal.currentLoc.bearingTo(ll);
    var bearingWord = window.plugin.distanceToPortal.currentLoc.bearingWordTo(ll);
    $('#portal-distance')
      .text('Distance: ' + dist + ' ')
      .append($('
<span>
')
        .addClass('portal-distance-bearing')
        .css({
          'transform': 'rotate('+bearing+'deg)',
          '-moz-transform': 'rotate('+bearing+'deg)',
          '-webkit-transform': 'rotate('+bearing+'deg)',
        }))
      .append(document.createTextNode(' ' + zeroPad(bearing, 3) + '° ' + bearingWord));
  } else {
    $('#portal-distance').text('Location not set');
  }
};
window.plugin.distanceToPortal.setLocation = function() {
  if (window.plugin.distanceToPortal.currentLocMarker) {
    map.removeLayer(window.plugin.distanceToPortal.currentLocMarker);
    window.plugin.distanceToPortal.currentLocMarker = null;
    return;
  }
  if (!window.plugin.distanceToPortal.currentLoc) {
    window.plugin.distanceToPortal.currentLoc = map.getCenter();
  }
  window.plugin.distanceToPortal.currentLocMarker = createGenericMarker (window.plugin.distanceToPortal.currentLoc,'#444',{draggable:true});
  window.plugin.distanceToPortal.currentLocMarker.on('drag', function(e) {
    window.plugin.distanceToPortal.currentLoc = window.plugin.distanceToPortal.currentLocMarker.getLatLng();
    localStorage['plugin-distance-to-portal'] = JSON.stringify({lat:window.plugin.distanceToPortal.currentLoc.lat, lng:window.plugin.distanceToPortal.currentLoc.lng});
    if (selectedPortal) window.plugin.distanceToPortal.updateDistance();
  });
  map.addLayer(window.plugin.distanceToPortal.currentLocMarker);
};
window.plugin.distanceToPortal.setupPortalsList = function() {
  if(!window.plugin.portalslist) return;
  window.plugin.portalslist.fields.push({
    title: "Dist",
    value: function(portal) { if (window.plugin.distanceToPortal.currentLoc) return window.plugin.distanceToPortal.currentLoc.distanceTo(portal.getLatLng()); else return 0; },
    format: function(cell, portal, dist) {
      $(cell).addClass('alignR').text(dist?window.plugin.distanceToPortal.formatDistance(dist):'-');
    }
  });
}
window.plugin.distanceToPortal.setup  = function() {
  // https://github.com/gregallensworth/Leaflet/
  /*
 * extend Leaflet's LatLng class
 * giving it the ability to calculate the bearing to another LatLng
 * Usage example:
 *     here  = map.getCenter();   / some latlng
 *     there = L.latlng([37.7833,-122.4167]);
 *     var whichway = here.bearingWordTo(there);
 *     var howfar   = (here.distanceTo(there) / 1609.34).toFixed(2);
 *     alert("San Francisco is " + howfar + " miles, to the " + whichway );
 *
 * Greg Allensworth
<greg.allensworth@gmail.com>
 * No license, use as you will, kudos welcome but not required, etc.
 */
L.LatLng.prototype.bearingTo = function(other) {
    var d2r  = L.LatLng.DEG_TO_RAD;
    var r2d  = L.LatLng.RAD_TO_DEG;
    var lat1 = this.lat * d2r;
    var lat2 = other.lat * d2r;
    var dLon = (other.lng-this.lng) * d2r;
    var y    = Math.sin(dLon) * Math.cos(lat2);
    var x    = Math.cos(lat1)*Math.sin(lat2) - Math.sin(lat1)*Math.cos(lat2)*Math.cos(dLon);
    var brng = Math.atan2(y, x);
    brng = parseInt( brng * r2d );
    brng = (brng + 360) % 360;
    return brng;
};
L.LatLng.prototype.bearingWordTo = function(other) {
    var bearing = this.bearingTo(other);
    var bearingword = '';
    if      (bearing >
=  22 && bearing
<=  67) bearingword = 'NE';
    else if (bearing >
=  67 && bearing
<= 112) bearingword =  'E';
    else if (bearing >
= 112 && bearing
<= 157) bearingword = 'SE';
    else if (bearing >
= 157 && bearing
<= 202) bearingword =  'S';
    else if (bearing >
= 202 && bearing
<= 247) bearingword = 'SW';
    else if (bearing >
= 247 && bearing
<= 292) bearingword =  'W';
    else if (bearing >
= 292 && bearing
<= 337) bearingword = 'NW';
    else if (bearing >
= 337 || bearing
<=  22) bearingword =  'N';
    return bearingword;
};
  try {
    window.plugin.distanceToPortal.currentLoc = L.latLng(JSON.parse(localStorage['plugin-distance-to-portal']));
  } catch(e) {
    window.plugin.distanceToPortal.currentLoc = null;
  }
  window.plugin.distanceToPortal.currentLocMarker = null;
  $('
<style>
').prop('type', 'text/css').html('#portal-distance {\n  text-align: center;\n}\n.portal-distance-bearing {\n    display: inline-block;\n    vertical-align: top;\n  position: relative;\n   height: 1em;\n  width: 1em;\n}\n.portal-distance-bearing:before, .portal-distance-bearing:after {\n border-color: transparent currentcolor transparent transparent;\n   border-style: solid;\n  border-width: 0.75em 0.4em 0 0;\n   content: "";\n  height: 0;\n    width: 0;\n position: absolute;\n   top: 0.15em;\n  left: 0.15em;\n transform: skewY(-30deg);\n -moz-transform: skewY(-30deg);\n    -webkit-transform: skewY(-30deg);\n}\n.portal-distance-bearing:after {\n    left: auto;\n   right: 0.15em;\n    transform: scaleX(-1) skewY(-30deg);\n  -moz-transform: scaleX(-1) skewY(-30deg);\n -webkit-transform: scaleX(-1) skewY(-30deg);\n}\n\n').appendTo('head');
  addHook('portalDetailsUpdated', window.plugin.distanceToPortal.addDistance);
  window.plugin.distanceToPortal.setupPortalsList();
};
var setup =  window.plugin.distanceToPortal.setup;
// PLUGIN END //////////////////////////////////////////////////////////
setup.info = plugin_info; //add the script info data to the function as a property
if(!window.bootPlugins) window.bootPlugins = [];
window.bootPlugins.push(setup);
// if IITC has already booted, immediately run the 'setup' function
if(window.iitcLoaded && typeof setup === 'function') setup();
})({"script":{"version":"0.1.1.20150917.154202","name":"IITC plugin: Distance to portal","description":"[jonatkins-2015-09-17-154202] Allows your current location to be set manually, then shows the distance to the selected portal. Useful when managing portal keys."}});
</script>
<script>
(function wrapper(plugin_info) {
// ensure plugin framework is there, even if iitc is not yet loaded
if(typeof window.plugin !== 'function') window.plugin = function() {};
//PLUGIN AUTHORS: writing a plugin outside of the IITC build environment? if so, delete these lines!!
//(leaving them in place might break the 'About IITC' page or break update checks)
plugin_info.buildName = 'jonatkins';
plugin_info.dateTimeVersion = '20150917.154202';
plugin_info.pluginId = 'player-tracker';
//END PLUGIN AUTHORS NOTE
// PLUGIN START ////////////////////////////////////////////////////////
window.PLAYER_TRACKER_MAX_TIME = 3*60*60*1000; // in milliseconds
window.PLAYER_TRACKER_MIN_ZOOM = 9;
window.PLAYER_TRACKER_MIN_OPACITY = 0.3;
window.PLAYER_TRACKER_LINE_COLOUR = '#FF00FD';
// use own namespace for plugin
window.plugin.playerTracker = function() {};
window.plugin.playerTracker.setup = function() {
  $('
<style>
').prop('type', 'text/css').html('.plugin-player-tracker-popup a {\n    color: inherit;\n   text-decoration: underline;\n   text-decoration-style: dashed;\n    -moz-text-decoration-style: dashed;\n   -webkit-text-decoration-style: dashed;\n}\n').appendTo('head');
  var iconEnlImage = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAApCAYAAADAk4LOAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAo1SURBVHjanJR5UJNnHscfp7ud7mxnt7u2M+3O9pruzPZ9k5CTHCQByRtCwpWDkIQr5BDU1a7Fiq0V3ogXiCBauVGQQ0AOkUMIoVLvWl1t3e1qW+tVtdt2tVKsMqXW7/4R1OqI2n1nPvPMvL/n9/vM87zzfckL8unkT8I/EPmcV4i1XkLMVSJiqhQRY6WAuJoY4ns3i8RV8mhztchirhFlm6qEBaYq4cKk+lBrepuab64SEUutmCRUCIh7WySxN8pJwgYBMZYJiaVWTCw1YkKmkpgqhcRRFybJbI0pSKjmf2jdFPq9vVF2I6VVAUeT/KekOuk1y0bxcVOlsMRcIw77fyQvGSuENZaNoh/S25WYO2zAwn0WLNpvxaIDiVi034qF+yyY924MPN0zYK2T3IjbELLZ1TnjL48kMVWKwhMqhKfT29V4fXcCcg5aMH9fLObs0iJrJBKZIzOQNRKJ2bsYzN8bg5yDFmTvMcLZoYapSnTeVCWKNpYL75Y8L5tOnuM/ReRzXiGJmyRmU6VwLHMHg5yDFszbrYd3OByegBplHy1B2UdL4A2EwxsIvvME1PAOh2PurmjkHLQga0ALY6XwekKZMOUuycvqZ8jzsulE/rdXpOZa0eiswSgsOJCAzOEIuAdV8PjV8PjV2HmuC+M/XkPpkYXwDqnhGVLfrrkHlZg5HIEF+xMwZygaxnLB98ZyocpSIyaWWjEh+kIe0Rfyfhe7NuS4uycC2Qfi4RlS3xEMBhk83QIAuImbaDm+Dp5B1e1aUKSCZ0iN7ANx8PTMQPw7gs/i1wt+H1vMJySuVEBi1/KXJNVLkb0/HjMDEXDtUME9oA6yI7jekpwePY4bN39E48fFcA/c2ecaUMG1QwXvUDhe3x8Pe4MM0QVc9iXVM4TElvCfiS0J+XqWX4s5I1o4e8KQ0auEq191F/5TbQCA7GEz6o4V4sOv9sHVr0RGvxIZfUpk9AZx9oRh9giD2QEtDEUh/w31vvwsiSkKSbNUSzBvrx6uPhWc25Vw9iiR0TPZ2KdCRp8KQ6e3AgAW7bQja0CL1/xxyNzBYNe5HuTstMPZEwZnT7DX1afCa3v1sNRKEFfKdxJ9AbcprV2J2e9pkdqlQNq2MKR3hwVlk0JnjxJdJ2oBAL2fNcDbGwnndiXKD7MAgAtjZ5DtT0R6dxjStoUhtUuB2SNapLWroC/kNRN9Ifegpy8cXn8EUtrlSO1UIK0rDOnbJukOg7dXg+whC3KG7WDf82DeQBzSu1W4MHYG/s+3ovmf63Bu9CRKDuQgtVOBlA45vP4IuPvCoS/kHSL61byz3sEIuPrVSOlQILUzSFqnAit3zcXhC7twZfwSrk1cxcWxMxg+1YW8EQ/SusLQe6IRR77cg/qjawAARy7umZQo4O5XwzsYAf1q3jmiX8276PVHIKNXCUeLDMltcszarseeswO49Vy69hXOXPkEX109j5s3fwIA7DrTB1fXDKzbvxinvj2BzUeLkdUdjeQ2ORytMmT0KuH1R0C/mneRRK/kHsroCX7cxQNO9J/YgtHxywCA/hNb8Ea/DeltKqS0KZC6NQx/7zOj9Vg5rk98j2+vf4OaQ6uQ2qpAcqscya0yOFpksDdLkdGngnO7CtEruYeJbhmnzdEih9uvRmZHNDYdKoL/03bk+t1IbpEjuy8Js7oMcLap4e7Q4C2/E2/7XZi33Yi6w2uwft8SOFrkcDQHhzu2yGBvksLtV8PRIoNuGaeTGFbz5hnLhPAEwuFolsLeFMTRLIOjWYbi3Yvw0cX3ce7KSZy6fBzvnuzGwr4UOLbIscTvwenLn6DjWA3SWlQ/65XCGwiHsUyImDUh80nUMi4VvYo34epXIbVdAVvjHZG9SQZHkwzuNg3e6E2Gu00LR5McjiY5FvTYcPnaN6h+fyUOnB3GgbMBeLYysDVKkdqhgKtfhehVvAndCi6HROVzpjEsHbA1SJHRr4J1cyiSJrE1SGFvkMHeIENasxqNh9dj/5kAGg6XImurHhe/O4eWI+X4x/m9qPugGEmbQ2GtD4VrhwpJm6VgWNqvW86dRnTLuITx0cmGIl6w2CCFtS70DvWhsNXJMLfdiIkbP2Dnpz3wtETBVi8DO5AVDOi/mmGtC0VinQS2Rincg2oYinjQsHQis5QmRJNHEU0e9aQmjzqV3CZHaocC5hoxLLV3SKyVYHZrPMbGr+DtXjestaFIrJUgZbMa/uMdcDUxsNSKYa4RI61LgeRWGTR51AmGpZ5gWIoQhqUJw9IkMpfKj1svQEafMji85m6yWmIxNj6KJb1eWGrE8DTrkFgbitR6dXBPtRiJmyTI6FMibi0fmjzqTW0+h2jzOYRE5XNu8SLD0peT2+RwtMhgqhLBXC2+TeaWoOTtHi/M1WJ0Ht2EWS3xt+umKhFSJnsZlvoP46OfZXw0YXw0Ibrl3NtE5lEFsWv5SO8Og7laBFOFCKbKIJlNMRgbH8Xibg9MlSIEjm/D+hE2WK8QwVIjhnN7GGJKQqBh6dxbp9Dmcwi5ZZvkOQ1Lf21vlsLeLEVCuRDGiiAzGw0YGx/Fm9tcMFYIcfKbf2PFwHwYK4RIKBfCPpkxhqXPa/M5Tz9IQiLzKDamOARpXQqYKoUwlgWZ2WDAd+NXsGBrMtYGluDL0S+QUhsMnKlShLROBQxrQqDJoxf+XHBfCeOjn2ZY6oKtUQpbYyhiS/iIKxXAvVGPS1e/RtsHNRgbH8W6gA9xpQLElvBhawzmSsNSpxkf/dS9M8m9Vm0+h2hYOsewJgQp7XLErxcgppgPZ3UUro5/BwA4+Pl7iC3hI6aYj/j1AqRslUO/mgfGR7+mW8Yl93K/kxDGRz+lYanT1k0SWOskMKwOQXqlFtcnrmHixg+YuzkJMWtCYCgKCYZwowSaPOpTTS71pCaXIvcylYRoWHquvpAHxxYp4kr5SK+Mwo2fbqDvaBsMRUFB3DoB7FukiC7gITKXyryfQJNLEaJbwZ2K3zIs9Ym5Oph6V2UMvrh0Cq4qA/SFPEQX8JBYK4a5SgwNS33M+KjfMD6K3A8yVYHxUUTDUt7oVVzYGkKRUhGJ5duybwtiSviwNYRCt4ILbT7HqSvgEd2q+0O0SzlTk895QpNHHTNOhk23iovoAh50q7iw1IhhLBciMo86qsmlHp/8B94XMtU9/owU3QourPUSGIpCoFvOQcyaEFjrJIhawQXjo23apTR5EORhG7RL6V8zLH04YYMQpgoRdMs5MFWIEP+OAIyPPhi/QfCrhDIBeRAkYYPggRjLBURfyDNH5XNgrhYjtoQPc7UYUcs5iHjrVWPEm38lD4NEr+Q9nBXcxzQsvTd2LR/WTRLElfIxY/Gru19SPv3Yn0P/SJ6XPphHuS6iXUoThqUMUcs4MJWLELWcg8hcSi9Me5HwU14ggodAGJZ6NHzUNMZHD0ct44Dx0QHGR0+LmjpjdzFl4qdAy7D0BOOjtb+k75dKHmd89MzJ9ZH7/jcAhElqPD31+5YAAAAASUVORK5CYII=';
  var iconEnlRetImage = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAABSCAYAAAAWy4frAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAABHoSURBVHja3Jt5cFNHnseVndTOVmpma7eytVWzU5Odqq1NDc+SbUmWdfgg5glLIDyy5EPC9wFjrnHAOCSZgN8ax5EDcRIzLhsLfIAd+UBgG2NsbEwsH5BwJAESCARCIBBCgADmNNd3/5C6/WQdOAkkMF31LY7X3b/fp3/vPXX/up8AgOAfQQ+9xFWH/M5olcria2WGuOqQXKNVusJolb5jtEoXG63SxPhamSquOuQP+cPGXwkep7Llq/VPxVWHKIxW6Vtx1SEnjFYpJqgLcdUha4xWabTRKn36FwMwWqX/ZbRK3zZapafGOxlXHYKEOhnMNjlSW1VIaw9DUrMCpvpQxFWHeIO6aLRK18ZVh/zPzwagrxA/Y7RKOaNVep3vjNkmR3ZPJBYPGfDqLrNf5Q8bkdMfhWS7cjzYqKFK8pa+QvxvjxTCUCVJN1RJzhiqJDBUSZBQJ0N2r9P5l3cmeGjJzng3+aqT0x8FU30oSL+GKsl5o1U6/6E/R/py8T/HVkpqYisliK2UwGiVIqs7AvnDRjen8ob0WDCgxTyHGjn9UZjVN9lNOf1RyOmPwnxHNPKG9B5w2T2RiKsOAbETWynpNNWH/vZhvYWeja2UOEjnqa0q6sSSnfHIHzZiwYDWq+MPEoFaPGSg/S0eMiB9cxgf5oC+QvzcT30e/hRbKTmmrxBDXyFGdk+kB0B2b+RD0XignP4oxFZK4LJ9NrZSEvqjIGIrJX+MrZR8p68Qw2iVYp5DTY3kDuowq28ysnsiPZT7/gwMnN6Civ0FXq/706y+yVgwoKV25juiEVcdAn2FGLGVkmv6CrHoh75af6OvEO8nELmDOuQPG5E/bMQ8hxpZ3RE+tcSRAFKGz3RhQZ8W2dsiqLKI/PSR0x+FxUMG5A8bsXBwBuJrZSQyX+pKg56dEMRzimef0peLW/XlzttpnkONxUMG5A3pMatvsl8Hsroj8JIjAaN3b1GYkyNHsXQo7YHtxmtW32TkDemxeMiABQNa521WLoa+XLxjQj+g+nJxoasB/V3IG9IjuzfywQ50ReClfncQALg6ehmle/KQ1R3u0sRgsnsjKUxOfxQBgb5C/LZfCF1p0PMxZcF3YsqCkdYehrwhPfKG9Mjpj0JmV4RXZY1TvhcQALhz7zbW7C9CZlc4T2PtfPVPIpM3pEdaexhiyoIRUxZ8N6YseJK/aGyKKQuG0Sqljec51D6NZG71VP773kEA4D7uw/rJcmRuDR8n3yCZXc5nhvgTXytDTFkw9OXiLb6iEaYrDYKuNAjZPc6Q5g7qkNEZ7inieKen8nfEu4H0nrCj81gDLt08DwAYvXsLywbSvffrRwsGtPQ5JX7qSoOmeAPZpSsNQkKdDAsHZ2Dh4Axk90QifXOYmzK2hHuqc+zvi/vcQZYNpCNjSzgWbTfg0/O7AQBdx21e+0nfEu5hjyirO4L6ZaoPJSAfPad49ik+RAihzOmPwsLBGZjnUHvvtCMM6R3hSO8IRwbRFt8grw/NQUaHs13N/jcBAFUfL3f1M06b/Yv4ltMfxY+Kig/yhq40iP5m5A7qkNkVgbT2MA95goW7KW+7O0jR0Bxat/SDfFiG57u1b/28GhV7C5C2OcyrPb4yuyKof0arFLrSIExfGbiSgkxfGXhk+spAJNuVyB3UYZ5D7dlRmxcoD7Bw5PW6gxQ4MpHuw8n0zRH45upJAMCq3a85bbSpxuSlzTyHGrmDOqS1h2H6ykBMXxn4BYmGcNqKQExbEYic/ijkDuqQ3ROJ1FaVVzmNeQdLaw9DXm887ty7TUE2Hl7jPhg8/X33Ulrv9r1RlH34qk+7RNk9kcgd1CGnPwrEb11pkFCgLREtnrYiELGVEiwY0GLBgBaprSok25VUKZtUSNmkQuomP1AuLdxmwMjoZdy5d5sCfXi6D3M7NUhtG2s7t3MaLt445/GKXrvvDaS67KVscvcj2a5EaquK+mmokhCYJQJtiWiVtkQEU30o5juiMc+h9micslGJlI0qpwiQFzCi3C49Fm2Lw+KeeLyyPQmNB8vReLB8rM4mFdoO11Dnmz+tROdRG/137ccrkbJRieSNSg9fku1KOv031YdCWyKCtkS0WqAtEW3Slohgtskx3xFNl6AeMOOBNqqQutEdKqv9Bczp0CCjLdIddpMKczo0YyO9UYUzI18BAA6e2+3qT4mSwRdxdfSy882253WvfvBBzDY5tCUiaCyizQKNRbRbWyJCaqsK8x3RyO6J9NmBG5RdhRS7Csv6srDlSAOOXNiP89fP4sqt73HxxjmcvvIlhk52o+ajFXhxa6zbAKRsVKHnmB0A8PWV48jvNiHZrsTcDvfbzZf97B7n+iW1VUUisk+gLRF9o7GIkL45jE7RPRpv8NT/7ZiN3affx/379/CgcnX0CvqOt+LlniSkuPpMs4dj42drAQA3bl9D++F1OHPlBG1z/PtDSNrgHSSzK4L+zmksImgsorMCjUU0orGIkNEZTudVSc0K72pRIKd9GrZ90TIhgPHl1p0baDtUi5x2DZJblEhuUcLieBGXb16gdW7cvgb7p2uQbo/06QcByegMJyAjAo1F9JnG4ry1SETMNrmbZjYpMLNJgaId83D26imvk8Fvr36Nz87txQentmPXqV7sPe3Al98fxs071z3qfzNyElzfbCQ1K5HUrMT8zTHoPtqMrqNNWLw1kdqb2aTw8MVskyOr2wmS2qoiIIcEGouoU2NxPuzjQbI2sMi2q7GoIwEdhxtw9/5dN4eOnD+AdfvexivdqUhviURSk9Kp5jHldhhQ+WER9p/9APd4URy9ewstB1bjxQ4jkpoUSOI5P7NRgZmNcpgb5X5BzDY5AekWaIqFFZpiIeJrZcjpj0J2TyRt8PfhAlwbHfEY0Us3zqNiV6HLoAJJjQokNSrH1ORdr23LxL7TAx79fXRmCClNYWMANv/K7olETn8UjFYpNMVCaIqFVoGmWPiypliImLJgmneit5RNgeo9b+LC9W9x9/5dXLp5ATuOteOvbXrMtCn8q1FJlUT/7gR/05GHj84M4eSlL7D39ACWb5+LmTbebfSeSz5AiJ8xZcEEZKkgukgY6foHsnudmYxkuxKm+lCqjKYXsKg9AVkt6jEj78mR0fwC3h38G17ZmorMlilIsqkw870xmNSmCPy1TY+3HC+h71gb1u97BylN4R7QZpvCrV9Tg9zNPl/JdqUzg9MbSSCgKRZOE+grxE9rioWXNcVCWimzK8JnR6b6UJgb5DA3yDHTpsQ7g3/DuauncfPODZwdOYUvzn+Ko+cP4tiFz3Dx+jnX2+omWvZXIa0xwgnq0iy7Bh+fGcbBs7vxet8CmBvkMDWE+rVNlr/JdiWBuG6okvyLQCAQCKKLhHZNsRCGKglNMkwEhGjuRh3sB9bgwvVv3e79M1e+gv3AWixo1cPcoHBTetMLOHTuI7f6/cc7kNXM+rWd3eNM6BmqJASkg07jo4uE2dFFQmgsIpr5I9sAXkHq5TC5ZOYp1RaORe0JeLUzHbmtcZhZr4S5XuGuBgUymqKw52uH81V85SRWDS7D3q8HAQAnLn6Ohe3xXu0mNSuofxqLCNFFQkxdHjCHgkxdHvD7qcsD7k9dHkCnAGntYX5HxrRe/gApYFqvgJmnmQ0qmOsVsO6y0MzKki2pMNc7B+34hUMAgIHjW73azOgMp1OoqcsDMHV5wD1NsfAPbmv26CLhVnVhAGLKgpHdM3Z7JdTJvCpxXShM6+ReZV6nQIZtCnJadJhvj0VRzwJs+9yONbtKYF6vwLKuWbiP+7h3/x4qhouQuE6O1zqzcH30KkZuXUJem8nDHr2teiKhKw2CujAA6sKAdo/kg7owQOe66EbuCyShTobEulAk1sk9lNOsw7cjp3Hrzg3cvXeHTk8WtSbCtE4B0zoFNnyylkalYe8qnL92FgBQsn2RV1tkUZW+OYxAQF0YoPYAiS4S/hPLMSdYjqH7Hxmd4YivlflVQm0oEmpDkVgrR6Lrz/kb9BRg9O4t7DnpQF6rGYm1cpjqFLTuzhPb3R726g9W+rRDso9GqxQsx0BdGHDIZ4KO5ZiXWY6BplhIG5J9P3+Kr5EhvkaGhJpQJNSEYl6zHrfu3AQAWIctSKyRU5E68TUyzGrU4srN753PxbEun/2TaUlWdwSii4RgOQYsx8z3CTJl6aT/YDnmFssxMNWHIqs7AqmtqgeCxFWHIG5tCOLXyhC/VoY5zTEUpKx/GeKrZU65rsetHWu388R2jNy8hLSGKT77TmsPo4PqgrjCFkz6jd/8L8sx61mOwfSVgcjqdqYs42tlE91yRtyaEOQ0zqAgq/o5xK0JoRpfv+9IOxp2l/vsL6Fu7LbSWEQEpOyB2XiWYxSuyki2K5HV7Vyf/ID9c/zFphsDeb/Ab91FdjNM1Uqf1/k+uPy6ry4M+N8J7ZGwHLOP5RjElAXT3OvDAnmzJx/JtRET6ie+VkbtT18ZSEC6JrxjxXJMEj8qGZ3hPygq/kBa9q1B3+ftE+qH2Dbb5AQCLMdMmTCI61V8kOUY6EqDaCbRaJXy98J9avZ708ce9vcL3K4VdOQAABZuMPntI75WRu1OW0GjseMHb4ayHGMgo5DUrEBaexjMNjl/29inZtfzQPoK3K692JwIAGjcs9pvH8l2JbVJ/FAXBoT9qJ1dlmP2kKiQtKfRKv1JIFzHXOdM90inz/bxtTJqT1tC31Rbf/Q+O8sxGjIaZpucjhDZd/elWeunUZB3+5a5XWvZ65yatH1S77M9scX73YC6MED6kw4NsBwzyHIMpq0IpClPo1X6o0AMlVKcuHAUAPDO9qVe2xqtUmqH97ux6Scf4WA5JpKMiqk+FKmtKmdUyA6rF81axwPpXUb/37I1j64Ys+u0XtuSo1EJdTICcU9dGCB8KOdRWI7ZxnIMSGo1tVUFQ5VkQiBl2wugLxdj9jodvhtxznB7P2v12s5HNGwP7XQQyzEyb1FxbRV7KKtGS0EsnYuRYo3CqYtfAgBGbl5Gds00r+1INOKqQwjEXZZjnn+oR51YjmljOQYai4jmYA1VEv5eHlWGVYPRO85dq9qBd/H5NwfoVH1F5yte2xiqJLRfTTGd4dY89ENn6sIAEcsx91mOQXytjKaMfIGQiNy+O0ohPjze77W+rjQIZpscyXYlXW+wHHM7ukj4x0dygo7lGBtZr/iLCh9kLIF9Ezk1+gdGg7feqHhkRwFZjnnedd/CaJXSTItrU5IqvUqDW7fdQWw7V3vUIyIZkthKCYG4OWXppN8/0nONLMdUk6iQNL++QuwX5Lsr3yBhlcorhKFKgqRmZ7qUF423H/kpU5Zj/pvlmFGWY2CoksBsk3tEZTxIZZ/FbzTIHM4FcW3K0kn/+bMcmWU5ppzlGEQXCWliWV8hptvFaavHQE58dxR/Lg2h1/giA2G2yTF1eQABeeNnO/urKRb+juWYGyzHILZSQhNorv08pFVE09fv662L6P/zNW1FIG2nLxcTiMtswaR//1lPYrMcs4LlGExdHuDmkLZEhPRKDQBg34mdmFYS6BVEXy6m7dSFNBoFP/uRcrZg0rMsx4ywHEOdSqiTQVsigmlVJN4bXg3TqkivEGRfn/wOuSAuaCyi3wp+icJyTKGvqPgTH5wXjSW/2EF/dWHAv7Icc5EsvvhRce3teUhbIqK5XF5C4eyUpZOe+UU/uyDZSXVhAHVQXy72CeIjGrm/+PcjU5ZOeoblmG/J4osknTUWEX9rzCmLiF7nJRROsQWTfv1YfAzDckwuiUp8rdNR3kYllb5cjIQ6GeKqQ/jR+Mtj81UPWzDp1yzHnOJHJa46xAOEfCDDSygc11eInxY8ToXlmNkkKiRny49KTFkwEupk/Gk6WI5JEzxuRV8hfprlmC/Ikph8qUNAyCdLvGgcfuHVP/1K8DgWlmOSyWgbqiT0ACU5+GmokvCjkSh4XIsr1fopWRKPz+XyEgqfuJ3XfUyjYiSjTj5jItlJXjT+LHgSCssxe8dHhReNDwVPSmELJmnJ6JOcFS8aUwVPUmE5ZogsiXnpHYfgSSssx0zmRYEoUvAkFpZjengQ2wRPamE5JpQHEip4kgvLMe0sx7QLnvTCckwQyzFBj9rO/w8AsWfTZcVFvbEAAAAASUVORK5CYII=';
  var iconResImage = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAApCAYAAADAk4LOAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAArHSURBVHjanNV5UJNnAsfxx6W13dnObv/ourbTVlvbrhy5CUe4PQCPerS6oy3tTrfdEUkAFQGRKwlXCGcScnCoIMSDehURrUfRahXeJO+bhJAgVRSUCihaQcCi3d/+kdZ1ul67z8xn3pln3nm+zzPzvvMQQkAIAZkZ3kmClF8SXs5eIpQ2Eb/sZsJXf0vePNFFRBlNXkJ5ywf+8pb1QllLgVDWsjEgv2VFeHkTRyQ7RkQ5hwk/6yCZV7GfBCm/IsLMAyQ4s4VESE+ScGkrIY+LCKXNRFh4zNez5kxBYHYzI8o7cidUcez+nKJvEKo4/nNQ/pGxgNxDTn9pS0mgvEX0/0Rm+mY3VYnkLT8tKD6JFTUWxNQ78ElDJ2KMTsQ0dCKm3oGVNTQWqE5DlHv4Pj+jqXauZv87zxQRyPeFCrO+6oksbcXqWhtijE6srHVgSY0di6ttWFxtx5IaO5Zt7cDKWgdiGpz4qM6OqNJT8Jd9dUUob4oSZj0uEuYkQYrdy/2kTSNLdOcQY3Rh2TYHogxWzNdbEWWwYkGlFQurbFhUbceiajuiDe75pVs6EGN0YamuDX7ZTePCzH0fBWUe/k/E44VJ4vHCJHlzboefKH/3j8sNFFbXuxBdacM8nRXzde5I5C+h6EobFlTaEG2wIVJvxTwdg7laBtGVNqyud2G5wQRh5v47osyW4AhpKwmXnyBEsOEgEWw4+Ed+6n7nQvVprNruhLV/FJeGJ3B+cAznB8fQPTQO58AYkpsuIEpvRWxjF6xXR/H99fEH7/QMT8A5MIZV251YqD4D3/S93QEZ+/8kTG4mRJi+hwjSd6eHFbRgVZ0TUQYbLt+cQPzebnxS78RnO7rwjx1diKl3QvxlN9ou30Zy0wWs3u7A5zu68NkOFz41OvH5ThdcA2OI1Fuxqq4T4YoWsJMOZHlMvUeIcPOeP/tubhxcpjdhSbUD4RoGroEx/N3ogrlvBD03JnDxxjh6hifQ/+NdFJ3oxaUbE7g8/Mv8jQnY++/gk3onqN4RhKkZvF/twDKDCfzUvddfC+2YTvhpO2OC5U1YsdWBCA2DUDUD57UxxO4+j5GJ+6g+9wPyj/ZCebwXX7uGcdQ1jNbuW1Ce6EP+0V6oT17FxOTPiG08D6p3BKFqBhEaBiu2OhCScxBCad2nhJ9irI8sbsWSageCy2mEqBg4B8bwxc4ujEzcR4NpAGFqBmEqBpFaK3aaB/FBTQdCVTRCy2kYzvTj7r2f8VmDC+2XbyNURSOknMaSageiSlrBTzU2EH6KsW2R+iyi9B0QldIIKWdwfmgcy2sc2NR0ETfH74G5MoqVWxwIKaMRUkYjqIzG0qoOnO25jdG795F16BLC1AwsfaMILqMRVEojSteBRZpz4KcYKSJIMV5erKUwt8KG4DJ3pHtoHCu3OBBazuDjuk44B8YwOPITGukhMFdHcchxA1du3UX30DhitjsRUGxBhMoKy5VRiEppiEpozKmwYbGWgiDF2EsEyQ39CysoROrsiFBbEa62ontoHCt+2XlQKY1wFYNdlkE8PA7YryOsnIFQaYFfkQXhKgaWvhEEllgQUGxBuNqKRRUUBMkN/YSXVEtFlX2HRZWdiKywI0LljnxY40BQKQ1RMY3AYgv8iyw4aL8BADjmugl/pQV8hRkChRlCpQWh5e6IX5E7OkdjQ3TZd+BtqDUR7rqqXREFx7G0ugvRug5EqBh0D45jeVUHAoosCCiywE9pQXgZg7ZLtwEAzJVRzFNZwcs3g1/gDoWUMjD3jUBYZIGv0oL5WgfmKI6Dm1izhwiTSyUB6fvxvsGBaJ0D4SorugfHsMxgh7/SDKHSBF+FGfwCE9bv+R4AkNV8CZw8E7h5JndIYUZwKQ1z3wh8lRYIlRYs1HUgMGMf/JJrEglvncGTv6F2MlptQbSuE2EqK84PjuF9nQ2+ChMEBSbw8ihw8yhIdncDADYf6AErhwI71wROvhncAjNEJTTMvSPgKcwQlTBYoDGDt2HbJHvdFm/is143xSdeezQs7yiitJ0QFTPoGhjDQq0N/HwTVtV0QnboEtY1fo/ERvdJ0g70wEdOgZVrAjvXBHaeGYHFNEy9I+DmmzFX04GwvK/BluiPsBNrppCpWTLyalLRav8kIyI1NggUFrgGxjBfbQMnz4Tac9cAACe6bmGt0X2StP098JZR7lCOO+anpEFdHoFAYUGUxgbBxnqw4vQfciSVhHBi9YQbq3+JLdZdjCg8BVGJDReujyO4hIFPjgl1bQO4NX4PSXsuQH+qHwCQuu8ivGQUvGUUvOUUfOTu01ivjCK41IYIxUmwxFqXd5z2Re84LSF8sYHwxQbCWauV+ac1Yq7ajrM9t9FADcI7x4Scll78diTvvQhPGeUOySl4ySloWq/C3n8Hc9V2CDftAltckcpNMBBugoGQaalFZFpqEflLctEMVrx+OEJ5Fgu0DtB9o9htGYKX3ISGdvePeHPsHgAgZd9DERmFqjM/4MLQOFbUuBBeeBpssf4aW6KfzpboCVuiJ4RIpYRIpcQjW0a8xOoCv02NiCizw7+QxqnuH9HcMQwfuQn5h3sha7784OvylFLwlFLYYRqE9eodzCm3YU6ZDb6pu8COq8jgSvTkV8QnXvcAR6x7lS3WDYYqvoWwkAErx4wWxzCOd92Cl4zCiqpOTN7/F9YYuzFbSmEfcx1tPbfhX0jDr9CKkPxTYEl0V1gJuldYCTryK8IWGx5giQ3EZ21Flm/KLoSW2uApNeG9bAp76OtovzQC/0IaS/UOcPPMONJ5Eye6boGdY4anzITQUisEyTvAEldsZCfoycMIN077W6+wxbqrwXmnICiwYlZGO97NorD17AAsfaOI1nTgmOsW9jHX4SkzYVZmO3wVVgTlngRbrOvhSCpf5kiqyMMIS1L53+K0yYLkHQgusuK9bAqzMtoxK6Mdqm/ct+C2s9cezP01m0JIkRX8jUawJdp4bqKe/BbhiKseofJllljbEyhvBS/Pipmb2/F2eju8pCYojvSBn2fB2+ntmLm5Hbx8KwLl34Adpz3PWat/ibNWT36L8MTaR+LGacS8JCNEhVa8k0FhZpp70QfS2vFupgkiJQNeUj3Yayv+yY7Vk0ch/ETD4/yBJdZ1+UtPgJPD4I1NbZiR1oY309zPNza1gZPLwD/7OFhirYMVp/u9T5yePArxklQ8lnec5nPehu3wK6Dx1mYKr6e6F389tQ1vpVPwL6DBW18H70T9p7OTt5DZG2seifhJNI8llGhe5MRV2PyyjoElZ/BaShteT2nDayltYMkZCLOOghWnpXlrKqfy1lSSxyH8NYYn4sTqPuKsr4Mwz4IZmyhM33gOM9IoCHPN4K6vhVd8+d/eS1CRJyGzE1RP8zxHrDH5ZnwNLymNaUln4SWlwU8/Al68ui0iM/e5iCw5eRIiypY9UZA0mwiSlctZCXXgyk2YlW4GV26Cz/qtCPm4fukHy/eSpR/ueSIyRZ71VB5SmYe3RHOat+kw+HkO8NKb4f1F1annnp/08CAgv3sKMi25+KmmbywhLLF2ASdxG7hZ34Gzbgu8Yyujp/lT5BVfy1MRXlzlU3HjDIQt1k9hS/TH2InbwBbrj/qIDVM4G1TkWRB2vO6ZceJ189hi7SRbop/364X0LAgr3vC/mMqKN3zBitdPZcXrybP69wCPvL4Dt2jlzAAAAABJRU5ErkJggg==';
  var iconResRetImage = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAABSCAYAAAAWy4frAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAABcCSURBVHja3Jt3UBxXnsfZPdfd1dbu1V3t1dXueu3dvfUqQk+CmSEHEYWyLdkKlq9qb73eZUAJgZAIQ85pgOmZgQEECCuBMkiyLVvBEkzq7gnIkmVJlpWtiBKSgO/90YEZQLLsldNN1bcaZl74fd7v9/q9fv2eFwCv/w967gXK8vf+OiCn288/r3uuMq87SZHbXaLI2VupyN27Spmzd4F/3r4Av7x9L83fvPmfflAgXsBPFHldSmVuV5kyr/uMMrcbz6hryrzuekVuV3SY+sMXvjeQQPX+3yiz91Qoc7rOKXO64C7/3G4EFexHeOkBRFcdQkzVIUSUfoiQovcQkNuN0emVOV3Xlbl7GgJyu/74nYHI1Lt+Js/dk6XI2XNPkbMHvMJLD2A22YvFrQ78z7vHn6o325yYazAjsuIj+Od2wa2ch4rs3WVi9bZ//1ZB5Nm731Jk776gyN4NRfZuBBXsxWxdL5a0OvFW+/ExWtrehyUbWC1t7xs3zZsbXJirNyOkcD/4chXZu79UZO9J+Dr96JkSTVVv/meFelejQr0LCvUu+Gfvwczao1ja5sJbG/oELWxxYl6jHbMaGMQbGMTpaQ/FGxjMrGcw12jHG+udWOqW960NfZhN9iAgtwt8PQr1rj2BxTt+8VxA5AWdv1Sodx5UqHdCod6J6MqDWNziwNINfVi6oQ+L21yY22jHdAODWD0taEY9w8mOGfV2zGywY1aDHbONDsw2OhCrpxFnoDHHaMeiVpdQ3pJWJ+KqD4OvT6HeZZepd738D4HI1LsmydW7TsmzdkKetRMztT14c0Mf3tzQhyVtLsxtdCBWRyPGTTxInJ5GnIHBdAPrnXgOiFc89z2fb47RjsWtLqH8eXoLlOpd4Oq+5KveJf9GIEr1tt/L1TuuyrN2wD9nN15tsArx/lqzE7F6BtE62lMkqxgdjVgdjVg9gzg9C+MhPYNY/QgEnz9GT2Nek0OoZ76RQkDuHsizdkCu3nHXP2O7z9cCCVNv/rk8czsjz9yOgJw9eKOJwZK2Pixp68PsBrtgsLuiOI2GieNhOMW5QQj5tJ5lzaq3Y0krW98bzXYE5nVBnrkd8sztp+Vpnb98JhAvL/xEnrFtmzxjG5RZ2zG/gcKS1j4sanEhXs8gSks/WW4wMSTnFR2NWB2DOE6xOoYNRy5tpJbCNC2FSC3lUdZ0PYOFLS4sae3DAiMN/6ydkGdsgzyj88B4A+gYEL+Mzmy/jE74ZXRiFtmLxa0uLGpx4eiZW/js2n2cuf7giTrL6YubA3BduovEjpOI4aAWt7pw5PQtnL81IKQ7+5SyPrt2H46Ld7GoxYXFrS7M0ZvA2yXP7Kx4Kog8rXOCX3rHY7/0DsRUHsKiFhYi3sDgUv9DAMDQ8DAeDz1Zg0PDuHj7IVJ3nkL0qJBZ2tYH6vwdDA49vYzHQ8MAgIHHQ5iuZwQ7YqsOwy+9A37pHYPK9M7JTwTxy+jo9EvvQFDubixscWJhiwuzGuyIqKNw4dYABh4P4c/txzG/yYn5TU4saOblwuuc3mh2IV5vF0JEc+g8OpiriHYLm4Xr+fTuZTgx3+3KXLiDR4PDiKijMKPejoUtLixscSE4rwt+6R3wzejYPS6Ib1pHoO+6rfBdtxWzSRMWrndhfqMTEbVs7F649RAPHg0h3mBHRC3loWm86kYUS9LYZLsC/tN79jZeb3Yiss4z3bRRZfEyfX4bj4eGhf9fbXRg4XoX5ujM4O2UpndGjAHxW7v5mO/aLQjJ68YbXMvGaBmE11CYVjsCMsNgxwyDHUdO34LlXP+4Mp/rx6kv7wMADpy8gTbzZQDA1TuPYH5CHl5L2/oQXkPB/Hk/Hg8NI7yGQngN25i8XaH5++C7dgt8122xeXnhJwKIfN1WX9+1m+G7djPmGWx4vdmFOQ0OhNVQiKilEV5D48KtAdYjegZzGxwYHsZXfnrO3kZEDYWIGgotpkt4ls/fNp9AmBtIWA0laHa9A683uzDPQIG312/dlgABRLZ2U4Fv2iYE5ezCgiYXFjS5EFFLI1TDFhCqocaA3Hs4BABgLtzBBydvjNGpL+/j0eAw0nefxputfbjS/xA37z/GgZM38cGJGx7qOXMbfLv8ddMJhGoomDiQUA0lKKKWFuwLzt0N37RNkKVtKh0BSdt4Qpa2EdEVH2FBkxNzGuwI1dgQVkMhRMOKB5k+CiRx60mEaagxml3vwPHL9wAAtx88Rv/AIP6y8ROEamwIrfbULIMdQ5yL3954AiHVNjcQm4fmNNixoMmJ2MpDkKVthCxt46cAvLx81270lq3ZCNmajZhroDC/0YlYkkZItQ0h1RSCqymEVLuB6BjMqXdg4DELUn/0IsLcWi20mvIw8My1BxgcGkbC5hNcmaNUZUP+vrPg7rj466YTCHYDGZ0+lqQxv9GJeQYKvN2+azd6e8nWtK+Spb6LgKztmG90Yr7RidBqCsFVNkGeIHbM1Ntx+8FjIa532L9EjJZB6CgDQ6psmG90ImHzCY/yeIVpKLSYLgvlDA0P483WPgRVjYAEV3vmCa2mBDsD1dshS30XvqntKV6y1HaNLLUdoQV78ZrRiTn1DgRV2TwU7AYyy+BAqIaCastJnL3+QDDCefEu3mrtQ8hogyttCBpHrxmd6Dl7W8h/uf8hVm07hcBKGwIrbejlQEbbElRlw+x6B14zOhFWuA+y1HZIU9t1XtLU9k5pygZElryP14xOzNTbPSutsiGkagRkpt7BhQ+FWQYH3j9xQzDm1v3HyO0+O8bowApPrew4hcvcTAEATGf7Ma/BiYAKm6DesywID+Ze3ky9Ha8ZnYgs+QDSlA2Qrt6w00u6us0kTWlDdMUhvGp0Io5kEFjJtmZQFYXgKmpckBDu++AqG2oPnRemFQCw2XYV8aQd72w8gQ76KvYdv46CfWfxeqMTuiMXPNI291xCSJUN/uVWTjb4u4PwDVA5ojiSwatGJ6IrDkGa0gZpSpvVS5rSelG6uhVx1Ucxr8GJ6DoGARU2wdCQKs/OPlPnGIGoHAmdpK0ncf7mgId3Rn8eDY4AXLv7CGt2fAZFmRXKMqtwVXJAvWfZkd3dS7yiahnMa3AirvoopKtbIV3deslLmtzaL01uxXRND+bWOxBZQ2NaLYMwDY2wahqh1TRC3UBmcCBC7LuFTLzOjvc/ufGVg57pbD9ebXBCXmr1kKJ0BKjnDAsy4qkRTauhMbfegemaHkiTWyFNbu33kiS3uCTJLYiqOIQ59Q5E1zGIrrNjWg2DiBoG4RyQO8gYiHIbAviKyqwwHLn4RIit1FUoy2zwK7GyKmav8hI3IDcQpZuneEXV0ZhT70BUxSFIklsgSW7p85Ikr98jWbUeEUXvY47Bgdg6BrGkg4OhEaGhEe4GEk/aWRAOIoCH4CssZf9uM13Gqav3BYCLtx6ig7qKSA0N32ILZEWsfItZ8WA8DA+icA87TrF1DOYYHIgoeh+SVeshWbV+r5dkZbNWsrIZwXldmG1wIJ60Y7rOiVitA5E1DKZpaIS7hVa81s5CuAH4cwAKTv5lVrxudGKX45pHOL1udCGgzAZZkQVSTrIiC2QcjC/vpZIREHcv8ZpO2jHb4EBwThckK5shXbne4CVZ2ZQqWdkEZXoHZukdmKV3YIbehTjSiahaOyKqqTEggeXWES+UjkDISyyQl1gQU8s8MbTebD4OaaEF0kILJIVuMIJ3rPB1A/Er9fSUotQq2KlM74BkZRMkKxrTvSTLGkLEKxohWdmEGVoas3QOzNC5MJ10IZoDCXO7/U6vYxDg4QULFByAXzGrkAoKbabL+ISbawHA+ZsD2Gy7ithaOyQFlhFxUJ7eseIYD1Ji9fBUUAWFWToHZpIMJCubIF7RCMlyY5xXmFr9gnhF4y3xikZElh3GLJ0D8aSTBalzIEJDI7TShvM3WZC4Ogb+pRYoxwHwLbJAVmSGrNAMaaEZ9W6dfm/fdYgLzIJE+ez1STA8iDuEX4kVkTUMZukciCw7DPGKRohXNN4LUzf9qxcAL9EK41bxciOC1Lsxk7RjutaOONLJgTAeILG1NJQlHESxBX7FZvgWmT0ApAVmSArMaD428gzy/ic3IMo3j5G4wAIxB8OHmrRoBEToP5yma+2YSdoRpN4F8XIjxCuMu4RpvGSZ8c/iZQ2QJrdiBmnHDNKOOK0T0XVORGgYhFRSOH9zAPcfDSG6hoK82Ax5sRl+RRwEByDhAMQFZojzzWhyBzl+A0SeGUSeGT7c9Wkwx06PgPDyL7cJ9kmTWyBe1gBJkvEdAUS0gnxRtKx+WLSsHpHlRxGvtSO2zoGoWgfCqhkEVYyARGkoT4ACMyQFJkjyTRDnmyDKN0GUZwKRZ0Lj0ZHQeu/4DfjkmuGTa2I1CkbEwYg5GB5E6naHm6ahEa+1Y1r5xxAtq4doWf2Q98rGlzye2cXLDF2iJAOU6Z1saNXZMU1jR0glg4CyEZBp1RR8C90hzBDzEBwAkccaOxrEO8fEahQMMQ7MUQ6E95KsyIrpWjbsFes6IEoyQJxo2DFm8UGcqI8XJekhSjIgVsNmCqqgEFhOQVFiwxccSHgVJQBICswIKbdhr+s6Dp68iYMnb+KjkzexwXQZ3jkmNBzxBJmabcLUp8AQbjCjQUIqKUzX2hFTbYEoyQBRkh6SREPkGBAvtfqnRKLuDJGoQ1BON+Lq7IjSMBAXWOBbZBVAQispiPPZPiDKN2NaFY3BIc+ViAu3HmJqtgmGw24gfRzIeDC5XL/JN4PIt0DkBiLmbtMxNWyUBKj3gEjUgVDp+564QOeToEslVDpIVjSzU5U6O+QlNogKLDh3gwUJqaDYCrmWDKuk0f9gEABwZ2AQJ6/cx3t9NzAl2wT9KJApPMgoGG83GBZoBERUYIGy1IbYOjtiahiIlxlBqHTwSdAnPBFE9rb+PwkVOUCoSIQVfYSYWgahlazhPEhwOSVU6JNnRmjFCMhux3VMVpsEaQ9eGAPCi4cZATLD2w3m489YECLfjIgqGjG1DEIKPgChIuGjIm9P/Xvdz5+6iE0kki2EioRf6ruIqWEQo2EgzrcInd232ArvPLNQcYgbyOfXB9DWewUbTFfQbrqC45dGRvb9fTcwWW3yhMkZpdyRco9+dhuDQ8OQFVpYO2oYyJJbQahIEAlk9VeuxhOJWiWhIkGoSEwr70FMDYPAMhtOX2Ofzys++EKobGou65GHg1+9WseDTM5+OsyUHBPeaT+Bew+HMPCYDeWYGgbhpR+Ds2tYnKT70zO96CFUpJVQkVCmb0e0hkGUhsE77Sdxm2v55mOXMZUDkRZY8f4nN58dZJRX3GGm5JiQvuO0sDRUtO8cojUMojUMfNdsYUEStd3P/MbKR6VdRKhIiBJ1CC83IUrDjiWLmo7jxj32EXaz9Sq8c8yYmmOGJN+K/X03nhlkPK9MyTYhr+uskH7N9tMIrqAQpWEQVnKM9wYIFRnxzCBeavVPCRXpIFQkFOs6EVXNILKaAZFnwfx6l/Bs3kl9CZ9cC6ZkmyErtODwp7cAAINDwzh++R6u3X30TCBTsk0o3Pu58E5kVcdnkORbEFXNIKqagW/KJq5v6A587ZehogRyLt8K4aW9iKxiEFBCYUq2GTEaOz7lnv4+PHETfkVWTM42QVJgwcFPb+HB4yFMVptAHrowPoi7sk3Qcen6Bwbxv20nMCXbjOAyGpFVDEKKhL4BsYoM/EavpwkVaSZUJPzStmJaFY1pVTR8cs2YnG1CWAUN+os7AADr53cQWEphkpodDxqOXIR3jnkMyCS1SdBktQne2WZssV5lXzn0P8JCYx8mZ5sgzrcI9clS2nmQrm/8nl2kImP41ggpPoqIShr+JTbBGGWxDdZzLAz1xR0ElbEwk7JMmJhlwvpjI8uhH564iYlZ7G88cCf1JQDgSv8jzNO7MDmb/S2wlEJEJY2ggsOCN3yStLJ/aOcDkag9TKhIyFI3IbySRnglDe9cMyaqTZioZluP7+h9l+4hopLBRA7k7bYTwvSl+sB54XtRngV7XWyek1fuI0pjx4QstjwizyLUI0newA+Anf/wFg6fBF0I3yrBhR8jvJJGQAklGDUxy4SpOWZso78UVkvi6xyYkGXChCwTVmw5BfLQRUxUs//LCq0wnekHADgu3EVgqWdZgaUUwitpBOYf5L0xRCSR3s9lU42PSrePUJGQrX4XYRU0wipoeOeYMSHTJGhKthlbrSzM5dsPMVfn8vh9QqYJ/sUULJ+zoWg+24+AEsrjdyLXIpQvWdXKg7Q/t91B4r/X+fFeCcg/jLAKGv4lFP6UaRqjhiPsU+GNe4+xyHhc+D6sgoHjwl0AwEcnb0Gcbx2TN6CUQlgFjYDcj3iIQVGCYcJz3a9FJJLbCRUJafIGhJbTCC2nMTXbjFcyeseooJsdE+4/HMLS5uMILaeFVxBbrFcxMcs0Jo9PjlkoV7yyBYSKhEila3zuG898VHofQkUOEyoSAXkfIbSchn+xbVyQVzJ6hQHuwaMhXLrNvkLYaBkf4pWMXgSUUAgtp6HMOcB745F4Ofn7b2UHHaEi2wkVCcnKVoSU0QgpY73yx/TecZW27bRw+204cumJ6bxzzFx5FETLm7k5Fan91rYCihIMEwgVOUioSCizP0RwKQ1lkQ3/va73iUrc+CnK9n/x1DT+RRSCS2kost7jvfFA9A754re6OdMngTQSKhLiFesRVEojqJTGFLUZf1jX+400NduCoFIagaU2iJY3cX2DrPjWd5lKEmp/RyTqHhIqEgr1BwgqoaEsovCHtb1fW7w3gkpo+GXu47yhu0u8Q/7Xd7LvV5SoqyVUJETLmxFYQiGwhPXK79f2fi1NzbYgsIRGQIkNomVGDkRb8J1tYJYt1/+aUJH3CRUJv8z9CCimoCi04XdpPc+s36/tgbLIhoBiCr7p3XzfuOXzN+1/fKc7sYkEXQmhIiFa1gj/Iiv8iyhMzjTj5TU9z6TJWWb4F1HwL7RClNTA9o0EXeZ3vqV8UkLtL4kEsp9QkZBldENZRMGvwIaX03rw0pqn6+W0HsgLbVAWUZCt6+K9cW1iivEX+D42+fskarNZrzRAWWiFkvPKS6k9T9XkTDOURRSUBRaIkur5GW7K93ZaQZGo+TdCRV4nVCRk67oEr7y0pge/TR1fL6/pgbyA9YY0bTfvjUuyt/U/+16PXfgkaFMJFQlRUj3k+RYoCilMyjTjxZSecTUp0wxFIQV5vhmiJAM/iid97+dHZG/rf0aoyMuEioRkzW7ICyj45tvw25Qe/Ga1p36b0gPffBvkBRQka3by3jj3SqLmX34QJ3qIRDKJXT4yQJ5ngrzAhokZJvxm9TEPTco0Q15gg1+uCUSinusb2rd/MEeTXknU/AuhIs+xXtkJv3wbZHlWvLj6GH6dzOrF1ccgy7PCL98Gccp23hufhanVL+CHdMbKJ5H8CxvveshyeuGbb8OEDDN+lXwMv0o+hokZZvjm2yDN6eFeC5AgEnVLf3CHxcLU6hdEKvJTQkVClLINsjwbpLk2oX9Ic22Q5dkgSunkvXF8/vznd2DsuZ5480kkF3MtDYmaNX5CuhkT0s2Q5togUfeAUOm4UZxc8IM9vscuteqchIqEaHUHazwnaa4NRHIHP02n+f26P9hziKJE3TxuOg5x1lFIcmyQ5NggzjrqthCtnfWDP1DJPRJbCBUJInkLJDlWSHKsIJI38yC9P4qToQC8iL/rYvnWF2UcgShjZOnTO0EX9aMB4bxyhFCRIFZuZMWCHPzRnNV1mxmHur2cYUfxBF3Ijw6EW83fL0CodPt+VKenPe9gpFzoK4mk/EcLwvWVHYSK3PGjO88+5nhsok40NVEn+rbr+b8BANIDJqc+VKDfAAAAAElFTkSuQmCC';
  plugin.playerTracker.iconEnl = L.Icon.Default.extend({options: {
    iconUrl: iconEnlImage,
    iconRetinaUrl: iconEnlRetImage
  }});
  plugin.playerTracker.iconRes = L.Icon.Default.extend({options: {
    iconUrl: iconResImage,
    iconRetinaUrl: iconResRetImage
  }});
  plugin.playerTracker.drawnTracesEnl = new L.LayerGroup();
  plugin.playerTracker.drawnTracesRes = new L.LayerGroup();
  // to avoid any favouritism, we'll put the player's own faction layer first
  if (PLAYER.team == 'RESISTANCE') {
    window.addLayerGroup('Player Tracker Resistance', plugin.playerTracker.drawnTracesRes, true);
    window.addLayerGroup('Player Tracker Enlightened', plugin.playerTracker.drawnTracesEnl, true);
  } else {
    window.addLayerGroup('Player Tracker Enlightened', plugin.playerTracker.drawnTracesEnl, true);
    window.addLayerGroup('Player Tracker Resistance', plugin.playerTracker.drawnTracesRes, true);
  }
  map.on('layeradd',function(obj) {
    if(obj.layer === plugin.playerTracker.drawnTracesEnl || obj.layer === plugin.playerTracker.drawnTracesRes) {
      obj.layer.eachLayer(function(marker) {
        if(marker._icon) window.setupTooltips($(marker._icon));
      });
    }
  });
  plugin.playerTracker.playerPopup = new L.Popup({offset: L.point([1,-34])});
  addHook('publicChatDataAvailable', window.plugin.playerTracker.handleData);
  window.map.on('zoomend', function() {
    window.plugin.playerTracker.zoomListener();
  });
  window.plugin.playerTracker.zoomListener();
  plugin.playerTracker.setupUserSearch();
}
window.plugin.playerTracker.stored = {};
plugin.playerTracker.onClickListener = function(event) {
  var marker = event.target;
  if (marker.options.desc) {
    plugin.playerTracker.playerPopup.setContent(marker.options.desc);
    plugin.playerTracker.playerPopup.setLatLng(marker.getLatLng());
    map.openPopup(plugin.playerTracker.playerPopup);
  }
};
// force close all open tooltips before markers are cleared
window.plugin.playerTracker.closeIconTooltips = function() {
  plugin.playerTracker.drawnTracesRes.eachLayer(function(layer) {
    if ($(layer._icon)) { $(layer._icon).tooltip('close');}
  });
  plugin.playerTracker.drawnTracesEnl.eachLayer(function(layer) {
    if ($(layer._icon)) { $(layer._icon).tooltip('close');}
  });
}
window.plugin.playerTracker.zoomListener = function() {
  var ctrl = $('.leaflet-control-layers-selector + span:contains("Player Tracker")').parent();
  if(window.map.getZoom()
< window.PLAYER_TRACKER_MIN_ZOOM) {
    if (!window.isTouchDevice()) plugin.playerTracker.closeIconTooltips();
    plugin.playerTracker.drawnTracesEnl.clearLayers();
    plugin.playerTracker.drawnTracesRes.clearLayers();
    ctrl.addClass('disabled').attr('title', 'Zoom in to show those.');
    //note: zoomListener is also called at init time to set up things, so we only need to do this in here
    window.chat.backgroundChannelData('plugin.playerTracker', 'all', false);   //disable this plugin's interest in 'all' COMM
  } else {
    ctrl.removeClass('disabled').attr('title', '');
    //note: zoomListener is also called at init time to set up things, so we only need to do this in here
    window.chat.backgroundChannelData('plugin.playerTracker', 'all', true);    //enable this plugin's interest in 'all' COMM
  }
}
window.plugin.playerTracker.getLimit = function() {
 return new Date().getTime() - window.PLAYER_TRACKER_MAX_TIME;
}
window.plugin.playerTracker.discardOldData = function() {
  var limit = plugin.playerTracker.getLimit();
  $.each(plugin.playerTracker.stored, function(plrname, player) {
    var i;
    var ev = player.events;
    for(i = 0; i
< ev.length; i++) {
      if(ev[i].time >
= limit) break;
    }
    if(i === 0) return true;
    if(i === ev.length) return delete plugin.playerTracker.stored[plrname];
    plugin.playerTracker.stored[plrname].events.splice(0, i);
  });
}
window.plugin.playerTracker.eventHasLatLng = function(ev, lat, lng) {
  var hasLatLng = false;
  $.each(ev.latlngs, function(ind, ll) {
    if(ll[0] === lat && ll[1] === lng) {
      hasLatLng = true;
      return false;
    }
  });
  return hasLatLng;
}
window.plugin.playerTracker.processNewData = function(data) {
  var limit = plugin.playerTracker.getLimit();
  $.each(data.result, function(ind, json) {
    // skip old data
    if(json[1]
< limit) return true;
    // find player and portal information
    var plrname, lat, lng, id=null, name, address;
    var skipThisMessage = false;
    $.each(json[2].plext.markup, function(ind, markup) {
      switch(markup[0]) {
      case 'TEXT':
        // Destroy link and field messages depend on where the link or
        // field was originally created. Therefore it’s not clear which
        // portal the player is at, so ignore it.
        if(markup[1].plain.indexOf('destroyed the Link') !== -1
          || markup[1].plain.indexOf('destroyed a Control Field') !== -1
          || markup[1].plain.indexOf('Your Link') !== -1) {
          skipThisMessage = true;
          return false;
        }
        break;
      case 'PLAYER':
        plrname = markup[1].plain;
        break;
      case 'PORTAL':
        // link messages are “player linked X to Y” and the player is at
        // X.
        lat = lat ? lat : markup[1].latE6/1E6;
        lng = lng ? lng : markup[1].lngE6/1E6;
        // no GUID in the data any more - but we need some unique string. use the latE6,lngE6
        id = markup[1].latE6+","+markup[1].lngE6;
        name = name ? name : markup[1].name;
        address = address ? address : markup[1].address;
        break;
      }
    });
    // skip unusable events
    if(!plrname || !lat || !lng || !id || skipThisMessage) return true;
    var newEvent = {
      latlngs: [[lat, lng]],
      ids: [id],
      time: json[1],
      name: name,
      address: address
    };
    var playerData = window.plugin.playerTracker.stored[plrname];
    // short-path if this is a new player
    if(!playerData || playerData.events.length === 0) {
      plugin.playerTracker.stored[plrname] = {
        nick: plrname,
        team: json[2].plext.team,
        events: [newEvent]
      };
      return true;
    }
    var evts = playerData.events;
    // there’s some data already. Need to find correct place to insert.
    var i;
    for(i = 0; i
< evts.length; i++) {
      if(evts[i].time >
 json[1]) break;
    }
    var cmp = Math.max(i-1, 0);
    // so we have an event that happened at the same time. Most likely
    // this is multiple resos destroyed at the same time.
    if(evts[cmp].time === json[1]) {
      evts[cmp].latlngs.push([lat, lng]);
      evts[cmp].ids.push(id);
      plugin.playerTracker.stored[plrname].events = evts;
      return true;
    }
    // the time changed. Is the player still at the same location?
    // assume this is an older event at the same location. Then we need
    // to look at the next item in the event list. If this event is the
    // newest one, there may not be a newer event so check for that. If
    // it really is an older event at the same location, then skip it.
    if(evts[cmp+1] && plugin.playerTracker.eventHasLatLng(evts[cmp+1], lat, lng))
      return true;
    // if this event is newer, need to look at the previous one
    var sameLocation = plugin.playerTracker.eventHasLatLng(evts[cmp], lat, lng);
    // if it’s the same location, just update the timestamp. Otherwise
    // push as new event.
    if(sameLocation) {
      evts[cmp].time = json[1];
    } else {
      evts.splice(i, 0,  newEvent);
    }
    // update player data
    plugin.playerTracker.stored[plrname].events = evts;
  });
}
window.plugin.playerTracker.getLatLngFromEvent = function(ev) {
//TODO? add weight to certain events, or otherwise prefer them, to give better locations?
  var lats = 0;
  var lngs = 0;
  $.each(ev.latlngs, function(i, latlng) {
    lats += latlng[0];
    lngs += latlng[1];
  });
  return L.latLng(lats / ev.latlngs.length, lngs / ev.latlngs.length);
}
window.plugin.playerTracker.ago = function(time, now) {
  var s = (now-time) / 1000;
  var h = Math.floor(s / 3600);
  var m = Math.floor((s % 3600) / 60);
  var returnVal = m + 'm';
  if(h >
 0) {
    returnVal = h + 'h' + returnVal;
  }
  return returnVal;
}
window.plugin.playerTracker.drawData = function() {
  var isTouchDev = window.isTouchDevice();
  var gllfe = plugin.playerTracker.getLatLngFromEvent;
  var polyLineByAgeEnl = [[], [], [], []];
  var polyLineByAgeRes = [[], [], [], []];
  var split = PLAYER_TRACKER_MAX_TIME / 4;
  var now = new Date().getTime();
  $.each(plugin.playerTracker.stored, function(plrname, playerData) {
    if(!playerData || playerData.events.length === 0) {
      console.warn('broken player data for plrname=' + plrname);
      return true;
    }
    // gather line data and put them in buckets so we can color them by
    // their age
    var playerLine = [];
    for(var i = 1; i
< playerData.events.length; i++) {
      var p = playerData.events[i];
      var ageBucket = Math.min(parseInt((now - p.time) / split), 4-1);
      var line = [gllfe(p), gllfe(playerData.events[i-1])];
      if(playerData.team === 'RESISTANCE')
        polyLineByAgeRes[ageBucket].push(line);
      else
        polyLineByAgeEnl[ageBucket].push(line);
    }
    var evtsLength = playerData.events.length;
    var last = playerData.events[evtsLength-1];
    var ago = plugin.playerTracker.ago;
    // tooltip for marker - no HTML - and not shown on touchscreen devices
    var tooltip = isTouchDev ? '' : (playerData.nick+', '+ago(last.time, now)+' ago');
    // popup for marker
    var popup = $('
<div>
')
      .addClass('plugin-player-tracker-popup');
    $('
<span>
')
      .addClass('nickname ' + (playerData.team === 'RESISTANCE' ? 'res' : 'enl'))
      .css('font-weight', 'bold')
      .text(playerData.nick)
      .appendTo(popup);
    if(window.plugin.guessPlayerLevels !== undefined &&
       window.plugin.guessPlayerLevels.fetchLevelDetailsByPlayer !== undefined) {
      function getLevel(lvl) {
        return $('
<span>
')
          .css({
            padding: '4px',
            color: 'white',
            backgroundColor: COLORS_LVL[lvl],
          })
          .text(lvl);
      }
      var level = $('
<span>
')
        .css({'font-weight': 'bold', 'margin-left': '10px'})
        .appendTo(popup);
      var playerLevelDetails = window.plugin.guessPlayerLevels.fetchLevelDetailsByPlayer(plrname);
      level
        .text('Min level ')
        .append(getLevel(playerLevelDetails.min));
      if(playerLevelDetails.min != playerLevelDetails.guessed)
        level
          .append(document.createTextNode(', guessed level: '))
          .append(getLevel(playerLevelDetails.guessed));
    }
    popup
      .append('
<br>
')
      .append(document.createTextNode(ago(last.time, now)))
      .append('
<br>
')
      .append(plugin.playerTracker.getPortalLink(last));
    // show previous data in popup
    if(evtsLength >
= 2) {
      popup
        .append('
<br>
')
        .append('
<br>
')
        .append(document.createTextNode('previous locations:'))
        .append('
<br>
');
      var table = $('
<table>
')
        .appendTo(popup)
        .css('border-spacing', '0');
      for(var i = evtsLength - 2; i >
= 0 && i >
= evtsLength - 10; i--) {
        var ev = playerData.events[i];
        $('
<tr>
')
          .append($('
<td>
')
            .text(ago(ev.time, now) + ' ago'))
          .append($('
<td>
')
            .append(plugin.playerTracker.getPortalLink(ev)))
          .appendTo(table);
      }
    }
    // calculate the closest portal to the player
    var eventPortal = []
    var closestPortal;
    var mostPortals = 0;
    $.each(last.ids, function(i, id) {
      if(eventPortal[id]) {
        eventPortal[id]++;
      } else {
        eventPortal[id] = 1;
      }
      if(eventPortal[id] >
 mostPortals) {
        mostPortals = eventPortal[id];
        closestPortal = id;
      }
    });
    // marker opacity
    var relOpacity = 1 - (now - last.time) / window.PLAYER_TRACKER_MAX_TIME
    var absOpacity = window.PLAYER_TRACKER_MIN_OPACITY + (1 - window.PLAYER_TRACKER_MIN_OPACITY) * relOpacity;
    // marker itself
    var icon = playerData.team === 'RESISTANCE' ?  new plugin.playerTracker.iconRes() :  new plugin.playerTracker.iconEnl();
    // as per OverlappingMarkerSpiderfier docs, click events (popups, etc) must be handled via it rather than the standard
    // marker click events. so store the popup text in the options, then display it in the oms click handler
    var m = L.marker(gllfe(last), {icon: icon, referenceToPortal: closestPortal, opacity: absOpacity, desc: popup[0], title: tooltip});
    m.addEventListener('spiderfiedclick', plugin.playerTracker.onClickListener);
    // m.bindPopup(title);
    if (tooltip) {
      // ensure tooltips are closed, sometimes they linger
      m.on('mouseout', function() { $(this._icon).tooltip('close'); });
    }
    playerData.marker = m;
    m.addTo(playerData.team === 'RESISTANCE' ? plugin.playerTracker.drawnTracesRes : plugin.playerTracker.drawnTracesEnl);
    window.registerMarkerForOMS(m);
    // jQueryUI doesn’t automatically notice the new markers
    if (!isTouchDev) {
      window.setupTooltips($(m._icon));
    }
  });
  // draw the poly lines to the map
  $.each(polyLineByAgeEnl, function(i, polyLine) {
    if(polyLine.length === 0) return true;
    var opts = {
      weight: 2-0.25*i,
      color: PLAYER_TRACKER_LINE_COLOUR,
      clickable: false,
      opacity: 1-0.2*i,
      dashArray: "5,8"
    };
    $.each(polyLine,function(ind,poly) {
      L.polyline(poly, opts).addTo(plugin.playerTracker.drawnTracesEnl);
    });
  });
  $.each(polyLineByAgeRes, function(i, polyLine) {
    if(polyLine.length === 0) return true;
    var opts = {
      weight: 2-0.25*i,
      color: PLAYER_TRACKER_LINE_COLOUR,
      clickable: false,
      opacity: 1-0.2*i,
      dashArray: "5,8"
    };
    $.each(polyLine, function(ind,poly) {
      L.polyline(poly, opts).addTo(plugin.playerTracker.drawnTracesRes);
    });
  });
}
window.plugin.playerTracker.getPortalLink = function(data) {
  var position = data.latlngs[0];
  var ll = position.join(',');
  return $('
<a>
')
    .addClass('text-overflow-ellipsis')
    .css('max-width', '15em')
    .text(window.chat.getChatPortalName(data))
    .prop({
      title: window.chat.getChatPortalName(data),
      href: '/intel?ll=' + ll + '&pll=' + ll,
    })
    .click(function(event) {
      window.selectPortalByLatLng(position);
      event.preventDefault();
      return false;
    })
    .dblclick(function(event) {
      map.setView(position, 17)
      window.selectPortalByLatLng(position);
      event.preventDefault();
      return false;
    });
}
window.plugin.playerTracker.handleData = function(data) {
  if(window.map.getZoom()
< window.PLAYER_TRACKER_MIN_ZOOM) return;
  plugin.playerTracker.discardOldData();
  plugin.playerTracker.processNewData(data);
  if (!window.isTouchDevice()) plugin.playerTracker.closeIconTooltips();
  plugin.playerTracker.drawnTracesEnl.clearLayers();
  plugin.playerTracker.drawnTracesRes.clearLayers();
  plugin.playerTracker.drawData();
}
window.plugin.playerTracker.findUser = function(nick) {
  nick = nick.toLowerCase();
  var foundPlayerData = false;
  $.each(plugin.playerTracker.stored, function(plrname, playerData) {
    if (playerData.nick.toLowerCase() === nick) {
      foundPlayerData = playerData;
      return false;
    }
  });
  return foundPlayerData;
}
window.plugin.playerTracker.findUserPosition = function(nick) {
  var data = window.plugin.playerTracker.findUser(nick);
  if (!data) return false;
  var last = data.events[data.events.length - 1];
  return plugin.playerTracker.getLatLngFromEvent(last);
}
window.plugin.playerTracker.centerMapOnUser = function(nick) {
  var data = plugin.playerTracker.findUser(nick);
  if(!data) return false;
  var last = data.events[data.events.length - 1];
  var position = plugin.playerTracker.getLatLngFromEvent(last);
  if(window.isSmartphone()) window.show('map');
  window.map.setView(position, map.getZoom());
  if(data.marker) {
    window.plugin.playerTracker.onClickListener({target: data.marker});
  }
  return true;
}
window.plugin.playerTracker.onNicknameClicked = function(info) {
  if (info.event.ctrlKey || info.event.metaKey) {
    return !plugin.playerTracker.centerMapOnUser(info.nickname);
  }
  return true; // don't interrupt hook
}
window.plugin.playerTracker.onSearchResultSelected = function(result, event) {
  event.stopPropagation(); // prevent chat from handling the click
  if(window.isSmartphone()) window.show('map');
  // if the user moved since the search was started, check if we have a new set of data
  if(false === window.plugin.playerTracker.centerMapOnUser(result.nickname))
    map.setView(result.position);
  if(event.type == 'dblclick')
    map.setZoom(17);
  return true;
};
window.plugin.playerTracker.onSearch = function(query) {
  var term = query.term.toLowerCase();
  if (term.length && term[0] == '@') term = term.substr(1);
  $.each(plugin.playerTracker.stored, function(nick, data) {
    if(nick.toLowerCase().indexOf(term) === -1) return;
    var event = data.events[data.events.length - 1];
    query.addResult({
      title: '
<mark class="nickname help '+TEAM_TO_CSS[getTeam(data)]+'">
' + nick + '
</mark>
',
      nickname: nick,
      description: data.team.substr(0,3) + ', last seen ' + unixTimeToDateTimeString(event.time),
      position: plugin.playerTracker.getLatLngFromEvent(event),
      onSelected: window.plugin.playerTracker.onSearchResultSelected,
    });
  });
}
window.plugin.playerTracker.setupUserSearch = function() {
  addHook('nicknameClicked', window.plugin.playerTracker.onNicknameClicked);
  addHook('search', window.plugin.playerTracker.onSearch);
}
var setup = plugin.playerTracker.setup;
// PLUGIN END //////////////////////////////////////////////////////////
setup.info = plugin_info; //add the script info data to the function as a property
if(!window.bootPlugins) window.bootPlugins = [];
window.bootPlugins.push(setup);
// if IITC has already booted, immediately run the 'setup' function
if(window.iitcLoaded && typeof setup === 'function') setup();
})({"script":{"version":"0.11.1.20150917.154202","name":"IITC Plugin: Player tracker","description":"[jonatkins-2015-09-17-154202] Draw trails for the path a user took onto the map based on status messages in COMMs. Uses up to three hours of data. Does not request chat data on its own, even if that would be useful."}});
</script>
<script>
(function wrapper(plugin_info) {
// ensure plugin framework is there, even if iitc is not yet loaded
if(typeof window.plugin !== 'function') window.plugin = function() {};
//PLUGIN AUTHORS: writing a plugin outside of the IITC build environment? if so, delete these lines!!
//(leaving them in place might break the 'About IITC' page or break update checks)
plugin_info.buildName = 'jonatkins';
plugin_info.dateTimeVersion = '20150917.154202';
plugin_info.pluginId = 'basemap-openstreetmap';
//END PLUGIN AUTHORS NOTE
// PLUGIN START ////////////////////////////////////////////////////////
// use own namespace for plugin
window.plugin.mapTileOpenStreetMap = function() {};
window.plugin.mapTileOpenStreetMap.addLayer = function() {
  //OpenStreetMap tiles - we shouldn't use these by default - https://wiki.openstreetmap.org/wiki/Tile_usage_policy
  // "Heavy use (e.g. distributing an app that uses tiles from openstreetmap.org) is forbidden without prior permission from the System Administrators"
  osmAttribution = 'Map data © OpenStreetMap contributors';
  var osmOpt = {attribution: osmAttribution, maxNativeZoom: 18, maxZoom: 21};
  var osm = new L.TileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', osmOpt);
  layerChooser.addBaseLayer(osm, "OpenStreetMap");
};
var setup =  window.plugin.mapTileOpenStreetMap.addLayer;
// PLUGIN END //////////////////////////////////////////////////////////
setup.info = plugin_info; //add the script info data to the function as a property
if(!window.bootPlugins) window.bootPlugins = [];
window.bootPlugins.push(setup);
// if IITC has already booted, immediately run the 'setup' function
if(window.iitcLoaded && typeof setup === 'function') setup();
})({"script":{"version":"0.1.1.20150917.154202","name":"IITC plugin: OpenStreetMap.org map tiles","description":"[jonatkins-2015-09-17-154202] Add the native OpenStreetMap.org map tiles as an optional layer."}});
</script>
<script>
(function wrapper(plugin_info) {
// ensure plugin framework is there, even if iitc is not yet loaded
if(typeof window.plugin !== 'function') window.plugin = function() {};
//PLUGIN AUTHORS: writing a plugin outside of the IITC build environment? if so, delete these lines!!
//(leaving them in place might break the 'About IITC' page or break update checks)
plugin_info.buildName = 'jonatkins';
plugin_info.dateTimeVersion = '20150917.154202';
plugin_info.pluginId = 'basemap-blank';
//END PLUGIN AUTHORS NOTE
// PLUGIN START ////////////////////////////////////////////////////////
// use own namespace for plugin
window.plugin.mapTileBlank = function() {};
window.plugin.mapTileBlank.addLayer = function() {
  var blankOpt = {attribution: '', maxNativeZoom: 18, maxZoom: 21};
  var blankWhite = new L.TileLayer('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3gEFCSU6z3A8pwAAAA1JREFUCNdj+P///38ACfsD/dGDjPAAAAAASUVORK5CYII=', blankOpt);
  var blankBlack = new L.TileLayer('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAIAAACQd1PeAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3gEFCQkJSZE2HwAAAAxJREFUCNdjYGBgAAAABAABJzQnCgAAAABJRU5ErkJggg==', blankOpt);
  layerChooser.addBaseLayer(blankWhite, "Blank Map (White)");
  layerChooser.addBaseLayer(blankBlack, "Blank Map (Black)");
};
var setup =  window.plugin.mapTileBlank.addLayer;
// PLUGIN END //////////////////////////////////////////////////////////
setup.info = plugin_info; //add the script info data to the function as a property
if(!window.bootPlugins) window.bootPlugins = [];
window.bootPlugins.push(setup);
// if IITC has already booted, immediately run the 'setup' function
if(window.iitcLoaded && typeof setup === 'function') setup();
})({"script":{"version":"0.1.2.20150917.154202","name":"IITC plugin: Blank map","description":"[jonatkins-2015-09-17-154202] Add a blank map layer - no roads or other features."}});
</script>
<script>
(function wrapper(plugin_info) {
// ensure plugin framework is there, even if iitc is not yet loaded
if(typeof window.plugin !== 'function') window.plugin = function() {};
//PLUGIN AUTHORS: writing a plugin outside of the IITC build environment? if so, delete these lines!!
//(leaving them in place might break the 'About IITC' page or break update checks)
plugin_info.buildName = 'jonatkins';
plugin_info.dateTimeVersion = '20150917.154202';
plugin_info.pluginId = 'show-linked-portals';
//END PLUGIN AUTHORS NOTE
// PLUGIN START ////////////////////////////////////////////////////////
// use own namespace for plugin
window.plugin.showLinkedPortal = function () {
};
plugin.showLinkedPortal.previewOptions = {
  color: "#C33",
  opacity: 1,
  weight: 5,
  fill: false,
  dashArray: "1,6",
  radius: 18,
};
window.plugin.showLinkedPortal.portalDetail = function (data) {
  plugin.showLinkedPortal.removePreview();
  var portalLinks = getPortalLinks(data.guid);
  var length = portalLinks.in.length + portalLinks.out.length
  var c = 1;
  $('
<div>
',{id:'showLinkedPortalContainer'}).appendTo('#portaldetails');
  function renderLinkedPortal(linkGuid) {
    if(c >
 16) return;
    var key = this; // passed by Array.prototype.forEach
    var link = window.links[linkGuid].options.data;
    var guid = link[key + 'Guid'];
    var lat = link[key + 'LatE6']/1E6;
    var lng = link[key + 'LngE6']/1E6;
    var length = L.latLng(link.oLatE6/1E6, link.oLngE6/1E6).distanceTo([link.dLatE6/1E6, link.dLngE6/1E6]);
    var lengthFull = digits(Math.round(length)) + 'm';
    var lengthShort = length
< 100000 ? lengthFull : digits(Math.round(length/1000)) + 'km'
    var div = $('
<div>
').addClass('showLinkedPortalLink showLinkedPortalLink' + c + (key=='d' ? ' outgoing' : ' incoming'));
    var title;
    var data = (portals[guid] && portals[guid].options.data) || portalDetail.get(guid) || null;
    if(data && data.title) {
      title = data.title;
      div.append($('
<img/>
').attr({
        'src': fixPortalImageUrl(data.image),
        'class': 'minImg',
        'alt': title,
      }));
    } else {
      title = 'Go to portal';
      div
        .addClass('outOfRange')
        .append($('
<span/>
')
          .html('Portal not loaded.
<br>
' + lengthShort));
    }
    div
      .attr({
        'data-guid': guid,
        'data-lat': lat,
        'data-lng': lng,
        'title': $('
<div/>
')
          .append($('
<strong/>
').text(title))
          .append($('
<br/>
'))
          .append($('
<span/>
').text(key=='d' ? '↴ outgoing link' : '↳ incoming link'))
          .append($('
<br/>
'))
          .append($('
<span/>
').html(lengthFull))
          .html(),
      })
      .appendTo('#showLinkedPortalContainer');
    c++;
  }
  portalLinks.out.forEach(renderLinkedPortal, 'd');
  portalLinks.in.forEach(renderLinkedPortal, 'o');
  if(length >
 16) {
    $('
<div>
')
      .addClass('showLinkedPortalLink showLinkedPortalOverflow')
      .text(length-16 + ' more')
      .appendTo('#showLinkedPortalContainer');
  }
  $('#showLinkedPortalContainer')
    .on('click', '.showLinkedPortalLink', plugin.showLinkedPortal.onLinkedPortalClick)
    .on('mouseover', '.showLinkedPortalLink', plugin.showLinkedPortal.onLinkedPortalMouseOver)
    .on('mouseout', '.showLinkedPortalLink', plugin.showLinkedPortal.onLinkedPortalMouseOut);
}
plugin.showLinkedPortal.onLinkedPortalClick = function() {
  plugin.showLinkedPortal.removePreview();
  var element = $(this);
  var guid = element.attr('data-guid');
  var lat = element.attr('data-lat');
  var lng = element.attr('data-lng');
  if(!guid) return; // overflow
  var position = L.latLng(lat, lng);
  if(!map.getBounds().contains(position)) map.setView(position);
  if(portals[guid])
    renderPortalDetails(guid);
  else
    zoomToAndShowPortal(guid, position);
};
plugin.showLinkedPortal.onLinkedPortalMouseOver = function() {
  plugin.showLinkedPortal.removePreview();
  var element = $(this);
  var lat = element.attr('data-lat');
  var lng = element.attr('data-lng');
  if(!(lat && lng)) return; // overflow
  var remote = L.latLng(lat, lng);
  var local = portals[selectedPortal].getLatLng();
  plugin.showLinkedPortal.preview = L.layerGroup().addTo(map);
  L.circleMarker(remote, plugin.showLinkedPortal.previewOptions)
    .addTo(plugin.showLinkedPortal.preview);
  L.geodesicPolyline([local, remote], plugin.showLinkedPortal.previewOptions)
    .addTo(plugin.showLinkedPortal.preview);
};
plugin.showLinkedPortal.onLinkedPortalMouseOut = function() {
  plugin.showLinkedPortal.removePreview();
};
plugin.showLinkedPortal.removePreview = function() {
  if(plugin.showLinkedPortal.preview)
    map.removeLayer(plugin.showLinkedPortal.preview);
  plugin.showLinkedPortal.preview = null;
};
var setup = function () {
  window.addHook('portalDetailsUpdated', window.plugin.showLinkedPortal.portalDetail);
  $('
<style>
').prop('type', 'text/css').html('#level {\n    text-align: center;\n   margin-right: -0.5em;\n position: relative;\n   right: 50%;\n   width: 1em;\n}\n.showLinkedPortalLink {\n   cursor: pointer;\n  position: absolute;\n   height: 40px;\n width: 50px;\n  border-width: 1px;\n    overflow: hidden;\n text-align: center;\n   background: #0e3d4e;\n}\n.showLinkedPortalLink.outgoing {\n border-style: dashed;\n}\n.showLinkedPortalLink.incoming {\n    border-style: dotted;\n}\n.showLinkedPortalLink .minImg {\n height: 40px;\n}\n.showLinkedPortalLink.outOfRange span {\n display: block;\n   line-height: 13px;\n    font-size: 10px;\n}\n.showLinkedPortalOverflow {\n  left: 50%;\n    margin-left:-25px;\n    cursor: default;\n}\n\n.showLinkedPortalLink1, .showLinkedPortalLink2, .showLinkedPortalLink3, .showLinkedPortalLink4 {\n   left: 5px;\n}\n.showLinkedPortalLink5, .showLinkedPortalLink6, .showLinkedPortalLink7, .showLinkedPortalLink8 {\n   right: 5px;\n}\n.showLinkedPortalLink9, .showLinkedPortalLink10, .showLinkedPortalLink11, .showLinkedPortalLink12 {\n   left: 59px;\n}\n.showLinkedPortalLink13, .showLinkedPortalLink14, .showLinkedPortalLink15, .showLinkedPortalLink16 {\n  right: 59px\n}\n\n.showLinkedPortalLink1, .showLinkedPortalLink5, .showLinkedPortalLink9, .showLinkedPortalLink13 {\n   top: 23px;\n}\n.showLinkedPortalLink2, .showLinkedPortalLink6, .showLinkedPortalLink10, .showLinkedPortalLink14 {\n top: 72px;\n}\n.showLinkedPortalLink3, .showLinkedPortalLink7, .showLinkedPortalLink11, .showLinkedPortalLink15 {\n top: 122px;\n}\n.showLinkedPortalLink4, .showLinkedPortalLink8, .showLinkedPortalLink12, .showLinkedPortalLink16,\n.showLinkedPortalOverflow {\n    top: 171px;\n}\n\n').appendTo('head');
}
// PLUGIN END //////////////////////////////////////////////////////////
setup.info = plugin_info; //add the script info data to the function as a property
if(!window.bootPlugins) window.bootPlugins = [];
window.bootPlugins.push(setup);
// if IITC has already booted, immediately run the 'setup' function
if(window.iitcLoaded && typeof setup === 'function') setup();
})({"script":{"version":"0.3.1.20150917.154202","name":"IITC plugin: Show linked portals","description":"[jonatkins-2015-09-17-154202] Try to show the linked portals (image, name and link direction) in portal detail view and jump to linked portal on click. Some details may not be available if the linked portal is not in the current view."}});
</script>
<script>
(function wrapper(plugin_info) {
// ensure plugin framework is there, even if iitc is not yet loaded
if(typeof window.plugin !== 'function') window.plugin = function() {};
//PLUGIN AUTHORS: writing a plugin outside of the IITC build environment? if so, delete these lines!!
//(leaving them in place might break the 'About IITC' page or break update checks)
plugin_info.buildName = 'jonatkins';
plugin_info.dateTimeVersion = '20150917.154202';
plugin_info.pluginId = 'portal-counts';
//END PLUGIN AUTHORS NOTE
// PLUGIN START ////////////////////////////////////////////////////////
/* whatsnew
* 0.1.0  : display graphs
* 0.0.10 : show in nav drawer on mobile devices
* 0.0.9  : fix for new intel map
* 0.0.8  : use dialog() instead of alert()
* 0.0.6  : ignoring outside bounds portals (even if close to)
* 0.0.5  : changed table layout, added some colors
* 0.0.4  : reverse show order of portals, using MAX_PORTAL_LEVEL now for array, changed table layout to be more compact, cleaned up code
* 0.0.3  : fixed incorrect rounded portal levels, adjusted viewport
* 0.0.2  : fixed counts to be reset after scrolling
* 0.0.1  : initial release, show count of portals
*/
// use own namespace for plugin
window.plugin.portalcounts = {
  BAR_TOP: 20,
  BAR_HEIGHT: 180,
  BAR_WIDTH: 25,
  BAR_PADDING: 5,
  RADIUS_INNER: 70,
  RADIUS_OUTER: 100,
  CENTER_X: 200,
  CENTER_Y: 100,
};
//count portals for each level available on the map
window.plugin.portalcounts.getPortals = function (){
  //console.log('** getPortals');
  var self = window.plugin.portalcounts;
  var displayBounds = map.getBounds();
  self.enlP = 0;
  self.resP = 0;
  self.neuP = 0;
  self.PortalsEnl = new Array();
  self.PortalsRes = new Array();
  for(var level = window.MAX_PORTAL_LEVEL; level >
 0; level--){
    self.PortalsEnl[level] = 0;
    self.PortalsRes[level] = 0;
  }
  $.each(window.portals, function(i, portal) {
    var level = portal.options.level;
    var team = portal.options.team;
    // just count portals in viewport
    if(!displayBounds.contains(portal.getLatLng())) return true;
    switch (team){
      case 1 :
        self.resP++;
        self.PortalsRes[level]++;
        break;
      case 2 :
        self.enlP++;
        self.PortalsEnl[level]++;
        break;
      default:
        self.neuP++;
        break;
    }
  });
  //get portals informations from IITC
  var minlvl = getMinPortalLevel();
  var total = self.neuP + self.enlP + self.resP;
  var counts = '';
  if(total >
 0) {
    counts += '
<table>
<tr>
<th>
</th>
<th class="enl">
Enlightened
</th>
<th class="res">
Resistance
</th>
</tr>
';  //'+self.enlP+' Portal(s)
</th>
</tr>
';
    for(var level = window.MAX_PORTAL_LEVEL; level >
 0; level--){
      counts += '
<tr>
<td class="L'+level+'">
Level '+level+'
</td>
';
      if(minlvl >
 level)
        counts += '
<td colspan="2">
zoom in to see portals in this level
</td>
';
      else
        counts += '
<td class="enl">
'+self.PortalsEnl[level]+'
</td>
<td class="res">
'+self.PortalsRes[level]+'
</td>
';
      counts += '
</tr>
';
    }
    counts += '
<tr>
<th>
Total:
</th>
<td class="enl">
'+self.enlP+'
</td>
<td class="res">
'+self.resP+'
</td>
</tr>
';
    counts += '
<tr>
<td>
Neutral:
</td>
<td colspan="2">
';
    if(minlvl >
 0)
      counts += 'zoom in to see unclaimed portals';
    else
      counts += self.neuP;
    counts += '
</td>
</tr>
</table>
';
    var svg = $('
<svg width="300" height="200">
').css('margin-top', 10);
    var all = self.PortalsRes.map(function(val,i){return val+self.PortalsEnl[i]});
    all[0] = self.neuP;
    // bar graphs
    self.makeBar(self.PortalsEnl, 'Enl', COLORS[2], 0                                    ).appendTo(svg);
    self.makeBar(all            , 'All', '#FFFFFF', 1*(self.BAR_WIDTH + self.BAR_PADDING)).appendTo(svg);
    self.makeBar(self.PortalsRes, 'Res', COLORS[1], 2*(self.BAR_WIDTH + self.BAR_PADDING)).appendTo(svg);
    // pie graph
    var g = $('
<g>
')
      .attr('transform', self.format('translate(%s,%s)', self.CENTER_X, self.CENTER_Y))
      .appendTo(svg);
    // inner parts - factions
    self.makePie(0,                             self.resP/total,               COLORS[1]).appendTo(g);
    self.makePie(self.resP/total,               (self.neuP + self.resP)/total, COLORS[0]).appendTo(g);
    self.makePie((self.neuP + self.resP)/total, 1,                             COLORS[2]).appendTo(g);
    // outer part - levels
    var angle = 0;
    for(var i=self.PortalsRes.length-1;i>
=0;i--) {
      if(!self.PortalsRes[i])
        continue;
      var diff = self.PortalsRes[i] / total;
      self.makeRing(angle, angle+diff, COLORS_LVL[i]).appendTo(g);
      angle += diff;
    }
    var diff = self.neuP / total;
    self.makeRing(angle, angle+diff, COLORS_LVL[0]).appendTo(g);
    angle += diff;
    for(var i=0;i
<self.PortalsEnl.length;i++) {
      if(!self.PortalsEnl[i])
        continue;
      var diff = self.PortalsEnl[i] / total;
      self.makeRing(angle, angle+diff, COLORS_LVL[i]).appendTo(g);
      angle += diff;
    }
    // black line from center to top
    $('
<line>
')
      .attr({
        x1: self.resP
<self.enlP ? 0.5 : -0.5,
        y1: 0,
        x2: self.resP
<self.enlP ? 0.5 : -0.5,
        y2: -self.RADIUS_OUTER,
        stroke: '#000',
        'stroke-width': 1
      })
      .appendTo(g);
    // if there are no neutral portals, draw a black line between res and enl
    if(self.neuP == 0) {
      var x = Math.sin((0.5 - self.resP/total) * 2 * Math.PI) * self.RADIUS_OUTER;
      var y = Math.cos((0.5 - self.resP/total) * 2 * Math.PI) * self.RADIUS_OUTER;
      $('
<line>
')
        .attr({
          x1: self.resP
<self.enlP ? 0.5 : -0.5,
          y1: 0,
          x2: x,
          y2: y,
          stroke: '#000',
          'stroke-width': 1
        })
        .appendTo(g);
    }
    counts += $('
<div>
').append(svg).html();
  } else {
    counts += '
<p>
No Portals in range!
</p>
';
  }
  // I've only seen the backend reduce the portals returned for L4+ or further out zoom levels - but this could change
  // UPDATE: now seen for L2+ in dense areas (map zoom level 14 or lower)
  if (getMinPortalLevel() >
= 2) {
   counts += '
<p class="help" title="To reduce data usage and speed up map display, the backend servers only return some portals in dense areas.">
<b>
Warning
</b>
: Portal counts can be inaccurate when zoomed out
</p>
';
  }
  var total = self.enlP + self.resP + self.neuP;
  var title = total + ' ' + (total == 1 ? 'portal' : 'portals');
  if(window.useAndroidPanes()) {
    $('
<div id="portalcounts" class="mobile">
'
    + '
<div class="ui-dialog-titlebar">
<span class="ui-dialog-title ui-dialog-title-active">
' + title + '
</span>
</div>
'
    + counts
    + '
</div>
').appendTo(document.body);
  } else {
    dialog({
      html: '
<div id="portalcounts">
' + counts + '
</div>
',
      title: 'Portal counts: ' + title,
      width: 'auto'
    });
  }
}
window.plugin.portalcounts.makeBar = function(portals, text, color, shift) {
  var self = window.plugin.portalcounts;
  var g = $('
<g>
').attr('transform', 'translate('+shift+',0)');
  var sum = portals.reduce(function(a,b){ return a+b });
  var top = self.BAR_TOP;
  if(sum != 0) {
    for(var i=portals.length-1;i>
=0;i--) {
      if(!portals[i])
        continue;
      var height = self.BAR_HEIGHT * portals[i] / sum;
      $('
<rect>
')
        .attr({
          x: 0,
          y: top,
          width: self.BAR_WIDTH,
          height: height,
          fill: COLORS_LVL[i]
        })
        .appendTo(g);
      top += height;
    }
  }
  $('
<text>
')
    .html(text)
    .attr({
      x: self.BAR_WIDTH * 0.5,
      y: self.BAR_TOP * 0.75,
      fill: color,
      'text-anchor': 'middle'
    })
    .appendTo(g);
  return g;
};
window.plugin.portalcounts.makePie = function(startAngle, endAngle, color) {
  if(startAngle == endAngle)
    return $([]); // return empty element query
  var self = window.plugin.portalcounts;
  var large_arc = (endAngle - startAngle) >
 0.5 ? 1 : 0;
  var labelAngle = (endAngle + startAngle) / 2;
  var label = Math.round((endAngle - startAngle) * 100) + '%';
  startAngle = 0.5 - startAngle;
  endAngle   = 0.5 - endAngle;
  labelAngle = 0.5 - labelAngle;
  var p1x = Math.sin(startAngle * 2 * Math.PI) * self.RADIUS_INNER;
  var p1y = Math.cos(startAngle * 2 * Math.PI) * self.RADIUS_INNER;
  var p2x = Math.sin(endAngle   * 2 * Math.PI) * self.RADIUS_INNER;
  var p2y = Math.cos(endAngle   * 2 * Math.PI) * self.RADIUS_INNER;
  var lx  = Math.sin(labelAngle * 2 * Math.PI) * self.RADIUS_INNER / 1.5;
  var ly  = Math.cos(labelAngle * 2 * Math.PI) * self.RADIUS_INNER / 1.5;
  // for a full circle, both coordinates would be identical, so no circle would be drawn
  if(startAngle == 0.5 && endAngle == -0.5)
    p2x -= 1E-5;
  var text = $('
<text>
')
    .attr({
      'text-anchor': 'middle',
      'dominant-baseline' :'central',
      x: lx,
      y: ly
    })
    .html(label);
  var path = $('
<path>
')
    .attr({
      fill: color,
      d: self.format('M %s,%s A %s,%s 0 %s 1 %s,%s L 0,0 z', p1x,p1y, self.RADIUS_INNER,self.RADIUS_INNER, large_arc, p2x,p2y)
    });
  return path.add(text); // concat path and text
};
window.plugin.portalcounts.makeRing = function(startAngle, endAngle, color) {
  var self = window.plugin.portalcounts;
  var large_arc = (endAngle - startAngle) >
 0.5 ? 1 : 0;
  startAngle = 0.5 - startAngle;
  endAngle   = 0.5 - endAngle;
  var p1x = Math.sin(startAngle * 2 * Math.PI) * self.RADIUS_OUTER;
  var p1y = Math.cos(startAngle * 2 * Math.PI) * self.RADIUS_OUTER;
  var p2x = Math.sin(endAngle   * 2 * Math.PI) * self.RADIUS_OUTER;
  var p2y = Math.cos(endAngle   * 2 * Math.PI) * self.RADIUS_OUTER;
  var p3x = Math.sin(endAngle   * 2 * Math.PI) * self.RADIUS_INNER;
  var p3y = Math.cos(endAngle   * 2 * Math.PI) * self.RADIUS_INNER;
  var p4x = Math.sin(startAngle * 2 * Math.PI) * self.RADIUS_INNER;
  var p4y = Math.cos(startAngle * 2 * Math.PI) * self.RADIUS_INNER;
  // for a full circle, both coordinates would be identical, so no circle would be drawn
  if(startAngle == 0.5 && endAngle == -0.5) {
    p2x -= 1E-5;
    p3x -= 1E-5;
  }
  return $('
<path>
')
    .attr({
      fill: color,
      d: self.format('M %s,%s ', p1x, p1y)
       + self.format('A %s,%s 0 %s 1 %s,%s ', self.RADIUS_OUTER,self.RADIUS_OUTER, large_arc, p2x,p2y)
       + self.format('L %s,%s ', p3x,p3y)
       + self.format('A %s,%s 0 %s 0 %s,%s ', self.RADIUS_INNER,self.RADIUS_INNER, large_arc, p4x,p4y)
       + 'Z'
    });
};
window.plugin.portalcounts.format = function(str) {
  var re = /%s/;
  for(var i = 1; i
< arguments.length; i++) {
    str = str.replace(re, arguments[i]);
  }
  return str;
}
window.plugin.portalcounts.onPaneChanged = function(pane) {
  if(pane == 'plugin-portalcounts')
    window.plugin.portalcounts.getPortals();
  else
    $('#portalcounts').remove()
};
var setup =  function() {
  if(window.useAndroidPanes()) {
    android.addPane('plugin-portalcounts', 'Portal counts', 'ic_action_data_usage');
    addHook('paneChanged', window.plugin.portalcounts.onPaneChanged);
  } else {
    $('#toolbox').append('
<a onclick="window.plugin.portalcounts.getPortals()" title="Display a summary of portals in the current view">
Portal counts
</a>
');
  }
  $('head').append('
<style>
' +
    '#portalcounts.mobile {background: transparent; border: 0 none !important; height: 100% !important; width: 100% !important; left: 0 !important; top: 0 !important; position: absolute; overflow: auto; z-index: 9000 !important; }' +
    '#portalcounts table {margin-top:5px; border-collapse: collapse; empty-cells: show; width:100%; clear: both;}' +
    '#portalcounts table td, #portalcounts table th {border-bottom: 1px solid #0b314e; padding:3px; color:white; background-color:#1b415e}' +
    '#portalcounts table tr.res th {  background-color: #005684; }' +
    '#portalcounts table tr.enl th {  background-color: #017f01; }' +
    '#portalcounts table th { text-align: center;}' +
    '#portalcounts table td { text-align: center;}' +
    '#portalcounts table td.L0 { background-color: #000000 !important;}' +
    '#portalcounts table td.L1 { background-color: #FECE5A !important;}' +
    '#portalcounts table td.L2 { background-color: #FFA630 !important;}' +
    '#portalcounts table td.L3 { background-color: #FF7315 !important;}' +
    '#portalcounts table td.L4 { background-color: #E40000 !important;}' +
    '#portalcounts table td.L5 { background-color: #FD2992 !important;}' +
    '#portalcounts table td.L6 { background-color: #EB26CD !important;}' +
    '#portalcounts table td.L7 { background-color: #C124E0 !important;}' +
    '#portalcounts table td.L8 { background-color: #9627F4 !important;}' +
    '#portalcounts table td:nth-child(1) { text-align: left;}' +
    '#portalcounts table th:nth-child(1) { text-align: left;}' +
    '
</style>
');
}
// PLUGIN END //////////////////////////////////////////////////////////
setup.info = plugin_info; //add the script info data to the function as a property
if(!window.bootPlugins) window.bootPlugins = [];
window.bootPlugins.push(setup);
// if IITC has already booted, immediately run the 'setup' function
if(window.iitcLoaded && typeof setup === 'function') setup();
})({"script":{"version":"0.1.2.20150917.154202","name":"IITC plugin: Show total counts of portals","description":"[jonatkins-2015-09-17-154202] Display a list of all localized portals by level and faction."}});
</script>
<script>
(function wrapper(plugin_info) {
// ensure plugin framework is there, even if iitc is not yet loaded
if(typeof window.plugin !== 'function') window.plugin = function() {};
//PLUGIN AUTHORS: writing a plugin outside of the IITC build environment? if so, delete these lines!!
//(leaving them in place might break the 'About IITC' page or break update checks)
plugin_info.buildName = 'jonatkins';
plugin_info.dateTimeVersion = '20150917.154202';
plugin_info.pluginId = 'bookmarks-by-zaso';
//END PLUGIN AUTHORS NOTE
// PLUGIN START ////////////////////////////////////////////////////////
/***********************************************************************
  HOOKS:
  - pluginBkmrksEdit: fired when a bookmarks/folder is removed, added or sorted, also when a folder is opened/closed;
  - pluginBkmrksOpenOpt: fired when the "Bookmarks Options" panel is opened (you can add new options);
  - pluginBkmrksSyncEnd: fired when the sync is finished;
***********************************************************************/
////////////////////////////////////////////////////////////////////////
  // use own namespace for plugin
  window.plugin.bookmarks = function() {};
  window.plugin.bookmarks.SYNC_DELAY = 5000;
  window.plugin.bookmarks.KEY_OTHER_BKMRK = 'idOthers';
  window.plugin.bookmarks.KEY_STORAGE = 'plugin-bookmarks';
  window.plugin.bookmarks.KEY_STATUS_BOX = 'plugin-bookmarks-box';
  window.plugin.bookmarks.KEY = {key: window.plugin.bookmarks.KEY_STORAGE, field: 'bkmrksObj'};
  window.plugin.bookmarks.UPDATE_QUEUE = {key: 'plugin-bookmarks-queue', field: 'updateQueue'};
  window.plugin.bookmarks.UPDATING_QUEUE = {key: 'plugin-bookmarks-updating-queue', field: 'updatingQueue'};
  window.plugin.bookmarks.bkmrksObj = {};
  window.plugin.bookmarks.statusBox = {};
  window.plugin.bookmarks.updateQueue = {};
  window.plugin.bookmarks.updatingQueue = {};
  window.plugin.bookmarks.enableSync = false;
  window.plugin.bookmarks.starLayers = {};
  window.plugin.bookmarks.starLayerGroup = null;
  window.plugin.bookmarks.isSmart = undefined;
  window.plugin.bookmarks.isAndroid = function() {
    if(typeof android !== 'undefined' && android) {
      return true;
    }
    return false;
  }
/*********************************************************************************************************************/
  // Generate an ID for the bookmark (date time + random number)
  window.plugin.bookmarks.generateID = function() {
    var d = new Date();
    var ID = d.getTime()+(Math.floor(Math.random()*99)+1);
    var ID = 'id'+ID.toString();
    return ID;
  }
  // Format the string
  window.plugin.bookmarks.escapeHtml = function(text) {
    return text
        .replace(/&/g, "&amp;")
        .replace(/
</g, "&lt;")
        .replace(/>
/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;")
        .replace(/\//g, '&#47;')
        .replace(/\\/g, '&#92;');
  }
  // Update the localStorage
  window.plugin.bookmarks.saveStorage = function() {
    localStorage[plugin.bookmarks.KEY_STORAGE] = JSON.stringify(window.plugin.bookmarks.bkmrksObj);
  }
  // Load the localStorage
  window.plugin.bookmarks.loadStorage = function() {
    window.plugin.bookmarks.bkmrksObj = JSON.parse(localStorage[plugin.bookmarks.KEY_STORAGE]);
  }
  window.plugin.bookmarks.saveStorageBox = function() {
    localStorage[plugin.bookmarks.KEY_STATUS_BOX] = JSON.stringify(window.plugin.bookmarks.statusBox);
  }
  window.plugin.bookmarks.loadStorageBox = function() {
    window.plugin.bookmarks.statusBox = JSON.parse(localStorage[plugin.bookmarks.KEY_STATUS_BOX]);
  }
  window.plugin.bookmarks.upgradeToNewStorage = function() {
    if(localStorage['plugin-bookmarks-portals-data'] && localStorage['plugin-bookmarks-maps-data']) {
      var oldStor_1 = JSON.parse(localStorage['plugin-bookmarks-maps-data']);
      var oldStor_2 = JSON.parse(localStorage['plugin-bookmarks-portals-data']);
      window.plugin.bookmarks.bkmrksObj.maps = oldStor_1.bkmrk_maps;
      window.plugin.bookmarks.bkmrksObj.portals = oldStor_2.bkmrk_portals;
      window.plugin.bookmarks.saveStorage();
      localStorage.removeItem('plugin-bookmarks-maps-data');
      localStorage.removeItem('plugin-bookmarks-portals-data');
      localStorage.removeItem('plugin-bookmarks-status-box');
    }
  }
  window.plugin.bookmarks.createStorage = function() {
    if(!localStorage[window.plugin.bookmarks.KEY_STORAGE]) {
      window.plugin.bookmarks.bkmrksObj.maps = {idOthers:{label:"Others",state:1,bkmrk:{}}};
      window.plugin.bookmarks.bkmrksObj.portals = {idOthers:{label:"Others",state:1,bkmrk:{}}};
      window.plugin.bookmarks.saveStorage();
    }
    if(!localStorage[window.plugin.bookmarks.KEY_STATUS_BOX]) {
      window.plugin.bookmarks.statusBox.show = 1;
      window.plugin.bookmarks.statusBox.page = 0;
      window.plugin.bookmarks.statusBox.pos = {x:100,y:100};
      window.plugin.bookmarks.saveStorageBox();
    }
  }
  window.plugin.bookmarks.refreshBkmrks = function() {
    $('#bkmrk_maps >
 ul, #bkmrk_portals >
 ul').remove();
    window.plugin.bookmarks.loadStorage();
    window.plugin.bookmarks.loadList('maps');
    window.plugin.bookmarks.loadList('portals');
    window.plugin.bookmarks.updateStarPortal();
    window.plugin.bookmarks.jquerySortableScript();
  }
/***************************************************************************************************************************************************************/
  // Show/hide the bookmarks box
  window.plugin.bookmarks.switchStatusBkmrksBox = function(status) {
    var newStatus = status;
    if(newStatus === 'switch') {
      if(window.plugin.bookmarks.statusBox.show === 1) {
        newStatus = 0;
      } else {
        newStatus = 1;
      }
    }
    if(newStatus === 1) {
      $('#bookmarksBox').css('height', 'auto');
      $('#bkmrksTrigger').css('height', '0');
    } else {
      $('#bkmrksTrigger').css('height', '64px');
      $('#bookmarksBox').css('height', '0');
    }
    window.plugin.bookmarks.statusBox['show'] = newStatus;
    window.plugin.bookmarks.saveStorageBox();
  }
  window.plugin.bookmarks.onPaneChanged = function(pane) {
    if(pane == "plugin-bookmarks")
      $('#bookmarksBox').css("display", "");
    else
      $('#bookmarksBox').css("display", "none");
  }
  // Switch list (maps/portals)
  window.plugin.bookmarks.switchPageBkmrksBox = function(elem, page) {
    window.plugin.bookmarks.statusBox.page = page;
    window.plugin.bookmarks.saveStorageBox();
    $('h5').removeClass('current');
    $(elem).addClass('current');
    var sectList = '#'+$(elem).attr('class').replace(' current', '');
    $('#bookmarksBox .bookmarkList').removeClass('current');
    $(sectList).addClass('current');
  }
  // Switch the status folder to open/close (in the localStorage)
  window.plugin.bookmarks.openFolder = function(elem) {
    $(elem).parent().parent('li').toggleClass('open');
    var typeList = $(elem).parent().parent().parent().parent('div').attr('id').replace('bkmrk_', '');
    var ID = $(elem).parent().parent('li').attr('id');
    var newFlag;
    var flag = window.plugin.bookmarks.bkmrksObj[typeList][ID]['state'];
    if(flag) { newFlag = 0; }
    else if(!flag) { newFlag = 1; }
    window.plugin.bookmarks.bkmrksObj[typeList][ID]['state'] = newFlag;
    window.plugin.bookmarks.saveStorage();
    window.runHooks('pluginBkmrksEdit', {"target": "folder", "action": newFlag?"open":"close", "id": ID});
  }
  // Load the HTML bookmarks
  window.plugin.bookmarks.loadList = function(typeList) {
    var element = '';
    var elementTemp = '';
    var elementExc = '';
    var returnToMap = '';
    if(window.plugin.bookmarks.isSmart) {
      returnToMap = 'window.show(\'map\');';
    }
    // For each folder
    var list = window.plugin.bookmarks.bkmrksObj[typeList];
    for(var idFolders in list) {
      var folders = list[idFolders];
      var active = '';
      // Create a label and a anchor for the sortable
      var folderDelete = '
<span class="folderLabel">
<a class="bookmarksRemoveFrom" onclick="window.plugin.bookmarks.removeElement(this, \'folder\');return false;" title="Remove this folder">
X
</a>
';
      var folderName = '
<a class="bookmarksAnchor" onclick="window.plugin.bookmarks.openFolder(this);return false">
<span>
</span>
'+folders['label']+'
</a>
</span>
';//
<span>
<span>
</span>
</span>
';
      var folderLabel = folderDelete+folderName;
      if(folders['state']) { active = ' open'; }
      if(idFolders === window.plugin.bookmarks.KEY_OTHER_BKMRK) {
        folderLabel = '';
        active= ' othersBookmarks open';
      }
      // Create a folder
      elementTemp = '
<li class="bookmarkFolder'+active+'" id="'+idFolders+'">
'+folderLabel+'
<ul>
';
      // For each bookmark
      var fold = folders['bkmrk'];
      for(var idBkmrk in fold) {
        var btn_link;
        var btn_remove = '
<a class="bookmarksRemoveFrom" onclick="window.plugin.bookmarks.removeElement(this, \''+typeList+'\');return false;" title="Remove from bookmarks">
X
</a>
';
        var btn_move = '';
        if(window.plugin.bookmarks.isSmart) {
          btn_move = '
<a class="bookmarksMoveIn" onclick="window.plugin.bookmarks.dialogMobileSort(\''+typeList+'\', this);return false;">
=
</a>
';
        }
        var bkmrk = fold[idBkmrk];
        var label = bkmrk['label'];
        var latlng = bkmrk['latlng'];
        // If it's a map
        if(typeList === 'maps') {
          if(bkmrk['label']=='') { label = bkmrk['latlng']+' ['+bkmrk['z']+']'; }
          btn_link = '
<a class="bookmarksLink" onclick="'+returnToMap+'window.map.setView(['+latlng+'], '+bkmrk['z']+');return false;">
'+label+'
</a>
';
        }
        // If it's a portal
        else if(typeList === 'portals') {
          var guid = bkmrk['guid'];
          var btn_link = '
<a class="bookmarksLink" onclick="$(\'a.bookmarksLink.selected\').removeClass(\'selected\');'+returnToMap+'window.zoomToAndShowPortal(\''+guid+'\', ['+latlng+']);return false;">
'+label+'
</a>
';
        }
        // Create the bookmark
        elementTemp += '
<li class="bkmrk" id="'+idBkmrk+'">
'+btn_remove+btn_move+btn_link+'
</li>
';
      }
      elementTemp += '
</li>
</ul>
';
      // Add folder 'Others' in last position
      if(idFolders != window.plugin.bookmarks.KEY_OTHER_BKMRK) { element += elementTemp; }
      else{ elementExc = elementTemp; }
    }
    element += elementExc;
    element = '
<ul>
'+element+'
</ul>
';
    // Append all folders and bookmarks
    $('#bkmrk_'+typeList).append(element);
  }
/***************************************************************************************************************************************************************/
  window.plugin.bookmarks.findByGuid = function(guid) {
    var list = window.plugin.bookmarks.bkmrksObj['portals'];
    for(var idFolders in list) {
      for(var idBkmrk in list[idFolders]['bkmrk']) {
        var portalGuid = list[idFolders]['bkmrk'][idBkmrk]['guid'];
        if(guid === portalGuid) {
          return {"id_folder":idFolders,"id_bookmark":idBkmrk};
        }
       }
    }
    return;
  }
  // Append a 'star' flag in sidebar.
  window.plugin.bookmarks.onPortalSelectedPending = false;
  window.plugin.bookmarks.onPortalSelected = function() {
    $('.bkmrksStar').remove();
    if(window.selectedPortal == null) return;
    if (!window.plugin.bookmarks.onPortalSelectedPending) {
      window.plugin.bookmarks.onPortalSelectedPending = true;
      setTimeout(function() { // the sidebar is constructed after firing the hook
        window.plugin.bookmarks.onPortalSelectedPending = false;
        $('.bkmrksStar').remove();
        if(typeof(Storage) === "undefined") {
          $('#portaldetails >
 .imgpreview').after(plugin.bookmarks.htmlDisabledMessage);
          return;
        }
        // Prepend a star to mobile status-bar
        if(window.plugin.bookmarks.isSmart) {
          $('#updatestatus').prepend(plugin.bookmarks.htmlStar);
          $('#updatestatus .bkmrksStar').attr('title', '');
        }
        $('#portaldetails >
 h3.title').before(plugin.bookmarks.htmlStar);
        window.plugin.bookmarks.updateStarPortal();
      }, 0);
    }
  }
  // Update the status of the star (when a portal is selected from the map/bookmarks-list)
  window.plugin.bookmarks.updateStarPortal = function() {
    var guid = window.selectedPortal;
    $('.bkmrksStar').removeClass('favorite');
    $('.bkmrk a.bookmarksLink.selected').removeClass('selected');
    // If current portal is into bookmarks: select bookmark portal from portals list and select the star
    if(localStorage[window.plugin.bookmarks.KEY_STORAGE].search(guid) != -1) {
      var bkmrkData = window.plugin.bookmarks.findByGuid(guid);
      if(bkmrkData) {
        $('.bkmrk#'+bkmrkData['id_bookmark']+' a.bookmarksLink').addClass('selected');
        $('.bkmrksStar').addClass('favorite');
      }
    }
  }
  // Switch the status of the star
  window.plugin.bookmarks.switchStarPortal = function(guid) {
    if(guid == undefined) guid = window.selectedPortal;
    // If portal is saved in bookmarks: Remove this bookmark
    var bkmrkData = window.plugin.bookmarks.findByGuid(guid);
    if(bkmrkData) {
      var list = window.plugin.bookmarks.bkmrksObj['portals'];
      delete list[bkmrkData['id_folder']]['bkmrk'][bkmrkData['id_bookmark']];
      $('.bkmrk#'+bkmrkData['id_bookmark']+'').remove();
      window.plugin.bookmarks.saveStorage();
      window.plugin.bookmarks.updateStarPortal();
      window.runHooks('pluginBkmrksEdit', {"target": "portal", "action": "remove", "folder": bkmrkData['id_folder'], "id": bkmrkData['id_bookmark'], "guid":guid});
      console.log('BOOKMARKS: removed portal ('+bkmrkData['id_bookmark']+' situated in '+bkmrkData['id_folder']+' folder)');
    }
    // If portal isn't saved in bookmarks: Add this bookmark
    else{
      // Get portal name and coordinates
      var p = window.portals[guid];
      var ll = p.getLatLng();
      plugin.bookmarks.addPortalBookmark(guid, ll.lat+','+ll.lng, p.options.data.title);
    }
  }
  plugin.bookmarks.addPortalBookmark = function(guid, latlng, label) {
    var ID = window.plugin.bookmarks.generateID();
    // Add bookmark in the localStorage
    window.plugin.bookmarks.bkmrksObj['portals'][window.plugin.bookmarks.KEY_OTHER_BKMRK]['bkmrk'][ID] = {"guid":guid,"latlng":latlng,"label":label};
    window.plugin.bookmarks.saveStorage();
    window.plugin.bookmarks.refreshBkmrks();
    window.runHooks('pluginBkmrksEdit', {"target": "portal", "action": "add", "id": ID, "guid": guid});
    console.log('BOOKMARKS: added portal '+ID);
  }
  // Add BOOKMARK/FOLDER
  window.plugin.bookmarks.addElement = function(elem, type) {
    var ID = window.plugin.bookmarks.generateID();
    var typeList = $(elem).parent().parent('div').attr('id');
    // Get the label | Convert some characters | Set the input (empty)
    var input = '#'+typeList+' .addForm input';
    var label = $(input).val();
    label = window.plugin.bookmarks.escapeHtml(label);
    $(input).val('');
    // Add a map
    if(type === 'map') {
      // Get the coordinates and zoom
      var c = map.getCenter();
      var lat = Math.round(c.lat*1E6)/1E6;
      var lng = Math.round(c.lng*1E6)/1E6;
      var latlng = lat+','+lng;
      var zoom = parseInt(map.getZoom());
      // Add bookmark in the localStorage
      window.plugin.bookmarks.bkmrksObj['maps'][plugin.bookmarks.KEY_OTHER_BKMRK]['bkmrk'][ID] = {"label":label,"latlng":latlng,"z":zoom};
    }
    else{
      if(label === '') { label = 'Folder'; }
      var short_type = typeList.replace('bkmrk_', '');
      // Add new folder in the localStorage
      window.plugin.bookmarks.bkmrksObj[short_type][ID] = {"label":label,"state":1,"bkmrk":{}};
    }
    window.plugin.bookmarks.saveStorage();
    window.plugin.bookmarks.refreshBkmrks();
    window.runHooks('pluginBkmrksEdit', {"target": type, "action": "add", "id": ID});
    console.log('BOOKMARKS: added '+type+' '+ID);
  }
  // Remove BOOKMARK/FOLDER
  window.plugin.bookmarks.removeElement = function(elem, type) {
    if(type === 'maps' || type === 'portals') {
      var typeList = $(elem).parent().parent().parent().parent().parent('div').attr('id');
      var ID = $(elem).parent('li').attr('id');
      var IDfold = $(elem).parent().parent().parent('li').attr('id');
      var guid = window.plugin.bookmarks.bkmrksObj[typeList.replace('bkmrk_', '')][IDfold]['bkmrk'][ID].guid;
      delete window.plugin.bookmarks.bkmrksObj[typeList.replace('bkmrk_', '')][IDfold]['bkmrk'][ID];
      $(elem).parent('li').remove();
      if(type === 'portals') {
        var list = window.plugin.bookmarks.bkmrksObj['portals'];
        window.plugin.bookmarks.updateStarPortal();
        window.plugin.bookmarks.saveStorage();
        window.runHooks('pluginBkmrksEdit', {"target": "portal", "action": "remove", "folder": IDfold, "id": ID, "guid": guid});
        console.log('BOOKMARKS: removed portal ('+ID+' situated in '+IDfold+' folder)');
      } else {
        window.plugin.bookmarks.saveStorage();
        window.runHooks('pluginBkmrksEdit', {"target": "map", "action": "remove", "id": ID});
        console.log('BOOKMARKS: removed map '+ID);
      }
    }
    else if(type === 'folder') {
      var typeList = $(elem).parent().parent().parent().parent('div').attr('id');
      var ID = $(elem).parent().parent('li').attr('id');
      delete plugin.bookmarks.bkmrksObj[typeList.replace('bkmrk_', '')][ID];
      $(elem).parent().parent('li').remove();
      window.plugin.bookmarks.saveStorage();
      window.plugin.bookmarks.updateStarPortal();
      window.runHooks('pluginBkmrksEdit', {"target": "folder", "action": "remove", "id": ID});
      console.log('BOOKMARKS: removed folder '+ID);
    }
  }
  window.plugin.bookmarks.deleteMode = function() {
    $('#bookmarksBox').removeClass('moveMode').toggleClass('deleteMode');
  }
  window.plugin.bookmarks.moveMode = function() {
    $('#bookmarksBox').removeClass('deleteMode').toggleClass('moveMode');
  }
  window.plugin.bookmarks.mobileSortIDb = '';
  window.plugin.bookmarks.mobileSortIDf = '';
  window.plugin.bookmarks.dialogMobileSort = function(type, elem){
    window.plugin.bookmarks.mobileSortIDb = $(elem).parent('li.bkmrk').attr('id');
    window.plugin.bookmarks.mobileSortIDf = $(elem).parent('li.bkmrk').parent('ul').parent('li.bookmarkFolder').attr('id');
    if(type === 'maps'){ type = 1; }
    else if(type === 'portals'){ type = 2; }
    dialog({
      html: window.plugin.bookmarks.dialogLoadListFolders('bookmarksDialogMobileSort', 'window.plugin.bookmarks.mobileSort', true, type),
      dialogClass: 'ui-dialog-bkmrksSet-copy',
      title: 'Bookmarks - Move Bookmark'
    });
  }
  window.plugin.bookmarks.mobileSort = function(elem){
    var type = $(elem).data('type');
    var idBkmrk = window.plugin.bookmarks.mobileSortIDb;
    var newFold = $(elem).data('id');
    var oldFold = window.plugin.bookmarks.mobileSortIDf;
    var Bkmrk = window.plugin.bookmarks.bkmrksObj[type][oldFold].bkmrk[idBkmrk];
    delete window.plugin.bookmarks.bkmrksObj[type][oldFold].bkmrk[idBkmrk];
    window.plugin.bookmarks.bkmrksObj[type][newFold].bkmrk[idBkmrk] = Bkmrk;
    window.plugin.bookmarks.saveStorage();
    window.plugin.bookmarks.refreshBkmrks();
    window.runHooks('pluginBkmrksEdit', {"target": "bookmarks", "action": "sort"});
    window.plugin.bookmarks.mobileSortIDf = newFold;
    console.log('Move Bookmarks '+type+' ID:'+idBkmrk+' from folder ID:'+oldFold+' to folder ID:'+newFold);
  }
  window.plugin.bookmarks.onSearch = function(query) {
    var term = query.term.toLowerCase();
    $.each(plugin.bookmarks.bkmrksObj.maps, function(id, folder) {
      $.each(folder.bkmrk, function(id, bookmark) {
        if(bookmark.label.toLowerCase().indexOf(term) === -1) return;
        query.addResult({
          title: escapeHtmlSpecialChars(bookmark.label),
          description: 'Map in folder "' + escapeHtmlSpecialChars(folder.label) + '"',
          icon: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAADYSURBVCiRldExLoRxEAXw33xZ4QIKB9BQWPl0yFKJA4hCo1CqXMABVA6gcgkFnc7/s7VQaByAgoYdhU3sZr9NmGSaee/NvJeJUkr6R3WgrusYm/ajJ7zr5t3ouGmarFrXpFPpuA2aFDSxIWxjXz/mWy25jx3hEAsqS0NsFi/68YxHlXPK8MKbGwR6GN06g0XhwYrrX0tb+enJAS5b8pzp5gk5GM+wl1/C1YQgfEwPPbA+JN3iAgMsTxeEOWlXNzet5pHKGl7HOKWUzEx/6VJKdvj54IT3KfUNvrNZ/jYm+uoAAAAASUVORK5CYII=',
          position: L.latLng(bookmark.latlng.split(",")),
          zoom: bookmark.z,
          onSelected: window.plugin.bookmarks.onSearchResultSelected,
        });
      });
    });
    $.each(plugin.bookmarks.bkmrksObj.portals, function(id, folder) {
      $.each(folder.bkmrk, function(id, bookmark) {
        if(bookmark.label.toLowerCase().indexOf(term) === -1) return;
        query.addResult({
          title: escapeHtmlSpecialChars(bookmark.label),
          description: 'Bookmark in folder "' + escapeHtmlSpecialChars(folder.label) + '"',
          icon: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAADFSURBVCiRrdEtTkMBEATgb19C0gsgEEgMFW2TooAURzgACoNAorgAB6jqAVBcghBQYPmxBAQeBYYQ4C2CJvTlPUibMG53ZpKZ3chMs6Bo3N7EwG2sTG9Ih9J+ExW1SFexpnCBNyzq5VPdcB2bwi4WsIz5Mf+OR9wrjHTy9DvSi3MEBhNimMOScKfj7KfDRn54sIPjhj5D3Twgy2rp7fwUTuotvU6O1SuVVseiSxyhRPt3Q2hJW7q5rpd7Cn08VyT/8+k/8AVY7Dd1pA43RAAAAABJRU5ErkJggg==',
          position: L.latLng(bookmark.latlng.split(",")),
          guid: bookmark.guid,
          onSelected: window.plugin.bookmarks.onSearchResultSelected,
        });
      });
    });
  };
  window.plugin.bookmarks.onSearchResultSelected = function(result, event) {
    if(result.guid) { // portal
      var guid = result.guid;
      if(event.type == 'dblclick')
        zoomToAndShowPortal(guid, result.position);
      else if(window.portals[guid])
        renderPortalDetails(guid);
      else
        window.selectPortalByLatLng(result.position);
    } else if(result.zoom) { // map
      map.setView(result.position, result.zoom);
    }
    return true; // prevent default behavior
  };
/***************************************************************************************************************************************************************/
  // Saved the new sort of the folders (in the localStorage)
  window.plugin.bookmarks.sortFolder = function(typeList) {
    var keyType = typeList.replace('bkmrk_', '');
    var newArr = {};
    $('#'+typeList+' li.bookmarkFolder').each(function() {
        var idFold = $(this).attr('id');
      newArr[idFold] = window.plugin.bookmarks.bkmrksObj[keyType][idFold];
    });
    window.plugin.bookmarks.bkmrksObj[keyType] = newArr;
    window.plugin.bookmarks.saveStorage();
    window.runHooks('pluginBkmrksEdit', {"target": "folder", "action": "sort"});
    console.log('BOOKMARKS: sorted folder');
  }
  // Saved the new sort of the bookmarks (in the localStorage)
  window.plugin.bookmarks.sortBookmark = function(typeList) {
    var keyType = typeList.replace('bkmrk_', '');
    var list = window.plugin.bookmarks.bkmrksObj[keyType];
    var newArr = {};
    $('#'+typeList+' li.bookmarkFolder').each(function() {
      var idFold = $(this).attr('id');
      newArr[idFold] = window.plugin.bookmarks.bkmrksObj[keyType][idFold];
      newArr[idFold].bkmrk = {};
    });
    $('#'+typeList+' li.bkmrk').each(function() {
      window.plugin.bookmarks.loadStorage();
      var idFold = $(this).parent().parent('li').attr('id');
      var id = $(this).attr('id');
      var list = window.plugin.bookmarks.bkmrksObj[keyType];
      for(var idFoldersOrigin in list) {
        for(var idBkmrk in list[idFoldersOrigin]['bkmrk']) {
          if(idBkmrk == id) {
            newArr[idFold].bkmrk[id] = window.plugin.bookmarks.bkmrksObj[keyType][idFoldersOrigin].bkmrk[id];
          }
        }
      }
    });
    window.plugin.bookmarks.bkmrksObj[keyType] = newArr;
    window.plugin.bookmarks.saveStorage();
    window.runHooks('pluginBkmrksEdit', {"target": "bookmarks", "action": "sort"});
    console.log('BOOKMARKS: sorted bookmark (portal/map)');
  }
  window.plugin.bookmarks.jquerySortableScript = function() {
    $(".bookmarkList >
 ul").sortable({
      items:"li.bookmarkFolder:not(.othersBookmarks)",
      handle:".bookmarksAnchor",
      placeholder:"sortable-placeholder",
      helper:'clone', // fix accidental click in firefox
      forcePlaceholderSize:true,
      update:function(event, ui) {
        var typeList = $('#'+ui.item.context.id).parent().parent('.bookmarkList').attr('id');
        window.plugin.bookmarks.sortFolder(typeList);
      }
    });
    $(".bookmarkList ul li ul").sortable({
      items:"li.bkmrk",
      connectWith:".bookmarkList ul ul",
      handle:".bookmarksLink",
      placeholder:"sortable-placeholder",
      helper:'clone', // fix accidental click in firefox
      forcePlaceholderSize:true,
      update:function(event, ui) {
        var typeList = $('#'+ui.item.context.id).parent().parent().parent().parent('.bookmarkList').attr('id');
        window.plugin.bookmarks.sortBookmark(typeList);
      }
    });
  }
/***************************************************************************************************************************************************************/
/** OPTIONS ****************************************************************************************************************************************************/
/***************************************************************************************************************************************************************/
  // Manual import, export and reset data
  window.plugin.bookmarks.manualOpt = function() {
    dialog({
      html: plugin.bookmarks.htmlSetbox,
      dialogClass: 'ui-dialog-bkmrksSet',
      title: 'Bookmarks Options'
    });
    window.runHooks('pluginBkmrksOpenOpt');
  }
  window.plugin.bookmarks.optAlert = function(message) {
      $('.ui-dialog-bkmrksSet .ui-dialog-buttonset').prepend('
<p class="bkrmks-alert" style="float:left;margin-top:4px;">
'+message+'
</p>
');
      $('.bkrmks-alert').delay(2500).fadeOut();
  }
  window.plugin.bookmarks.optCopy = function() {
    if(typeof android !== 'undefined' && android && android.shareString) {
      return android.shareString(localStorage[window.plugin.bookmarks.KEY_STORAGE]);
    } else {
      dialog({
        html: '
<p>
<a onclick="$(\'.ui-dialog-bkmrksSet-copy textarea\').select();">
Select all
</a>
 and press CTRL+C to copy it.
</p>
<textarea readonly>
'+localStorage[window.plugin.bookmarks.KEY_STORAGE]+'
</textarea>
',
        dialogClass: 'ui-dialog-bkmrksSet-copy',
        title: 'Bookmarks Export'
      });
    }
  }
  window.plugin.bookmarks.optExport = function() {
    if(typeof android !== 'undefined' && android && android.saveFile) {
      android.saveFile("IITC-bookmarks.json", "application/json", localStorage[window.plugin.bookmarks.KEY_STORAGE]);
    }
  }
  window.plugin.bookmarks.optPaste = function() {
    var promptAction = prompt('Press CTRL+V to paste it.', '');
    if(promptAction !== null && promptAction !== '') {
      try {
        JSON.parse(promptAction); // try to parse JSON first
        localStorage[window.plugin.bookmarks.KEY_STORAGE] = promptAction;
        window.plugin.bookmarks.refreshBkmrks();
        window.runHooks('pluginBkmrksEdit', {"target": "all", "action": "import"});
        console.log('BOOKMARKS: reset and imported bookmarks');
        window.plugin.bookmarks.optAlert('Successful. ');
      } catch(e) {
        console.warn('BOOKMARKS: failed to import data: '+e);
        window.plugin.bookmarks.optAlert('
<span style="color: #f88">
Import failed
</span>
');
      }
    }
  }
  window.plugin.bookmarks.optImport = function() {
    if (window.requestFile === undefined) return;
    window.requestFile(function(filename, content) {
      try {
        JSON.parse(content); // try to parse JSON first
        localStorage[window.plugin.bookmarks.KEY_STORAGE] = content;
        window.plugin.bookmarks.refreshBkmrks();
        window.runHooks('pluginBkmrksEdit', {"target": "all", "action": "import"});
        console.log('BOOKMARKS: reset and imported bookmarks');
        window.plugin.bookmarks.optAlert('Successful. ');
      } catch(e) {
        console.warn('BOOKMARKS: failed to import data: '+e);
        window.plugin.bookmarks.optAlert('
<span style="color: #f88">
Import failed
</span>
');
      }
    });
  }
  window.plugin.bookmarks.optReset = function() {
    var promptAction = confirm('All bookmarks will be deleted. Are you sure?', '');
    if(promptAction) {
      delete localStorage[window.plugin.bookmarks.KEY_STORAGE];
      window.plugin.bookmarks.createStorage();
      window.plugin.bookmarks.loadStorage();
      window.plugin.bookmarks.refreshBkmrks();
      window.runHooks('pluginBkmrksEdit', {"target": "all", "action": "reset"});
      console.log('BOOKMARKS: reset all bookmarks');
      window.plugin.bookmarks.optAlert('Successful. ');
    }
  }
  window.plugin.bookmarks.optBox = function(command) {
    if(!window.plugin.bookmarks.isAndroid()) {
      switch(command) {
        case 'save':
          var boxX = parseInt($('#bookmarksBox').css('top'));
          var boxY = parseInt($('#bookmarksBox').css('left'));
          window.plugin.bookmarks.statusBox.pos = {x:boxX, y:boxY};
          window.plugin.bookmarks.saveStorageBox();
          window.plugin.bookmarks.optAlert('Position acquired. ');
          break;
        case 'reset':
          $('#bookmarksBox').css({'top':100, 'left':100});
          window.plugin.bookmarks.optBox('save');
          break;
      }
    } else {
      window.plugin.bookmarks.optAlert('Only IITC desktop. ');
    }
  }
  window.plugin.bookmarks.dialogLoadListFolders = function(idBox, clickAction, showOthersF, scanType/*0 = maps&portals; 1 = maps; 2 = portals*/) {
    var list = JSON.parse(localStorage['plugin-bookmarks']);
    var listHTML = '';
    var foldHTML = '';
    var elemGenericFolder = '';
    // For each type and folder
    for(var type in list){
      if(scanType === 0 || (scanType === 1 && type === 'maps') || (scanType === 2 && type === 'portals')){
        listHTML += '
<h3>
'+type+':
</h3>
';
        for(var idFolders in list[type]) {
          var label = list[type][idFolders]['label'];
          // Create a folder
          foldHTML = '
<div class="bookmarkFolder" id="'+idFolders+'" data-type="'+type+'" data-id="'+idFolders+'" onclick="'+clickAction+'(this)";return false;">
'+label+'
</div>
';
          if(idFolders !== window.plugin.bookmarks.KEY_OTHER_BKMRK) {
            listHTML += foldHTML;
          } else {
            if(showOthersF === true){
              elemGenericFolder = foldHTML;
            }
          }
        }
      }
      listHTML += elemGenericFolder;
      elemGenericFolder = '';
    }
    // Append all folders
    var r = '
<div class="bookmarksDialog" id="'+idBox+'">
'
      + listHTML
      + '
</div>
';
    return r;
  }
  window.plugin.bookmarks.renameFolder = function(elem){
    var type = $(elem).data('type');
    var idFold = $(elem).data('id');
    var promptAction = prompt('Insert a new name.', '');
    if(promptAction !== null && promptAction !== '') {
      try {
        var newName = window.plugin.bookmarks.escapeHtml(promptAction);
        window.plugin.bookmarks.bkmrksObj[type][idFold].label = newName;
        $('#bookmarksDialogRenameF #'+idFold).text(newName);
        window.plugin.bookmarks.saveStorage();
        window.plugin.bookmarks.refreshBkmrks();
        window.runHooks('pluginBkmrksEdit', {"target": "all", "action": "import"});
        console.log('BOOKMARKS: renamed bookmarks folder');
        window.plugin.bookmarks.optAlert('Successful. ');
      } catch(e) {
        console.warn('BOOKMARKS: failed to rename folder: '+e);
        window.plugin.bookmarks.optAlert('
<span style="color: #f88">
Rename failed
</span>
');
        return;
      }
    }
  }
  window.plugin.bookmarks.optRenameF = function() {
    dialog({
      html: window.plugin.bookmarks.dialogLoadListFolders('bookmarksDialogRenameF', 'window.plugin.bookmarks.renameFolder', false, 0),
      dialogClass: 'ui-dialog-bkmrksSet-copy',
      title: 'Bookmarks Rename Folder'
    });
  }
/***************************************************************************************************************************************************************/
/** AUTO DRAW **************************************************************************************************************************************************/
/***************************************************************************************************************************************************************/
  window.plugin.bookmarks.dialogDrawer = function() {
    dialog({
      html:window.plugin.bookmarks.dialogLoadList,
      dialogClass:'ui-dialog-autodrawer',
      title:'Bookmarks - Auto Draw',
      buttons:{
        'DRAW': function() {
          window.plugin.bookmarks.draw(0);
        },
        'DRAW&VIEW': function() {
          window.plugin.bookmarks.draw(1);
        }
      }
    });
    window.plugin.bookmarks.autoDrawOnSelect();
  }
  window.plugin.bookmarks.draw = function(view) {
    var latlngs = [];
    var uuu = $('#bkmrksAutoDrawer a.bkmrk.selected').each(function(i) {
      var tt = $(this).data('latlng');
      latlngs[i] = tt;
    });
    if(latlngs.length >
= 2 && latlngs.length
<= 3) {
      // TODO: add an API to draw-tools rather than assuming things about its internals
      var layer, layerType;
      if(latlngs.length == 2) {
        layer = L.geodesicPolyline(latlngs, window.plugin.drawTools.lineOptions);
        layerType = 'polyline';
      } else {
        layer = L.geodesicPolygon(latlngs, window.plugin.drawTools.polygonOptions);
        layerType = 'polygon';
      }
      map.fire('draw:created', {
        layer: layer,
        layerType: layerType
      });
      if($('#bkmrkClearSelection').prop('checked'))
        $('#bkmrksAutoDrawer a.bkmrk.selected').removeClass('selected');
      if(window.plugin.bookmarks.isSmart) {
        window.show('map');
      }
      // Shown the layer if it is hidden
      if(!map.hasLayer(window.plugin.drawTools.drawnItems)) {
        map.addLayer(window.plugin.drawTools.drawnItems);
      }
      if(view) {
        map.fitBounds(layer.getBounds());
      }
    }
  }
  window.plugin.bookmarks.autoDrawOnSelect = function() {
    var latlngs = [];
    var uuu = $('#bkmrksAutoDrawer a.bkmrk.selected').each(function(i) {
      var tt = $(this).data('latlng');
      latlngs[i] = tt;
    });
    var text = "You must select 2 or 3 portals!";
    var color = "red";
    function formatDistance(distance) {
      var text = digits(distance >
 10000 ? (distance/1000).toFixed(2) + "km" : (Math.round(distance) + "m"));
      return distance >
= 200000
        ? '
<em title="Long distance link" class="help longdistance">
'+text+'
</em>
'
        : text;
    }
    if(latlngs.length == 2) {
      var distance = L.latLng(latlngs[0]).distanceTo(latlngs[1]);
      text = 'Distance between portals: ' + formatDistance(distance);
      color = "";
    } else if(latlngs.length == 3) {
      var longdistance = false;
      var distances = latlngs.map(function(ll1, i, latlngs) {
        var ll2 = latlngs[(i+1)%3];
        return formatDistance(L.latLng(ll1).distanceTo(ll2));
      });
      text = 'Distances: ' + distances.join(", ");
      color = "";
    }
    $('#bkmrksAutoDrawer p')
      .html(text)
      .css("color", color);
  }
  window.plugin.bookmarks.dialogLoadList = function() {
    var r = 'The "
<a href="http://iitc.jonatkins.com/?page=desktop#plugin-draw-tools" target="_BLANK">
<strong>
Draw Tools
</strong>
</a>
" plugin is required.
</span>
';
    if(!window.plugin.bookmarks || !window.plugin.drawTools) {
      $('.ui-dialog-autodrawer .ui-dialog-buttonset .ui-button:not(:first)').hide();
    }
    else{
      var portalsList = JSON.parse(localStorage['plugin-bookmarks']);
      var element = '';
      var elementTemp = '';
      var elemGenericFolder = '';
      // For each folder
      var list = portalsList.portals;
      for(var idFolders in list) {
        var folders = list[idFolders];
        // Create a label and a anchor for the sortable
        var folderLabel = '
<a class="folderLabel" onclick="$(this).siblings(\'div\').toggle();return false;">
'+folders['label']+'
</a>
';
        // Create a folder
        elementTemp = '
<div class="bookmarkFolder" id="'+idFolders+'">
'+folderLabel+'
<div>
';
        // For each bookmark
        var fold = folders['bkmrk'];
        for(var idBkmrk in fold) {
          var bkmrk = fold[idBkmrk];
          var label = bkmrk['label'];
          var latlng = bkmrk['latlng'];
          // Create the bookmark
          elementTemp += '
<a class="bkmrk" id="'+idBkmrk+'" onclick="$(this).toggleClass(\'selected\');return false" data-latlng="['+latlng+']">
'+label+'
</a>
';
        }
        elementTemp += '
</div>
</div>
';
        if(idFolders !== window.plugin.bookmarks.KEY_OTHER_BKMRK) {
          element += elementTemp;
        } else {
          elemGenericFolder += elementTemp;
        }
      }
      element += elemGenericFolder;
      // Append all folders and bookmarks
      r = '
<div id="bkmrksAutoDrawer">
'
        + '
<label style="margin-bottom: 9px; display: block;">
'
        + '
<input style="vertical-align: middle;" type="checkbox" id="bkmrkClearSelection" checked>
'
        + ' Clear selection after drawing
</label>
'
        + '
<p style="margin-bottom:9px;color:red">
You must select 2 or 3 portals!
</p>
'
        + '
<div onclick="window.plugin.bookmarks.autoDrawOnSelect();return false;">
'
        + element
        + '
</div>
'
        + '
</div>
';
    }
    return r;
  }
/***************************************************************************************************************************************************************/
/** SYNC *******************************************************************************************************************************************************/
/***************************************************************************************************************************************************************/
  // Delay the syncing to group a few updates in a single request
  window.plugin.bookmarks.delaySync = function() {
    if(!window.plugin.bookmarks.enableSync) return;
    clearTimeout(plugin.bookmarks.delaySync.timer);
    window.plugin.bookmarks.delaySync.timer = setTimeout(function() {
        window.plugin.bookmarks.delaySync.timer = null;
        window.plugin.bookmarks.syncNow();
      }, window.plugin.bookmarks.SYNC_DELAY);
  }
  // Store the updateQueue in updatingQueue and upload
  window.plugin.bookmarks.syncNow = function() {
    if(!window.plugin.bookmarks.enableSync) return;
    $.extend(window.plugin.bookmarks.updatingQueue, window.plugin.bookmarks.updateQueue);
    window.plugin.bookmarks.updateQueue = {};
    window.plugin.bookmarks.storeLocal(window.plugin.bookmarks.UPDATING_QUEUE);
    window.plugin.bookmarks.storeLocal(window.plugin.bookmarks.UPDATE_QUEUE);
    window.plugin.sync.updateMap('bookmarks', window.plugin.bookmarks.KEY.field, Object.keys(window.plugin.bookmarks.updatingQueue));
  }
  // Call after IITC and all plugin loaded
  window.plugin.bookmarks.registerFieldForSyncing = function() {
    if(!window.plugin.sync) return;
    window.plugin.sync.registerMapForSync('bookmarks', window.plugin.bookmarks.KEY.field, window.plugin.bookmarks.syncCallback, window.plugin.bookmarks.syncInitialed);
  }
  // Call after local or remote change uploaded
  window.plugin.bookmarks.syncCallback = function(pluginName, fieldName, e, fullUpdated) {
    if(fieldName === window.plugin.bookmarks.KEY.field) {
      window.plugin.bookmarks.storeLocal(window.plugin.bookmarks.KEY);
      // All data is replaced if other client update the data during this client offline,
      if(fullUpdated) {
        window.plugin.bookmarks.refreshBkmrks();
        return;
      }
      if(!e) return;
      if(e.isLocal) {
        // Update pushed successfully, remove it from updatingQueue
        delete window.plugin.bookmarks.updatingQueue[e.property];
      } else {
        // Remote update
        delete window.plugin.bookmarks.updateQueue[e.property];
        window.plugin.bookmarks.storeLocal(window.plugin.bookmarks.UPDATE_QUEUE);
        window.plugin.bookmarks.refreshBkmrks();
        window.runHooks('pluginBkmrksSyncEnd', {"target": "all", "action": "sync"});
        console.log('BOOKMARKS: synchronized all');
      }
    }
  }
  // syncing of the field is initialed, upload all queued update
  window.plugin.bookmarks.syncInitialed = function(pluginName, fieldName) {
    if(fieldName === window.plugin.bookmarks.KEY.field) {
      window.plugin.bookmarks.enableSync = true;
      if(Object.keys(window.plugin.bookmarks.updateQueue).length >
 0) {
        window.plugin.bookmarks.delaySync();
      }
    }
  }
  window.plugin.bookmarks.storeLocal = function(mapping) {
    if(typeof(window.plugin.bookmarks[mapping.field]) !== 'undefined' && window.plugin.bookmarks[mapping.field] !== null) {
      localStorage[mapping.key] = JSON.stringify(window.plugin.bookmarks[mapping.field]);
    } else {
      localStorage.removeItem(mapping.key);
    }
  }
  window.plugin.bookmarks.loadLocal = function(mapping) {
    var objectJSON = localStorage[mapping.key];
    if(!objectJSON) return;
    window.plugin.bookmarks[mapping.field] = mapping.convertFunc
                            ? mapping.convertFunc(JSON.parse(objectJSON))
                            : JSON.parse(objectJSON);
  }
  window.plugin.bookmarks.syncBkmrks = function() {
    window.plugin.bookmarks.loadLocal(window.plugin.bookmarks.KEY);
    window.plugin.bookmarks.updateQueue = window.plugin.bookmarks.bkmrksObj;
    window.plugin.bookmarks.storeLocal(window.plugin.bookmarks.UPDATE_QUEUE);
    window.plugin.bookmarks.delaySync();
  }
/***************************************************************************************************************************************************************/
/** HIGHLIGHTER ************************************************************************************************************************************************/
/***************************************************************************************************************************************************************/
  window.plugin.bookmarks.highlight = function(data) {
    var guid = data.portal.options.ent[0];
    if(window.plugin.bookmarks.findByGuid(guid)) {
      data.portal.setStyle({fillColor:'red'});
    }
  }
  window.plugin.bookmarks.highlightRefresh = function(data) {
    if(_current_highlighter === 'Bookmarked Portals') {
      if(data.action === 'sync' || data.target === 'portal' || (data.target === 'folder' && data.action === 'remove') || (data.target === 'all' && data.action === 'import') || (data.target === 'all' && data.action === 'reset')) {
        window.resetHighlightedPortals();
      }
    }
  }
/***************************************************************************************************************************************************************/
/** BOOKMARKED PORTALS LAYER ***********************************************************************************************************************************/
/***************************************************************************************************************************************************************/
  window.plugin.bookmarks.addAllStars = function() {
    var list = window.plugin.bookmarks.bkmrksObj.portals;
    for(var idFolders in list) {
      for(var idBkmrks in list[idFolders]['bkmrk']) {
        var latlng = list[idFolders]['bkmrk'][idBkmrks].latlng.split(",");
        var guid = list[idFolders]['bkmrk'][idBkmrks].guid;
        var lbl = list[idFolders]['bkmrk'][idBkmrks].label;
        window.plugin.bookmarks.addStar(guid, latlng, lbl);
      }
    }
  }
  window.plugin.bookmarks.resetAllStars = function() {
    for(guid in window.plugin.bookmarks.starLayers) {
      var starInLayer = window.plugin.bookmarks.starLayers[guid];
      window.plugin.bookmarks.starLayerGroup.removeLayer(starInLayer);
      delete window.plugin.bookmarks.starLayers[guid];
    }
    window.plugin.bookmarks.addAllStars();
  }
  window.plugin.bookmarks.addStar = function(guid, latlng, lbl) {
    var star = L.marker(latlng, {
      title: lbl,
      icon: L.icon({
        iconUrl: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAoCAMAAACo9wirAAAAzFBMVEXbuTR9YwDd0T+ulyry2VDt53/s5Jv34a+tmUbJtGRtVwAtJADg14j304viyIZeSwDXyH5IOQD07JLPvnhqVQBuWACmkjpgTQBxWwC4p1WchikRDQCPdxeBaAQTDwADAgAOCwAAAAAAAAAAAAALCQAAAAAAAAAAAAD9+Jb97IT+3VT9+WH+0i3993D+80793Yr/yXL+5Tr+6XL+zEP/z2X+vSX+zB/+52L/qw393SX89xr9+yv/siP/vUf9+Dv+20P+rgH+xQv+vgH+twNAe/b8AAAAKHRSTlPywvLj+vn4/OLrqFb0/PSS8Hb77meB4FGX5t1A2dUkEy8HDQoaAwEAoclaPQAAAo1JREFUeF5VkeeyozAMRrPphdwkdIxpBu7SSe/llvd/p5VxlMx+PxiMzhxJuPX3mc/PzzgIQwYJwyCGoyggwMuRav6BmKrLGgQBrBvUkuQkkSWLGh5DooX1UNWlXplDyp6kq5EXCqL1qlu9srpfIPeq7FmaIBCIA9WScyjznC/3XOZEEAsABIFBoH6GUrt9v5zPQEAXFoCiAWLPkUqon+8lIbl4kRwfmggABFZSXXh9PhbopUos1fWCBoAJnT4MCMMlZLHQE/Hed/wIFA3gkiSvqjLtK45tO/N+WlZVnhA7YgKAFZK83dGJM5v4rmFSonfaeWotoEcDhJqSVl06W0A5gviTGelWqTJzvZADcWjO11XVIzPbjzzGPFfT4bxWTD8SAANgtTrIQ8eF3QPmDOXDarWej/mUL+C0SgfU91gcR3TAj42BNQDMAMDpwBfzwjCi/cMJgNFMGGBIY5g+AACnrWl+NJay0+mRDhcAiDVdKsOnzJqZRFGoZo74SaYTXDPwzPnhUTw6dCSnaT2inUdRHD7GNgIxM/QUvrW6WfZ4ZFm3VRSiA4sFEEaOlBX7oij2EP4ssqlj413wHqq13uy/X9lvYAcbb5P3cGmd7b9/nvneZzWdNB0EAApN2RZvoNjCvfKb4IBQ+LTe7H5+RXabmjwFCISw6Xb3i8D2oxEgwMdkBgHF7xeEC/SF34yIAN90/LHdHb94QCB2REBsauj17cqB660eogAB8bOE4vgUsBiBt2J6ux6P19v0OQECb8V8y4G34D+AKwgoQEBQgMBLYSrL222pjHEFBN4KOl0up/wWUIAA/k5tNBg014gCBPB3+s5g0EwYYB2Bl8KyND9CAQJvgnmq6kYeXxHzDyATueNnvZcYAAAAAElFTkSuQmCC',
        iconAnchor: [15,40],
        iconSize: [30,40]
      })
    });
    window.registerMarkerForOMS(star);
    star.on('spiderfiedclick', function() { renderPortalDetails(guid); });
    window.plugin.bookmarks.starLayers[guid] = star;
    star.addTo(window.plugin.bookmarks.starLayerGroup);
  }
  window.plugin.bookmarks.editStar = function(data) {
    if(data.target === 'portal') {
      if(data.action === 'add') {
        var guid = data.guid;
        var latlng = window.portals[guid].getLatLng();
        var lbl = window.portals[guid].options.data.title;
        var starInLayer = window.plugin.bookmarks.starLayers[data.guid];
        window.plugin.bookmarks.addStar(guid, latlng, lbl);
      }
      else if(data.action === 'remove') {
        var starInLayer = window.plugin.bookmarks.starLayers[data.guid];
        window.plugin.bookmarks.starLayerGroup.removeLayer(starInLayer);
        delete window.plugin.bookmarks.starLayers[data.guid];
      }
    }
    else if((data.target === 'all' && (data.action === 'import' || data.action === 'reset')) || (data.target === 'folder' && data.action === 'remove')) {
      window.plugin.bookmarks.resetAllStars();
    }
  }
/***************************************************************************************************************************************************************/
  window.plugin.bookmarks.setupCSS = function() {
    $('
<style>
').prop('type', 'text/css').html('/* hide when printing */\n@media print {\n  #bkmrksTrigger { display: none !important; }\n}\n\n\n#bookmarksBox *{\n display:block;\n    padding:0;\n    margin:0;\n width:auto;\n   height:auto;\n  font-family:Verdana,Geneva,sans-serif;\n    font-size:13px;\n   line-height:22px;\n text-indent:0;\n    text-decoration:none;\n -webkit-box-sizing:border-box;\n    -moz-box-sizing:border-box;\n   box-sizing:border-box;\n}\n\n#bookmarksBox{\n   display:block;\n    position:absolute !important;\n z-index:4001;\n top:100px;\n    left:100px;\n   width:231px;\n  height:auto;\n  overflow:hidden;\n}\n#bookmarksBox .addForm,\n#bookmarksBox #bookmarksTypeBar,\n#bookmarksBox h5{\n height:28px;\n  overflow:hidden;\n  color:#fff;\n   font-size:14px;\n}\n#bookmarksBox #topBar{\n    height:15px !important;\n}\n#bookmarksBox #topBar *{\n  height: 14px !important;\n}\n#bookmarksBox #topBar *{\n float:left !important;\n}\n#bookmarksBox .handle{\n width:80%;\n    text-align:center;\n    color:#fff;\n   line-height:6px;\n  cursor:move;\n}\n#bookmarksBox #topBar .btn{\n  display:block;\n    width:10%;\n    cursor:pointer;\n   color:#20a8b1;\n\n  font-weight:bold;\n text-align:center;\n    line-height:13px;\n font-size:18px;\n}\n\n#bookmarksBox #topBar #bookmarksDel{\n    overflow:hidden;\n  text-indent:-999px;\n   background:#B42E2E;\n}\n\n#bookmarksBox #topBar #bookmarksMin:hover{\n  color:#ffce00;\n}\n#bookmarksBox #bookmarksTypeBar{\n   clear:both;\n}\n#bookmarksBox h5{\n padding:4px 0 23px;\n   width:50%;\n    height:93px !important;\n   text-align:center;\n    color:#788;\n}\n#bookmarksBox h5.current{\n cursor:default;\n   background:0;\n color:#fff !important;\n}\n#bookmarksBox h5:hover{\n    color:#ffce00;\n    background:rgba(0,0,0,0);\n}\n#bookmarksBox #topBar,\n#bookmarksBox .addForm,\n#bookmarksBox #bookmarksTypeBar,\n#bookmarksBox .bookmarkList li.bookmarksEmpty,\n#bookmarksBox .bookmarkList li.bkmrk a,\n#bookmarksBox .bookmarkList li.bkmrk:hover{\n background-color:rgba(8,48,78,.85);\n}\n#bookmarksBox h5,\n#bookmarksBox .bookmarkList li.bkmrk:hover .bookmarksLink,\n#bookmarksBox .addForm *{\n  background:rgba(0,0,0,.3);\n}\n#bookmarksBox .addForm *{\n  display:block;\n    float:left;\n   height:28px !important;\n}\n#bookmarksBox .addForm a{\n cursor:pointer;\n   color:#20a8b1;\n    font-size:12px;\n   width:35%;\n    text-align:center;\n    line-height:20px;\n padding:4px 0 23px;\n}\n#bookmarksBox .addForm a:hover{\n   background:#ffce00;\n   color:#000;\n   text-decoration:none;\n}\n#bookmarksBox .addForm input{\n   font-size:11px !important;\n    color:#ffce00;\n    height:28px;\n  padding:4px 8px 1px;\n  line-height:12px;\n font-size:12px;\n}\n#bookmarksBox #bkmrk_portals .addForm input{\n  width:65%;\n}\n#bookmarksBox #bkmrk_maps .addForm input{\n  width:42%;\n}\n#bookmarksBox #bkmrk_maps .addForm a{\n  width:29%;\n}\n#bookmarksBox .addForm input:hover,\n#bookmarksBox .addForm input:focus{\n   outline:0;\n    background:rgba(0,0,0,.6);\n}\n#bookmarksBox .bookmarkList >
 ul{\n  clear:both;\n   list-style-type:none;\n color:#fff;\n   overflow:hidden;\n  overflow-y:auto;\n  max-height:580px;\n}\n#bookmarksBox .sortable-placeholder{\n    background:rgba(8,48,78,.55);\n box-shadow:inset 1px 0 0 #20a8b1;\n}\n#bookmarksBox .ui-sortable-helper{\n  border-top-width:1px;\n}\n#bookmarksBox .bookmarkList{\n    display:none;\n}\n#bookmarksBox .bookmarkList.current{\n    display:block;\n}\n#bookmarksBox h5,\n#bookmarksBox .addForm *,\n#bookmarksBox ul li.bkmrk,\n#bookmarksBox ul li.bkmrk a{\n height:22px;\n}\n#bookmarksBox h5,\n#bookmarksBox ul li.bkmrk a{\n  overflow:hidden;\n  cursor:pointer;\n   float:left;\n}\n#bookmarksBox ul .bookmarksEmpty{\n text-indent:27px;\n color:#eee;\n}\n#bookmarksBox ul .bookmarksRemoveFrom{\n    width:10%;\n    text-align:center;\n    color:#fff;\n}\n#bookmarksBox ul .bookmarksLink{\n  width:90%;\n    padding:0 10px 0 8px;\n color:#ffce00;\n}\n#bookmarksBox ul .bookmarksLink.selected{\n  color:#03fe03;\n}\n#bookmarksBox ul .othersBookmarks .bookmarksLink{\n  width:90%;\n}\n#bookmarksBox ul .bookmarksLink:hover{\n color:#03fe03;\n}\n#bookmarksBox ul .bookmarksRemoveFrom:hover{\n   color:#fff;\n   background:#e22 !important;\n}\n\n/*---- UI border -----*/\n#bookmarksBox,\n#bookmarksBox *{\n  border-color:#20a8b1;\n border-style:solid;\n   border-width:0;\n}\n#bookmarksBox #topBar,\n#bookmarksBox ul .bookmarkFolder{\n border-top-width:1px;\n}\n\n#bookmarksBox #topBar,\n#bookmarksBox #bookmarksTypeBar,\n#bookmarksBox .addForm,\n#bookmarksBox ul .bookmarkFolder .folderLabel,\n#bookmarksBox ul li.bkmrk a {\n  border-bottom-width:1px;\n}\n#bookmarksBox ul .bookmarkFolder{\n    border-right-width:1px;\n   border-left-width:1px;\n}\n#bookmarksBox #topBar *,\n#bookmarksBox #bookmarksTypeBar *,\n#bookmarksBox .addForm *,\n#bookmarksBox ul li.bkmrk{\n    border-left-width:1px;\n}\n#bookmarksBox #topBar,\n#bookmarksBox #bookmarksTypeBar,\n#bookmarksBox .addForm,\n#bookmarksBox ul .bookmarksRemoveFrom{\n  border-right-width:1px;\n}\n#bookmarksBox ul .bookmarkFolder.othersBookmarks li.bkmrk,\n#bookmarksBox ul .bookmarkFolder .folderLabel .bookmarksRemoveFrom{\n   border-left-width:0;\n}\n#bkmrksTrigger{\n  display:block;\n    position:absolute;\n    overflow:hidden;\n  top:0;\n    left:277px;\n   width:47px;\n   margin-top:-36px;\n height:64px;\n  height:0;\n cursor:pointer;\n   z-index:2999;\n background-position:center bottom;\n    background-repeat:no-repeat;\n  transition:margin-top 100ms ease-in-out;\n  text-indent:-100%;\n    text-decoration:none;\n text-align:center;\n}\n#bkmrksTrigger:hover{\n  margin-top:0;\n}\n#sidebar #portaldetails h3.title{\n   width:auto;\n}\n.portal-list-bookmark span {\n  display:inline-block;\n margin: -3px;\n width:16px;\n   height:15px;\n  overflow:hidden;\n  background-repeat:no-repeat;\n  cursor:pointer;\n}\n#bkmrksTrigger, .bkmrksStar span, .portal-list-bookmark span {\n    background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC8AAABPCAMAAABMDWzEAAAANlBMVEX/////zgD/zgD///////8Aru7/zgAAru4TtPAAAADA7PtAwvLk9/6b3/n///8Aru510/b/zgDZKp6YAAAACnRSTlOAxo5FtDw9mPoA9GJiegAAAklJREFUeF6dle26ozAIhFO1NkK+vP+b3WbBJRwM7dn5lad9BweoaThI63Z42hfmLn4rLv84d8WvpWxe+fNcFL+VUtzy57kLv67lrbDOqu/nW8tfQ1i3MmjbfrKPc9BjCYfiy2qjjNoDZRfcaBnxnl8Mm8KN4bFzv6q6lVT/P369+DBZFmsZ+LAmWbHllz7XB/OBwDDhF1rVIvwFhHt+vw4dqbViKdC0wHySSsE3e/FxpHPpAo+vUehUSCk7PBuYTpCUw/JsAIoipzlfUTHimPGNMujQ7LA86sSqm2x4BFXbOjTPSWJFxtgpbRTFd+VITdPGQG3b8hArCbm7n9vVefqZxT8I0G2Y+Yi4XFNy+Jqpn695WlP6ksdWSJB9PmJrkMqolADyjIdyrzSrD1Pc8lND8vrNFvfnkw3u8NYAn+ev+M/7iorPH3n8Jd9+mT+b8fg8EBZb+o4n+n0gx4yPMp5MZ3LkW77XJAaZZkdmPtv7JGG9EfLLrnkS3DjiRWseej6OrnXd0ub/hQbftIPHCnfzjDz6sXjy3seKoBqXG97yqiCgmFv198uNYy7XptHlr8aHcbk8NW5veMtrg+A1Ojy3oCeLDs9zgfEHEi2vu03INu4Y/fk3OVOo6N2f8u5IqDs+NvMaYOJQaHj5rut1vGIda/zk5dmdfh7H8XypUJpP0luNne56xnEdildRRPyIfMMDSnGWhEJQvEQZittQwoONYkP946OOMnsERuZNFKMXOYiXkXsO4U0UL1QwffqPCH4Us4xgovih/gBs1LqNE0afwAAAAABJRU5ErkJggg==);\n}\n.bkmrksStar span{\n   display:inline-block;\n float:left;\n   margin:3px 1px 0 4px;\n width:16px;\n   height:15px;\n  overflow:hidden;\n  background-repeat:no-repeat;\n}\n.bkmrksStar span, .bkmrksStar.favorite:focus span{\n   background-position:left top;\n}\n.bkmrksStar:focus span, .bkmrksStar.favorite span, .portal-list-bookmark.favorite span{\n background-position:right top;\n}\n#bookmarksBox .bookmarkList .bookmarkFolder{\n   overflow:hidden;\n  margin-top:-1px;\n  height:auto;\n  background:rgba(8,58,78,.7);\n}\n#bookmarksBox .bookmarkList ul li.sortable-placeholder{\n  box-shadow:inset -1px 0 0 #20a8b1,inset 1px 0 0 #20a8b1,0 -1px 0 #20a8b1;\n background:rgba(8,58,78,.9);\n}\n#bookmarksBox .bookmarkList .bkmrk.ui-sortable-helper{\n   border-right-width:1px;\n   border-left-width:1px !important;\n}\n#bookmarksBox .bookmarkList ul li ul li.sortable-placeholder{\n   height:23px;\n  box-shadow:inset 0 -1px 0 #20a8b1,inset 1px 0 0 #20a8b1;\n}\n\n#bookmarksBox .bookmarkList ul li.bookmarkFolder.ui-sortable-helper,\n#bookmarksBox .bookmarkList ul li.othersBookmarks ul li.sortable-placeholder{\n    box-shadow:inset 0 -1px 0 #20a8b1;\n}\n\n#bookmarksBox #topBar #bookmarksDel,\n#bookmarksBox .bookmarkList .bookmarkFolder .folderLabel:hover .bookmarksRemoveFrom,\n#bookmarksBox .bookmarkList .bookmarkFolder .folderLabel:hover .bookmarksAnchor{\n border-bottom-width:1px;\n}\n\n/*---------*/\n#bookmarksBox .bookmarkList .bookmarkFolder .folderLabel .bookmarksAnchor span,\n#bookmarksBox .bookmarkList .bookmarkFolder .folderLabel >
 span,\n#bookmarksBox .bookmarkList .bookmarkFolder .folderLabel >
 span >
 span,\n#bookmarksBox .bookmarkList .triangle{\n  width:0;\n  height:0;\n}\n#bookmarksBox .bookmarkList .bookmarkFolder .folderLabel{\n   overflow:visible;\n height:25px;\n  cursor:pointer;\n   background:#069;\n  text-indent:0;\n}\n#bookmarksBox .bookmarkList .bookmarkFolder .folderLabel >
 *{\n  height:25px;\n  float:left;\n}\n#bookmarksBox .bookmarkList .bookmarkFolder .folderLabel .bookmarksAnchor{\n    line-height:25px;\n color:#fff;\n   width:90%;\n}\n#bookmarksBox .bookmarkList .bookmarkFolder .folderLabel .bookmarksAnchor span{\n    float:left;\n   border-width:5px 0 5px 7px;\n   border-color:transparent transparent transparent white;\n   margin:7px 7px 0 6px;\n}\n#bookmarksBox .bookmarkList .bookmarkFolder.open .folderLabel .bookmarksAnchor span{\n    margin:9px 5px 0 5px;\n border-width:7px 5px 0 5px;\n   border-color:white transparent transparent transparent;\n}\n#bookmarksBox .bookmarkList .bookmarkFolder .folderLabel >
 span,\n#bookmarksBox .bookmarkList .bookmarkFolder .folderLabel >
 span >
 span{\n display:none;\n border-width:0 12px 10px 0;\n   border-color:transparent #20a8b1 transparent transparent;\n margin:-20px 0 0;\n position:relative;\n    top:21px;\n left:219px;\n}\n#bookmarksBox .bookmarkList .bookmarkFolder .folderLabel >
 span >
 span{\n   top:18px;\n left:0;\n   border-width:0 10px 9px 0;\n    border-color:transparent #069 transparent transparent;\n}\n#bookmarksBox .bookmarkList .bookmarkFolder.open .folderLabel >
 span,\n#bookmarksBox .bookmarkList .bookmarkFolder.open .folderLabel >
 span >
 span{\n    display:block;\n    display:none;\n}\n#bookmarksBox .bookmarkList .bookmarkFolder.open .folderLabel:hover >
 span >
 span{\n  border-color:transparent #036 transparent transparent;\n}\n#bookmarksBox .bookmarkList .bookmarkFolder .folderLabel:hover .bookmarksAnchor{\n   background:#036;\n}\n#bookmarksBox .bookmarkList .bookmarkFolder ul{\n  display:none;\n margin-left:10%;\n}\n#bookmarksBox .bookmarkList .bookmarkFolder.open ul{\n display:block;\n    min-height:22px;\n}\n#bookmarksBox .bookmarkFolder.othersBookmarks ul{\n    margin-left:0;\n}\n\n/*---- Width for deleteMode -----*/\n#bookmarksBox .bookmarksRemoveFrom{\n display:none !important;\n}\n#bookmarksBox.deleteMode .bookmarksRemoveFrom{\n   display:block !important;\n}\n\n#bookmarksBox .bookmarkList .bookmarkFolder .folderLabel .bookmarksAnchor,\n#bookmarksBox ul .bookmarksLink,\n#bookmarksBox ul .othersBookmarks .bookmarksLink{\n   width:100% !important;\n}\n\n#bookmarksBox.deleteMode .bookmarkList .bookmarkFolder .folderLabel .bookmarksAnchor,\n#bookmarksBox.deleteMode ul .bookmarksLink,\n#bookmarksBox.deleteMode ul .othersBookmarks .bookmarksLink{\n width:90% !important;\n}\n\n/**********************************************\n   MOBILE\n**********************************************/\n#bookmarksBox.mobile{\n    position:absolute !important;\n width: 100% !important;\n   height: 100% !important;\n  top: 0 !important;\n    left: 0 !important;\n   margin: 0 !important;\n padding: 0 !important;\n    border: 0 !important;\n background: transparent !important;\n   overflow:auto !important;\n}\n#bookmarksBox.mobile .bookmarkList ul,\n#bookmarksBox.mobile .bookmarkList ul li,\n#bookmarksBox.mobile .bookmarkList.current,\n#bookmarksBox.mobile .bookmarkList li.bookmarkFolder.open ul{\n   width:100% !important;\n    display:block !important;\n}\n#bookmarksBox.mobile *{\n box-shadow:none !important;\n   border-width:0 !important;\n}\n#bookmarksBox.mobile #topBar #bookmarksMin,\n#bookmarksBox.mobile #topBar .handle{\n display:none !important;\n}\n\n#bookmarksBox.mobile #bookmarksTypeBar h5{\n cursor:pointer;\n   text-align:center;\n    float:left;\n   width:50%;\n    height:auto !important;\n   padding:7px 0;\n}\n#bookmarksBox.mobile #bookmarksTypeBar h5.current{\n cursor:default;\n   color:#fff;\n}\n#bookmarksBox.mobile #bookmarksTypeBar,\n#bookmarksBox.mobile .bookmarkList .addForm{\n border-bottom:1px solid #20a8b1 !important;\n}\n#bookmarksBox.mobile .bookmarkList ul li ul li.bkmrk,\n#bookmarksBox.mobile .bookmarkList li.bookmarkFolder .folderLabel{\n height:36px !important;\n   clear:both;\n}\n#bookmarksBox.mobile .bookmarkList li.bookmarkFolder .folderLabel a,\n#bookmarksBox.mobile .bookmarkList ul li ul li.bkmrk a{\n background:none;\n  padding:7px 0;\n    height:auto;\n  box-shadow:inset 0 1px 0 #20a8b1 !important;\n}\n#bookmarksBox.mobile .bookmarkList li.bookmarkFolder a.bookmarksRemoveFrom,\n#bookmarksBox.mobile .bookmarkList li.bkmrk a.bookmarksRemoveFrom{\n  box-shadow:inset 0 1px 0 #20a8b1,inset -1px 0 0 #20a8b1 !important;\n   width:10%;\n    background:none !important;\n}\n#bookmarksBox.mobile .bookmarkList li.bookmarkFolder a.bookmarksAnchor,\n#bookmarksBox.mobile .bookmarkList li.bkmrk a.bookmarksLink{\n text-indent:10px;\n height:36px;\n  line-height:24px;\n overflow:hidden;\n}\n#bookmarksBox.mobile .bookmarkList ul li.bookmarkFolder ul{\n  margin-left:0 !important;\n}\n#bookmarksBox.mobile .bookmarkList >
 ul{\n    border-bottom:1px solid #20a8b1 !important;\n}\n\n#bookmarksBox.mobile .bookmarkList .bookmarkFolder.othersBookmarks  ul{\n border-top:5px solid #20a8b1 !important;\n}\n#bookmarksBox.mobile .bookmarkList li.bookmarkFolder,\n#bookmarksBox.mobile .bookmarkList li.bkmrk{\n  box-shadow:inset 0 1px 0 #20a8b1, 1px 0 0 #20a8b1, -1px 1px 0 #20a8b1 !important;\n}\n#bookmarksBox.mobile .bookmarkList >
 ul{\n    max-height:none;\n/*    width:85% !important;*/\n}\n#bookmarksBox.mobile .bookmarkList li.bookmarkFolder .folderLabel{\n    box-shadow:0 1px 0 #20a8b1 !important;\n}\n#bookmarksBox.mobile .bookmarkList ul li.bookmarkFolder ul{\n    width:90% !important;\n margin-left:10% !important;\n}\n#bookmarksBox.mobile .bookmarkList ul li.bookmarkFolder.othersBookmarks ul{\n   width:100% !important;\n    margin-left:0% !important;\n}\n#bookmarksBox.mobile{\n  margin-bottom:5px !important;\n}\n#bookmarksBox.mobile #bookmarksTypeBar{\n height:auto;\n}\n#bookmarksBox.mobile .addForm,\n#bookmarksBox.mobile .addForm *{\n height:35px !important;\n   padding:0;\n}\n#bookmarksBox.mobile .addForm a{\n   line-height:37px;\n}\n\n#bookmarksBox.mobile .addForm a{\n/*    width:25% !important;*/\n}\n#bookmarksBox.mobile .addForm input{\n/*    width:50% !important;*/\n   text-indent:10px;\n}\n#bookmarksBox.mobile #bkmrk_portals .addForm input{\n/*   width:75% !important;*/\n}\n#bookmarksBox.mobile #bookmarksTypeBar h5,\n#bookmarksBox.mobile .bookmarkList .addForm a{\n    box-shadow:-1px 0 0 #20a8b1 !important;\n}\n#bookmarksBox.mobile .bookmarkList li.bookmarkFolder ul{\n  display:none !important;\n  min-height:37px !important;\n}\n#updatestatus .bkmrksStar{\n    float:left;\n   margin:-19px 0 0 -5px;\n    padding:0 3px 1px 4px;\n    background:#262c32;\n}\n#bookmarksBox.mobile .bookmarkList .bookmarkFolder .folderLabel .bookmarksAnchor span,\n#bookmarksBox.mobile .bookmarkList .bookmarkFolder .folderLabel >
 span,\n#bookmarksBox.mobile .bookmarkList .bookmarkFolder .folderLabel >
 span >
 span,\n#bookmarksBox.mobile .bookmarkList .triangle{\n    width:0 !important;\n   height:0 !important;\n}\n#bookmarksBox.mobile .bookmarkList .bookmarkFolder .folderLabel .bookmarksAnchor span{\n   float:left !important;\n    border-width:5px 0 5px 7px !important;\n    border-color:transparent transparent transparent white !important;\n    margin:7px 3px 0 13px !important;\n}\n#bookmarksBox.mobile .bookmarkList .bookmarkFolder.open .folderLabel .bookmarksAnchor span{\n margin:9px 1px 0 12px !important;\n border-width:7px 5px 0 5px !important;\n    border-color:white transparent transparent transparent !important;\n}\n#bookmarksBox.mobile .bookmarkList .bookmarkFolder .folderLabel >
 span,\n#bookmarksBox.mobile .bookmarkList .bookmarkFolder .folderLabel >
 span >
 span{\n    display:none !important;\n  border-width:0 12px 10px 0 !important;\n    border-color:transparent #20a8b1 transparent transparent !important;\n  margin:-20px 0 0 100% !important;\n position:relative !important;\n top:21px !important;\n  left:-10px !important;\n}\n#bookmarksBox.mobile .bookmarkList .bookmarkFolder .folderLabel >
 span >
 span{\n top:18px !important;\n  left:0 !important;\n    border-width:0 10px 9px 0 !important;\n border-color:transparent #069 transparent transparent !important;\n}\n#bookmarksBox.mobile .bookmarkList .bookmarkFolder.open .folderLabel >
 span,\n#bookmarksBox.mobile .bookmarkList .bookmarkFolder.open .folderLabel >
 span >
 span{\n   display:block !important;\n}\n\n/**********************************************\n   DIALOG BOX\n**********************************************/\n/*---- Auto Drawer -----*/\n#bkmrksAutoDrawer,\n#bkmrksAutoDrawer p,\n#bkmrksAutoDrawer a{\n   display:block;\n    padding:0;\n    margin:0;\n}\n#bkmrksAutoDrawer .bookmarkFolder{\n  margin-bottom:4px;\n    border:1px solid #20a8b1;\n}\n#bkmrksAutoDrawer .folderLabel{\n background:#069;\n  padding:4px 0;\n    color:#fff;\n}\n#bkmrksAutoDrawer .bookmarkFolder div{\n    border-top:1px solid #20a8b1;\n padding:6px 0;\n    background:rgba(0,0,0,0.3);\n}\n#bkmrksAutoDrawer .bookmarkFolder#idOthers .folderLabel{\n  display:none;\n}\n#bkmrksAutoDrawer .bookmarkFolder#idOthers div{\n display:block;\n    border-top:none;\n}\n#bkmrksAutoDrawer a{\n text-indent:10px;\n padding:2px 0;\n}\n#bkmrksAutoDrawer .longdistance {\n  color: #FFCC00;\n   font-weight: bold;\n    border-bottom: 1px dashed currentColor;\n}\n#bkmrksAutoDrawer .bookmarkFolder div {\n   display:none;\n}\n#bkmrksAutoDrawer a.bkmrk.selected{\n color:#03dc03;\n}\n\n/*---- Options panel -----*/\n#bkmrksSetbox a{\n   display:block;\n    color:#ffce00;\n    border:1px solid #ffce00;\n padding:3px 0;\n    margin:10px auto;\n width:80%;\n    text-align:center;\n    background:rgba(8,48,78,.9);\n}\n#bkmrksSetbox a.disabled,\n#bkmrksSetbox a.disabled:hover{\n   color:#666;\n   border-color:#666;\n    text-decoration:none;\n}\n/*---- Opt panel - copy -----*/\n.ui-dialog-bkmrksSet-copy textarea{\n    width:96%;\n    height:120px;\n resize:vertical;\n}\n\n\n/*--- Other Opt css ---*/\n#bookmarksBox.mobile a.bookmarksMoveIn{\n   display:none !important;\n}\n\n#bookmarksBox.mobile .bookmarkList ul li ul li.bkmrk a.bookmarksMoveIn{\n    background:none !important;\n   text-align:center;\n    color:#fff;\n   box-shadow: inset 0 1px 0 #20A8B1,inset -1px 0 0 #20A8B1 !important;\n  width:10%;\n}\n\n#bookmarksBox.mobile.moveMode a.bookmarksMoveIn{\n display:block !important;\n}\n\n#bookmarksBox.moveMode ul .bookmarksLink,\n#bookmarksBox.moveMode ul .othersBookmarks .bookmarksLink{\n width:90% !important;\n}\n.bookmarksDialog h3{\n    text-transform:capitalize;margin-top:10px;\n}\n.bookmarksDialog .bookmarkFolder{\n  margin-bottom:4px;\n    border:1px solid #20a8b1;\n background:#069;\n  padding:4px 10px;\n color:#fff;\n   cursor:pointer;\n}\n.bookmarksDialog .bookmarkFolder:hover{\n   text-decoration:underline;\n}\n\n#bookmarksBox.mobile #topBar .btn{\n   width:100%;height:45px !important;\n    font-size:13px;\n   color:#fff;\n   font-weight:normal;\n   padding-top:17px;\n text-indent:0 !important;\n}\n#bookmarksBox.mobile .btn{\n  width:50% !important;\n background:#222;\n}\n#bookmarksBox.mobile .btn.left{\n  border-right:1px solid #20a8b1 !important;\n}\n#bookmarksBox.mobile .btn#bookmarksMove{\n   background:#B42E2E;\n}\n#bkmrksSetbox{\n    text-align:center;\n}\n').appendTo('head');
  }
  window.plugin.bookmarks.setupPortalsList = function() {
    function onBookmarkChanged(data) {
      console.log(data, data.target, data.guid);
      if(data.target == "portal" && data.guid) {
        if(plugin.bookmarks.findByGuid(data.guid))
          $('[data-list-bookmark="'+data.guid+'"]').addClass("favorite");
        else
          $('[data-list-bookmark="'+data.guid+'"]').removeClass("favorite");
      } else {
        $('[data-list-bookmark]').each(function(i, element) {
          var guid = element.getAttribute("data-list-bookmark");
          if(plugin.bookmarks.findByGuid(guid))
            $(element).addClass("favorite");
          else
            $(element).removeClass("favorite");
        });
      }
    }
    window.addHook('pluginBkmrksEdit', onBookmarkChanged);
    window.addHook('pluginBkmrksSyncEnd', onBookmarkChanged);
    window.plugin.portalslist.fields.unshift({ // insert at first column
      title: "",
      value: function(portal) { return portal.options.guid; }, // we store the guid, but implement a custom comparator so the list does sort properly without closing and reopening the dialog
      sort: function(guidA, guidB) {
        var infoA = plugin.bookmarks.findByGuid(guidA);
        var infoB = plugin.bookmarks.findByGuid(guidB);
        if(infoA && !infoB) return 1;
        if(infoB && !infoA) return -1;
        return 0;
      },
      format: function(cell, portal, guid) {
        $(cell)
          .addClass("portal-list-bookmark")
          .attr("data-list-bookmark", guid);
        // for some reason, jQuery removes event listeners when the list is sorted. Therefore we use DOM's addEventListener
        $('
<span>
').appendTo(cell)[0].addEventListener("click", function() {
          if(window.plugin.bookmarks.findByGuid(guid)) {
            window.plugin.bookmarks.switchStarPortal(guid);
          } else {
            var ll = portal.getLatLng();
            plugin.bookmarks.addPortalBookmark(guid, ll.lat+','+ll.lng, portal.options.data.title);
          }
        }, false);
        if(plugin.bookmarks.findByGuid(guid))
          cell.className += " favorite";
      },
    });
  }
  window.plugin.bookmarks.setupContent = function() {
    plugin.bookmarks.htmlBoxTrigger = '
<a id="bkmrksTrigger" class="open" onclick="window.plugin.bookmarks.switchStatusBkmrksBox(\'switch\');return false;" accesskey="v" title="[v]">
[-] Bookmarks
</a>
';
    plugin.bookmarks.htmlBkmrksBox = '
<div id="bookmarksBox">
'
                          +'
<div id="topBar">
'
                            +'
<a id="bookmarksMin" class="btn" onclick="window.plugin.bookmarks.switchStatusBkmrksBox(0);return false;" title="Minimize">
-
</a>
'
                            +'
<div class="handle">
...
</div>
'
                            +'
<a id="bookmarksDel" class="btn" onclick="window.plugin.bookmarks.deleteMode();return false;" title="Show/Hide \'X\' button">
Show/Hide "X" button
</a>
'
                          +'
</div>
'
                          +'
<div id="bookmarksTypeBar">
'
                            +'
<h5 class="bkmrk_maps current" onclick="window.plugin.bookmarks.switchPageBkmrksBox(this, 0);return false">
Maps
</h5>
'
                            +'
<h5 class="bkmrk_portals" onclick="window.plugin.bookmarks.switchPageBkmrksBox(this, 1);return false">
Portals
</h5>
'
                            +'
<div style="clear:both !important;">
</div>
'
                          +'
</div>
'
                          +'
<div id="bkmrk_maps" class="bookmarkList current">
'
                            +'
<div class="addForm">
'
                              +'
<input placeholder="Insert label" />
'
                              +'
<a class="newMap" onclick="window.plugin.bookmarks.addElement(this, \'map\');return false;">
+ Map
</a>
'
                              +'
<a class="newFolder" onclick="window.plugin.bookmarks.addElement(this, \'folder\');return false;">
+ Folder
</a>
'
                            +'
</div>
'
                          +'
</div>
'
                          +'
<div id="bkmrk_portals" class="bookmarkList">
'
                            +'
<div class="addForm">
'
                              +'
<input placeholder="Insert label" />
'
                              +'
<a class="newFolder" onclick="window.plugin.bookmarks.addElement(this, \'folder\');return false;">
+ Folder
</a>
'
                            +'
</div>
'
                          +'
</div>
'
                          +'
<div style="border-bottom-width:1px;">
</div>
'
                        +'
</div>
';
    plugin.bookmarks.htmlDisabledMessage = '
<div title="Your browser do not support localStorage">
Plugin Bookmarks disabled*.
</div>
';
    plugin.bookmarks.htmlStar = '
<a class="bkmrksStar" accesskey="b" onclick="window.plugin.bookmarks.switchStarPortal();return false;" title="Save this portal in your bookmarks [b]">
<span>
</span>
</a>
';
    plugin.bookmarks.htmlCalldrawBox = '
<a onclick="window.plugin.bookmarks.dialogDrawer();return false;" accesskey="q" title="Draw lines/triangles between bookmarked portals [q]">
Auto draw
</a>
';
    plugin.bookmarks.htmlCallSetBox = '
<a onclick="window.plugin.bookmarks.manualOpt();return false;">
Bookmarks Opt
</a>
';
    plugin.bookmarks.htmlMoveBtn = '
<a id="bookmarksMove" class="btn" onclick="window.plugin.bookmarks.moveMode();return false;">
Show/Hide "Move" button
</a>
'
    var actions = '';
    actions += '
<a onclick="window.plugin.bookmarks.optReset();return false;">
Reset bookmarks
</a>
';
    actions += '
<a onclick="window.plugin.bookmarks.optCopy();return false;">
Copy bookmarks
</a>
';
    actions += '
<a onclick="window.plugin.bookmarks.optPaste();return false;">
Paste bookmarks
</a>
';
    if(plugin.bookmarks.isAndroid()) {
      actions += '
<a onclick="window.plugin.bookmarks.optImport();return false;">
Import bookmarks
</a>
';
      actions += '
<a onclick="window.plugin.bookmarks.optExport();return false;">
Export bookmarks
</a>
';
    }
    actions += '
<a onclick="window.plugin.bookmarks.optRenameF();return false;">
Rename Folder
</a>
'
    if(!plugin.bookmarks.isAndroid()) {
      actions += '
<a onclick="window.plugin.bookmarks.optBox(\'save\');return false;">
Save box position
</a>
';
      actions += '
<a onclick="window.plugin.bookmarks.optBox(\'reset\');return false;">
Reset box position
</a>
';
    }
    plugin.bookmarks.htmlSetbox = '
<div id="bkmrksSetbox">
' + actions + '
</div>
';
  }
/***************************************************************************************************************************************************************/
  var setup = function() {
    window.plugin.bookmarks.isSmart = window.isSmartphone();
    // Fired when a bookmarks/folder is removed, added or sorted, also when a folder is opened/closed.
    if($.inArray('pluginBkmrksEdit', window.VALID_HOOKS)
< 0) { window.VALID_HOOKS.push('pluginBkmrksEdit'); }
    // Fired when the "Bookmarks Options" panel is opened (you can add new options);
    if($.inArray('pluginBkmrksOpenOpt', window.VALID_HOOKS)
< 0) { window.VALID_HOOKS.push('pluginBkmrksOpenOpt'); }
    // Fired when the sync is finished;
    if($.inArray('pluginBkmrksSyncEnd', window.VALID_HOOKS)
< 0) { window.VALID_HOOKS.push('pluginBkmrksSyncEnd'); }
    // If the storage not exists or is a old version
    window.plugin.bookmarks.createStorage();
    window.plugin.bookmarks.upgradeToNewStorage();
    // Load data from localStorage
    window.plugin.bookmarks.loadStorage();
    window.plugin.bookmarks.loadStorageBox();
    window.plugin.bookmarks.setupContent();
    window.plugin.bookmarks.setupCSS();
    if(!window.plugin.bookmarks.isSmart) {
      $('body').append(window.plugin.bookmarks.htmlBoxTrigger + window.plugin.bookmarks.htmlBkmrksBox);
      $('#bookmarksBox').draggable({ handle:'.handle', containment:'window' });
      $("#bookmarksBox #bookmarksMin , #bookmarksBox ul li, #bookmarksBox ul li a, #bookmarksBox ul li a span, #bookmarksBox h5, #bookmarksBox .addForm a").disableSelection();
      $('#bookmarksBox').css({'top':window.plugin.bookmarks.statusBox.pos.x, 'left':window.plugin.bookmarks.statusBox.pos.y});
    }else{
      $('body').append(window.plugin.bookmarks.htmlBkmrksBox);
      $('#bookmarksBox').css("display", "none").addClass("mobile");
      if(window.useAndroidPanes())
        android.addPane("plugin-bookmarks", "Bookmarks", "ic_action_star");
      window.addHook('paneChanged', window.plugin.bookmarks.onPaneChanged);
    }
    $('#toolbox').append(window.plugin.bookmarks.htmlCallSetBox+window.plugin.bookmarks.htmlCalldrawBox);
    if(window.plugin.bookmarks.isSmart) {
//      $('#bookmarksBox.mobile #topBar').prepend(window.plugin.bookmarks.htmlCallSetBox+window.plugin.bookmarks.htmlCalldrawBox); // wonk in progress
      $('#bookmarksBox.mobile #topBar').append(plugin.bookmarks.htmlMoveBtn);
    }
    window.plugin.bookmarks.loadList('maps');
    window.plugin.bookmarks.loadList('portals');
    window.plugin.bookmarks.jquerySortableScript();
    if(window.plugin.bookmarks.statusBox['show'] === 0) { window.plugin.bookmarks.switchStatusBkmrksBox(0); }
    if(window.plugin.bookmarks.statusBox['page'] === 1) { $('#bookmarksBox h5.bkmrk_portals').trigger('click'); }
    window.addHook('portalSelected', window.plugin.bookmarks.onPortalSelected);
    window.addHook('search', window.plugin.bookmarks.onSearch);
    // Sync
    window.addHook('pluginBkmrksEdit', window.plugin.bookmarks.syncBkmrks);
    window.addHook('iitcLoaded', window.plugin.bookmarks.registerFieldForSyncing);
    // Highlighter - bookmarked portals
    window.addHook('pluginBkmrksEdit', window.plugin.bookmarks.highlightRefresh);
    window.addHook('pluginBkmrksSyncEnd', window.plugin.bookmarks.highlightRefresh);
    window.addPortalHighlighter('Bookmarked Portals', window.plugin.bookmarks.highlight);
    // Layer - Bookmarked portals
    window.plugin.bookmarks.starLayerGroup = new L.LayerGroup();
    window.addLayerGroup('Bookmarked Portals', window.plugin.bookmarks.starLayerGroup, false);
    window.plugin.bookmarks.addAllStars();
    window.addHook('pluginBkmrksEdit', window.plugin.bookmarks.editStar);
    window.addHook('pluginBkmrksSyncEnd', window.plugin.bookmarks.resetAllStars);
    if(window.plugin.portalslist) {
      window.plugin.bookmarks.setupPortalsList();
    } else {
      setTimeout(function() {
        if(window.plugin.portalslist)
          window.plugin.bookmarks.setupPortalsList();
      }, 500);
    }
  }
// PLUGIN END //////////////////////////////////////////////////////////
setup.info = plugin_info; //add the script info data to the function as a property
if(!window.bootPlugins) window.bootPlugins = [];
window.bootPlugins.push(setup);
// if IITC has already booted, immediately run the 'setup' function
if(window.iitcLoaded && typeof setup === 'function') setup();
})({"script":{"version":"0.2.12.20150917.154202","name":"IITC plugin: Bookmarks for maps and portals","description":"[jonatkins-2015-09-17-154202] Save your favorite Maps and Portals and move the intel map with a click. Works with sync."}});
</script>
<script>
(function wrapper(plugin_info) {
// ensure plugin framework is there, even if iitc is not yet loaded
if(typeof window.plugin !== 'function') window.plugin = function() {};
//PLUGIN AUTHORS: writing a plugin outside of the IITC build environment? if so, delete these lines!!
//(leaving them in place might break the 'About IITC' page or break update checks)
plugin_info.buildName = 'jonatkins';
plugin_info.dateTimeVersion = '20150917.154202';
plugin_info.pluginId = 'layer-farms-find';
//END PLUGIN AUTHORS NOTE
// PLUGIN START ////////////////////////////////////////////////////////
// use own namespace for plugin
window.plugin.farmFind = function() {};
window.plugin.farmFind.getNearbyPortalCount = function(portal){
    var circle = new google.maps.Circle();
    var center = new google.maps.LatLng(portal.getLatLng().lat, portal.getLatLng().lng);
    circle.setCenter(center);
    circle.setRadius(window.plugin.farmFind.Radius);
    var nearby8Portals = 0;
    $.each(window.portals, function(i, otherPortal) {
        var thisPortal = new google.maps.LatLng(otherPortal.getLatLng().lat, otherPortal.getLatLng().lng);
         if (circle.getBounds().contains(thisPortal))
             if (otherPortal.options.level >
= window.plugin.farmFind.minLevel) nearby8Portals++;
    });
    //console.log(nearby8Portals);
    return nearby8Portals;
};
window.plugin.farmFind.checkPortals = function(){
    possibleFarmPortals = [];
    window.plugin.farmFind.levelLayerGroup.clearLayers();
    //console.log(window.portals.length);
    $.each(window.portals, function(i, portal) {
        if (window.plugin.farmFind.getNearbyPortalCount(portal) >
 window.plugin.farmFind.minNearby)
        {
            //console.log("Farm identified");
            possibleFarmPortals.push(portal);
        }
    });
    console.log("Farm Portals: " + possibleFarmPortals.length);
    var farms = [];
    for (i = 0; i
< possibleFarmPortals.length;i++)
    {
        //console.log("Checking portal " + i);
        var thisPortal = possibleFarmPortals[i];
        var alreadyInFarm = false;
        for (x = 0; x
< farms.length;x++)
        {
            //console.log(alreadyInFarm);
            if (thisPortal in farms[x]) alreadyInFarm = true;
        }
        //console.log("Portal " + i + " already in farm: " + alreadyInFarm);
        if (!alreadyInFarm)
        {
            var portalsInFarm = [];
            var circle = new google.maps.Circle();
            var center = new google.maps.LatLng(thisPortal.getLatLng().lat, thisPortal.getLatLng().lng);
            circle.setCenter(center);
            circle.setRadius(window.plugin.farmFind.Radius);
            portalsInFarm.push(thisPortal);
            for (p = 0; p
< possibleFarmPortals.length;p++)
            {
                //console.log("Checking distance from portal " + p);
                var portalLoc = new google.maps.LatLng(possibleFarmPortals[p].getLatLng().lat, possibleFarmPortals[p].getLatLng().lng);
                var farmIndex = 0;
                if (circle.getBounds().contains(portalLoc) && possibleFarmPortals[p] != thisPortal)
                {
                    var alreadyInAnotherFarm = false;
                    for (x = 0; x
< farms.length;x++)
                    {
                        //console.log(alreadyInFarm);
                        for (o = 0; o
< farms[x].length; o++)
                        {
                            if (possibleFarmPortals[p] == farms[x][o])
                            {
                                //console.log("Portal " + p + " in farm " + (x+1) + " at index " + o);
                                alreadyInAnotherFarm = true;
                                farmIndex = x;
                            }
                        }
                    }
                    //console.log("Already in another farm: " + alreadyInAnotherFarm);
                    if (alreadyInAnotherFarm == false)
                    {
                        //console.log("Farm " + (farms.length + 1) + " adding portal " + p);
                        portalsInFarm.push(possibleFarmPortals[p]);
                    }
                    else
                    {
                        //hmmm... portal is in range, but portal is in another farm, so let's extend this farm
                        for(prt = 0; prt
< portalsInFarm.length; prt++)
                        {
                               farms[farmIndex].push(portalsInFarm[prt]);
                        }
                        //console.log("Farm " + (farmIndex + 1) + " now has " + farms[farmIndex].length + " portals");
                        p = 6000;
                    }
                }
            }
            if (!alreadyInAnotherFarm)
            {
                farms.push(portalsInFarm);
                //console.log("Farm " + (farms.length) + ": " + portalsInFarm.length + " portals");
            };
        }
    }
    //console.log(farms.length);
    for (i = 0; i
< farms.length; i++)
    {
        farms[i] = findUnique(farms[i]);
        console.log("Farm " + (i+1) + ": " + farms[i].length + " portals");
    }
    //console.log(farms);
    window.plugin.farmFind.drawnItems = new L.FeatureGroup();
    for (farm = 0; farm
< farms.length; farm++)
    {
        window.plugin.farmFind.drawCircle(farms[farm]);
    }
};
    findUnique = function(farm) {
        var unique = [];
        for(p = 0; p
< farm.length; p++)
        {
            //console.log(farm[p].options.guid);
            var found = false;
            for (u = 0; u
< unique.length; u++)
            {
                //console.log(unique[u].options.guid);
                if (farm[p].options.guid == unique[u].options.guid)
                    found = true;
            }
            if (!found)
                unique.push(farm[p]);
        }
        return unique;
}
window.plugin.farmFind.drawCircle = function(farm)
{
    var latArray = [];
    var lngArray = [];
    var countArray = [];
    //console.log("Find Center");
    for (p = 0; p
< farm.length; p++)
    {
        latArray.push(farm[p].getLatLng().lat);
        lngArray.push(farm[p].getLatLng().lng);
        var level = Math.floor(farm[p].options.level);
        if (countArray[level] == null)
            countArray[level] = 0;
        countArray[level]++;
    }
    console.log(countArray);
    var popupMsg = "Portal Count
<br>
";
    for (i = 1; i
< 9; i++)
    {
        if (countArray[i] != null)
            popupMsg += "Level " + i + ": " + countArray[i] + "
<br>
";
    }
    var north = Math.max.apply(null, lngArray);
    var south = Math.min.apply(null, lngArray);
    var east = Math.max.apply(null, latArray);
    var west = Math.min.apply(null, latArray);
    var center = new google.maps.LatLng(((east + west) / 2), ((north + south) / 2));
    //console.log(center);
    //console.log("Find Radius");
    var radius = 0;
    for (p = 0; p
< farm.length; p++)
    {
        var temp = center.distanceFrom(farm[p].getLatLng());
        if (temp >
 radius)
            radius = temp;
    }
    //console.log(radius);
    //((20 - map._zoom) * 1000) / map._zoom
    var latlng = new L.LatLng(center.lat(), center.lng());
    //console.log("latlng: " + latlng);
    var optCircle = {color:'red',opacity:0.7,fill:true,fillColor:'red',fillOpacity:0.7,weight:15,clickable:true};
    var circle = new L.Circle(latlng, radius, optCircle);
    circle.bindPopup(popupMsg);
    circle.on('mouseover', function(e) {
        circle.bringToBack();
    });
    circle.on('click', function(e) {
        circle.bringToBack();
    });
    //console.log("circle: " + circle);
    circle.addTo(window.plugin.farmFind.levelLayerGroup);
};
    google.maps.LatLng.prototype.distanceFrom = function(newLatLng) {
   // setup our variables
   var lat1 = this.lat();
   var radianLat1 = lat1 * ( Math.PI  / 180 );
   var lng1 = this.lng();
   var radianLng1 = lng1 * ( Math.PI  / 180 );
   var lat2 = newLatLng.lat;
   var radianLat2 = lat2 * ( Math.PI  / 180 );
   var lng2 = newLatLng.lng;
   var radianLng2 = lng2 * ( Math.PI  / 180 );
   // sort out the radius, MILES or KM?
   var earth_radius = 6378.1; // (km = 6378.1) OR (miles = 3959) - radius of the earth
   // sort our the differences
   var diffLat =  ( radianLat1 - radianLat2 );
   var diffLng =  ( radianLng1 - radianLng2 );
   // put on a wave (hey the earth is round after all)
   var sinLat = Math.sin( diffLat / 2  );
   var sinLng = Math.sin( diffLng / 2  );
   // maths - borrowed from http://www.opensourceconnections.com/wp-content/uploads/2009/02/clientsidehaversinecalculation.html
   var a = Math.pow(sinLat, 2.0) + Math.cos(radianLat1) * Math.cos(radianLat2) * Math.pow(sinLng, 2.0);
   // work out the distance
   var distance = earth_radius * 2 * Math.asin(Math.min(1, Math.sqrt(a)));
   // return the distance
   return distance * 1000;
};
    window.plugin.farmFind.setupCSS = function() {
        $('
<style>
').prop('type', 'text/css').html(''
            + '#farm_level_select {'
            + ' position: absolute;'
            + ' top: 5px;'
            + ' left:180px;'
            + ' z-index: 2500;'
            + ' font-size:11px;'
            + ' font-family: "coda",arial,helvetica,sans-serif;'
            + ' background-color:#0E3C46;'
            + ' color:#ffce00;'
            + '}\n').appendTo('head');
    };
    window.plugin.farmFind.setupSmartCSS = function() {
        $('
<style>
').prop('type', 'text/css').html(''
            + '#farm_level_select {'
            + ' top: 0px !important;'
            + ' right: 0px;'
            + ' left: auto !important;'
            + ' margin-right: 0;'
            + '}\n').appendTo('head');
    };
window.plugin.farmFind.changeLevel = function()
{
    var myselect = document.getElementById("farm_level_select");
    var level = myselect.options[myselect.selectedIndex].value;
    window.plugin.farmFind.minLevel = level;
    var button = document.getElementById("findFarmClick");
    button.title = 'Check portals in view for L' + window.plugin.farmFind.minLevel + ' farms';
    button.innerHTML = 'L' + window.plugin.farmFind.minLevel + ' Farms';
};
var setup =  function() {
    window.plugin.farmFind.minLevel = 7;
    window.plugin.farmFind.minNearby = 5;
    window.plugin.farmFind.setupCSS();
    if (window.isSmartphone()) {
        window.plugin.farmFind.setupSmartCSS();
    }
    window.plugin.farmFind.Radius = 500;
    $('#toolbox').append('
<a onclick="window.plugin.farmFind.checkPortals()" id="findFarmClick" title="Check portals in view for L' + window.plugin.farmFind.minLevel + ' farms">
L' + window.plugin.farmFind.minLevel + ' Farms
</a>
');
    possibleFarmPortals = [];
    window.plugin.farmFind.levelLayerGroup = new L.LayerGroup();
    $('body').append('
<select onchange="window.plugin.farmFind.changeLevel()" id="farm_level_select">
<option value=1>
Farm level 1
</option>
<option value=2>
Farm level 2
</option>
<option value=3>
Farm level 3
</option>
<option value=4>
Farm level 4
</option>
<option value=5>
Farm level 5
</option>
<option value=6>
Farm level 6
</option>
<option value=7>
Farm level 7
</option>
<option value=8>
Farm level 8
</option>
</select>
');
    var myselect = document.getElementById("farm_level_select");
    myselect.options.selectedIndex = 6;
    window.addLayerGroup('Farms', window.plugin.farmFind.levelLayerGroup, true);
};
// PLUGIN END //////////////////////////////////////////////////////////
setup.info = plugin_info; //add the script info data to the function as a property
if(!window.bootPlugins) window.bootPlugins = [];
window.bootPlugins.push(setup);
// if IITC has already booted, immediately run the 'setup' function
if(window.iitcLoaded && typeof setup === 'function') setup();
})({"script":{"version":"1.4.1.20150917.154202","name":"IITC plugin: Show farms by level","description":"[jonatkins-2015-09-17-154202] Find farms by minimum level."}});
</script>
<script>
(function wrapper(plugin_info) {
// ensure plugin framework is there, even if iitc is not yet loaded
if(typeof window.plugin !== 'function') window.plugin = function() {};
//PLUGIN AUTHORS: writing a plugin outside of the IITC build environment? if so, delete these lines!!
//(leaving them in place might break the 'About IITC' page or break update checks)
plugin_info.buildName = 'jonatkins';
plugin_info.dateTimeVersion = '20150917.154202';
plugin_info.pluginId = 'reso-energy-pct-in-portal-detail';
//END PLUGIN AUTHORS NOTE
// PLUGIN START ////////////////////////////////////////////////////////
// use own namespace for plugin
window.plugin.resoEnergyPctInPortalDetail = function() {};
window.plugin.resoEnergyPctInPortalDetail.updateMeter = function(data) {
  $("span.meter-level")
    .css({
      "word-spacing": "-1px",
      "text-align": "left",
      "font-size": "90%",
      "padding-left": "2px",
    })
    .each(function() {
      var matchResult = $(this).parent().attr('title').match(/\((\d*\%)\)/);
      if(matchResult) {
        var html = $(this).html() + '
<div style="position:absolute;right:0;top:0">
' + matchResult[1] + '
</div>
';
        $(this).html(html);
      }
    });
}
var setup =  function() {
  window.addHook('portalDetailsUpdated', window.plugin.resoEnergyPctInPortalDetail.updateMeter);
}
// PLUGIN END //////////////////////////////////////////////////////////
setup.info = plugin_info; //add the script info data to the function as a property
if(!window.bootPlugins) window.bootPlugins = [];
window.bootPlugins.push(setup);
// if IITC has already booted, immediately run the 'setup' function
if(window.iitcLoaded && typeof setup === 'function') setup();
})({"script":{"version":"0.1.2.20150917.154202","name":"IITC plugin: reso energy pct in portal detail","description":"[jonatkins-2015-09-17-154202] Show resonator energy percentage on resonator energy bar in portal detail panel."}});
</script>
<script>
(function wrapper(plugin_info) {
// ensure plugin framework is there, even if iitc is not yet loaded
if(typeof window.plugin !== 'function') window.plugin = function() {};
//PLUGIN AUTHORS: writing a plugin outside of the IITC build environment? if so, delete these lines!!
//(leaving them in place might break the 'About IITC' page or break update checks)
plugin_info.buildName = 'jonatkins';
plugin_info.dateTimeVersion = '20150917.154202';
plugin_info.pluginId = 'guess-player-levels';
//END PLUGIN AUTHORS NOTE
// PLUGIN START ////////////////////////////////////////////////////////
// use own namespace for plugin
window.plugin.guessPlayerLevels = function() {};
window.plugin.guessPlayerLevels.BURSTER_RANGES = [0, 42, 48, 58, 72, 90, 112, 138, 168];
// we prepend a hash sign (#) in front of the player name in storage in order to prevent accessing a pre-defined property
// (like constructor, __defineGetter__, etc.
window.plugin.guessPlayerLevels.setupCallback = function() {
  $('#toolbox').append('
<a onclick="window.plugin.guessPlayerLevels.guess()" title="Show player level guesses based on resonator placement in displayed portals">
Guess player levels
</a>
');
  addHook('portalDetailLoaded', window.plugin.guessPlayerLevels.extractPortalData);
  addHook('publicChatDataAvailable', window.plugin.guessPlayerLevels.extractChatData);
}
// This function is intended to be called by other plugins
window.plugin.guessPlayerLevels.fetchLevelByPlayer = function(nick) {
  var cache = window.plugin.guessPlayerLevels._nameToLevelCache;
  if(cache['#' + nick] === undefined)
    cache = window.plugin.guessPlayerLevels._loadLevels();
  var details = cache['#' + nick];
  if(details === undefined)
    return 1;
  if(typeof details === 'number')
    return details;
  return details.guessed;
}
// This function is intended to be called by other plugins
window.plugin.guessPlayerLevels.fetchLevelDetailsByPlayer = function(nick) {
  var cache = window.plugin.guessPlayerLevels._nameToLevelCache;
  if(cache['#' + nick] === undefined)
    cache = window.plugin.guessPlayerLevels._loadLevels();
  var details = cache['#' + nick];
  if(details === undefined)
    return {min: 1, guessed: 1};
  if(typeof details === 'number')
    return {min: 1, guessed: details};
  return details;
}
window.plugin.guessPlayerLevels._nameToLevelCache = {};
window.plugin.guessPlayerLevels._localStorageLastUpdate = 0;
window.plugin.guessPlayerLevels._loadLevels = function() {
  // no use in reading localStorage repeatedly
  if(window.plugin.guessPlayerLevels._localStorageLastUpdate
< Date.now() - 10*1000) {
    try {
      var cache = JSON.parse(localStorage['plugin-guess-player-levels'])
      window.plugin.guessPlayerLevels._nameToLevelCache = cache;
      window.plugin.guessPlayerLevels._localStorageLastUpdate = Date.now();
    } catch(e) {
    }
  }
  return window.plugin.guessPlayerLevels._nameToLevelCache;
}
window.plugin.guessPlayerLevels.setLevelTitle = function(dom) {
  // expects dom node with nick in its child text node
  var el = $(dom);
  var nick = el.text();
  if (nick[0] == '@') nick = nick.substring(1);
  var details = window.plugin.guessPlayerLevels.fetchLevelDetailsByPlayer(nick);
  function getLevel(lvl) {
    return '
<span style="display:inline-block;padding:4px;color:white;background-color:'+COLORS_LVL[lvl]+'">
'+lvl+'
</span>
';
  }
  var text = '
<span style="color: ' + el.css("color") + '">
' + nick + '
</span>
\n';
  text += 'Min player level: ' + getLevel(details.min);
  if(details.min != details.guessed)
    text += '\nGuessed player level: ' + getLevel(details.guessed);
  window.setupTooltips(el);
  /*
  This code looks hacky but since we are a little late within the mouseenter so
  we need to improvise a little. The open method doesn't open the tooltip directly.
  It starts the whole opening procedure (including the timeout etc) and is normally
  started by the mousemove event of the enhanced element.
  */
  el.addClass('help') // Add the "Help Mouse Cursor"
    .attr('title', text) // Set the title for the jquery tooltip
    .tooltip('open') // Start the "open" method
    .attr('title', null);  // And remove the title to prevent the browsers tooltip
}
window.plugin.guessPlayerLevels.setupChatNickHelper = function() {
  $(document).on('mouseenter', '.nickname, .pl_nudge_player', function() {
    window.plugin.guessPlayerLevels.setLevelTitle(this);
  });
}
window.plugin.guessPlayerLevels.extractPortalData = function(data) {
  if(!data.success) return;
  var r = data.details.resonators;
  /* Due to the Jarvis Virus/ADA Refactor it's possible for a player to own resonators on a portal at a higher level
     than the player themselves. It is not possible to detect for sure when this has happened, but in many cases it will
     result in an impossible deployment arrangement (more than 1 L8/7 res, more than 2 L6/5 res, etc). If we detect this
     case, we ignore all resonators owned by that player on the portal
     Hint: This can only happen to the owner of the portal, so resonators by other players can be used to determine
     their minimal level */
  var owner = data.details.owner && data.details.owner || "";
  var ownerModCount = 0;
  data.details.mods.forEach(function(mod) {
    if(mod && mod.owner == owner)
      ownerModCount++;
  });
  var players = {};
  $.each(r, function(ind, reso) {
    if(!reso) return true;
    if(!players[reso.owner]) players[reso.owner] = [];
    if(players[reso.owner][reso.level] === undefined)
      players[reso.owner][reso.level] = 1
    else
      players[reso.owner][reso.level]++;
  });
  for(nickname in players) {
    var ignore = false;
    var minLevel = 0;
    if(nickname == owner) {
      if(ownerModCount >
 2) // more than 2 mods by capturing player -->
 portal was flipped, ignore their resonators
        continue;
      var certain = false;
    } else { // not deployed by owner - player must be at least that level
      var certain = true;
    }
    players[nickname].forEach(function(count, level) {
      if(MAX_RESO_PER_PLAYER[level]
< count)
        ignore = true;
      if(count >
 0)
        minLevel = level;
    });
    if(ignore)
      continue;
    window.plugin.guessPlayerLevels.savePlayerLevel(nickname, minLevel, certain);
  }
}
window.plugin.guessPlayerLevels.extractChatData = function(data) {
  var attackData = {};
  function addAttackMessage(nick, timestamp, portal) {
    var details = window.plugin.guessPlayerLevels.fetchLevelDetailsByPlayer(nick);
    if(details.guessed == 8 || details.min == 8) return; // we wouldn't get better results, so skip the calcula
    if(!attackData[nick]) attackData[nick] = {};
    if(!attackData[nick][timestamp]) attackData[nick][timestamp] = [];
    attackData[nick][timestamp].push(portal);
  }
  data.result.forEach(function(msg) {
    var plext = msg[2].plext;
    // search for "x deployed an Ly Resonator on z"
    if(plext.plextType == 'SYSTEM_BROADCAST'
    && plext.markup.length==5
    && plext.markup[0][0] == 'PLAYER'
    && plext.markup[1][0] == 'TEXT'
    && plext.markup[1][1].plain == ' deployed an '
    && plext.markup[2][0] == 'TEXT'
    && plext.markup[3][0] == 'TEXT'
    && plext.markup[3][1].plain == ' Resonator on ') {
      var nick = plext.markup[0][1].plain;
      var lvl = parseInt(plext.markup[2][1].plain.substr(1));
      window.plugin.guessPlayerLevels.savePlayerLevel(nick, lvl, true);
    }
    // search for "x destroyed an Ly Resonator on z"
    if(plext.plextType == 'SYSTEM_BROADCAST'
    && plext.markup.length==5
    && plext.markup[0][0] == 'PLAYER'
    && plext.markup[1][0] == 'TEXT'
    && plext.markup[1][1].plain == ' destroyed an '
    && plext.markup[2][0] == 'TEXT'
    && plext.markup[3][0] == 'TEXT'
    && plext.markup[3][1].plain == ' Resonator on ') {
      var nick = plext.markup[0][1].plain;
      var portal = plext.markup[4][1];
      addAttackMessage(nick, msg[1], portal)
    }
    // search for "Your Lx Resonator on y was destroyed by z"
    if(plext.plextType == 'SYSTEM_NARROWCAST'
    && plext.markup.length==6
    && plext.markup[0][0] == 'TEXT'
    && plext.markup[0][1].plain == 'Your '
    && plext.markup[1][0] == 'TEXT'
    && plext.markup[2][0] == 'TEXT'
    && plext.markup[2][1].plain == ' Resonator on '
    && plext.markup[3][0] == 'PORTAL'
    && plext.markup[4][0] == 'TEXT'
    && plext.markup[4][1].plain == ' was destroyed by '
    && plext.markup[5][0] == 'PLAYER') {
      var nick = plext.markup[5][1].plain;
      var portal = plext.markup[3][1];
      addAttackMessage(nick, msg[1], portal)
    }
    // search for "Your Portal x neutralized by y"
    // search for "Your Portal x is under attack by y"
    if(plext.plextType == 'SYSTEM_NARROWCAST'
    && plext.markup.length==4
    && plext.markup[0][0] == 'TEXT'
    && plext.markup[0][1].plain == 'Your Portal '
    && plext.markup[1][0] == 'PORTAL'
    && plext.markup[2][0] == 'TEXT'
    && (plext.markup[2][1].plain == ' neutralized by ' || plext.markup[2][1].plain == ' is under attack by ')
    && plext.markup[3][0] == 'PLAYER') {
      var nick = plext.markup[3][1].plain;
      var portal = plext.markup[1][1];
      addAttackMessage(nick, msg[1], portal)
    }
  });
  for(nick in attackData) {
    for(timestamp in attackData[nick]) {
      // remove duplicates
      var latlngs = [];
      var portals = {};
      attackData[nick][timestamp].forEach(function(portal) {
        // no GUID in the data any more - but we need some unique string. use the latE6,lngE6
        var id = portal.latE6+","+portal.lngE6;
        if(portals.hasOwnProperty(id))
          return;
        portals[id] = 1;
        latlngs.push({x: portal.lngE6/1E6, y:portal.latE6/1E6});
      });
      if(latlngs.length
< 2) // we need at least 2 portals to calculate burster range
        continue;
      window.plugin.guessPlayerLevels.handleAttackData(nick, latlngs);
    }
  }
};
window.plugin.guessPlayerLevels.handleAttackData = function(nick, latlngs) {
  /*
    This is basically the smallest enclosing circle problem. The algorithm is for points on a plane, but for our ranges
    (X8 has 168m) this should work.
    http://www.cs.uu.nl/docs/vakken/ga/slides4b.pdf
    http://nayuki.eigenstate.org/page/smallest-enclosing-circle
    http://everything2.com/title/Circumcenter
  */
  var circle = {
    x: latlngs[0].x,
    y: latlngs[0].y,
    radius: 0
  };
  for(var i=1; i
<latlngs.length; i++) {
    var latlng = latlngs[i];
    if(!window.plugin.guessPlayerLevels.isPointInCircle(latlng, circle))
      circle = window.plugin.guessPlayerLevels.calculateCircleWithAnchor(latlngs.slice(0, i + 1), latlng);
  }
  // circle.range is useless, because it is calculated in degrees (simplified algorithm!)
  var latlng = L.latLng(circle.y, circle.x);
  var range = 0;
  for(var i=0; i
<latlngs.length; i++) {
    var d = latlng.distanceTo([latlngs[i].y, latlngs[i].x]);
    if(d >
 range)
      range = d;
  }
  // In earlier versions, the algorithm failed. Should be fixed now, but just to be sure, we ignore escalating values...
  if(circle.x == 0 || circle.y == 0 || range >
 1000) {
    console.warn("ignoring attack data: ", nick, latlngs, circle, range);
    return;
  }
  var burster = window.plugin.guessPlayerLevels.BURSTER_RANGES;
  // res can be up to 40m from a portal, so attack notifications for portals, say, 100m apart could
  // actually be a weapon range as low as 20m. however, typical deployments are a bit less than 40m, and resonators
  // can only be deployed on the 8 compass points. a value of 40m x 2 would never be wrong
  var reso_range_correction = 40*2;
  // however, the full correction often under-estimates.
  for(var i=burster.length-1; i>
=1; i--) {
    if(range >
= (burster[i]+reso_range_correction)) {
      window.plugin.guessPlayerLevels.savePlayerLevel(nick, Math.min(i+1, MAX_PORTAL_LEVEL), true);
      break;
    }
  }
  //L.circle(latlng, range, {
  //  weight:1,
  //  title: nick + ", " + range + "m"
  //}).addTo(map);
}
window.plugin.guessPlayerLevels.calculateCircleWithAnchor = function(latlngs, anchor) {
  var circle = {
    x: anchor.x,
    y: anchor.y,
    radius: 0
  };
  for(var i=0; i
<latlngs.length; i++) {
    var p = latlngs[i];
    if(!window.plugin.guessPlayerLevels.isPointInCircle(p, circle)) {
      if(circle.radius == 0) // for the first two points
        circle = window.plugin.guessPlayerLevels.calculateCircleFromBisector(p, anchor);
      else
        circle = window.plugin.guessPlayerLevels.calculateCircleWithAnchors(latlngs.slice(0, i + 1), anchor, p);
    }
  }
  return circle;
}
window.plugin.guessPlayerLevels.calculateCircleWithAnchors = function(latlngs, a, b) {
  var circle = window.plugin.guessPlayerLevels.calculateCircleFromBisector(a, b);
  for(var i=0; i
<latlngs.length; i++) {
    var c = latlngs[i];
    if(!window.plugin.guessPlayerLevels.isPointInCircle(c, circle)) {
      var dA = a.x*a.x + a.y*a.y;
      var dB = b.x*b.x + b.y*b.y;
      var dC = c.x*c.x + c.y*c.y;
      circle.x =  (dA*(c.y-b.y) + dB*(a.y-c.y) + dC*(b.y-a.y)) / (2*(a.x*(c.y-b.y) + b.x*(a.y-c.y) + c.x*(b.y-a.y)));
      circle.y = -(dA*(c.x-b.x) + dB*(a.x-c.x) + dC*(b.x-a.x)) / (2*(a.x*(c.y-b.y) + b.x*(a.y-c.y) + c.x*(b.y-a.y)));
      circle.radius = Math.max(
        window.plugin.guessPlayerLevels.getDistance(a, circle),
        window.plugin.guessPlayerLevels.getDistance(b, circle),
        window.plugin.guessPlayerLevels.getDistance(c, circle)
      );
    }
  }
  return circle;
}
window.plugin.guessPlayerLevels.calculateCircleFromBisector = function(p, q) {
  return {
    x: (p.x + q.x) / 2,
    y: (p.y + q.y) / 2,
    radius: window.plugin.guessPlayerLevels.getDistance(p, q) / 2
  };
}
window.plugin.guessPlayerLevels.isPointInCircle = function(point, circle) {
  var d = window.plugin.guessPlayerLevels.getDistance(point, circle);
  return (d - 1E-10)
<= circle.radius; // subtract a small epsilon to return true even if point is on the edge
}
window.plugin.guessPlayerLevels.getDistance = function(a, b) {
  var dx = a.x - b.x;
  var dy = a.y - b.y;
  return Math.sqrt(dx*dx + dy*dy);
}
window.plugin.guessPlayerLevels.savePlayerLevel = function(nick, level, certain) {
  var cache = window.plugin.guessPlayerLevels._loadLevels();
  var details = cache['#' + nick];
  if(details === undefined)
    details = {min: 1, guessed: 1};
  if(typeof details === 'number')
    details = {min: 1, guessed: details};
  if(certain) {
    if(details.min >
= level)
      return;
    details.min = level;
    if(details.guessed
< details.min)
      details.guessed = details.min;
  } else {
    if(details.guessed >
= level)
      return;
    details.guessed = level;
  }
  window.plugin.guessPlayerLevels._nameToLevelCache['#' + nick] = details;
  // to minimize accesses to localStorage, writing is delayed a bit
  if(window.plugin.guessPlayerLevels._writeTimeout)
    clearTimeout(window.plugin.guessPlayerLevels._writeTimeout);
  window.plugin.guessPlayerLevels._writeTimeout = setTimeout(function() {
    localStorage['plugin-guess-player-levels'] = JSON.stringify(window.plugin.guessPlayerLevels._nameToLevelCache);
  }, 500);
}
window.plugin.guessPlayerLevels.guess = function() {
  var playersRes = {};
  var playersEnl = {};
  $.each(window.portals, function(guid,p) {
    var details = portalDetail.get(guid);
    if(details) {
      var r = details.resonators;
      $.each(r, function(ind, reso) {
        if(!reso) return true;
        var nick = reso.owner;
        if(isSystemPlayer(nick)) return true;
        var lvl = window.plugin.guessPlayerLevels.fetchLevelDetailsByPlayer(nick).min;
        if(!lvl) return true;
        if(getTeam(details) === TEAM_ENL)
          playersEnl[nick] = lvl;
        else
          playersRes[nick] = lvl;
      });
      if(details.captured) {
        var nick = details.owner;
        if(isSystemPlayer(nick)) return true;
        var lvl = window.plugin.guessPlayerLevels.fetchLevelDetailsByPlayer(nick).min;
        if(!lvl) return true;
        if(getTeam(details) === TEAM_ENL)
          playersEnl[nick] = lvl;
        else
          playersRes[nick] = lvl;
      }
    }
  });
  var s = 'Players have at least the following level:\n\n';
  s += 'Resistance:\t&nbsp;&nbsp;&nbsp;\tEnlightened:\t\n';
  var namesR = plugin.guessPlayerLevels.sort(playersRes);
  var namesE = plugin.guessPlayerLevels.sort(playersEnl);
  var totallvlR = 0;
  var totallvlE = 0;
  var max = Math.max(namesR.length, namesE.length);
  function makeRow(nick, lvl, team) {
    if(!nick)
      return '\t';
    var color = COLORS[team];
    if (nick === window.PLAYER.nickname) color = '#fd6'; //highlight the player's name in a unique colour (similar to @player mentions from others in the chat text itself)
    return '
<mark class="nickname" style="color:'+color+'">
'+nick+'
</mark>
\t' + lvl;
  }
  var nick, lvl, lineE, lineR;
  for(var i = 0; i
< max; i++) {
    nick = namesR[i];
    lvl = playersRes[nick];
    lineR = makeRow(nick, lvl, TEAM_RES);
    if(!isNaN(parseInt(lvl)))
      totallvlR += parseInt(lvl);
    nick = namesE[i];
    lvl = playersEnl[nick];
    lineE = makeRow(nick, lvl, TEAM_ENL);
    if(!isNaN(parseInt(lvl)))
      totallvlE += parseInt(lvl);
    s += '\n'+lineR + '\t' + lineE + '\n';
  }
  s += '\nTotal level :\t'+totallvlR+'\tTotal level :\t'+totallvlE;
  s += '\nTotal player:\t'+namesR.length+'\tTotal player:\t'+namesE.length;
  var averageR = 0, averageE = 0;
  if (namesR.length >
 0)  averageR = (totallvlR/namesR.length);
  if (namesE.length >
 0)  averageE = (totallvlE/namesE.length);
  s += '\nAverage level:\t'+averageR.toFixed(2)+'\tAverage level:\t'+averageE.toFixed(2);
  s += '\n\nOnly players from recently viewed portal details are listed.'
  dialog({
    text: s,
    title: 'Player levels: R' + averageR.toFixed(2) + ', E' + averageE.toFixed(2),
    id: 'guess-player-levels',
    width: 350,
    buttons: {
      'RESET GUESSES': function() {
        // clear all guessed levels from local storage
        localStorage.removeItem('plugin-guess-player-levels')
        window.plugin.guessPlayerLevels._nameToLevelCache = {}
        // now force all portals through the callback manually
        $.each(window.portals, function(guid,p) {
          var details = portalDetail.get(guid);
          if(details)
            window.plugin.guessPlayerLevels.extractPortalData({details:details, success:true});
        });
        // and re-open the dialog (on a minimal timeout - so it's not closed while processing this callback)
        setTimeout(window.plugin.guessPlayerLevels.guess,1);
      },
    }
  });
}
window.plugin.guessPlayerLevels.sort = function(playerHash) {
  return Object.keys(playerHash).sort(function(a, b) {
    if(playerHash[a]
< playerHash[b]) return 1;
    if(playerHash[a] >
 playerHash[b]) return -1;
    if (a.toLowerCase()
< b.toLowerCase()) return -1;
    if (a.toLowerCase() >
 b.toLowerCase()) return 1;
    return 0;
  });
}
var setup =  function() {
  // we used to store level guesses as one localStorage key per player, named 'level-PLAYER_GUID'
  // they're now stored in a single storage key - 'plugin-guess-player-levels' - so clear these old entries
  $.each(Object.keys(localStorage), function(ind,key) {// legacy code - should be removed in the future
    if(key.lastIndexOf('level-',0)===0) {
      localStorage.removeItem(key);
    }
  });
  window.plugin.guessPlayerLevels.setupCallback();
  window.plugin.guessPlayerLevels.setupChatNickHelper();
}
// PLUGIN END //////////////////////////////////////////////////////////
setup.info = plugin_info; //add the script info data to the function as a property
if(!window.bootPlugins) window.bootPlugins = [];
window.bootPlugins.push(setup);
// if IITC has already booted, immediately run the 'setup' function
if(window.iitcLoaded && typeof setup === 'function') setup();
})({"script":{"version":"0.5.7.20150917.154202","name":"IITC plugin: guess player level","description":"[jonatkins-2015-09-17-154202] Try to determine player levels from the data available in the current view."}});
</script>
<script>
(function wrapper(plugin_info) {
// ensure plugin framework is there, even if iitc is not yet loaded
if(typeof window.plugin !== 'function') window.plugin = function() {};
//PLUGIN AUTHORS: writing a plugin outside of the IITC build environment? if so, delete these lines!!
//(leaving them in place might break the 'About IITC' page or break update checks)
plugin_info.buildName = 'jonatkins';
plugin_info.dateTimeVersion = '20150917.154202';
plugin_info.pluginId = 'keys-on-map';
//END PLUGIN AUTHORS NOTE
// PLUGIN START ////////////////////////////////////////////////////////
// use own namespace for plugin
window.plugin.keysOnMap = function() {};
window.plugin.keysOnMap.keyLayers = {};
// Use portal add and remove event to control render of keys
window.plugin.keysOnMap.portalAdded = function(data) {
  // Disable if Plugin Keys is not there
  if(!plugin.keys) {
    plugin.keysOnMap.disableMessage();
    return;
  }
  data.portal.on('add', function() {
    plugin.keysOnMap.renderKey(this.options.guid, this.getLatLng());
  });
  data.portal.on('remove', function() {
    plugin.keysOnMap.removeKey(this.options.guid);
  });
}
window.plugin.keysOnMap.keyUpdate = function(data) {
  // Disable if Plugin Keys is not there
  if(!plugin.keys) {
    plugin.keysOnMap.disableMessage();
    return;
  }
  var portal = window.portals[data.guid];
  if(!portal) return;
  var latLng = portal.getLatLng();
  plugin.keysOnMap.renderKey(data.guid, latLng)
}
window.plugin.keysOnMap.refreshAllKeys = function() {
  plugin.keysOnMap.keyLayerGroup.clearLayers();
  $.each(plugin.keys.keys, function(key, count) {
    plugin.keysOnMap.keyUpdate({guid: key});
  });
}
window.plugin.keysOnMap.renderKey = function(guid,latLng) {
    plugin.keysOnMap.removeKey(guid);
    var keyCount = plugin.keys.keys[guid];
    if (keyCount >
 0) {
      var key = L.marker(latLng, {
        icon: L.divIcon({
          className: 'plugin-keys-on-map-key',
          iconAnchor: [6,7],
          iconSize: [12,10],
          html: keyCount
          }),
        guid: guid
        });
      plugin.keysOnMap.keyLayers[guid] = key;
      key.addTo(plugin.keysOnMap.keyLayerGroup);
    }
}
window.plugin.keysOnMap.removeKey = function(guid) {
    var previousLayer = plugin.keysOnMap.keyLayers[guid];
    if(previousLayer) {
      plugin.keysOnMap.keyLayerGroup.removeLayer(previousLayer);
      delete plugin.keysOnMap.keyLayers[guid];
    }
}
window.plugin.keysOnMap.disableMessage = function() {
  if(!plugin.keysOnMap.messageShown) {
    alert('Plugin "Keys On Map" need plugin "Keys" to run!');
    plugin.keysOnMap.messageShown = true;
  }
}
window.plugin.keysOnMap.setupCSS = function() {
  $("
<style>
")
    .prop("type", "text/css")
    .html(".plugin-keys-on-map-key {\
            font-size: 10px;\
            color: #FFFFBB;\
            font-family: monospace;\
            text-align: center;\
            text-shadow: 0 0 0.5em black, 0 0 0.5em black, 0 0 0.5em black;\
            pointer-events: none;\
            -webkit-text-size-adjust:none;\
          }")
  .appendTo("head");
}
window.plugin.keysOnMap.setupLayer = function() {
  window.plugin.keysOnMap.keyLayerGroup = new L.LayerGroup();
  window.addLayerGroup('Keys', window.plugin.keysOnMap.keyLayerGroup, false);
}
var setup =  function() {
  window.plugin.keysOnMap.setupCSS();
  window.plugin.keysOnMap.setupLayer();
  // Avoid error if this plugin load first
  if($.inArray('pluginKeysUpdateKey', window.VALID_HOOKS)
< 0)
    window.VALID_HOOKS.push('pluginKeysUpdateKey');
  if($.inArray('pluginKeysRefreshAll', window.VALID_HOOKS)
< 0)
    window.VALID_HOOKS.push('pluginKeysRefreshAll');
  window.addHook('portalAdded', window.plugin.keysOnMap.portalAdded);
  window.addHook('pluginKeysUpdateKey', window.plugin.keysOnMap.keyUpdate);
  window.addHook('pluginKeysRefreshAll', window.plugin.keysOnMap.refreshAllKeys);
}
// PLUGIN END //////////////////////////////////////////////////////////
setup.info = plugin_info; //add the script info data to the function as a property
if(!window.bootPlugins) window.bootPlugins = [];
window.bootPlugins.push(setup);
// if IITC has already booted, immediately run the 'setup' function
if(window.iitcLoaded && typeof setup === 'function') setup();
})({"script":{"version":"0.2.1.20150917.154202","name":"IITC plugin: Keys on map","description":"[jonatkins-2015-09-17-154202] Show the manually entered key counts from the 'keys' plugin on the map."}});
</script>
<div role="log" aria-live="assertive" aria-relevant="additions" class="ui-helper-hidden-accessible">
<div style="display: none;">
[2]
</div>
<div style="display: none;">
Fountain
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
<strong>
Go to portal
</strong>
<br>
<span>
↴ outgoing link
</span>
<br>
<span>
3 084m
</span>
</div>
<div style="display: none;">
Fountain
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
<strong>
Go to portal
</strong>
<br>
<span>
↴ outgoing link
</span>
<br>
<span>
6 482m
</span>
</div>
<div style="display: none;">
Fountain
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
Layers
</div>
<div style="display: none;">
Layers
</div>
<div style="display: none;">
Zoom in to show those.
</div>
<div style="display: none;">
Zoom in to show those.
</div>
<div style="display: none;">
Zoom out
</div>
<div style="display: none;">
Layers
</div>
<div style="display: none;">
Layers
</div>
<div style="display: none;">
Zoom in to show those.
</div>
<div style="display: none;">
Zoom in to show those.
</div>
<div style="display: none;">
Layers
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
Balloon Dog
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
<table>
<tbody>
<tr>
<td>
Base range:
</td>
<td>
0m
</td>
</tr>
<tr>
<td>
Link amp boost:
</td>
<td>
×1
</td>
</tr>
<tr>
<td>
Range:
</td>
<td>
0m
</td>
</tr>
<tr>
<td colspan="2">
Portal is missing resonators,
</td>
</tr>
<tr>
<td colspan="2">
no new links can be made
</td>
</tr>
</tbody>
</table>
</div>
<div style="display: none;">
Double-click to set/change current location
</div>
<div style="display: none;">
Display raw data of the portal
</div>
<div style="display: none;">
View regional scoreboard
</div>
<div style="display: none;">
Display a summary of portals in the current view
</div>
<div style="display: none;">
Create a URL link to this portal
</div>
<div style="display: none;">
Double-click to set/change current location
</div>
<div style="display: none;">
<table>
<tbody>
<tr>
<td>
Enemy AP:
</td>
<td>
1750
</td>
</tr>
<tr>
<td>
  Destroy AP:
</td>
<td>
0
</td>
</tr>
<tr>
<td>
  Capture AP:
</td>
<td>
1750
</td>
</tr>
<tr>
<td colspan="2">
</td>
</tr>
</tbody>
</table>
</div>
<div style="display: none;">
<table>
<tbody>
<tr>
<td>
Total shielding:
</td>
<td>
0
</td>
</tr>
<tr>
<td>
- active:
</td>
<td>
0
</td>
</tr>
<tr>
<td>
- excess:
</td>
<td>
0
</td>
</tr>
<tr>
<td colspan="2">
From
</td>
</tr>
<tr>
<td>
- shields:
</td>
<td>
0
</td>
</tr>
<tr>
<td>
- links:
</td>
<td>
0
</td>
</tr>
</tbody>
</table>
</div>
<div style="display: none;">
at most 8 outgoing links
<br>
0 links out
<br>
0 links in
<br>
(0 total)
</div>
<div style="display: none;">
at most 8 outgoing links
<br>
0 links out
<br>
0 links in
<br>
(0 total)
</div>
<div style="display: none;">
<table>
<tbody>
<tr>
<td>
Total shielding:
</td>
<td>
0
</td>
</tr>
<tr>
<td>
- active:
</td>
<td>
0
</td>
</tr>
<tr>
<td>
- excess:
</td>
<td>
0
</td>
</tr>
<tr>
<td colspan="2">
From
</td>
</tr>
<tr>
<td>
- shields:
</td>
<td>
0
</td>
</tr>
<tr>
<td>
- links:
</td>
<td>
0
</td>
</tr>
</tbody>
</table>
</div>
<div style="display: none;">
<table>
<tbody>
<tr>
<td>
Enemy AP:
</td>
<td>
1750
</td>
</tr>
<tr>
<td>
  Destroy AP:
</td>
<td>
0
</td>
</tr>
<tr>
<td>
  Capture AP:
</td>
<td>
1750
</td>
</tr>
<tr>
<td colspan="2">
</td>
</tr>
</tbody>
</table>
</div>
<div style="display: none;">
URL link to this map view
</div>
<div style="display: none;">
Show artifact portal list
</div>
<div style="display: none;">
[x]
</div>
<div style="display: none;">
Show player level guesses based on resonator placement in displayed portals
</div>
<div style="display: none;">
Draw lines/triangles between bookmarked portals [q]
</div>
<div style="display: none;">
Show player level guesses based on resonator placement in displayed portals
</div>
<div style="display: none;">
[x]
</div>
<div style="display: none;">
Show artifact portal list
</div>
<div style="display: none;">
Display a list of portals in the current view [t]
</div>
<div style="display: none;">
Display a summary of portals in the current view
</div>
<div style="display: none;">
Display a summary of portals in the current view
</div>
<div style="display: none;">
[x]
</div>
<div style="display: none;">
Display a list of portals in the current view [t]
</div>
<div style="display: none;">
View regional scoreboard
</div>
<div style="display: none;">
View regional scoreboard
</div>
<div style="display: none;">
Display a list of portals in the current view [t]
</div>
<div style="display: none;">
Show artifact portal list
</div>
<div style="display: none;">
Display a list of portals in the current view [t]
</div>
<div style="display: none;">
[x]
</div>
<div style="display: none;">
Display a list of portals in the current view [t]
</div>
<div style="display: none;">
Show artifact portal list
</div>
<div style="display: none;">
Double-click to set/change current location
</div>
<div style="display: none;">
Link to alternative maps (Google, etc)
</div>
<div style="display: none;">
Link to alternative maps (Google, etc)
</div>
<div style="display: none;">
Create a URL link to this portal
</div>
<div style="display: none;">
[v]
</div>
<div style="display: none;">
<table>
<tbody>
<tr>
<td>
Level:
</td>
<td>
8
</td>
</tr>
<tr>
<td>
XM:
</td>
<td>
10000 / 10000
</td>
</tr>
<tr>
<td>
AP:
</td>
<td>
2 167 791
</td>
</tr>
<tr>
<td>
level up in:
</td>
<td>
232 209 AP
</td>
</tr>
<tr>
<td>
Invites:
</td>
<td>
193
</td>
</tr>
<tr>
<td colspan="2">
</td>
</tr>
<tr>
<td colspan="2">
Note: your player stats can only be updated by a full reload (F5)
</td>
</tr>
</tbody>
</table>
</div>
<div style="display: none;">
Search for a place [f]
</div>
<div style="display: none;">
Balloon Dog
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
Problem? Point to the question mark!
</div>
<div style="display: none;">
<table>
<tbody>
<tr>
<td>
Base range:
</td>
<td>
0m
</td>
</tr>
<tr>
<td>
Link amp boost:
</td>
<td>
×1
</td>
</tr>
<tr>
<td>
Range:
</td>
<td>
0m
</td>
</tr>
<tr>
<td colspan="2">
Portal is missing resonators,
</td>
</tr>
<tr>
<td colspan="2">
no new links can be made
</td>
</tr>
</tbody>
</table>
</div>
<div style="display: none;">
0 / 0
</div>
<div style="display: none;">
<table>
<tbody>
<tr>
<td colspan="2">
Hacks available every 4 hours
</td>
</tr>
<tr>
<td>
Hack count:
</td>
<td>
4
</td>
</tr>
<tr>
<td>
Cooldown time:
</td>
<td>
5m
</td>
</tr>
<tr>
<td>
Burnout time:
</td>
<td>
15m
</td>
</tr>
</tbody>
</table>
</div>
<div style="display: none;">
Double-click to set/change current location
</div>
<div style="display: none;">
Link to alternative maps (Google, etc)
</div>
<div style="display: none;">
Display a list of portals in the current view [t]
</div>
<div style="display: none;">
[x]
</div>
<div style="display: none;">
Display a list of portals in the current view [t]
</div>
<div style="display: none;">
Create a URL link to this portal
</div>
<div style="display: none;">
Link to alternative maps (Google, etc)
</div>
<div style="display: none;">
Create a URL link to this portal
</div>
<div style="display: none;">
Double-click to set/change current location
</div>
<div style="display: none;">
<table>
<tbody>
<tr>
<td>
Level:
</td>
<td>
8
</td>
</tr>
<tr>
<td>
XM:
</td>
<td>
10000 / 10000
</td>
</tr>
<tr>
<td>
AP:
</td>
<td>
2 167 791
</td>
</tr>
<tr>
<td>
level up in:
</td>
<td>
232 209 AP
</td>
</tr>
<tr>
<td>
Invites:
</td>
<td>
193
</td>
</tr>
<tr>
<td colspan="2">
</td>
</tr>
<tr>
<td colspan="2">
Note: your player stats can only be updated by a full reload (F5)
</td>
</tr>
</tbody>
</table>
</div>
<div style="display: none;">
Current Location
</div>
<div style="display: none;">
<table>
<tbody>
<tr>
<td>
Resistance:
</td>
<td>
665 004 382 MindUnits
</td>
</tr>
<tr>
<td>
Enlightened:
</td>
<td>
441 019 746 MindUnits
</td>
</tr>
</tbody>
</table>
</div>
<div style="display: none;">
Zoom out
</div>
<div style="display: none;">
Balloon Dog
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
Delete layers [d]
</div>
<div style="display: none;">
Draw a circle [o]
</div>
<div style="display: none;">
Draw a marker [m]
</div>
<div style="display: none;">
Edit layers [e]
</div>
<div style="display: none;">
Layers
</div>
<div style="display: none;">
Show artifact portal list
</div>
<div style="display: none;">
Display a list of portals in the current view [t]
</div>
<div style="display: none;">
View regional scoreboard
</div>
<div style="display: none;">
View regional scoreboard
</div>
<div style="display: none;">
Link to alternative maps (Google, etc)
</div>
<div style="display: none;">
Create a URL link to this portal
</div>
<div style="display: none;">
<table>
<tbody>
<tr>
<td>
Level:
</td>
<td>
8
</td>
</tr>
<tr>
<td>
XM:
</td>
<td>
10000 / 10000
</td>
</tr>
<tr>
<td>
AP:
</td>
<td>
2 167 791
</td>
</tr>
<tr>
<td>
level up in:
</td>
<td>
232 209 AP
</td>
</tr>
<tr>
<td>
Invites:
</td>
<td>
193
</td>
</tr>
<tr>
<td colspan="2">
</td>
</tr>
<tr>
<td colspan="2">
Note: your player stats can only be updated by a full reload (F5)
</td>
</tr>
</tbody>
</table>
</div>
<div style="display: none;">
Search for a place [f]
</div>
<div style="display: none;">
Save this portal in your bookmarks [b]
</div>
<div style="display: none;">
Chandler Wall Art
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
at most 8 outgoing links
<br>
0 links out
<br>
0 links in
<br>
(0 total)
</div>
<div style="display: none;">
<table>
<tbody>
<tr>
<td>
Total shielding:
</td>
<td>
0
</td>
</tr>
<tr>
<td>
- active:
</td>
<td>
0
</td>
</tr>
<tr>
<td>
- excess:
</td>
<td>
0
</td>
</tr>
<tr>
<td colspan="2">
From
</td>
</tr>
<tr>
<td>
- shields:
</td>
<td>
0
</td>
</tr>
<tr>
<td>
- links:
</td>
<td>
0
</td>
</tr>
</tbody>
</table>
</div>
<div style="display: none;">
<table>
<tbody>
<tr>
<td>
Enemy AP:
</td>
<td>
1825
</td>
</tr>
<tr>
<td>
  Destroy AP:
</td>
<td>
75
</td>
</tr>
<tr>
<td>
  Capture AP:
</td>
<td>
1750
</td>
</tr>
<tr>
<td colspan="2">
</td>
</tr>
</tbody>
</table>
</div>
<div style="display: none;">
<table>
<tbody>
<tr>
<td>
energy:
</td>
<td>
1000 / 1000 (100%)
</td>
</tr>
<tr>
<td>
level:
</td>
<td>
1
</td>
</tr>
<tr>
<td>
owner:
</td>
<td>
ToddXP1037
</td>
</tr>
<tr>
<td colspan="2">
</td>
</tr>
</tbody>
</table>
</div>
<div style="display: none;">
Double-click to set/change current location
</div>
<div style="display: none;">
Link to alternative maps (Google, etc)
</div>
<div style="display: none;">
Display a list of portals in the current view [t]
</div>
<div style="display: none;">
Display a summary of portals in the current view
</div>
<div style="display: none;">
Display a list of portals in the current view [t]
</div>
<div style="display: none;">
Link to alternative maps (Google, etc)
</div>
<div style="display: none;">
Create a URL link to this portal
</div>
<div style="display: none;">
[v]
</div>
<div style="display: none;">
Layers
</div>
<div style="display: none;">
Chandler Wall Art
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
Level 1
<br>
8 resonator level(s) needed for next portal level
</div>
<div style="display: none;">
Chandler Wall Art
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
Close [w]
</div>
<div style="display: none;">
Close [w]
</div>
<div style="display: none;">
Display a list of portals in the current view [t]
</div>
<div style="display: none;">
[x]
</div>
<div style="display: none;">
Show player level guesses based on resonator placement in displayed portals
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
Search for a place [f]
</div>
<div style="display: none;">
Layers
</div>
<div style="display: none;">
Show artifact portal list
</div>
<div style="display: none;">
Check portals in view for L7 farms
</div>
<div style="display: none;">
Display a summary of portals in the current view
</div>
<div style="display: none;">
Show artifact portal list
</div>
<div style="display: none;">
Edit layers [e]
</div>
<div style="display: none;">
Display a list of portals in the current view [t]
</div>
<div style="display: none;">
Show artifact portal list
</div>
<div style="display: none;">
Layers
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
Show player level guesses based on resonator placement in displayed portals
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
Game Stop
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
<strong>
Exotic Wall Chicken
</strong>
<br>
<span>
↳ incoming link
</span>
<br>
<span>
193m
</span>
</div>
<div style="display: none;">
Save this portal in your bookmarks [b]
</div>
<div style="display: none;">
Save this portal in your bookmarks [b]
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
Save this portal in your bookmarks [b]
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
Exotic Wall Chicken
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
<strong>
Game Stop
</strong>
<br>
<span>
↴ outgoing link
</span>
<br>
<span>
193m
</span>
</div>
<div style="display: none;">
Save this portal in your bookmarks [b]
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
Beaver Choice Scandinavian Restaurant
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
<strong>
Longhorn Metal Art
</strong>
<br>
<span>
↴ outgoing link
</span>
<br>
<span>
1 456m
</span>
</div>
<div style="display: none;">
Save this portal in your bookmarks [b]
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
Verona Park Fountain #2
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
Save this portal in your bookmarks [b]
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
Save this portal in your bookmarks [b]
</div>
<div style="display: none;">
Save this portal in your bookmarks [b]
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
Tierra Del Sol Fountain
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
<strong>
Tractor Wheel Park
</strong>
<br>
<span>
↴ outgoing link
</span>
<br>
<span>
663m
</span>
</div>
<div style="display: none;">
Tierra Del Sol Fountain
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
[c]
</div>
<div style="display: none;">
1147-1179 South Alma School Road, Mesa, AZ 85210, USA
</div>
<div style="display: none;">
1801-1839 West Main Street, Mesa, AZ 85201, USA
</div>
<div style="display: none;">
[3]
</div>
<div style="display: none;">
[2]
</div>
<div style="display: none;">
[1]
</div>
<div style="display: none;">
[0]
</div>
<div style="display: none;">
2015-12-29 18:29:32
<small class="milliseconds">
.193
</small>
</div>
<div style="display: none;">
[0]
</div>
<div style="display: none;">
[0]
</div>
<div style="display: none;">
17402 South Dobson Road, Chandler, AZ 85286, USA
</div>
<div style="display: none;">
17402 South Dobson Road, Chandler, AZ 85286, USA
</div>
<div style="display: none;">
1225-1499 South Dobson Road, Chandler, AZ 85286, USA
</div>
<div style="display: none;">
1900 West Carla Vista Drive, Chandler, AZ 85224, United States
</div>
<div style="display: none;">
Cubs Way, Mesa, AZ 85201, USA
</div>
<div style="display: none;">
2100 West 8th Street, Mesa, AZ 85201, USA
</div>
<div style="display: none;">
901 North Dobson Road, A, Mesa, AZ 85201, USA
</div>
<div style="display: none;">
Cubs Way, Mesa, AZ 85201, USA
</div>
<div style="display: none;">
North Evergreen Road, Mesa, AZ 85201, USA
</div>
<div style="display: none;">
2630 West 8th Street, Mesa, AZ 85201, USA
</div>
<div style="display: none;">
1225-1499 South Dobson Road, Chandler, AZ 85286, USA
</div>
<div style="display: none;">
1225-1499 South Dobson Road, Chandler, AZ 85286, USA
</div>
<div style="display: none;">
Cubs Way, Mesa, AZ 85201, USA
</div>
<div style="display: none;">
2100 West 8th Street, Mesa, AZ 85201, USA
</div>
<div style="display: none;">
2100 West 8th Street, Mesa, AZ 85201, USA
</div>
<div style="display: none;">
[0]
</div>
<div style="display: none;">
Show artifact portal list
</div>
<div style="display: none;">
[x]
</div>
<div style="display: none;">
Draw lines/triangles between bookmarked portals [q]
</div>
<div style="display: none;">
Show player level guesses based on resonator placement in displayed portals
</div>
<div style="display: none;">
Show player level guesses based on resonator placement in displayed portals
</div>
<div style="display: none;">
[x]
</div>
<div style="display: none;">
Show artifact portal list
</div>
<div style="display: none;">
URL link to this map view
</div>
<div style="display: none;">
Display a list of portals in the current view [t]
</div>
<div style="display: none;">
View regional scoreboard
</div>
<div style="display: none;">
Check portals in view for L7 farms
</div>
<div style="display: none;">
View regional scoreboard
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Unique players who have completed this mission
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
<table>
<tbody>
<tr>
<td>
Level:
</td>
<td>
4
</td>
</tr>
<tr>
<td>
Resonators:
</td>
<td>
8
</td>
</tr>
<tr>
<td>
Health:
</td>
<td>
85%
</td>
</tr>
</tbody>
</table>
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Length of this mission.
<br>
<br>
NOTE: The actual distance required to cover may vary depending on several factors!
</div>
<div style="display: none;">
<table>
<tbody>
<tr>
<td>
Base range:
</td>
<td>
90 368m
</td>
</tr>
<tr>
<td>
Link amp boost:
</td>
<td>
×1
</td>
</tr>
<tr>
<td>
Range:
</td>
<td>
90 368m
</td>
</tr>
</tbody>
</table>
</div>
<div style="display: none;">
Distance to this mission. Click to update.
</div>
<div style="display: none;">
Non Sequential mission with 7 waypoints
</div>
<div style="display: none;">
Unique players who have completed this mission
</div>
<div style="display: none;">
Non Sequential mission with 7 waypoints
</div>
<div style="display: none;">
Unique players who have completed this mission
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Length of this mission.
<br>
<br>
NOTE: The actual distance required to cover may vary depending on several factors!
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Length of this mission.
<br>
<br>
NOTE: The actual distance required to cover may vary depending on several factors!
</div>
<div style="display: none;">
Length of this mission.
<br>
<br>
NOTE: The actual distance required to cover may vary depending on several factors!
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Unique players who have completed this mission
</div>
<div style="display: none;">
Distance to this mission. Click to update.
</div>
<div style="display: none;">
Length of this mission.
<br>
<br>
NOTE: The actual distance required to cover may vary depending on several factors!
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
<table>
<tbody>
<tr>
<td>
Total shielding:
</td>
<td>
0
</td>
</tr>
<tr>
<td>
- active:
</td>
<td>
0
</td>
</tr>
<tr>
<td>
- excess:
</td>
<td>
0
</td>
</tr>
<tr>
<td colspan="2">
From
</td>
</tr>
<tr>
<td>
- shields:
</td>
<td>
0
</td>
</tr>
<tr>
<td>
- links:
</td>
<td>
0
</td>
</tr>
</tbody>
</table>
</div>
<div style="display: none;">
Double-click to set/change current location
</div>
<div style="display: none;">
Create a URL link to this portal
</div>
<div style="display: none;">
Display a list of portals in the current view [t]
</div>
<div style="display: none;">
Double-click to set/change current location
</div>
<div style="display: none;">
Show player level guesses based on resonator placement in displayed portals
</div>
<div style="display: none;">
Draw lines/triangles between bookmarked portals [q]
</div>
<div style="display: none;">
Display a summary of portals in the current view
</div>
<div style="display: none;">
Create a URL link to this portal
</div>
<div style="display: none;">
Non Sequential mission with 7 waypoints
</div>
<div style="display: none;">
Distance to this mission. Click to update.
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Distance to this mission. Click to update.
</div>
<div style="display: none;">
Unique players who have completed this mission
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Length of this mission.
<br>
<br>
NOTE: The actual distance required to cover may vary depending on several factors!
</div>
<div style="display: none;">
Distance to this mission. Click to update.
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Unique players who have completed this mission
</div>
<div style="display: none;">
Distance to this mission. Click to update.
</div>
<div style="display: none;">
Distance to this mission. Click to update.
</div>
<div style="display: none;">
Non Sequential mission with 6 waypoints
</div>
<div style="display: none;">
Non Sequential mission with 6 waypoints
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Length of this mission.
<br>
<br>
NOTE: The actual distance required to cover may vary depending on several factors!
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Non Sequential mission with 6 waypoints
</div>
<div style="display: none;">
Distance to this mission. Click to update.
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Double-click to set/change current location
</div>
<div style="display: none;">
Create a URL link to this portal
</div>
<div style="display: none;">
View regional scoreboard
</div>
<div style="display: none;">
Display raw data of the portal
</div>
<div style="display: none;">
Double-click to set/change current location
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Distance to this mission. Click to update.
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
City of Mesa Main Library
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
<table>
<tbody>
<tr>
<td>
Base range:
</td>
<td>
1 977m
</td>
</tr>
<tr>
<td>
Link amp boost:
</td>
<td>
×2
</td>
</tr>
<tr>
<td>
Range:
</td>
<td>
3 955m
</td>
</tr>
<tr>
<td colspan="2">
Portal is missing resonators,
</td>
</tr>
<tr>
<td colspan="2">
no new links can be made
</td>
</tr>
</tbody>
</table>
</div>
<div style="display: none;">
<table>
<tbody>
<tr>
<td colspan="2">
Hacks available every 4 hours
</td>
</tr>
<tr>
<td>
Hack count:
</td>
<td>
4
</td>
</tr>
<tr>
<td>
Cooldown time:
</td>
<td>
5m
</td>
</tr>
<tr>
<td>
Burnout time:
</td>
<td>
15m
</td>
</tr>
</tbody>
</table>
</div>
<div style="display: none;">
Double-click to set/change current location
</div>
<div style="display: none;">
Display a summary of portals in the current view
</div>
<div style="display: none;">
Draw lines/triangles between bookmarked portals [q]
</div>
<div style="display: none;">
Show player level guesses based on resonator placement in displayed portals
</div>
<div style="display: none;">
[x]
</div>
<div style="display: none;">
Show player level guesses based on resonator placement in displayed portals
</div>
<div style="display: none;">
[x]
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Church
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
Save this portal in your bookmarks [b]
</div>
<div style="display: none;">
Church
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
<table>
<tbody>
<tr>
<td>
Level:
</td>
<td>
8
</td>
</tr>
<tr>
<td>
XM:
</td>
<td>
10000 / 10000
</td>
</tr>
<tr>
<td>
AP:
</td>
<td>
2 167 791
</td>
</tr>
<tr>
<td>
level up in:
</td>
<td>
232 209 AP
</td>
</tr>
<tr>
<td>
Invites:
</td>
<td>
193
</td>
</tr>
<tr>
<td colspan="2">
</td>
</tr>
<tr>
<td colspan="2">
Note: your player stats can only be updated by a full reload (F5)
</td>
</tr>
</tbody>
</table>
</div>
<div style="display: none;">
<table>
<tbody>
<tr>
<td>
Resistance:
</td>
<td>
665 004 382 MindUnits
</td>
</tr>
<tr>
<td>
Enlightened:
</td>
<td>
441 019 746 MindUnits
</td>
</tr>
</tbody>
</table>
</div>
<div style="display: none;">
Search for a place [f]
</div>
<div style="display: none;">
Save this portal in your bookmarks [b]
</div>
<div style="display: none;">
<strong>
Bell Tower
</strong>
<br>
<span>
↴ outgoing link
</span>
<br>
<span>
1 019m
</span>
</div>
<div style="display: none;">
Save this portal in your bookmarks [b]
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
Lion Head Fountain
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
Save this portal in your bookmarks [b]
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Length of this mission.
<br>
<br>
NOTE: The actual distance required to cover may vary depending on several factors!
</div>
<div style="display: none;">
Layers
</div>
<div style="display: none;">
<table>
<tbody>
<tr>
<td>
Resistance:
</td>
<td>
665 004 382 MindUnits
</td>
</tr>
<tr>
<td>
Enlightened:
</td>
<td>
441 019 746 MindUnits
</td>
</tr>
</tbody>
</table>
</div>
<div style="display: none;">
<table>
<tbody>
<tr>
<td>
Level:
</td>
<td>
8
</td>
</tr>
<tr>
<td>
XM:
</td>
<td>
10000 / 10000
</td>
</tr>
<tr>
<td>
AP:
</td>
<td>
2 167 791
</td>
</tr>
<tr>
<td>
level up in:
</td>
<td>
232 209 AP
</td>
</tr>
<tr>
<td>
Invites:
</td>
<td>
193
</td>
</tr>
<tr>
<td colspan="2">
</td>
</tr>
<tr>
<td colspan="2">
Note: your player stats can only be updated by a full reload (F5)
</td>
</tr>
</tbody>
</table>
</div>
<div style="display: none;">
<table>
<tbody>
<tr>
<td>
Resistance:
</td>
<td>
665 004 382 MindUnits
</td>
</tr>
<tr>
<td>
Enlightened:
</td>
<td>
441 019 746 MindUnits
</td>
</tr>
</tbody>
</table>
</div>
<div style="display: none;">
Search for a place [f]
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
House of the Lord Temple
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
Save this portal in your bookmarks [b]
</div>
<div style="display: none;">
Save this portal in your bookmarks [b]
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Length of this mission.
<br>
<br>
NOTE: The actual distance required to cover may vary depending on several factors!
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
Save this portal in your bookmarks [b]
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Mesa Arizona Temple
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
Level 2.5
<br>
4 resonator level(s) needed for next portal level
</div>
<div style="display: none;">
Mesa Arizona Temple
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
Search for a place [f]
</div>
<div style="display: none;">
<table>
<tbody>
<tr>
<td>
Resistance:
</td>
<td>
665 004 382 MindUnits
</td>
</tr>
<tr>
<td>
Enlightened:
</td>
<td>
441 019 746 MindUnits
</td>
</tr>
</tbody>
</table>
</div>
<div style="display: none;">
<table>
<tbody>
<tr>
<td>
Level:
</td>
<td>
8
</td>
</tr>
<tr>
<td>
XM:
</td>
<td>
10000 / 10000
</td>
</tr>
<tr>
<td>
AP:
</td>
<td>
2 167 791
</td>
</tr>
<tr>
<td>
level up in:
</td>
<td>
232 209 AP
</td>
</tr>
<tr>
<td>
Invites:
</td>
<td>
193
</td>
</tr>
<tr>
<td colspan="2">
</td>
</tr>
<tr>
<td colspan="2">
Note: your player stats can only be updated by a full reload (F5)
</td>
</tr>
</tbody>
</table>
</div>
<div style="display: none;">
<table>
<tbody>
<tr>
<td>
Resistance:
</td>
<td>
665 004 382 MindUnits
</td>
</tr>
<tr>
<td>
Enlightened:
</td>
<td>
441 019 746 MindUnits
</td>
</tr>
</tbody>
</table>
</div>
<div style="display: none;">
Search for a place [f]
</div>
<div style="display: none;">
Save this portal in your bookmarks [b]
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Unique players who have completed this mission
</div>
<div style="display: none;">
Distance to this mission. Click to update.
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
Save this portal in your bookmarks [b]
</div>
<div style="display: none;">
Save this portal in your bookmarks [b]
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
Unique players who have completed this mission
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
Save this portal in your bookmarks [b]
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Unique players who have completed this mission
</div>
<div style="display: none;">
Distance to this mission. Click to update.
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
Save this portal in your bookmarks [b]
</div>
<div style="display: none;">
Search for a place [f]
</div>
<div style="display: none;">
Save this portal in your bookmarks [b]
</div>
<div style="display: none;">
Save this portal in your bookmarks [b]
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Unique players who have completed this mission
</div>
<div style="display: none;">
Distance to this mission. Click to update.
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
<strong>
LDS Temple
</strong>
<br>
<span>
↴ outgoing link
</span>
<br>
<span>
36m
</span>
</div>
<div style="display: none;">
Save this portal in your bookmarks [b]
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
Rock Art
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
Save this portal in your bookmarks [b]
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
Distance to this mission. Click to update.
</div>
<div style="display: none;">
Unique players who have completed this mission
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Length of this mission.
<br>
<br>
NOTE: The actual distance required to cover may vary depending on several factors!
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
Save this portal in your bookmarks [b]
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Mesa Temple Visitors Center
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
<strong>
LDS Temple
</strong>
<br>
<span>
↳ incoming link
</span>
<br>
<span>
57m
</span>
</div>
<div style="display: none;">
Mesa Temple Visitors Center
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
<strong>
Rock Art
</strong>
<br>
<span>
↴ outgoing link
</span>
<br>
<span>
82m
</span>
</div>
<div style="display: none;">
Save this portal in your bookmarks [b]
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
Distance to this mission. Click to update.
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Pioneer Park Southeast Entrance
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
Search for a place [f]
</div>
<div style="display: none;">
<table>
<tbody>
<tr>
<td>
Resistance:
</td>
<td>
665 004 382 MindUnits
</td>
</tr>
<tr>
<td>
Enlightened:
</td>
<td>
441 019 746 MindUnits
</td>
</tr>
</tbody>
</table>
</div>
<div style="display: none;">
Search for a place [f]
</div>
<div style="display: none;">
Save this portal in your bookmarks [b]
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Mesa Pioneer Monument
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
Save this portal in your bookmarks [b]
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
Distance to this mission. Click to update.
</div>
<div style="display: none;">
In Memory of Richard L. Love
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
Search for a place [f]
</div>
<div style="display: none;">
<table>
<tbody>
<tr>
<td>
Resistance:
</td>
<td>
665 004 382 MindUnits
</td>
</tr>
<tr>
<td>
Enlightened:
</td>
<td>
441 019 746 MindUnits
</td>
</tr>
</tbody>
</table>
</div>
<div style="display: none;">
Search for a place [f]
</div>
<div style="display: none;">
Save this portal in your bookmarks [b]
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Rufus Dog Plaque
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
Save this portal in your bookmarks [b]
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
Distance to this mission. Click to update.
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Mesa
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
Level 0
<br>
8 resonator level(s) needed for next portal level
</div>
<div style="display: none;">
Save this portal in your bookmarks [b]
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
Save this portal in your bookmarks [b]
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Designated dog exercise sign
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
Level 0
<br>
8 resonator level(s) needed for next portal level
</div>
<div style="display: none;">
Designated dog exercise sign
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
Close [w]
</div>
<div style="display: none;">
<table>
<tbody>
<tr>
<td>
Resistance:
</td>
<td>
665 004 382 MindUnits
</td>
</tr>
<tr>
<td>
Enlightened:
</td>
<td>
441 019 746 MindUnits
</td>
</tr>
</tbody>
</table>
</div>
<div style="display: none;">
Search for a place [f]
</div>
<div style="display: none;">
Designated dog exercise sign
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
Save this portal in your bookmarks [b]
</div>
<div style="display: none;">
Save this portal in your bookmarks [b]
</div>
<div style="display: none;">
Designated dog exercise sign
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Light Rail Art
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
Save this portal in your bookmarks [b]
</div>
<div style="display: none;">
Save this portal in your bookmarks [b]
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Family Fundamental Unit of Society
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
Save this portal in your bookmarks [b]
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Kids Need to Read
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
Save this portal in your bookmarks [b]
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
Save this portal in your bookmarks [b]
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Three Guys Sitting
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
Level 1
<br>
8 resonator level(s) needed for next portal level
</div>
<div style="display: none;">
Three Guys Sitting
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
Save this portal in your bookmarks [b]
</div>
<div style="display: none;">
Save this portal in your bookmarks [b]
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
The Teacher
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
<strong>
Circle K 310 N Mesa Drive
</strong>
<br>
<span>
↳ incoming link
</span>
<br>
<span>
936m
</span>
</div>
<div style="display: none;">
The Teacher
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
Search for a place [f]
</div>
<div style="display: none;">
Level 6.125
<br>
7 resonator level(s) needed for next portal level
</div>
<div style="display: none;">
The Teacher
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
Level 6.125
<br>
7 resonator level(s) needed for next portal level
</div>
<div style="display: none;">
The Teacher
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
<strong>
Paper Boy and Dog
</strong>
<br>
<span>
↴ outgoing link
</span>
<br>
<span>
493m
</span>
</div>
<div style="display: none;">
Save this portal in your bookmarks [b]
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Layers
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
Fragments Of Support
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
Save this portal in your bookmarks [b]
</div>
<div style="display: none;">
Save this portal in your bookmarks [b]
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
<strong>
Go to portal
</strong>
<br>
<span>
↴ outgoing link
</span>
<br>
<span>
2 012m
</span>
</div>
<div style="display: none;">
Search for a place [f]
</div>
<div style="display: none;">
<strong>
Go to portal
</strong>
<br>
<span>
↴ outgoing link
</span>
<br>
<span>
2 012m
</span>
</div>
<div style="display: none;">
Save this portal in your bookmarks [b]
</div>
<div style="display: none;">
Save this portal in your bookmarks [b]
</div>
<div style="display: none;">
Garden Chapel
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Mesa Arts Center - Rainshelter Bus Stop
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
Level 1
<br>
8 resonator level(s) needed for next portal level
</div>
<div style="display: none;">
Mesa Arts Center - Rainshelter Bus Stop
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
Save this portal in your bookmarks [b]
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
<strong>
Hands Across Arizona
</strong>
<br>
<span>
↳ incoming link
</span>
<br>
<span>
496m
</span>
</div>
<div style="display: none;">
Girl with Helicopter Sculpture
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
Level 6.125
<br>
7 resonator level(s) needed for next portal level
</div>
<div style="display: none;">
Search for a place [f]
</div>
<div style="display: none;">
Save this portal in your bookmarks [b]
</div>
<div style="display: none;">
Save this portal in your bookmarks [b]
</div>
<div style="display: none;">
Save this portal in your bookmarks [b]
</div>
<div style="display: none;">
Girl with Helicopter Sculpture
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
<table>
<tbody>
<tr>
<td>
Level:
</td>
<td>
2
</td>
</tr>
<tr>
<td>
Resonators:
</td>
<td>
3
</td>
</tr>
<tr>
<td>
Health:
</td>
<td>
94%
</td>
</tr>
</tbody>
</table>
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Length of this mission.
<br>
<br>
NOTE: The actual distance required to cover may vary depending on several factors!
</div>
<div style="display: none;">
<table>
<tbody>
<tr>
<td>
Level:
</td>
<td>
8
</td>
</tr>
<tr>
<td>
XM:
</td>
<td>
10000 / 10000
</td>
</tr>
<tr>
<td>
AP:
</td>
<td>
2 167 791
</td>
</tr>
<tr>
<td>
level up in:
</td>
<td>
232 209 AP
</td>
</tr>
<tr>
<td>
Invites:
</td>
<td>
193
</td>
</tr>
<tr>
<td colspan="2">
</td>
</tr>
<tr>
<td colspan="2">
Note: your player stats can only be updated by a full reload (F5)
</td>
</tr>
</tbody>
</table>
</div>
<div style="display: none;">
<table>
<tbody>
<tr>
<td>
Resistance:
</td>
<td>
665 004 382 MindUnits
</td>
</tr>
<tr>
<td>
Enlightened:
</td>
<td>
441 019 746 MindUnits
</td>
</tr>
</tbody>
</table>
</div>
<div style="display: none;">
<table>
<tbody>
<tr>
<td>
Level:
</td>
<td>
8
</td>
</tr>
<tr>
<td>
XM:
</td>
<td>
10000 / 10000
</td>
</tr>
<tr>
<td>
AP:
</td>
<td>
2 167 791
</td>
</tr>
<tr>
<td>
level up in:
</td>
<td>
232 209 AP
</td>
</tr>
<tr>
<td>
Invites:
</td>
<td>
193
</td>
</tr>
<tr>
<td colspan="2">
</td>
</tr>
<tr>
<td colspan="2">
Note: your player stats can only be updated by a full reload (F5)
</td>
</tr>
</tbody>
</table>
</div>
<div style="display: none;">
LDS Temple
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
at most 8 outgoing links
<br>
2 links out
<br>
1 links in
<br>
(3 total)
</div>
<div style="display: none;">
<table>
<tbody>
<tr>
<td>
Enemy AP:
</td>
<td>
4036
</td>
</tr>
<tr>
<td>
  Destroy AP:
</td>
<td>
2286
</td>
</tr>
<tr>
<td>
  Capture AP:
</td>
<td>
1750
</td>
</tr>
<tr>
<td colspan="2">
</td>
</tr>
</tbody>
</table>
</div>
<div style="display: none;">
<table>
<tbody>
<tr>
<td>
energy:
</td>
<td>
3810 / 4000 (95%)
</td>
</tr>
<tr>
<td>
level:
</td>
<td>
6
</td>
</tr>
<tr>
<td>
owner:
</td>
<td>
suntailedshadow
</td>
</tr>
<tr>
<td colspan="2">
</td>
</tr>
</tbody>
</table>
</div>
<div style="display: none;">
<table>
<tbody>
<tr>
<td>
energy:
</td>
<td>
3767 / 4000 (94%)
</td>
</tr>
<tr>
<td>
level:
</td>
<td>
6
</td>
</tr>
<tr>
<td>
owner:
</td>
<td>
vivalaelefantes
</td>
</tr>
<tr>
<td colspan="2">
</td>
</tr>
</tbody>
</table>
</div>
<div style="display: none;">
<table>
<tbody>
<tr>
<td>
energy:
</td>
<td>
3767 / 4000 (94%)
</td>
</tr>
<tr>
<td>
level:
</td>
<td>
6
</td>
</tr>
<tr>
<td>
owner:
</td>
<td>
vivalaelefantes
</td>
</tr>
<tr>
<td colspan="2">
</td>
</tr>
</tbody>
</table>
</div>
<div style="display: none;">
<table>
<tbody>
<tr>
<td>
energy:
</td>
<td>
3810 / 4000 (95%)
</td>
</tr>
<tr>
<td>
level:
</td>
<td>
6
</td>
</tr>
<tr>
<td>
owner:
</td>
<td>
suntailedshadow
</td>
</tr>
<tr>
<td colspan="2">
</td>
</tr>
</tbody>
</table>
</div>
<div style="display: none;">
<table>
<tbody>
<tr>
<td>
Enemy AP:
</td>
<td>
4036
</td>
</tr>
<tr>
<td>
  Destroy AP:
</td>
<td>
2286
</td>
</tr>
<tr>
<td>
  Capture AP:
</td>
<td>
1750
</td>
</tr>
<tr>
<td colspan="2">
</td>
</tr>
</tbody>
</table>
</div>
<div style="display: none;">
<table>
<tbody>
<tr>
<td>
Total shielding:
</td>
<td>
37
</td>
</tr>
<tr>
<td>
- active:
</td>
<td>
37
</td>
</tr>
<tr>
<td>
- excess:
</td>
<td>
0
</td>
</tr>
<tr>
<td colspan="2">
From
</td>
</tr>
<tr>
<td>
- shields:
</td>
<td>
0
</td>
</tr>
<tr>
<td>
- links:
</td>
<td>
37
</td>
</tr>
</tbody>
</table>
</div>
<div style="display: none;">
at most 8 outgoing links
<br>
2 links out
<br>
1 links in
<br>
(3 total)
</div>
<div style="display: none;">
at most 8 outgoing links
<br>
2 links out
<br>
1 links in
<br>
(3 total)
</div>
<div style="display: none;">
at most 8 outgoing links
<br>
2 links out
<br>
1 links in
<br>
(3 total)
</div>
<div style="display: none;">
<table>
<tbody>
<tr>
<td>
Total shielding:
</td>
<td>
37
</td>
</tr>
<tr>
<td>
- active:
</td>
<td>
37
</td>
</tr>
<tr>
<td>
- excess:
</td>
<td>
0
</td>
</tr>
<tr>
<td colspan="2">
From
</td>
</tr>
<tr>
<td>
- shields:
</td>
<td>
0
</td>
</tr>
<tr>
<td>
- links:
</td>
<td>
37
</td>
</tr>
</tbody>
</table>
</div>
<div style="display: none;">
<table>
<tbody>
<tr>
<td>
Total shielding:
</td>
<td>
37
</td>
</tr>
<tr>
<td>
- active:
</td>
<td>
37
</td>
</tr>
<tr>
<td>
- excess:
</td>
<td>
0
</td>
</tr>
<tr>
<td colspan="2">
From
</td>
</tr>
<tr>
<td>
- shields:
</td>
<td>
0
</td>
</tr>
<tr>
<td>
- links:
</td>
<td>
37
</td>
</tr>
</tbody>
</table>
</div>
<div style="display: none;">
at most 8 outgoing links
<br>
2 links out
<br>
1 links in
<br>
(3 total)
</div>
<div style="display: none;">
at most 8 outgoing links
<br>
2 links out
<br>
1 links in
<br>
(3 total)
</div>
<div style="display: none;">
<table>
<tbody>
<tr>
<td>
Total shielding:
</td>
<td>
37
</td>
</tr>
<tr>
<td>
- active:
</td>
<td>
37
</td>
</tr>
<tr>
<td>
- excess:
</td>
<td>
0
</td>
</tr>
<tr>
<td colspan="2">
From
</td>
</tr>
<tr>
<td>
- shields:
</td>
<td>
0
</td>
</tr>
<tr>
<td>
- links:
</td>
<td>
37
</td>
</tr>
</tbody>
</table>
</div>
<div style="display: none;">
<table>
<tbody>
<tr>
<td>
Total shielding:
</td>
<td>
37
</td>
</tr>
<tr>
<td>
- active:
</td>
<td>
37
</td>
</tr>
<tr>
<td>
- excess:
</td>
<td>
0
</td>
</tr>
<tr>
<td colspan="2">
From
</td>
</tr>
<tr>
<td>
- shields:
</td>
<td>
0
</td>
</tr>
<tr>
<td>
- links:
</td>
<td>
37
</td>
</tr>
</tbody>
</table>
</div>
<div style="display: none;">
<table>
<tbody>
<tr>
<td>
Enemy AP:
</td>
<td>
4036
</td>
</tr>
<tr>
<td>
  Destroy AP:
</td>
<td>
2286
</td>
</tr>
<tr>
<td>
  Capture AP:
</td>
<td>
1750
</td>
</tr>
<tr>
<td colspan="2">
</td>
</tr>
</tbody>
</table>
</div>
<div style="display: none;">
<table>
<tbody>
<tr>
<td>
energy:
</td>
<td>
3767 / 4000 (94%)
</td>
</tr>
<tr>
<td>
level:
</td>
<td>
6
</td>
</tr>
<tr>
<td>
owner:
</td>
<td>
vivalaelefantes
</td>
</tr>
<tr>
<td colspan="2">
</td>
</tr>
</tbody>
</table>
</div>
<div style="display: none;">
Double-click to set/change current location
</div>
<div style="display: none;">
LDS Temple
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
<strong>
Large Fountain
</strong>
<br>
<span>
↳ incoming link
</span>
<br>
<span>
36m
</span>
</div>
<div style="display: none;">
LDS Temple
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
<strong>
Rock Art
</strong>
<br>
<span>
↴ outgoing link
</span>
<br>
<span>
32m
</span>
</div>
<div style="display: none;">
LDS Temple
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
<strong>
Mesa Temple Visitors Center
</strong>
<br>
<span>
↴ outgoing link
</span>
<br>
<span>
57m
</span>
</div>
<div style="display: none;">
LDS Temple
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
LDS Temple
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
<strong>
Rock Art
</strong>
<br>
<span>
↴ outgoing link
</span>
<br>
<span>
32m
</span>
</div>
<div style="display: none;">
<strong>
Large Fountain
</strong>
<br>
<span>
↳ incoming link
</span>
<br>
<span>
36m
</span>
</div>
<div style="display: none;">
LDS Temple
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
at most 8 outgoing links
<br>
2 links out
<br>
1 links in
<br>
(3 total)
</div>
<div style="display: none;">
<table>
<tbody>
<tr>
<td>
Enemy AP:
</td>
<td>
4036
</td>
</tr>
<tr>
<td>
  Destroy AP:
</td>
<td>
2286
</td>
</tr>
<tr>
<td>
  Capture AP:
</td>
<td>
1750
</td>
</tr>
<tr>
<td colspan="2">
</td>
</tr>
</tbody>
</table>
</div>
<div style="display: none;">
Double-click to set/change current location
</div>
<div style="display: none;">
Link to alternative maps (Google, etc)
</div>
<div style="display: none;">
Link to alternative maps (Google, etc)
</div>
<div style="display: none;">
Create a URL link to this portal
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Double-click to set/change current location
</div>
<div style="display: none;">
Double-click to set/change current location
</div>
<div style="display: none;">
Link to alternative maps (Google, etc)
</div>
<div style="display: none;">
Create a URL link to this portal
</div>
<div style="display: none;">
Link to alternative maps (Google, etc)
</div>
<div style="display: none;">
Link to alternative maps (Google, etc)
</div>
<div style="display: none;">
Display raw data of the portal
</div>
<div style="display: none;">
Link to alternative maps (Google, etc)
</div>
<div style="display: none;">
Create a URL link to this portal
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
LDS Temple
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
Double-click to set/change current location
</div>
<div style="display: none;">
<table>
<tbody>
<tr>
<td>
Level:
</td>
<td>
6
</td>
</tr>
<tr>
<td>
Resonators:
</td>
<td>
8
</td>
</tr>
<tr>
<td>
Health:
</td>
<td>
20%
</td>
</tr>
</tbody>
</table>
</div>
<div style="display: none;">
<table>
<tbody>
<tr>
<td>
Level:
</td>
<td>
2
</td>
</tr>
<tr>
<td>
Resonators:
</td>
<td>
3
</td>
</tr>
<tr>
<td>
Health:
</td>
<td>
94%
</td>
</tr>
</tbody>
</table>
</div>
<div style="display: none;">
LDS Temple
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
<strong>
Large Fountain
</strong>
<br>
<span>
↳ incoming link
</span>
<br>
<span>
36m
</span>
</div>
<div style="display: none;">
<table>
<tbody>
<tr>
<td>
Resistance:
</td>
<td>
665 004 382 MindUnits
</td>
</tr>
<tr>
<td>
Enlightened:
</td>
<td>
441 019 746 MindUnits
</td>
</tr>
</tbody>
</table>
</div>
<div style="display: none;">
<strong>
Rock Art
</strong>
<br>
<span>
↴ outgoing link
</span>
<br>
<span>
32m
</span>
</div>
<div style="display: none;">
Length of this mission.
<br>
<br>
NOTE: The actual distance required to cover may vary depending on several factors!
</div>
<div style="display: none;">
Toggle sidebar [i]
</div>
<div style="display: none;">
<strong>
Mesa Temple Visitors Center
</strong>
<br>
<span>
↴ outgoing link
</span>
<br>
<span>
57m
</span>
</div>
<div style="display: none;">
LDS Temple
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
Level 2.25
<br>
6 resonator level(s) needed for next portal level
</div>
<div style="display: none;">
LDS Temple
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
Close [w]
</div>
<div style="display: none;">
LDS Temple
<br>
<br>
Click to show full image.
</div>
<div style="display: none;">
<strong>
Large Fountain
</strong>
<br>
<span>
↳ incoming link
</span>
<br>
<span>
36m
</span>
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Average rating
</div>
<div style="display: none;">
Double-click to set/change current location
</div>
<div style="display: none;">
<table>
<tbody>
<tr>
<td>
energy:
</td>
<td>
3767 / 4000 (94%)
</td>
</tr>
<tr>
<td>
level:
</td>
<td>
6
</td>
</tr>
<tr>
<td>
owner:
</td>
<td>
vivalaelefantes
</td>
</tr>
<tr>
<td colspan="2">
</td>
</tr>
</tbody>
</table>
</div>
<div style="display: none;">
Typical duration
</div>
<div style="display: none;">
Non Sequential mission with 6 waypoints
</div>
<div>
Distance to this mission. Click to update.
</div>
</div>
<select id="portal_highlight_select">
<option value="No Highlights">
No Highlights
</option>
<option value="Bookmarked Portals">
Bookmarked Portals
</option>
<option value="Inactive Portals">
Inactive Portals
</option>
<option value="Portals Missing Resonators">
Portals Missing Resonators
</option>
<option value="Uniques">
Uniques
</option>
</select>
<a id="bkmrksTrigger" class="open" onclick="window.plugin.bookmarks.switchStatusBkmrksBox('switch');return false;" accesskey="v" title="[v]" style="height: 64px;">
[-] Bookmarks
</a>
<div id="bookmarksBox" class="ui-draggable" style="top: 100px; left: 100px; height: 0px;">
<div id="topBar">
<a id="bookmarksMin" class="btn" onclick="window.plugin.bookmarks.switchStatusBkmrksBox(0);return false;" title="Minimize">
-
</a>
<div class="handle ui-draggable-handle">
...
</div>
<a id="bookmarksDel" class="btn" onclick="window.plugin.bookmarks.deleteMode();return false;" title="Show/Hide 'X' button">
Show/Hide "X" button
</a>
</div>
<div id="bookmarksTypeBar">
<h5 class="bkmrk_maps current" onclick="window.plugin.bookmarks.switchPageBkmrksBox(this, 0);return false">
Maps
</h5>
<h5 class="bkmrk_portals" onclick="window.plugin.bookmarks.switchPageBkmrksBox(this, 1);return false">
Portals
</h5>
<div style="clear:both !important;">
</div>
</div>
<div id="bkmrk_maps" class="bookmarkList current">
<div class="addForm">
<input placeholder="Insert label">
<a class="newMap" onclick="window.plugin.bookmarks.addElement(this, 'map');return false;">
+ Map
</a>
<a class="newFolder" onclick="window.plugin.bookmarks.addElement(this, 'folder');return false;">
+ Folder
</a>
</div>
<ul class="ui-sortable">
<li class="bookmarkFolder othersBookmarks open" id="idOthers">
<ul class="ui-sortable">
</ul>
</li>
</ul>
</div>
<div id="bkmrk_portals" class="bookmarkList">
<div class="addForm">
<input placeholder="Insert label">
<a class="newFolder" onclick="window.plugin.bookmarks.addElement(this, 'folder');return false;">
+ Folder
</a>
</div>
<ul class="ui-sortable">
<li class="bookmarkFolder othersBookmarks open" id="idOthers">
<ul class="ui-sortable">
<li class="bkmrk" id="id1451443070733">
<a class="bookmarksRemoveFrom" onclick="window.plugin.bookmarks.removeElement(this, 'portals');return false;" title="Remove from bookmarks">
X
</a>
<a class="bookmarksLink ui-sortable-handle" onclick="$('a.bookmarksLink.selected').removeClass('selected');window.zoomToAndShowPortal('3d31ec4a7ce14535ab319e1a4aa0b2a9.16', [33.411036,-111.81996]);return false;">
Church
</a>
</li>
<li class="bkmrk" id="id1451443074534">
<a class="bookmarksRemoveFrom" onclick="window.plugin.bookmarks.removeElement(this, 'portals');return false;" title="Remove from bookmarks">
X
</a>
<a class="bookmarksLink ui-sortable-handle" onclick="$('a.bookmarksLink.selected').removeClass('selected');window.zoomToAndShowPortal('938314152400458b8459b495c4ee538f.16', [33.411685,-111.819357]);return false;">
Mesa Temple Spire
</a>
</li>
<li class="bkmrk" id="id1451443078691">
<a class="bookmarksRemoveFrom" onclick="window.plugin.bookmarks.removeElement(this, 'portals');return false;" title="Remove from bookmarks">
X
</a>
<a class="bookmarksLink ui-sortable-handle" onclick="$('a.bookmarksLink.selected').removeClass('selected');window.zoomToAndShowPortal('1f2e2a6cd3bd4065960ee6e82130cb1b.16', [33.412731,-111.819333]);return false;">
Lion Head Fountain
</a>
</li>
<li class="bkmrk" id="id1451443084162">
<a class="bookmarksRemoveFrom" onclick="window.plugin.bookmarks.removeElement(this, 'portals');return false;" title="Remove from bookmarks">
X
</a>
<a class="bookmarksLink ui-sortable-handle" onclick="$('a.bookmarksLink.selected').removeClass('selected');window.zoomToAndShowPortal('387621e83a97491fb2a3af0d122278bd.12', [33.412833,-111.819642]);return false;">
House of the Lord Temple
</a>
</li>
<li class="bkmrk" id="id1451443090153">
<a class="bookmarksRemoveFrom" onclick="window.plugin.bookmarks.removeElement(this, 'portals');return false;" title="Remove from bookmarks">
X
</a>
<a class="bookmarksLink ui-sortable-handle" onclick="$('a.bookmarksLink.selected').removeClass('selected');window.zoomToAndShowPortal('7c23c7e50498488a9c6b3e846d05b2d6.12', [33.412869,-111.820521]);return false;">
Mesa Arizona Temple
</a>
</li>
<li class="bkmrk" id="id1451443097031">
<a class="bookmarksRemoveFrom" onclick="window.plugin.bookmarks.removeElement(this, 'portals');return false;" title="Remove from bookmarks">
X
</a>
<a class="bookmarksLink ui-sortable-handle" onclick="$('a.bookmarksLink.selected').removeClass('selected');window.zoomToAndShowPortal('3e202a01bab0403c83c3077deb44fafa.12', [33.41312,-111.820296]);return false;">
Mesa Arizona Temple
</a>
</li>
<li class="bkmrk" id="id1451443102097">
<a class="bookmarksRemoveFrom" onclick="window.plugin.bookmarks.removeElement(this, 'portals');return false;" title="Remove from bookmarks">
X
</a>
<a class="bookmarksLink ui-sortable-handle" onclick="$('a.bookmarksLink.selected').removeClass('selected');window.zoomToAndShowPortal('07d512d6ffcf4e9b8ccaec6912ab81f4.16', [33.413225,-111.81999]);return false;">
Petrified Wood Monument II
</a>
</li>
<li class="bkmrk" id="id1451443107300">
<a class="bookmarksRemoveFrom" onclick="window.plugin.bookmarks.removeElement(this, 'portals');return false;" title="Remove from bookmarks">
X
</a>
<a class="bookmarksLink ui-sortable-handle" onclick="$('a.bookmarksLink.selected').removeClass('selected');window.zoomToAndShowPortal('d7db95c0c92044ac8189bbd3108d2964.16', [33.413219,-111.819695]);return false;">
Large Fountain
</a>
</li>
<li class="bkmrk" id="id1451443115563">
<a class="bookmarksRemoveFrom" onclick="window.plugin.bookmarks.removeElement(this, 'portals');return false;" title="Remove from bookmarks">
X
</a>
<a class="bookmarksLink ui-sortable-handle" onclick="$('a.bookmarksLink.selected').removeClass('selected');window.zoomToAndShowPortal('b37cd5a22bf9400a9f61e9987d54350f.16', [33.413419,-111.819297]);return false;">
Rock Art
</a>
</li>
<li class="bkmrk" id="id1451443119838">
<a class="bookmarksRemoveFrom" onclick="window.plugin.bookmarks.removeElement(this, 'portals');return false;" title="Remove from bookmarks">
X
</a>
<a class="bookmarksLink ui-sortable-handle selected" onclick="$('a.bookmarksLink.selected').removeClass('selected');window.zoomToAndShowPortal('04c1649d05094b07a257887e77e0c75b.12', [33.413536,-111.819615]);return false;">
LDS Temple
</a>
</li>
<li class="bkmrk" id="id1451443124242">
<a class="bookmarksRemoveFrom" onclick="window.plugin.bookmarks.removeElement(this, 'portals');return false;" title="Remove from bookmarks">
X
</a>
<a class="bookmarksLink ui-sortable-handle" onclick="$('a.bookmarksLink.selected').removeClass('selected');window.zoomToAndShowPortal('dab1ec1df02e47c0a35cc667cb52f820.16', [33.414022,-111.819811]);return false;">
Mesa Temple Visitors Center
</a>
</li>
<li class="bkmrk" id="id1451443130726">
<a class="bookmarksRemoveFrom" onclick="window.plugin.bookmarks.removeElement(this, 'portals');return false;" title="Remove from bookmarks">
X
</a>
<a class="bookmarksLink ui-sortable-handle" onclick="$('a.bookmarksLink.selected').removeClass('selected');window.zoomToAndShowPortal('d4c0d9fbc31846f7965bcba2be5a6359.16', [33.415321,-111.818677]);return false;">
Pioneer Park Southeast Entrance
</a>
</li>
<li class="bkmrk" id="id1451443135326">
<a class="bookmarksRemoveFrom" onclick="window.plugin.bookmarks.removeElement(this, 'portals');return false;" title="Remove from bookmarks">
X
</a>
<a class="bookmarksLink ui-sortable-handle" onclick="$('a.bookmarksLink.selected').removeClass('selected');window.zoomToAndShowPortal('eb409f2469ee4fae9b97e734e2426b78.12', [33.415333,-111.819566]);return false;">
Mesa Pioneer Monument
</a>
</li>
<li class="bkmrk" id="id1451443140853">
<a class="bookmarksRemoveFrom" onclick="window.plugin.bookmarks.removeElement(this, 'portals');return false;" title="Remove from bookmarks">
X
</a>
<a class="bookmarksLink ui-sortable-handle" onclick="$('a.bookmarksLink.selected').removeClass('selected');window.zoomToAndShowPortal('e29c7fd231d046578ae96798ee1a76d4.16', [33.415531,-111.819549]);return false;">
In Memory of Richard L. Love
</a>
</li>
<li class="bkmrk" id="id1451443143897">
<a class="bookmarksRemoveFrom" onclick="window.plugin.bookmarks.removeElement(this, 'portals');return false;" title="Remove from bookmarks">
X
</a>
<a class="bookmarksLink ui-sortable-handle" onclick="$('a.bookmarksLink.selected').removeClass('selected');window.zoomToAndShowPortal('1cd8b46a28aa44e496027ec172ed9ed7.16', [33.41579,-111.819139]);return false;">
Rufus Dog Plaque
</a>
</li>
<li class="bkmrk" id="id1451443147798">
<a class="bookmarksRemoveFrom" onclick="window.plugin.bookmarks.removeElement(this, 'portals');return false;" title="Remove from bookmarks">
X
</a>
<a class="bookmarksLink ui-sortable-handle" onclick="$('a.bookmarksLink.selected').removeClass('selected');window.zoomToAndShowPortal('ba37820215fa47fd924a1a4770385b08.12', [33.415866,-111.81955]);return false;">
Mesa
</a>
</li>
<li class="bkmrk" id="id1451443152188">
<a class="bookmarksRemoveFrom" onclick="window.plugin.bookmarks.removeElement(this, 'portals');return false;" title="Remove from bookmarks">
X
</a>
<a class="bookmarksLink ui-sortable-handle" onclick="$('a.bookmarksLink.selected').removeClass('selected');window.zoomToAndShowPortal('709559cdc85048f59bb4e81931f5df08.16', [33.415485,-111.820485]);return false;">
Designated dog exercise sign
</a>
</li>
<li class="bkmrk" id="id1451443161554">
<a class="bookmarksRemoveFrom" onclick="window.plugin.bookmarks.removeElement(this, 'portals');return false;" title="Remove from bookmarks">
X
</a>
<a class="bookmarksLink ui-sortable-handle" onclick="$('a.bookmarksLink.selected').removeClass('selected');window.zoomToAndShowPortal('e8c361a0abbd4f77ae8e25b0b4f3680a.16', [33.415072,-111.822193]);return false;">
Light Rail Art
</a>
</li>
<li class="bkmrk" id="id1451443165202">
<a class="bookmarksRemoveFrom" onclick="window.plugin.bookmarks.removeElement(this, 'portals');return false;" title="Remove from bookmarks">
X
</a>
<a class="bookmarksLink ui-sortable-handle" onclick="$('a.bookmarksLink.selected').removeClass('selected');window.zoomToAndShowPortal('7b1ca342e9a14c969beaa3dbf04ec03d.16', [33.41487,-111.823235]);return false;">
Family Fundamental Unit of Society
</a>
</li>
<li class="bkmrk" id="id1451443168660">
<a class="bookmarksRemoveFrom" onclick="window.plugin.bookmarks.removeElement(this, 'portals');return false;" title="Remove from bookmarks">
X
</a>
<a class="bookmarksLink ui-sortable-handle" onclick="$('a.bookmarksLink.selected').removeClass('selected');window.zoomToAndShowPortal('e1cdfa1cecdd4906887efec90e7ae6d1.16', [33.414117,-111.822824]);return false;">
Kids Need to Read
</a>
</li>
<li class="bkmrk" id="id1451443186859">
<a class="bookmarksRemoveFrom" onclick="window.plugin.bookmarks.removeElement(this, 'portals');return false;" title="Remove from bookmarks">
X
</a>
<a class="bookmarksLink ui-sortable-handle" onclick="$('a.bookmarksLink.selected').removeClass('selected');window.zoomToAndShowPortal('e0bd3527326c41868479e0fa24a1795d.16', [33.414913,-111.826434]);return false;">
Breaking Ground
</a>
</li>
<li class="bkmrk" id="id1451443191226">
<a class="bookmarksRemoveFrom" onclick="window.plugin.bookmarks.removeElement(this, 'portals');return false;" title="Remove from bookmarks">
X
</a>
<a class="bookmarksLink ui-sortable-handle" onclick="$('a.bookmarksLink.selected').removeClass('selected');window.zoomToAndShowPortal('df46746d50014da1bc2f18a13a7e29c1.11', [33.41487,-111.828647]);return false;">
Three Guys Sitting
</a>
</li>
<li class="bkmrk" id="id1451443196166">
<a class="bookmarksRemoveFrom" onclick="window.plugin.bookmarks.removeElement(this, 'portals');return false;" title="Remove from bookmarks">
X
</a>
<a class="bookmarksLink ui-sortable-handle" onclick="$('a.bookmarksLink.selected').removeClass('selected');window.zoomToAndShowPortal('a3a47593ed384ef98a4158439a726831.16', [33.414961,-111.82911]);return false;">
The Teacher
</a>
</li>
<li class="bkmrk" id="id1451443201886">
<a class="bookmarksRemoveFrom" onclick="window.plugin.bookmarks.removeElement(this, 'portals');return false;" title="Remove from bookmarks">
X
</a>
<a class="bookmarksLink ui-sortable-handle" onclick="$('a.bookmarksLink.selected').removeClass('selected');window.zoomToAndShowPortal('b0df74714f344c3aa5e95dcf3aca12b7.16', [33.415233,-111.829045]);return false;">
Fragments Of Support
</a>
</li>
<li class="bkmrk" id="id1451443206431">
<a class="bookmarksRemoveFrom" onclick="window.plugin.bookmarks.removeElement(this, 'portals');return false;" title="Remove from bookmarks">
X
</a>
<a class="bookmarksLink ui-sortable-handle" onclick="$('a.bookmarksLink.selected').removeClass('selected');window.zoomToAndShowPortal('305812558c7740dfb87eefe8c622c72e.16', [33.415972,-111.828646]);return false;">
Garden Chapel
</a>
</li>
<li class="bkmrk" id="id1451443216313">
<a class="bookmarksRemoveFrom" onclick="window.plugin.bookmarks.removeElement(this, 'portals');return false;" title="Remove from bookmarks">
X
</a>
<a class="bookmarksLink ui-sortable-handle" onclick="$('a.bookmarksLink.selected').removeClass('selected');window.zoomToAndShowPortal('e7a8ae4ae7f6435dbc30589f34ec1c02.11', [33.414932,-111.830515]);return false;">
Mesa Arts Center - Rainshelter Bus Stop
</a>
</li>
<li class="bkmrk" id="id1451443220344">
<a class="bookmarksRemoveFrom" onclick="window.plugin.bookmarks.removeElement(this, 'portals');return false;" title="Remove from bookmarks">
X
</a>
<a class="bookmarksLink ui-sortable-handle" onclick="$('a.bookmarksLink.selected').removeClass('selected');window.zoomToAndShowPortal('542278a39f2c4c9aa477be05753fdeb2.11', [33.415301,-111.830162]);return false;">
Girl with Helicopter Sculpture
</a>
</li>
</ul>
</li>
</ul>
</div>
<div style="border-bottom-width:1px;">
</div>
</div>
<select onchange="window.plugin.farmFind.changeLevel()" id="farm_level_select">
<option value="1">
Farm level 1
</option>
<option value="2">
Farm level 2
</option>
<option value="3">
Farm level 3
</option>
<option value="4">
Farm level 4
</option>
<option value="5">
Farm level 5
</option>
<option value="6">
Farm level 6
</option>
<option value="7">
Farm level 7
</option>
<option value="8">
Farm level 8
</option>
</select>
<iframe name="oauth2relay538136865" id="oauth2relay538136865" src="https://accounts.google.com/o/oauth2/postmessageRelay?parent=https%3A%2F%2Fwww.ingress.com#rpctoken=567837675&amp;forcesecure=1" tabindex="-1" style="width: 1px; height: 1px; position: absolute; top: -100px;">
</iframe>
<script id="hiddenlpsubmitdiv" style="display: none;">
</script>
<script>
try{(function() { for(var lastpass_iter=0; lastpass_iter
< document.forms.length; lastpass_iter++){ var lastpass_f = document.forms[lastpass_iter]; if(typeof(lastpass_f.lpsubmitorig2)=="undefined"){ lastpass_f.lpsubmitorig2 = lastpass_f.submit; if (typeof(lastpass_f.lpsubmitorig2)=='object'){ continue;}lastpass_f.submit = function(){ var form=this; var customEvent = document.createEvent("Event"); customEvent.initEvent("lpCustomEvent", true, true); var d = document.getElementById("hiddenlpsubmitdiv"); if (d) {for(var i = 0; i
< document.forms.length; i++){ if(document.forms[i]==form){ if (typeof(d.innerText) != 'undefined') { d.innerText=i.toString(); } else { d.textContent=i.toString(); } } } d.dispatchEvent(customEvent); }form.lpsubmitorig2(); } } }})()}catch(e){}
</script>
<div class="ui-dialog ui-widget ui-widget-content ui-corner-all ui-front ui-dialog-buttons ui-draggable ui-resizable" tabindex="-1" role="dialog" aria-describedby="dialog-plugin-mission-details-69d6cb72c73b453e9d9d0ab65c105853_1c" aria-labelledby="ui-id-214" style="position: absolute; height: auto; width: 450px; top: 75px; left: 58px; display: block; z-index: 10002;">
<div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix ui-draggable-handle">
<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-icon-only ui-dialog-titlebar-close ui-dialog-titlebar-button ui-dialog-titlebar-button-collapse ui-dialog-titlebar-button-collapse-collapsed" role="button">
<span class="ui-button-icon-primary ui-icon ui-icon-closethick">
</span>
<span class="ui-button-text">
&nbsp;
</span>
</button>
<span id="ui-id-214" class="ui-dialog-title ui-dialog-title-active">
Mesa Temple &amp; Visitors Center
</span>
<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-icon-only ui-dialog-titlebar-close ui-dialog-titlebar-button ui-dialog-titlebar-button-close" role="button">
<span class="ui-button-icon-primary ui-icon ui-icon-closethick">
</span>
<span class="ui-button-text">
&nbsp;
</span>
</button>
</div>
<div id="dialog-plugin-mission-details-69d6cb72c73b453e9d9d0ab65c105853_1c" class="ui-dialog-content ui-widget-content" style="width: auto; min-height: 68px; max-height: none; height: auto; display: none;">
<div class="plugin-mission-details">
<div class="plugin-mission-summary" data-mission_mid="69d6cb72c73b453e9d9d0ab65c105853.1c">
<img src="https://lh5.ggpht.com/c5qKHLRFJxDG3X3jCoBeU8UCiDTmwounLQi3iQiEt-frnezxUOJitJTusQTxHb9u7Upf7BZ-LWdG_MDdaJGm">
<a href="/mission/69d6cb72c73b453e9d9d0ab65c105853.1c">
Mesa Temple &amp; Visitors Center
</a>
<span class="nickname enl help" title="
<span style=&quot;color: rgb(3, 254, 3)&quot;>
MarisaAZ
</span>
Min player level:
<span style=&quot;display:inline-block;padding:4px;color:white;background-color:#FECE5A&quot;>
1
</span>
">
MarisaAZ
</span>
<span class="plugin-mission-info length help" title="Length of this mission.
NOTE: The actual distance required to cover may vary depending on several factors!">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASAQMAAABsABwUAAAABlBMVEUAAACy+/gnk9HpAAAAAXRSTlMAQObYZgAAABVJREFUCNdjYEADB9Dg//8QjA7RAAB2VBF9TkATUAAAAABJRU5ErkJggg==">
369.2m
</span>
<span class="plugin-mission-info distance help" title="Distance to this mission. Click to update.">
<span class="portal-distance-bearing" style="transform: rotate(164deg);">
</span>
3.8km
</span>
<br>
<span class="plugin-mission-info time help" title="Typical duration">
<img src="https://commondatastorage.googleapis.com/ingress.com/img/tm_icons/time.png">
10m 24s
</span>
<span class="plugin-mission-info rating help" title="Average rating">
<img src="https://commondatastorage.googleapis.com/ingress.com/img/tm_icons/like.png">
96.77%
</span>
<span class="plugin-mission-info players help" title="Unique players who have completed this mission">
<img src="https://commondatastorage.googleapis.com/ingress.com/img/tm_icons/players.png">
58
</span>
<span class="plugin-mission-info waypoints help" title="Non Sequential mission with 7 waypoints">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASAQMAAABsABwUAAAABlBMVEUAAACy+/gnk9HpAAAAAXRSTlMAQObYZgAAAClJREFUCNdjYACBB0gYCBgFIJiJA4JZWCCYgwmCQaCA8QBD+d8DYBoIAN15B5HS9gdlAAAAAElFTkSuQmCC">
7
</span>
<p class="description">
Hack the area surrounding the Mesa Arizona Temple, which was the first LDS temple built in Arizona.
</p>
</div>
<ol>
<li class="plugin-mission-waypoint">
<div class="plugin-mission-portal-indicator help res" title="Level:   3
Resonators: 8
Health: 85%">
3
<div style="transform: rotate(0deg);">
</div>
<div style="transform: rotate(45deg);">
</div>
<div style="transform: rotate(90deg);">
</div>
<div style="transform: rotate(135deg);">
</div>
<div style="transform: rotate(180deg);">
</div>
<div style="transform: rotate(225deg);">
</div>
<div style="transform: rotate(270deg);">
</div>
<div style="transform: rotate(315deg);">
</div>
</div>
<a href="/intel?ll=33.413225,-111.81999&amp;z=17&amp;pll=33.413225,-111.81999" class="title">
Petrified Wood Monument II
</a>
<label>
<input type="checkbox" data-mission_mwpid="69d6cb72c73b453e9d9d0ab65c105853.1c-0-07d512d6ffcf4e9b8ccaec6912ab81f4.16">
<span>
Hack this Portal
</span>
</label>
</li>
<li class="plugin-mission-waypoint">
<div class="plugin-mission-portal-indicator help res" title="Level:   2
Resonators: 8
Health: 85%">
2
<div style="transform: rotate(0deg);">
</div>
<div style="transform: rotate(45deg);">
</div>
<div style="transform: rotate(90deg);">
</div>
<div style="transform: rotate(135deg);">
</div>
<div style="transform: rotate(180deg);">
</div>
<div style="transform: rotate(225deg);">
</div>
<div style="transform: rotate(270deg);">
</div>
<div style="transform: rotate(315deg);">
</div>
</div>
<a href="/intel?ll=33.412869,-111.820521&amp;z=17&amp;pll=33.412869,-111.820521" class="title">
Mesa Arizona Temple
</a>
<label>
<input type="checkbox" data-mission_mwpid="69d6cb72c73b453e9d9d0ab65c105853.1c-1-7c23c7e50498488a9c6b3e846d05b2d6.12">
<span>
Hack this Portal
</span>
</label>
</li>
<li class="plugin-mission-waypoint">
<div class="plugin-mission-portal-indicator help res" title="Level:    4
Resonators: 8
Health: 85%">
4
<div style="transform: rotate(0deg);">
</div>
<div style="transform: rotate(45deg);">
</div>
<div style="transform: rotate(90deg);">
</div>
<div style="transform: rotate(135deg);">
</div>
<div style="transform: rotate(180deg);">
</div>
<div style="transform: rotate(225deg);">
</div>
<div style="transform: rotate(270deg);">
</div>
<div style="transform: rotate(315deg);">
</div>
</div>
<a href="/intel?ll=33.41312,-111.820296&amp;z=17&amp;pll=33.41312,-111.820296" class="title">
Mesa Arizona Temple
</a>
<label>
<input type="checkbox" data-mission_mwpid="69d6cb72c73b453e9d9d0ab65c105853.1c-2-3e202a01bab0403c83c3077deb44fafa.12">
<span>
Hack this Portal
</span>
</label>
</li>
<li class="plugin-mission-waypoint">
<div class="plugin-mission-portal-indicator help enl" title="Level:  5
Resonators: 7
Health: 20%">
5
<div style="transform: rotate(0deg);">
</div>
<div style="transform: rotate(45deg);">
</div>
<div style="transform: rotate(90deg);">
</div>
<div style="transform: rotate(135deg);">
</div>
<div style="transform: rotate(180deg);">
</div>
<div style="transform: rotate(225deg);">
</div>
<div style="transform: rotate(270deg);">
</div>
</div>
<a href="/intel?ll=33.414022,-111.819811&amp;z=17&amp;pll=33.414022,-111.819811" class="title">
Mesa Temple Visitors Center
</a>
<label>
<input type="checkbox" data-mission_mwpid="69d6cb72c73b453e9d9d0ab65c105853.1c-3-dab1ec1df02e47c0a35cc667cb52f820.16">
<span>
Hack this Portal
</span>
</label>
</li>
<li class="plugin-mission-waypoint">
<div class="plugin-mission-portal-indicator help enl" title="Level:  5
Resonators: 7
Health: 12%">
5
<div style="transform: rotate(0deg);">
</div>
<div style="transform: rotate(45deg);">
</div>
<div style="transform: rotate(90deg);">
</div>
<div style="transform: rotate(135deg);">
</div>
<div style="transform: rotate(180deg);">
</div>
<div style="transform: rotate(225deg);">
</div>
<div style="transform: rotate(270deg);">
</div>
</div>
<a href="/intel?ll=33.413419,-111.819297&amp;z=17&amp;pll=33.413419,-111.819297" class="title">
Rock Art
</a>
<label>
<input type="checkbox" data-mission_mwpid="69d6cb72c73b453e9d9d0ab65c105853.1c-4-b37cd5a22bf9400a9f61e9987d54350f.16">
<span>
Hack this Portal
</span>
</label>
</li>
<li class="plugin-mission-waypoint">
<div class="plugin-mission-portal-indicator help enl" title="Level: 6
Resonators: 8
Health: 20%">
6
<div style="transform: rotate(0deg);">
</div>
<div style="transform: rotate(45deg);">
</div>
<div style="transform: rotate(90deg);">
</div>
<div style="transform: rotate(135deg);">
</div>
<div style="transform: rotate(180deg);">
</div>
<div style="transform: rotate(225deg);">
</div>
<div style="transform: rotate(270deg);">
</div>
<div style="transform: rotate(315deg);">
</div>
</div>
<a href="/intel?ll=33.413219,-111.819695&amp;z=17&amp;pll=33.413219,-111.819695" class="title">
Large Fountain
</a>
<label>
<input type="checkbox" data-mission_mwpid="69d6cb72c73b453e9d9d0ab65c105853.1c-5-d7db95c0c92044ac8189bbd3108d2964.16">
<span>
Hack this Portal
</span>
</label>
</li>
<li class="plugin-mission-waypoint">
<div class="plugin-mission-portal-indicator help enl" title="Level: 2
Resonators: 3
Health: 94%">
2
<div style="transform: rotate(0deg);">
</div>
<div style="transform: rotate(45deg);">
</div>
<div style="transform: rotate(90deg);">
</div>
</div>
<a href="/intel?ll=33.413536,-111.819615&amp;z=17&amp;pll=33.413536,-111.819615" class="title">
LDS Temple
</a>
<label>
<input type="checkbox" data-mission_mwpid="69d6cb72c73b453e9d9d0ab65c105853.1c-6-04c1649d05094b07a257887e77e0c75b.12">
<span>
Hack this Portal
</span>
</label>
</li>
</ol>
</div>
</div>
<div class="ui-resizable-handle ui-resizable-n" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-e" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-s" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-w" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-se ui-icon ui-icon-gripsmall-diagonal-se" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-sw" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-ne" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-nw" style="z-index: 90;">
</div>
<div class="ui-dialog-buttonpane ui-widget-content ui-helper-clearfix" style="display: none;">
<div class="ui-dialog-buttonset">
<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" role="button">
<span class="ui-button-text">
Zoom to mission
</span>
</button>
<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" role="button">
<span class="ui-button-text">
OK
</span>
</button>
</div>
</div>
</div>
<div role="log" aria-live="assertive" aria-relevant="additions" class="ui-helper-hidden-accessible">
<div style="display: none;">
<span style="color: rgb(3, 254, 3)">
MarisaAZ
</span>
<br>
Min player level:
<span style="display:inline-block;padding:4px;color:white;background-color:#FECE5A">
1
</span>
</div>
<div style="display: none;">
<span style="color: rgb(3, 254, 3)">
MarisaAZ
</span>
<br>
Min player level:
<span style="display:inline-block;padding:4px;color:white;background-color:#FECE5A">
1
</span>
</div>
<div style="display: none;">
<span style="color: rgb(3, 254, 3)">
MarisaAZ
</span>
<br>
Min player level:
<span style="display:inline-block;padding:4px;color:white;background-color:#FECE5A">
1
</span>
</div>
<div style="display: none;">
<span style="color: rgb(3, 254, 3)">
MarisaAZ
</span>
<br>
Min player level:
<span style="display:inline-block;padding:4px;color:white;background-color:#FECE5A">
1
</span>
</div>
<div style="display: none;">
<span style="color: rgb(3, 254, 3)">
MarisaAZ
</span>
<br>
Min player level:
<span style="display:inline-block;padding:4px;color:white;background-color:#FECE5A">
1
</span>
</div>
<div>
<span style="color: rgb(3, 254, 3)">
MarisaAZ
</span>
<br>
Min player level:
<span style="display:inline-block;padding:4px;color:white;background-color:#FECE5A">
1
</span>
</div>
</div>
<div class="ui-dialog ui-widget ui-widget-content ui-corner-all ui-front ui-dialog-buttons ui-draggable ui-resizable" tabindex="-1" role="dialog" aria-describedby="dialog-anon-2" aria-labelledby="ui-id-273" style="position: absolute; height: auto; width: 400px; top: 164px; left: 1032px; display: block; z-index: 10017;">
<div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix ui-draggable-handle">
<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-icon-only ui-dialog-titlebar-close ui-dialog-titlebar-button ui-dialog-titlebar-button-collapse ui-dialog-titlebar-button-collapse-expanded" role="button">
<span class="ui-button-icon-primary ui-icon ui-icon-closethick">
</span>
<span class="ui-button-text">
&nbsp;
</span>
</button>
<span id="ui-id-273" class="ui-dialog-title ui-dialog-title-active">
&nbsp;
</span>
<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-icon-only ui-dialog-titlebar-close ui-dialog-titlebar-button ui-dialog-titlebar-button-close" role="button">
<span class="ui-button-icon-primary ui-icon ui-icon-closethick">
</span>
<span class="ui-button-text">
&nbsp;
</span>
</button>
</div>
<div id="dialog-anon-2" class="ui-dialog-content ui-widget-content" style="width: auto; min-height: 68px; max-height: none; height: auto;">
<div>
<div class="plugin-mission-summary" data-mission_mid="cc5aabba235d4f2ca938999ba15ba12a.1c">
<img src="https://lh3.ggpht.com/8iXne_UWccJCWINCTCoHS3dBUhR823vT5N3FMpud5MzK4K8Ms7M_-8eX56TTvCwi7SLdrvgMwl2r5iYfdPM">
<a href="/mission/cc5aabba235d4f2ca938999ba15ba12a.1c">
Arizona Museum of Natural History
</a>
<br>
<span class="plugin-mission-info time help" title="Typical duration">
<img src="https://commondatastorage.googleapis.com/ingress.com/img/tm_icons/time.png">
06m 46s
</span>
<span class="plugin-mission-info rating help" title="Average rating">
<img src="https://commondatastorage.googleapis.com/ingress.com/img/tm_icons/like.png">
98.49%
</span>
</div>
<div class="plugin-mission-summary" data-mission_mid="69d6cb72c73b453e9d9d0ab65c105853.1c">
<img src="https://lh5.ggpht.com/c5qKHLRFJxDG3X3jCoBeU8UCiDTmwounLQi3iQiEt-frnezxUOJitJTusQTxHb9u7Upf7BZ-LWdG_MDdaJGm">
<a href="/mission/69d6cb72c73b453e9d9d0ab65c105853.1c">
Mesa Temple &amp; Visitors Center
</a>
<span class="nickname enl">
MarisaAZ
</span>
<span class="plugin-mission-info length help" title="Length of this mission.
NOTE: The actual distance required to cover may vary depending on several factors!">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASAQMAAABsABwUAAAABlBMVEUAAACy+/gnk9HpAAAAAXRSTlMAQObYZgAAABVJREFUCNdjYEADB9Dg//8QjA7RAAB2VBF9TkATUAAAAABJRU5ErkJggg==">
369.2m
</span>
<span class="plugin-mission-info distance help" title="Distance to this mission. Click to update.">
<span class="portal-distance-bearing" style="transform: rotate(164deg);">
</span>
3.8km
</span>
<br>
<span class="plugin-mission-info time help" title="Typical duration">
<img src="https://commondatastorage.googleapis.com/ingress.com/img/tm_icons/time.png">
10m 24s
</span>
<span class="plugin-mission-info rating help" title="Average rating">
<img src="https://commondatastorage.googleapis.com/ingress.com/img/tm_icons/like.png">
96.77%
</span>
<span class="plugin-mission-info players help" title="Unique players who have completed this mission">
<img src="https://commondatastorage.googleapis.com/ingress.com/img/tm_icons/players.png">
58
</span>
<span class="plugin-mission-info waypoints help" title="Non Sequential mission with 7 waypoints">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASAQMAAABsABwUAAAABlBMVEUAAACy+/gnk9HpAAAAAXRSTlMAQObYZgAAAClJREFUCNdjYACBB0gYCBgFIJiJA4JZWCCYgwmCQaCA8QBD+d8DYBoIAN15B5HS9gdlAAAAAElFTkSuQmCC">
7
</span>
</div>
<div class="plugin-mission-summary" data-mission_mid="5003938dfcbf4eaa80f5f664c8a5ad64.1c">
<img src="https://lh6.ggpht.com/Mh5oxl8Ye4VtniaHyzxwanwhqElU3kp66MP3IDlI4q_0JWt1WLvZpTAlVyiVhkL7FXhIAATRrU9rfeVfpNLn">
<a href="/mission/5003938dfcbf4eaa80f5f664c8a5ad64.1c">
Mesa Arts Center
</a>
<br>
<span class="plugin-mission-info time help" title="Typical duration">
<img src="https://commondatastorage.googleapis.com/ingress.com/img/tm_icons/time.png">
15m 11s
</span>
<span class="plugin-mission-info rating help" title="Average rating">
<img src="https://commondatastorage.googleapis.com/ingress.com/img/tm_icons/like.png">
96.03%
</span>
</div>
<div class="plugin-mission-summary" data-mission_mid="c4b90cbf43594a14840af11972a0465c.1c">
<img src="https://lh3.googleusercontent.com/1cAnJK-0qIwMRw51hj5SKz84FVRDbvU6B424m6chQ13MDaA_2ywxVepmynyUm1TxQAp-C-fjW-ZV0D242iO-">
<a href="/mission/c4b90cbf43594a14840af11972a0465c.1c">
Mesa Temple 5
</a>
<br>
<span class="plugin-mission-info time help" title="Typical duration">
<img src="https://commondatastorage.googleapis.com/ingress.com/img/tm_icons/time.png">
11m 41s
</span>
<span class="plugin-mission-info rating help" title="Average rating">
<img src="https://commondatastorage.googleapis.com/ingress.com/img/tm_icons/like.png">
95.12%
</span>
</div>
<div class="plugin-mission-summary" data-mission_mid="44920a6cc7c049aba555465753028937.1c">
<img src="https://lh3.ggpht.com/Zq7huZZc7xb-5iojeZYB0YimSMnUS4oy4Rh5W2lXEJaDeobR96Xjwbmp1T6SDNtriEOY5bIU8Nr0oRfXu-Li">
<a href="/mission/44920a6cc7c049aba555465753028937.1c">
Mesa Central Public Library
</a>
<br>
<span class="plugin-mission-info time help" title="Typical duration">
<img src="https://commondatastorage.googleapis.com/ingress.com/img/tm_icons/time.png">
11m 35s
</span>
<span class="plugin-mission-info rating help" title="Average rating">
<img src="https://commondatastorage.googleapis.com/ingress.com/img/tm_icons/like.png">
94.28%
</span>
</div>
<div class="plugin-mission-summary" data-mission_mid="6fb803e3c3164a56859238c6d1e2a90e.1c">
<img src="https://lh3.googleusercontent.com/oQeYOOx2FCZa2NAoHEPcsAchPM-RPol7Bz_0H3QTi6_yfk6IZXZVgOBPGG4OoTnWzmu5iOwCUZjno5y5gT8q">
<a href="/mission/6fb803e3c3164a56859238c6d1e2a90e.1c">
KOL CON
</a>
<br>
<span class="plugin-mission-info time help" title="Typical duration">
<img src="https://commondatastorage.googleapis.com/ingress.com/img/tm_icons/time.png">
08m 44s
</span>
<span class="plugin-mission-info rating help" title="Average rating">
<img src="https://commondatastorage.googleapis.com/ingress.com/img/tm_icons/like.png">
93.93%
</span>
</div>
<div class="plugin-mission-summary" data-mission_mid="4cfd9235a9964930ab20eb3e53fda760.1c">
<img src="https://lh3.googleusercontent.com/RQ3l4t0mPmuSPNnsc4YN9notK2DXRzFohv0dwmcY46WxEfJzwQB3yDKAhfb9ESVt4y2afGbmZOYMtnPmyto">
<a href="/mission/4cfd9235a9964930ab20eb3e53fda760.1c">
Mesa Art Center
</a>
<br>
<span class="plugin-mission-info time help" title="Typical duration">
<img src="https://commondatastorage.googleapis.com/ingress.com/img/tm_icons/time.png">
13m 18s
</span>
<span class="plugin-mission-info rating help" title="Average rating">
<img src="https://commondatastorage.googleapis.com/ingress.com/img/tm_icons/like.png">
92.98%
</span>
</div>
<div class="plugin-mission-summary" data-mission_mid="34dccbb4920e40229b2e000a5a96359c.1c">
<img src="https://lh3.googleusercontent.com/j_Bqe3zG03r1ct7RJUGaCO93qpXNo5jVJ9Do3gOZ3FQ8ETCf1qTQF-9Cp_ccpkLHfaby_7ENDfKNd3XmMFmq">
<a href="/mission/34dccbb4920e40229b2e000a5a96359c.1c">
Mesa Temple 3
</a>
<br>
<span class="plugin-mission-info time help" title="Typical duration">
<img src="https://commondatastorage.googleapis.com/ingress.com/img/tm_icons/time.png">
07m 01s
</span>
<span class="plugin-mission-info rating help" title="Average rating">
<img src="https://commondatastorage.googleapis.com/ingress.com/img/tm_icons/like.png">
90.69%
</span>
</div>
<div class="plugin-mission-summary" data-mission_mid="05cd6a595d4d4960957cfcac50487386.1c">
<img src="https://lh3.googleusercontent.com/EunDhOkOw-b77x-nhLHhSCrFPwaMuwBQWxo59W6d8F6nlf4SmmUYCD3o_xsRjesvi83zj55-a2N7D7COhHk">
<a href="/mission/05cd6a595d4d4960957cfcac50487386.1c">
Mesa Temple 6
</a>
<br>
<span class="plugin-mission-info time help" title="Typical duration">
<img src="https://commondatastorage.googleapis.com/ingress.com/img/tm_icons/time.png">
04m 54s
</span>
<span class="plugin-mission-info rating help" title="Average rating">
<img src="https://commondatastorage.googleapis.com/ingress.com/img/tm_icons/like.png">
90.38%
</span>
</div>
<div class="plugin-mission-summary" data-mission_mid="8f0d8aefc9f24ea0b077524086bc6ecd.1c">
<img src="https://lh3.googleusercontent.com/hZTpS0WCRAfAPqjBLNoazjeqU1sg62_dLCqW7w-PUUkgjxMk8g2qJ3ut-hm9InqJekPhmQP_6ex8ZkuVtA5S">
<a href="/mission/8f0d8aefc9f24ea0b077524086bc6ecd.1c">
Mesa Temple 1
</a>
<br>
<span class="plugin-mission-info time help" title="Typical duration">
<img src="https://commondatastorage.googleapis.com/ingress.com/img/tm_icons/time.png">
07m 23s
</span>
<span class="plugin-mission-info rating help" title="Average rating">
<img src="https://commondatastorage.googleapis.com/ingress.com/img/tm_icons/like.png">
88.63%
</span>
</div>
<div class="plugin-mission-summary" data-mission_mid="690edd93b3614519ad4346a7260fd54e.1c">
<img src="https://lh3.googleusercontent.com/LiXfzvx2lhLX2vHVvQEYJIfURN_24ib0vQkLO92BksKXxkrwHMGyA1UrOMEWbhXmETLnCX-RuN7_CdxYwb4">
<a href="/mission/690edd93b3614519ad4346a7260fd54e.1c">
Philosoraptor
</a>
<br>
<span class="plugin-mission-info time help" title="Typical duration">
<img src="https://commondatastorage.googleapis.com/ingress.com/img/tm_icons/time.png">
11m 36s
</span>
<span class="plugin-mission-info rating help" title="Average rating">
<img src="https://commondatastorage.googleapis.com/ingress.com/img/tm_icons/like.png">
86.84%
</span>
</div>
<div class="plugin-mission-summary" data-mission_mid="5a88f32afda249e4a7ebc59336a9fd5d.1c">
<img src="https://lh3.googleusercontent.com/czuPifZq_0q6MOOL9UQG7PelWgTVAPooIvo6bJTrJe8SO3Yh9lmKwP2dJq81H97UA3qG4FzzED82b6pLzo5m7g">
<a href="/mission/5a88f32afda249e4a7ebc59336a9fd5d.1c">
Mesa Temple 4
</a>
<br>
<span class="plugin-mission-info time help" title="Typical duration">
<img src="https://commondatastorage.googleapis.com/ingress.com/img/tm_icons/time.png">
08m 54s
</span>
<span class="plugin-mission-info rating help" title="Average rating">
<img src="https://commondatastorage.googleapis.com/ingress.com/img/tm_icons/like.png">
86.66%
</span>
</div>
<div class="plugin-mission-summary" data-mission_mid="ea6ad1d32e7943d7b2243ae8271103ab.1c">
<img src="https://lh3.googleusercontent.com/qdOh1LqdFnzWCdnkb5JW58zyTXlh8OVtvBzbsOEqgK7B6mkSUeTdPexwQdXYhv41z50rkSfQjGZqlBiEIH3o">
<a href="/mission/ea6ad1d32e7943d7b2243ae8271103ab.1c">
City of Mesa
</a>
<br>
<span class="plugin-mission-info time help" title="Typical duration">
<img src="https://commondatastorage.googleapis.com/ingress.com/img/tm_icons/time.png">
06m 01s
</span>
<span class="plugin-mission-info rating help" title="Average rating">
<img src="https://commondatastorage.googleapis.com/ingress.com/img/tm_icons/like.png">
83.6%
</span>
</div>
<div class="plugin-mission-summary" data-mission_mid="c0681f51241a4ae6854873e457ebc292.1c">
<img src="https://lh3.googleusercontent.com/ARy8GFY992YUqovAoGVvWWJmwjwqB9bSmJzI29bmRBzwlnHZFKoF1GNa0aVAmEYRS51iFHuEXmO8_9_1BPu8">
<a href="/mission/c0681f51241a4ae6854873e457ebc292.1c">
Mesa Temple 2
</a>
<br>
<span class="plugin-mission-info time help" title="Typical duration">
<img src="https://commondatastorage.googleapis.com/ingress.com/img/tm_icons/time.png">
15m 22s
</span>
<span class="plugin-mission-info rating help" title="Average rating">
<img src="https://commondatastorage.googleapis.com/ingress.com/img/tm_icons/like.png">
82.97%
</span>
</div>
<div class="plugin-mission-summary" data-mission_mid="a1cdce79d5fe43649c5ef9e22aa18e76.1c">
<img src="https://lh5.ggpht.com/NzDFG9M8g60uBEcu6bB97FCDMAYdJK_HgELNamcWY914ZKBFU6NgRt-HJE3t-viFQ1ptbPehh3NQSzzx-SPT">
<a href="/mission/a1cdce79d5fe43649c5ef9e22aa18e76.1c">
Downtown Mesa Scavenger Hunt
</a>
<br>
<span class="plugin-mission-info time help" title="Typical duration">
<img src="https://commondatastorage.googleapis.com/ingress.com/img/tm_icons/time.png">
02h 25m 41s
</span>
<span class="plugin-mission-info rating help" title="Average rating">
<img src="https://commondatastorage.googleapis.com/ingress.com/img/tm_icons/like.png">
68.96%
</span>
</div>
</div>
</div>
<div class="ui-resizable-handle ui-resizable-n" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-e" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-s" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-w" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-se ui-icon ui-icon-gripsmall-diagonal-se" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-sw" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-ne" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-nw" style="z-index: 90;">
</div>
<div class="ui-dialog-buttonpane ui-widget-content ui-helper-clearfix">
<div class="ui-dialog-buttonset">
<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" role="button">
<span class="ui-button-text">
Create new mission
</span>
</button>
<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" role="button">
<span class="ui-button-text">
OK
</span>
</button>
</div>
</div>
</div>
<div class="ui-dialog ui-widget ui-widget-content ui-corner-all ui-front ui-dialog-buttons ui-draggable ui-resizable" tabindex="-1" role="dialog" aria-describedby="dialog-plugin-mission-details-c0681f51241a4ae6854873e457ebc292_1c" aria-labelledby="ui-id-292" style="position: absolute; height: auto; width: 450px; top: 100px; left: 510px; display: block; z-index: 10006;">
<div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix ui-draggable-handle">
<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-icon-only ui-dialog-titlebar-close ui-dialog-titlebar-button ui-dialog-titlebar-button-collapse ui-dialog-titlebar-button-collapse-collapsed" role="button">
<span class="ui-button-icon-primary ui-icon ui-icon-closethick">
</span>
<span class="ui-button-text">
&nbsp;
</span>
</button>
<span id="ui-id-292" class="ui-dialog-title ui-dialog-title-active">
Mesa Temple 2
</span>
<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-icon-only ui-dialog-titlebar-close ui-dialog-titlebar-button ui-dialog-titlebar-button-close" role="button">
<span class="ui-button-icon-primary ui-icon ui-icon-closethick">
</span>
<span class="ui-button-text">
&nbsp;
</span>
</button>
</div>
<div id="dialog-plugin-mission-details-c0681f51241a4ae6854873e457ebc292_1c" class="ui-dialog-content ui-widget-content" style="width: auto; min-height: 68px; max-height: none; height: auto; display: none;">
<div class="plugin-mission-details">
<div class="plugin-mission-summary" data-mission_mid="c0681f51241a4ae6854873e457ebc292.1c">
<img src="https://lh3.googleusercontent.com/ARy8GFY992YUqovAoGVvWWJmwjwqB9bSmJzI29bmRBzwlnHZFKoF1GNa0aVAmEYRS51iFHuEXmO8_9_1BPu8">
<a href="/mission/c0681f51241a4ae6854873e457ebc292.1c">
Mesa Temple 2
</a>
<span class="nickname enl">
JoeSpr0ckEt
</span>
<span class="plugin-mission-info length help" title="Length of this mission.
NOTE: The actual distance required to cover may vary depending on several factors!">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASAQMAAABsABwUAAAABlBMVEUAAACy+/gnk9HpAAAAAXRSTlMAQObYZgAAABVJREFUCNdjYEADB9Dg//8QjA7RAAB2VBF9TkATUAAAAABJRU5ErkJggg==">
524.1m
</span>
<span class="plugin-mission-info distance help" title="Distance to this mission. Click to update.">
<span class="portal-distance-bearing" style="transform: rotate(164deg);">
</span>
3.8km
</span>
<br>
<span class="plugin-mission-info time help" title="Typical duration">
<img src="https://commondatastorage.googleapis.com/ingress.com/img/tm_icons/time.png">
15m 22s
</span>
<span class="plugin-mission-info rating help" title="Average rating">
<img src="https://commondatastorage.googleapis.com/ingress.com/img/tm_icons/like.png">
82.97%
</span>
<span class="plugin-mission-info players help" title="Unique players who have completed this mission">
<img src="https://commondatastorage.googleapis.com/ingress.com/img/tm_icons/players.png">
44
</span>
<span class="plugin-mission-info waypoints help" title="Non Sequential mission with 6 waypoints">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASAQMAAABsABwUAAAABlBMVEUAAACy+/gnk9HpAAAAAXRSTlMAQObYZgAAAClJREFUCNdjYACBB0gYCBgFIJiJA4JZWCCYgwmCQaCA8QBD+d8DYBoIAN15B5HS9gdlAAAAAElFTkSuQmCC">
6
</span>
<p class="description">
Portals and points of interest near Mesa Arizona Mormon Temple
</p>
</div>
<ol>
<li class="plugin-mission-waypoint">
<div class="plugin-mission-portal-indicator help enl" title="Level:    5
Resonators: 7
Health: 20%">
5
<div style="transform: rotate(0deg);">
</div>
<div style="transform: rotate(45deg);">
</div>
<div style="transform: rotate(90deg);">
</div>
<div style="transform: rotate(135deg);">
</div>
<div style="transform: rotate(180deg);">
</div>
<div style="transform: rotate(225deg);">
</div>
<div style="transform: rotate(270deg);">
</div>
</div>
<a href="/intel?ll=33.414022,-111.819811&amp;z=17&amp;pll=33.414022,-111.819811" class="title">
Mesa Temple Visitors Center
</a>
<label>
<input type="checkbox" data-mission_mwpid="c0681f51241a4ae6854873e457ebc292.1c-0-dab1ec1df02e47c0a35cc667cb52f820.16">
<span>
Hack this Portal
</span>
</label>
</li>
<li class="plugin-mission-waypoint">
<div class="plugin-mission-portal-indicator help res" title="Level:  1
Resonators: 1
Health: 85%">
1
<div style="transform: rotate(0deg);">
</div>
</div>
<a href="/intel?ll=33.412731,-111.819333&amp;z=17&amp;pll=33.412731,-111.819333" class="title">
Lion Head Fountain
</a>
<label>
<input type="checkbox" data-mission_mwpid="c0681f51241a4ae6854873e457ebc292.1c-1-1f2e2a6cd3bd4065960ee6e82130cb1b.16">
<span>
Hack this Portal
</span>
</label>
</li>
<li class="plugin-mission-waypoint">
<div class="plugin-mission-portal-indicator help res" title="Level: 1
Resonators: 1
Health: 85%">
1
<div style="transform: rotate(0deg);">
</div>
</div>
<a href="/intel?ll=33.412833,-111.819642&amp;z=17&amp;pll=33.412833,-111.819642" class="title">
House of the Lord Temple
</a>
<label>
<input type="checkbox" data-mission_mwpid="c0681f51241a4ae6854873e457ebc292.1c-2-387621e83a97491fb2a3af0d122278bd.12">
<span>
Hack this Portal
</span>
</label>
</li>
<li class="plugin-mission-waypoint">
<div class="plugin-mission-portal-indicator help res" title="Level:   2
Resonators: 8
Health: 85%">
2
<div style="transform: rotate(0deg);">
</div>
<div style="transform: rotate(45deg);">
</div>
<div style="transform: rotate(90deg);">
</div>
<div style="transform: rotate(135deg);">
</div>
<div style="transform: rotate(180deg);">
</div>
<div style="transform: rotate(225deg);">
</div>
<div style="transform: rotate(270deg);">
</div>
<div style="transform: rotate(315deg);">
</div>
</div>
<a href="/intel?ll=33.412869,-111.820521&amp;z=17&amp;pll=33.412869,-111.820521" class="title">
Mesa Arizona Temple
</a>
<label>
<input type="checkbox" data-mission_mwpid="c0681f51241a4ae6854873e457ebc292.1c-3-7c23c7e50498488a9c6b3e846d05b2d6.12">
<span>
Hack this Portal
</span>
</label>
</li>
<li class="plugin-mission-waypoint">
<div class="plugin-mission-portal-indicator help enl" title="Level:    3
Resonators: 4
Health: 10%">
3
<div style="transform: rotate(0deg);">
</div>
<div style="transform: rotate(45deg);">
</div>
<div style="transform: rotate(90deg);">
</div>
<div style="transform: rotate(135deg);">
</div>
</div>
<a href="/intel?ll=33.411685,-111.819357&amp;z=17&amp;pll=33.411685,-111.819357" class="title">
Mesa Temple Spire
</a>
<label>
<input type="checkbox" data-mission_mwpid="c0681f51241a4ae6854873e457ebc292.1c-4-938314152400458b8459b495c4ee538f.16">
<span>
Hack this Portal
</span>
</label>
</li>
<li class="plugin-mission-waypoint">
<div class="plugin-mission-portal-indicator help enl" title="Level:  5
Resonators: 8
Health: 25%">
5
<div style="transform: rotate(0deg);">
</div>
<div style="transform: rotate(45deg);">
</div>
<div style="transform: rotate(90deg);">
</div>
<div style="transform: rotate(135deg);">
</div>
<div style="transform: rotate(180deg);">
</div>
<div style="transform: rotate(225deg);">
</div>
<div style="transform: rotate(270deg);">
</div>
<div style="transform: rotate(315deg);">
</div>
</div>
<a href="/intel?ll=33.411036,-111.81996&amp;z=17&amp;pll=33.411036,-111.81996" class="title">
Church
</a>
<label>
<input type="checkbox" data-mission_mwpid="c0681f51241a4ae6854873e457ebc292.1c-5-3d31ec4a7ce14535ab319e1a4aa0b2a9.16">
<span>
Hack this Portal
</span>
</label>
</li>
</ol>
</div>
</div>
<div class="ui-resizable-handle ui-resizable-n" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-e" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-s" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-w" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-se ui-icon ui-icon-gripsmall-diagonal-se" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-sw" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-ne" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-nw" style="z-index: 90;">
</div>
<div class="ui-dialog-buttonpane ui-widget-content ui-helper-clearfix" style="display: none;">
<div class="ui-dialog-buttonset">
<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" role="button">
<span class="ui-button-text">
Zoom to mission
</span>
</button>
<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" role="button">
<span class="ui-button-text">
OK
</span>
</button>
</div>
</div>
</div>
<div class="ui-dialog ui-widget ui-widget-content ui-corner-all ui-front ui-dialog-buttons ui-draggable ui-resizable" tabindex="-1" role="dialog" aria-describedby="dialog-plugin-mission-details-34dccbb4920e40229b2e000a5a96359c_1c" aria-labelledby="ui-id-305" style="position: absolute; height: auto; width: 450px; top: 125px; left: 510px; display: block; z-index: 10008;">
<div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix ui-draggable-handle">
<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-icon-only ui-dialog-titlebar-close ui-dialog-titlebar-button ui-dialog-titlebar-button-collapse ui-dialog-titlebar-button-collapse-collapsed" role="button">
<span class="ui-button-icon-primary ui-icon ui-icon-closethick">
</span>
<span class="ui-button-text">
&nbsp;
</span>
</button>
<span id="ui-id-305" class="ui-dialog-title ui-dialog-title-active">
Mesa Temple 3
</span>
<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-icon-only ui-dialog-titlebar-close ui-dialog-titlebar-button ui-dialog-titlebar-button-close" role="button">
<span class="ui-button-icon-primary ui-icon ui-icon-closethick">
</span>
<span class="ui-button-text">
&nbsp;
</span>
</button>
</div>
<div id="dialog-plugin-mission-details-34dccbb4920e40229b2e000a5a96359c_1c" class="ui-dialog-content ui-widget-content" style="width: auto; min-height: 68px; max-height: none; height: auto; display: none;">
<div class="plugin-mission-details">
<div class="plugin-mission-summary" data-mission_mid="34dccbb4920e40229b2e000a5a96359c.1c">
<img src="https://lh3.googleusercontent.com/j_Bqe3zG03r1ct7RJUGaCO93qpXNo5jVJ9Do3gOZ3FQ8ETCf1qTQF-9Cp_ccpkLHfaby_7ENDfKNd3XmMFmq">
<a href="/mission/34dccbb4920e40229b2e000a5a96359c.1c">
Mesa Temple 3
</a>
<span class="nickname enl">
JoeSpr0ckEt
</span>
<span class="plugin-mission-info length help" title="Length of this mission.
NOTE: The actual distance required to cover may vary depending on several factors!">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASAQMAAABsABwUAAAABlBMVEUAAACy+/gnk9HpAAAAAXRSTlMAQObYZgAAABVJREFUCNdjYEADB9Dg//8QjA7RAAB2VBF9TkATUAAAAABJRU5ErkJggg==">
212.8m
</span>
<span class="plugin-mission-info distance help" title="Distance to this mission. Click to update.">
<span class="portal-distance-bearing" style="transform: rotate(162deg);">
</span>
3.7km
</span>
<br>
<span class="plugin-mission-info time help" title="Typical duration">
<img src="https://commondatastorage.googleapis.com/ingress.com/img/tm_icons/time.png">
07m 01s
</span>
<span class="plugin-mission-info rating help" title="Average rating">
<img src="https://commondatastorage.googleapis.com/ingress.com/img/tm_icons/like.png">
90.69%
</span>
<span class="plugin-mission-info players help" title="Unique players who have completed this mission">
<img src="https://commondatastorage.googleapis.com/ingress.com/img/tm_icons/players.png">
43
</span>
<span class="plugin-mission-info waypoints help" title="Non Sequential mission with 6 waypoints">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASAQMAAABsABwUAAAABlBMVEUAAACy+/gnk9HpAAAAAXRSTlMAQObYZgAAAClJREFUCNdjYACBB0gYCBgFIJiJA4JZWCCYgwmCQaCA8QBD+d8DYBoIAN15B5HS9gdlAAAAAElFTkSuQmCC">
6
</span>
<p class="description">
Portals and points of interest near Mesa Arizona Mormon Temple
</p>
</div>
<ol>
<li class="plugin-mission-waypoint">
<div class="plugin-mission-portal-indicator help enl" title="Level:    2
Resonators: 2
Health: 66%">
2
<div style="transform: rotate(0deg);">
</div>
<div style="transform: rotate(45deg);">
</div>
</div>
<a href="/intel?ll=33.415333,-111.819566&amp;z=17&amp;pll=33.415333,-111.819566" class="title">
Mesa Pioneer Monument
</a>
<label>
<input type="checkbox" data-mission_mwpid="34dccbb4920e40229b2e000a5a96359c.1c-0-eb409f2469ee4fae9b97e734e2426b78.12">
<span>
Hack this Portal
</span>
</label>
</li>
<li class="plugin-mission-waypoint">
<div class="plugin-mission-portal-indicator help res" title="Level: 1
Resonators: 1
Health: 76%">
1
<div style="transform: rotate(0deg);">
</div>
</div>
<a href="/intel?ll=33.415531,-111.819549&amp;z=17&amp;pll=33.415531,-111.819549" class="title">
In Memory of Richard L. Love
</a>
<label>
<input type="checkbox" data-mission_mwpid="34dccbb4920e40229b2e000a5a96359c.1c-1-e29c7fd231d046578ae96798ee1a76d4.16">
<span>
Hack this Portal
</span>
</label>
</li>
<li class="plugin-mission-waypoint">
<div class="plugin-mission-portal-indicator help none" title="Level:  0
Resonators: 0
Health: 0%">
0
</div>
<a href="/intel?ll=33.415321,-111.818677&amp;z=17&amp;pll=33.415321,-111.818677" class="title">
Pioneer Park Southeast Entrance
</a>
<label>
<input type="checkbox" data-mission_mwpid="34dccbb4920e40229b2e000a5a96359c.1c-2-d4c0d9fbc31846f7965bcba2be5a6359.16">
<span>
Hack this Portal
</span>
</label>
</li>
<li class="plugin-mission-waypoint">
<div class="plugin-mission-portal-indicator help res" title="Level: 1
Resonators: 1
Health: 85%">
1
<div style="transform: rotate(0deg);">
</div>
</div>
<a href="/intel?ll=33.41579,-111.819139&amp;z=17&amp;pll=33.41579,-111.819139" class="title">
Rufus Dog Plaque
</a>
<label>
<input type="checkbox" data-mission_mwpid="34dccbb4920e40229b2e000a5a96359c.1c-3-1cd8b46a28aa44e496027ec172ed9ed7.16">
<span>
Hack this Portal
</span>
</label>
</li>
<li class="plugin-mission-waypoint">
<div class="plugin-mission-portal-indicator help none" title="Level:    0
Resonators: 0
Health: 0%">
0
</div>
<a href="/intel?ll=33.415866,-111.81955&amp;z=17&amp;pll=33.415866,-111.81955" class="title">
Mesa
</a>
<label>
<input type="checkbox" data-mission_mwpid="34dccbb4920e40229b2e000a5a96359c.1c-4-ba37820215fa47fd924a1a4770385b08.12">
<span>
Hack this Portal
</span>
</label>
</li>
<li class="plugin-mission-waypoint">
<span class="title">
Arizona's Honeymoon Trail
</span>
<label>
<input type="checkbox" data-mission_mwpid="34dccbb4920e40229b2e000a5a96359c.1c-5-917e7b8c3ff19a74595a9ae06e0944c5.1d">
<span>
View this Field Trip Waypoint
</span>
</label>
</li>
</ol>
</div>
</div>
<div class="ui-resizable-handle ui-resizable-n" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-e" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-s" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-w" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-se ui-icon ui-icon-gripsmall-diagonal-se" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-sw" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-ne" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-nw" style="z-index: 90;">
</div>
<div class="ui-dialog-buttonpane ui-widget-content ui-helper-clearfix" style="display: none;">
<div class="ui-dialog-buttonset">
<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" role="button">
<span class="ui-button-text">
Zoom to mission
</span>
</button>
<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" role="button">
<span class="ui-button-text">
OK
</span>
</button>
</div>
</div>
</div>
<div class="ui-dialog ui-widget ui-widget-content ui-corner-all ui-front ui-dialog-buttons ui-draggable ui-resizable" tabindex="-1" role="dialog" aria-describedby="dialog-plugin-mission-details-5a88f32afda249e4a7ebc59336a9fd5d_1c" aria-labelledby="ui-id-313" style="position: absolute; height: auto; width: 450px; top: 150px; left: 510px; display: block; z-index: 10010;">
<div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix ui-draggable-handle">
<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-icon-only ui-dialog-titlebar-close ui-dialog-titlebar-button ui-dialog-titlebar-button-collapse ui-dialog-titlebar-button-collapse-collapsed" role="button">
<span class="ui-button-icon-primary ui-icon ui-icon-closethick">
</span>
<span class="ui-button-text">
&nbsp;
</span>
</button>
<span id="ui-id-313" class="ui-dialog-title ui-dialog-title-active">
Mesa Temple 4
</span>
<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-icon-only ui-dialog-titlebar-close ui-dialog-titlebar-button ui-dialog-titlebar-button-close" role="button">
<span class="ui-button-icon-primary ui-icon ui-icon-closethick">
</span>
<span class="ui-button-text">
&nbsp;
</span>
</button>
</div>
<div id="dialog-plugin-mission-details-5a88f32afda249e4a7ebc59336a9fd5d_1c" class="ui-dialog-content ui-widget-content" style="width: auto; min-height: 68px; max-height: none; height: auto; display: none;">
<div class="plugin-mission-details">
<div class="plugin-mission-summary" data-mission_mid="5a88f32afda249e4a7ebc59336a9fd5d.1c">
<img src="https://lh3.googleusercontent.com/czuPifZq_0q6MOOL9UQG7PelWgTVAPooIvo6bJTrJe8SO3Yh9lmKwP2dJq81H97UA3qG4FzzED82b6pLzo5m7g">
<a href="/mission/5a88f32afda249e4a7ebc59336a9fd5d.1c">
Mesa Temple 4
</a>
<span class="nickname enl">
JoeSpr0ckEt
</span>
<span class="plugin-mission-info length help" title="Length of this mission.
NOTE: The actual distance required to cover may vary depending on several factors!">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASAQMAAABsABwUAAAABlBMVEUAAACy+/gnk9HpAAAAAXRSTlMAQObYZgAAABVJREFUCNdjYEADB9Dg//8QjA7RAAB2VBF9TkATUAAAAABJRU5ErkJggg==">
356.1m
</span>
<span class="plugin-mission-info distance help" title="Distance to this mission. Click to update.">
<span class="portal-distance-bearing" style="transform: rotate(164deg);">
</span>
3.7km
</span>
<br>
<span class="plugin-mission-info time help" title="Typical duration">
<img src="https://commondatastorage.googleapis.com/ingress.com/img/tm_icons/time.png">
08m 54s
</span>
<span class="plugin-mission-info rating help" title="Average rating">
<img src="https://commondatastorage.googleapis.com/ingress.com/img/tm_icons/like.png">
86.66%
</span>
<span class="plugin-mission-info players help" title="Unique players who have completed this mission">
<img src="https://commondatastorage.googleapis.com/ingress.com/img/tm_icons/players.png">
45
</span>
<span class="plugin-mission-info waypoints help" title="Non Sequential mission with 6 waypoints">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASAQMAAABsABwUAAAABlBMVEUAAACy+/gnk9HpAAAAAXRSTlMAQObYZgAAAClJREFUCNdjYACBB0gYCBgFIJiJA4JZWCCYgwmCQaCA8QBD+d8DYBoIAN15B5HS9gdlAAAAAElFTkSuQmCC">
6
</span>
<p class="description">
Portals and points of interest near Mesa Arizona Mormon Temple
</p>
</div>
<ol>
<li class="plugin-mission-waypoint">
<div class="plugin-mission-portal-indicator help none" title="Level:   0
Resonators: 0
Health: 0%">
0
</div>
<a href="/intel?ll=33.415485,-111.820485&amp;z=17&amp;pll=33.415485,-111.820485" class="title">
Designated dog exercise sign
</a>
<label>
<input type="checkbox" data-mission_mwpid="5a88f32afda249e4a7ebc59336a9fd5d.1c-0-709559cdc85048f59bb4e81931f5df08.16">
<span>
Hack this Portal
</span>
</label>
</li>
<li class="plugin-mission-waypoint">
<div class="plugin-mission-portal-indicator help enl" title="Level:    5
Resonators: 8
Health: 100%">
5
<div style="transform: rotate(0deg);">
</div>
<div style="transform: rotate(45deg);">
</div>
<div style="transform: rotate(90deg);">
</div>
<div style="transform: rotate(135deg);">
</div>
<div style="transform: rotate(180deg);">
</div>
<div style="transform: rotate(225deg);">
</div>
<div style="transform: rotate(270deg);">
</div>
<div style="transform: rotate(315deg);">
</div>
</div>
<a href="/intel?ll=33.415072,-111.822193&amp;z=17&amp;pll=33.415072,-111.822193" class="title">
Light Rail Art
</a>
<label>
<input type="checkbox" data-mission_mwpid="5a88f32afda249e4a7ebc59336a9fd5d.1c-1-e8c361a0abbd4f77ae8e25b0b4f3680a.16">
<span>
Hack this Portal
</span>
</label>
</li>
<li class="plugin-mission-waypoint">
<span class="title">
The Mesa Flour Mill, 1880s
</span>
<label>
<input type="checkbox" data-mission_mwpid="5a88f32afda249e4a7ebc59336a9fd5d.1c-2-e4989f1250e969756473e1c9e2b964e4.1d">
<span>
View this Field Trip Waypoint
</span>
</label>
</li>
<li class="plugin-mission-waypoint">
<span class="title">
Mesa Gas Station
</span>
<label>
<input type="checkbox" data-mission_mwpid="5a88f32afda249e4a7ebc59336a9fd5d.1c-3-85b78b22d47fa856039ee828785165b6.1d">
<span>
View this Field Trip Waypoint
</span>
</label>
</li>
<li class="plugin-mission-waypoint">
<div class="plugin-mission-portal-indicator help enl" title="Level:    1
Resonators: 1
Health: 100%">
1
<div style="transform: rotate(0deg);">
</div>
</div>
<a href="/intel?ll=33.41487,-111.823235&amp;z=17&amp;pll=33.41487,-111.823235" class="title">
Family Fundamental Unit of Society
</a>
<label>
<input type="checkbox" data-mission_mwpid="5a88f32afda249e4a7ebc59336a9fd5d.1c-4-7b1ca342e9a14c969beaa3dbf04ec03d.16">
<span>
Hack this Portal
</span>
</label>
</li>
<li class="plugin-mission-waypoint">
<div class="plugin-mission-portal-indicator help enl" title="Level:  1
Resonators: 1
Health: 100%">
1
<div style="transform: rotate(0deg);">
</div>
</div>
<a href="/intel?ll=33.414117,-111.822824&amp;z=17&amp;pll=33.414117,-111.822824" class="title">
Kids Need to Read
</a>
<label>
<input type="checkbox" data-mission_mwpid="5a88f32afda249e4a7ebc59336a9fd5d.1c-5-e1cdfa1cecdd4906887efec90e7ae6d1.16">
<span>
Hack this Portal
</span>
</label>
</li>
</ol>
</div>
</div>
<div class="ui-resizable-handle ui-resizable-n" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-e" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-s" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-w" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-se ui-icon ui-icon-gripsmall-diagonal-se" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-sw" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-ne" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-nw" style="z-index: 90;">
</div>
<div class="ui-dialog-buttonpane ui-widget-content ui-helper-clearfix" style="display: none;">
<div class="ui-dialog-buttonset">
<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" role="button">
<span class="ui-button-text">
Zoom to mission
</span>
</button>
<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" role="button">
<span class="ui-button-text">
OK
</span>
</button>
</div>
</div>
</div>
<div class="ui-dialog ui-widget ui-widget-content ui-corner-all ui-front ui-dialog-buttons ui-draggable ui-resizable" tabindex="-1" role="dialog" aria-describedby="dialog-plugin-mission-details-c4b90cbf43594a14840af11972a0465c_1c" aria-labelledby="ui-id-340" style="position: absolute; height: auto; width: 450px; top: 175px; left: 510px; display: block; z-index: 10012;">
<div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix ui-draggable-handle">
<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-icon-only ui-dialog-titlebar-close ui-dialog-titlebar-button ui-dialog-titlebar-button-collapse ui-dialog-titlebar-button-collapse-collapsed" role="button">
<span class="ui-button-icon-primary ui-icon ui-icon-closethick">
</span>
<span class="ui-button-text">
&nbsp;
</span>
</button>
<span id="ui-id-340" class="ui-dialog-title ui-dialog-title-active">
Mesa Temple 5
</span>
<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-icon-only ui-dialog-titlebar-close ui-dialog-titlebar-button ui-dialog-titlebar-button-close" role="button">
<span class="ui-button-icon-primary ui-icon ui-icon-closethick">
</span>
<span class="ui-button-text">
&nbsp;
</span>
</button>
</div>
<div id="dialog-plugin-mission-details-c4b90cbf43594a14840af11972a0465c_1c" class="ui-dialog-content ui-widget-content" style="width: auto; min-height: 68px; max-height: none; height: auto; display: none;">
<div class="plugin-mission-details">
<div class="plugin-mission-summary" data-mission_mid="c4b90cbf43594a14840af11972a0465c.1c">
<img src="https://lh3.googleusercontent.com/1cAnJK-0qIwMRw51hj5SKz84FVRDbvU6B424m6chQ13MDaA_2ywxVepmynyUm1TxQAp-C-fjW-ZV0D242iO-">
<a href="/mission/c4b90cbf43594a14840af11972a0465c.1c">
Mesa Temple 5
</a>
<span class="nickname enl">
JoeSpr0ckEt
</span>
<span class="plugin-mission-info length help" title="Length of this mission.
NOTE: The actual distance required to cover may vary depending on several factors!">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASAQMAAABsABwUAAAABlBMVEUAAACy+/gnk9HpAAAAAXRSTlMAQObYZgAAABVJREFUCNdjYEADB9Dg//8QjA7RAAB2VBF9TkATUAAAAABJRU5ErkJggg==">
486.1m
</span>
<span class="plugin-mission-info distance help" title="Distance to this mission. Click to update.">
<span class="portal-distance-bearing" style="transform: rotate(176deg);">
</span>
3.5km
</span>
<br>
<span class="plugin-mission-info time help" title="Typical duration">
<img src="https://commondatastorage.googleapis.com/ingress.com/img/tm_icons/time.png">
11m 41s
</span>
<span class="plugin-mission-info rating help" title="Average rating">
<img src="https://commondatastorage.googleapis.com/ingress.com/img/tm_icons/like.png">
95.12%
</span>
<span class="plugin-mission-info players help" title="Unique players who have completed this mission">
<img src="https://commondatastorage.googleapis.com/ingress.com/img/tm_icons/players.png">
41
</span>
<span class="plugin-mission-info waypoints help" title="Non Sequential mission with 6 waypoints">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASAQMAAABsABwUAAAABlBMVEUAAACy+/gnk9HpAAAAAXRSTlMAQObYZgAAAClJREFUCNdjYACBB0gYCBgFIJiJA4JZWCCYgwmCQaCA8QBD+d8DYBoIAN15B5HS9gdlAAAAAElFTkSuQmCC">
6
</span>
<p class="description">
Portals and points of interest near Mesa Arizona Mormon Temple
</p>
</div>
<ol>
<li class="plugin-mission-waypoint">
<div class="plugin-mission-portal-indicator help enl" title="Level:    1
Resonators: 1
Health: 100%">
1
<div style="transform: rotate(0deg);">
</div>
</div>
<a href="/intel?ll=33.414717,-111.825961&amp;z=17&amp;pll=33.414717,-111.825961" class="title">
Benedictine University Entry Plaza
</a>
<label>
<input type="checkbox" data-mission_mwpid="c4b90cbf43594a14840af11972a0465c.1c-0-b3731d84bda24a68937e7a5b9a050156.16">
<span>
Hack this Portal
</span>
</label>
</li>
<li class="plugin-mission-waypoint">
<div class="plugin-mission-portal-indicator help enl" title="Level:    5
Resonators: 8
Health: 100%">
5
<div style="transform: rotate(0deg);">
</div>
<div style="transform: rotate(45deg);">
</div>
<div style="transform: rotate(90deg);">
</div>
<div style="transform: rotate(135deg);">
</div>
<div style="transform: rotate(180deg);">
</div>
<div style="transform: rotate(225deg);">
</div>
<div style="transform: rotate(270deg);">
</div>
<div style="transform: rotate(315deg);">
</div>
</div>
<a href="/intel?ll=33.414913,-111.826434&amp;z=17&amp;pll=33.414913,-111.826434" class="title">
Breaking Ground
</a>
<label>
<input type="checkbox" data-mission_mwpid="c4b90cbf43594a14840af11972a0465c.1c-1-e0bd3527326c41868479e0fa24a1795d.16">
<span>
Hack this Portal
</span>
</label>
</li>
<li class="plugin-mission-waypoint">
<div class="plugin-mission-portal-indicator help enl" title="Level:   6
Resonators: 8
Health: 100%">
6
<div style="transform: rotate(0deg);">
</div>
<div style="transform: rotate(45deg);">
</div>
<div style="transform: rotate(90deg);">
</div>
<div style="transform: rotate(135deg);">
</div>
<div style="transform: rotate(180deg);">
</div>
<div style="transform: rotate(225deg);">
</div>
<div style="transform: rotate(270deg);">
</div>
<div style="transform: rotate(315deg);">
</div>
</div>
<a href="/intel?ll=33.414961,-111.82911&amp;z=17&amp;pll=33.414961,-111.82911" class="title">
The Teacher
</a>
<label>
<input type="checkbox" data-mission_mwpid="c4b90cbf43594a14840af11972a0465c.1c-2-a3a47593ed384ef98a4158439a726831.16">
<span>
Hack this Portal
</span>
</label>
</li>
<li class="plugin-mission-waypoint">
<div class="plugin-mission-portal-indicator help enl" title="Level: 1
Resonators: 1
Health: 100%">
1
<div style="transform: rotate(0deg);">
</div>
</div>
<a href="/intel?ll=33.41487,-111.828647&amp;z=17&amp;pll=33.41487,-111.828647" class="title">
Three Guys Sitting
</a>
<label>
<input type="checkbox" data-mission_mwpid="c4b90cbf43594a14840af11972a0465c.1c-3-df46746d50014da1bc2f18a13a7e29c1.11">
<span>
Hack this Portal
</span>
</label>
</li>
<li class="plugin-mission-waypoint">
<div class="plugin-mission-portal-indicator help enl" title="Level:  1
Resonators: 1
Health: 100%">
1
<div style="transform: rotate(0deg);">
</div>
</div>
<a href="/intel?ll=33.415233,-111.829045&amp;z=17&amp;pll=33.415233,-111.829045" class="title">
Fragments Of Support
</a>
<label>
<input type="checkbox" data-mission_mwpid="c4b90cbf43594a14840af11972a0465c.1c-4-b0df74714f344c3aa5e95dcf3aca12b7.16">
<span>
Hack this Portal
</span>
</label>
</li>
<li class="plugin-mission-waypoint">
<div class="plugin-mission-portal-indicator help enl" title="Level:  6
Resonators: 8
Health: 57%">
6
<div style="transform: rotate(0deg);">
</div>
<div style="transform: rotate(45deg);">
</div>
<div style="transform: rotate(90deg);">
</div>
<div style="transform: rotate(135deg);">
</div>
<div style="transform: rotate(180deg);">
</div>
<div style="transform: rotate(225deg);">
</div>
<div style="transform: rotate(270deg);">
</div>
<div style="transform: rotate(315deg);">
</div>
</div>
<a href="/intel?ll=33.415972,-111.828646&amp;z=17&amp;pll=33.415972,-111.828646" class="title">
Garden Chapel
</a>
<label>
<input type="checkbox" data-mission_mwpid="c4b90cbf43594a14840af11972a0465c.1c-5-305812558c7740dfb87eefe8c622c72e.16">
<span>
Hack this Portal
</span>
</label>
</li>
</ol>
</div>
</div>
<div class="ui-resizable-handle ui-resizable-n" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-e" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-s" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-w" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-se ui-icon ui-icon-gripsmall-diagonal-se" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-sw" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-ne" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-nw" style="z-index: 90;">
</div>
<div class="ui-dialog-buttonpane ui-widget-content ui-helper-clearfix" style="display: none;">
<div class="ui-dialog-buttonset">
<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" role="button">
<span class="ui-button-text">
Zoom to mission
</span>
</button>
<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" role="button">
<span class="ui-button-text">
OK
</span>
</button>
</div>
</div>
</div>
<div class="ui-dialog ui-widget ui-widget-content ui-corner-all ui-front ui-dialog-buttons ui-draggable ui-resizable" tabindex="-1" role="dialog" aria-describedby="dialog-plugin-mission-details-05cd6a595d4d4960957cfcac50487386_1c" aria-labelledby="ui-id-342" style="position: absolute; height: auto; width: 450px; top: 200px; left: 510px; display: block; z-index: 10014;">
<div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix ui-draggable-handle">
<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-icon-only ui-dialog-titlebar-close ui-dialog-titlebar-button ui-dialog-titlebar-button-collapse ui-dialog-titlebar-button-collapse-collapsed" role="button">
<span class="ui-button-icon-primary ui-icon ui-icon-closethick">
</span>
<span class="ui-button-text">
&nbsp;
</span>
</button>
<span id="ui-id-342" class="ui-dialog-title ui-dialog-title-active">
Mesa Temple 6
</span>
<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-icon-only ui-dialog-titlebar-close ui-dialog-titlebar-button ui-dialog-titlebar-button-close" role="button">
<span class="ui-button-icon-primary ui-icon ui-icon-closethick">
</span>
<span class="ui-button-text">
&nbsp;
</span>
</button>
</div>
<div id="dialog-plugin-mission-details-05cd6a595d4d4960957cfcac50487386_1c" class="ui-dialog-content ui-widget-content" style="width: auto; min-height: 68px; max-height: none; height: auto; display: none;">
<div class="plugin-mission-details">
<div class="plugin-mission-summary" data-mission_mid="05cd6a595d4d4960957cfcac50487386.1c">
<img src="https://lh3.googleusercontent.com/EunDhOkOw-b77x-nhLHhSCrFPwaMuwBQWxo59W6d8F6nlf4SmmUYCD3o_xsRjesvi83zj55-a2N7D7COhHk">
<a href="/mission/05cd6a595d4d4960957cfcac50487386.1c">
Mesa Temple 6
</a>
<span class="nickname enl">
JoeSpr0ckEt
</span>
<span class="plugin-mission-info length help" title="Length of this mission.
NOTE: The actual distance required to cover may vary depending on several factors!">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASAQMAAABsABwUAAAABlBMVEUAAACy+/gnk9HpAAAAAXRSTlMAQObYZgAAABVJREFUCNdjYEADB9Dg//8QjA7RAAB2VBF9TkATUAAAAABJRU5ErkJggg==">
64.4m
</span>
<span class="plugin-mission-info distance help" title="Distance to this mission. Click to update.">
<span class="portal-distance-bearing" style="transform: rotate(178deg);">
</span>
3.6km
</span>
<br>
<span class="plugin-mission-info time help" title="Typical duration">
<img src="https://commondatastorage.googleapis.com/ingress.com/img/tm_icons/time.png">
04m 54s
</span>
<span class="plugin-mission-info rating help" title="Average rating">
<img src="https://commondatastorage.googleapis.com/ingress.com/img/tm_icons/like.png">
90.38%
</span>
<span class="plugin-mission-info players help" title="Unique players who have completed this mission">
<img src="https://commondatastorage.googleapis.com/ingress.com/img/tm_icons/players.png">
50
</span>
<span class="plugin-mission-info waypoints help" title="Non Sequential mission with 6 waypoints">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASAQMAAABsABwUAAAABlBMVEUAAACy+/gnk9HpAAAAAXRSTlMAQObYZgAAAClJREFUCNdjYACBB0gYCBgFIJiJA4JZWCCYgwmCQaCA8QBD+d8DYBoIAN15B5HS9gdlAAAAAElFTkSuQmCC">
6
</span>
<p class="description">
Portals and points of interest near Mesa Arizona Mormon Temple
</p>
</div>
<ol>
<li class="plugin-mission-waypoint">
<div class="plugin-mission-portal-indicator help enl" title="Level: 1
Resonators: 1
Health: 100%">
1
<div style="transform: rotate(0deg);">
</div>
</div>
<a href="/intel?ll=33.414936,-111.830643&amp;z=17&amp;pll=33.414936,-111.830643" class="title">
Mesa Arts Center
</a>
<label>
<input type="checkbox" data-mission_mwpid="05cd6a595d4d4960957cfcac50487386.1c-0-dd6fa5e2fab3443aa5aaf6981b9b97a4.12">
<span>
Hack this Portal
</span>
</label>
</li>
<li class="plugin-mission-waypoint">
<span class="title">
Japanese Americans See Social Life in Mesa, May 1946
</span>
<label>
<input type="checkbox" data-mission_mwpid="05cd6a595d4d4960957cfcac50487386.1c-1-56ff7a8bee50ba918eb50e97dcebdb8e.1d">
<span>
View this Field Trip Waypoint
</span>
</label>
</li>
<li class="plugin-mission-waypoint">
<div class="plugin-mission-portal-indicator help enl" title="Level:   1
Resonators: 1
Health: 85%">
1
<div style="transform: rotate(0deg);">
</div>
</div>
<a href="/intel?ll=33.414932,-111.830515&amp;z=17&amp;pll=33.414932,-111.830515" class="title">
Mesa Arts Center - Rainshelter Bus Stop
</a>
<label>
<input type="checkbox" data-mission_mwpid="05cd6a595d4d4960957cfcac50487386.1c-2-e7a8ae4ae7f6435dbc30589f34ec1c02.11">
<span>
Hack this Portal
</span>
</label>
</li>
<li class="plugin-mission-waypoint">
<span class="title">
The Pima People in Mesa
</span>
<label>
<input type="checkbox" data-mission_mwpid="05cd6a595d4d4960957cfcac50487386.1c-3-686a0ccf57a1a9e3f07eff6e0c8d9ba6.1d">
<span>
View this Field Trip Waypoint
</span>
</label>
</li>
<li class="plugin-mission-waypoint">
<span class="title">
Japanese Americans See Social Life in Mesa, May 1946
</span>
<label>
<input type="checkbox" data-mission_mwpid="05cd6a595d4d4960957cfcac50487386.1c-4-311e031165a6b37fd75b4012525b957b.1d">
<span>
View this Field Trip Waypoint
</span>
</label>
</li>
<li class="plugin-mission-waypoint">
<div class="plugin-mission-portal-indicator help enl" title="Level:   6
Resonators: 8
Health: 65%">
6
<div style="transform: rotate(0deg);">
</div>
<div style="transform: rotate(45deg);">
</div>
<div style="transform: rotate(90deg);">
</div>
<div style="transform: rotate(135deg);">
</div>
<div style="transform: rotate(180deg);">
</div>
<div style="transform: rotate(225deg);">
</div>
<div style="transform: rotate(270deg);">
</div>
<div style="transform: rotate(315deg);">
</div>
</div>
<a href="/intel?ll=33.415301,-111.830162&amp;z=17&amp;pll=33.415301,-111.830162" class="title">
Girl with Helicopter Sculpture
</a>
<label>
<input type="checkbox" data-mission_mwpid="05cd6a595d4d4960957cfcac50487386.1c-5-542278a39f2c4c9aa477be05753fdeb2.11">
<span>
Hack this Portal
</span>
</label>
</li>
</ol>
</div>
</div>
<div class="ui-resizable-handle ui-resizable-n" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-e" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-s" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-w" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-se ui-icon ui-icon-gripsmall-diagonal-se" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-sw" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-ne" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-nw" style="z-index: 90;">
</div>
<div class="ui-dialog-buttonpane ui-widget-content ui-helper-clearfix" style="display: none;">
<div class="ui-dialog-buttonset">
<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" role="button">
<span class="ui-button-text">
Zoom to mission
</span>
</button>
<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" role="button">
<span class="ui-button-text">
OK
</span>
</button>
</div>
</div>
</div>
<div class="ui-dialog ui-widget ui-widget-content ui-corner-all ui-front ui-dialog-bkmrksSet ui-dialog-buttons ui-draggable ui-resizable" tabindex="-1" role="dialog" aria-describedby="dialog-anon-3" aria-labelledby="ui-id-384" style="position: absolute; height: auto; width: 300px; top: 50px; left: 1204px; display: block; z-index: 10016;">
<div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix ui-draggable-handle">
<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-icon-only ui-dialog-titlebar-close ui-dialog-titlebar-button ui-dialog-titlebar-button-collapse ui-dialog-titlebar-button-collapse-expanded" role="button">
<span class="ui-button-icon-primary ui-icon ui-icon-closethick">
</span>
<span class="ui-button-text">
&nbsp;
</span>
</button>
<span id="ui-id-384" class="ui-dialog-title ui-dialog-title-inactive">
Bookmarks Options
</span>
<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-icon-only ui-dialog-titlebar-close ui-dialog-titlebar-button ui-dialog-titlebar-button-close" role="button">
<span class="ui-button-icon-primary ui-icon ui-icon-closethick">
</span>
<span class="ui-button-text">
&nbsp;
</span>
</button>
</div>
<div id="dialog-anon-3" class="ui-dialog-content ui-widget-content" style="width: auto; min-height: 63px; max-height: none; height: auto;">
<div id="bkmrksSetbox">
<a onclick="window.plugin.bookmarks.optReset();return false;">
Reset bookmarks
</a>
<a onclick="window.plugin.bookmarks.optCopy();return false;">
Copy bookmarks
</a>
<a onclick="window.plugin.bookmarks.optPaste();return false;">
Paste bookmarks
</a>
<a onclick="window.plugin.bookmarks.optRenameF();return false;">
Rename Folder
</a>
<a onclick="window.plugin.bookmarks.optBox('save');return false;">
Save box position
</a>
<a onclick="window.plugin.bookmarks.optBox('reset');return false;">
Reset box position
</a>
</div>
</div>
<div class="ui-dialog-buttonpane ui-widget-content ui-helper-clearfix">
<div class="ui-dialog-buttonset">
<p class="bkrmks-alert" style="float: left; margin-top: 4px; display: none;">
Successful.
</p>
<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" role="button">
<span class="ui-button-text">
OK
</span>
</button>
</div>
</div>
<div class="ui-resizable-handle ui-resizable-n" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-e" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-s" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-w" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-se ui-icon ui-icon-gripsmall-diagonal-se" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-sw" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-ne" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-nw" style="z-index: 90;">
</div>
</div>
<div class="ui-dialog ui-widget ui-widget-content ui-corner-all ui-front ui-dialog-buttons ui-draggable ui-resizable" tabindex="-1" role="dialog" style="position: absolute; height: auto; width: 450px; top: 290px; left: 693px; display: block; z-index: 10018;" aria-describedby="dialog-plugin-mission-details-8f0d8aefc9f24ea0b077524086bc6ecd_1c" aria-labelledby="ui-id-724">
<div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix ui-draggable-handle">
<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-icon-only ui-dialog-titlebar-close ui-dialog-titlebar-button ui-dialog-titlebar-button-collapse ui-dialog-titlebar-button-collapse-expanded" role="button">
<span class="ui-button-icon-primary ui-icon ui-icon-closethick">
</span>
<span class="ui-button-text">
&nbsp;
</span>
</button>
<span id="ui-id-724" class="ui-dialog-title ui-dialog-title-active">
Mesa Temple 1
</span>
<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-icon-only ui-dialog-titlebar-close ui-dialog-titlebar-button ui-dialog-titlebar-button-close" role="button">
<span class="ui-button-icon-primary ui-icon ui-icon-closethick">
</span>
<span class="ui-button-text">
&nbsp;
</span>
</button>
</div>
<div id="dialog-plugin-mission-details-8f0d8aefc9f24ea0b077524086bc6ecd_1c" class="ui-dialog-content ui-widget-content" style="width: auto; min-height: 68px; max-height: none; height: auto;">
<div class="plugin-mission-details">
<div class="plugin-mission-summary" data-mission_mid="8f0d8aefc9f24ea0b077524086bc6ecd.1c">
<img src="https://lh3.googleusercontent.com/hZTpS0WCRAfAPqjBLNoazjeqU1sg62_dLCqW7w-PUUkgjxMk8g2qJ3ut-hm9InqJekPhmQP_6ex8ZkuVtA5S">
<a href="/mission/8f0d8aefc9f24ea0b077524086bc6ecd.1c">
Mesa Temple 1
</a>
<span class="nickname enl">
JoeSpr0ckEt
</span>
<span class="plugin-mission-info length help" title="Length of this mission.
NOTE: The actual distance required to cover may vary depending on several factors!">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASAQMAAABsABwUAAAABlBMVEUAAACy+/gnk9HpAAAAAXRSTlMAQObYZgAAABVJREFUCNdjYEADB9Dg//8QjA7RAAB2VBF9TkATUAAAAABJRU5ErkJggg==">
360.6m
</span>
<span class="plugin-mission-info distance help" title="Distance to this mission. Click to update.">
<span class="portal-distance-bearing" style="transform: rotate(164deg);">
</span>
3.9km
</span>
<br>
<span class="plugin-mission-info time help" title="Typical duration">
<img src="https://commondatastorage.googleapis.com/ingress.com/img/tm_icons/time.png">
07m 23s
</span>
<span class="plugin-mission-info rating help" title="Average rating">
<img src="https://commondatastorage.googleapis.com/ingress.com/img/tm_icons/like.png">
88.63%
</span>
<span class="plugin-mission-info players help" title="Unique players who have completed this mission">
<img src="https://commondatastorage.googleapis.com/ingress.com/img/tm_icons/players.png">
43
</span>
<span class="plugin-mission-info waypoints help" title="Non Sequential mission with 6 waypoints">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASAQMAAABsABwUAAAABlBMVEUAAACy+/gnk9HpAAAAAXRSTlMAQObYZgAAAClJREFUCNdjYACBB0gYCBgFIJiJA4JZWCCYgwmCQaCA8QBD+d8DYBoIAN15B5HS9gdlAAAAAElFTkSuQmCC">
6
</span>
<p class="description">
Portals and points of interest near Mesa Arizona Mormon Temple
</p>
</div>
<ol>
<li class="plugin-mission-waypoint">
<div class="plugin-mission-portal-indicator help enl" title="Level:    2
Resonators: 3
Health: 94%">
2
<div style="transform: rotate(0deg);">
</div>
<div style="transform: rotate(45deg);">
</div>
<div style="transform: rotate(90deg);">
</div>
</div>
<a href="/intel?ll=33.413536,-111.819615&amp;z=17&amp;pll=33.413536,-111.819615" class="title">
LDS Temple
</a>
<label>
<input type="checkbox" data-mission_mwpid="8f0d8aefc9f24ea0b077524086bc6ecd.1c-0-04c1649d05094b07a257887e77e0c75b.12">
<span>
Hack this Portal
</span>
</label>
</li>
<li class="plugin-mission-waypoint">
<div class="plugin-mission-portal-indicator help res" title="Level:   3
Resonators: 8
Health: 85%">
3
<div style="transform: rotate(0deg);">
</div>
<div style="transform: rotate(45deg);">
</div>
<div style="transform: rotate(90deg);">
</div>
<div style="transform: rotate(135deg);">
</div>
<div style="transform: rotate(180deg);">
</div>
<div style="transform: rotate(225deg);">
</div>
<div style="transform: rotate(270deg);">
</div>
<div style="transform: rotate(315deg);">
</div>
</div>
<a href="/intel?ll=33.413225,-111.81999&amp;z=17&amp;pll=33.413225,-111.81999" class="title">
Petrified Wood Monument II
</a>
<label>
<input type="checkbox" data-mission_mwpid="8f0d8aefc9f24ea0b077524086bc6ecd.1c-1-07d512d6ffcf4e9b8ccaec6912ab81f4.16">
<span>
Hack this Portal
</span>
</label>
</li>
<li class="plugin-mission-waypoint">
<div class="plugin-mission-portal-indicator help enl" title="Level:   6
Resonators: 8
Health: 20%">
6
<div style="transform: rotate(0deg);">
</div>
<div style="transform: rotate(45deg);">
</div>
<div style="transform: rotate(90deg);">
</div>
<div style="transform: rotate(135deg);">
</div>
<div style="transform: rotate(180deg);">
</div>
<div style="transform: rotate(225deg);">
</div>
<div style="transform: rotate(270deg);">
</div>
<div style="transform: rotate(315deg);">
</div>
</div>
<a href="/intel?ll=33.413219,-111.819695&amp;z=17&amp;pll=33.413219,-111.819695" class="title">
Large Fountain
</a>
<label>
<input type="checkbox" data-mission_mwpid="8f0d8aefc9f24ea0b077524086bc6ecd.1c-2-d7db95c0c92044ac8189bbd3108d2964.16">
<span>
Hack this Portal
</span>
</label>
</li>
<li class="plugin-mission-waypoint">
<div class="plugin-mission-portal-indicator help res" title="Level: 4
Resonators: 8
Health: 85%">
4
<div style="transform: rotate(0deg);">
</div>
<div style="transform: rotate(45deg);">
</div>
<div style="transform: rotate(90deg);">
</div>
<div style="transform: rotate(135deg);">
</div>
<div style="transform: rotate(180deg);">
</div>
<div style="transform: rotate(225deg);">
</div>
<div style="transform: rotate(270deg);">
</div>
<div style="transform: rotate(315deg);">
</div>
</div>
<a href="/intel?ll=33.41312,-111.820296&amp;z=17&amp;pll=33.41312,-111.820296" class="title">
Mesa Arizona Temple
</a>
<label>
<input type="checkbox" data-mission_mwpid="8f0d8aefc9f24ea0b077524086bc6ecd.1c-3-3e202a01bab0403c83c3077deb44fafa.12">
<span>
Hack this Portal
</span>
</label>
</li>
<li class="plugin-mission-waypoint">
<div class="plugin-mission-portal-indicator help enl" title="Level:  5
Resonators: 7
Health: 12%">
5
<div style="transform: rotate(0deg);">
</div>
<div style="transform: rotate(45deg);">
</div>
<div style="transform: rotate(90deg);">
</div>
<div style="transform: rotate(135deg);">
</div>
<div style="transform: rotate(180deg);">
</div>
<div style="transform: rotate(225deg);">
</div>
<div style="transform: rotate(270deg);">
</div>
</div>
<a href="/intel?ll=33.413419,-111.819297&amp;z=17&amp;pll=33.413419,-111.819297" class="title">
Rock Art
</a>
<label>
<input type="checkbox" data-mission_mwpid="8f0d8aefc9f24ea0b077524086bc6ecd.1c-4-b37cd5a22bf9400a9f61e9987d54350f.16">
<span>
Hack this Portal
</span>
</label>
</li>
<li class="plugin-mission-waypoint">
<div class="plugin-mission-portal-indicator help res" title="Level: 2
Resonators: 8
Health: 85%">
2
<div style="transform: rotate(0deg);">
</div>
<div style="transform: rotate(45deg);">
</div>
<div style="transform: rotate(90deg);">
</div>
<div style="transform: rotate(135deg);">
</div>
<div style="transform: rotate(180deg);">
</div>
<div style="transform: rotate(225deg);">
</div>
<div style="transform: rotate(270deg);">
</div>
<div style="transform: rotate(315deg);">
</div>
</div>
<a href="/intel?ll=33.412869,-111.820521&amp;z=17&amp;pll=33.412869,-111.820521" class="title">
Mesa Arizona Temple
</a>
<label>
<input type="checkbox" data-mission_mwpid="8f0d8aefc9f24ea0b077524086bc6ecd.1c-5-7c23c7e50498488a9c6b3e846d05b2d6.12">
<span>
Hack this Portal
</span>
</label>
</li>
</ol>
</div>
</div>
<div class="ui-resizable-handle ui-resizable-n" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-e" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-s" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-w" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-se ui-icon ui-icon-gripsmall-diagonal-se" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-sw" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-ne" style="z-index: 90;">
</div>
<div class="ui-resizable-handle ui-resizable-nw" style="z-index: 90;">
</div>
<div class="ui-dialog-buttonpane ui-widget-content ui-helper-clearfix">
<div class="ui-dialog-buttonset">
<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" role="button">
<span class="ui-button-text">
Zoom to mission
</span>
</button>
<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" role="button">
<span class="ui-button-text">
OK
</span>
</button>
</div>
</div>
</div>
</body>
</html>
